var lV=Object.defineProperty;var cV=(n,e,t)=>e in n?lV(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var uV=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var bR=(n,e,t)=>(cV(n,typeof e!="symbol"?e+"":e,t),t);var Eue=uV(ts=>{function hV(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const s=Object.getOwnPropertyDescriptor(i,r);s&&Object.defineProperty(n,r,s.get?s:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var Iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Hw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function dV(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var KF={exports:{}},Ww={},JF={exports:{}},Pi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var M0=Symbol.for("react.element"),fV=Symbol.for("react.portal"),pV=Symbol.for("react.fragment"),mV=Symbol.for("react.strict_mode"),gV=Symbol.for("react.profiler"),_V=Symbol.for("react.provider"),yV=Symbol.for("react.context"),vV=Symbol.for("react.forward_ref"),xV=Symbol.for("react.suspense"),wV=Symbol.for("react.memo"),bV=Symbol.for("react.lazy"),SR=Symbol.iterator;function SV(n){return n===null||typeof n!="object"?null:(n=SR&&n[SR]||n["@@iterator"],typeof n=="function"?n:null)}var QF={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},eO=Object.assign,tO={};function xg(n,e,t){this.props=n,this.context=e,this.refs=tO,this.updater=t||QF}xg.prototype.isReactComponent={};xg.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};xg.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function nO(){}nO.prototype=xg.prototype;function sC(n,e,t){this.props=n,this.context=e,this.refs=tO,this.updater=t||QF}var oC=sC.prototype=new nO;oC.constructor=sC;eO(oC,xg.prototype);oC.isPureReactComponent=!0;var MR=Array.isArray,iO=Object.prototype.hasOwnProperty,aC={current:null},rO={key:!0,ref:!0,__self:!0,__source:!0};function sO(n,e,t){var i,r={},s=null,a=null;if(e!=null)for(i in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)iO.call(e,i)&&!rO.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var d=Array(o),p=0;p<o;p++)d[p]=arguments[p+2];r.children=d}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:M0,type:n,key:s,ref:a,props:r,_owner:aC.current}}function MV(n,e){return{$$typeof:M0,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function lC(n){return typeof n=="object"&&n!==null&&n.$$typeof===M0}function EV(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var ER=/\/+/g;function RS(n,e){return typeof n=="object"&&n!==null&&n.key!=null?EV(""+n.key):e.toString(36)}function qx(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var a=!1;if(n===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(n.$$typeof){case M0:case fV:a=!0}}if(a)return a=n,r=r(a),n=i===""?"."+RS(a,0):i,MR(r)?(t="",n!=null&&(t=n.replace(ER,"$&/")+"/"),qx(r,e,t,"",function(p){return p})):r!=null&&(lC(r)&&(r=MV(r,t+(!r.key||a&&a.key===r.key?"":(""+r.key).replace(ER,"$&/")+"/")+n)),e.push(r)),1;if(a=0,i=i===""?".":i+":",MR(n))for(var o=0;o<n.length;o++){s=n[o];var d=i+RS(s,o);a+=qx(s,e,t,d,r)}else if(d=SV(n),typeof d=="function")for(n=d.call(n),o=0;!(s=n.next()).done;)s=s.value,d=i+RS(s,o++),a+=qx(s,e,t,d,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function kv(n,e,t){if(n==null)return n;var i=[],r=0;return qx(n,i,"","",function(s){return e.call(t,s,r++)}),i}function TV(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Go={current:null},Xx={transition:null},CV={ReactCurrentDispatcher:Go,ReactCurrentBatchConfig:Xx,ReactCurrentOwner:aC};Pi.Children={map:kv,forEach:function(n,e,t){kv(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return kv(n,function(){e++}),e},toArray:function(n){return kv(n,function(e){return e})||[]},only:function(n){if(!lC(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Pi.Component=xg;Pi.Fragment=pV;Pi.Profiler=gV;Pi.PureComponent=sC;Pi.StrictMode=mV;Pi.Suspense=xV;Pi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CV;Pi.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=eO({},n.props),r=n.key,s=n.ref,a=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=aC.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(d in e)iO.call(e,d)&&!rO.hasOwnProperty(d)&&(i[d]=e[d]===void 0&&o!==void 0?o[d]:e[d])}var d=arguments.length-2;if(d===1)i.children=t;else if(1<d){o=Array(d);for(var p=0;p<d;p++)o[p]=arguments[p+2];i.children=o}return{$$typeof:M0,type:n.type,key:r,ref:s,props:i,_owner:a}};Pi.createContext=function(n){return n={$$typeof:yV,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:_V,_context:n},n.Consumer=n};Pi.createElement=sO;Pi.createFactory=function(n){var e=sO.bind(null,n);return e.type=n,e};Pi.createRef=function(){return{current:null}};Pi.forwardRef=function(n){return{$$typeof:vV,render:n}};Pi.isValidElement=lC;Pi.lazy=function(n){return{$$typeof:bV,_payload:{_status:-1,_result:n},_init:TV}};Pi.memo=function(n,e){return{$$typeof:wV,type:n,compare:e===void 0?null:e}};Pi.startTransition=function(n){var e=Xx.transition;Xx.transition={};try{n()}finally{Xx.transition=e}};Pi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Pi.useCallback=function(n,e){return Go.current.useCallback(n,e)};Pi.useContext=function(n){return Go.current.useContext(n)};Pi.useDebugValue=function(){};Pi.useDeferredValue=function(n){return Go.current.useDeferredValue(n)};Pi.useEffect=function(n,e){return Go.current.useEffect(n,e)};Pi.useId=function(){return Go.current.useId()};Pi.useImperativeHandle=function(n,e,t){return Go.current.useImperativeHandle(n,e,t)};Pi.useInsertionEffect=function(n,e){return Go.current.useInsertionEffect(n,e)};Pi.useLayoutEffect=function(n,e){return Go.current.useLayoutEffect(n,e)};Pi.useMemo=function(n,e){return Go.current.useMemo(n,e)};Pi.useReducer=function(n,e,t){return Go.current.useReducer(n,e,t)};Pi.useRef=function(n){return Go.current.useRef(n)};Pi.useState=function(n){return Go.current.useState(n)};Pi.useSyncExternalStore=function(n,e,t){return Go.current.useSyncExternalStore(n,e,t)};Pi.useTransition=function(){return Go.current.useTransition()};Pi.version="18.2.0";JF.exports=Pi;var Ht=JF.exports;const oO=Hw(Ht),AV=hV({__proto__:null,default:oO},[Ht]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var IV=Ht,PV=Symbol.for("react.element"),RV=Symbol.for("react.fragment"),LV=Object.prototype.hasOwnProperty,DV=IV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,kV={key:!0,ref:!0,__self:!0,__source:!0};function aO(n,e,t){var i,r={},s=null,a=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(i in e)LV.call(e,i)&&!kV.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:PV,type:n,key:s,ref:a,props:r,_owner:DV.current}}Ww.Fragment=RV;Ww.jsx=aO;Ww.jsxs=aO;KF.exports=Ww;var ln=KF.exports,OE={},lO={exports:{}},Oa={},cO={exports:{}},uO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Ee,ut){var ot=Ee.length;Ee.push(ut);e:for(;0<ot;){var dt=ot-1>>>1,Ct=Ee[dt];if(0<r(Ct,ut))Ee[dt]=ut,Ee[ot]=Ct,ot=dt;else break e}}function t(Ee){return Ee.length===0?null:Ee[0]}function i(Ee){if(Ee.length===0)return null;var ut=Ee[0],ot=Ee.pop();if(ot!==ut){Ee[0]=ot;e:for(var dt=0,Ct=Ee.length,Vt=Ct>>>1;dt<Vt;){var Re=2*(dt+1)-1,mt=Ee[Re],Et=Re+1,It=Ee[Et];if(0>r(mt,ot))Et<Ct&&0>r(It,mt)?(Ee[dt]=It,Ee[Et]=ot,dt=Et):(Ee[dt]=mt,Ee[Re]=ot,dt=Re);else if(Et<Ct&&0>r(It,ot))Ee[dt]=It,Ee[Et]=ot,dt=Et;else break e}}return ut}function r(Ee,ut){var ot=Ee.sortIndex-ut.sortIndex;return ot!==0?ot:Ee.id-ut.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var a=Date,o=a.now();n.unstable_now=function(){return a.now()-o}}var d=[],p=[],g=1,_=null,w=3,T=!1,I=!1,L=!1,P=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,O=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function z(Ee){for(var ut=t(p);ut!==null;){if(ut.callback===null)i(p);else if(ut.startTime<=Ee)i(p),ut.sortIndex=ut.expirationTime,e(d,ut);else break;ut=t(p)}}function H(Ee){if(L=!1,z(Ee),!I)if(t(d)!==null)I=!0,Ne(Y);else{var ut=t(p);ut!==null&&st(H,ut.startTime-Ee)}}function Y(Ee,ut){I=!1,L&&(L=!1,C(ce),ce=-1),T=!0;var ot=w;try{for(z(ut),_=t(d);_!==null&&(!(_.expirationTime>ut)||Ee&&!pe());){var dt=_.callback;if(typeof dt=="function"){_.callback=null,w=_.priorityLevel;var Ct=dt(_.expirationTime<=ut);ut=n.unstable_now(),typeof Ct=="function"?_.callback=Ct:_===t(d)&&i(d),z(ut)}else i(d);_=t(d)}if(_!==null)var Vt=!0;else{var Re=t(p);Re!==null&&st(H,Re.startTime-ut),Vt=!1}return Vt}finally{_=null,w=ot,T=!1}}var ee=!1,te=null,ce=-1,K=5,Q=-1;function pe(){return!(n.unstable_now()-Q<K)}function ze(){if(te!==null){var Ee=n.unstable_now();Q=Ee;var ut=!0;try{ut=te(!0,Ee)}finally{ut?Fe():(ee=!1,te=null)}}else ee=!1}var Fe;if(typeof O=="function")Fe=function(){O(ze)};else if(typeof MessageChannel<"u"){var qe=new MessageChannel,et=qe.port2;qe.port1.onmessage=ze,Fe=function(){et.postMessage(null)}}else Fe=function(){P(ze,0)};function Ne(Ee){te=Ee,ee||(ee=!0,Fe())}function st(Ee,ut){ce=P(function(){Ee(n.unstable_now())},ut)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ee){Ee.callback=null},n.unstable_continueExecution=function(){I||T||(I=!0,Ne(Y))},n.unstable_forceFrameRate=function(Ee){0>Ee||125<Ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<Ee?Math.floor(1e3/Ee):5},n.unstable_getCurrentPriorityLevel=function(){return w},n.unstable_getFirstCallbackNode=function(){return t(d)},n.unstable_next=function(Ee){switch(w){case 1:case 2:case 3:var ut=3;break;default:ut=w}var ot=w;w=ut;try{return Ee()}finally{w=ot}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ee,ut){switch(Ee){case 1:case 2:case 3:case 4:case 5:break;default:Ee=3}var ot=w;w=Ee;try{return ut()}finally{w=ot}},n.unstable_scheduleCallback=function(Ee,ut,ot){var dt=n.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?dt+ot:dt):ot=dt,Ee){case 1:var Ct=-1;break;case 2:Ct=250;break;case 5:Ct=1073741823;break;case 4:Ct=1e4;break;default:Ct=5e3}return Ct=ot+Ct,Ee={id:g++,callback:ut,priorityLevel:Ee,startTime:ot,expirationTime:Ct,sortIndex:-1},ot>dt?(Ee.sortIndex=ot,e(p,Ee),t(d)===null&&Ee===t(p)&&(L?(C(ce),ce=-1):L=!0,st(H,ot-dt))):(Ee.sortIndex=Ct,e(d,Ee),I||T||(I=!0,Ne(Y))),Ee},n.unstable_shouldYield=pe,n.unstable_wrapCallback=function(Ee){var ut=w;return function(){var ot=w;w=ut;try{return Ee.apply(this,arguments)}finally{w=ot}}}})(uO);cO.exports=uO;var FV=cO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hO=Ht,La=FV;function Ut(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var dO=new Set,Fy={};function Vf(n,e){Wm(n,e),Wm(n+"Capture",e)}function Wm(n,e){for(Fy[n]=e,n=0;n<e.length;n++)dO.add(e[n])}var Vu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),NE=Object.prototype.hasOwnProperty,OV=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,TR={},CR={};function NV(n){return NE.call(CR,n)?!0:NE.call(TR,n)?!1:OV.test(n)?CR[n]=!0:(TR[n]=!0,!1)}function zV(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function BV(n,e,t,i){if(e===null||typeof e>"u"||zV(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ho(n,e,t,i,r,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Xs={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Xs[n]=new Ho(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Xs[e]=new Ho(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Xs[n]=new Ho(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Xs[n]=new Ho(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Xs[n]=new Ho(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Xs[n]=new Ho(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Xs[n]=new Ho(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Xs[n]=new Ho(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Xs[n]=new Ho(n,5,!1,n.toLowerCase(),null,!1,!1)});var cC=/[\-:]([a-z])/g;function uC(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(cC,uC);Xs[e]=new Ho(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(cC,uC);Xs[e]=new Ho(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(cC,uC);Xs[e]=new Ho(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Xs[n]=new Ho(n,1,!1,n.toLowerCase(),null,!1,!1)});Xs.xlinkHref=new Ho("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Xs[n]=new Ho(n,1,!1,n.toLowerCase(),null,!0,!0)});function hC(n,e,t,i){var r=Xs.hasOwnProperty(e)?Xs[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(BV(e,t,r,i)&&(t=null),i||r===null?NV(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var Yu=hO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Fv=Symbol.for("react.element"),sm=Symbol.for("react.portal"),om=Symbol.for("react.fragment"),dC=Symbol.for("react.strict_mode"),zE=Symbol.for("react.profiler"),fO=Symbol.for("react.provider"),pO=Symbol.for("react.context"),fC=Symbol.for("react.forward_ref"),BE=Symbol.for("react.suspense"),UE=Symbol.for("react.suspense_list"),pC=Symbol.for("react.memo"),Vh=Symbol.for("react.lazy"),mO=Symbol.for("react.offscreen"),AR=Symbol.iterator;function S_(n){return n===null||typeof n!="object"?null:(n=AR&&n[AR]||n["@@iterator"],typeof n=="function"?n:null)}var Wr=Object.assign,LS;function Y_(n){if(LS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);LS=e&&e[1]||""}return`
`+LS+n}var DS=!1;function kS(n,e){if(!n||DS)return"";DS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(p){var i=p}Reflect.construct(n,[],e)}else{try{e.call()}catch(p){i=p}n.call(e.prototype)}else{try{throw Error()}catch(p){i=p}n()}}catch(p){if(p&&i&&typeof p.stack=="string"){for(var r=p.stack.split(`
`),s=i.stack.split(`
`),a=r.length-1,o=s.length-1;1<=a&&0<=o&&r[a]!==s[o];)o--;for(;1<=a&&0<=o;a--,o--)if(r[a]!==s[o]){if(a!==1||o!==1)do if(a--,o--,0>o||r[a]!==s[o]){var d=`
`+r[a].replace(" at new "," at ");return n.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",n.displayName)),d}while(1<=a&&0<=o);break}}}finally{DS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Y_(n):""}function UV(n){switch(n.tag){case 5:return Y_(n.type);case 16:return Y_("Lazy");case 13:return Y_("Suspense");case 19:return Y_("SuspenseList");case 0:case 2:case 15:return n=kS(n.type,!1),n;case 11:return n=kS(n.type.render,!1),n;case 1:return n=kS(n.type,!0),n;default:return""}}function VE(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case om:return"Fragment";case sm:return"Portal";case zE:return"Profiler";case dC:return"StrictMode";case BE:return"Suspense";case UE:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case pO:return(n.displayName||"Context")+".Consumer";case fO:return(n._context.displayName||"Context")+".Provider";case fC:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case pC:return e=n.displayName||null,e!==null?e:VE(n.type)||"Memo";case Vh:e=n._payload,n=n._init;try{return VE(n(e))}catch{}}return null}function VV(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return VE(e);case 8:return e===dC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function vd(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function gO(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function GV(n){var e=gO(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(a){i=""+a,s.call(this,a)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(a){i=""+a},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ov(n){n._valueTracker||(n._valueTracker=GV(n))}function _O(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=gO(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function M1(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function GE(n,e){var t=e.checked;return Wr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function IR(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=vd(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function yO(n,e){e=e.checked,e!=null&&hC(n,"checked",e,!1)}function HE(n,e){yO(n,e);var t=vd(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?WE(n,e.type,t):e.hasOwnProperty("defaultValue")&&WE(n,e.type,vd(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function PR(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function WE(n,e,t){(e!=="number"||M1(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var K_=Array.isArray;function Am(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+vd(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function jE(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ut(91));return Wr({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function RR(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ut(92));if(K_(t)){if(1<t.length)throw Error(Ut(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:vd(t)}}function vO(n,e){var t=vd(e.value),i=vd(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function LR(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function xO(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function $E(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?xO(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Nv,wO=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Nv=Nv||document.createElement("div"),Nv.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Nv.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Oy(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var uy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},HV=["Webkit","ms","Moz","O"];Object.keys(uy).forEach(function(n){HV.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),uy[e]=uy[n]})});function bO(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||uy.hasOwnProperty(n)&&uy[n]?(""+e).trim():e+"px"}function SO(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=bO(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var WV=Wr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function qE(n,e){if(e){if(WV[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ut(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ut(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ut(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ut(62))}}function XE(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ZE=null;function mC(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var YE=null,Im=null,Pm=null;function DR(n){if(n=C0(n)){if(typeof YE!="function")throw Error(Ut(280));var e=n.stateNode;e&&(e=Zw(e),YE(n.stateNode,n.type,e))}}function MO(n){Im?Pm?Pm.push(n):Pm=[n]:Im=n}function EO(){if(Im){var n=Im,e=Pm;if(Pm=Im=null,DR(n),e)for(n=0;n<e.length;n++)DR(e[n])}}function TO(n,e){return n(e)}function CO(){}var FS=!1;function AO(n,e,t){if(FS)return n(e,t);FS=!0;try{return TO(n,e,t)}finally{FS=!1,(Im!==null||Pm!==null)&&(CO(),EO())}}function Ny(n,e){var t=n.stateNode;if(t===null)return null;var i=Zw(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ut(231,e,typeof t));return t}var KE=!1;if(Vu)try{var M_={};Object.defineProperty(M_,"passive",{get:function(){KE=!0}}),window.addEventListener("test",M_,M_),window.removeEventListener("test",M_,M_)}catch{KE=!1}function jV(n,e,t,i,r,s,a,o,d){var p=Array.prototype.slice.call(arguments,3);try{e.apply(t,p)}catch(g){this.onError(g)}}var hy=!1,E1=null,T1=!1,JE=null,$V={onError:function(n){hy=!0,E1=n}};function qV(n,e,t,i,r,s,a,o,d){hy=!1,E1=null,jV.apply($V,arguments)}function XV(n,e,t,i,r,s,a,o,d){if(qV.apply(this,arguments),hy){if(hy){var p=E1;hy=!1,E1=null}else throw Error(Ut(198));T1||(T1=!0,JE=p)}}function Gf(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function IO(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function kR(n){if(Gf(n)!==n)throw Error(Ut(188))}function ZV(n){var e=n.alternate;if(!e){if(e=Gf(n),e===null)throw Error(Ut(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return kR(r),n;if(s===i)return kR(r),e;s=s.sibling}throw Error(Ut(188))}if(t.return!==i.return)t=r,i=s;else{for(var a=!1,o=r.child;o;){if(o===t){a=!0,t=r,i=s;break}if(o===i){a=!0,i=r,t=s;break}o=o.sibling}if(!a){for(o=s.child;o;){if(o===t){a=!0,t=s,i=r;break}if(o===i){a=!0,i=s,t=r;break}o=o.sibling}if(!a)throw Error(Ut(189))}}if(t.alternate!==i)throw Error(Ut(190))}if(t.tag!==3)throw Error(Ut(188));return t.stateNode.current===t?n:e}function PO(n){return n=ZV(n),n!==null?RO(n):null}function RO(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=RO(n);if(e!==null)return e;n=n.sibling}return null}var LO=La.unstable_scheduleCallback,FR=La.unstable_cancelCallback,YV=La.unstable_shouldYield,KV=La.unstable_requestPaint,Qr=La.unstable_now,JV=La.unstable_getCurrentPriorityLevel,gC=La.unstable_ImmediatePriority,DO=La.unstable_UserBlockingPriority,C1=La.unstable_NormalPriority,QV=La.unstable_LowPriority,kO=La.unstable_IdlePriority,jw=null,Pc=null;function eG(n){if(Pc&&typeof Pc.onCommitFiberRoot=="function")try{Pc.onCommitFiberRoot(jw,n,void 0,(n.current.flags&128)===128)}catch{}}var kl=Math.clz32?Math.clz32:iG,tG=Math.log,nG=Math.LN2;function iG(n){return n>>>=0,n===0?32:31-(tG(n)/nG|0)|0}var zv=64,Bv=4194304;function J_(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function A1(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,a=t&268435455;if(a!==0){var o=a&~r;o!==0?i=J_(o):(s&=a,s!==0&&(i=J_(s)))}else a=t&~r,a!==0?i=J_(a):s!==0&&(i=J_(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-kl(e),r=1<<t,i|=n[t],e&=~r;return i}function rG(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sG(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var a=31-kl(s),o=1<<a,d=r[a];d===-1?(!(o&t)||o&i)&&(r[a]=rG(o,e)):d<=e&&(n.expiredLanes|=o),s&=~o}}function QE(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function FO(){var n=zv;return zv<<=1,!(zv&4194240)&&(zv=64),n}function OS(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function E0(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-kl(e),n[e]=t}function oG(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-kl(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function _C(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-kl(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var ur=0;function OO(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var NO,yC,zO,BO,UO,eT=!1,Uv=[],rd=null,sd=null,od=null,zy=new Map,By=new Map,jh=[],aG="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function OR(n,e){switch(n){case"focusin":case"focusout":rd=null;break;case"dragenter":case"dragleave":sd=null;break;case"mouseover":case"mouseout":od=null;break;case"pointerover":case"pointerout":zy.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":By.delete(e.pointerId)}}function E_(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=C0(e),e!==null&&yC(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function lG(n,e,t,i,r){switch(e){case"focusin":return rd=E_(rd,n,e,t,i,r),!0;case"dragenter":return sd=E_(sd,n,e,t,i,r),!0;case"mouseover":return od=E_(od,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return zy.set(s,E_(zy.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,By.set(s,E_(By.get(s)||null,n,e,t,i,r)),!0}return!1}function VO(n){var e=yf(n.target);if(e!==null){var t=Gf(e);if(t!==null){if(e=t.tag,e===13){if(e=IO(t),e!==null){n.blockedOn=e,UO(n.priority,function(){zO(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Zx(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=tT(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);ZE=i,t.target.dispatchEvent(i),ZE=null}else return e=C0(t),e!==null&&yC(e),n.blockedOn=t,!1;e.shift()}return!0}function NR(n,e,t){Zx(n)&&t.delete(e)}function cG(){eT=!1,rd!==null&&Zx(rd)&&(rd=null),sd!==null&&Zx(sd)&&(sd=null),od!==null&&Zx(od)&&(od=null),zy.forEach(NR),By.forEach(NR)}function T_(n,e){n.blockedOn===e&&(n.blockedOn=null,eT||(eT=!0,La.unstable_scheduleCallback(La.unstable_NormalPriority,cG)))}function Uy(n){function e(r){return T_(r,n)}if(0<Uv.length){T_(Uv[0],n);for(var t=1;t<Uv.length;t++){var i=Uv[t];i.blockedOn===n&&(i.blockedOn=null)}}for(rd!==null&&T_(rd,n),sd!==null&&T_(sd,n),od!==null&&T_(od,n),zy.forEach(e),By.forEach(e),t=0;t<jh.length;t++)i=jh[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<jh.length&&(t=jh[0],t.blockedOn===null);)VO(t),t.blockedOn===null&&jh.shift()}var Rm=Yu.ReactCurrentBatchConfig,I1=!0;function uG(n,e,t,i){var r=ur,s=Rm.transition;Rm.transition=null;try{ur=1,vC(n,e,t,i)}finally{ur=r,Rm.transition=s}}function hG(n,e,t,i){var r=ur,s=Rm.transition;Rm.transition=null;try{ur=4,vC(n,e,t,i)}finally{ur=r,Rm.transition=s}}function vC(n,e,t,i){if(I1){var r=tT(n,e,t,i);if(r===null)$S(n,e,i,P1,t),OR(n,i);else if(lG(r,n,e,t,i))i.stopPropagation();else if(OR(n,i),e&4&&-1<aG.indexOf(n)){for(;r!==null;){var s=C0(r);if(s!==null&&NO(s),s=tT(n,e,t,i),s===null&&$S(n,e,i,P1,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else $S(n,e,i,null,t)}}var P1=null;function tT(n,e,t,i){if(P1=null,n=mC(i),n=yf(n),n!==null)if(e=Gf(n),e===null)n=null;else if(t=e.tag,t===13){if(n=IO(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return P1=n,null}function GO(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(JV()){case gC:return 1;case DO:return 4;case C1:case QV:return 16;case kO:return 536870912;default:return 16}default:return 16}}var Xh=null,xC=null,Yx=null;function HO(){if(Yx)return Yx;var n,e=xC,t=e.length,i,r="value"in Xh?Xh.value:Xh.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var a=t-n;for(i=1;i<=a&&e[t-i]===r[s-i];i++);return Yx=r.slice(n,1<i?1-i:void 0)}function Kx(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Vv(){return!0}function zR(){return!1}function Na(n){function e(t,i,r,s,a){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Vv:zR,this.isPropagationStopped=zR,this}return Wr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Vv)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Vv)},persist:function(){},isPersistent:Vv}),e}var wg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},wC=Na(wg),T0=Wr({},wg,{view:0,detail:0}),dG=Na(T0),NS,zS,C_,$w=Wr({},T0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:bC,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==C_&&(C_&&n.type==="mousemove"?(NS=n.screenX-C_.screenX,zS=n.screenY-C_.screenY):zS=NS=0,C_=n),NS)},movementY:function(n){return"movementY"in n?n.movementY:zS}}),BR=Na($w),fG=Wr({},$w,{dataTransfer:0}),pG=Na(fG),mG=Wr({},T0,{relatedTarget:0}),BS=Na(mG),gG=Wr({},wg,{animationName:0,elapsedTime:0,pseudoElement:0}),_G=Na(gG),yG=Wr({},wg,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),vG=Na(yG),xG=Wr({},wg,{data:0}),UR=Na(xG),wG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},bG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},SG={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function MG(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=SG[n])?!!e[n]:!1}function bC(){return MG}var EG=Wr({},T0,{key:function(n){if(n.key){var e=wG[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Kx(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?bG[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:bC,charCode:function(n){return n.type==="keypress"?Kx(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Kx(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),TG=Na(EG),CG=Wr({},$w,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),VR=Na(CG),AG=Wr({},T0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:bC}),IG=Na(AG),PG=Wr({},wg,{propertyName:0,elapsedTime:0,pseudoElement:0}),RG=Na(PG),LG=Wr({},$w,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),DG=Na(LG),kG=[9,13,27,32],SC=Vu&&"CompositionEvent"in window,dy=null;Vu&&"documentMode"in document&&(dy=document.documentMode);var FG=Vu&&"TextEvent"in window&&!dy,WO=Vu&&(!SC||dy&&8<dy&&11>=dy),GR=" ",HR=!1;function jO(n,e){switch(n){case"keyup":return kG.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $O(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var am=!1;function OG(n,e){switch(n){case"compositionend":return $O(e);case"keypress":return e.which!==32?null:(HR=!0,GR);case"textInput":return n=e.data,n===GR&&HR?null:n;default:return null}}function NG(n,e){if(am)return n==="compositionend"||!SC&&jO(n,e)?(n=HO(),Yx=xC=Xh=null,am=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return WO&&e.locale!=="ko"?null:e.data;default:return null}}var zG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function WR(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!zG[n.type]:e==="textarea"}function qO(n,e,t,i){MO(i),e=R1(e,"onChange"),0<e.length&&(t=new wC("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var fy=null,Vy=null;function BG(n){rN(n,0)}function qw(n){var e=um(n);if(_O(e))return n}function UG(n,e){if(n==="change")return e}var XO=!1;if(Vu){var US;if(Vu){var VS="oninput"in document;if(!VS){var jR=document.createElement("div");jR.setAttribute("oninput","return;"),VS=typeof jR.oninput=="function"}US=VS}else US=!1;XO=US&&(!document.documentMode||9<document.documentMode)}function $R(){fy&&(fy.detachEvent("onpropertychange",ZO),Vy=fy=null)}function ZO(n){if(n.propertyName==="value"&&qw(Vy)){var e=[];qO(e,Vy,n,mC(n)),AO(BG,e)}}function VG(n,e,t){n==="focusin"?($R(),fy=e,Vy=t,fy.attachEvent("onpropertychange",ZO)):n==="focusout"&&$R()}function GG(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return qw(Vy)}function HG(n,e){if(n==="click")return qw(e)}function WG(n,e){if(n==="input"||n==="change")return qw(e)}function jG(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Vl=typeof Object.is=="function"?Object.is:jG;function Gy(n,e){if(Vl(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!NE.call(e,r)||!Vl(n[r],e[r]))return!1}return!0}function qR(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function XR(n,e){var t=qR(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=qR(t)}}function YO(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?YO(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function KO(){for(var n=window,e=M1();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=M1(n.document)}return e}function MC(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function $G(n){var e=KO(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&YO(t.ownerDocument.documentElement,t)){if(i!==null&&MC(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=XR(t,s);var a=XR(t,i);r&&a&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==a.node||n.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var qG=Vu&&"documentMode"in document&&11>=document.documentMode,lm=null,nT=null,py=null,iT=!1;function ZR(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;iT||lm==null||lm!==M1(i)||(i=lm,"selectionStart"in i&&MC(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),py&&Gy(py,i)||(py=i,i=R1(nT,"onSelect"),0<i.length&&(e=new wC("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=lm)))}function Gv(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var cm={animationend:Gv("Animation","AnimationEnd"),animationiteration:Gv("Animation","AnimationIteration"),animationstart:Gv("Animation","AnimationStart"),transitionend:Gv("Transition","TransitionEnd")},GS={},JO={};Vu&&(JO=document.createElement("div").style,"AnimationEvent"in window||(delete cm.animationend.animation,delete cm.animationiteration.animation,delete cm.animationstart.animation),"TransitionEvent"in window||delete cm.transitionend.transition);function Xw(n){if(GS[n])return GS[n];if(!cm[n])return n;var e=cm[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in JO)return GS[n]=e[t];return n}var QO=Xw("animationend"),eN=Xw("animationiteration"),tN=Xw("animationstart"),nN=Xw("transitionend"),iN=new Map,YR="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ed(n,e){iN.set(n,e),Vf(e,[n])}for(var HS=0;HS<YR.length;HS++){var WS=YR[HS],XG=WS.toLowerCase(),ZG=WS[0].toUpperCase()+WS.slice(1);Ed(XG,"on"+ZG)}Ed(QO,"onAnimationEnd");Ed(eN,"onAnimationIteration");Ed(tN,"onAnimationStart");Ed("dblclick","onDoubleClick");Ed("focusin","onFocus");Ed("focusout","onBlur");Ed(nN,"onTransitionEnd");Wm("onMouseEnter",["mouseout","mouseover"]);Wm("onMouseLeave",["mouseout","mouseover"]);Wm("onPointerEnter",["pointerout","pointerover"]);Wm("onPointerLeave",["pointerout","pointerover"]);Vf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Q_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Q_));function KR(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,XV(i,e,void 0,n),n.currentTarget=null}function rN(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var a=i.length-1;0<=a;a--){var o=i[a],d=o.instance,p=o.currentTarget;if(o=o.listener,d!==s&&r.isPropagationStopped())break e;KR(r,o,p),s=d}else for(a=0;a<i.length;a++){if(o=i[a],d=o.instance,p=o.currentTarget,o=o.listener,d!==s&&r.isPropagationStopped())break e;KR(r,o,p),s=d}}}if(T1)throw n=JE,T1=!1,JE=null,n}function Ar(n,e){var t=e[lT];t===void 0&&(t=e[lT]=new Set);var i=n+"__bubble";t.has(i)||(sN(e,n,2,!1),t.add(i))}function jS(n,e,t){var i=0;e&&(i|=4),sN(t,n,i,e)}var Hv="_reactListening"+Math.random().toString(36).slice(2);function Hy(n){if(!n[Hv]){n[Hv]=!0,dO.forEach(function(t){t!=="selectionchange"&&(YG.has(t)||jS(t,!1,n),jS(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Hv]||(e[Hv]=!0,jS("selectionchange",!1,e))}}function sN(n,e,t,i){switch(GO(e)){case 1:var r=uG;break;case 4:r=hG;break;default:r=vC}t=r.bind(null,e,t,n),r=void 0,!KE||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function $S(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var a=i.tag;if(a===3||a===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(a===4)for(a=i.return;a!==null;){var d=a.tag;if((d===3||d===4)&&(d=a.stateNode.containerInfo,d===r||d.nodeType===8&&d.parentNode===r))return;a=a.return}for(;o!==null;){if(a=yf(o),a===null)return;if(d=a.tag,d===5||d===6){i=s=a;continue e}o=o.parentNode}}i=i.return}AO(function(){var p=s,g=mC(t),_=[];e:{var w=iN.get(n);if(w!==void 0){var T=wC,I=n;switch(n){case"keypress":if(Kx(t)===0)break e;case"keydown":case"keyup":T=TG;break;case"focusin":I="focus",T=BS;break;case"focusout":I="blur",T=BS;break;case"beforeblur":case"afterblur":T=BS;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":T=BR;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":T=pG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":T=IG;break;case QO:case eN:case tN:T=_G;break;case nN:T=RG;break;case"scroll":T=dG;break;case"wheel":T=DG;break;case"copy":case"cut":case"paste":T=vG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":T=VR}var L=(e&4)!==0,P=!L&&n==="scroll",C=L?w!==null?w+"Capture":null:w;L=[];for(var O=p,z;O!==null;){z=O;var H=z.stateNode;if(z.tag===5&&H!==null&&(z=H,C!==null&&(H=Ny(O,C),H!=null&&L.push(Wy(O,H,z)))),P)break;O=O.return}0<L.length&&(w=new T(w,I,null,t,g),_.push({event:w,listeners:L}))}}if(!(e&7)){e:{if(w=n==="mouseover"||n==="pointerover",T=n==="mouseout"||n==="pointerout",w&&t!==ZE&&(I=t.relatedTarget||t.fromElement)&&(yf(I)||I[Gu]))break e;if((T||w)&&(w=g.window===g?g:(w=g.ownerDocument)?w.defaultView||w.parentWindow:window,T?(I=t.relatedTarget||t.toElement,T=p,I=I?yf(I):null,I!==null&&(P=Gf(I),I!==P||I.tag!==5&&I.tag!==6)&&(I=null)):(T=null,I=p),T!==I)){if(L=BR,H="onMouseLeave",C="onMouseEnter",O="mouse",(n==="pointerout"||n==="pointerover")&&(L=VR,H="onPointerLeave",C="onPointerEnter",O="pointer"),P=T==null?w:um(T),z=I==null?w:um(I),w=new L(H,O+"leave",T,t,g),w.target=P,w.relatedTarget=z,H=null,yf(g)===p&&(L=new L(C,O+"enter",I,t,g),L.target=z,L.relatedTarget=P,H=L),P=H,T&&I)t:{for(L=T,C=I,O=0,z=L;z;z=Tp(z))O++;for(z=0,H=C;H;H=Tp(H))z++;for(;0<O-z;)L=Tp(L),O--;for(;0<z-O;)C=Tp(C),z--;for(;O--;){if(L===C||C!==null&&L===C.alternate)break t;L=Tp(L),C=Tp(C)}L=null}else L=null;T!==null&&JR(_,w,T,L,!1),I!==null&&P!==null&&JR(_,P,I,L,!0)}}e:{if(w=p?um(p):window,T=w.nodeName&&w.nodeName.toLowerCase(),T==="select"||T==="input"&&w.type==="file")var Y=UG;else if(WR(w))if(XO)Y=WG;else{Y=GG;var ee=VG}else(T=w.nodeName)&&T.toLowerCase()==="input"&&(w.type==="checkbox"||w.type==="radio")&&(Y=HG);if(Y&&(Y=Y(n,p))){qO(_,Y,t,g);break e}ee&&ee(n,w,p),n==="focusout"&&(ee=w._wrapperState)&&ee.controlled&&w.type==="number"&&WE(w,"number",w.value)}switch(ee=p?um(p):window,n){case"focusin":(WR(ee)||ee.contentEditable==="true")&&(lm=ee,nT=p,py=null);break;case"focusout":py=nT=lm=null;break;case"mousedown":iT=!0;break;case"contextmenu":case"mouseup":case"dragend":iT=!1,ZR(_,t,g);break;case"selectionchange":if(qG)break;case"keydown":case"keyup":ZR(_,t,g)}var te;if(SC)e:{switch(n){case"compositionstart":var ce="onCompositionStart";break e;case"compositionend":ce="onCompositionEnd";break e;case"compositionupdate":ce="onCompositionUpdate";break e}ce=void 0}else am?jO(n,t)&&(ce="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(ce="onCompositionStart");ce&&(WO&&t.locale!=="ko"&&(am||ce!=="onCompositionStart"?ce==="onCompositionEnd"&&am&&(te=HO()):(Xh=g,xC="value"in Xh?Xh.value:Xh.textContent,am=!0)),ee=R1(p,ce),0<ee.length&&(ce=new UR(ce,n,null,t,g),_.push({event:ce,listeners:ee}),te?ce.data=te:(te=$O(t),te!==null&&(ce.data=te)))),(te=FG?OG(n,t):NG(n,t))&&(p=R1(p,"onBeforeInput"),0<p.length&&(g=new UR("onBeforeInput","beforeinput",null,t,g),_.push({event:g,listeners:p}),g.data=te))}rN(_,e)})}function Wy(n,e,t){return{instance:n,listener:e,currentTarget:t}}function R1(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=Ny(n,t),s!=null&&i.unshift(Wy(n,s,r)),s=Ny(n,e),s!=null&&i.push(Wy(n,s,r))),n=n.return}return i}function Tp(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function JR(n,e,t,i,r){for(var s=e._reactName,a=[];t!==null&&t!==i;){var o=t,d=o.alternate,p=o.stateNode;if(d!==null&&d===i)break;o.tag===5&&p!==null&&(o=p,r?(d=Ny(t,s),d!=null&&a.unshift(Wy(t,d,o))):r||(d=Ny(t,s),d!=null&&a.push(Wy(t,d,o)))),t=t.return}a.length!==0&&n.push({event:e,listeners:a})}var KG=/\r\n?/g,JG=/\u0000|\uFFFD/g;function QR(n){return(typeof n=="string"?n:""+n).replace(KG,`
`).replace(JG,"")}function Wv(n,e,t){if(e=QR(e),QR(n)!==e&&t)throw Error(Ut(425))}function L1(){}var rT=null,sT=null;function oT(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var aT=typeof setTimeout=="function"?setTimeout:void 0,QG=typeof clearTimeout=="function"?clearTimeout:void 0,eL=typeof Promise=="function"?Promise:void 0,e8=typeof queueMicrotask=="function"?queueMicrotask:typeof eL<"u"?function(n){return eL.resolve(null).then(n).catch(t8)}:aT;function t8(n){setTimeout(function(){throw n})}function qS(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),Uy(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);Uy(e)}function ad(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function tL(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var bg=Math.random().toString(36).slice(2),bc="__reactFiber$"+bg,jy="__reactProps$"+bg,Gu="__reactContainer$"+bg,lT="__reactEvents$"+bg,n8="__reactListeners$"+bg,i8="__reactHandles$"+bg;function yf(n){var e=n[bc];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Gu]||t[bc]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=tL(n);n!==null;){if(t=n[bc])return t;n=tL(n)}return e}n=t,t=n.parentNode}return null}function C0(n){return n=n[bc]||n[Gu],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function um(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ut(33))}function Zw(n){return n[jy]||null}var cT=[],hm=-1;function Td(n){return{current:n}}function Pr(n){0>hm||(n.current=cT[hm],cT[hm]=null,hm--)}function wr(n,e){hm++,cT[hm]=n.current,n.current=e}var xd={},wo=Td(xd),ia=Td(!1),Rf=xd;function jm(n,e){var t=n.type.contextTypes;if(!t)return xd;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function ra(n){return n=n.childContextTypes,n!=null}function D1(){Pr(ia),Pr(wo)}function nL(n,e,t){if(wo.current!==xd)throw Error(Ut(168));wr(wo,e),wr(ia,t)}function oN(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Ut(108,VV(n)||"Unknown",r));return Wr({},t,i)}function k1(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||xd,Rf=wo.current,wr(wo,n),wr(ia,ia.current),!0}function iL(n,e,t){var i=n.stateNode;if(!i)throw Error(Ut(169));t?(n=oN(n,e,Rf),i.__reactInternalMemoizedMergedChildContext=n,Pr(ia),Pr(wo),wr(wo,n)):Pr(ia),wr(ia,t)}var Tu=null,Yw=!1,XS=!1;function aN(n){Tu===null?Tu=[n]:Tu.push(n)}function r8(n){Yw=!0,aN(n)}function Cd(){if(!XS&&Tu!==null){XS=!0;var n=0,e=ur;try{var t=Tu;for(ur=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Tu=null,Yw=!1}catch(r){throw Tu!==null&&(Tu=Tu.slice(n+1)),LO(gC,Cd),r}finally{ur=e,XS=!1}}return null}var dm=[],fm=0,F1=null,O1=0,Qa=[],el=0,Lf=null,Pu=1,Ru="";function hf(n,e){dm[fm++]=O1,dm[fm++]=F1,F1=n,O1=e}function lN(n,e,t){Qa[el++]=Pu,Qa[el++]=Ru,Qa[el++]=Lf,Lf=n;var i=Pu;n=Ru;var r=32-kl(i)-1;i&=~(1<<r),t+=1;var s=32-kl(e)+r;if(30<s){var a=r-r%5;s=(i&(1<<a)-1).toString(32),i>>=a,r-=a,Pu=1<<32-kl(e)+r|t<<r|i,Ru=s+n}else Pu=1<<s|t<<r|i,Ru=n}function EC(n){n.return!==null&&(hf(n,1),lN(n,1,0))}function TC(n){for(;n===F1;)F1=dm[--fm],dm[fm]=null,O1=dm[--fm],dm[fm]=null;for(;n===Lf;)Lf=Qa[--el],Qa[el]=null,Ru=Qa[--el],Qa[el]=null,Pu=Qa[--el],Qa[el]=null}var Ra=null,Aa=null,Fr=!1,Pl=null;function cN(n,e){var t=rl(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function rL(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Ra=n,Aa=ad(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Ra=n,Aa=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Lf!==null?{id:Pu,overflow:Ru}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=rl(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Ra=n,Aa=null,!0):!1;default:return!1}}function uT(n){return(n.mode&1)!==0&&(n.flags&128)===0}function hT(n){if(Fr){var e=Aa;if(e){var t=e;if(!rL(n,e)){if(uT(n))throw Error(Ut(418));e=ad(t.nextSibling);var i=Ra;e&&rL(n,e)?cN(i,t):(n.flags=n.flags&-4097|2,Fr=!1,Ra=n)}}else{if(uT(n))throw Error(Ut(418));n.flags=n.flags&-4097|2,Fr=!1,Ra=n}}}function sL(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Ra=n}function jv(n){if(n!==Ra)return!1;if(!Fr)return sL(n),Fr=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!oT(n.type,n.memoizedProps)),e&&(e=Aa)){if(uT(n))throw uN(),Error(Ut(418));for(;e;)cN(n,e),e=ad(e.nextSibling)}if(sL(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ut(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Aa=ad(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Aa=null}}else Aa=Ra?ad(n.stateNode.nextSibling):null;return!0}function uN(){for(var n=Aa;n;)n=ad(n.nextSibling)}function $m(){Aa=Ra=null,Fr=!1}function CC(n){Pl===null?Pl=[n]:Pl.push(n)}var s8=Yu.ReactCurrentBatchConfig;function Cl(n,e){if(n&&n.defaultProps){e=Wr({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var N1=Td(null),z1=null,pm=null,AC=null;function IC(){AC=pm=z1=null}function PC(n){var e=N1.current;Pr(N1),n._currentValue=e}function dT(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function Lm(n,e){z1=n,AC=pm=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(ta=!0),n.firstContext=null)}function cl(n){var e=n._currentValue;if(AC!==n)if(n={context:n,memoizedValue:e,next:null},pm===null){if(z1===null)throw Error(Ut(308));pm=n,z1.dependencies={lanes:0,firstContext:n}}else pm=pm.next=n;return e}var vf=null;function RC(n){vf===null?vf=[n]:vf.push(n)}function hN(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,RC(e)):(t.next=r.next,r.next=t),e.interleaved=t,Hu(n,i)}function Hu(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Gh=!1;function LC(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dN(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Fu(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ld(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,zi&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Hu(n,t)}return r=i.interleaved,r===null?(e.next=e,RC(i)):(e.next=r.next,r.next=e),i.interleaved=e,Hu(n,t)}function Jx(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,_C(n,t)}}function oL(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var a={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=a:s=s.next=a,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function B1(n,e,t,i){var r=n.updateQueue;Gh=!1;var s=r.firstBaseUpdate,a=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var d=o,p=d.next;d.next=null,a===null?s=p:a.next=p,a=d;var g=n.alternate;g!==null&&(g=g.updateQueue,o=g.lastBaseUpdate,o!==a&&(o===null?g.firstBaseUpdate=p:o.next=p,g.lastBaseUpdate=d))}if(s!==null){var _=r.baseState;a=0,g=p=d=null,o=s;do{var w=o.lane,T=o.eventTime;if((i&w)===w){g!==null&&(g=g.next={eventTime:T,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var I=n,L=o;switch(w=e,T=t,L.tag){case 1:if(I=L.payload,typeof I=="function"){_=I.call(T,_,w);break e}_=I;break e;case 3:I.flags=I.flags&-65537|128;case 0:if(I=L.payload,w=typeof I=="function"?I.call(T,_,w):I,w==null)break e;_=Wr({},_,w);break e;case 2:Gh=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,w=r.effects,w===null?r.effects=[o]:w.push(o))}else T={eventTime:T,lane:w,tag:o.tag,payload:o.payload,callback:o.callback,next:null},g===null?(p=g=T,d=_):g=g.next=T,a|=w;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;w=o,o=w.next,w.next=null,r.lastBaseUpdate=w,r.shared.pending=null}}while(!0);if(g===null&&(d=_),r.baseState=d,r.firstBaseUpdate=p,r.lastBaseUpdate=g,e=r.shared.interleaved,e!==null){r=e;do a|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);kf|=a,n.lanes=a,n.memoizedState=_}}function aL(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(Ut(191,r));r.call(i)}}}var fN=new hO.Component().refs;function fT(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Wr({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Kw={isMounted:function(n){return(n=n._reactInternals)?Gf(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Uo(),r=ud(n),s=Fu(i,r);s.payload=e,t!=null&&(s.callback=t),e=ld(n,s,r),e!==null&&(Fl(e,n,r,i),Jx(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Uo(),r=ud(n),s=Fu(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=ld(n,s,r),e!==null&&(Fl(e,n,r,i),Jx(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Uo(),i=ud(n),r=Fu(t,i);r.tag=2,e!=null&&(r.callback=e),e=ld(n,r,i),e!==null&&(Fl(e,n,i,t),Jx(e,n,i))}};function lL(n,e,t,i,r,s,a){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,a):e.prototype&&e.prototype.isPureReactComponent?!Gy(t,i)||!Gy(r,s):!0}function pN(n,e,t){var i=!1,r=xd,s=e.contextType;return typeof s=="object"&&s!==null?s=cl(s):(r=ra(e)?Rf:wo.current,i=e.contextTypes,s=(i=i!=null)?jm(n,r):xd),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Kw,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function cL(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&Kw.enqueueReplaceState(e,e.state,null)}function pT(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs=fN,LC(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=cl(s):(s=ra(e)?Rf:wo.current,r.context=jm(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(fT(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Kw.enqueueReplaceState(r,r.state,null),B1(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function A_(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ut(309));var i=t.stateNode}if(!i)throw Error(Ut(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var o=r.refs;o===fN&&(o=r.refs={}),a===null?delete o[s]:o[s]=a},e._stringRef=s,e)}if(typeof n!="string")throw Error(Ut(284));if(!t._owner)throw Error(Ut(290,n))}return n}function $v(n,e){throw n=Object.prototype.toString.call(e),Error(Ut(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function uL(n){var e=n._init;return e(n._payload)}function mN(n){function e(C,O){if(n){var z=C.deletions;z===null?(C.deletions=[O],C.flags|=16):z.push(O)}}function t(C,O){if(!n)return null;for(;O!==null;)e(C,O),O=O.sibling;return null}function i(C,O){for(C=new Map;O!==null;)O.key!==null?C.set(O.key,O):C.set(O.index,O),O=O.sibling;return C}function r(C,O){return C=hd(C,O),C.index=0,C.sibling=null,C}function s(C,O,z){return C.index=z,n?(z=C.alternate,z!==null?(z=z.index,z<O?(C.flags|=2,O):z):(C.flags|=2,O)):(C.flags|=1048576,O)}function a(C){return n&&C.alternate===null&&(C.flags|=2),C}function o(C,O,z,H){return O===null||O.tag!==6?(O=tM(z,C.mode,H),O.return=C,O):(O=r(O,z),O.return=C,O)}function d(C,O,z,H){var Y=z.type;return Y===om?g(C,O,z.props.children,H,z.key):O!==null&&(O.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Vh&&uL(Y)===O.type)?(H=r(O,z.props),H.ref=A_(C,O,z),H.return=C,H):(H=r1(z.type,z.key,z.props,null,C.mode,H),H.ref=A_(C,O,z),H.return=C,H)}function p(C,O,z,H){return O===null||O.tag!==4||O.stateNode.containerInfo!==z.containerInfo||O.stateNode.implementation!==z.implementation?(O=nM(z,C.mode,H),O.return=C,O):(O=r(O,z.children||[]),O.return=C,O)}function g(C,O,z,H,Y){return O===null||O.tag!==7?(O=Cf(z,C.mode,H,Y),O.return=C,O):(O=r(O,z),O.return=C,O)}function _(C,O,z){if(typeof O=="string"&&O!==""||typeof O=="number")return O=tM(""+O,C.mode,z),O.return=C,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case Fv:return z=r1(O.type,O.key,O.props,null,C.mode,z),z.ref=A_(C,null,O),z.return=C,z;case sm:return O=nM(O,C.mode,z),O.return=C,O;case Vh:var H=O._init;return _(C,H(O._payload),z)}if(K_(O)||S_(O))return O=Cf(O,C.mode,z,null),O.return=C,O;$v(C,O)}return null}function w(C,O,z,H){var Y=O!==null?O.key:null;if(typeof z=="string"&&z!==""||typeof z=="number")return Y!==null?null:o(C,O,""+z,H);if(typeof z=="object"&&z!==null){switch(z.$$typeof){case Fv:return z.key===Y?d(C,O,z,H):null;case sm:return z.key===Y?p(C,O,z,H):null;case Vh:return Y=z._init,w(C,O,Y(z._payload),H)}if(K_(z)||S_(z))return Y!==null?null:g(C,O,z,H,null);$v(C,z)}return null}function T(C,O,z,H,Y){if(typeof H=="string"&&H!==""||typeof H=="number")return C=C.get(z)||null,o(O,C,""+H,Y);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case Fv:return C=C.get(H.key===null?z:H.key)||null,d(O,C,H,Y);case sm:return C=C.get(H.key===null?z:H.key)||null,p(O,C,H,Y);case Vh:var ee=H._init;return T(C,O,z,ee(H._payload),Y)}if(K_(H)||S_(H))return C=C.get(z)||null,g(O,C,H,Y,null);$v(O,H)}return null}function I(C,O,z,H){for(var Y=null,ee=null,te=O,ce=O=0,K=null;te!==null&&ce<z.length;ce++){te.index>ce?(K=te,te=null):K=te.sibling;var Q=w(C,te,z[ce],H);if(Q===null){te===null&&(te=K);break}n&&te&&Q.alternate===null&&e(C,te),O=s(Q,O,ce),ee===null?Y=Q:ee.sibling=Q,ee=Q,te=K}if(ce===z.length)return t(C,te),Fr&&hf(C,ce),Y;if(te===null){for(;ce<z.length;ce++)te=_(C,z[ce],H),te!==null&&(O=s(te,O,ce),ee===null?Y=te:ee.sibling=te,ee=te);return Fr&&hf(C,ce),Y}for(te=i(C,te);ce<z.length;ce++)K=T(te,C,ce,z[ce],H),K!==null&&(n&&K.alternate!==null&&te.delete(K.key===null?ce:K.key),O=s(K,O,ce),ee===null?Y=K:ee.sibling=K,ee=K);return n&&te.forEach(function(pe){return e(C,pe)}),Fr&&hf(C,ce),Y}function L(C,O,z,H){var Y=S_(z);if(typeof Y!="function")throw Error(Ut(150));if(z=Y.call(z),z==null)throw Error(Ut(151));for(var ee=Y=null,te=O,ce=O=0,K=null,Q=z.next();te!==null&&!Q.done;ce++,Q=z.next()){te.index>ce?(K=te,te=null):K=te.sibling;var pe=w(C,te,Q.value,H);if(pe===null){te===null&&(te=K);break}n&&te&&pe.alternate===null&&e(C,te),O=s(pe,O,ce),ee===null?Y=pe:ee.sibling=pe,ee=pe,te=K}if(Q.done)return t(C,te),Fr&&hf(C,ce),Y;if(te===null){for(;!Q.done;ce++,Q=z.next())Q=_(C,Q.value,H),Q!==null&&(O=s(Q,O,ce),ee===null?Y=Q:ee.sibling=Q,ee=Q);return Fr&&hf(C,ce),Y}for(te=i(C,te);!Q.done;ce++,Q=z.next())Q=T(te,C,ce,Q.value,H),Q!==null&&(n&&Q.alternate!==null&&te.delete(Q.key===null?ce:Q.key),O=s(Q,O,ce),ee===null?Y=Q:ee.sibling=Q,ee=Q);return n&&te.forEach(function(ze){return e(C,ze)}),Fr&&hf(C,ce),Y}function P(C,O,z,H){if(typeof z=="object"&&z!==null&&z.type===om&&z.key===null&&(z=z.props.children),typeof z=="object"&&z!==null){switch(z.$$typeof){case Fv:e:{for(var Y=z.key,ee=O;ee!==null;){if(ee.key===Y){if(Y=z.type,Y===om){if(ee.tag===7){t(C,ee.sibling),O=r(ee,z.props.children),O.return=C,C=O;break e}}else if(ee.elementType===Y||typeof Y=="object"&&Y!==null&&Y.$$typeof===Vh&&uL(Y)===ee.type){t(C,ee.sibling),O=r(ee,z.props),O.ref=A_(C,ee,z),O.return=C,C=O;break e}t(C,ee);break}else e(C,ee);ee=ee.sibling}z.type===om?(O=Cf(z.props.children,C.mode,H,z.key),O.return=C,C=O):(H=r1(z.type,z.key,z.props,null,C.mode,H),H.ref=A_(C,O,z),H.return=C,C=H)}return a(C);case sm:e:{for(ee=z.key;O!==null;){if(O.key===ee)if(O.tag===4&&O.stateNode.containerInfo===z.containerInfo&&O.stateNode.implementation===z.implementation){t(C,O.sibling),O=r(O,z.children||[]),O.return=C,C=O;break e}else{t(C,O);break}else e(C,O);O=O.sibling}O=nM(z,C.mode,H),O.return=C,C=O}return a(C);case Vh:return ee=z._init,P(C,O,ee(z._payload),H)}if(K_(z))return I(C,O,z,H);if(S_(z))return L(C,O,z,H);$v(C,z)}return typeof z=="string"&&z!==""||typeof z=="number"?(z=""+z,O!==null&&O.tag===6?(t(C,O.sibling),O=r(O,z),O.return=C,C=O):(t(C,O),O=tM(z,C.mode,H),O.return=C,C=O),a(C)):t(C,O)}return P}var qm=mN(!0),gN=mN(!1),A0={},Rc=Td(A0),$y=Td(A0),qy=Td(A0);function xf(n){if(n===A0)throw Error(Ut(174));return n}function DC(n,e){switch(wr(qy,e),wr($y,n),wr(Rc,A0),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:$E(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=$E(e,n)}Pr(Rc),wr(Rc,e)}function Xm(){Pr(Rc),Pr($y),Pr(qy)}function _N(n){xf(qy.current);var e=xf(Rc.current),t=$E(e,n.type);e!==t&&(wr($y,n),wr(Rc,t))}function kC(n){$y.current===n&&(Pr(Rc),Pr($y))}var Vr=Td(0);function U1(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ZS=[];function FC(){for(var n=0;n<ZS.length;n++)ZS[n]._workInProgressVersionPrimary=null;ZS.length=0}var Qx=Yu.ReactCurrentDispatcher,YS=Yu.ReactCurrentBatchConfig,Df=0,Gr=null,fs=null,Ls=null,V1=!1,my=!1,Xy=0,o8=0;function ao(){throw Error(Ut(321))}function OC(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Vl(n[t],e[t]))return!1;return!0}function NC(n,e,t,i,r,s){if(Df=s,Gr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Qx.current=n===null||n.memoizedState===null?u8:h8,n=t(i,r),my){s=0;do{if(my=!1,Xy=0,25<=s)throw Error(Ut(301));s+=1,Ls=fs=null,e.updateQueue=null,Qx.current=d8,n=t(i,r)}while(my)}if(Qx.current=G1,e=fs!==null&&fs.next!==null,Df=0,Ls=fs=Gr=null,V1=!1,e)throw Error(Ut(300));return n}function zC(){var n=Xy!==0;return Xy=0,n}function vc(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ls===null?Gr.memoizedState=Ls=n:Ls=Ls.next=n,Ls}function ul(){if(fs===null){var n=Gr.alternate;n=n!==null?n.memoizedState:null}else n=fs.next;var e=Ls===null?Gr.memoizedState:Ls.next;if(e!==null)Ls=e,fs=n;else{if(n===null)throw Error(Ut(310));fs=n,n={memoizedState:fs.memoizedState,baseState:fs.baseState,baseQueue:fs.baseQueue,queue:fs.queue,next:null},Ls===null?Gr.memoizedState=Ls=n:Ls=Ls.next=n}return Ls}function Zy(n,e){return typeof e=="function"?e(n):e}function KS(n){var e=ul(),t=e.queue;if(t===null)throw Error(Ut(311));t.lastRenderedReducer=n;var i=fs,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var a=r.next;r.next=s.next,s.next=a}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var o=a=null,d=null,p=s;do{var g=p.lane;if((Df&g)===g)d!==null&&(d=d.next={lane:0,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null}),i=p.hasEagerState?p.eagerState:n(i,p.action);else{var _={lane:g,action:p.action,hasEagerState:p.hasEagerState,eagerState:p.eagerState,next:null};d===null?(o=d=_,a=i):d=d.next=_,Gr.lanes|=g,kf|=g}p=p.next}while(p!==null&&p!==s);d===null?a=i:d.next=o,Vl(i,e.memoizedState)||(ta=!0),e.memoizedState=i,e.baseState=a,e.baseQueue=d,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,Gr.lanes|=s,kf|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function JS(n){var e=ul(),t=e.queue;if(t===null)throw Error(Ut(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var a=r=r.next;do s=n(s,a.action),a=a.next;while(a!==r);Vl(s,e.memoizedState)||(ta=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function yN(){}function vN(n,e){var t=Gr,i=ul(),r=e(),s=!Vl(i.memoizedState,r);if(s&&(i.memoizedState=r,ta=!0),i=i.queue,BC(bN.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Ls!==null&&Ls.memoizedState.tag&1){if(t.flags|=2048,Yy(9,wN.bind(null,t,i,r,e),void 0,null),ks===null)throw Error(Ut(349));Df&30||xN(t,e,r)}return r}function xN(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Gr.updateQueue,e===null?(e={lastEffect:null,stores:null},Gr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function wN(n,e,t,i){e.value=t,e.getSnapshot=i,SN(e)&&MN(n)}function bN(n,e,t){return t(function(){SN(e)&&MN(n)})}function SN(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Vl(n,t)}catch{return!0}}function MN(n){var e=Hu(n,1);e!==null&&Fl(e,n,1,-1)}function hL(n){var e=vc();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Zy,lastRenderedState:n},e.queue=n,n=n.dispatch=c8.bind(null,Gr,n),[e.memoizedState,n]}function Yy(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Gr.updateQueue,e===null?(e={lastEffect:null,stores:null},Gr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function EN(){return ul().memoizedState}function e1(n,e,t,i){var r=vc();Gr.flags|=n,r.memoizedState=Yy(1|e,t,void 0,i===void 0?null:i)}function Jw(n,e,t,i){var r=ul();i=i===void 0?null:i;var s=void 0;if(fs!==null){var a=fs.memoizedState;if(s=a.destroy,i!==null&&OC(i,a.deps)){r.memoizedState=Yy(e,t,s,i);return}}Gr.flags|=n,r.memoizedState=Yy(1|e,t,s,i)}function dL(n,e){return e1(8390656,8,n,e)}function BC(n,e){return Jw(2048,8,n,e)}function TN(n,e){return Jw(4,2,n,e)}function CN(n,e){return Jw(4,4,n,e)}function AN(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function IN(n,e,t){return t=t!=null?t.concat([n]):null,Jw(4,4,AN.bind(null,e,n),t)}function UC(){}function PN(n,e){var t=ul();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&OC(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function RN(n,e){var t=ul();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&OC(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function LN(n,e,t){return Df&21?(Vl(t,e)||(t=FO(),Gr.lanes|=t,kf|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,ta=!0),n.memoizedState=t)}function a8(n,e){var t=ur;ur=t!==0&&4>t?t:4,n(!0);var i=YS.transition;YS.transition={};try{n(!1),e()}finally{ur=t,YS.transition=i}}function DN(){return ul().memoizedState}function l8(n,e,t){var i=ud(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},kN(n))FN(e,t);else if(t=hN(n,e,t,i),t!==null){var r=Uo();Fl(t,n,i,r),ON(t,e,i)}}function c8(n,e,t){var i=ud(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(kN(n))FN(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,o=s(a,t);if(r.hasEagerState=!0,r.eagerState=o,Vl(o,a)){var d=e.interleaved;d===null?(r.next=r,RC(e)):(r.next=d.next,d.next=r),e.interleaved=r;return}}catch{}finally{}t=hN(n,e,r,i),t!==null&&(r=Uo(),Fl(t,n,i,r),ON(t,e,i))}}function kN(n){var e=n.alternate;return n===Gr||e!==null&&e===Gr}function FN(n,e){my=V1=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function ON(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,_C(n,t)}}var G1={readContext:cl,useCallback:ao,useContext:ao,useEffect:ao,useImperativeHandle:ao,useInsertionEffect:ao,useLayoutEffect:ao,useMemo:ao,useReducer:ao,useRef:ao,useState:ao,useDebugValue:ao,useDeferredValue:ao,useTransition:ao,useMutableSource:ao,useSyncExternalStore:ao,useId:ao,unstable_isNewReconciler:!1},u8={readContext:cl,useCallback:function(n,e){return vc().memoizedState=[n,e===void 0?null:e],n},useContext:cl,useEffect:dL,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,e1(4194308,4,AN.bind(null,e,n),t)},useLayoutEffect:function(n,e){return e1(4194308,4,n,e)},useInsertionEffect:function(n,e){return e1(4,2,n,e)},useMemo:function(n,e){var t=vc();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=vc();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=l8.bind(null,Gr,n),[i.memoizedState,n]},useRef:function(n){var e=vc();return n={current:n},e.memoizedState=n},useState:hL,useDebugValue:UC,useDeferredValue:function(n){return vc().memoizedState=n},useTransition:function(){var n=hL(!1),e=n[0];return n=a8.bind(null,n[1]),vc().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Gr,r=vc();if(Fr){if(t===void 0)throw Error(Ut(407));t=t()}else{if(t=e(),ks===null)throw Error(Ut(349));Df&30||xN(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,dL(bN.bind(null,i,s,n),[n]),i.flags|=2048,Yy(9,wN.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=vc(),e=ks.identifierPrefix;if(Fr){var t=Ru,i=Pu;t=(i&~(1<<32-kl(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Xy++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=o8++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},h8={readContext:cl,useCallback:PN,useContext:cl,useEffect:BC,useImperativeHandle:IN,useInsertionEffect:TN,useLayoutEffect:CN,useMemo:RN,useReducer:KS,useRef:EN,useState:function(){return KS(Zy)},useDebugValue:UC,useDeferredValue:function(n){var e=ul();return LN(e,fs.memoizedState,n)},useTransition:function(){var n=KS(Zy)[0],e=ul().memoizedState;return[n,e]},useMutableSource:yN,useSyncExternalStore:vN,useId:DN,unstable_isNewReconciler:!1},d8={readContext:cl,useCallback:PN,useContext:cl,useEffect:BC,useImperativeHandle:IN,useInsertionEffect:TN,useLayoutEffect:CN,useMemo:RN,useReducer:JS,useRef:EN,useState:function(){return JS(Zy)},useDebugValue:UC,useDeferredValue:function(n){var e=ul();return fs===null?e.memoizedState=n:LN(e,fs.memoizedState,n)},useTransition:function(){var n=JS(Zy)[0],e=ul().memoizedState;return[n,e]},useMutableSource:yN,useSyncExternalStore:vN,useId:DN,unstable_isNewReconciler:!1};function Zm(n,e){try{var t="",i=e;do t+=UV(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function QS(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function mT(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var f8=typeof WeakMap=="function"?WeakMap:Map;function NN(n,e,t){t=Fu(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){W1||(W1=!0,ET=i),mT(n,e)},t}function zN(n,e,t){t=Fu(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){mT(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){mT(n,e),typeof i!="function"&&(cd===null?cd=new Set([this]):cd.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),t}function fL(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new f8;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=C8.bind(null,n,e,t),e.then(n,n))}function pL(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function mL(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Fu(-1,1),e.tag=2,ld(t,e,1))),t.lanes|=1),n)}var p8=Yu.ReactCurrentOwner,ta=!1;function Fo(n,e,t,i){e.child=n===null?gN(e,null,t,i):qm(e,n.child,t,i)}function gL(n,e,t,i,r){t=t.render;var s=e.ref;return Lm(e,r),i=NC(n,e,t,i,s,r),t=zC(),n!==null&&!ta?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Wu(n,e,r)):(Fr&&t&&EC(e),e.flags|=1,Fo(n,e,i,r),e.child)}function _L(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!XC(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,BN(n,e,s,i,r)):(n=r1(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var a=s.memoizedProps;if(t=t.compare,t=t!==null?t:Gy,t(a,i)&&n.ref===e.ref)return Wu(n,e,r)}return e.flags|=1,n=hd(s,i),n.ref=e.ref,n.return=e,e.child=n}function BN(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(Gy(s,i)&&n.ref===e.ref)if(ta=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(ta=!0);else return e.lanes=n.lanes,Wu(n,e,r)}return gT(n,e,t,i,r)}function UN(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},wr(gm,Ma),Ma|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,wr(gm,Ma),Ma|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,wr(gm,Ma),Ma|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,wr(gm,Ma),Ma|=i;return Fo(n,e,r,t),e.child}function VN(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function gT(n,e,t,i,r){var s=ra(t)?Rf:wo.current;return s=jm(e,s),Lm(e,r),t=NC(n,e,t,i,s,r),i=zC(),n!==null&&!ta?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Wu(n,e,r)):(Fr&&i&&EC(e),e.flags|=1,Fo(n,e,t,r),e.child)}function yL(n,e,t,i,r){if(ra(t)){var s=!0;k1(e)}else s=!1;if(Lm(e,r),e.stateNode===null)t1(n,e),pN(e,t,i),pT(e,t,i,r),i=!0;else if(n===null){var a=e.stateNode,o=e.memoizedProps;a.props=o;var d=a.context,p=t.contextType;typeof p=="object"&&p!==null?p=cl(p):(p=ra(t)?Rf:wo.current,p=jm(e,p));var g=t.getDerivedStateFromProps,_=typeof g=="function"||typeof a.getSnapshotBeforeUpdate=="function";_||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==i||d!==p)&&cL(e,a,i,p),Gh=!1;var w=e.memoizedState;a.state=w,B1(e,i,a,r),d=e.memoizedState,o!==i||w!==d||ia.current||Gh?(typeof g=="function"&&(fT(e,t,g,i),d=e.memoizedState),(o=Gh||lL(e,t,o,i,w,d,p))?(_||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=d),a.props=i,a.state=d,a.context=p,i=o):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{a=e.stateNode,dN(n,e),o=e.memoizedProps,p=e.type===e.elementType?o:Cl(e.type,o),a.props=p,_=e.pendingProps,w=a.context,d=t.contextType,typeof d=="object"&&d!==null?d=cl(d):(d=ra(t)?Rf:wo.current,d=jm(e,d));var T=t.getDerivedStateFromProps;(g=typeof T=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(o!==_||w!==d)&&cL(e,a,i,d),Gh=!1,w=e.memoizedState,a.state=w,B1(e,i,a,r);var I=e.memoizedState;o!==_||w!==I||ia.current||Gh?(typeof T=="function"&&(fT(e,t,T,i),I=e.memoizedState),(p=Gh||lL(e,t,p,i,w,I,d)||!1)?(g||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(i,I,d),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(i,I,d)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&w===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&w===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=I),a.props=i,a.state=I,a.context=d,i=p):(typeof a.componentDidUpdate!="function"||o===n.memoizedProps&&w===n.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&w===n.memoizedState||(e.flags|=1024),i=!1)}return _T(n,e,t,i,s,r)}function _T(n,e,t,i,r,s){VN(n,e);var a=(e.flags&128)!==0;if(!i&&!a)return r&&iL(e,t,!1),Wu(n,e,s);i=e.stateNode,p8.current=e;var o=a&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&a?(e.child=qm(e,n.child,null,s),e.child=qm(e,null,o,s)):Fo(n,e,o,s),e.memoizedState=i.state,r&&iL(e,t,!0),e.child}function GN(n){var e=n.stateNode;e.pendingContext?nL(n,e.pendingContext,e.pendingContext!==e.context):e.context&&nL(n,e.context,!1),DC(n,e.containerInfo)}function vL(n,e,t,i,r){return $m(),CC(r),e.flags|=256,Fo(n,e,t,i),e.child}var yT={dehydrated:null,treeContext:null,retryLane:0};function vT(n){return{baseLanes:n,cachePool:null,transitions:null}}function HN(n,e,t){var i=e.pendingProps,r=Vr.current,s=!1,a=(e.flags&128)!==0,o;if((o=a)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),wr(Vr,r&1),n===null)return hT(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=i.children,n=i.fallback,s?(i=e.mode,s=e.child,a={mode:"hidden",children:a},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=tb(a,i,0,null),n=Cf(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=vT(t),e.memoizedState=yT,n):VC(e,a));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return m8(n,e,a,i,o,r,t);if(s){s=i.fallback,a=e.mode,r=n.child,o=r.sibling;var d={mode:"hidden",children:i.children};return!(a&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=d,e.deletions=null):(i=hd(r,d),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?s=hd(o,s):(s=Cf(s,a,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,a=n.child.memoizedState,a=a===null?vT(t):{baseLanes:a.baseLanes|t,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=n.childLanes&~t,e.memoizedState=yT,i}return s=n.child,n=s.sibling,i=hd(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function VC(n,e){return e=tb({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function qv(n,e,t,i){return i!==null&&CC(i),qm(e,n.child,null,t),n=VC(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function m8(n,e,t,i,r,s,a){if(t)return e.flags&256?(e.flags&=-257,i=QS(Error(Ut(422))),qv(n,e,a,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=tb({mode:"visible",children:i.children},r,0,null),s=Cf(s,r,a,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&qm(e,n.child,null,a),e.child.memoizedState=vT(a),e.memoizedState=yT,s);if(!(e.mode&1))return qv(n,e,a,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,s=Error(Ut(419)),i=QS(s,i,void 0),qv(n,e,a,i)}if(o=(a&n.childLanes)!==0,ta||o){if(i=ks,i!==null){switch(a&-a){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|a)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Hu(n,r),Fl(i,n,r,-1))}return qC(),i=QS(Error(Ut(421))),qv(n,e,a,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=A8.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,Aa=ad(r.nextSibling),Ra=e,Fr=!0,Pl=null,n!==null&&(Qa[el++]=Pu,Qa[el++]=Ru,Qa[el++]=Lf,Pu=n.id,Ru=n.overflow,Lf=e),e=VC(e,i.children),e.flags|=4096,e)}function xL(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),dT(n.return,e,t)}function eM(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function WN(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(Fo(n,e,i.children,t),i=Vr.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&xL(n,t,e);else if(n.tag===19)xL(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(wr(Vr,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&U1(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),eM(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&U1(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}eM(e,!0,t,null,s);break;case"together":eM(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function t1(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Wu(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),kf|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Ut(153));if(e.child!==null){for(n=e.child,t=hd(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=hd(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function g8(n,e,t){switch(e.tag){case 3:GN(e),$m();break;case 5:_N(e);break;case 1:ra(e.type)&&k1(e);break;case 4:DC(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;wr(N1,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(wr(Vr,Vr.current&1),e.flags|=128,null):t&e.child.childLanes?HN(n,e,t):(wr(Vr,Vr.current&1),n=Wu(n,e,t),n!==null?n.sibling:null);wr(Vr,Vr.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return WN(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),wr(Vr,Vr.current),i)break;return null;case 22:case 23:return e.lanes=0,UN(n,e,t)}return Wu(n,e,t)}var jN,xT,$N,qN;jN=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};xT=function(){};$N=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,xf(Rc.current);var s=null;switch(t){case"input":r=GE(n,r),i=GE(n,i),s=[];break;case"select":r=Wr({},r,{value:void 0}),i=Wr({},i,{value:void 0}),s=[];break;case"textarea":r=jE(n,r),i=jE(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=L1)}qE(t,i);var a;t=null;for(p in r)if(!i.hasOwnProperty(p)&&r.hasOwnProperty(p)&&r[p]!=null)if(p==="style"){var o=r[p];for(a in o)o.hasOwnProperty(a)&&(t||(t={}),t[a]="")}else p!=="dangerouslySetInnerHTML"&&p!=="children"&&p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&p!=="autoFocus"&&(Fy.hasOwnProperty(p)?s||(s=[]):(s=s||[]).push(p,null));for(p in i){var d=i[p];if(o=r!=null?r[p]:void 0,i.hasOwnProperty(p)&&d!==o&&(d!=null||o!=null))if(p==="style")if(o){for(a in o)!o.hasOwnProperty(a)||d&&d.hasOwnProperty(a)||(t||(t={}),t[a]="");for(a in d)d.hasOwnProperty(a)&&o[a]!==d[a]&&(t||(t={}),t[a]=d[a])}else t||(s||(s=[]),s.push(p,t)),t=d;else p==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,o=o?o.__html:void 0,d!=null&&o!==d&&(s=s||[]).push(p,d)):p==="children"?typeof d!="string"&&typeof d!="number"||(s=s||[]).push(p,""+d):p!=="suppressContentEditableWarning"&&p!=="suppressHydrationWarning"&&(Fy.hasOwnProperty(p)?(d!=null&&p==="onScroll"&&Ar("scroll",n),s||o===d||(s=[])):(s=s||[]).push(p,d))}t&&(s=s||[]).push("style",t);var p=s;(e.updateQueue=p)&&(e.flags|=4)}};qN=function(n,e,t,i){t!==i&&(e.flags|=4)};function I_(n,e){if(!Fr)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function lo(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function _8(n,e,t){var i=e.pendingProps;switch(TC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return lo(e),null;case 1:return ra(e.type)&&D1(),lo(e),null;case 3:return i=e.stateNode,Xm(),Pr(ia),Pr(wo),FC(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(jv(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pl!==null&&(AT(Pl),Pl=null))),xT(n,e),lo(e),null;case 5:kC(e);var r=xf(qy.current);if(t=e.type,n!==null&&e.stateNode!=null)$N(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ut(166));return lo(e),null}if(n=xf(Rc.current),jv(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[bc]=e,i[jy]=s,n=(e.mode&1)!==0,t){case"dialog":Ar("cancel",i),Ar("close",i);break;case"iframe":case"object":case"embed":Ar("load",i);break;case"video":case"audio":for(r=0;r<Q_.length;r++)Ar(Q_[r],i);break;case"source":Ar("error",i);break;case"img":case"image":case"link":Ar("error",i),Ar("load",i);break;case"details":Ar("toggle",i);break;case"input":IR(i,s),Ar("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Ar("invalid",i);break;case"textarea":RR(i,s),Ar("invalid",i)}qE(t,s),r=null;for(var a in s)if(s.hasOwnProperty(a)){var o=s[a];a==="children"?typeof o=="string"?i.textContent!==o&&(s.suppressHydrationWarning!==!0&&Wv(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(s.suppressHydrationWarning!==!0&&Wv(i.textContent,o,n),r=["children",""+o]):Fy.hasOwnProperty(a)&&o!=null&&a==="onScroll"&&Ar("scroll",i)}switch(t){case"input":Ov(i),PR(i,s,!0);break;case"textarea":Ov(i),LR(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=L1)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{a=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=xO(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=a.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=a.createElement(t,{is:i.is}):(n=a.createElement(t),t==="select"&&(a=n,i.multiple?a.multiple=!0:i.size&&(a.size=i.size))):n=a.createElementNS(n,t),n[bc]=e,n[jy]=i,jN(n,e,!1,!1),e.stateNode=n;e:{switch(a=XE(t,i),t){case"dialog":Ar("cancel",n),Ar("close",n),r=i;break;case"iframe":case"object":case"embed":Ar("load",n),r=i;break;case"video":case"audio":for(r=0;r<Q_.length;r++)Ar(Q_[r],n);r=i;break;case"source":Ar("error",n),r=i;break;case"img":case"image":case"link":Ar("error",n),Ar("load",n),r=i;break;case"details":Ar("toggle",n),r=i;break;case"input":IR(n,i),r=GE(n,i),Ar("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Wr({},i,{value:void 0}),Ar("invalid",n);break;case"textarea":RR(n,i),r=jE(n,i),Ar("invalid",n);break;default:r=i}qE(t,r),o=r;for(s in o)if(o.hasOwnProperty(s)){var d=o[s];s==="style"?SO(n,d):s==="dangerouslySetInnerHTML"?(d=d?d.__html:void 0,d!=null&&wO(n,d)):s==="children"?typeof d=="string"?(t!=="textarea"||d!=="")&&Oy(n,d):typeof d=="number"&&Oy(n,""+d):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Fy.hasOwnProperty(s)?d!=null&&s==="onScroll"&&Ar("scroll",n):d!=null&&hC(n,s,d,a))}switch(t){case"input":Ov(n),PR(n,i,!1);break;case"textarea":Ov(n),LR(n);break;case"option":i.value!=null&&n.setAttribute("value",""+vd(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?Am(n,!!i.multiple,s,!1):i.defaultValue!=null&&Am(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=L1)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return lo(e),null;case 6:if(n&&e.stateNode!=null)qN(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ut(166));if(t=xf(qy.current),xf(Rc.current),jv(e)){if(i=e.stateNode,t=e.memoizedProps,i[bc]=e,(s=i.nodeValue!==t)&&(n=Ra,n!==null))switch(n.tag){case 3:Wv(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Wv(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[bc]=e,e.stateNode=i}return lo(e),null;case 13:if(Pr(Vr),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Fr&&Aa!==null&&e.mode&1&&!(e.flags&128))uN(),$m(),e.flags|=98560,s=!1;else if(s=jv(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(Ut(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ut(317));s[bc]=e}else $m(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;lo(e),s=!1}else Pl!==null&&(AT(Pl),Pl=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Vr.current&1?ps===0&&(ps=3):qC())),e.updateQueue!==null&&(e.flags|=4),lo(e),null);case 4:return Xm(),xT(n,e),n===null&&Hy(e.stateNode.containerInfo),lo(e),null;case 10:return PC(e.type._context),lo(e),null;case 17:return ra(e.type)&&D1(),lo(e),null;case 19:if(Pr(Vr),s=e.memoizedState,s===null)return lo(e),null;if(i=(e.flags&128)!==0,a=s.rendering,a===null)if(i)I_(s,!1);else{if(ps!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(a=U1(n),a!==null){for(e.flags|=128,I_(s,!1),i=a.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,n=a.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return wr(Vr,Vr.current&1|2),e.child}n=n.sibling}s.tail!==null&&Qr()>Ym&&(e.flags|=128,i=!0,I_(s,!1),e.lanes=4194304)}else{if(!i)if(n=U1(a),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),I_(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!Fr)return lo(e),null}else 2*Qr()-s.renderingStartTime>Ym&&t!==1073741824&&(e.flags|=128,i=!0,I_(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(t=s.last,t!==null?t.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Qr(),e.sibling=null,t=Vr.current,wr(Vr,i?t&1|2:t&1),e):(lo(e),null);case 22:case 23:return $C(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Ma&1073741824&&(lo(e),e.subtreeFlags&6&&(e.flags|=8192)):lo(e),null;case 24:return null;case 25:return null}throw Error(Ut(156,e.tag))}function y8(n,e){switch(TC(e),e.tag){case 1:return ra(e.type)&&D1(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return Xm(),Pr(ia),Pr(wo),FC(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return kC(e),null;case 13:if(Pr(Vr),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Ut(340));$m()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Pr(Vr),null;case 4:return Xm(),null;case 10:return PC(e.type._context),null;case 22:case 23:return $C(),null;case 24:return null;default:return null}}var Xv=!1,_o=!1,v8=typeof WeakSet=="function"?WeakSet:Set,Pn=null;function mm(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){qr(n,e,i)}else t.current=null}function wT(n,e,t){try{t()}catch(i){qr(n,e,i)}}var wL=!1;function x8(n,e){if(rT=I1,n=KO(),MC(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var a=0,o=-1,d=-1,p=0,g=0,_=n,w=null;t:for(;;){for(var T;_!==t||r!==0&&_.nodeType!==3||(o=a+r),_!==s||i!==0&&_.nodeType!==3||(d=a+i),_.nodeType===3&&(a+=_.nodeValue.length),(T=_.firstChild)!==null;)w=_,_=T;for(;;){if(_===n)break t;if(w===t&&++p===r&&(o=a),w===s&&++g===i&&(d=a),(T=_.nextSibling)!==null)break;_=w,w=_.parentNode}_=T}t=o===-1||d===-1?null:{start:o,end:d}}else t=null}t=t||{start:0,end:0}}else t=null;for(sT={focusedElem:n,selectionRange:t},I1=!1,Pn=e;Pn!==null;)if(e=Pn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,Pn=n;else for(;Pn!==null;){e=Pn;try{var I=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(I!==null){var L=I.memoizedProps,P=I.memoizedState,C=e.stateNode,O=C.getSnapshotBeforeUpdate(e.elementType===e.type?L:Cl(e.type,L),P);C.__reactInternalSnapshotBeforeUpdate=O}break;case 3:var z=e.stateNode.containerInfo;z.nodeType===1?z.textContent="":z.nodeType===9&&z.documentElement&&z.removeChild(z.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ut(163))}}catch(H){qr(e,e.return,H)}if(n=e.sibling,n!==null){n.return=e.return,Pn=n;break}Pn=e.return}return I=wL,wL=!1,I}function gy(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&wT(e,t,s)}r=r.next}while(r!==i)}}function Qw(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function bT(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function XN(n){var e=n.alternate;e!==null&&(n.alternate=null,XN(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[bc],delete e[jy],delete e[lT],delete e[n8],delete e[i8])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function ZN(n){return n.tag===5||n.tag===3||n.tag===4}function bL(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||ZN(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ST(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=L1));else if(i!==4&&(n=n.child,n!==null))for(ST(n,e,t),n=n.sibling;n!==null;)ST(n,e,t),n=n.sibling}function MT(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(MT(n,e,t),n=n.sibling;n!==null;)MT(n,e,t),n=n.sibling}var Gs=null,Al=!1;function Ch(n,e,t){for(t=t.child;t!==null;)YN(n,e,t),t=t.sibling}function YN(n,e,t){if(Pc&&typeof Pc.onCommitFiberUnmount=="function")try{Pc.onCommitFiberUnmount(jw,t)}catch{}switch(t.tag){case 5:_o||mm(t,e);case 6:var i=Gs,r=Al;Gs=null,Ch(n,e,t),Gs=i,Al=r,Gs!==null&&(Al?(n=Gs,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Gs.removeChild(t.stateNode));break;case 18:Gs!==null&&(Al?(n=Gs,t=t.stateNode,n.nodeType===8?qS(n.parentNode,t):n.nodeType===1&&qS(n,t),Uy(n)):qS(Gs,t.stateNode));break;case 4:i=Gs,r=Al,Gs=t.stateNode.containerInfo,Al=!0,Ch(n,e,t),Gs=i,Al=r;break;case 0:case 11:case 14:case 15:if(!_o&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&wT(t,e,a),r=r.next}while(r!==i)}Ch(n,e,t);break;case 1:if(!_o&&(mm(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){qr(t,e,o)}Ch(n,e,t);break;case 21:Ch(n,e,t);break;case 22:t.mode&1?(_o=(i=_o)||t.memoizedState!==null,Ch(n,e,t),_o=i):Ch(n,e,t);break;default:Ch(n,e,t)}}function SL(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new v8),e.forEach(function(i){var r=I8.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function wl(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,a=e,o=a;e:for(;o!==null;){switch(o.tag){case 5:Gs=o.stateNode,Al=!1;break e;case 3:Gs=o.stateNode.containerInfo,Al=!0;break e;case 4:Gs=o.stateNode.containerInfo,Al=!0;break e}o=o.return}if(Gs===null)throw Error(Ut(160));YN(s,a,r),Gs=null,Al=!1;var d=r.alternate;d!==null&&(d.return=null),r.return=null}catch(p){qr(r,e,p)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)KN(e,n),e=e.sibling}function KN(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(wl(e,n),_c(n),i&4){try{gy(3,n,n.return),Qw(3,n)}catch(L){qr(n,n.return,L)}try{gy(5,n,n.return)}catch(L){qr(n,n.return,L)}}break;case 1:wl(e,n),_c(n),i&512&&t!==null&&mm(t,t.return);break;case 5:if(wl(e,n),_c(n),i&512&&t!==null&&mm(t,t.return),n.flags&32){var r=n.stateNode;try{Oy(r,"")}catch(L){qr(n,n.return,L)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,a=t!==null?t.memoizedProps:s,o=n.type,d=n.updateQueue;if(n.updateQueue=null,d!==null)try{o==="input"&&s.type==="radio"&&s.name!=null&&yO(r,s),XE(o,a);var p=XE(o,s);for(a=0;a<d.length;a+=2){var g=d[a],_=d[a+1];g==="style"?SO(r,_):g==="dangerouslySetInnerHTML"?wO(r,_):g==="children"?Oy(r,_):hC(r,g,_,p)}switch(o){case"input":HE(r,s);break;case"textarea":vO(r,s);break;case"select":var w=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var T=s.value;T!=null?Am(r,!!s.multiple,T,!1):w!==!!s.multiple&&(s.defaultValue!=null?Am(r,!!s.multiple,s.defaultValue,!0):Am(r,!!s.multiple,s.multiple?[]:"",!1))}r[jy]=s}catch(L){qr(n,n.return,L)}}break;case 6:if(wl(e,n),_c(n),i&4){if(n.stateNode===null)throw Error(Ut(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(L){qr(n,n.return,L)}}break;case 3:if(wl(e,n),_c(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Uy(e.containerInfo)}catch(L){qr(n,n.return,L)}break;case 4:wl(e,n),_c(n);break;case 13:wl(e,n),_c(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(WC=Qr())),i&4&&SL(n);break;case 22:if(g=t!==null&&t.memoizedState!==null,n.mode&1?(_o=(p=_o)||g,wl(e,n),_o=p):wl(e,n),_c(n),i&8192){if(p=n.memoizedState!==null,(n.stateNode.isHidden=p)&&!g&&n.mode&1)for(Pn=n,g=n.child;g!==null;){for(_=Pn=g;Pn!==null;){switch(w=Pn,T=w.child,w.tag){case 0:case 11:case 14:case 15:gy(4,w,w.return);break;case 1:mm(w,w.return);var I=w.stateNode;if(typeof I.componentWillUnmount=="function"){i=w,t=w.return;try{e=i,I.props=e.memoizedProps,I.state=e.memoizedState,I.componentWillUnmount()}catch(L){qr(i,t,L)}}break;case 5:mm(w,w.return);break;case 22:if(w.memoizedState!==null){EL(_);continue}}T!==null?(T.return=w,Pn=T):EL(_)}g=g.sibling}e:for(g=null,_=n;;){if(_.tag===5){if(g===null){g=_;try{r=_.stateNode,p?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(o=_.stateNode,d=_.memoizedProps.style,a=d!=null&&d.hasOwnProperty("display")?d.display:null,o.style.display=bO("display",a))}catch(L){qr(n,n.return,L)}}}else if(_.tag===6){if(g===null)try{_.stateNode.nodeValue=p?"":_.memoizedProps}catch(L){qr(n,n.return,L)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===n)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===n)break e;for(;_.sibling===null;){if(_.return===null||_.return===n)break e;g===_&&(g=null),_=_.return}g===_&&(g=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:wl(e,n),_c(n),i&4&&SL(n);break;case 21:break;default:wl(e,n),_c(n)}}function _c(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(ZN(t)){var i=t;break e}t=t.return}throw Error(Ut(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(Oy(r,""),i.flags&=-33);var s=bL(n);MT(n,s,r);break;case 3:case 4:var a=i.stateNode.containerInfo,o=bL(n);ST(n,o,a);break;default:throw Error(Ut(161))}}catch(d){qr(n,n.return,d)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function w8(n,e,t){Pn=n,JN(n)}function JN(n,e,t){for(var i=(n.mode&1)!==0;Pn!==null;){var r=Pn,s=r.child;if(r.tag===22&&i){var a=r.memoizedState!==null||Xv;if(!a){var o=r.alternate,d=o!==null&&o.memoizedState!==null||_o;o=Xv;var p=_o;if(Xv=a,(_o=d)&&!p)for(Pn=r;Pn!==null;)a=Pn,d=a.child,a.tag===22&&a.memoizedState!==null?TL(r):d!==null?(d.return=a,Pn=d):TL(r);for(;s!==null;)Pn=s,JN(s),s=s.sibling;Pn=r,Xv=o,_o=p}ML(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,Pn=s):ML(n)}}function ML(n){for(;Pn!==null;){var e=Pn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:_o||Qw(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!_o)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Cl(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&aL(e,s,i);break;case 3:var a=e.updateQueue;if(a!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}aL(e,a,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var d=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":d.autoFocus&&t.focus();break;case"img":d.src&&(t.src=d.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var p=e.alternate;if(p!==null){var g=p.memoizedState;if(g!==null){var _=g.dehydrated;_!==null&&Uy(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ut(163))}_o||e.flags&512&&bT(e)}catch(w){qr(e,e.return,w)}}if(e===n){Pn=null;break}if(t=e.sibling,t!==null){t.return=e.return,Pn=t;break}Pn=e.return}}function EL(n){for(;Pn!==null;){var e=Pn;if(e===n){Pn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,Pn=t;break}Pn=e.return}}function TL(n){for(;Pn!==null;){var e=Pn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Qw(4,e)}catch(d){qr(e,t,d)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(d){qr(e,r,d)}}var s=e.return;try{bT(e)}catch(d){qr(e,s,d)}break;case 5:var a=e.return;try{bT(e)}catch(d){qr(e,a,d)}}}catch(d){qr(e,e.return,d)}if(e===n){Pn=null;break}var o=e.sibling;if(o!==null){o.return=e.return,Pn=o;break}Pn=e.return}}var b8=Math.ceil,H1=Yu.ReactCurrentDispatcher,GC=Yu.ReactCurrentOwner,al=Yu.ReactCurrentBatchConfig,zi=0,ks=null,as=null,qs=0,Ma=0,gm=Td(0),ps=0,Ky=null,kf=0,eb=0,HC=0,_y=null,Ko=null,WC=0,Ym=1/0,Su=null,W1=!1,ET=null,cd=null,Zv=!1,Zh=null,j1=0,yy=0,TT=null,n1=-1,i1=0;function Uo(){return zi&6?Qr():n1!==-1?n1:n1=Qr()}function ud(n){return n.mode&1?zi&2&&qs!==0?qs&-qs:s8.transition!==null?(i1===0&&(i1=FO()),i1):(n=ur,n!==0||(n=window.event,n=n===void 0?16:GO(n.type)),n):1}function Fl(n,e,t,i){if(50<yy)throw yy=0,TT=null,Error(Ut(185));E0(n,t,i),(!(zi&2)||n!==ks)&&(n===ks&&(!(zi&2)&&(eb|=t),ps===4&&$h(n,qs)),sa(n,i),t===1&&zi===0&&!(e.mode&1)&&(Ym=Qr()+500,Yw&&Cd()))}function sa(n,e){var t=n.callbackNode;sG(n,e);var i=A1(n,n===ks?qs:0);if(i===0)t!==null&&FR(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&FR(t),e===1)n.tag===0?r8(CL.bind(null,n)):aN(CL.bind(null,n)),e8(function(){!(zi&6)&&Cd()}),t=null;else{switch(OO(i)){case 1:t=gC;break;case 4:t=DO;break;case 16:t=C1;break;case 536870912:t=kO;break;default:t=C1}t=oz(t,QN.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function QN(n,e){if(n1=-1,i1=0,zi&6)throw Error(Ut(327));var t=n.callbackNode;if(Dm()&&n.callbackNode!==t)return null;var i=A1(n,n===ks?qs:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=$1(n,i);else{e=i;var r=zi;zi|=2;var s=tz();(ks!==n||qs!==e)&&(Su=null,Ym=Qr()+500,Tf(n,e));do try{E8();break}catch(o){ez(n,o)}while(!0);IC(),H1.current=s,zi=r,as!==null?e=0:(ks=null,qs=0,e=ps)}if(e!==0){if(e===2&&(r=QE(n),r!==0&&(i=r,e=CT(n,r))),e===1)throw t=Ky,Tf(n,0),$h(n,i),sa(n,Qr()),t;if(e===6)$h(n,i);else{if(r=n.current.alternate,!(i&30)&&!S8(r)&&(e=$1(n,i),e===2&&(s=QE(n),s!==0&&(i=s,e=CT(n,s))),e===1))throw t=Ky,Tf(n,0),$h(n,i),sa(n,Qr()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(Ut(345));case 2:df(n,Ko,Su);break;case 3:if($h(n,i),(i&130023424)===i&&(e=WC+500-Qr(),10<e)){if(A1(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){Uo(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=aT(df.bind(null,n,Ko,Su),e);break}df(n,Ko,Su);break;case 4:if($h(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var a=31-kl(i);s=1<<a,a=e[a],a>r&&(r=a),i&=~s}if(i=r,i=Qr()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*b8(i/1960))-i,10<i){n.timeoutHandle=aT(df.bind(null,n,Ko,Su),i);break}df(n,Ko,Su);break;case 5:df(n,Ko,Su);break;default:throw Error(Ut(329))}}}return sa(n,Qr()),n.callbackNode===t?QN.bind(null,n):null}function CT(n,e){var t=_y;return n.current.memoizedState.isDehydrated&&(Tf(n,e).flags|=256),n=$1(n,e),n!==2&&(e=Ko,Ko=t,e!==null&&AT(e)),n}function AT(n){Ko===null?Ko=n:Ko.push.apply(Ko,n)}function S8(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!Vl(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function $h(n,e){for(e&=~HC,e&=~eb,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-kl(e),i=1<<t;n[t]=-1,e&=~i}}function CL(n){if(zi&6)throw Error(Ut(327));Dm();var e=A1(n,0);if(!(e&1))return sa(n,Qr()),null;var t=$1(n,e);if(n.tag!==0&&t===2){var i=QE(n);i!==0&&(e=i,t=CT(n,i))}if(t===1)throw t=Ky,Tf(n,0),$h(n,e),sa(n,Qr()),t;if(t===6)throw Error(Ut(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,df(n,Ko,Su),sa(n,Qr()),null}function jC(n,e){var t=zi;zi|=1;try{return n(e)}finally{zi=t,zi===0&&(Ym=Qr()+500,Yw&&Cd())}}function Ff(n){Zh!==null&&Zh.tag===0&&!(zi&6)&&Dm();var e=zi;zi|=1;var t=al.transition,i=ur;try{if(al.transition=null,ur=1,n)return n()}finally{ur=i,al.transition=t,zi=e,!(zi&6)&&Cd()}}function $C(){Ma=gm.current,Pr(gm)}function Tf(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,QG(t)),as!==null)for(t=as.return;t!==null;){var i=t;switch(TC(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&D1();break;case 3:Xm(),Pr(ia),Pr(wo),FC();break;case 5:kC(i);break;case 4:Xm();break;case 13:Pr(Vr);break;case 19:Pr(Vr);break;case 10:PC(i.type._context);break;case 22:case 23:$C()}t=t.return}if(ks=n,as=n=hd(n.current,null),qs=Ma=e,ps=0,Ky=null,HC=eb=kf=0,Ko=_y=null,vf!==null){for(e=0;e<vf.length;e++)if(t=vf[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var a=s.next;s.next=r,i.next=a}t.pending=i}vf=null}return n}function ez(n,e){do{var t=as;try{if(IC(),Qx.current=G1,V1){for(var i=Gr.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}V1=!1}if(Df=0,Ls=fs=Gr=null,my=!1,Xy=0,GC.current=null,t===null||t.return===null){ps=1,Ky=e,as=null;break}e:{var s=n,a=t.return,o=t,d=e;if(e=qs,o.flags|=32768,d!==null&&typeof d=="object"&&typeof d.then=="function"){var p=d,g=o,_=g.tag;if(!(g.mode&1)&&(_===0||_===11||_===15)){var w=g.alternate;w?(g.updateQueue=w.updateQueue,g.memoizedState=w.memoizedState,g.lanes=w.lanes):(g.updateQueue=null,g.memoizedState=null)}var T=pL(a);if(T!==null){T.flags&=-257,mL(T,a,o,s,e),T.mode&1&&fL(s,p,e),e=T,d=p;var I=e.updateQueue;if(I===null){var L=new Set;L.add(d),e.updateQueue=L}else I.add(d);break e}else{if(!(e&1)){fL(s,p,e),qC();break e}d=Error(Ut(426))}}else if(Fr&&o.mode&1){var P=pL(a);if(P!==null){!(P.flags&65536)&&(P.flags|=256),mL(P,a,o,s,e),CC(Zm(d,o));break e}}s=d=Zm(d,o),ps!==4&&(ps=2),_y===null?_y=[s]:_y.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var C=NN(s,d,e);oL(s,C);break e;case 1:o=d;var O=s.type,z=s.stateNode;if(!(s.flags&128)&&(typeof O.getDerivedStateFromError=="function"||z!==null&&typeof z.componentDidCatch=="function"&&(cd===null||!cd.has(z)))){s.flags|=65536,e&=-e,s.lanes|=e;var H=zN(s,o,e);oL(s,H);break e}}s=s.return}while(s!==null)}iz(t)}catch(Y){e=Y,as===t&&t!==null&&(as=t=t.return);continue}break}while(!0)}function tz(){var n=H1.current;return H1.current=G1,n===null?G1:n}function qC(){(ps===0||ps===3||ps===2)&&(ps=4),ks===null||!(kf&268435455)&&!(eb&268435455)||$h(ks,qs)}function $1(n,e){var t=zi;zi|=2;var i=tz();(ks!==n||qs!==e)&&(Su=null,Tf(n,e));do try{M8();break}catch(r){ez(n,r)}while(!0);if(IC(),zi=t,H1.current=i,as!==null)throw Error(Ut(261));return ks=null,qs=0,ps}function M8(){for(;as!==null;)nz(as)}function E8(){for(;as!==null&&!YV();)nz(as)}function nz(n){var e=sz(n.alternate,n,Ma);n.memoizedProps=n.pendingProps,e===null?iz(n):as=e,GC.current=null}function iz(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=y8(t,e),t!==null){t.flags&=32767,as=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{ps=6,as=null;return}}else if(t=_8(t,e,Ma),t!==null){as=t;return}if(e=e.sibling,e!==null){as=e;return}as=e=n}while(e!==null);ps===0&&(ps=5)}function df(n,e,t){var i=ur,r=al.transition;try{al.transition=null,ur=1,T8(n,e,t,i)}finally{al.transition=r,ur=i}return null}function T8(n,e,t,i){do Dm();while(Zh!==null);if(zi&6)throw Error(Ut(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ut(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(oG(n,s),n===ks&&(as=ks=null,qs=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Zv||(Zv=!0,oz(C1,function(){return Dm(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=al.transition,al.transition=null;var a=ur;ur=1;var o=zi;zi|=4,GC.current=null,x8(n,t),KN(t,n),$G(sT),I1=!!rT,sT=rT=null,n.current=t,w8(t),KV(),zi=o,ur=a,al.transition=s}else n.current=t;if(Zv&&(Zv=!1,Zh=n,j1=r),s=n.pendingLanes,s===0&&(cd=null),eG(t.stateNode),sa(n,Qr()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(W1)throw W1=!1,n=ET,ET=null,n;return j1&1&&n.tag!==0&&Dm(),s=n.pendingLanes,s&1?n===TT?yy++:(yy=0,TT=n):yy=0,Cd(),null}function Dm(){if(Zh!==null){var n=OO(j1),e=al.transition,t=ur;try{if(al.transition=null,ur=16>n?16:n,Zh===null)var i=!1;else{if(n=Zh,Zh=null,j1=0,zi&6)throw Error(Ut(331));var r=zi;for(zi|=4,Pn=n.current;Pn!==null;){var s=Pn,a=s.child;if(Pn.flags&16){var o=s.deletions;if(o!==null){for(var d=0;d<o.length;d++){var p=o[d];for(Pn=p;Pn!==null;){var g=Pn;switch(g.tag){case 0:case 11:case 15:gy(8,g,s)}var _=g.child;if(_!==null)_.return=g,Pn=_;else for(;Pn!==null;){g=Pn;var w=g.sibling,T=g.return;if(XN(g),g===p){Pn=null;break}if(w!==null){w.return=T,Pn=w;break}Pn=T}}}var I=s.alternate;if(I!==null){var L=I.child;if(L!==null){I.child=null;do{var P=L.sibling;L.sibling=null,L=P}while(L!==null)}}Pn=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,Pn=a;else e:for(;Pn!==null;){if(s=Pn,s.flags&2048)switch(s.tag){case 0:case 11:case 15:gy(9,s,s.return)}var C=s.sibling;if(C!==null){C.return=s.return,Pn=C;break e}Pn=s.return}}var O=n.current;for(Pn=O;Pn!==null;){a=Pn;var z=a.child;if(a.subtreeFlags&2064&&z!==null)z.return=a,Pn=z;else e:for(a=O;Pn!==null;){if(o=Pn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Qw(9,o)}}catch(Y){qr(o,o.return,Y)}if(o===a){Pn=null;break e}var H=o.sibling;if(H!==null){H.return=o.return,Pn=H;break e}Pn=o.return}}if(zi=r,Cd(),Pc&&typeof Pc.onPostCommitFiberRoot=="function")try{Pc.onPostCommitFiberRoot(jw,n)}catch{}i=!0}return i}finally{ur=t,al.transition=e}}return!1}function AL(n,e,t){e=Zm(t,e),e=NN(n,e,1),n=ld(n,e,1),e=Uo(),n!==null&&(E0(n,1,e),sa(n,e))}function qr(n,e,t){if(n.tag===3)AL(n,n,t);else for(;e!==null;){if(e.tag===3){AL(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(cd===null||!cd.has(i))){n=Zm(t,n),n=zN(e,n,1),e=ld(e,n,1),n=Uo(),e!==null&&(E0(e,1,n),sa(e,n));break}}e=e.return}}function C8(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Uo(),n.pingedLanes|=n.suspendedLanes&t,ks===n&&(qs&t)===t&&(ps===4||ps===3&&(qs&130023424)===qs&&500>Qr()-WC?Tf(n,0):HC|=t),sa(n,e)}function rz(n,e){e===0&&(n.mode&1?(e=Bv,Bv<<=1,!(Bv&130023424)&&(Bv=4194304)):e=1);var t=Uo();n=Hu(n,e),n!==null&&(E0(n,e,t),sa(n,t))}function A8(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),rz(n,t)}function I8(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Ut(314))}i!==null&&i.delete(e),rz(n,t)}var sz;sz=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||ia.current)ta=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return ta=!1,g8(n,e,t);ta=!!(n.flags&131072)}else ta=!1,Fr&&e.flags&1048576&&lN(e,O1,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;t1(n,e),n=e.pendingProps;var r=jm(e,wo.current);Lm(e,t),r=NC(null,e,i,n,r,t);var s=zC();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ra(i)?(s=!0,k1(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,LC(e),r.updater=Kw,e.stateNode=r,r._reactInternals=e,pT(e,i,n,t),e=_T(null,e,i,!0,s,t)):(e.tag=0,Fr&&s&&EC(e),Fo(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(t1(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=R8(i),n=Cl(i,n),r){case 0:e=gT(null,e,i,n,t);break e;case 1:e=yL(null,e,i,n,t);break e;case 11:e=gL(null,e,i,n,t);break e;case 14:e=_L(null,e,i,Cl(i.type,n),t);break e}throw Error(Ut(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Cl(i,r),gT(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Cl(i,r),yL(n,e,i,r,t);case 3:e:{if(GN(e),n===null)throw Error(Ut(387));i=e.pendingProps,s=e.memoizedState,r=s.element,dN(n,e),B1(e,i,null,t);var a=e.memoizedState;if(i=a.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=Zm(Error(Ut(423)),e),e=vL(n,e,i,t,r);break e}else if(i!==r){r=Zm(Error(Ut(424)),e),e=vL(n,e,i,t,r);break e}else for(Aa=ad(e.stateNode.containerInfo.firstChild),Ra=e,Fr=!0,Pl=null,t=gN(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if($m(),i===r){e=Wu(n,e,t);break e}Fo(n,e,i,t)}e=e.child}return e;case 5:return _N(e),n===null&&hT(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,a=r.children,oT(i,r)?a=null:s!==null&&oT(i,s)&&(e.flags|=32),VN(n,e),Fo(n,e,a,t),e.child;case 6:return n===null&&hT(e),null;case 13:return HN(n,e,t);case 4:return DC(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=qm(e,null,i,t):Fo(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Cl(i,r),gL(n,e,i,r,t);case 7:return Fo(n,e,e.pendingProps,t),e.child;case 8:return Fo(n,e,e.pendingProps.children,t),e.child;case 12:return Fo(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,a=r.value,wr(N1,i._currentValue),i._currentValue=a,s!==null)if(Vl(s.value,a)){if(s.children===r.children&&!ia.current){e=Wu(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var o=s.dependencies;if(o!==null){a=s.child;for(var d=o.firstContext;d!==null;){if(d.context===i){if(s.tag===1){d=Fu(-1,t&-t),d.tag=2;var p=s.updateQueue;if(p!==null){p=p.shared;var g=p.pending;g===null?d.next=d:(d.next=g.next,g.next=d),p.pending=d}}s.lanes|=t,d=s.alternate,d!==null&&(d.lanes|=t),dT(s.return,t,e),o.lanes|=t;break}d=d.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(Ut(341));a.lanes|=t,o=a.alternate,o!==null&&(o.lanes|=t),dT(a,t,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}Fo(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,Lm(e,t),r=cl(r),i=i(r),e.flags|=1,Fo(n,e,i,t),e.child;case 14:return i=e.type,r=Cl(i,e.pendingProps),r=Cl(i.type,r),_L(n,e,i,r,t);case 15:return BN(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Cl(i,r),t1(n,e),e.tag=1,ra(i)?(n=!0,k1(e)):n=!1,Lm(e,t),pN(e,i,r),pT(e,i,r,t),_T(null,e,i,!0,n,t);case 19:return WN(n,e,t);case 22:return UN(n,e,t)}throw Error(Ut(156,e.tag))};function oz(n,e){return LO(n,e)}function P8(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function rl(n,e,t,i){return new P8(n,e,t,i)}function XC(n){return n=n.prototype,!(!n||!n.isReactComponent)}function R8(n){if(typeof n=="function")return XC(n)?1:0;if(n!=null){if(n=n.$$typeof,n===fC)return 11;if(n===pC)return 14}return 2}function hd(n,e){var t=n.alternate;return t===null?(t=rl(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function r1(n,e,t,i,r,s){var a=2;if(i=n,typeof n=="function")XC(n)&&(a=1);else if(typeof n=="string")a=5;else e:switch(n){case om:return Cf(t.children,r,s,e);case dC:a=8,r|=8;break;case zE:return n=rl(12,t,e,r|2),n.elementType=zE,n.lanes=s,n;case BE:return n=rl(13,t,e,r),n.elementType=BE,n.lanes=s,n;case UE:return n=rl(19,t,e,r),n.elementType=UE,n.lanes=s,n;case mO:return tb(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case fO:a=10;break e;case pO:a=9;break e;case fC:a=11;break e;case pC:a=14;break e;case Vh:a=16,i=null;break e}throw Error(Ut(130,n==null?n:typeof n,""))}return e=rl(a,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Cf(n,e,t,i){return n=rl(7,n,i,e),n.lanes=t,n}function tb(n,e,t,i){return n=rl(22,n,i,e),n.elementType=mO,n.lanes=t,n.stateNode={isHidden:!1},n}function tM(n,e,t){return n=rl(6,n,null,e),n.lanes=t,n}function nM(n,e,t){return e=rl(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function L8(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=OS(0),this.expirationTimes=OS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=OS(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function ZC(n,e,t,i,r,s,a,o,d){return n=new L8(n,e,t,o,d),e===1?(e=1,s===!0&&(e|=8)):e=0,s=rl(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},LC(s),n}function D8(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sm,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function az(n){if(!n)return xd;n=n._reactInternals;e:{if(Gf(n)!==n||n.tag!==1)throw Error(Ut(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ra(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ut(171))}if(n.tag===1){var t=n.type;if(ra(t))return oN(n,t,e)}return e}function lz(n,e,t,i,r,s,a,o,d){return n=ZC(t,i,!0,n,r,s,a,o,d),n.context=az(null),t=n.current,i=Uo(),r=ud(t),s=Fu(i,r),s.callback=e??null,ld(t,s,r),n.current.lanes=r,E0(n,r,i),sa(n,i),n}function nb(n,e,t,i){var r=e.current,s=Uo(),a=ud(r);return t=az(t),e.context===null?e.context=t:e.pendingContext=t,e=Fu(s,a),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=ld(r,e,a),n!==null&&(Fl(n,r,a,s),Jx(n,r,a)),a}function q1(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function IL(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function YC(n,e){IL(n,e),(n=n.alternate)&&IL(n,e)}function k8(){return null}var cz=typeof reportError=="function"?reportError:function(n){console.error(n)};function KC(n){this._internalRoot=n}ib.prototype.render=KC.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Ut(409));nb(n,e,null,null)};ib.prototype.unmount=KC.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Ff(function(){nb(null,n,null,null)}),e[Gu]=null}};function ib(n){this._internalRoot=n}ib.prototype.unstable_scheduleHydration=function(n){if(n){var e=BO();n={blockedOn:null,target:n,priority:e};for(var t=0;t<jh.length&&e!==0&&e<jh[t].priority;t++);jh.splice(t,0,n),t===0&&VO(n)}};function JC(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function rb(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function PL(){}function F8(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var p=q1(a);s.call(p)}}var a=lz(e,i,n,0,null,!1,!1,"",PL);return n._reactRootContainer=a,n[Gu]=a.current,Hy(n.nodeType===8?n.parentNode:n),Ff(),a}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var p=q1(d);o.call(p)}}var d=ZC(n,0,!1,null,null,!1,!1,"",PL);return n._reactRootContainer=d,n[Gu]=d.current,Hy(n.nodeType===8?n.parentNode:n),Ff(function(){nb(e,d,t,i)}),d}function sb(n,e,t,i,r){var s=t._reactRootContainer;if(s){var a=s;if(typeof r=="function"){var o=r;r=function(){var d=q1(a);o.call(d)}}nb(e,a,n,r)}else a=F8(t,e,n,r,i);return q1(a)}NO=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=J_(e.pendingLanes);t!==0&&(_C(e,t|1),sa(e,Qr()),!(zi&6)&&(Ym=Qr()+500,Cd()))}break;case 13:Ff(function(){var i=Hu(n,1);if(i!==null){var r=Uo();Fl(i,n,1,r)}}),YC(n,1)}};yC=function(n){if(n.tag===13){var e=Hu(n,134217728);if(e!==null){var t=Uo();Fl(e,n,134217728,t)}YC(n,134217728)}};zO=function(n){if(n.tag===13){var e=ud(n),t=Hu(n,e);if(t!==null){var i=Uo();Fl(t,n,e,i)}YC(n,e)}};BO=function(){return ur};UO=function(n,e){var t=ur;try{return ur=n,e()}finally{ur=t}};YE=function(n,e,t){switch(e){case"input":if(HE(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=Zw(i);if(!r)throw Error(Ut(90));_O(i),HE(i,r)}}}break;case"textarea":vO(n,t);break;case"select":e=t.value,e!=null&&Am(n,!!t.multiple,e,!1)}};TO=jC;CO=Ff;var O8={usingClientEntryPoint:!1,Events:[C0,um,Zw,MO,EO,jC]},P_={findFiberByHostInstance:yf,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},N8={bundleType:P_.bundleType,version:P_.version,rendererPackageName:P_.rendererPackageName,rendererConfig:P_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yu.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=PO(n),n===null?null:n.stateNode},findFiberByHostInstance:P_.findFiberByHostInstance||k8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yv=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yv.isDisabled&&Yv.supportsFiber)try{jw=Yv.inject(N8),Pc=Yv}catch{}}Oa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O8;Oa.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!JC(e))throw Error(Ut(200));return D8(n,e,null,t)};Oa.createRoot=function(n,e){if(!JC(n))throw Error(Ut(299));var t=!1,i="",r=cz;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=ZC(n,1,!1,null,null,t,!1,i,r),n[Gu]=e.current,Hy(n.nodeType===8?n.parentNode:n),new KC(e)};Oa.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ut(188)):(n=Object.keys(n).join(","),Error(Ut(268,n)));return n=PO(e),n=n===null?null:n.stateNode,n};Oa.flushSync=function(n){return Ff(n)};Oa.hydrate=function(n,e,t){if(!rb(e))throw Error(Ut(200));return sb(null,n,e,!0,t)};Oa.hydrateRoot=function(n,e,t){if(!JC(n))throw Error(Ut(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",a=cz;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),e=lz(e,null,n,1,t??null,r,!1,s,a),n[Gu]=e.current,Hy(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new ib(e)};Oa.render=function(n,e,t){if(!rb(e))throw Error(Ut(200));return sb(null,n,e,!1,t)};Oa.unmountComponentAtNode=function(n){if(!rb(n))throw Error(Ut(40));return n._reactRootContainer?(Ff(function(){sb(null,null,n,!1,function(){n._reactRootContainer=null,n[Gu]=null})}),!0):!1};Oa.unstable_batchedUpdates=jC;Oa.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!rb(t))throw Error(Ut(200));if(n==null||n._reactInternals===void 0)throw Error(Ut(38));return sb(n,e,t,!1,i)};Oa.version="18.2.0-next-9e3b772b8-20220608";function uz(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(uz)}catch(n){console.error(n)}}uz(),lO.exports=Oa;var z8=lO.exports,RL=z8;OE.createRoot=RL.createRoot,OE.hydrateRoot=RL.hydrateRoot;/**
 * @remix-run/router v1.16.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Jy(){return Jy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Jy.apply(this,arguments)}var Yh;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Yh||(Yh={}));const LL="popstate";function B8(n){n===void 0&&(n={});function e(i,r){let{pathname:s,search:a,hash:o}=i.location;return IT("",{pathname:s,search:a,hash:o},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(i,r){return typeof r=="string"?r:X1(r)}return V8(e,t,null,n)}function ls(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function hz(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function U8(){return Math.random().toString(36).substr(2,8)}function DL(n,e){return{usr:n.state,key:n.key,idx:e}}function IT(n,e,t,i){return t===void 0&&(t=null),Jy({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Sg(e):e,{state:t,key:e&&e.key||i||U8()})}function X1(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Sg(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function V8(n,e,t,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:s=!1}=i,a=r.history,o=Yh.Pop,d=null,p=g();p==null&&(p=0,a.replaceState(Jy({},a.state,{idx:p}),""));function g(){return(a.state||{idx:null}).idx}function _(){o=Yh.Pop;let P=g(),C=P==null?null:P-p;p=P,d&&d({action:o,location:L.location,delta:C})}function w(P,C){o=Yh.Push;let O=IT(L.location,P,C);p=g()+1;let z=DL(O,p),H=L.createHref(O);try{a.pushState(z,"",H)}catch(Y){if(Y instanceof DOMException&&Y.name==="DataCloneError")throw Y;r.location.assign(H)}s&&d&&d({action:o,location:L.location,delta:1})}function T(P,C){o=Yh.Replace;let O=IT(L.location,P,C);p=g();let z=DL(O,p),H=L.createHref(O);a.replaceState(z,"",H),s&&d&&d({action:o,location:L.location,delta:0})}function I(P){let C=r.location.origin!=="null"?r.location.origin:r.location.href,O=typeof P=="string"?P:X1(P);return O=O.replace(/ $/,"%20"),ls(C,"No window.location.(origin|href) available to create URL for href: "+O),new URL(O,C)}let L={get action(){return o},get location(){return n(r,a)},listen(P){if(d)throw new Error("A history only accepts one active listener");return r.addEventListener(LL,_),d=P,()=>{r.removeEventListener(LL,_),d=null}},createHref(P){return e(r,P)},createURL:I,encodeLocation(P){let C=I(P);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:w,replace:T,go(P){return a.go(P)}};return L}var kL;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(kL||(kL={}));function G8(n,e,t){t===void 0&&(t="/");let i=typeof e=="string"?Sg(e):e,r=QC(i.pathname||"/",t);if(r==null)return null;let s=dz(n);H8(s);let a=null;for(let o=0;a==null&&o<s.length;++o){let d=tH(r);a=J8(s[o],d)}return a}function dz(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let r=(s,a,o)=>{let d={relativePath:o===void 0?s.path||"":o,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};d.relativePath.startsWith("/")&&(ls(d.relativePath.startsWith(i),'Absolute route path "'+d.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),d.relativePath=d.relativePath.slice(i.length));let p=dd([i,d.relativePath]),g=t.concat(d);s.children&&s.children.length>0&&(ls(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+p+'".')),dz(s.children,e,g,p)),!(s.path==null&&!s.index)&&e.push({path:p,score:Y8(p,s.index),routesMeta:g})};return n.forEach((s,a)=>{var o;if(s.path===""||!((o=s.path)!=null&&o.includes("?")))r(s,a);else for(let d of fz(s.path))r(s,a,d)}),e}function fz(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),s=t.replace(/\?$/,"");if(i.length===0)return r?[s,""]:[s];let a=fz(i.join("/")),o=[];return o.push(...a.map(d=>d===""?s:[s,d].join("/"))),r&&o.push(...a),o.map(d=>n.startsWith("/")&&d===""?"/":d)}function H8(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:K8(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const W8=/^:[\w-]+$/,j8=3,$8=2,q8=1,X8=10,Z8=-2,FL=n=>n==="*";function Y8(n,e){let t=n.split("/"),i=t.length;return t.some(FL)&&(i+=Z8),e&&(i+=$8),t.filter(r=>!FL(r)).reduce((r,s)=>r+(W8.test(s)?j8:s===""?q8:X8),i)}function K8(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function J8(n,e){let{routesMeta:t}=n,i={},r="/",s=[];for(let a=0;a<t.length;++a){let o=t[a],d=a===t.length-1,p=r==="/"?e:e.slice(r.length)||"/",g=Q8({path:o.relativePath,caseSensitive:o.caseSensitive,end:d},p);if(!g)return null;Object.assign(i,g.params);let _=o.route;s.push({params:i,pathname:dd([r,g.pathname]),pathnameBase:sH(dd([r,g.pathnameBase])),route:_}),g.pathnameBase!=="/"&&(r=dd([r,g.pathnameBase]))}return s}function Q8(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=eH(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let s=r[0],a=s.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((p,g,_)=>{let{paramName:w,isOptional:T}=g;if(w==="*"){let L=o[_]||"";a=s.slice(0,s.length-L.length).replace(/(.)\/+$/,"$1")}const I=o[_];return T&&!I?p[w]=void 0:p[w]=(I||"").replace(/%2F/g,"/"),p},{}),pathname:s,pathnameBase:a,pattern:n}}function eH(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),hz(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,o,d)=>(i.push({paramName:o,isOptional:d!=null}),d?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function tH(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return hz(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function QC(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function nH(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?Sg(n):n;return{pathname:t?t.startsWith("/")?t:iH(t,e):e,search:oH(i),hash:aH(r)}}function iH(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function iM(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rH(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function pz(n,e){let t=rH(n);return e?t.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function mz(n,e,t,i){i===void 0&&(i=!1);let r;typeof n=="string"?r=Sg(n):(r=Jy({},n),ls(!r.pathname||!r.pathname.includes("?"),iM("?","pathname","search",r)),ls(!r.pathname||!r.pathname.includes("#"),iM("#","pathname","hash",r)),ls(!r.search||!r.search.includes("#"),iM("#","search","hash",r)));let s=n===""||r.pathname==="",a=s?"/":r.pathname,o;if(a==null)o=t;else{let _=e.length-1;if(!i&&a.startsWith("..")){let w=a.split("/");for(;w[0]==="..";)w.shift(),_-=1;r.pathname=w.join("/")}o=_>=0?e[_]:"/"}let d=nH(r,o),p=a&&a!=="/"&&a.endsWith("/"),g=(s||a===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(p||g)&&(d.pathname+="/"),d}const dd=n=>n.join("/").replace(/\/\/+/g,"/"),sH=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),oH=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,aH=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function lH(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const gz=["post","put","patch","delete"];new Set(gz);const cH=["get",...gz];new Set(cH);/**
 * React Router v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qy(){return Qy=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Qy.apply(this,arguments)}const eA=Ht.createContext(null),uH=Ht.createContext(null),Hf=Ht.createContext(null),ob=Ht.createContext(null),Wf=Ht.createContext({outlet:null,matches:[],isDataRoute:!1}),_z=Ht.createContext(null);function hH(n,e){let{relative:t}=e===void 0?{}:e;I0()||ls(!1);let{basename:i,navigator:r}=Ht.useContext(Hf),{hash:s,pathname:a,search:o}=vz(n,{relative:t}),d=a;return i!=="/"&&(d=a==="/"?i:dd([i,a])),r.createHref({pathname:d,search:o,hash:s})}function I0(){return Ht.useContext(ob)!=null}function ab(){return I0()||ls(!1),Ht.useContext(ob).location}function yz(n){Ht.useContext(Hf).static||Ht.useLayoutEffect(n)}function dH(){let{isDataRoute:n}=Ht.useContext(Wf);return n?EH():fH()}function fH(){I0()||ls(!1);let n=Ht.useContext(eA),{basename:e,future:t,navigator:i}=Ht.useContext(Hf),{matches:r}=Ht.useContext(Wf),{pathname:s}=ab(),a=JSON.stringify(pz(r,t.v7_relativeSplatPath)),o=Ht.useRef(!1);return yz(()=>{o.current=!0}),Ht.useCallback(function(p,g){if(g===void 0&&(g={}),!o.current)return;if(typeof p=="number"){i.go(p);return}let _=mz(p,JSON.parse(a),s,g.relative==="path");n==null&&e!=="/"&&(_.pathname=_.pathname==="/"?e:dd([e,_.pathname])),(g.replace?i.replace:i.push)(_,g.state,g)},[e,i,a,s,n])}function vz(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=Ht.useContext(Hf),{matches:r}=Ht.useContext(Wf),{pathname:s}=ab(),a=JSON.stringify(pz(r,i.v7_relativeSplatPath));return Ht.useMemo(()=>mz(n,JSON.parse(a),s,t==="path"),[n,a,s,t])}function pH(n,e){return mH(n,e)}function mH(n,e,t,i){I0()||ls(!1);let{navigator:r}=Ht.useContext(Hf),{matches:s}=Ht.useContext(Wf),a=s[s.length-1],o=a?a.params:{};a&&a.pathname;let d=a?a.pathnameBase:"/";a&&a.route;let p=ab(),g;if(e){var _;let P=typeof e=="string"?Sg(e):e;d==="/"||(_=P.pathname)!=null&&_.startsWith(d)||ls(!1),g=P}else g=p;let w=g.pathname||"/",T=w;if(d!=="/"){let P=d.replace(/^\//,"").split("/");T="/"+w.replace(/^\//,"").split("/").slice(P.length).join("/")}let I=G8(n,{pathname:T}),L=xH(I&&I.map(P=>Object.assign({},P,{params:Object.assign({},o,P.params),pathname:dd([d,r.encodeLocation?r.encodeLocation(P.pathname).pathname:P.pathname]),pathnameBase:P.pathnameBase==="/"?d:dd([d,r.encodeLocation?r.encodeLocation(P.pathnameBase).pathname:P.pathnameBase])})),s,t,i);return e&&L?Ht.createElement(ob.Provider,{value:{location:Qy({pathname:"/",search:"",hash:"",state:null,key:"default"},g),navigationType:Yh.Pop}},L):L}function gH(){let n=MH(),e=lH(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Ht.createElement(Ht.Fragment,null,Ht.createElement("h2",null,"Unexpected Application Error!"),Ht.createElement("h3",{style:{fontStyle:"italic"}},e),t?Ht.createElement("pre",{style:r},t):null,null)}const _H=Ht.createElement(gH,null);class yH extends Ht.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?Ht.createElement(Wf.Provider,{value:this.props.routeContext},Ht.createElement(_z.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function vH(n){let{routeContext:e,match:t,children:i}=n,r=Ht.useContext(eA);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),Ht.createElement(Wf.Provider,{value:e},i)}function xH(n,e,t,i){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var s;if((s=t)!=null&&s.errors)n=t.matches;else return null}let a=n,o=(r=t)==null?void 0:r.errors;if(o!=null){let g=a.findIndex(_=>_.route.id&&(o==null?void 0:o[_.route.id])!==void 0);g>=0||ls(!1),a=a.slice(0,Math.min(a.length,g+1))}let d=!1,p=-1;if(t&&i&&i.v7_partialHydration)for(let g=0;g<a.length;g++){let _=a[g];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(p=g),_.route.id){let{loaderData:w,errors:T}=t,I=_.route.loader&&w[_.route.id]===void 0&&(!T||T[_.route.id]===void 0);if(_.route.lazy||I){d=!0,p>=0?a=a.slice(0,p+1):a=[a[0]];break}}}return a.reduceRight((g,_,w)=>{let T,I=!1,L=null,P=null;t&&(T=o&&_.route.id?o[_.route.id]:void 0,L=_.route.errorElement||_H,d&&(p<0&&w===0?(I=!0,P=null):p===w&&(I=!0,P=_.route.hydrateFallbackElement||null)));let C=e.concat(a.slice(0,w+1)),O=()=>{let z;return T?z=L:I?z=P:_.route.Component?z=Ht.createElement(_.route.Component,null):_.route.element?z=_.route.element:z=g,Ht.createElement(vH,{match:_,routeContext:{outlet:g,matches:C,isDataRoute:t!=null},children:z})};return t&&(_.route.ErrorBoundary||_.route.errorElement||w===0)?Ht.createElement(yH,{location:t.location,revalidation:t.revalidation,component:L,error:T,children:O(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):O()},null)}var xz=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(xz||{}),Z1=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Z1||{});function wH(n){let e=Ht.useContext(eA);return e||ls(!1),e}function bH(n){let e=Ht.useContext(uH);return e||ls(!1),e}function SH(n){let e=Ht.useContext(Wf);return e||ls(!1),e}function wz(n){let e=SH(),t=e.matches[e.matches.length-1];return t.route.id||ls(!1),t.route.id}function MH(){var n;let e=Ht.useContext(_z),t=bH(Z1.UseRouteError),i=wz(Z1.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function EH(){let{router:n}=wH(xz.UseNavigateStable),e=wz(Z1.UseNavigateStable),t=Ht.useRef(!1);return yz(()=>{t.current=!0}),Ht.useCallback(function(r,s){s===void 0&&(s={}),t.current&&(typeof r=="number"?n.navigate(r):n.navigate(r,Qy({fromRouteId:e},s)))},[n,e])}function ey(n){ls(!1)}function TH(n){let{basename:e="/",children:t=null,location:i,navigationType:r=Yh.Pop,navigator:s,static:a=!1,future:o}=n;I0()&&ls(!1);let d=e.replace(/^\/*/,"/"),p=Ht.useMemo(()=>({basename:d,navigator:s,static:a,future:Qy({v7_relativeSplatPath:!1},o)}),[d,o,s,a]);typeof i=="string"&&(i=Sg(i));let{pathname:g="/",search:_="",hash:w="",state:T=null,key:I="default"}=i,L=Ht.useMemo(()=>{let P=QC(g,d);return P==null?null:{location:{pathname:P,search:_,hash:w,state:T,key:I},navigationType:r}},[d,g,_,w,T,I,r]);return L==null?null:Ht.createElement(Hf.Provider,{value:p},Ht.createElement(ob.Provider,{children:t,value:L}))}function CH(n){let{children:e,location:t}=n;return pH(PT(e),t)}new Promise(()=>{});function PT(n,e){e===void 0&&(e=[]);let t=[];return Ht.Children.forEach(n,(i,r)=>{if(!Ht.isValidElement(i))return;let s=[...e,r];if(i.type===Ht.Fragment){t.push.apply(t,PT(i.props.children,s));return}i.type!==ey&&ls(!1),!i.props.index||!i.props.children||ls(!1);let a={id:i.props.id||s.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,loader:i.props.loader,action:i.props.action,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(a.children=PT(i.props.children,s)),t.push(a)}),t}/**
 * React Router DOM v6.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function RT(){return RT=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},RT.apply(this,arguments)}function AH(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,s;for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function IH(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function PH(n,e){return n.button===0&&(!e||e==="_self")&&!IH(n)}const RH=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],LH="6";try{window.__reactRouterVersion=LH}catch{}const DH="startTransition",OL=AV[DH];function kH(n){let{basename:e,children:t,future:i,window:r}=n,s=Ht.useRef();s.current==null&&(s.current=B8({window:r,v5Compat:!0}));let a=s.current,[o,d]=Ht.useState({action:a.action,location:a.location}),{v7_startTransition:p}=i||{},g=Ht.useCallback(_=>{p&&OL?OL(()=>d(_)):d(_)},[d,p]);return Ht.useLayoutEffect(()=>a.listen(g),[a,g]),Ht.createElement(TH,{basename:e,children:t,location:o.location,navigationType:o.action,navigator:a,future:i})}const FH=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",OH=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,rM=Ht.forwardRef(function(e,t){let{onClick:i,relative:r,reloadDocument:s,replace:a,state:o,target:d,to:p,preventScrollReset:g,unstable_viewTransition:_}=e,w=AH(e,RH),{basename:T}=Ht.useContext(Hf),I,L=!1;if(typeof p=="string"&&OH.test(p)&&(I=p,FH))try{let z=new URL(window.location.href),H=p.startsWith("//")?new URL(z.protocol+p):new URL(p),Y=QC(H.pathname,T);H.origin===z.origin&&Y!=null?p=Y+H.search+H.hash:L=!0}catch{}let P=hH(p,{relative:r}),C=NH(p,{replace:a,state:o,target:d,preventScrollReset:g,relative:r,unstable_viewTransition:_});function O(z){i&&i(z),z.defaultPrevented||C(z)}return Ht.createElement("a",RT({},w,{href:I||P,onClick:L||s?i:O,ref:t,target:d}))});var NL;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(NL||(NL={}));var zL;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(zL||(zL={}));function NH(n,e){let{target:t,replace:i,state:r,preventScrollReset:s,relative:a,unstable_viewTransition:o}=e===void 0?{}:e,d=dH(),p=ab(),g=vz(n,{relative:a});return Ht.useCallback(_=>{if(PH(_,t)){_.preventDefault();let w=i!==void 0?i:X1(p)===X1(g);d(n,{replace:w,state:r,preventScrollReset:s,relative:a,unstable_viewTransition:o})}},[p,d,g,i,r,t,n,s,a,o])}class la{constructor(e){this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Km={PROPERTYCHANGE:"propertychange"};class tA{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function zH(n,e,t){let i,r;t=t||Ou;let s=0,a=n.length,o=!1;for(;s<a;)i=s+(a-s>>1),r=+t(n[i],e),r<0?s=i+1:(a=i,o=!r);return o?s:~s}function Ou(n,e){return n>e?1:n<e?-1:0}function nA(n,e,t){if(n[0]<=e)return 0;const i=n.length;if(e<=n[i-1])return i-1;if(typeof t=="function"){for(let r=1;r<i;++r){const s=n[r];if(s===e)return r;if(s<e)return t(e,n[r-1],s)>0?r-1:r}return i-1}if(t>0){for(let r=1;r<i;++r)if(n[r]<e)return r-1;return i-1}if(t<0){for(let r=1;r<i;++r)if(n[r]<=e)return r;return i-1}for(let r=1;r<i;++r){if(n[r]==e)return r;if(n[r]<e)return n[r-1]-e<e-n[r]?r-1:r}return i-1}function BH(n,e,t){for(;e<t;){const i=n[e];n[e]=n[t],n[t]=i,++e,--t}}function ll(n,e){const t=Array.isArray(e)?e:[e],i=t.length;for(let r=0;r<i;r++)n[n.length]=t[r]}function Ku(n,e){const t=n.length;if(t!==e.length)return!1;for(let i=0;i<t;i++)if(n[i]!==e[i])return!1;return!0}function UH(n,e,t){const i=e||Ou;return n.every(function(r,s){if(s===0)return!0;const a=i(n[s-1],r);return!(a>0||a===0)})}function Gl(){return!0}function jf(){return!1}function Jm(){}function bz(n){let e=!1,t,i,r;return function(){const s=Array.prototype.slice.call(arguments);return(!e||this!==r||!Ku(s,i))&&(e=!0,r=this,i=s,t=n.apply(this,arguments)),t}}function VH(n){function e(){let t;try{t=n()}catch(i){return Promise.reject(i)}return t instanceof Promise?t:Promise.resolve(t)}return e()}function Mg(n){for(const e in n)delete n[e]}function Qm(n){let e;for(e in n)return!1;return!e}class lb extends tA{constructor(e){super(),this.eventTarget_=e,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(e,t){if(!e||!t)return;const i=this.listeners_||(this.listeners_={}),r=i[e]||(i[e]=[]);r.includes(t)||r.push(t)}dispatchEvent(e){const t=typeof e=="string",i=t?e:e.type,r=this.listeners_&&this.listeners_[i];if(!r)return;const s=t?new la(e):e;s.target||(s.target=this.eventTarget_||this);const a=this.dispatching_||(this.dispatching_={}),o=this.pendingRemovals_||(this.pendingRemovals_={});i in a||(a[i]=0,o[i]=0),++a[i];let d;for(let p=0,g=r.length;p<g;++p)if("handleEvent"in r[p]?d=r[p].handleEvent(s):d=r[p].call(this,s),d===!1||s.propagationStopped){d=!1;break}if(--a[i]===0){let p=o[i];for(delete o[i];p--;)this.removeEventListener(i,Jm);delete a[i]}return d}disposeInternal(){this.listeners_&&Mg(this.listeners_)}getListeners(e){return this.listeners_&&this.listeners_[e]||void 0}hasListener(e){return this.listeners_?e?e in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(e,t){if(!this.listeners_)return;const i=this.listeners_[e];if(!i)return;const r=i.indexOf(t);r!==-1&&(this.pendingRemovals_&&e in this.pendingRemovals_?(i[r]=Jm,++this.pendingRemovals_[e]):(i.splice(r,1),i.length===0&&delete this.listeners_[e]))}}const ti={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function fi(n,e,t,i,r){if(i&&i!==n&&(t=t.bind(i)),r){const a=t;t=function(){n.removeEventListener(e,t),a.apply(this,arguments)}}const s={target:n,type:e,listener:t};return n.addEventListener(e,t),s}function Y1(n,e,t,i){return fi(n,e,t,i,!0)}function cr(n){n&&n.target&&(n.target.removeEventListener(n.type,n.listener),Mg(n))}class P0 extends lb{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(ti.CHANGE)}getRevision(){return this.revision_}onInternal(e,t){if(Array.isArray(e)){const i=e.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=fi(this,e[s],t);return r}return fi(this,e,t)}onceInternal(e,t){let i;if(Array.isArray(e)){const r=e.length;i=new Array(r);for(let s=0;s<r;++s)i[s]=Y1(this,e[s],t)}else i=Y1(this,e,t);return t.ol_key=i,i}unInternal(e,t){const i=t.ol_key;if(i)GH(i);else if(Array.isArray(e))for(let r=0,s=e.length;r<s;++r)this.removeEventListener(e[r],t);else this.removeEventListener(e,t)}}P0.prototype.on;P0.prototype.once;P0.prototype.un;function GH(n){if(Array.isArray(n))for(let e=0,t=n.length;e<t;++e)cr(n[e]);else cr(n)}function Gi(){throw new Error("Unimplemented abstract method.")}let HH=0;function ai(n){return n.ol_uid||(n.ol_uid=String(++HH))}class BL extends la{constructor(e,t,i){super(e),this.key=t,this.oldValue=i}}class Uc extends P0{constructor(e){super(),this.on,this.once,this.un,ai(this),this.values_=null,e!==void 0&&this.setProperties(e)}get(e){let t;return this.values_&&this.values_.hasOwnProperty(e)&&(t=this.values_[e]),t}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(e,t){let i;i=`change:${e}`,this.hasListener(i)&&this.dispatchEvent(new BL(i,e,t)),i=Km.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new BL(i,e,t))}addChangeListener(e,t){this.addEventListener(`change:${e}`,t)}removeChangeListener(e,t){this.removeEventListener(`change:${e}`,t)}set(e,t,i){const r=this.values_||(this.values_={});if(i)r[e]=t;else{const s=r[e];r[e]=t,s!==t&&this.notify(e,s)}}setProperties(e,t){for(const i in e)this.set(i,e[i],t)}applyProperties(e){e.values_&&Object.assign(this.values_||(this.values_={}),e.values_)}unset(e,t){if(this.values_&&e in this.values_){const i=this.values_[e];delete this.values_[e],Qm(this.values_)&&(this.values_=null),t||this.notify(e,i)}}}function Bi(n,e){if(!n)throw new Error(e)}new Array(6);function Ol(){return[1,0,0,1,0,0]}function WH(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n}function Ws(n,e){const t=e[0],i=e[1];return e[0]=n[0]*t+n[2]*i+n[4],e[1]=n[1]*t+n[3]*i+n[5],e}function ju(n,e,t,i,r,s,a,o){const d=Math.sin(s),p=Math.cos(s);return n[0]=i*p,n[1]=r*d,n[2]=-i*d,n[3]=r*p,n[4]=a*i*p-o*i*d+e,n[5]=a*r*d+o*r*p+t,n}function Sz(n,e){const t=jH(e);Bi(t!==0,"Transformation matrix cannot be inverted");const i=e[0],r=e[1],s=e[2],a=e[3],o=e[4],d=e[5];return n[0]=a/t,n[1]=-r/t,n[2]=-s/t,n[3]=i/t,n[4]=(s*d-a*o)/t,n[5]=-(i*d-r*o)/t,n}function jH(n){return n[0]*n[3]-n[1]*n[2]}const UL=[1e6,1e6,1e6,1e6,2,2];function $H(n){return"matrix("+n.map((t,i)=>Math.round(t*UL[i])/UL[i]).join(", ")+")"}const Rs={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function po(n){const e=Da();for(let t=0,i=n.length;t<i;++t)xy(e,n[t]);return e}function R0(n,e,t){return t?(t[0]=n[0]-e,t[1]=n[1]-e,t[2]=n[2]+e,t[3]=n[3]+e,t):[n[0]-e,n[1]-e,n[2]+e,n[3]+e]}function Mz(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n.slice()}function $f(n,e,t){let i,r;return e<n[0]?i=n[0]-e:n[2]<e?i=e-n[2]:i=0,t<n[1]?r=n[1]-t:n[3]<t?r=t-n[3]:r=0,i*i+r*r}function eg(n,e){return iA(n,e[0],e[1])}function _m(n,e){return n[0]<=e[0]&&e[2]<=n[2]&&n[1]<=e[1]&&e[3]<=n[3]}function iA(n,e,t){return n[0]<=e&&e<=n[2]&&n[1]<=t&&t<=n[3]}function LT(n,e){const t=n[0],i=n[1],r=n[2],s=n[3],a=e[0],o=e[1];let d=Rs.UNKNOWN;return a<t?d=d|Rs.LEFT:a>r&&(d=d|Rs.RIGHT),o<i?d=d|Rs.BELOW:o>s&&(d=d|Rs.ABOVE),d===Rs.UNKNOWN&&(d=Rs.INTERSECTING),d}function Da(){return[1/0,1/0,-1/0,-1/0]}function $u(n,e,t,i,r){return r?(r[0]=n,r[1]=e,r[2]=t,r[3]=i,r):[n,e,t,i]}function L0(n){return $u(1/0,1/0,-1/0,-1/0,n)}function vy(n,e){const t=n[0],i=n[1];return $u(t,i,t,i,e)}function rA(n,e,t,i,r){const s=L0(r);return Tz(s,n,e,t,i)}function e0(n,e){return n[0]==e[0]&&n[2]==e[2]&&n[1]==e[1]&&n[3]==e[3]}function Ez(n,e){return e[0]<n[0]&&(n[0]=e[0]),e[2]>n[2]&&(n[2]=e[2]),e[1]<n[1]&&(n[1]=e[1]),e[3]>n[3]&&(n[3]=e[3]),n}function xy(n,e){e[0]<n[0]&&(n[0]=e[0]),e[0]>n[2]&&(n[2]=e[0]),e[1]<n[1]&&(n[1]=e[1]),e[1]>n[3]&&(n[3]=e[1])}function Tz(n,e,t,i,r){for(;t<i;t+=r)qH(n,e[t],e[t+1]);return n}function qH(n,e,t){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}function sA(n,e){let t;return t=e(tg(n)),t||(t=e(D0(n)),t)||(t=e(k0(n)),t)||(t=e(Ad(n)),t)?t:!1}function DT(n){let e=0;return cb(n)||(e=qi(n)*js(n)),e}function tg(n){return[n[0],n[1]]}function D0(n){return[n[2],n[1]]}function qu(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]}function XH(n,e){let t;if(e==="bottom-left")t=tg(n);else if(e==="bottom-right")t=D0(n);else if(e==="top-left")t=Ad(n);else if(e==="top-right")t=k0(n);else throw new Error("Invalid corner");return t}function kT(n,e,t,i,r){const[s,a,o,d,p,g,_,w]=FT(n,e,t,i);return $u(Math.min(s,o,p,_),Math.min(a,d,g,w),Math.max(s,o,p,_),Math.max(a,d,g,w),r)}function FT(n,e,t,i){const r=e*i[0]/2,s=e*i[1]/2,a=Math.cos(t),o=Math.sin(t),d=r*a,p=r*o,g=s*a,_=s*o,w=n[0],T=n[1];return[w-d+_,T-p-g,w-d-_,T-p+g,w+d-_,T+p+g,w+d+_,T+p-g,w-d+_,T-p-g]}function js(n){return n[3]-n[1]}function wy(n,e,t){const i=t||Da();return No(n,e)?(n[0]>e[0]?i[0]=n[0]:i[0]=e[0],n[1]>e[1]?i[1]=n[1]:i[1]=e[1],n[2]<e[2]?i[2]=n[2]:i[2]=e[2],n[3]<e[3]?i[3]=n[3]:i[3]=e[3]):L0(i),i}function Ad(n){return[n[0],n[3]]}function k0(n){return[n[2],n[3]]}function qi(n){return n[2]-n[0]}function No(n,e){return n[0]<=e[2]&&n[2]>=e[0]&&n[1]<=e[3]&&n[3]>=e[1]}function cb(n){return n[2]<n[0]||n[3]<n[1]}function ZH(n,e){return e?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e):n}function YH(n,e,t){let i=!1;const r=LT(n,e),s=LT(n,t);if(r===Rs.INTERSECTING||s===Rs.INTERSECTING)i=!0;else{const a=n[0],o=n[1],d=n[2],p=n[3],g=e[0],_=e[1],w=t[0],T=t[1],I=(T-_)/(w-g);let L,P;s&Rs.ABOVE&&!(r&Rs.ABOVE)&&(L=w-(T-p)/I,i=L>=a&&L<=d),!i&&s&Rs.RIGHT&&!(r&Rs.RIGHT)&&(P=T-(w-d)*I,i=P>=o&&P<=p),!i&&s&Rs.BELOW&&!(r&Rs.BELOW)&&(L=w-(T-o)/I,i=L>=a&&L<=d),!i&&s&Rs.LEFT&&!(r&Rs.LEFT)&&(P=T-(w-a)*I,i=P>=o&&P<=p)}return i}function Cz(n,e){const t=e.getExtent(),i=qu(n);if(e.canWrapX()&&(i[0]<t[0]||i[0]>=t[2])){const r=qi(t),a=Math.floor((i[0]-t[0])/r)*r;n[0]-=a,n[2]-=a}return n}function Az(n,e,t){if(e.canWrapX()){const i=e.getExtent();if(!isFinite(n[0])||!isFinite(n[2]))return[[i[0],n[1],i[2],n[3]]];Cz(n,e);const r=qi(i);if(qi(n)>r&&!t)return[[i[0],n[1],i[2],n[3]]];if(n[0]<i[0])return[[n[0]+r,n[1],i[2],n[3]],[i[0],n[1],n[2],n[3]]];if(n[2]>i[2])return[[n[0],n[1],i[2],n[3]],[i[0],n[1],n[2]-r,n[3]]]}return[n]}const ng={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};let Iz=class{constructor(e){this.code_=e.code,this.units_=e.units,this.extent_=e.extent!==void 0?e.extent:null,this.worldExtent_=e.worldExtent!==void 0?e.worldExtent:null,this.axisOrientation_=e.axisOrientation!==void 0?e.axisOrientation:"enu",this.global_=e.global!==void 0?e.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ng[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(e){this.global_=e,this.canWrapX_=!!(e&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(e){this.defaultTileGrid_=e}setExtent(e){this.extent_=e,this.canWrapX_=!!(this.global_&&e)}setWorldExtent(e){this.worldExtent_=e}setGetPointResolution(e){this.getPointResolutionFunc_=e}getPointResolutionFunc(){return this.getPointResolutionFunc_}};const F0=6378137,ym=Math.PI*F0,KH=[-ym,-ym,ym,ym],JH=[-180,-85,180,85],Kv=F0*Math.log(Math.tan(Math.PI/2));class Cp extends Iz{constructor(e){super({code:e,units:"m",extent:KH,global:!0,worldExtent:JH,getPointResolution:function(t,i){return t/Math.cosh(i[1]/F0)}})}}const VL=[new Cp("EPSG:3857"),new Cp("EPSG:102100"),new Cp("EPSG:102113"),new Cp("EPSG:900913"),new Cp("http://www.opengis.net/def/crs/EPSG/0/3857"),new Cp("http://www.opengis.net/gml/srs/epsg.xml#3857")];function QH(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t){e[r]=ym*n[r]/180;let s=F0*Math.log(Math.tan(Math.PI*(+n[r+1]+90)/360));s>Kv?s=Kv:s<-Kv&&(s=-Kv),e[r+1]=s}return e}function eW(n,e,t){const i=n.length;t=t>1?t:2,e===void 0&&(t>2?e=n.slice():e=new Array(i));for(let r=0;r<i;r+=t)e[r]=180*n[r]/ym,e[r+1]=360*Math.atan(Math.exp(n[r+1]/F0))/Math.PI-90;return e}const tW=6378137,GL=[-180,-90,180,90],nW=Math.PI*tW/180;class tf extends Iz{constructor(e,t){super({code:e,units:"degrees",extent:GL,axisOrientation:t,global:!0,metersPerUnit:nW,worldExtent:GL})}}const HL=[new tf("CRS:84"),new tf("EPSG:4326","neu"),new tf("urn:ogc:def:crs:OGC:1.3:CRS84"),new tf("urn:ogc:def:crs:OGC:2:84"),new tf("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new tf("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new tf("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let OT={};function iW(n){return OT[n]||OT[n.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function rW(n,e){OT[n]=e}let km={};function K1(n,e,t){const i=n.getCode(),r=e.getCode();i in km||(km[i]={}),km[i][r]=t}function sW(n,e){let t;return n in km&&e in km[n]&&(t=km[n][e]),t}function es(n,e,t){return Math.min(Math.max(n,e),t)}function oW(n,e,t,i,r,s){const a=r-t,o=s-i;if(a!==0||o!==0){const d=((n-t)*a+(e-i)*o)/(a*a+o*o);d>1?(t=r,i=s):d>0&&(t+=a*d,i+=o*d)}return Nu(n,e,t,i)}function Nu(n,e,t,i){const r=t-n,s=i-e;return r*r+s*s}function aW(n){const e=n.length;for(let i=0;i<e;i++){let r=i,s=Math.abs(n[i][i]);for(let o=i+1;o<e;o++){const d=Math.abs(n[o][i]);d>s&&(s=d,r=o)}if(s===0)return null;const a=n[r];n[r]=n[i],n[i]=a;for(let o=i+1;o<e;o++){const d=-n[o][i]/n[i][i];for(let p=i;p<e+1;p++)i==p?n[o][p]=0:n[o][p]+=d*n[i][p]}}const t=new Array(e);for(let i=e-1;i>=0;i--){t[i]=n[i][e]/n[i][i];for(let r=i-1;r>=0;r--)n[r][e]-=n[r][i]*t[i]}return t}function s1(n){return n*Math.PI/180}function Af(n,e){const t=n%e;return t*e<0?t+e:t}function Ea(n,e,t){return n+t*(e-n)}function ub(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}function Jv(n,e){return Math.floor(ub(n,e))}function Qv(n,e){return Math.ceil(ub(n,e))}function lW(n,e){return n[0]+=+e[0],n[1]+=+e[1],n}function cW(n,e){const t=e.getRadius(),i=e.getCenter(),r=i[0],s=i[1],a=n[0],o=n[1];let d=a-r;const p=o-s;d===0&&p===0&&(d=1);const g=Math.sqrt(d*d+p*p),_=r+t*d/g,w=s+t*p/g;return[_,w]}function oA(n,e){const t=n[0],i=n[1],r=e[0],s=e[1],a=r[0],o=r[1],d=s[0],p=s[1],g=d-a,_=p-o,w=g===0&&_===0?0:(g*(t-a)+_*(i-o))/(g*g+_*_||0);let T,I;return w<=0?(T=a,I=o):w>=1?(T=d,I=p):(T=a+w*g,I=o+w*_),[T,I]}function WL(n){return function(e){return fW(e,n)}}function uW(n,e,t){return n?e.replace("{x}",n[0].toFixed(t)).replace("{y}",n[1].toFixed(t)):""}function Il(n,e){let t=!0;for(let i=n.length-1;i>=0;--i)if(n[i]!=e[i]){t=!1;break}return t}function aA(n,e){const t=Math.cos(e),i=Math.sin(e),r=n[0]*t-n[1]*i,s=n[1]*t+n[0]*i;return n[0]=r,n[1]=s,n}function hW(n,e){return n[0]*=e,n[1]*=e,n}function Lc(n,e){const t=n[0]-e[0],i=n[1]-e[1];return t*t+i*i}function J1(n,e){return Math.sqrt(Lc(n,e))}function dW(n,e){return Lc(n,oA(n,e))}function fW(n,e){return uW(n,"{x}, {y}",e)}function lA(n,e){if(e.canWrapX()){const t=qi(e.getExtent()),i=pW(n,e,t);i&&(n[0]-=i*t)}return n}function pW(n,e,t){const i=e.getExtent();let r=0;return e.canWrapX()&&(n[0]<i[0]||n[0]>i[2])&&(t=t||qi(i),r=Math.floor((n[0]-i[0])/t)),r}const mW=63710088e-1;function jL(n,e,t){t=t||mW;const i=s1(n[1]),r=s1(e[1]),s=(r-i)/2,a=s1(e[0]-n[0])/2,o=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(i)*Math.cos(r);return 2*t*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))}function Pz(...n){console.warn(...n)}let NT=!0;function gW(n){NT=!1}function cA(n,e){if(e!==void 0){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];e=e}else e=n.slice();return e}function uA(n,e){if(e!==void 0&&n!==e){for(let t=0,i=n.length;t<i;++t)e[t]=n[t];n=e}return n}function _W(n){rW(n.getCode(),n),K1(n,n,cA)}function yW(n){n.forEach(_W)}function aa(n){return typeof n=="string"?iW(n):n||null}function Q1(n,e,t,i){n=aa(n);let r;const s=n.getPointResolutionFunc();if(s){if(r=s(e,t),i&&i!==n.getUnits()){const a=n.getMetersPerUnit();a&&(r=r*a/ng[i])}}else{const a=n.getUnits();if(a=="degrees"&&!i||i=="degrees")r=e;else{const o=hb(n,aa("EPSG:4326"));if(o===uA&&a!=="degrees")r=e*n.getMetersPerUnit();else{let p=[t[0]-e/2,t[1],t[0]+e/2,t[1],t[0],t[1]-e/2,t[0],t[1]+e/2];p=o(p,p,2);const g=jL(p.slice(0,2),p.slice(2,4)),_=jL(p.slice(4,6),p.slice(6,8));r=(g+_)/2}const d=i?ng[i]:n.getMetersPerUnit();d!==void 0&&(r/=d)}}return r}function $L(n){yW(n),n.forEach(function(e){n.forEach(function(t){e!==t&&K1(e,t,cA)})})}function vW(n,e,t,i){n.forEach(function(r){e.forEach(function(s){K1(r,s,t),K1(s,r,i)})})}function hA(n,e){return n?typeof n=="string"?aa(n):n:aa(e)}function Jp(n,e){if(n===e)return!0;const t=n.getUnits()===e.getUnits();return(n.getCode()===e.getCode()||hb(n,e)===cA)&&t}function hb(n,e){const t=n.getCode(),i=e.getCode();let r=sW(t,i);return r||(r=uA),r}function ew(n,e){const t=aa(n),i=aa(e);return hb(t,i)}function xW(n,e,t){return ew(e,t)(n,void 0,n.length)}function Of(n,e){return n}function er(n,e){return NT&&!Il(n,[0,0])&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90&&(NT=!1,Pz("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),n}function db(n,e){return n}function Kh(n,e){return n}function wW(){$L(VL),$L(HL),vW(HL,VL,QH,eW)}wW();function fd(n,e,t,i,r,s){s=s||[];let a=0;for(let o=e;o<t;o+=i){const d=n[o],p=n[o+1];s[a++]=r[0]*d+r[2]*p+r[4],s[a++]=r[1]*d+r[3]*p+r[5]}return s&&s.length!=a&&(s.length=a),s}function dA(n,e,t,i,r,s,a){a=a||[];const o=Math.cos(r),d=Math.sin(r),p=s[0],g=s[1];let _=0;for(let w=e;w<t;w+=i){const T=n[w]-p,I=n[w+1]-g;a[_++]=p+T*o-I*d,a[_++]=g+T*d+I*o;for(let L=w+2;L<w+i;++L)a[_++]=n[L]}return a&&a.length!=_&&(a.length=_),a}function bW(n,e,t,i,r,s,a,o){o=o||[];const d=a[0],p=a[1];let g=0;for(let _=e;_<t;_+=i){const w=n[_]-d,T=n[_+1]-p;o[g++]=d+r*w,o[g++]=p+s*T;for(let I=_+2;I<_+i;++I)o[g++]=n[I]}return o&&o.length!=g&&(o.length=g),o}function SW(n,e,t,i,r,s,a){a=a||[];let o=0;for(let d=e;d<t;d+=i){a[o++]=n[d]+r,a[o++]=n[d+1]+s;for(let p=d+2;p<d+i;++p)a[o++]=n[p]}return a&&a.length!=o&&(a.length=o),a}const qL=Ol();class Rz extends Uc{constructor(){super(),this.extent_=Da(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=bz((e,t,i)=>{if(!i)return this.getSimplifiedGeometry(t);const r=this.clone();return r.applyTransform(i),r.getSimplifiedGeometry(t)})}simplifyTransformed(e,t){return this.simplifyTransformedInternal(this.getRevision(),e,t)}clone(){return Gi()}closestPointXY(e,t,i,r){return Gi()}containsXY(e,t){const i=this.getClosestPoint([e,t]);return i[0]===e&&i[1]===t}getClosestPoint(e,t){return t=t||[NaN,NaN],this.closestPointXY(e[0],e[1],t,1/0),t}intersectsCoordinate(e){return this.containsXY(e[0],e[1])}computeExtent(e){return Gi()}getExtent(e){if(this.extentRevision_!=this.getRevision()){const t=this.computeExtent(this.extent_);(isNaN(t[0])||isNaN(t[1]))&&L0(t),this.extentRevision_=this.getRevision()}return ZH(this.extent_,e)}rotate(e,t){Gi()}scale(e,t,i){Gi()}simplify(e){return this.getSimplifiedGeometry(e*e)}getSimplifiedGeometry(e){return Gi()}getType(){return Gi()}applyTransform(e){Gi()}intersectsExtent(e){return Gi()}translate(e,t){Gi()}transform(e,t){const i=aa(e),r=i.getUnits()=="tile-pixels"?function(s,a,o){const d=i.getExtent(),p=i.getWorldExtent(),g=js(p)/js(d);return ju(qL,p[0],p[3],g,-g,0,0,0),fd(s,0,s.length,o,qL,a),ew(i,t)(s,a,o)}:ew(i,t);return this.applyTransform(r),this}}class Id extends Rz{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates}computeExtent(e){return rA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinates(){return Gi()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=this.getSimplifiedGeometryInternal(e);return t.getFlatCoordinates().length<this.flatCoordinates.length?t:(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getSimplifiedGeometryInternal(e){return this}getStride(){return this.stride}setFlatCoordinates(e,t){this.stride=tw(e),this.layout=e,this.flatCoordinates=t}setCoordinates(e,t){Gi()}setLayout(e,t,i){let r;if(e)r=tw(e);else{for(let s=0;s<i;++s){if(t.length===0){this.layout="XY",this.stride=2;return}t=t[0]}r=t.length,e=MW(r)}this.layout=e,this.stride=r}applyTransform(e){this.flatCoordinates&&(e(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();dA(i,0,i.length,r,e,t,i),this.changed()}}scale(e,t,i){t===void 0&&(t=e),i||(i=qu(this.getExtent()));const r=this.getFlatCoordinates();if(r){const s=this.getStride();bW(r,0,r.length,s,e,t,i,r),this.changed()}}translate(e,t){const i=this.getFlatCoordinates();if(i){const r=this.getStride();SW(i,0,i.length,r,e,t,i),this.changed()}}}function MW(n){let e;return n==2?e="XY":n==3?e="XYZ":n==4&&(e="XYZM"),e}function tw(n){let e;return n=="XY"?e=2:n=="XYZ"||n=="XYM"?e=3:n=="XYZM"&&(e=4),e}function EW(n,e,t){const i=n.getFlatCoordinates();if(!i)return null;const r=n.getStride();return fd(i,0,i.length,r,e,t)}function Lz(n,e,t,i){for(let r=0,s=t.length;r<s;++r)n[e++]=t[r];return e}function fb(n,e,t,i){for(let r=0,s=t.length;r<s;++r){const a=t[r];for(let o=0;o<i;++o)n[e++]=a[o]}return e}function fA(n,e,t,i,r){r=r||[];let s=0;for(let a=0,o=t.length;a<o;++a){const d=fb(n,e,t[a],i);r[s++]=d,e=d}return r.length=s,r}function TW(n,e,t,i,r){r=r||[];let s=0;for(let a=0,o=t.length;a<o;++a){const d=fA(n,e,t[a],i,r[s]);d.length===0&&(d[0]=e),r[s++]=d,e=d[d.length-1]}return r.length=s,r}class O0 extends Id{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new O0(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,a=e-s[0],o=t-s[1],d=a*a+o*o;if(d<r){if(d===0)for(let p=0;p<this.stride;++p)i[p]=s[p];else{const p=this.getRadius()/Math.sqrt(d);i[0]=s[0]+p*a,i[1]=s[1]+p*o;for(let g=2;g<this.stride;++g)i[g]=s[g]}return i.length=this.stride,d}return r}containsXY(e,t){const i=this.flatCoordinates,r=e-i[0],s=t-i[1];return r*r+s*s<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return $u(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(No(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:sA(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+i;for(let s=1;s<t;++s)r[t+s]=e[s];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let s=Lz(r,0,e,this.stride);r[s++]=r[0]+t;for(let a=1,o=this.stride;a<o;++a)r[s++]=r[a];r.length=s,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),r=this.getStride();this.setCenter(dA(i,0,i.length,r,e,t,i)),this.changed()}}O0.prototype.transform;class tl extends Uc{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new tl(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(cr(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=fi(e,ti.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?CW(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function CW(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(Bi(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}class nw extends Rz{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(cr),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(fi(e[t],ti.CHANGE,this.changed,this))}clone(){const e=new nw(sM(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<$f(this.getExtent(),e,t))return r;const s=this.geometries_;for(let a=0,o=s.length;a<o;++a)r=s[a].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){L0(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)Ez(e,t[i].getExtent());return e}getGeometries(){return sM(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let s=0,a=i.length;s<a;++s){const o=i[s],d=o.getSimplifiedGeometry(e);t.push(d),d!==o&&(r=!0)}return r?new nw(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=qu(this.getExtent()));const r=this.geometries_;for(let s=0,a=r.length;s<a;++s)r[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(sM(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function sM(n){return n.map(e=>e.clone())}const iw={ACTIVE:"active"};function XL(n,e,t,i,r,s,a){const o=n[e],d=n[e+1],p=n[t]-o,g=n[t+1]-d;let _;if(p===0&&g===0)_=e;else{const w=((r-o)*p+(s-d)*g)/(p*p+g*g);if(w>1)_=t;else if(w>0){for(let T=0;T<i;++T)a[T]=Ea(n[e+T],n[t+T],w);a.length=i;return}else _=e}for(let w=0;w<i;++w)a[w]=n[_+w];a.length=i}function pA(n,e,t,i,r){let s=n[e],a=n[e+1];for(e+=i;e<t;e+=i){const o=n[e],d=n[e+1],p=Nu(s,a,o,d);p>r&&(r=p),s=o,a=d}return r}function mA(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s){const o=t[s];r=pA(n,e,o,i,r),e=o}return r}function AW(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s){const o=t[s];r=mA(n,e,o,i,r),e=o[o.length-1]}return r}function gA(n,e,t,i,r,s,a,o,d,p,g){if(e==t)return p;let _,w;if(r===0){if(w=Nu(a,o,n[e],n[e+1]),w<p){for(_=0;_<i;++_)d[_]=n[e+_];return d.length=i,w}return p}g=g||[NaN,NaN];let T=e+i;for(;T<t;)if(XL(n,T-i,T,i,a,o,g),w=Nu(a,o,g[0],g[1]),w<p){for(p=w,_=0;_<i;++_)d[_]=g[_];d.length=i,T+=i}else T+=i*Math.max((Math.sqrt(w)-Math.sqrt(p))/r|0,1);if(s&&(XL(n,t-i,e,i,a,o,g),w=Nu(a,o,g[0],g[1]),w<p)){for(p=w,_=0;_<i;++_)d[_]=g[_];d.length=i}return p}function _A(n,e,t,i,r,s,a,o,d,p,g){g=g||[NaN,NaN];for(let _=0,w=t.length;_<w;++_){const T=t[_];p=gA(n,e,T,i,r,s,a,o,d,p,g),e=T}return p}function IW(n,e,t,i,r,s,a,o,d,p,g){g=g||[NaN,NaN];for(let _=0,w=t.length;_<w;++_){const T=t[_];p=_A(n,e,T,i,r,s,a,o,d,p,g),e=T[T.length-1]}return p}function pb(n,e,t,i,r,s,a){const o=(t-e)/i;if(o<3){for(;e<t;e+=i)s[a++]=n[e],s[a++]=n[e+1];return a}const d=new Array(o);d[0]=1,d[o-1]=1;const p=[e,t-i];let g=0;for(;p.length>0;){const _=p.pop(),w=p.pop();let T=0;const I=n[w],L=n[w+1],P=n[_],C=n[_+1];for(let O=w+i;O<_;O+=i){const z=n[O],H=n[O+1],Y=oW(z,H,I,L,P,C);Y>T&&(g=O,T=Y)}T>r&&(d[(g-e)/i]=1,w+i<g&&p.push(w,g),g+i<_&&p.push(g,_))}for(let _=0;_<o;++_)d[_]&&(s[a++]=n[e+_*i],s[a++]=n[e+_*i+1]);return a}function Dz(n,e,t,i,r,s,a,o){for(let d=0,p=t.length;d<p;++d){const g=t[d];a=pb(n,e,g,i,r,s,a),o.push(a),e=g}return a}function ff(n,e){return e*Math.round(n/e)}function PW(n,e,t,i,r,s,a){if(e==t)return a;let o=ff(n[e],r),d=ff(n[e+1],r);e+=i,s[a++]=o,s[a++]=d;let p,g;do if(p=ff(n[e],r),g=ff(n[e+1],r),e+=i,e==t)return s[a++]=p,s[a++]=g,a;while(p==o&&g==d);for(;e<t;){const _=ff(n[e],r),w=ff(n[e+1],r);if(e+=i,_==p&&w==g)continue;const T=p-o,I=g-d,L=_-o,P=w-d;if(T*P==I*L&&(T<0&&L<T||T==L||T>0&&L>T)&&(I<0&&P<I||I==P||I>0&&P>I)){p=_,g=w;continue}s[a++]=p,s[a++]=g,o=p,d=g,p=_,g=w}return s[a++]=p,s[a++]=g,a}function yA(n,e,t,i,r,s,a,o){for(let d=0,p=t.length;d<p;++d){const g=t[d];a=PW(n,e,g,i,r,s,a),o.push(a),e=g}return a}function RW(n,e,t,i,r,s,a,o){for(let d=0,p=t.length;d<p;++d){const g=t[d],_=[];a=yA(n,e,g,i,r,s,a,_),o.push(_),e=g[g.length-1]}return a}function kz(n,e,t,i,r){let s;for(e+=i;e<t;e+=i)if(s=r(n.slice(e-i,e),n.slice(e,e+i)),s)return s;return!1}function Jh(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let a=e;a<t;a+=i)r[s++]=n.slice(a,a+i);return r.length=s,r}function t0(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let a=0,o=t.length;a<o;++a){const d=t[a];r[s++]=Jh(n,e,d,i,r[s]),e=d}return r.length=s,r}function zT(n,e,t,i,r){r=r!==void 0?r:[];let s=0;for(let a=0,o=t.length;a<o;++a){const d=t[a];r[s++]=d.length===1&&d[0]===e?[]:t0(n,e,d,i,r[s]),e=d[d.length-1]}return r.length=s,r}function rw(n,e,t,i,r,s,a){let o,d;const p=(t-e)/i;if(p===1)o=e;else if(p===2)o=e,d=r;else if(p!==0){let g=n[e],_=n[e+1],w=0;const T=[0];for(let P=e+i;P<t;P+=i){const C=n[P],O=n[P+1];w+=Math.sqrt((C-g)*(C-g)+(O-_)*(O-_)),T.push(w),g=C,_=O}const I=r*w,L=zH(T,I);L<0?(d=(I-T[-L-2])/(T[-L-1]-T[-L-2]),o=e+(-L-2)*i):o=e+L*i}a=a>1?a:2,s=s||new Array(a);for(let g=0;g<a;++g)s[g]=o===void 0?NaN:d===void 0?n[o+g]:Ea(n[o+g],n[o+i+g],d);return s}function BT(n,e,t,i,r,s){if(t==e)return null;let a;if(r<n[e+i-1])return s?(a=n.slice(e,e+i),a[i-1]=r,a):null;if(n[t-1]<r)return s?(a=n.slice(t-i,t),a[i-1]=r,a):null;if(r==n[e+i-1])return n.slice(e,e+i);let o=e/i,d=t/i;for(;o<d;){const w=o+d>>1;r<n[(w+1)*i-1]?d=w:o=w+1}const p=n[o*i-1];if(r==p)return n.slice((o-1)*i,(o-1)*i+i);const g=n[(o+1)*i-1],_=(r-p)/(g-p);a=[];for(let w=0;w<i-1;++w)a.push(Ea(n[(o-1)*i+w],n[o*i+w],_));return a.push(r),a}function LW(n,e,t,i,r,s,a){if(a)return BT(n,e,t[t.length-1],i,r,s);let o;if(r<n[i-1])return s?(o=n.slice(0,i),o[i-1]=r,o):null;if(n[n.length-1]<r)return s?(o=n.slice(n.length-i),o[i-1]=r,o):null;for(let d=0,p=t.length;d<p;++d){const g=t[d];if(e!=g){if(r<n[e+i-1])return null;if(r<=n[g-1])return BT(n,e,g,i,r,!1);e=g}}return null}function DW(n,e,t,i,r){return!sA(r,function(a){return!wf(n,e,t,i,a[0],a[1])})}function wf(n,e,t,i,r,s){let a=0,o=n[t-i],d=n[t-i+1];for(;e<t;e+=i){const p=n[e],g=n[e+1];d<=s?g>s&&(p-o)*(s-d)-(r-o)*(g-d)>0&&a++:g<=s&&(p-o)*(s-d)-(r-o)*(g-d)<0&&a--,o=p,d=g}return a!==0}function vA(n,e,t,i,r,s){if(t.length===0||!wf(n,e,t[0],i,r,s))return!1;for(let a=1,o=t.length;a<o;++a)if(wf(n,t[a-1],t[a],i,r,s))return!1;return!0}function kW(n,e,t,i,r,s){if(t.length===0)return!1;for(let a=0,o=t.length;a<o;++a){const d=t[a];if(vA(n,e,d,i,r,s))return!0;e=d[d.length-1]}return!1}function mb(n,e,t,i,r){const s=Tz(Da(),n,e,t,i);return No(r,s)?_m(r,s)||s[0]>=r[0]&&s[2]<=r[2]||s[1]>=r[1]&&s[3]<=r[3]?!0:kz(n,e,t,i,function(a,o){return YH(r,a,o)}):!1}function FW(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s){if(mb(n,e,t[s],i,r))return!0;e=t[s]}return!1}function Fz(n,e,t,i,r){return!!(mb(n,e,t,i,r)||wf(n,e,t,i,r[0],r[1])||wf(n,e,t,i,r[0],r[3])||wf(n,e,t,i,r[2],r[1])||wf(n,e,t,i,r[2],r[3]))}function Oz(n,e,t,i,r){if(!Fz(n,e,t[0],i,r))return!1;if(t.length===1)return!0;for(let s=1,a=t.length;s<a;++s)if(DW(n,t[s-1],t[s],i,r)&&!mb(n,t[s-1],t[s],i,r))return!1;return!0}function OW(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s){const o=t[s];if(Oz(n,e,o,i,r))return!0;e=o[o.length-1]}return!1}function Nz(n,e,t,i){let r=n[e],s=n[e+1],a=0;for(let o=e+i;o<t;o+=i){const d=n[o],p=n[o+1];a+=Math.sqrt((d-r)*(d-r)+(p-s)*(p-s)),r=d,s=p}return a}class zu extends Id{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){ll(this.flatCoordinates,e),this.changed()}clone(){const e=new zu(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<$f(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,r))}forEachSegment(e){return kz(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,BT(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Jh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return rw(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Nz(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=pb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new zu(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return mb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fb(this.flatCoordinates,0,e,this.stride),this.changed()}}class Qp extends la{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class Mu extends Qp{constructor(e,t,i,r,s,a){super(e,t,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=r!==void 0?r:!1,this.activePointers=a}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const Di={SINGLECLICK:"singleclick",CLICK:ti.CLICK,DBLCLICK:ti.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class n0 extends Id{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const r=e,s=[],a=[];for(let d=0,p=r.length;d<p;++d){const g=r[d];ll(s,g.getFlatCoordinates()),a.push(s.length)}const o=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(o,s),this.ends_=a}}appendLineString(e){ll(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new n0(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<$f(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(mA(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_A(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,LW(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return t0(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new zu(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let s=0;for(let a=0,o=t.length;a<o;++a){const d=t[a],p=new zu(e.slice(s,d),i);r.push(p),s=d}return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let a=0,o=r.length;a<o;++a){const d=r[a],p=rw(t,i,d,s,.5);ll(e,p),i=d}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=Dz(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new n0(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return FW(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=fA(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}let pd=class zz extends Id{constructor(e,t){super(),this.setCoordinates(e,t)}clone(){const e=new zz(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){const s=this.flatCoordinates,a=Nu(e,t,s[0],s[1]);if(a<r){const o=this.stride;for(let d=0;d<o;++d)i[d]=s[d];return i.length=o,a}return r}getCoordinates(){return this.flatCoordinates.slice()}computeExtent(e){return vy(this.flatCoordinates,e)}getType(){return"Point"}intersectsExtent(e){return iA(e,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(e,t){this.setLayout(t,e,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Lz(this.flatCoordinates,0,e,this.stride),this.changed()}};class N0 extends Id{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){ll(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new N0(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<$f(this.getExtent(),e,t))return r;const s=this.flatCoordinates,a=this.stride;for(let o=0,d=s.length;o<d;o+=a){const p=Nu(e,t,s[o],s[o+1]);if(p<r){r=p;for(let g=0;g<a;++g)i[g]=s[o+g];i.length=a}}return r}getCoordinates(){return Jh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new pd(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let s=0,a=e.length;s<a;s+=i){const o=new pd(e.slice(s,s+i),t);r.push(o)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,s=t.length;r<s;r+=i){const a=t[r],o=t[r+1];if(iA(e,a,o))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fb(this.flatCoordinates,0,e,this.stride),this.changed()}}function Bz(n,e,t,i){let r=0,s=n[t-i],a=n[t-i+1];for(;e<t;e+=i){const o=n[e],d=n[e+1];r+=a*o-s*d,s=o,a=d}return r/2}function Uz(n,e,t,i){let r=0;for(let s=0,a=t.length;s<a;++s){const o=t[s];r+=Bz(n,e,o,i),e=o}return r}function NW(n,e,t,i){let r=0;for(let s=0,a=t.length;s<a;++s){const o=t[s];r+=Uz(n,e,o,i),e=o[o.length-1]}return r}class i0 extends Id{constructor(e,t){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}clone(){return new i0(this.flatCoordinates.slice(),this.layout)}closestPointXY(e,t,i,r){return r<$f(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(pA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),gA(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,e,t,i,r))}getArea(){return Bz(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return Jh(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(e){const t=[];return t.length=pb(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new i0(t,"XY")}getType(){return"LinearRing"}intersectsExtent(e){return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=fb(this.flatCoordinates,0,e,this.stride),this.changed()}}function xA(n,e,t,i,r,s,a){let o,d,p,g,_,w,T;const I=r[s+1],L=[];for(let O=0,z=t.length;O<z;++O){const H=t[O];for(g=n[H-i],w=n[H-i+1],o=e;o<H;o+=i)_=n[o],T=n[o+1],(I<=w&&T<=I||w<=I&&I<=T)&&(p=(I-w)/(T-w)*(_-g)+g,L.push(p)),g=_,w=T}let P=NaN,C=-1/0;for(L.sort(Ou),g=L[0],o=1,d=L.length;o<d;++o){_=L[o];const O=Math.abs(_-g);O>C&&(p=(g+_)/2,vA(n,e,t,i,p,I)&&(P=p,C=O)),g=_}return isNaN(P)&&(P=r[s]),a?(a.push(P,I,C),a):[P,I,C]}function Vz(n,e,t,i,r){let s=[];for(let a=0,o=t.length;a<o;++a){const d=t[a];s=xA(n,e,d,i,r,2*a,s),e=d[d.length-1]}return s}function zW(n,e,t,i){for(;e<t-i;){for(let r=0;r<i;++r){const s=n[e+r];n[e+r]=n[t-i+r],n[t-i+r]=s}e+=i,t-=i}}function wA(n,e,t,i){let r=0,s=n[t-i],a=n[t-i+1];for(;e<t;e+=i){const o=n[e],d=n[e+1];r+=(o-s)*(d+a),s=o,a=d}return r===0?void 0:r>0}function Gz(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,a=t.length;s<a;++s){const o=t[s],d=wA(n,e,o,i);if(s===0){if(r&&d||!r&&!d)return!1}else if(r&&!d||!r&&d)return!1;e=o}return!0}function BW(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s){const o=t[s];if(!Gz(n,e,o,i,r))return!1;o.length&&(e=o[o.length-1])}return!0}function UT(n,e,t,i,r){r=r!==void 0?r:!1;for(let s=0,a=t.length;s<a;++s){const o=t[s],d=wA(n,e,o,i);(s===0?r&&d||!r&&!d:r&&!d||!r&&d)&&zW(n,e,o,i),e=o}return e}function ZL(n,e,t,i,r){for(let s=0,a=t.length;s<a;++s)e=UT(n,e,t[s],i,r);return e}function UW(n,e){const t=[];let i=0,r=0,s;for(let a=0,o=e.length;a<o;++a){const d=e[a],p=wA(n,i,d,2);if(s===void 0&&(s=p),p===s)t.push(e.slice(r,a+1));else{if(t.length===0)continue;t[t.length-1].push(e[r])}r=a+1,i=d}return t}class ka extends Id{constructor(e,t,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,t!==void 0&&i?(this.setFlatCoordinates(t,e),this.ends_=i):this.setCoordinates(e,t)}appendLinearRing(e){this.flatCoordinates?ll(this.flatCoordinates,e.getFlatCoordinates()):this.flatCoordinates=e.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new ka(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<$f(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(mA(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),_A(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return vA(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,t)}getArea(){return Uz(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),UT(t,0,this.ends_,this.stride,e)):t=this.flatCoordinates,t0(t,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const e=qu(this.getExtent());this.flatInteriorPoint_=xA(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new pd(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(e){return e<0||this.ends_.length<=e?null:new i0(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLinearRings(){const e=this.layout,t=this.flatCoordinates,i=this.ends_,r=[];let s=0;for(let a=0,o=i.length;a<o;++a){const d=i[a],p=new i0(t.slice(s,d),e);r.push(p),s=d}return r}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;Gz(e,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=UT(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=yA(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(e),t,0,i),new ka(t,"XY",i)}getType(){return"Polygon"}intersectsExtent(e){return Oz(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=fA(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function YL(n){if(cb(n))throw new Error("Cannot create polygon from empty extent");const e=n[0],t=n[1],i=n[2],r=n[3],s=[e,t,e,r,i,r,i,t,e,t];return new ka(s,"XY",[s.length])}function Hz(n,e,t){e=e||32;const i=n.getStride(),r=n.getLayout(),s=n.getCenter(),a=i*(e+1),o=new Array(a);for(let g=0;g<a;g+=i){o[g]=0,o[g+1]=0;for(let _=2;_<i;_++)o[g+_]=s[_]}const d=[o.length],p=new ka(o,r,d);return Wz(p,s,n.getRadius(),t),p}function Wz(n,e,t,i){const r=n.getFlatCoordinates(),s=n.getStride(),a=r.length/s-1,o=i||0;for(let d=0;d<=a;++d){const p=d*s,g=o+Af(d,a)*2*Math.PI/a;r[p]=e[0]+t*Math.cos(g),r[p+1]=e[1]+t*Math.sin(g)}n.changed()}function jz(n,e,t,i){const r=[];let s=Da();for(let a=0,o=t.length;a<o;++a){const d=t[a];s=rA(n,e,d[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=d[d.length-1]}return r}class r0 extends Id{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const r=e,s=[],a=[];for(let o=0,d=r.length;o<d;++o){const p=r[o],g=s.length,_=p.getEnds();for(let w=0,T=_.length;w<T;++w)_[w]+=g;ll(s,p.getFlatCoordinates()),a.push(_)}t=r.length===0?this.getLayout():r[0].getLayout(),e=s,i=a}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ll(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,s=t.length;r<s;++r)t[r]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new r0(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<$f(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(AW(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),IW(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return kW(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return NW(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),ZL(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,zT(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=jz(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Vz(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new N0(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;BW(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=ZL(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=RW(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new r0(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(t!==0)for(let s=0,a=i.length;s<a;++s)i[s]-=t;return new ka(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let a=0,o=i.length;a<o;++a){const d=i[a].slice(),p=d[d.length-1];if(s!==0)for(let _=0,w=d.length;_<w;++_)d[_]-=s;const g=new ka(t.slice(s,p),e,d);r.push(g),s=p}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return OW(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=TW(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}function $z(n){return Math.pow(n,3)}function Eg(n){return 1-$z(1-n)}function VW(n){return 3*n*n-2*n*n*n}function GW(n){return n}class Tg extends Uc{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(iw.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(iw.ACTIVE,e)}setMap(e){this.map_=e}}function HW(n,e,t){const i=n.getCenterInternal();if(i){const r=[i[0]+e[0],i[1]+e[1]];n.animateInternal({duration:t!==void 0?t:250,easing:GW,center:n.getConstrainedCenter(r)})}}function bA(n,e,t,i){const r=n.getZoom();if(r===void 0)return;const s=n.getConstrainedZoom(r+e),a=n.getResolutionForZoom(s);n.getAnimating()&&n.cancelAnimations(),n.animate({resolution:a,anchor:t,duration:i!==void 0?i:250,easing:Eg})}class Ju extends Tg{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==Di.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==Di.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==Di.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==Di.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function SA(n){const e=n.length;let t=0,i=0;for(let r=0;r<e;r++)t+=n[r].clientX,i+=n[r].clientY;return{clientX:t/e,clientY:i/e}}const or={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class qz extends Uc{constructor(e){super(),this.on,this.once,this.un,this.background_=e.background;const t=Object.assign({},e);typeof e.properties=="object"&&(delete t.properties,Object.assign(t,e.properties)),t[or.OPACITY]=e.opacity!==void 0?e.opacity:1,Bi(typeof t[or.OPACITY]=="number","Layer opacity must be a number"),t[or.VISIBLE]=e.visible!==void 0?e.visible:!0,t[or.Z_INDEX]=e.zIndex,t[or.MAX_RESOLUTION]=e.maxResolution!==void 0?e.maxResolution:1/0,t[or.MIN_RESOLUTION]=e.minResolution!==void 0?e.minResolution:0,t[or.MIN_ZOOM]=e.minZoom!==void 0?e.minZoom:-1/0,t[or.MAX_ZOOM]=e.maxZoom!==void 0?e.maxZoom:1/0,this.className_=t.className!==void 0?t.className:"ol-layer",delete t.className,this.setProperties(t),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(e){const t=this.state_||{layer:this,managed:e===void 0?!0:e},i=this.getZIndex();return t.opacity=es(Math.round(this.getOpacity()*100)/100,0,1),t.visible=this.getVisible(),t.extent=this.getExtent(),t.zIndex=i===void 0&&!t.managed?1/0:i,t.maxResolution=this.getMaxResolution(),t.minResolution=Math.max(this.getMinResolution(),0),t.minZoom=this.getMinZoom(),t.maxZoom=this.getMaxZoom(),this.state_=t,t}getLayersArray(e){return Gi()}getLayerStatesArray(e){return Gi()}getExtent(){return this.get(or.EXTENT)}getMaxResolution(){return this.get(or.MAX_RESOLUTION)}getMinResolution(){return this.get(or.MIN_RESOLUTION)}getMinZoom(){return this.get(or.MIN_ZOOM)}getMaxZoom(){return this.get(or.MAX_ZOOM)}getOpacity(){return this.get(or.OPACITY)}getSourceState(){return Gi()}getVisible(){return this.get(or.VISIBLE)}getZIndex(){return this.get(or.Z_INDEX)}setBackground(e){this.background_=e,this.changed()}setExtent(e){this.set(or.EXTENT,e)}setMaxResolution(e){this.set(or.MAX_RESOLUTION,e)}setMinResolution(e){this.set(or.MIN_RESOLUTION,e)}setMaxZoom(e){this.set(or.MAX_ZOOM,e)}setMinZoom(e){this.set(or.MIN_ZOOM,e)}setOpacity(e){Bi(typeof e=="number","Layer opacity must be a number"),this.set(or.OPACITY,e)}setVisible(e){this.set(or.VISIBLE,e)}setZIndex(e){this.set(or.Z_INDEX,e)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const sl={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},mo={ANIMATING:0,INTERACTING:1},bl={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"},WW=42,MA=256;function KL(n,e,t){return function(i,r,s,a,o){if(!i)return;if(!r&&!e)return i;const d=e?0:s[0]*r,p=e?0:s[1]*r,g=o?o[0]:0,_=o?o[1]:0;let w=n[0]+d/2+g,T=n[2]-d/2+g,I=n[1]+p/2+_,L=n[3]-p/2+_;w>T&&(w=(T+w)/2,T=w),I>L&&(I=(L+I)/2,L=I);let P=es(i[0],w,T),C=es(i[1],I,L);if(a&&t&&r){const O=30*r;P+=-O*Math.log(1+Math.max(0,w-i[0])/O)+O*Math.log(1+Math.max(0,i[0]-T)/O),C+=-O*Math.log(1+Math.max(0,I-i[1])/O)+O*Math.log(1+Math.max(0,i[1]-L)/O)}return[P,C]}}function jW(n){return n}function EA(n,e,t,i){const r=qi(e)/t[0],s=js(e)/t[1];return i?Math.min(n,Math.max(r,s)):Math.min(n,Math.min(r,s))}function TA(n,e,t){let i=Math.min(n,e);const r=50;return i*=Math.log(1+r*Math.max(0,n/e-1))/r+1,t&&(i=Math.max(i,t),i/=Math.log(1+r*Math.max(0,t/n-1))/r+1),es(i,t/2,e*2)}function $W(n,e,t,i){return e=e!==void 0?e:!0,function(r,s,a,o){if(r!==void 0){const d=n[0],p=n[n.length-1],g=t?EA(d,t,a,i):d;if(o)return e?TA(r,g,p):es(r,p,g);const _=Math.min(g,r),w=Math.floor(nA(n,_,s));return n[w]>g&&w<n.length-1?n[w+1]:n[w]}}}function qW(n,e,t,i,r,s){return i=i!==void 0?i:!0,t=t!==void 0?t:0,function(a,o,d,p){if(a!==void 0){const g=r?EA(e,r,d,s):e;if(p)return i?TA(a,g,t):es(a,t,g);const _=1e-9,w=Math.ceil(Math.log(e/g)/Math.log(n)-_),T=-o*(.5-_)+.5,I=Math.min(g,a),L=Math.floor(Math.log(e/I)/Math.log(n)+T),P=Math.max(w,L),C=e/Math.pow(n,P);return es(C,t,g)}}}function JL(n,e,t,i,r){return t=t!==void 0?t:!0,function(s,a,o,d){if(s!==void 0){const p=i?EA(n,i,o,r):n;return!t||!d?es(s,e,p):TA(s,p,e)}}}function CA(n){if(n!==void 0)return 0}function QL(n){if(n!==void 0)return n}function XW(n){const e=2*Math.PI/n;return function(t,i){if(i)return t;if(t!==void 0)return t=Math.floor(t/e+.5)*e,t}}function ZW(n){const e=s1(5);return function(t,i){return i||t===void 0?t:Math.abs(t)<=e?0:t}}const oM=0;class Sc extends Uc{constructor(e){super(),this.on,this.once,this.un,e=Object.assign({},e),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=hA(e.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,e.projection&&gW(),e.center&&(e.center=er(e.center,this.projection_)),e.extent&&(e.extent=Kh(e.extent,this.projection_)),this.applyOptions_(e)}applyOptions_(e){const t=Object.assign({},e);for(const o in bl)delete t[o];this.setProperties(t,!0);const i=KW(e);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=e.resolutions,this.padding_=e.padding,this.minZoom_=i.minZoom;const r=YW(e),s=i.constraint,a=JW(e);this.constraints_={center:r,resolution:s,rotation:a},this.setRotation(e.rotation!==void 0?e.rotation:0),this.setCenterInternal(e.center!==void 0?e.center:null),e.resolution!==void 0?this.setResolution(e.resolution):e.zoom!==void 0&&this.setZoom(e.zoom)}get padding(){return this.padding_}set padding(e){let t=this.padding_;this.padding_=e;const i=this.getCenterInternal();if(i){const r=e||[0,0,0,0];t=t||[0,0,0,0];const s=this.getResolution(),a=s/2*(r[3]-t[3]+t[1]-r[1]),o=s/2*(r[0]-t[0]+t[2]-r[2]);this.setCenterInternal([i[0]+a,i[1]-o])}}getUpdatedOptions_(e){const t=this.getProperties();return t.resolution!==void 0?t.resolution=this.getResolution():t.zoom=this.getZoom(),t.center=this.getCenterInternal(),t.rotation=this.getRotation(),Object.assign({},t,e)}animate(e){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const t=new Array(arguments.length);for(let i=0;i<t.length;++i){let r=arguments[i];r.center&&(r=Object.assign({},r),r.center=er(r.center,this.getProjection())),r.anchor&&(r=Object.assign({},r),r.anchor=er(r.anchor,this.getProjection())),t[i]=r}this.animateInternal.apply(this,t)}animateInternal(e){let t=arguments.length,i;t>1&&typeof arguments[t-1]=="function"&&(i=arguments[t-1],--t);let r=0;for(;r<t&&!this.isDef();++r){const g=arguments[r];g.center&&this.setCenterInternal(g.center),g.zoom!==void 0?this.setZoom(g.zoom):g.resolution&&this.setResolution(g.resolution),g.rotation!==void 0&&this.setRotation(g.rotation)}if(r===t){i&&ex(i,!0);return}let s=Date.now(),a=this.targetCenter_.slice(),o=this.targetResolution_,d=this.targetRotation_;const p=[];for(;r<t;++r){const g=arguments[r],_={start:s,complete:!1,anchor:g.anchor,duration:g.duration!==void 0?g.duration:1e3,easing:g.easing||VW,callback:i};if(g.center&&(_.sourceCenter=a,_.targetCenter=g.center.slice(),a=_.targetCenter),g.zoom!==void 0?(_.sourceResolution=o,_.targetResolution=this.getResolutionForZoom(g.zoom),o=_.targetResolution):g.resolution&&(_.sourceResolution=o,_.targetResolution=g.resolution,o=_.targetResolution),g.rotation!==void 0){_.sourceRotation=d;const w=Af(g.rotation-d+Math.PI,2*Math.PI)-Math.PI;_.targetRotation=d+w,d=_.targetRotation}QW(_)?_.complete=!0:s+=_.duration,p.push(_)}this.animations_.push(p),this.setHint(mo.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[mo.ANIMATING]>0}getInteracting(){return this.hints_[mo.INTERACTING]>0}cancelAnimations(){this.setHint(mo.ANIMATING,-this.hints_[mo.ANIMATING]);let e;for(let t=0,i=this.animations_.length;t<i;++t){const r=this.animations_[t];if(r[0].callback&&ex(r[0].callback,!1),!e)for(let s=0,a=r.length;s<a;++s){const o=r[s];if(!o.complete){e=o.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=e,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const e=Date.now();let t=!1;for(let i=this.animations_.length-1;i>=0;--i){const r=this.animations_[i];let s=!0;for(let a=0,o=r.length;a<o;++a){const d=r[a];if(d.complete)continue;const p=e-d.start;let g=d.duration>0?p/d.duration:1;g>=1?(d.complete=!0,g=1):s=!1;const _=d.easing(g);if(d.sourceCenter){const w=d.sourceCenter[0],T=d.sourceCenter[1],I=d.targetCenter[0],L=d.targetCenter[1];this.nextCenter_=d.targetCenter;const P=w+_*(I-w),C=T+_*(L-T);this.targetCenter_=[P,C]}if(d.sourceResolution&&d.targetResolution){const w=_===1?d.targetResolution:d.sourceResolution+_*(d.targetResolution-d.sourceResolution);if(d.anchor){const T=this.getViewportSize_(this.getRotation()),I=this.constraints_.resolution(w,0,T,!0);this.targetCenter_=this.calculateCenterZoom(I,d.anchor)}this.nextResolution_=d.targetResolution,this.targetResolution_=w,this.applyTargetState_(!0)}if(d.sourceRotation!==void 0&&d.targetRotation!==void 0){const w=_===1?Af(d.targetRotation+Math.PI,2*Math.PI)-Math.PI:d.sourceRotation+_*(d.targetRotation-d.sourceRotation);if(d.anchor){const T=this.constraints_.rotation(w,!0);this.targetCenter_=this.calculateCenterRotate(T,d.anchor)}this.nextRotation_=d.targetRotation,this.targetRotation_=w}if(this.applyTargetState_(!0),t=!0,!d.complete)break}if(s){this.animations_[i]=null,this.setHint(mo.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const a=r[0].callback;a&&ex(a,!0)}}this.animations_=this.animations_.filter(Boolean),t&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(e,t){let i;const r=this.getCenterInternal();return r!==void 0&&(i=[r[0]-t[0],r[1]-t[1]],aA(i,e-this.getRotation()),lW(i,t)),i}calculateCenterZoom(e,t){let i;const r=this.getCenterInternal(),s=this.getResolution();if(r!==void 0&&s!==void 0){const a=t[0]-e*(t[0]-r[0])/s,o=t[1]-e*(t[1]-r[1])/s;i=[a,o]}return i}getViewportSize_(e){const t=this.viewportSize_;if(e){const i=t[0],r=t[1];return[Math.abs(i*Math.cos(e))+Math.abs(r*Math.sin(e)),Math.abs(i*Math.sin(e))+Math.abs(r*Math.cos(e))]}return t}setViewportSize(e){this.viewportSize_=Array.isArray(e)?e.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const e=this.getCenterInternal();return e&&Of(e,this.getProjection())}getCenterInternal(){return this.get(bl.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(e){return e!==void 0?(e[0]=this.hints_[0],e[1]=this.hints_[1],e):this.hints_.slice()}calculateExtent(e){const t=this.calculateExtentInternal(e);return db(t,this.getProjection())}calculateExtentInternal(e){e=e||this.getViewportSizeMinusPadding_();const t=this.getCenterInternal();Bi(t,"The view center is not defined");const i=this.getResolution();Bi(i!==void 0,"The view resolution is not defined");const r=this.getRotation();return Bi(r!==void 0,"The view rotation is not defined"),kT(t,i,r,e)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(e){this.applyOptions_(this.getUpdatedOptions_({maxZoom:e}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(e){this.applyOptions_(this.getUpdatedOptions_({minZoom:e}))}setConstrainResolution(e){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:e}))}getProjection(){return this.projection_}getResolution(){return this.get(bl.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(e,t){return this.getResolutionForExtentInternal(Kh(e,this.getProjection()),t)}getResolutionForExtentInternal(e,t){t=t||this.getViewportSizeMinusPadding_();const i=qi(e)/t[0],r=js(e)/t[1];return Math.max(i,r)}getResolutionForValueFunction(e){e=e||2;const t=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,r=Math.log(t/i)/Math.log(e);return function(s){return t/Math.pow(e,s*r)}}getRotation(){return this.get(bl.ROTATION)}getValueForResolutionFunction(e){const t=Math.log(e||2),i=this.getConstrainedResolution(this.maxResolution_),r=this.minResolution_,s=Math.log(i/r)/t;return function(a){return Math.log(i/a)/t/s}}getViewportSizeMinusPadding_(e){let t=this.getViewportSize_(e);const i=this.padding_;return i&&(t=[t[0]-i[1]-i[3],t[1]-i[0]-i[2]]),t}getState(){const e=this.getProjection(),t=this.getResolution(),i=this.getRotation();let r=this.getCenterInternal();const s=this.padding_;if(s){const a=this.getViewportSizeMinusPadding_();r=aM(r,this.getViewportSize_(),[a[0]/2+s[3],a[1]/2+s[0]],t,i)}return{center:r.slice(0),projection:e!==void 0?e:null,resolution:t,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let e;const t=this.getResolution();return t!==void 0&&(e=this.getZoomForResolution(t)),e}getZoomForResolution(e){let t=this.minZoom_||0,i,r;if(this.resolutions_){const s=nA(this.resolutions_,e,1);t=s,i=this.resolutions_[s],s==this.resolutions_.length-1?r=2:r=i/this.resolutions_[s+1]}else i=this.maxResolution_,r=this.zoomFactor_;return t+Math.log(i/e)/Math.log(r)}getResolutionForZoom(e){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const t=es(Math.floor(e),0,this.resolutions_.length-2),i=this.resolutions_[t]/this.resolutions_[t+1];return this.resolutions_[t]/Math.pow(i,es(e-t,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,e-this.minZoom_)}fit(e,t){let i;if(Bi(Array.isArray(e)||typeof e.getSimplifiedGeometry=="function","Invalid extent or geometry provided as `geometry`"),Array.isArray(e)){Bi(!cb(e),"Cannot fit empty extent provided as `geometry`");const r=Kh(e,this.getProjection());i=YL(r)}else if(e.getType()==="Circle"){const r=Kh(e.getExtent(),this.getProjection());i=YL(r),i.rotate(this.getRotation(),qu(r))}else i=e;this.fitInternal(i,t)}rotatedExtentForGeometry(e){const t=this.getRotation(),i=Math.cos(t),r=Math.sin(-t),s=e.getFlatCoordinates(),a=e.getStride();let o=1/0,d=1/0,p=-1/0,g=-1/0;for(let _=0,w=s.length;_<w;_+=a){const T=s[_]*i-s[_+1]*r,I=s[_]*r+s[_+1]*i;o=Math.min(o,T),d=Math.min(d,I),p=Math.max(p,T),g=Math.max(g,I)}return[o,d,p,g]}fitInternal(e,t){t=t||{};let i=t.size;i||(i=this.getViewportSizeMinusPadding_());const r=t.padding!==void 0?t.padding:[0,0,0,0],s=t.nearest!==void 0?t.nearest:!1;let a;t.minResolution!==void 0?a=t.minResolution:t.maxZoom!==void 0?a=this.getResolutionForZoom(t.maxZoom):a=0;const o=this.rotatedExtentForGeometry(e);let d=this.getResolutionForExtentInternal(o,[i[0]-r[1]-r[3],i[1]-r[0]-r[2]]);d=isNaN(d)?a:Math.max(d,a),d=this.getConstrainedResolution(d,s?0:1);const p=this.getRotation(),g=Math.sin(p),_=Math.cos(p),w=qu(o);w[0]+=(r[1]-r[3])/2*d,w[1]+=(r[0]-r[2])/2*d;const T=w[0]*_-w[1]*g,I=w[1]*_+w[0]*g,L=this.getConstrainedCenter([T,I],d),P=t.callback?t.callback:Jm;t.duration!==void 0?this.animateInternal({resolution:d,center:L,duration:t.duration,easing:t.easing},P):(this.targetResolution_=d,this.targetCenter_=L,this.applyTargetState_(!1,!0),ex(P,!0))}centerOn(e,t,i){this.centerOnInternal(er(e,this.getProjection()),t,i)}centerOnInternal(e,t,i){this.setCenterInternal(aM(e,t,i,this.getResolution(),this.getRotation()))}calculateCenterShift(e,t,i,r){let s;const a=this.padding_;if(a&&e){const o=this.getViewportSizeMinusPadding_(-i),d=aM(e,r,[o[0]/2+a[3],o[1]/2+a[0]],t,i);s=[e[0]-d[0],e[1]-d[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(e){const t=Of(this.targetCenter_,this.getProjection());this.setCenter([t[0]+e[0],t[1]+e[1]])}adjustCenterInternal(e){const t=this.targetCenter_;this.setCenterInternal([t[0]+e[0],t[1]+e[1]])}adjustResolution(e,t){t=t&&er(t,this.getProjection()),this.adjustResolutionInternal(e,t)}adjustResolutionInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*e,0,r,i);t&&(this.targetCenter_=this.calculateCenterZoom(s,t)),this.targetResolution_*=e,this.applyTargetState_()}adjustZoom(e,t){this.adjustResolution(Math.pow(this.zoomFactor_,-e),t)}adjustRotation(e,t){t&&(t=er(t,this.getProjection())),this.adjustRotationInternal(e,t)}adjustRotationInternal(e,t){const i=this.getAnimating()||this.getInteracting(),r=this.constraints_.rotation(this.targetRotation_+e,i);t&&(this.targetCenter_=this.calculateCenterRotate(r,t)),this.targetRotation_+=e,this.applyTargetState_()}setCenter(e){this.setCenterInternal(e&&er(e,this.getProjection()))}setCenterInternal(e){this.targetCenter_=e,this.applyTargetState_()}setHint(e,t){return this.hints_[e]+=t,this.changed(),this.hints_[e]}setResolution(e){this.targetResolution_=e,this.applyTargetState_()}setRotation(e){this.targetRotation_=e,this.applyTargetState_()}setZoom(e){this.setResolution(this.getResolutionForZoom(e))}applyTargetState_(e,t){const i=this.getAnimating()||this.getInteracting()||t,r=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(r),a=this.constraints_.resolution(this.targetResolution_,0,s,i),o=this.constraints_.center(this.targetCenter_,a,s,i,this.calculateCenterShift(this.targetCenter_,a,r,s));this.get(bl.ROTATION)!==r&&this.set(bl.ROTATION,r),this.get(bl.RESOLUTION)!==a&&(this.set(bl.RESOLUTION,a),this.set("zoom",this.getZoom(),!0)),(!o||!this.get(bl.CENTER)||!Il(this.get(bl.CENTER),o))&&this.set(bl.CENTER,o),this.getAnimating()&&!e&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(e,t,i){e=e!==void 0?e:200;const r=t||0,s=this.constraints_.rotation(this.targetRotation_),a=this.getViewportSize_(s),o=this.constraints_.resolution(this.targetResolution_,r,a),d=this.constraints_.center(this.targetCenter_,o,a,!1,this.calculateCenterShift(this.targetCenter_,o,s,a));if(e===0&&!this.cancelAnchor_){this.targetResolution_=o,this.targetRotation_=s,this.targetCenter_=d,this.applyTargetState_();return}i=i||(e===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==o||this.getRotation()!==s||!this.getCenterInternal()||!Il(this.getCenterInternal(),d))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:d,resolution:o,duration:e,easing:Eg,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(mo.INTERACTING,1)}endInteraction(e,t,i){i=i&&er(i,this.getProjection()),this.endInteractionInternal(e,t,i)}endInteractionInternal(e,t,i){this.getInteracting()&&(this.setHint(mo.INTERACTING,-1),this.resolveConstraints(e,t,i))}getConstrainedCenter(e,t){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(e,t||this.getResolution(),i)}getConstrainedZoom(e,t){const i=this.getResolutionForZoom(e);return this.getZoomForResolution(this.getConstrainedResolution(i,t))}getConstrainedResolution(e,t){t=t||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(e,t,i)}}function ex(n,e){setTimeout(function(){n(e)},0)}function YW(n){if(n.extent!==void 0){const t=n.smoothExtentConstraint!==void 0?n.smoothExtentConstraint:!0;return KL(n.extent,n.constrainOnlyCenter,t)}const e=hA(n.projection,"EPSG:3857");if(n.multiWorld!==!0&&e.isGlobal()){const t=e.getExtent().slice();return t[0]=-1/0,t[2]=1/0,KL(t,!1,!1)}return jW}function KW(n){let e,t,i,a=n.minZoom!==void 0?n.minZoom:oM,o=n.maxZoom!==void 0?n.maxZoom:28;const d=n.zoomFactor!==void 0?n.zoomFactor:2,p=n.multiWorld!==void 0?n.multiWorld:!1,g=n.smoothResolutionConstraint!==void 0?n.smoothResolutionConstraint:!0,_=n.showFullExtent!==void 0?n.showFullExtent:!1,w=hA(n.projection,"EPSG:3857"),T=w.getExtent();let I=n.constrainOnlyCenter,L=n.extent;if(!p&&!L&&w.isGlobal()&&(I=!1,L=T),n.resolutions!==void 0){const P=n.resolutions;t=P[a],i=P[o]!==void 0?P[o]:P[P.length-1],n.constrainResolution?e=$W(P,g,!I&&L,_):e=JL(t,i,g,!I&&L,_)}else{const C=(T?Math.max(qi(T),js(T)):360*ng.degrees/w.getMetersPerUnit())/MA/Math.pow(2,oM),O=C/Math.pow(2,28-oM);t=n.maxResolution,t!==void 0?a=0:t=C/Math.pow(d,a),i=n.minResolution,i===void 0&&(n.maxZoom!==void 0?n.maxResolution!==void 0?i=t/Math.pow(d,o):i=C/Math.pow(d,o):i=O),o=a+Math.floor(Math.log(t/i)/Math.log(d)),i=t/Math.pow(d,o-a),n.constrainResolution?e=qW(d,t,i,g,!I&&L,_):e=JL(t,i,g,!I&&L,_)}return{constraint:e,maxResolution:t,minResolution:i,minZoom:a,zoomFactor:d}}function JW(n){if(n.enableRotation!==void 0?n.enableRotation:!0){const t=n.constrainRotation;return t===void 0||t===!0?ZW():t===!1?QL:typeof t=="number"?XW(t):QL}return CA}function QW(n){return!(n.sourceCenter&&n.targetCenter&&!Il(n.sourceCenter,n.targetCenter)||n.sourceResolution!==n.targetResolution||n.sourceRotation!==n.targetRotation)}function aM(n,e,t,i,r){const s=Math.cos(-r);let a=Math.sin(-r),o=n[0]*s-n[1]*a,d=n[1]*s+n[0]*a;o+=(e[0]/2-t[0])*i,d+=(t[1]-e[1]/2)*i,a=-a;const p=o*s-d*a,g=d*s+o*a;return[p,g]}class gb extends qz{constructor(e){const t=Object.assign({},e);delete t.source,super(t),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,e.render&&(this.render=e.render),e.map&&this.setMap(e.map),this.addChangeListener(or.SOURCE,this.handleSourcePropertyChange_);const i=e.source?e.source:null;this.setSource(i)}getLayersArray(e){return e=e||[],e.push(this),e}getLayerStatesArray(e){return e=e||[],e.push(this.getLayerState()),e}getSource(){return this.get(or.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const e=this.getSource();return e?e.getState():"undefined"}handleSourceChange_(){this.changed(),!(this.sourceReady_||this.getSource().getState()!=="ready")&&(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&(cr(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const e=this.getSource();e&&(this.sourceChangeKey_=fi(e,ti.CHANGE,this.handleSourceChange_,this),e.getState()==="ready"&&(this.sourceReady_=!0,setTimeout(()=>{this.dispatchEvent("sourceready")},0))),this.changed()}getFeatures(e){return this.renderer_?this.renderer_.getFeatures(e):Promise.resolve([])}getData(e){return!this.renderer_||!this.rendered?null:this.renderer_.getData(e)}isVisible(e){let t;const i=this.getMapInternal();!e&&i&&(e=i.getView()),e instanceof Sc?t={viewState:e.getState(),extent:e.calculateExtent()}:t=e,!t.layerStatesArray&&i&&(t.layerStatesArray=i.getLayerGroup().getLayerStatesArray());let r;t.layerStatesArray?r=t.layerStatesArray.find(a=>a.layer===this):r=this.getLayerState();const s=this.getExtent();return AA(r,t.viewState)&&(!s||No(s,t.extent))}getAttributions(e){if(!this.isVisible(e))return[];let t;const i=this.getSource();if(i&&(t=i.getAttributions()),!t)return[];const r=e instanceof Sc?e.getViewStateAndExtent():e;let s=t(r);return Array.isArray(s)||(s=[s]),s}render(e,t){const i=this.getRenderer();return i.prepareFrame(e)?(this.rendered=!0,i.renderFrame(e,t)):null}unrender(){this.rendered=!1}getDeclutter(){}renderDeclutter(e,t){}renderDeferred(e){const t=this.getRenderer();t&&t.renderDeferred(e)}setMapInternal(e){e||this.unrender(),this.set(or.MAP,e)}getMapInternal(){return this.get(or.MAP)}setMap(e){this.mapPrecomposeKey_&&(cr(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),e||this.changed(),this.mapRenderKey_&&(cr(this.mapRenderKey_),this.mapRenderKey_=null),e&&(this.mapPrecomposeKey_=fi(e,sl.PRECOMPOSE,function(t){const r=t.frameState.layerStatesArray,s=this.getLayerState(!1);Bi(!r.some(function(a){return a.layer===s.layer}),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),r.push(s)},this),this.mapRenderKey_=fi(this,ti.CHANGE,e.render,e),this.changed())}setSource(e){this.set(or.SOURCE,e)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function AA(n,e){if(!n.visible)return!1;const t=e.resolution;if(t<n.minResolution||t>=n.maxResolution)return!1;const i=e.zoom;return i>n.minZoom&&i<=n.maxZoom}function e9(n,e,t,i,r){Xz(n,e,t||0,i||n.length-1,r||t9)}function Xz(n,e,t,i,r){for(;i>t;){if(i-t>600){var s=i-t+1,a=e-t+1,o=Math.log(s),d=.5*Math.exp(2*o/3),p=.5*Math.sqrt(o*d*(s-d)/s)*(a-s/2<0?-1:1),g=Math.max(t,Math.floor(e-a*d/s+p)),_=Math.min(i,Math.floor(e+(s-a)*d/s+p));Xz(n,e,g,_,r)}var w=n[e],T=t,I=i;for(R_(n,t,e),r(n[i],w)>0&&R_(n,t,i);T<I;){for(R_(n,T,I),T++,I--;r(n[T],w)<0;)T++;for(;r(n[I],w)>0;)I--}r(n[t],w)===0?R_(n,t,I):(I++,R_(n,I,i)),I<=e&&(t=I+1),e<=I&&(i=I-1)}}function R_(n,e,t){var i=n[e];n[e]=n[t],n[t]=i}function t9(n,e){return n<e?-1:n>e?1:0}let Zz=class{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data;const i=[];if(!nx(e,t))return i;const r=this.toBBox,s=[];for(;t;){for(let a=0;a<t.children.length;a++){const o=t.children[a],d=t.leaf?r(o):o;nx(e,d)&&(t.leaf?i.push(o):cM(e,d)?this._all(o,i):s.push(o))}t=s.pop()}return i}collides(e){let t=this.data;if(!nx(e,t))return!1;const i=[];for(;t;){for(let r=0;r<t.children.length;r++){const s=t.children[r],a=t.leaf?this.toBBox(s):s;if(nx(e,a)){if(t.leaf||cM(e,a))return!0;i.push(s)}}t=i.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=em([]),this}remove(e,t){if(!e)return this;let i=this.data;const r=this.toBBox(e),s=[],a=[];let o,d,p;for(;i||s.length;){if(i||(i=s.pop(),d=s[s.length-1],o=a.pop(),p=!0),i.leaf){const g=n9(e,i.children,t);if(g!==-1)return i.children.splice(g,1),s.push(i),this._condense(s),this}!p&&!i.leaf&&cM(i,r)?(s.push(i),a.push(o),o=0,d=i,i=i.children[0]):d?(o++,i=d.children[o],p=!1):i=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,r){const s=i-t+1;let a=this._maxEntries,o;if(s<=a)return o=em(e.slice(t,i+1)),Ap(o,this.toBBox),o;r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,r-1))),o=em([]),o.leaf=!1,o.height=r;const d=Math.ceil(s/a),p=d*Math.ceil(Math.sqrt(a));eD(e,t,i,p,this.compareMinX);for(let g=t;g<=i;g+=p){const _=Math.min(g+p-1,i);eD(e,g,_,d,this.compareMinY);for(let w=g;w<=_;w+=d){const T=Math.min(w+d-1,_);o.children.push(this._build(e,w,T,r-1))}}return Ap(o,this.toBBox),o}_chooseSubtree(e,t,i,r){for(;r.push(t),!(t.leaf||r.length-1===i);){let s=1/0,a=1/0,o;for(let d=0;d<t.children.length;d++){const p=t.children[d],g=lM(p),_=s9(e,p)-g;_<a?(a=_,s=g<s?g:s,o=p):_===a&&g<s&&(s=g,o=p)}t=o||t.children[0]}return t}_insert(e,t,i){const r=i?e:this.toBBox(e),s=[],a=this._chooseSubtree(r,this.data,t,s);for(a.children.push(e),ny(a,r);t>=0&&s[t].children.length>this._maxEntries;)this._split(s,t),t--;this._adjustParentBBoxes(r,s,t)}_split(e,t){const i=e[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);const a=this._chooseSplitIndex(i,s,r),o=em(i.children.splice(a,i.children.length-a));o.height=i.height,o.leaf=i.leaf,Ap(i,this.toBBox),Ap(o,this.toBBox),t?e[t-1].children.push(o):this._splitRoot(i,o)}_splitRoot(e,t){this.data=em([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ap(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let r,s=1/0,a=1/0;for(let o=t;o<=i-t;o++){const d=ty(e,0,o,this.toBBox),p=ty(e,o,i,this.toBBox),g=o9(d,p),_=lM(d)+lM(p);g<s?(s=g,r=o,a=_<a?_:a):g===s&&_<a&&(a=_,r=o)}return r||i-t}_chooseSplitAxis(e,t,i){const r=e.leaf?this.compareMinX:i9,s=e.leaf?this.compareMinY:r9,a=this._allDistMargin(e,t,i,r),o=this._allDistMargin(e,t,i,s);a<o&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const s=this.toBBox,a=ty(e,0,t,s),o=ty(e,i-t,i,s);let d=tx(a)+tx(o);for(let p=t;p<i-t;p++){const g=e.children[p];ny(a,e.leaf?s(g):g),d+=tx(a)}for(let p=i-t-1;p>=t;p--){const g=e.children[p];ny(o,e.leaf?s(g):g),d+=tx(o)}return d}_adjustParentBBoxes(e,t,i){for(let r=i;r>=0;r--)ny(t[r],e)}_condense(e){for(let t=e.length-1,i;t>=0;t--)e[t].children.length===0?t>0?(i=e[t-1].children,i.splice(i.indexOf(e[t]),1)):this.clear():Ap(e[t],this.toBBox)}};function n9(n,e,t){if(!t)return e.indexOf(n);for(let i=0;i<e.length;i++)if(t(n,e[i]))return i;return-1}function Ap(n,e){ty(n,0,n.children.length,e,n)}function ty(n,e,t,i,r){r||(r=em(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s=e;s<t;s++){const a=n.children[s];ny(r,n.leaf?i(a):a)}return r}function ny(n,e){return n.minX=Math.min(n.minX,e.minX),n.minY=Math.min(n.minY,e.minY),n.maxX=Math.max(n.maxX,e.maxX),n.maxY=Math.max(n.maxY,e.maxY),n}function i9(n,e){return n.minX-e.minX}function r9(n,e){return n.minY-e.minY}function lM(n){return(n.maxX-n.minX)*(n.maxY-n.minY)}function tx(n){return n.maxX-n.minX+(n.maxY-n.minY)}function s9(n,e){return(Math.max(e.maxX,n.maxX)-Math.min(e.minX,n.minX))*(Math.max(e.maxY,n.maxY)-Math.min(e.minY,n.minY))}function o9(n,e){const t=Math.max(n.minX,e.minX),i=Math.max(n.minY,e.minY),r=Math.min(n.maxX,e.maxX),s=Math.min(n.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,s-i)}function cM(n,e){return n.minX<=e.minX&&n.minY<=e.minY&&e.maxX<=n.maxX&&e.maxY<=n.maxY}function nx(n,e){return e.minX<=n.maxX&&e.minY<=n.maxY&&e.maxX>=n.minX&&e.maxY>=n.minY}function em(n){return{children:n,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function eD(n,e,t,i,r){const s=[e,t];for(;s.length;){if(t=s.pop(),e=s.pop(),t-e<=i)continue;const a=e+Math.ceil((t-e)/i/2)*i;e9(n,a,e,t,r),s.push(e,a,a,t)}}const xi={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function tD(n){return n[0]>0&&n[1]>0}function a9(n,e,t){return t===void 0&&(t=[0,0]),t[0]=n[0]*e+.5|0,t[1]=n[1]*e+.5|0,t}function Ia(n,e){return Array.isArray(n)?n:(e===void 0?e=[n,n]:(e[0]=n,e[1]=n),e)}class _b{constructor(e){this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=Ia(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new _b({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return Gi()}getImage(e){return Gi()}getHitDetectionImage(){return Gi()}getPixelRatio(e){return 1}getImageState(){return Gi()}getImageSize(){return Gi()}getOrigin(){return Gi()}getSize(){return Gi()}setDisplacement(e){this.displacement_=e}setOpacity(e){this.opacity_=e}setRotateWithView(e){this.rotateWithView_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Ia(e)}listenImageChange(e){Gi()}load(){Gi()}unlistenImageChange(e){Gi()}ready(){return Promise.resolve()}}const s0={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var $s={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"]};$s.whitepoint={2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}};$s.max=$s.whitepoint[2].D65;$s.rgb=function(n,e){e=e||$s.whitepoint[2].E;var t=n[0]/e[0],i=n[1]/e[1],r=n[2]/e[2],s,a,o;return s=t*3.240969941904521+i*-1.537383177570093+r*-.498610760293,a=t*-.96924363628087+i*1.87596750150772+r*.041555057407175,o=t*.055630079696993+i*-.20397695888897+r*1.056971514242878,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:s=s*12.92,a=a>.0031308?1.055*Math.pow(a,1/2.4)-.055:a=a*12.92,o=o>.0031308?1.055*Math.pow(o,1/2.4)-.055:o=o*12.92,s=Math.min(Math.max(0,s),1),a=Math.min(Math.max(0,a),1),o=Math.min(Math.max(0,o),1),[s*255,a*255,o*255]};s0.xyz=function(n,e){var t=n[0]/255,i=n[1]/255,r=n[2]/255;t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;var s=t*.41239079926595+i*.35758433938387+r*.18048078840183,a=t*.21263900587151+i*.71516867876775+r*.072192315360733,o=t*.019330818715591+i*.11919477979462+r*.95053215224966;return e=e||$s.whitepoint[2].E,[s*e[0],a*e[1],o*e[2]]};const IA={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(n,e,t){var i,r,s,a,o,d,p,g,_,w,T,I,L;if(s=n[0],a=n[1],o=n[2],s===0)return[0,0,0];var P=.0011070564598794539;return e=e||"D65",t=t||2,_=$s.whitepoint[t][e][0],w=$s.whitepoint[t][e][1],T=$s.whitepoint[t][e][2],I=4*_/(_+15*w+3*T),L=9*w/(_+15*w+3*T),i=a/(13*s)+I||0,r=o/(13*s)+L||0,p=s>8?w*Math.pow((s+16)/116,3):w*s*P,d=p*9*i/(4*r)||0,g=p*(12-3*i-20*r)/(4*r)||0,[d,p,g]}};$s.luv=function(n,e,t){var i,r,s,a,o,d,p,g,_,w,T,I,L,P=.008856451679035631,C=903.2962962962961;e=e||"D65",t=t||2,_=$s.whitepoint[t][e][0],w=$s.whitepoint[t][e][1],T=$s.whitepoint[t][e][2],I=4*_/(_+15*w+3*T),L=9*w/(_+15*w+3*T),d=n[0],p=n[1],g=n[2],i=4*d/(d+15*p+3*g)||0,r=9*p/(d+15*p+3*g)||0;var O=p/w;return s=O<=P?C*O:116*Math.pow(O,1/3)-16,a=13*s*(i-I),o=13*s*(r-L),[s,a,o]};var Yz={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(n){var e=n[0],t=n[1],i=n[2],r,s,a;return a=i/360*2*Math.PI,r=t*Math.cos(a),s=t*Math.sin(a),[e,r,s]},xyz:function(n){return IA.xyz(Yz.luv(n))}};IA.lchuv=function(n){var e=n[0],t=n[1],i=n[2],r=Math.sqrt(t*t+i*i),s=Math.atan2(i,t),a=s*360/2/Math.PI;return a<0&&(a+=360),[e,r,a]};$s.lchuv=function(n){return IA.lchuv($s.luv(n))};const nD={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var iD={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function l9(n){var g,_;var e,t=[],i=1,r;if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(typeof n=="number")return{space:"rgb",values:[n>>>16,(n&65280)>>>8,n&255],alpha:1};if(n=String(n).toLowerCase(),nD[n])t=nD[n].slice(),r="rgb";else if(n==="transparent")i=0,r="rgb",t=[0,0,0];else if(n[0]==="#"){var s=n.slice(1),a=s.length,o=a<=4;i=1,o?(t=[parseInt(s[0]+s[0],16),parseInt(s[1]+s[1],16),parseInt(s[2]+s[2],16)],a===4&&(i=parseInt(s[3]+s[3],16)/255)):(t=[parseInt(s[0]+s[1],16),parseInt(s[2]+s[3],16),parseInt(s[4]+s[5],16)],a===8&&(i=parseInt(s[6]+s[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),r="rgb"}else if(e=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(n)){var d=e[1];r=d.replace(/a$/,"");var p=r==="cmyk"?4:r==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/),r==="color"&&(r=t.shift()),t=t.map(function(w,T){if(w[w.length-1]==="%")return w=parseFloat(w)/100,T===3?w:r==="rgb"?w*255:r[0]==="h"||r[0]==="l"&&!T?w*100:r==="lab"?w*125:r==="lch"?T<2?w*150:w*360:r[0]==="o"&&!T?w:r==="oklab"?w*.4:r==="oklch"?T<2?w*.4:w*360:w;if(r[T]==="h"||T===2&&r[r.length-1]==="h"){if(iD[w]!==void 0)return iD[w];if(w.endsWith("deg"))return parseFloat(w);if(w.endsWith("turn"))return parseFloat(w)*360;if(w.endsWith("grad"))return parseFloat(w)*360/400;if(w.endsWith("rad"))return parseFloat(w)*180/Math.PI}return w==="none"?0:parseFloat(w)}),i=t.length>p?t.pop():1}else/[0-9](?:\s|\/|,)/.test(n)&&(t=n.match(/([0-9]+)/g).map(function(w){return parseFloat(w)}),r=((_=(g=n.match(/([a-z])/ig))==null?void 0:g.join(""))==null?void 0:_.toLowerCase())||"rgb");return{space:r,values:t,alpha:i}}const uM={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(n){var e=n[0]/360,t=n[1]/100,i=n[2]/100,r,s,a,o,d,p=0;if(t===0)return d=i*255,[d,d,d];for(s=i<.5?i*(1+t):i+t-i*t,r=2*i-s,o=[0,0,0];p<3;)a=e+1/3*-(p-1),a<0?a++:a>1&&a--,d=6*a<1?r+(s-r)*6*a:2*a<1?s:3*a<2?r+(s-r)*(2/3-a)*6:r,o[p++]=d*255;return o}};s0.hsl=function(n){var e=n[0]/255,t=n[1]/255,i=n[2]/255,r=Math.min(e,t,i),s=Math.max(e,t,i),a=s-r,o,d,p;return s===r?o=0:e===s?o=(t-i)/a:t===s?o=2+(i-e)/a:i===s&&(o=4+(e-t)/a),o=Math.min(o*60,360),o<0&&(o+=360),p=(r+s)/2,s===r?d=0:p<=.5?d=a/(s+r):d=a/(2-s-r),[o,d*100,p*100]};function c9(n){Array.isArray(n)&&n.raw&&(n=String.raw(...arguments)),n instanceof Number&&(n=+n);var e,t=l9(n);if(!t.space)return[];const i=t.space[0]==="h"?uM.min:s0.min,r=t.space[0]==="h"?uM.max:s0.max;return e=Array(3),e[0]=Math.min(Math.max(t.values[0],i[0]),r[0]),e[1]=Math.min(Math.max(t.values[1],i[1]),r[1]),e[2]=Math.min(Math.max(t.values[2],i[2]),r[2]),t.space[0]==="h"&&(e=uM.rgb(e)),e.push(Math.min(Math.max(t.alpha,0),1)),e}function u9(n){return typeof n=="string"?n:RA(n)}const h9=1024,L_={};let hM=0;function d9(n){if(n.length===4)return n;const e=n.slice();return e[3]=1,e}function rD(n){const e=$s.lchuv(s0.xyz(n));return e[3]=n[3],e}function f9(n){const e=$s.rgb(Yz.xyz(n));return e[3]=n[3],e}function PA(n){if(L_.hasOwnProperty(n))return L_[n];if(hM>=h9){let t=0;for(const i in L_)t++&3||(delete L_[i],--hM)}const e=c9(n);if(e.length!==4)throw new Error('Failed to parse "'+n+'" as color');for(const t of e)if(isNaN(t))throw new Error('Failed to parse "'+n+'" as color');return Kz(e),L_[n]=e,++hM,e}function o0(n){return Array.isArray(n)?n:PA(n)}function Kz(n){return n[0]=es(n[0]+.5|0,0,255),n[1]=es(n[1]+.5|0,0,255),n[2]=es(n[2]+.5|0,0,255),n[3]=es(n[3],0,1),n}function RA(n){let e=n[0];e!=(e|0)&&(e=e+.5|0);let t=n[1];t!=(t|0)&&(t=t+.5|0);let i=n[2];i!=(i|0)&&(i=i+.5|0);const r=n[3]===void 0?1:Math.round(n[3]*1e3)/1e3;return"rgba("+e+","+t+","+i+","+r+")"}function p9(n){try{return PA(n),!0}catch{return!1}}const wd=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",m9=wd.includes("firefox"),g9=wd.includes("safari")&&!wd.includes("chrom");g9&&(wd.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(wd));const _9=wd.includes("webkit")&&!wd.includes("edge"),Jz=wd.includes("macintosh"),Qz=typeof devicePixelRatio<"u"?devicePixelRatio:1,eB=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,tB=typeof Image<"u"&&Image.prototype.decode,nB=function(){let n=!1;try{const e=Object.defineProperty({},"passive",{get:function(){n=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch{}return n}();function Zs(n,e,t,i){let r;return t&&t.length?r=t.shift():eB?r=new OffscreenCanvas(n||300,e||300):r=document.createElement("canvas"),n&&(r.width=n),e&&(r.height=e),r.getContext("2d",i)}let dM;function sw(){return dM||(dM=Zs(1,1)),dM}function yb(n){const e=n.canvas;e.width=1,e.height=1,n.clearRect(0,0,1,1)}function ow(n,e){const t=e.parentNode;t&&t.replaceChild(n,e)}function VT(n){return n&&n.parentNode?n.parentNode.removeChild(n):null}function y9(n){for(;n.lastChild;)n.removeChild(n.lastChild)}function v9(n,e){const t=n.childNodes;for(let i=0;;++i){const r=t[i],s=e[i];if(!r&&!s)break;if(r!==s){if(!r){n.appendChild(s);continue}if(!s){n.removeChild(r),--i;continue}n.insertBefore(s,r)}}}function x9(n,e,t){const i=n;let r=!0,s=!1,a=!1;const o=[Y1(i,ti.LOAD,function(){a=!0,s||e()})];return i.src&&tB?(s=!0,i.decode().then(function(){r&&e()}).catch(function(d){r&&(a?e():t())})):o.push(Y1(i,ti.ERROR,t)),function(){r=!1,o.forEach(cr)}}function w9(n,e){return new Promise((t,i)=>{function r(){a(),t(n)}function s(){a(),i(new Error("Image load error"))}function a(){n.removeEventListener("load",r),n.removeEventListener("error",s)}n.addEventListener("load",r),n.addEventListener("error",s)})}function b9(n,e){return e&&(n.src=e),n.src&&tB?new Promise((t,i)=>n.decode().then(()=>t(n)).catch(r=>n.complete&&n.width?t(n):i(r))):w9(n)}class S9{constructor(){this.cache_={},this.patternCache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.patternCache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let e=0;for(const t in this.cache_){const i=this.cache_[t];!(e++&3)&&!i.hasListener()&&(delete this.cache_[t],delete this.patternCache_[t],--this.cacheSize_)}}}get(e,t,i){const r=fM(e,t,i);return r in this.cache_?this.cache_[r]:null}getPattern(e,t,i){const r=fM(e,t,i);return r in this.patternCache_?this.patternCache_[r]:null}set(e,t,i,r,s){const a=fM(e,t,i),o=a in this.cache_;this.cache_[a]=r,s&&(r.getImageState()===xi.IDLE&&r.load(),r.getImageState()===xi.LOADING?r.ready().then(()=>{this.patternCache_[a]=sw().createPattern(r.getImage(1),"repeat")}):this.patternCache_[a]=sw().createPattern(r.getImage(1),"repeat")),o||++this.cacheSize_}setSize(e){this.maxCacheSize_=e,this.expire()}}function fM(n,e,t){const i=t?o0(t):"null";return e+":"+n+":"+i}const Cc=new S9;let D_=null;class M9 extends lb{constructor(e,t,i,r,s){super(),this.hitDetectionImage_=null,this.image_=e,this.crossOrigin_=i,this.canvas_={},this.color_=s,this.imageState_=r===void 0?xi.IDLE:r,this.size_=e&&e.width&&e.height?[e.width,e.height]:null,this.src_=t,this.tainted_,this.ready_=null}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===xi.LOADED){D_||(D_=Zs(1,1,void 0,{willReadFrequently:!0})),D_.drawImage(this.image_,0,0);try{D_.getImageData(0,0,1,1),this.tainted_=!1}catch{D_=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(ti.CHANGE)}handleImageError_(){this.imageState_=xi.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=xi.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(e){return this.image_||this.initializeImage_(),this.replaceColor_(e),this.canvas_[e]?this.canvas_[e]:this.image_}getPixelRatio(e){return this.replaceColor_(e),this.canvas_[e]?e:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const e=this.size_[0],t=this.size_[1],i=Zs(e,t);i.fillRect(0,0,e,t),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===xi.IDLE){this.image_||this.initializeImage_(),this.imageState_=xi.LOADING;try{this.src_!==void 0&&(this.image_.src=this.src_)}catch{this.handleImageError_()}this.image_ instanceof HTMLImageElement&&b9(this.image_,this.src_).then(e=>{this.image_=e,this.handleImageLoad_()}).catch(this.handleImageError_.bind(this))}}replaceColor_(e){if(!this.color_||this.canvas_[e]||this.imageState_!==xi.LOADED)return;const t=this.image_,i=document.createElement("canvas");i.width=Math.ceil(t.width*e),i.height=Math.ceil(t.height*e);const r=i.getContext("2d");r.scale(e,e),r.drawImage(t,0,0),r.globalCompositeOperation="multiply",r.fillStyle=u9(this.color_),r.fillRect(0,0,i.width/e,i.height/e),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),this.canvas_[e]=i}ready(){return this.ready_||(this.ready_=new Promise(e=>{this.imageState_===xi.LOADED||this.imageState_===xi.ERROR?e():this.addEventListener(ti.CHANGE,function t(){(this.imageState_===xi.LOADED||this.imageState_===xi.ERROR)&&(this.removeEventListener(ti.CHANGE,t),e())})})),this.ready_}}function LA(n,e,t,i,r,s){let a=e===void 0?void 0:Cc.get(e,t,r);return a||(a=new M9(n,n&&"src"in n?n.src||void 0:e,t,i,r),Cc.set(e,t,r,a,s)),s&&a&&!Cc.getPattern(e,t,r)&&Cc.set(e,t,r,a,s),a}function Ac(n){return n?Array.isArray(n)?RA(n):typeof n=="object"&&"src"in n?E9(n):n:null}function E9(n){if(!n.offset||!n.size)return Cc.getPattern(n.src,"anonymous",n.color);const e=n.src+":"+n.offset,t=Cc.getPattern(e,void 0,n.color);if(t)return t;const i=Cc.get(n.src,"anonymous",null);if(i.getImageState()!==xi.LOADED)return null;const r=Zs(n.size[0],n.size[1]);return r.drawImage(i.getImage(1),n.offset[0],n.offset[1],n.size[0],n.size[1],0,0,n.size[0],n.size[1]),LA(r.canvas,e,void 0,xi.LOADED,n.color,!0),Cc.getPattern(e,void 0,n.color)}const ix="ol-hidden",Cg="ol-unselectable",sD="ol-unsupported",vb="ol-control",oD="ol-collapsed",T9=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),aD=["style","variant","weight","size","lineHeight","family"],iB=function(n){const e=n.match(T9);if(!e)return null;const t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,r=aD.length;i<r;++i){const s=e[i+1];s!==void 0&&(t[aD[i]]=s)}return t.families=t.family.split(/,\s?/),t},rB="10px sans-serif",Jo="#000",ig="round",Bu=[],Uu=0,rg="round",a0=10,l0="#000",c0="center",aw="middle",bf=[0,0,0,0],u0=1,xu=new Uc;let tm=null,GT;const HT={},C9=function(){const e="32px ",t=["monospace","serif"],i=t.length,r="wmytzilWMYTZIL@#/&?$%10";let s,a;function o(p,g,_){let w=!0;for(let T=0;T<i;++T){const I=t[T];if(a=lw(p+" "+g+" "+e+I,r),_!=I){const L=lw(p+" "+g+" "+e+_+","+I,r);w=w&&L!=a}}return!!w}function d(){let p=!0;const g=xu.getKeys();for(let _=0,w=g.length;_<w;++_){const T=g[_];xu.get(T)<100&&(o.apply(this,T.split(`
`))?(Mg(HT),tm=null,GT=void 0,xu.set(T,100)):(xu.set(T,xu.get(T)+1,!0),p=!1))}p&&(clearInterval(s),s=void 0)}return function(p){const g=iB(p);if(!g)return;const _=g.families;for(let w=0,T=_.length;w<T;++w){const I=_[w],L=g.style+`
`+g.weight+`
`+I;xu.get(L)===void 0&&(xu.set(L,100,!0),o(g.style,g.weight,I)||(xu.set(L,0,!0),s===void 0&&(s=setInterval(d,32))))}}}(),A9=function(){let n;return function(e){let t=HT[e];if(t==null){if(eB){const i=iB(e),r=sB(e,"g");t=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent)}else n||(n=document.createElement("div"),n.innerHTML="M",n.style.minHeight="0",n.style.maxHeight="none",n.style.height="auto",n.style.padding="0",n.style.border="none",n.style.position="absolute",n.style.display="block",n.style.left="-99999px"),n.style.font=e,document.body.appendChild(n),t=n.offsetHeight,document.body.removeChild(n);HT[e]=t}return t}}();function sB(n,e){return tm||(tm=Zs(1,1)),n!=GT&&(tm.font=n,GT=tm.font),tm.measureText(e)}function lw(n,e){return sB(n,e).width}function lD(n,e,t){if(e in t)return t[e];const i=e.split(`
`).reduce((r,s)=>Math.max(r,lw(n,s)),0);return t[e]=i,i}function I9(n,e){const t=[],i=[],r=[];let s=0,a=0,o=0,d=0;for(let p=0,g=e.length;p<=g;p+=2){const _=e[p];if(_===`
`||p===g){s=Math.max(s,a),r.push(a),a=0,o+=d,d=0;continue}const w=e[p+1]||n.font,T=lw(w,_);t.push(T),a+=T;const I=A9(w);i.push(I),d=Math.max(d,I)}return{width:s,height:o,widths:t,heights:i,lineWidths:r}}function P9(n,e,t,i,r,s,a,o,d,p,g){n.save(),t!==1&&(n.globalAlpha===void 0?n.globalAlpha=_=>_.globalAlpha*=t:n.globalAlpha*=t),e&&n.transform.apply(n,e),i.contextInstructions?(n.translate(d,p),n.scale(g[0],g[1]),R9(i,n)):g[0]<0||g[1]<0?(n.translate(d,p),n.scale(g[0],g[1]),n.drawImage(i,r,s,a,o,0,0,a,o)):n.drawImage(i,r,s,a,o,d,p,a*g[0],o*g[1]),n.restore()}function R9(n,e){const t=n.contextInstructions;for(let i=0,r=t.length;i<r;i+=2)Array.isArray(t[i+1])?e[t[i]].apply(e,t[i+1]):e[t[i]]=t[i+1]}class xb extends _b{constructor(e){super({opacity:1,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,rotation:e.rotation!==void 0?e.rotation:0,scale:e.scale!==void 0?e.scale:1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=e.fill!==void 0?e.fill:null,this.origin_=[0,0],this.points_=e.points,this.radius_=e.radius,this.radius2_=e.radius2,this.angle_=e.angle!==void 0?e.angle:0,this.stroke_=e.stroke!==void 0?e.stroke:null,this.size_,this.renderOptions_,this.imageState_=this.fill_&&this.fill_.loading()?xi.LOADING:xi.LOADED,this.imageState_===xi.LOADING&&this.ready().then(()=>this.imageState_=xi.LOADED),this.render()}clone(){const e=this.getScale(),t=new xb({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}getAnchor(){const e=this.size_,t=this.getDisplacement(),i=this.getScaleArray();return[e[0]/2-t[0]/i[0],e[1]/2+t[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(e){this.fill_=e,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(e){let t=this.canvases_[e];if(!t){const i=this.renderOptions_,r=Zs(i.size*e,i.size*e);this.draw_(i,r,e),t=r.canvas,this.canvases_[e]=t}return t}getPixelRatio(e){return e}getImageSize(){return this.size_}getImageState(){return this.imageState_}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e,this.render()}listenImageChange(e){}load(){}unlistenImageChange(e){}calculateLineJoinSize_(e,t,i){if(t===0||this.points_===1/0||e!=="bevel"&&e!=="miter")return t;let r=this.radius_,s=this.radius2_===void 0?r:this.radius2_;if(r<s){const ee=r;r=s,s=ee}const a=this.radius2_===void 0?this.points_:this.points_*2,o=2*Math.PI/a,d=s*Math.sin(o),p=Math.sqrt(s*s-d*d),g=r-p,_=Math.sqrt(d*d+g*g),w=_/d;if(e==="miter"&&w<=i)return w*t;const T=t/2/w,I=t/2*(g/_),P=Math.sqrt((r+T)*(r+T)+I*I)-r;if(this.radius2_===void 0||e==="bevel")return P*2;const C=r*Math.sin(o),O=Math.sqrt(r*r-C*C),z=s-O,Y=Math.sqrt(C*C+z*z)/C;if(Y<=i){const ee=Y*t/2-s-r;return 2*Math.max(P,ee)}return P*2}createRenderOptions(){let e=ig,t=rg,i=0,r=null,s=0,a,o=0;this.stroke_&&(a=Ac(this.stroke_.getColor()??l0),o=this.stroke_.getWidth()??u0,r=this.stroke_.getLineDash(),s=this.stroke_.getLineDashOffset()??0,t=this.stroke_.getLineJoin()??rg,e=this.stroke_.getLineCap()??ig,i=this.stroke_.getMiterLimit()??a0);const d=this.calculateLineJoinSize_(t,o,i),p=Math.max(this.radius_,this.radius2_||0),g=Math.ceil(2*p+d);return{strokeStyle:a,strokeWidth:o,size:g,lineCap:e,lineDash:r,lineDashOffset:s,lineJoin:t,miterLimit:i}}render(){this.renderOptions_=this.createRenderOptions();const e=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[e,e]}draw_(e,t,i){if(t.scale(i,i),t.translate(e.size/2,e.size/2),this.createPath_(t),this.fill_){let r=this.fill_.getColor();r===null&&(r=Jo),t.fillStyle=Ac(r),t.fill()}e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineCap=e.lineCap,t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}createHitDetectionCanvas_(e){let t;if(this.fill_){let i=this.fill_.getColor(),r=0;typeof i=="string"&&(i=o0(i)),i===null?r=1:Array.isArray(i)&&(r=i.length===4?i[3]:1),r===0&&(t=Zs(e.size,e.size),this.drawHitDetectionCanvas_(e,t))}return t?t.canvas:this.getImage(1)}createPath_(e){let t=this.points_;const i=this.radius_;if(t===1/0)e.arc(0,0,i,0,2*Math.PI);else{const r=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(t*=2);const s=this.angle_-Math.PI/2,a=2*Math.PI/t;for(let o=0;o<t;o++){const d=s+o*a,p=o%2===0?i:r;e.lineTo(p*Math.cos(d),p*Math.sin(d))}e.closePath()}}drawHitDetectionCanvas_(e,t){t.translate(e.size/2,e.size/2),this.createPath_(t),t.fillStyle=Jo,t.fill(),e.strokeStyle&&(t.strokeStyle=e.strokeStyle,t.lineWidth=e.strokeWidth,e.lineDash&&(t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset),t.lineJoin=e.lineJoin,t.miterLimit=e.miterLimit,t.stroke())}ready(){return this.fill_?this.fill_.ready():Promise.resolve()}}class md extends xb{constructor(e){e=e||{radius:5},super({points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0],declutterMode:e.declutterMode})}clone(){const e=this.getScale(),t=new md({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return t.setOpacity(this.getOpacity()),t}setRadius(e){this.radius_=e,this.render()}}class nl{constructor(e){e=e||{},this.patternImage_=null,this.color_=null,e.color!==void 0&&this.setColor(e.color)}clone(){const e=this.getColor();return new nl({color:Array.isArray(e)?e.slice():e||void 0})}getColor(){return this.color_}setColor(e){if(e!==null&&typeof e=="object"&&"src"in e){const t=LA(null,e.src,"anonymous",void 0,e.offset?null:e.color?e.color:null,!(e.offset&&e.size));t.ready().then(()=>{this.patternImage_=null}),t.getImageState()===xi.IDLE&&t.load(),t.getImageState()===xi.LOADING&&(this.patternImage_=t)}this.color_=e}loading(){return!!this.patternImage_}ready(){return this.patternImage_?this.patternImage_.ready():Promise.resolve()}}class Ll{constructor(e){e=e||{},this.color_=e.color!==void 0?e.color:null,this.lineCap_=e.lineCap,this.lineDash_=e.lineDash!==void 0?e.lineDash:null,this.lineDashOffset_=e.lineDashOffset,this.lineJoin_=e.lineJoin,this.miterLimit_=e.miterLimit,this.width_=e.width}clone(){const e=this.getColor();return new Ll({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(e){this.color_=e}setLineCap(e){this.lineCap_=e}setLineDash(e){this.lineDash_=e}setLineDashOffset(e){this.lineDashOffset_=e}setLineJoin(e){this.lineJoin_=e}setMiterLimit(e){this.miterLimit_=e}setWidth(e){this.width_=e}}class na{constructor(e){e=e||{},this.geometry_=null,this.geometryFunction_=cD,e.geometry!==void 0&&this.setGeometry(e.geometry),this.fill_=e.fill!==void 0?e.fill:null,this.image_=e.image!==void 0?e.image:null,this.renderer_=e.renderer!==void 0?e.renderer:null,this.hitDetectionRenderer_=e.hitDetectionRenderer!==void 0?e.hitDetectionRenderer:null,this.stroke_=e.stroke!==void 0?e.stroke:null,this.text_=e.text!==void 0?e.text:null,this.zIndex_=e.zIndex}clone(){let e=this.getGeometry();return e&&typeof e=="object"&&(e=e.clone()),new na({geometry:e??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(e){this.renderer_=e}setHitDetectionRenderer(e){this.hitDetectionRenderer_=e}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(e){this.fill_=e}getImage(){return this.image_}setImage(e){this.image_=e}getStroke(){return this.stroke_}setStroke(e){this.stroke_=e}getText(){return this.text_}setText(e){this.text_=e}getZIndex(){return this.zIndex_}setGeometry(e){typeof e=="function"?this.geometryFunction_=e:typeof e=="string"?this.geometryFunction_=function(t){return t.get(e)}:e?e!==void 0&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=cD,this.geometry_=e}setZIndex(e){this.zIndex_=e}}function L9(n){let e;if(typeof n=="function")e=n;else{let t;Array.isArray(n)?t=n:(Bi(typeof n.getZIndex=="function","Expected an `Style` or an array of `Style`"),t=[n]),e=function(){return t}}return e}let pM=null;function oB(n,e){if(!pM){const t=new nl({color:"rgba(255,255,255,0.4)"}),i=new Ll({color:"#3399CC",width:1.25});pM=[new na({image:new md({fill:t,stroke:i,radius:5}),fill:t,stroke:i})]}return pM}function DA(){const n={},e=[255,255,255,1],t=[0,153,255,1],i=3;return n.Polygon=[new na({fill:new nl({color:[255,255,255,.5]})})],n.MultiPolygon=n.Polygon,n.LineString=[new na({stroke:new Ll({color:e,width:i+2})}),new na({stroke:new Ll({color:t,width:i})})],n.MultiLineString=n.LineString,n.Circle=n.Polygon.concat(n.LineString),n.Point=[new na({image:new md({radius:i*2,fill:new nl({color:t}),stroke:new Ll({color:e,width:i/2})}),zIndex:1/0})],n.MultiPoint=n.Point,n.GeometryCollection=n.Polygon.concat(n.LineString,n.Point),n}function cD(n){return n.getGeometry()}function uD(n,e,t,i){return t!==void 0&&i!==void 0?[t/n,i/e]:t!==void 0?t/n:i!==void 0?i/e:1}class wb extends _b{constructor(e){e=e||{};const t=e.opacity!==void 0?e.opacity:1,i=e.rotation!==void 0?e.rotation:0,r=e.scale!==void 0?e.scale:1,s=e.rotateWithView!==void 0?e.rotateWithView:!1;super({opacity:t,rotation:i,scale:r,displacement:e.displacement!==void 0?e.displacement:[0,0],rotateWithView:s,declutterMode:e.declutterMode}),this.anchor_=e.anchor!==void 0?e.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=e.anchorOrigin!==void 0?e.anchorOrigin:"top-left",this.anchorXUnits_=e.anchorXUnits!==void 0?e.anchorXUnits:"fraction",this.anchorYUnits_=e.anchorYUnits!==void 0?e.anchorYUnits:"fraction",this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null;const a=e.img!==void 0?e.img:null;let o=e.src;Bi(!(o!==void 0&&a),"`image` and `src` cannot be provided at the same time"),(o===void 0||o.length===0)&&a&&(o=a.src||ai(a)),Bi(o!==void 0&&o.length>0,"A defined and non-empty `src` or `image` must be provided"),Bi(!((e.width!==void 0||e.height!==void 0)&&e.scale!==void 0),"`width` or `height` cannot be provided together with `scale`");let d;if(e.src!==void 0?d=xi.IDLE:a!==void 0&&("complete"in a?a.complete?d=a.src?xi.LOADED:xi.IDLE:d=xi.LOADING:d=xi.LOADED),this.color_=e.color!==void 0?o0(e.color):null,this.iconImage_=LA(a,o,this.crossOrigin_,d,this.color_),this.offset_=e.offset!==void 0?e.offset:[0,0],this.offsetOrigin_=e.offsetOrigin!==void 0?e.offsetOrigin:"top-left",this.origin_=null,this.size_=e.size!==void 0?e.size:null,e.width!==void 0||e.height!==void 0){let p,g;if(e.size)[p,g]=e.size;else{const _=this.getImage(1);if(_.width&&_.height)p=_.width,g=_.height;else if(_ instanceof HTMLImageElement){this.initialOptions_=e;const w=()=>{if(this.unlistenImageChange(w),!this.initialOptions_)return;const T=this.iconImage_.getSize();this.setScale(uD(T[0],T[1],e.width,e.height))};this.listenImageChange(w);return}}p!==void 0&&this.setScale(uD(p,g,e.width,e.height))}}clone(){let e,t,i;return this.initialOptions_?(t=this.initialOptions_.width,i=this.initialOptions_.height):(e=this.getScale(),e=Array.isArray(e)?e.slice():e),new wb({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:e,width:t,height:i,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let e=this.normalizedAnchor_;if(!e){e=this.anchor_;const r=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!r)return null;e=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(e[0]*=r[0]),this.anchorYUnits_=="fraction"&&(e[1]*=r[1])}if(this.anchorOrigin_!="top-left"){if(!r)return null;e===this.anchor_&&(e=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(e[0]=-e[0]+r[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(e[1]=-e[1]+r[1])}this.normalizedAnchor_=e}const t=this.getDisplacement(),i=this.getScaleArray();return[e[0]-t[0]/i[0],e[1]+t[1]/i[1]]}setAnchor(e){this.anchor_=e,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(e){return this.iconImage_.getImage(e)}getPixelRatio(e){return this.iconImage_.getPixelRatio(e)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let e=this.offset_;if(this.offsetOrigin_!="top-left"){const t=this.getSize(),i=this.iconImage_.getSize();if(!t||!i)return null;e=e.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(e[0]=i[0]-t[0]-e[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(e[1]=i[1]-t[1]-e[1])}return this.origin_=e,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const e=this.getScaleArray();if(this.size_)return this.size_[0]*e[0];if(this.iconImage_.getImageState()==xi.LOADED)return this.iconImage_.getSize()[0]*e[0]}getHeight(){const e=this.getScaleArray();if(this.size_)return this.size_[1]*e[1];if(this.iconImage_.getImageState()==xi.LOADED)return this.iconImage_.getSize()[1]*e[1]}setScale(e){delete this.initialOptions_,super.setScale(e)}listenImageChange(e){this.iconImage_.addEventListener(ti.CHANGE,e)}load(){this.iconImage_.load()}unlistenImageChange(e){this.iconImage_.removeEventListener(ti.CHANGE,e)}ready(){return this.iconImage_.ready()}}const D9="#333";class kA{constructor(e){e=e||{},this.font_=e.font,this.rotation_=e.rotation,this.rotateWithView_=e.rotateWithView,this.scale_=e.scale,this.scaleArray_=Ia(e.scale!==void 0?e.scale:1),this.text_=e.text,this.textAlign_=e.textAlign,this.justify_=e.justify,this.repeat_=e.repeat,this.textBaseline_=e.textBaseline,this.fill_=e.fill!==void 0?e.fill:new nl({color:D9}),this.maxAngle_=e.maxAngle!==void 0?e.maxAngle:Math.PI/4,this.placement_=e.placement!==void 0?e.placement:"point",this.overflow_=!!e.overflow,this.stroke_=e.stroke!==void 0?e.stroke:null,this.offsetX_=e.offsetX!==void 0?e.offsetX:0,this.offsetY_=e.offsetY!==void 0?e.offsetY:0,this.backgroundFill_=e.backgroundFill?e.backgroundFill:null,this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null,this.padding_=e.padding===void 0?null:e.padding,this.declutterMode_=e.declutterMode}clone(){const e=this.getScale();return new kA({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0,declutterMode:this.getDeclutterMode()})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}getDeclutterMode(){return this.declutterMode_}setOverflow(e){this.overflow_=e}setFont(e){this.font_=e}setMaxAngle(e){this.maxAngle_=e}setOffsetX(e){this.offsetX_=e}setOffsetY(e){this.offsetY_=e}setPlacement(e){this.placement_=e}setRepeat(e){this.repeat_=e}setRotateWithView(e){this.rotateWithView_=e}setFill(e){this.fill_=e}setRotation(e){this.rotation_=e}setScale(e){this.scale_=e,this.scaleArray_=Ia(e!==void 0?e:1)}setStroke(e){this.stroke_=e}setText(e){this.text_=e}setTextAlign(e){this.textAlign_=e}setJustify(e){this.justify_=e}setTextBaseline(e){this.textBaseline_=e}setBackgroundFill(e){this.backgroundFill_=e}setBackgroundStroke(e){this.backgroundStroke_=e}setPadding(e){this.padding_=e}}let qf=0;const Ag=0,$r=1<<qf++,Bn=1<<qf++,Ta=1<<qf++,Ds=1<<qf++,Dc=1<<qf++,by=1<<qf++,ho=Math.pow(2,qf)-1,aB={[$r]:"boolean",[Bn]:"number",[Ta]:"string",[Ds]:"color",[Dc]:"number[]",[by]:"size"},k9=Object.keys(aB).map(Number).sort(Ou);function xo(n){const e=[];for(const t of k9)F9(n,t)&&e.push(aB[t]);return e.length===0?"untyped":e.length<3?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e[e.length-1]}function F9(n,e){return(n&e)===e}function kc(n,e){return!!(n&e)}function bb(n,e){return n===e}class Qh{constructor(e,t){this.type=e,this.value=t}}class O9{constructor(e,t,...i){this.type=e,this.operator=t,this.args=i}}function lB(){return{variables:new Set,properties:new Set,featureId:!1,geometryType:!1,style:{}}}function N9(n){switch(n){case"string":return Ta;case"color":return Ds;case"number":return Bn;case"boolean":return $r;case"number[]":return Dc;default:throw new Error(`Unrecognized type hint: ${n}`)}}function tr(n,e,t){switch(typeof n){case"boolean":return new Qh($r,n);case"number":return new Qh(t===by?by:Bn,n);case"string":{let r=Ta;return p9(n)&&(r|=Ds),bb(r&t,Ag)||(r&=t),new Qh(r,n)}}if(!Array.isArray(n))throw new Error("Expression must be an array or a primitive value");if(n.length===0)throw new Error("Empty expression");if(typeof n[0]=="string")return Z9(n,e,t);for(const r of n)if(typeof r!="number")throw new Error("Expected an array of numbers");let i=Dc;return n.length===2?i|=by:(n.length===3||n.length===4)&&(i|=Ds),t&&(i&=t),new Qh(i,n)}const bt={Get:"get",Var:"var",Concat:"concat",GeometryType:"geometry-type",Any:"any",All:"all",Not:"!",Resolution:"resolution",Zoom:"zoom",Time:"time",Equal:"==",NotEqual:"!=",GreaterThan:">",GreaterThanOrEqualTo:">=",LessThan:"<",LessThanOrEqualTo:"<=",Multiply:"*",Divide:"/",Add:"+",Subtract:"-",Clamp:"clamp",Mod:"%",Pow:"^",Abs:"abs",Floor:"floor",Ceil:"ceil",Round:"round",Sin:"sin",Cos:"cos",Atan:"atan",Sqrt:"sqrt",Match:"match",Between:"between",Interpolate:"interpolate",Coalesce:"coalesce",Case:"case",In:"in",Number:"number",String:"string",Array:"array",Color:"color",Id:"id",Band:"band",Palette:"palette",ToString:"to-string"},z9={[bt.Get]:oi(([n,e])=>e!==void 0?N9(e.value):ho,gi(1,2),B9),[bt.Var]:oi(([n])=>n.type,gi(1,1),U9),[bt.Id]:oi(Bn|Ta,k_,V9),[bt.Concat]:oi(Ta,gi(2,1/0),Ni(ho)),[bt.GeometryType]:oi(Ta,k_,G9),[bt.Resolution]:oi(Bn,k_),[bt.Zoom]:oi(Bn,k_),[bt.Time]:oi(Bn,k_),[bt.Any]:oi($r,gi(2,1/0),Ni($r)),[bt.All]:oi($r,gi(2,1/0),Ni($r)),[bt.Not]:oi($r,gi(1,1),Ni($r)),[bt.Equal]:oi($r,gi(2,2),Ni(ho),Ah),[bt.NotEqual]:oi($r,gi(2,2),Ni(ho),Ah),[bt.GreaterThan]:oi($r,gi(2,2),Ni(ho),Ah),[bt.GreaterThanOrEqualTo]:oi($r,gi(2,2),Ni(ho),Ah),[bt.LessThan]:oi($r,gi(2,2),Ni(ho),Ah),[bt.LessThanOrEqualTo]:oi($r,gi(2,2),Ni(ho),Ah),[bt.Multiply]:oi(n=>{let e=Bn|Ds;for(let t=0;t<n.length;t++)e&=n[t].type;return e},gi(2,1/0),Ni(Bn|Ds),Ah),[bt.Coalesce]:oi(n=>{let e=ho;for(let t=1;t<n.length;t+=2)e&=n[t].type;return e&=n[n.length-1].type,e},gi(2,1/0),Ni(ho),Ah),[bt.Divide]:oi(Bn,gi(2,2),Ni(Bn)),[bt.Add]:oi(Bn,gi(2,1/0),Ni(Bn)),[bt.Subtract]:oi(Bn,gi(2,2),Ni(Bn)),[bt.Clamp]:oi(Bn,gi(3,3),Ni(Bn)),[bt.Mod]:oi(Bn,gi(2,2),Ni(Bn)),[bt.Pow]:oi(Bn,gi(2,2),Ni(Bn)),[bt.Abs]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Floor]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Ceil]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Round]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Sin]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Cos]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Atan]:oi(Bn,gi(1,2),Ni(Bn)),[bt.Sqrt]:oi(Bn,gi(1,1),Ni(Bn)),[bt.Match]:oi(n=>{let e=ho;for(let t=2;t<n.length;t+=2)e&=n[t].type;return e&=n[n.length-1].type,e},gi(4,1/0),hD,W9),[bt.Between]:oi($r,gi(3,3),Ni(Bn)),[bt.Interpolate]:oi(n=>{let e=Ds|Bn;for(let t=3;t<n.length;t+=2)e&=n[t].type;return e},gi(6,1/0),hD,j9),[bt.Case]:oi(n=>{let e=ho;for(let t=1;t<n.length;t+=2)e&=n[t].type;return e&=n[n.length-1].type,e},gi(3,1/0),H9,$9),[bt.In]:oi($r,gi(2,2),q9),[bt.Number]:oi(Bn,gi(1,1/0),Ni(ho)),[bt.String]:oi(Ta,gi(1,1/0),Ni(ho)),[bt.Array]:oi(n=>n.length===2?Dc|by:n.length===3||n.length===4?Dc|Ds:Dc,gi(1,1/0),Ni(Bn)),[bt.Color]:oi(Ds,gi(1,4),Ni(Bn)),[bt.Band]:oi(Bn,gi(1,3),Ni(Bn)),[bt.Palette]:oi(Ds,gi(2,2),X9),[bt.ToString]:oi(Ta,gi(1,1),Ni($r|Bn|Ta|Ds))};function B9(n,e){const t=tr(n[1],e);if(!(t instanceof Qh))throw new Error("Expected a literal argument for get operation");if(typeof t.value!="string")throw new Error("Expected a string argument for get operation");if(e.properties.add(t.value),n.length===3){const i=tr(n[2],e);return[t,i]}return[t]}function U9(n,e,t,i){const r=n[1];if(typeof r!="string")throw new Error("Expected a string argument for var operation");if(e.variables.add(r),!("variables"in e.style)||e.style.variables[r]===void 0)return[new Qh(ho,r)];const s=e.style.variables[r],a=tr(s,e);if(a.value=r,i&&!kc(i,a.type))throw new Error(`The variable ${r} has type ${xo(a.type)} but the following type was expected: ${xo(i)}`);return[a]}function V9(n,e){e.featureId=!0}function G9(n,e){e.geometryType=!0}function k_(n,e){const t=n[0];if(n.length!==1)throw new Error(`Expected no arguments for ${t} operation`);return[]}function gi(n,e){return function(t,i){const r=t[0],s=t.length-1;if(n===e){if(s!==n){const a=n===1?"":"s";throw new Error(`Expected ${n} argument${a} for ${r}, got ${s}`)}}else if(s<n||s>e){const a=e===1/0?`${n} or more`:`${n} to ${e}`;throw new Error(`Expected ${a} arguments for ${r}, got ${s}`)}}}function Ni(n){return function(e,t){const i=e[0],r=e.length-1,s=new Array(r);for(let a=0;a<r;++a){const o=tr(e[a+1],t);if(!kc(n,o.type)){const d=xo(n),p=xo(o.type);throw new Error(`Unexpected type for argument ${a} of ${i} operation, got ${d} but expected ${p}`)}o.type&=n,s[a]=o}return s}}function Ah(n,e,t){const i=n[0],r=n.length-1;let s=ho;for(let o=0;o<t.length;++o)s&=t[o].type;if(s===Ag)throw new Error(`No common type could be found for arguments of ${i} operation`);const a=new Array(r);for(let o=0;o<r;++o)a[o]=tr(n[o+1],e,s);return a}function H9(n,e){const t=n[0],i=n.length-1;if(i%2===0)throw new Error(`An odd amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function hD(n,e){const t=n[0],i=n.length-1;if(i%2===1)throw new Error(`An even amount of arguments was expected for operation ${t}, got ${JSON.stringify(i)} instead`)}function W9(n,e,t,i){const r=n.length-1;let a=tr(n[1],e).type;const o=tr(n[n.length-1],e);let d=i!==void 0?i&o.type:o.type;const p=new Array(r-2);for(let _=0;_<r-2;_+=2){const w=tr(n[_+2],e),T=tr(n[_+3],e);a&=w.type,d&=T.type,p[_]=w,p[_+1]=T}const g=Ta|Bn|$r;if(!kc(g,a))throw new Error(`Expected an input of type ${xo(g)} for the interpolate operation, got ${xo(a)} instead`);if(a&=g,bb(d,Ag))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(n));for(let _=0;_<r-2;_+=2){const w=tr(n[_+2],e,a),T=tr(n[_+3],e,d);p[_]=w,p[_+1]=T}return[tr(n[1],e,a),...p,tr(n[n.length-1],e,d)]}function j9(n,e,t,i){const r=n[1];let s;switch(r[0]){case"linear":s=1;break;case"exponential":if(s=r[1],typeof s!="number")throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(s)} instead`);break;default:s=null}if(!s)throw new Error(`Invalid interpolation type: ${JSON.stringify(r)}`);s=tr(s,e);let a=tr(n[2],e);if(!kc(Bn,a.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${xo(a.type)} instead`);a=tr(n[2],e,Bn);const o=new Array(n.length-3);for(let d=0;d<o.length;d+=2){let p=tr(n[d+3],e);if(!kc(Bn,p.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${xo(p.type)} at position ${d+2} instead`);let g=tr(n[d+4],e);if(!kc(Bn|Ds,g.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${xo(g.type)} at position ${d+3} instead`);p=tr(n[d+3],e,Bn),g=tr(n[d+4],e,Bn|Ds),o[d]=p,o[d+1]=g}return[s,a,...o]}function $9(n,e,t,i){const r=tr(n[n.length-1],e,i);let s=i!==void 0?i&r.type:r.type;const a=new Array(n.length-1);for(let o=0;o<a.length-1;o+=2){const d=tr(n[o+1],e),p=tr(n[o+2],e,i);if(!kc($r,d.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${xo(d.type)} at position ${o} instead`);s&=p.type,a[o]=d,a[o+1]=p}if(bb(s,Ag))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(n));for(let o=0;o<a.length-1;o+=2)a[o+1]=tr(n[o+2],e,s);return a[a.length-1]=tr(n[n.length-1],e,s),a}function q9(n,e){let t=n[2];if(!Array.isArray(t))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if(typeof t[0]=="string"){if(t[0]!=="literal")throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(t[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');t=t[1]}let i=Ta|Bn;const r=new Array(t.length);for(let a=0;a<r.length;a++){const o=tr(t[a],e);i&=o.type,r[a]=o}if(bb(i,Ag))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(n));return[tr(n[1],e,i),...r]}function X9(n,e){const t=tr(n[1],e,Bn);if(t.type!==Bn)throw new Error(`The first argument of palette must be an number, got ${xo(t.type)} instead`);const i=n[2];if(!Array.isArray(i))throw new Error("The second argument of palette must be an array");const r=new Array(i.length);for(let s=0;s<r.length;s++){const a=tr(i[s],e,Ds);if(!(a instanceof Qh))throw new Error(`The palette color at index ${s} must be a literal value`);if(!kc(a.type,Ds))throw new Error(`The palette color at index ${s} should be of type color, got ${xo(a.type)} instead`);r[s]=a}return[t,...r]}function oi(n,...e){return function(t,i,r){const s=t[0];let a=[];for(let d=0;d<e.length;d++)a=e[d](t,i,a,r)||a;let o=typeof n=="function"?n(a):n;if(r!==void 0){if(!kc(o,r))throw new Error(`The following expression was expected to return ${xo(r)}, but returns ${xo(o)} instead: ${JSON.stringify(t)}`);o&=r}if(o===Ag)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(t)}`);return new O9(o,s,...a)}}function Z9(n,e,t){const i=n[0],r=z9[i];if(!r)throw new Error(`Unknown operator: ${i}`);return r(n,e,t)}function cB(n){if(!n)return"";const e=n.getType();switch(e){case"Point":case"LineString":case"Polygon":return e;case"MultiPoint":case"MultiLineString":case"MultiPolygon":return e.substring(5);case"Circle":return"Polygon";case"GeometryCollection":return cB(n.getGeometries()[0]);default:return""}}function uB(){return{variables:{},properties:{},resolution:NaN,featureId:null,geometryType:""}}function Qu(n,e,t){const i=tr(n,t);if(!kc(e,i.type)){const r=xo(e),s=xo(i.type);throw new Error(`Expected expression to be of type ${r}, got ${s}`)}return Hl(i)}function Hl(n,e){if(n instanceof Qh){if(n.type===Ds&&typeof n.value=="string"){const i=PA(n.value);return function(){return i}}return function(){return n.value}}const t=n.operator;switch(t){case bt.Number:case bt.String:case bt.Coalesce:return Y9(n);case bt.Get:case bt.Var:return K9(n);case bt.Id:return i=>i.featureId;case bt.GeometryType:return i=>i.geometryType;case bt.Concat:{const i=n.args.map(r=>Hl(r));return r=>"".concat(...i.map(s=>s(r).toString()))}case bt.Resolution:return i=>i.resolution;case bt.Any:case bt.All:case bt.Between:case bt.In:case bt.Not:return Q9(n);case bt.Equal:case bt.NotEqual:case bt.LessThan:case bt.LessThanOrEqualTo:case bt.GreaterThan:case bt.GreaterThanOrEqualTo:return J9(n);case bt.Multiply:case bt.Divide:case bt.Add:case bt.Subtract:case bt.Clamp:case bt.Mod:case bt.Pow:case bt.Abs:case bt.Floor:case bt.Ceil:case bt.Round:case bt.Sin:case bt.Cos:case bt.Atan:case bt.Sqrt:return ej(n);case bt.Case:return tj(n);case bt.Match:return nj(n);case bt.Interpolate:return ij(n);case bt.ToString:return rj(n);default:throw new Error(`Unsupported operator ${t}`)}}function Y9(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Hl(n.args[s]);switch(t){case bt.Coalesce:return s=>{for(let a=0;a<i;++a){const o=r[a](s);if(typeof o<"u"&&o!==null)return o}throw new Error("Expected one of the values to be non-null")};case bt.Number:case bt.String:return s=>{for(let a=0;a<i;++a){const o=r[a](s);if(typeof o===t)return o}throw new Error(`Expected one of the values to be a ${t}`)};default:throw new Error(`Unsupported assertion operator ${t}`)}}function K9(n,e){const i=n.args[0].value;switch(n.operator){case bt.Get:return r=>r.properties[i];case bt.Var:return r=>r.variables[i];default:throw new Error(`Unsupported accessor operator ${n.operator}`)}}function J9(n,e){const t=n.operator,i=Hl(n.args[0]),r=Hl(n.args[1]);switch(t){case bt.Equal:return s=>i(s)===r(s);case bt.NotEqual:return s=>i(s)!==r(s);case bt.LessThan:return s=>i(s)<r(s);case bt.LessThanOrEqualTo:return s=>i(s)<=r(s);case bt.GreaterThan:return s=>i(s)>r(s);case bt.GreaterThanOrEqualTo:return s=>i(s)>=r(s);default:throw new Error(`Unsupported comparison operator ${t}`)}}function Q9(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Hl(n.args[s]);switch(t){case bt.Any:return s=>{for(let a=0;a<i;++a)if(r[a](s))return!0;return!1};case bt.All:return s=>{for(let a=0;a<i;++a)if(!r[a](s))return!1;return!0};case bt.Between:return s=>{const a=r[0](s),o=r[1](s),d=r[2](s);return a>=o&&a<=d};case bt.In:return s=>{const a=r[0](s);for(let o=1;o<i;++o)if(a===r[o](s))return!0;return!1};case bt.Not:return s=>!r[0](s);default:throw new Error(`Unsupported logical operator ${t}`)}}function ej(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Hl(n.args[s]);switch(t){case bt.Multiply:return s=>{let a=1;for(let o=0;o<i;++o)a*=r[o](s);return a};case bt.Divide:return s=>r[0](s)/r[1](s);case bt.Add:return s=>{let a=0;for(let o=0;o<i;++o)a+=r[o](s);return a};case bt.Subtract:return s=>r[0](s)-r[1](s);case bt.Clamp:return s=>{const a=r[0](s),o=r[1](s);if(a<o)return o;const d=r[2](s);return a>d?d:a};case bt.Mod:return s=>r[0](s)%r[1](s);case bt.Pow:return s=>Math.pow(r[0](s),r[1](s));case bt.Abs:return s=>Math.abs(r[0](s));case bt.Floor:return s=>Math.floor(r[0](s));case bt.Ceil:return s=>Math.ceil(r[0](s));case bt.Round:return s=>Math.round(r[0](s));case bt.Sin:return s=>Math.sin(r[0](s));case bt.Cos:return s=>Math.cos(r[0](s));case bt.Atan:return i===2?s=>Math.atan2(r[0](s),r[1](s)):s=>Math.atan(r[0](s));case bt.Sqrt:return s=>Math.sqrt(r[0](s));default:throw new Error(`Unsupported numeric operator ${t}`)}}function tj(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Hl(n.args[r]);return r=>{for(let s=0;s<t-1;s+=2)if(i[s](r))return i[s+1](r);return i[t-1](r)}}function nj(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Hl(n.args[r]);return r=>{const s=i[0](r);for(let a=1;a<t;a+=2)if(s===i[a](r))return i[a+1](r);return i[t-1](r)}}function ij(n,e){const t=n.args.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=Hl(n.args[r]);return r=>{const s=i[0](r),a=i[1](r);let o,d;for(let p=2;p<t;p+=2){const g=i[p](r);let _=i[p+1](r);const w=Array.isArray(_);if(w&&(_=d9(_)),g>=a)return p===2?_:w?sj(s,a,o,d,g,_):iy(s,a,o,d,g,_);o=g,d=_}return d}}function rj(n,e){const t=n.operator,i=n.args.length,r=new Array(i);for(let s=0;s<i;++s)r[s]=Hl(n.args[s]);switch(t){case bt.ToString:return s=>{const a=r[0](s);return n.args[0].type===Ds?RA(a):a.toString()};default:throw new Error(`Unsupported convert operator ${t}`)}}function iy(n,e,t,i,r,s){const a=r-t;if(a===0)return i;const o=e-t,d=n===1?o/a:(Math.pow(n,o)-1)/(Math.pow(n,a)-1);return i+d*(s-i)}function sj(n,e,t,i,r,s){if(r-t===0)return i;const o=rD(i),d=rD(s);let p=d[2]-o[2];p>180?p-=360:p<-180&&(p+=360);const g=[iy(n,e,t,o[0],r,d[0]),iy(n,e,t,o[1],r,d[1]),o[2]+iy(n,e,t,0,r,p),iy(n,e,t,i[3],r,s[3])];return Kz(f9(g))}function oj(n){return!0}function aj(n){const e=lB(),t=lj(n,e),i=uB();return function(r,s){if(i.properties=r.getPropertiesInternal(),i.resolution=s,e.featureId){const a=r.getId();a!==void 0?i.featureId=a:i.featureId=null}return e.geometryType&&(i.geometryType=cB(r.getGeometry())),t(i)}}function dD(n){const e=lB(),t=n.length,i=new Array(t);for(let a=0;a<t;++a)i[a]=WT(n[a],e);const r=uB(),s=new Array(t);return function(a,o){if(r.properties=a.getPropertiesInternal(),r.resolution=o,e.featureId){const p=a.getId();p!==void 0?r.featureId=p:r.featureId=null}let d=0;for(let p=0;p<t;++p){const g=i[p](r);g&&(s[d]=g,d+=1)}return s.length=d,s}}function lj(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r){const s=n[r],a="filter"in s?Qu(s.filter,$r,e):oj;let o;if(Array.isArray(s.style)){const d=s.style.length;o=new Array(d);for(let p=0;p<d;++p)o[p]=WT(s.style[p],e)}else o=[WT(s.style,e)];i[r]={filter:a,styles:o}}return function(r){const s=[];let a=!1;for(let o=0;o<t;++o){const d=i[o].filter;if(d(r)&&!(n[o].else&&a)){a=!0;for(const p of i[o].styles){const g=p(r);g&&s.push(g)}}}return s}}function WT(n,e){const t=h0(n,"",e),i=d0(n,"",e),r=cj(n,e),s=uj(n,e),a=ea(n,"z-index",e);if(!t&&!i&&!r&&!s&&!Qm(n))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(n));const o=new na;return function(d){let p=!0;if(t){const g=t(d);g&&(p=!1),o.setFill(g)}if(i){const g=i(d);g&&(p=!1),o.setStroke(g)}if(r){const g=r(d);g&&(p=!1),o.setText(g)}if(s){const g=s(d);g&&(p=!1),o.setImage(g)}return a&&o.setZIndex(a(d)),p?null:o}}function h0(n,e,t){let i;if(e+"fill-pattern-src"in n?i=pj(n,e+"fill-",t):i=FA(n,e+"fill-color",t),!i)return null;const r=new nl;return function(s){const a=i(s);return a==="none"?null:(r.setColor(a),r)}}function d0(n,e,t){const i=ea(n,e+"stroke-width",t),r=FA(n,e+"stroke-color",t);if(!i&&!r)return null;const s=Cu(n,e+"stroke-line-cap",t),a=Cu(n,e+"stroke-line-join",t),o=hB(n,e+"stroke-line-dash",t),d=ea(n,e+"stroke-line-dash-offset",t),p=ea(n,e+"stroke-miter-limit",t),g=new Ll;return function(_){if(r){const w=r(_);if(w==="none")return null;g.setColor(w)}if(i&&g.setWidth(i(_)),s){const w=s(_);if(w!=="butt"&&w!=="round"&&w!=="square")throw new Error("Expected butt, round, or square line cap");g.setLineCap(w)}if(a){const w=a(_);if(w!=="bevel"&&w!=="round"&&w!=="miter")throw new Error("Expected bevel, round, or miter line join");g.setLineJoin(w)}return o&&g.setLineDash(o(_)),d&&g.setLineDashOffset(d(_)),p&&g.setMiterLimit(p(_)),g}}function cj(n,e){const t="text-",i=Cu(n,t+"value",e);if(!i)return null;const r=h0(n,t,e),s=h0(n,t+"background-",e),a=d0(n,t,e),o=d0(n,t+"background-",e),d=Cu(n,t+"font",e),p=ea(n,t+"max-angle",e),g=ea(n,t+"offset-x",e),_=ea(n,t+"offset-y",e),w=f0(n,t+"overflow",e),T=Cu(n,t+"placement",e),I=ea(n,t+"repeat",e),L=Sb(n,t+"scale",e),P=f0(n,t+"rotate-with-view",e),C=ea(n,t+"rotation",e),O=Cu(n,t+"align",e),z=Cu(n,t+"justify",e),H=Cu(n,t+"baseline",e),Y=hB(n,t+"padding",e),ee=Mb(n,t+"declutter-mode"),te=new kA({declutterMode:ee});return function(ce){if(te.setText(i(ce)),r&&te.setFill(r(ce)),s&&te.setBackgroundFill(s(ce)),a&&te.setStroke(a(ce)),o&&te.setBackgroundStroke(o(ce)),d&&te.setFont(d(ce)),p&&te.setMaxAngle(p(ce)),g&&te.setOffsetX(g(ce)),_&&te.setOffsetY(_(ce)),w&&te.setOverflow(w(ce)),T){const K=T(ce);if(K!=="point"&&K!=="line")throw new Error("Expected point or line for text-placement");te.setPlacement(K)}if(I&&te.setRepeat(I(ce)),L&&te.setScale(L(ce)),P&&te.setRotateWithView(P(ce)),C&&te.setRotation(C(ce)),O){const K=O(ce);if(K!=="left"&&K!=="center"&&K!=="right"&&K!=="end"&&K!=="start")throw new Error("Expected left, right, center, start, or end for text-align");te.setTextAlign(K)}if(z){const K=z(ce);if(K!=="left"&&K!=="right"&&K!=="center")throw new Error("Expected left, right, or center for text-justify");te.setJustify(K)}if(H){const K=H(ce);if(K!=="bottom"&&K!=="top"&&K!=="middle"&&K!=="alphabetic"&&K!=="hanging")throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");te.setTextBaseline(K)}return Y&&te.setPadding(Y(ce)),te}}function uj(n,e){return"icon-src"in n?hj(n,e):"shape-points"in n?dj(n,e):"circle-radius"in n?fj(n,e):null}function hj(n,e){const t="icon-",i=t+"src",r=dB(n[i],i),s=cw(n,t+"anchor",e),a=Sb(n,t+"scale",e),o=ea(n,t+"opacity",e),d=cw(n,t+"displacement",e),p=ea(n,t+"rotation",e),g=f0(n,t+"rotate-with-view",e),_=pD(n,t+"anchor-origin"),w=mD(n,t+"anchor-x-units"),T=mD(n,t+"anchor-y-units"),I=yj(n,t+"color"),L=gj(n,t+"cross-origin"),P=_j(n,t+"offset"),C=pD(n,t+"offset-origin"),O=uw(n,t+"width"),z=uw(n,t+"height"),H=mj(n,t+"size"),Y=Mb(n,t+"declutter-mode"),ee=new wb({src:r,anchorOrigin:_,anchorXUnits:w,anchorYUnits:T,color:I,crossOrigin:L,offset:P,offsetOrigin:C,height:z,width:O,size:H,declutterMode:Y});return function(te){return o&&ee.setOpacity(o(te)),d&&ee.setDisplacement(d(te)),p&&ee.setRotation(p(te)),g&&ee.setRotateWithView(g(te)),a&&ee.setScale(a(te)),s&&ee.setAnchor(s(te)),ee}}function dj(n,e){const t="shape-",i=t+"points",r=t+"radius",s=jT(n[i],i),a=jT(n[r],r),o=h0(n,t,e),d=d0(n,t,e),p=Sb(n,t+"scale",e),g=cw(n,t+"displacement",e),_=ea(n,t+"rotation",e),w=f0(n,t+"rotate-with-view",e),T=uw(n,t+"radius2"),I=uw(n,t+"angle"),L=Mb(n,t+"declutter-mode"),P=new xb({points:s,radius:a,radius2:T,angle:I,declutterMode:L});return function(C){return o&&P.setFill(o(C)),d&&P.setStroke(d(C)),g&&P.setDisplacement(g(C)),_&&P.setRotation(_(C)),w&&P.setRotateWithView(w(C)),p&&P.setScale(p(C)),P}}function fj(n,e){const t="circle-",i=h0(n,t,e),r=d0(n,t,e),s=ea(n,t+"radius",e),a=Sb(n,t+"scale",e),o=cw(n,t+"displacement",e),d=ea(n,t+"rotation",e),p=f0(n,t+"rotate-with-view",e),g=Mb(n,t+"declutter-mode"),_=new md({radius:5,declutterMode:g});return function(w){return s&&_.setRadius(s(w)),i&&_.setFill(i(w)),r&&_.setStroke(r(w)),o&&_.setDisplacement(o(w)),d&&_.setRotation(d(w)),p&&_.setRotateWithView(p(w)),a&&_.setScale(a(w)),_}}function ea(n,e,t){if(!(e in n))return;const i=Qu(n[e],Bn,t);return function(r){return jT(i(r),e)}}function Cu(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Ta,t);return function(r){return dB(i(r),e)}}function pj(n,e,t){const i=Cu(n,e+"pattern-src",t),r=fD(n,e+"pattern-offset",t),s=fD(n,e+"pattern-size",t),a=FA(n,e+"color",t);return function(o){return{src:i(o),offset:r&&r(o),size:s&&s(o),color:a&&a(o)}}}function f0(n,e,t){if(!(e in n))return null;const i=Qu(n[e],$r,t);return function(r){const s=i(r);if(typeof s!="boolean")throw new Error(`Expected a boolean for ${e}`);return s}}function FA(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Ds|Ta,t);return function(r){return fB(i(r),e)}}function hB(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Dc,t);return function(r){return z0(i(r),e)}}function cw(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Dc,t);return function(r){const s=z0(i(r),e);if(s.length!==2)throw new Error(`Expected two numbers for ${e}`);return s}}function fD(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Dc,t);return function(r){return pB(i(r),e)}}function Sb(n,e,t){if(!(e in n))return null;const i=Qu(n[e],Dc|Bn,t);return function(r){return vj(i(r),e)}}function uw(n,e){const t=n[e];if(t!==void 0){if(typeof t!="number")throw new Error(`Expected a number for ${e}`);return t}}function mj(n,e){const t=n[e];if(t!==void 0){if(typeof t=="number")return Ia(t);if(!Array.isArray(t))throw new Error(`Expected a number or size array for ${e}`);if(t.length!==2||typeof t[0]!="number"||typeof t[1]!="number")throw new Error(`Expected a number or size array for ${e}`);return t}}function gj(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);return t}}function pD(n,e){const t=n[e];if(t!==void 0){if(t!=="bottom-left"&&t!=="bottom-right"&&t!=="top-left"&&t!=="top-right")throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${e}`);return t}}function mD(n,e){const t=n[e];if(t!==void 0){if(t!=="pixels"&&t!=="fraction")throw new Error(`Expected pixels or fraction for ${e}`);return t}}function _j(n,e){const t=n[e];if(t!==void 0)return z0(t,e)}function Mb(n,e){const t=n[e];if(t!==void 0){if(typeof t!="string")throw new Error(`Expected a string for ${e}`);if(t!=="declutter"&&t!=="obstacle"&&t!=="none")throw new Error(`Expected declutter, obstacle, or none for ${e}`);return t}}function yj(n,e){const t=n[e];if(t!==void 0)return fB(t,e)}function z0(n,e){if(!Array.isArray(n))throw new Error(`Expected an array for ${e}`);const t=n.length;for(let i=0;i<t;++i)if(typeof n[i]!="number")throw new Error(`Expected an array of numbers for ${e}`);return n}function dB(n,e){if(typeof n!="string")throw new Error(`Expected a string for ${e}`);return n}function jT(n,e){if(typeof n!="number")throw new Error(`Expected a number for ${e}`);return n}function fB(n,e){if(typeof n=="string")return n;const t=z0(n,e),i=t.length;if(i<3||i>4)throw new Error(`Expected a color with 3 or 4 values for ${e}`);return t}function pB(n,e){const t=z0(n,e);if(t.length!==2)throw new Error(`Expected an array of two numbers for ${e}`);return t}function vj(n,e){return typeof n=="number"?n:pB(n,e)}const gD={RENDER_ORDER:"renderOrder"};class mB extends gb{constructor(e){e=e||{};const t=Object.assign({},e);delete t.style,delete t.renderBuffer,delete t.updateWhileAnimating,delete t.updateWhileInteracting,super(t),this.declutter_=e.declutter?String(e.declutter):void 0,this.renderBuffer_=e.renderBuffer!==void 0?e.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(e.style),this.updateWhileAnimating_=e.updateWhileAnimating!==void 0?e.updateWhileAnimating:!1,this.updateWhileInteracting_=e.updateWhileInteracting!==void 0?e.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(e){return super.getFeatures(e)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(gD.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(e,t){const i=this.getDeclutter();i in e.declutter||(e.declutter[i]=new Zz(9)),this.getRenderer().renderDeclutter(e,t)}setRenderOrder(e){this.set(gD.RENDER_ORDER,e)}setStyle(e){this.style_=e===void 0?oB:e;const t=xj(e);this.styleFunction_=e===null?void 0:L9(t),this.changed()}}function xj(n){if(n===void 0)return oB;if(!n)return null;if(typeof n=="function"||n instanceof na)return n;if(!Array.isArray(n))return dD([n]);if(n.length===0)return[];const e=n.length,t=n[0];if(t instanceof na){const r=new Array(e);for(let s=0;s<e;++s){const a=n[s];if(!(a instanceof na))throw new Error("Expected a list of style instances");r[s]=a}return r}if("style"in t){const r=new Array(e);for(let s=0;s<e;++s){const a=n[s];if(!("style"in a))throw new Error("Expected a list of rules with a style property");r[s]=a}return aj(r)}return dD(n)}const Xn={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},rx=[Xn.FILL],ed=[Xn.STROKE],Sf=[Xn.BEGIN_PATH],_D=[Xn.CLOSE_PATH];class gB{drawCustom(e,t,i,r,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}class B0 extends gB{constructor(e,t,i,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let a=s.length;for(let o=0,d=e.length;o<d;o+=t)r[0]=e[o],r[1]=e[o+1],eg(i,r)&&(s[a++]=r[0],s[a++]=r[1]);return a}appendFlatLineCoordinates(e,t,i,r,s,a){const o=this.coordinates;let d=o.length;const p=this.getBufferedMaxExtent();a&&(t+=r);let g=e[t],_=e[t+1];const w=this.tmpCoordinate_;let T=!0,I,L,P;for(I=t+r;I<i;I+=r)w[0]=e[I],w[1]=e[I+1],P=LT(p,w),P!==L?(T&&(o[d++]=g,o[d++]=_,T=!1),o[d++]=w[0],o[d++]=w[1]):P===Rs.INTERSECTING?(o[d++]=w[0],o[d++]=w[1],T=!1):T=!0,g=w[0],_=w[1],L=P;return(s&&T||I===t+r)&&(o[d++]=g,o[d++]=_),d}drawCustomCoordinates_(e,t,i,r,s){for(let a=0,o=i.length;a<o;++a){const d=i[a],p=this.appendFlatLineCoordinates(e,t,d,r,!1,!1);s.push(p),t=d}return t}drawCustom(e,t,i,r,s){this.beginGeometry(e,t,s);const a=e.getType(),o=e.getStride(),d=this.coordinates.length;let p,g,_,w,T;switch(a){case"MultiPolygon":p=e.getOrientedFlatCoordinates(),w=[];const I=e.getEndss();T=0;for(let L=0,P=I.length;L<P;++L){const C=[];T=this.drawCustomCoordinates_(p,T,I[L],o,C),w.push(C)}this.instructions.push([Xn.CUSTOM,d,w,e,i,zT,s]),this.hitDetectionInstructions.push([Xn.CUSTOM,d,w,e,r||i,zT,s]);break;case"Polygon":case"MultiLineString":_=[],p=a=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),T=this.drawCustomCoordinates_(p,0,e.getEnds(),o,_),this.instructions.push([Xn.CUSTOM,d,_,e,i,t0,s]),this.hitDetectionInstructions.push([Xn.CUSTOM,d,_,e,r||i,t0,s]);break;case"LineString":case"Circle":p=e.getFlatCoordinates(),g=this.appendFlatLineCoordinates(p,0,p.length,o,!1,!1),this.instructions.push([Xn.CUSTOM,d,g,e,i,Jh,s]),this.hitDetectionInstructions.push([Xn.CUSTOM,d,g,e,r||i,Jh,s]);break;case"MultiPoint":p=e.getFlatCoordinates(),g=this.appendFlatPointCoordinates(p,o),g>d&&(this.instructions.push([Xn.CUSTOM,d,g,e,i,Jh,s]),this.hitDetectionInstructions.push([Xn.CUSTOM,d,g,e,r||i,Jh,s]));break;case"Point":p=e.getFlatCoordinates(),this.coordinates.push(p[0],p[1]),g=this.coordinates.length,this.instructions.push([Xn.CUSTOM,d,g,e,i,void 0,s]),this.hitDetectionInstructions.push([Xn.CUSTOM,d,g,e,r||i,void 0,s]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[Xn.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let r,s,a=-1;for(t=0;t<i;++t)r=e[t],s=r[0],s==Xn.END_GEOMETRY?a=t:s==Xn.BEGIN_GEOMETRY&&(r[2]=t,BH(this.hitDetectionInstructions,a,t),a=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const r=e.getColor();i.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,i.fillStyle=Ac(r||Jo)}else i.fillStyle=void 0;if(t){const r=t.getColor();i.strokeStyle=Ac(r||l0);const s=t.getLineCap();i.lineCap=s!==void 0?s:ig;const a=t.getLineDash();i.lineDash=a?a.slice():Bu;const o=t.getLineDashOffset();i.lineDashOffset=o||Uu;const d=t.getLineJoin();i.lineJoin=d!==void 0?d:rg;const p=t.getWidth();i.lineWidth=p!==void 0?p:u0;const g=t.getMiterLimit();i.miterLimit=g!==void 0?g:a0,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[Xn.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[Xn.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,r=e.lineCap,s=e.lineDash,a=e.lineDashOffset,o=e.lineJoin,d=e.lineWidth,p=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=r||s!=e.currentLineDash&&!Ku(e.currentLineDash,s)||e.currentLineDashOffset!=a||e.currentLineJoin!=o||e.currentLineWidth!=d||e.currentMiterLimit!=p)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=r,e.currentLineDash=s,e.currentLineDashOffset=a,e.currentLineJoin=o,e.currentLineWidth=d,e.currentMiterLimit=p)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[Xn.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Mz(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;R0(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class wj extends B0{constructor(e,t,i,r){super(e,t,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!eg(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),s=e.getStride(),a=this.coordinates.length,o=this.appendFlatPointCoordinates(r,s);this.instructions.push([Xn.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),s=[];for(let d=0,p=r.length;d<p;d+=e.getStride())(!this.maxExtent||eg(this.maxExtent,r.slice(d,d+2)))&&s.push(r[d],r[d+1]);const a=this.coordinates.length,o=this.appendFlatPointCoordinates(s,2);this.instructions.push([Xn.DRAW_IMAGE,a,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,a,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),r=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}class bj extends B0{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinates_(e,t,i,r){const s=this.coordinates.length,a=this.appendFlatLineCoordinates(e,t,i,r,!1,!1),o=[Xn.MOVE_TO_LINE_TO,s,a];return this.instructions.push(o),this.hitDetectionInstructions.push(o),i}drawLineString(e,t,i){const r=this.state,s=r.strokeStyle,a=r.lineWidth;if(s===void 0||a===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Bu,Uu],Sf);const o=e.getFlatCoordinates(),d=e.getStride();this.drawFlatCoordinates_(o,0,o.length,d),this.hitDetectionInstructions.push(ed),this.endGeometry(t)}drawMultiLineString(e,t,i){const r=this.state,s=r.strokeStyle,a=r.lineWidth;if(s===void 0||a===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Bu,Uu],Sf);const o=e.getEnds(),d=e.getFlatCoordinates(),p=e.getStride();let g=0;for(let _=0,w=o.length;_<w;++_)g=this.drawFlatCoordinates_(d,g,o[_],p);this.hitDetectionInstructions.push(ed),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(ed),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(ed),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Sf)}}class yD extends B0{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinatess_(e,t,i,r){const s=this.state,a=s.fillStyle!==void 0,o=s.strokeStyle!==void 0,d=i.length;this.instructions.push(Sf),this.hitDetectionInstructions.push(Sf);for(let p=0;p<d;++p){const g=i[p],_=this.coordinates.length,w=this.appendFlatLineCoordinates(e,t,g,r,!0,!o),T=[Xn.MOVE_TO_LINE_TO,_,w];this.instructions.push(T),this.hitDetectionInstructions.push(T),o&&(this.instructions.push(_D),this.hitDetectionInstructions.push(_D)),t=g}return a&&(this.instructions.push(rx),this.hitDetectionInstructions.push(rx)),o&&(this.instructions.push(ed),this.hitDetectionInstructions.push(ed)),t}drawCircle(e,t,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,Jo]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Bu,Uu]);const o=e.getFlatCoordinates(),d=e.getStride(),p=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,d,!1,!1);const g=[Xn.CIRCLE,p];this.instructions.push(Sf,g),this.hitDetectionInstructions.push(Sf,g),r.fillStyle!==void 0&&(this.instructions.push(rx),this.hitDetectionInstructions.push(rx)),r.strokeStyle!==void 0&&(this.instructions.push(ed),this.hitDetectionInstructions.push(ed)),this.endGeometry(t)}drawPolygon(e,t,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,Jo]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Bu,Uu]);const o=e.getEnds(),d=e.getOrientedFlatCoordinates(),p=e.getStride();this.drawFlatCoordinatess_(d,0,o,p),this.endGeometry(t)}drawMultiPolygon(e,t,i){const r=this.state,s=r.fillStyle,a=r.strokeStyle;if(s===void 0&&a===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_FILL_STYLE,Jo]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([Xn.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,Bu,Uu]);const o=e.getEndss(),d=e.getOrientedFlatCoordinates(),p=e.getStride();let g=0;for(let _=0,w=o.length;_<w;++_)g=this.drawFlatCoordinatess_(d,g,o[_],p);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,r=t.length;i<r;++i)t[i]=ff(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}function Sj(n,e,t,i,r){const s=[];let a=t,o=0,d=e.slice(t,2);for(;o<n&&a+r<i;){const[p,g]=d.slice(-2),_=e[a+r],w=e[a+r+1],T=Math.sqrt((_-p)*(_-p)+(w-g)*(w-g));if(o+=T,o>=n){const I=(n-o+T)/T,L=Ea(p,_,I),P=Ea(g,w,I);d.push(L,P),s.push(d),d=[L,P],o==n&&(a+=r),o=0}else if(o<n)d.push(e[a+r],e[a+r+1]),a+=r;else{const I=T-o,L=Ea(p,_,I/T),P=Ea(g,w,I/T);d.push(L,P),s.push(d),d=[L,P],o=0,a+=r}}return o>0&&s.push(d),s}function Mj(n,e,t,i,r){let s=t,a=t,o=0,d=0,p=t,g,_,w,T,I,L,P,C,O,z;for(_=t;_<i;_+=r){const H=e[_],Y=e[_+1];I!==void 0&&(O=H-I,z=Y-L,T=Math.sqrt(O*O+z*z),P!==void 0&&(d+=w,g=Math.acos((P*O+C*z)/(w*T)),g>n&&(d>o&&(o=d,s=p,a=_),d=0,p=_-r)),w=T,P=O,C=z),I=H,L=Y}return d+=T,d>o?[p,_]:[s,a]}const hw={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Ej extends B0{constructor(e,t,i,r){super(e,t,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Jo]={fillStyle:Jo},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const r=this.textFillState_,s=this.textStrokeState_,a=this.textState_;if(this.text_===""||!a||!r&&!s)return;const o=this.coordinates;let d=o.length;const p=e.getType();let g=null,_=e.getStride();if(a.placement==="line"&&(p=="LineString"||p=="MultiLineString"||p=="Polygon"||p=="MultiPolygon")){if(!No(this.maxExtent,e.getExtent()))return;let w;if(g=e.getFlatCoordinates(),p=="LineString")w=[g.length];else if(p=="MultiLineString")w=e.getEnds();else if(p=="Polygon")w=e.getEnds().slice(0,1);else if(p=="MultiPolygon"){const P=e.getEndss();w=[];for(let C=0,O=P.length;C<O;++C)w.push(P[C][0])}this.beginGeometry(e,t,i);const T=a.repeat,I=T?void 0:a.textAlign;let L=0;for(let P=0,C=w.length;P<C;++P){let O;T?O=Sj(T*this.resolution,g,L,w[P],_):O=[g.slice(L,w[P])];for(let z=0,H=O.length;z<H;++z){const Y=O[z];let ee=0,te=Y.length;if(I==null){const K=Mj(a.maxAngle,Y,0,Y.length,2);ee=K[0],te=K[1]}for(let K=ee;K<te;K+=_)o.push(Y[K],Y[K+1]);const ce=o.length;L=w[P],this.drawChars_(d,ce),d=ce}}this.endGeometry(t)}else{let w=a.overflow?null:[];switch(p){case"Point":case"MultiPoint":g=e.getFlatCoordinates();break;case"LineString":g=e.getFlatMidpoint();break;case"Circle":g=e.getCenter();break;case"MultiLineString":g=e.getFlatMidpoints(),_=2;break;case"Polygon":g=e.getFlatInteriorPoint(),a.overflow||w.push(g[2]/this.resolution),_=3;break;case"MultiPolygon":const O=e.getFlatInteriorPoints();g=[];for(let z=0,H=O.length;z<H;z+=3)a.overflow||w.push(O[z+2]/this.resolution),g.push(O[z],O[z+1]);if(g.length===0)return;_=2;break}const T=this.appendFlatPointCoordinates(g,_);if(T===d)return;if(w&&(T-d)/2!==g.length/_){let O=d/2;w=w.filter((z,H)=>{const Y=o[(O+H)*2]===g[H*_]&&o[(O+H)*2+1]===g[H*_+1];return Y||--O,Y})}this.saveTextStates_(),(a.backgroundFill||a.backgroundStroke)&&(this.setFillStrokeStyle(a.backgroundFill,a.backgroundStroke),a.backgroundFill&&this.updateFillStyle(this.state,this.createFill),a.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,i);let I=a.padding;if(I!=bf&&(a.scale[0]<0||a.scale[1]<0)){let O=a.padding[0],z=a.padding[1],H=a.padding[2],Y=a.padding[3];a.scale[0]<0&&(z=-z,Y=-Y),a.scale[1]<0&&(O=-O,H=-H),I=[O,z,H,Y]}const L=this.pixelRatio;this.instructions.push([Xn.DRAW_IMAGE,d,T,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,I==bf?bf:I.map(function(O){return O*L}),!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]);const P=1/L,C=this.state.fillStyle;a.backgroundFill&&(this.state.fillStyle=Jo,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([Xn.DRAW_IMAGE,d,T,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[P,P],NaN,this.declutterMode_,this.declutterImageWithText_,I,!!a.backgroundFill,!!a.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Jo:this.fillKey_,this.textOffsetX_,this.textOffsetY_,w]),a.backgroundFill&&(this.state.fillStyle=C,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||c0,justify:t.justify,textBaseline:t.textBaseline||aw,scale:t.scale});const a=this.fillKey_;i&&(a in this.fillStates||(this.fillStates[a]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,a=this.textKey_,o=this.fillKey_;this.saveTextStates_();const d=this.pixelRatio,p=hw[r.textBaseline],g=this.textOffsetY_*d,_=this.text_,w=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([Xn.DRAW_CHARS,e,t,p,r.overflow,o,r.maxAngle,d,g,s,w*d,_,a,1,this.declutterMode_]),this.hitDetectionInstructions.push([Xn.DRAW_CHARS,e,t,p,r.overflow,o&&Jo,r.maxAngle,d,g,s,w*d,_,a,1/d,this.declutterMode_])}setTextStyle(e,t){let i,r,s;if(!e)this.text_="";else{const a=e.getFill();a?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=Ac(a.getColor()||Jo)):(r=null,this.textFillState_=r);const o=e.getStroke();if(!o)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const I=o.getLineDash(),L=o.getLineDashOffset(),P=o.getWidth(),C=o.getMiterLimit();s.lineCap=o.getLineCap()||ig,s.lineDash=I?I.slice():Bu,s.lineDashOffset=L===void 0?Uu:L,s.lineJoin=o.getLineJoin()||rg,s.lineWidth=P===void 0?u0:P,s.miterLimit=C===void 0?a0:C,s.strokeStyle=Ac(o.getColor()||l0)}i=this.textState_;const d=e.getFont()||rB;C9(d);const p=e.getScaleArray();i.overflow=e.getOverflow(),i.font=d,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||aw,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||bf,i.scale=p===void 0?[1,1]:p;const g=e.getOffsetX(),_=e.getOffsetY(),w=e.getRotateWithView(),T=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=g===void 0?0:g,this.textOffsetY_=_===void 0?0:_,this.textRotateWithView_=w===void 0?!1:w,this.textRotation_=T===void 0?0:T,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:ai(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+ai(r.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Tj={Circle:yD,Default:B0,Image:wj,LineString:bj,Polygon:yD,Text:Ej};class Cj{constructor(e,t,i,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const r in i){const s=i[r].finish();e[t][r]=s}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let s=r[t];if(s===void 0){const a=Tj[t];s=new a(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=s}return s}}class Aj extends P0{constructor(e){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=e}getFeatures(e){return Gi()}getData(e){return null}prepareFrame(e){return Gi()}renderFrame(e,t){return Gi()}loadedTileCallback(e,t,i){e[t]||(e[t]={}),e[t][i.tileCoord.toString()]=i}createLoadedTileFinder(e,t,i){return(r,s)=>{const a=this.loadedTileCallback.bind(this,i,r);return e.forEachLoadedTile(t,r,s,a)}}forEachFeatureAtCoordinate(e,t,i,r,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(e){const t=e.target;(t.getState()===xi.LOADED||t.getState()===xi.ERROR)&&this.renderIfReadyAndVisible()}loadImage(e){let t=e.getState();return t!=xi.LOADED&&t!=xi.ERROR&&e.addEventListener(ti.CHANGE,this.boundHandleImageChange_),t==xi.IDLE&&(e.load(),t=e.getState()),t==xi.LOADED}renderIfReadyAndVisible(){const e=this.getLayer();e&&e.getVisible()&&e.getSourceState()==="ready"&&e.changed()}renderDeferred(e){}disposeInternal(){delete this.layer_,super.disposeInternal()}}class _B extends la{constructor(e,t,i,r){super(e),this.inversePixelTransform=t,this.frameState=i,this.context=r}}class yB{constructor(){bR(this,"pushMethodArgs_",(...e)=>(this.instructions_[this.zIndex+this.offset_].push(e),this));this.instructions_=[],this.zIndex=0,this.offset_=0,this.context_=new Proxy(sw(),{get:(e,t)=>{if(typeof sw()[t]=="function")return this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t),this.pushMethodArgs_},set:(e,t,i)=>(this.instructions_[this.zIndex+this.offset_]||(this.instructions_[this.zIndex+this.offset_]=[]),this.instructions_[this.zIndex+this.offset_].push(t,i),!0)})}pushFunction(e){this.instructions_[this.zIndex+this.offset_].push(e)}getContext(){return this.context_}draw(e){this.instructions_.forEach(t=>{for(let i=0,r=t.length;i<r;++i){const s=t[i];if(typeof s=="function"){s(e);continue}const a=t[++i];if(typeof e[s]=="function")e[s](...a);else{if(typeof a=="function"){e[s]=a(e);continue}e[s]=a}}})}clear(){this.instructions_.length=0,this.zIndex=0,this.offset_=0}offset(){this.offset_=this.instructions_.length,this.zIndex=0}}const vD=[];let nm=null;function Ij(){nm=Zs(1,1,void 0,{willReadFrequently:!0})}class vB extends Aj{constructor(e){super(e),this.container=null,this.renderedResolution,this.tempTransform=Ol(),this.pixelTransform=Ol(),this.inversePixelTransform=Ol(),this.context=null,this.deferredContext_=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(e,t,i){nm||Ij(),nm.clearRect(0,0,1,1);let r;try{nm.drawImage(e,t,i,1,1,0,0,1,1),r=nm.getImageData(0,0,1,1).data}catch{return nm=null,null}return r}getBackground(e){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(e.viewState.resolution)),i||void 0}useContainer(e,t,i){const r=this.getLayer().getClassName();let s,a;if(e&&e.className===r&&(!i||e&&e.style.backgroundColor&&Ku(o0(e.style.backgroundColor),o0(i)))){const o=e.firstElementChild;o instanceof HTMLCanvasElement&&(a=o.getContext("2d"))}if(a&&a.canvas.style.transform===t?(this.container=e,this.context=a,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){s=document.createElement("div"),s.className=r;let o=s.style;o.position="absolute",o.width="100%",o.height="100%",a=Zs();const d=a.canvas;s.appendChild(d),o=d.style,o.position="absolute",o.left="0",o.transformOrigin="top left",this.container=s,this.context=a}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(e,t,i){const r=Ad(i),s=k0(i),a=D0(i),o=tg(i);Ws(t.coordinateToPixelTransform,r),Ws(t.coordinateToPixelTransform,s),Ws(t.coordinateToPixelTransform,a),Ws(t.coordinateToPixelTransform,o);const d=this.inversePixelTransform;Ws(d,r),Ws(d,s),Ws(d,a),Ws(d,o),e.save(),e.beginPath(),e.moveTo(Math.round(r[0]),Math.round(r[1])),e.lineTo(Math.round(s[0]),Math.round(s[1])),e.lineTo(Math.round(a[0]),Math.round(a[1])),e.lineTo(Math.round(o[0]),Math.round(o[1])),e.clip()}prepareContainer(e,t){const i=e.extent,r=e.viewState.resolution,s=e.viewState.rotation,a=e.pixelRatio,o=Math.round(qi(i)/r*a),d=Math.round(js(i)/r*a);ju(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/a,1/a,s,-o/2,-d/2),Sz(this.inversePixelTransform,this.pixelTransform);const p=$H(this.pixelTransform);if(this.useContainer(t,p,this.getBackground(e)),!this.containerReused){const g=this.context.canvas;g.width!=o||g.height!=d?(g.width=o,g.height=d):this.context.clearRect(0,0,o,d),p!==g.style.transform&&(g.style.transform=p)}}dispatchRenderEvent_(e,t,i){const r=this.getLayer();if(r.hasListener(e)){const s=new _B(e,this.inversePixelTransform,i,t);r.dispatchEvent(s)}}preRender(e,t){this.frameState=t,!t.declutter&&this.dispatchRenderEvent_(sl.PRERENDER,e,t)}postRender(e,t){t.declutter||this.dispatchRenderEvent_(sl.POSTRENDER,e,t)}renderDeferredInternal(e){}getRenderContext(e){return e.declutter&&!this.deferredContext_&&(this.deferredContext_=new yB),e.declutter?this.deferredContext_.getContext():this.context}renderDeferred(e){e.declutter&&(this.dispatchRenderEvent_(sl.PRERENDER,this.context,e),e.declutter&&this.deferredContext_&&(this.deferredContext_.draw(this.context),this.deferredContext_.clear()),this.renderDeferredInternal(e),this.dispatchRenderEvent_(sl.POSTRENDER,this.context,e))}getRenderTransform(e,t,i,r,s,a,o){const d=s/2,p=a/2,g=r/t,_=-g,w=-e[0]+o,T=-e[1];return ju(this.tempTransform,d,p,g,_,-i,w,T)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Pj(n,e,t,i,r,s,a,o,d,p,g,_){let w=n[e],T=n[e+1],I=0,L=0,P=0,C=0;function O(){I=w,L=T,e+=i,w=n[e],T=n[e+1],C+=P,P=Math.sqrt((w-I)*(w-I)+(T-L)*(T-L))}do O();while(e<t-i&&C+P<s);let z=P===0?0:(s-C)/P;const H=Ea(I,w,z),Y=Ea(L,T,z),ee=e-i,te=C,ce=s+o*d(p,r,g);for(;e<t-i&&C+P<ce;)O();z=P===0?0:(ce-C)/P;const K=Ea(I,w,z),Q=Ea(L,T,z);let pe;if(_){const Ne=[H,Y,K,Q];dA(Ne,0,4,2,_,Ne,Ne),pe=Ne[0]>Ne[2]}else pe=H>K;const ze=Math.PI,Fe=[],qe=ee+i===e;e=ee,P=0,C=te,w=n[e],T=n[e+1];let et;if(qe){O(),et=Math.atan2(T-L,w-I),pe&&(et+=et>0?-ze:ze);const Ne=(K+H)/2,st=(Q+Y)/2;return Fe[0]=[Ne,st,(ce-s)/2,et,r],Fe}r=r.replace(/\n/g," ");for(let Ne=0,st=r.length;Ne<st;){O();let Ee=Math.atan2(T-L,w-I);if(pe&&(Ee+=Ee>0?-ze:ze),et!==void 0){let Re=Ee-et;if(Re+=Re>ze?-2*ze:Re<-ze?2*ze:0,Math.abs(Re)>a)return null}et=Ee;const ut=Ne;let ot=0;for(;Ne<st;++Ne){const Re=pe?st-Ne-1:Ne,mt=o*d(p,r[Re],g);if(e+i<t&&C+P<s+ot+mt/2)break;ot+=mt}if(Ne===ut)continue;const dt=pe?r.substring(st-ut,st-Ne):r.substring(ut,Ne);z=P===0?0:(s+ot/2-C)/P;const Ct=Ea(I,w,z),Vt=Ea(L,T,z);Fe.push([Ct,Vt,ot/2,Ee,dt]),s+=ot}return Fe}const Ip=Da(),Ih=[],hu=[],du=[],Ph=[];function xD(n){return n[3].declutterBox}const wD=new RegExp("[-----]");function mM(n,e){return e==="start"?e=wD.test(n)?"right":"left":e==="end"&&(e=wD.test(n)?"left":"right"),hw[e]}function Rj(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}class Lj{constructor(e,t,i,r,s){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Ol(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new yB:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,r){const s=e+t+i+r;if(this.labels_[s])return this.labels_[s];const a=r?this.strokeStates[r]:null,o=i?this.fillStates[i]:null,d=this.textStates[t],p=this.pixelRatio,g=[d.scale[0]*p,d.scale[1]*p],_=Array.isArray(e),w=d.justify?hw[d.justify]:mM(Array.isArray(e)?e[0]:e,d.textAlign||c0),T=r&&a.lineWidth?a.lineWidth:0,I=_?e:e.split(`
`).reduce(Rj,[]),{width:L,height:P,widths:C,heights:O,lineWidths:z}=I9(d,I),H=L+T,Y=[],ee=(H+2)*g[0],te=(P+T)*g[1],ce={width:ee<0?Math.floor(ee):Math.ceil(ee),height:te<0?Math.floor(te):Math.ceil(te),contextInstructions:Y};(g[0]!=1||g[1]!=1)&&Y.push("scale",g),r&&(Y.push("strokeStyle",a.strokeStyle),Y.push("lineWidth",T),Y.push("lineCap",a.lineCap),Y.push("lineJoin",a.lineJoin),Y.push("miterLimit",a.miterLimit),Y.push("setLineDash",[a.lineDash]),Y.push("lineDashOffset",a.lineDashOffset)),i&&Y.push("fillStyle",o.fillStyle),Y.push("textBaseline","middle"),Y.push("textAlign","center");const K=.5-w;let Q=w*H+K*T;const pe=[],ze=[];let Fe=0,qe=0,et=0,Ne=0,st;for(let Ee=0,ut=I.length;Ee<ut;Ee+=2){const ot=I[Ee];if(ot===`
`){qe+=Fe,Fe=0,Q=w*H+K*T,++Ne;continue}const dt=I[Ee+1]||d.font;dt!==st&&(r&&pe.push("font",dt),i&&ze.push("font",dt),st=dt),Fe=Math.max(Fe,O[et]);const Ct=[ot,Q+K*C[et]+w*(C[et]-z[Ne]),.5*(T+Fe)+qe];Q+=C[et],r&&pe.push("strokeText",Ct),i&&ze.push("fillText",Ct),++et}return Array.prototype.push.apply(Y,pe),Array.prototype.push.apply(Y,ze),this.labels_[s]=ce,ce}replayTextBackground_(e,t,i,r,s,a,o){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,s),e.lineTo.apply(e,t),a&&(this.alignAndScaleFill_=a[2],this.fill_(e)),o&&(this.setStrokeStyle_(e,o),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,r,s,a,o,d,p,g,_,w,T,I,L,P){o*=w[0],d*=w[1];let C=i-o,O=r-d;const z=s+p>e?e-p:s,H=a+g>t?t-g:a,Y=I[3]+z*w[0]+I[1],ee=I[0]+H*w[1]+I[2],te=C-I[3],ce=O-I[0];(L||_!==0)&&(Ih[0]=te,Ph[0]=te,Ih[1]=ce,hu[1]=ce,hu[0]=te+Y,du[0]=hu[0],du[1]=ce+ee,Ph[1]=du[1]);let K;return _!==0?(K=ju(Ol(),i,r,1,1,_,-i,-r),Ws(K,Ih),Ws(K,hu),Ws(K,du),Ws(K,Ph),$u(Math.min(Ih[0],hu[0],du[0],Ph[0]),Math.min(Ih[1],hu[1],du[1],Ph[1]),Math.max(Ih[0],hu[0],du[0],Ph[0]),Math.max(Ih[1],hu[1],du[1],Ph[1]),Ip)):$u(Math.min(te,te+Y),Math.min(ce,ce+ee),Math.max(te,te+Y),Math.max(ce,ce+ee),Ip),T&&(C=Math.round(C),O=Math.round(O)),{drawImageX:C,drawImageY:O,drawImageW:z,drawImageH:H,originX:p,originY:g,declutterBox:{minX:Ip[0],minY:Ip[1],maxX:Ip[2],maxY:Ip[3],value:P},canvasTransform:K,scale:w}}replayImageOrLabel_(e,t,i,r,s,a,o){const d=!!(a||o),p=r.declutterBox,g=o?o[2]*r.scale[0]/2:0;return p.minX-g<=t[0]&&p.maxX+g>=0&&p.minY-g<=t[1]&&p.maxY+g>=0&&(d&&this.replayTextBackground_(e,Ih,hu,du,Ph,a,o),P9(e,r.canvasTransform,s,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=Ws(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(i[0]%r,i[1]%r),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,r){const s=this.textStates[t],a=this.createLabel(e,t,r,i),o=this.strokeStates[i],d=this.pixelRatio,p=mM(Array.isArray(e)?e[0]:e,s.textAlign||c0),g=hw[s.textBaseline||aw],_=o&&o.lineWidth?o.lineWidth:0,w=a.width/d-2*s.scale[0],T=p*w+2*(.5-p)*_,I=g*a.height/d+2*(.5-g)*_;return{label:a,anchorX:T,anchorY:I}}execute_(e,t,i,r,s,a,o,d){const p=this.zIndexContext_;let g;this.pixelCoordinates_&&Ku(i,this.renderedTransform_)?g=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),g=fd(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),WH(this.renderedTransform_,i));let _=0;const w=r.length;let T=0,I,L,P,C,O,z,H,Y,ee,te,ce,K,Q,pe=0,ze=0,Fe=null,qe=null;const et=this.coordinateCache_,Ne=this.viewRotation_,st=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,Ee={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:Ne},ut=this.instructions!=r||this.overlaps?0:200;let ot,dt,Ct,Vt;for(;_<w;){const Re=r[_];switch(Re[0]){case Xn.BEGIN_GEOMETRY:ot=Re[1],Vt=Re[3],ot.getGeometry()?o!==void 0&&!No(o,Vt.getExtent())?_=Re[2]+1:++_:_=Re[2],p&&(p.zIndex=Re[4]);break;case Xn.BEGIN_PATH:pe>ut&&(this.fill_(e),pe=0),ze>ut&&(e.stroke(),ze=0),!pe&&!ze&&(e.beginPath(),O=NaN,z=NaN),++_;break;case Xn.CIRCLE:T=Re[1];const Et=g[T],It=g[T+1],vn=g[T+2],xn=g[T+3],at=vn-Et,Rn=xn-It,Me=Math.sqrt(at*at+Rn*Rn);e.moveTo(Et+Me,It),e.arc(Et,It,Me,0,2*Math.PI,!0),++_;break;case Xn.CLOSE_PATH:e.closePath(),++_;break;case Xn.CUSTOM:T=Re[1],I=Re[2];const Jn=Re[3],on=Re[4],Vn=Re[5];Ee.geometry=Jn,Ee.feature=ot,_ in et||(et[_]=[]);const Te=et[_];Vn?Vn(g,T,I,2,Te):(Te[0]=g[T],Te[1]=g[T+1],Te.length=2),p&&(p.zIndex=Re[6]),on(Te,Ee),++_;break;case Xn.DRAW_IMAGE:T=Re[1],I=Re[2],ee=Re[3],L=Re[4],P=Re[5];let jn=Re[6];const wn=Re[7],jt=Re[8],me=Re[9],le=Re[10];let tt=Re[11];const xt=Re[12];let St=Re[13];C=Re[14]||"declutter";const yt=Re[15];if(!ee&&Re.length>=20){te=Re[19],ce=Re[20],K=Re[21],Q=Re[22];const fe=this.drawLabelWithPointPlacement_(te,ce,K,Q);ee=fe.label,Re[3]=ee;const xe=Re[23];L=(fe.anchorX-xe)*this.pixelRatio,Re[4]=L;const Ie=Re[24];P=(fe.anchorY-Ie)*this.pixelRatio,Re[5]=P,jn=ee.height,Re[6]=jn,St=ee.width,Re[13]=St}let hn;Re.length>25&&(hn=Re[25]);let zt,Je,cn;Re.length>17?(zt=Re[16],Je=Re[17],cn=Re[18]):(zt=bf,Je=!1,cn=!1),le&&st?tt+=Ne:!le&&!st&&(tt-=Ne);let At=0;for(;T<I;T+=2){if(hn&&hn[At++]<St/this.pixelRatio)continue;const fe=this.calculateImageOrLabelDimensions_(ee.width,ee.height,g[T],g[T+1],St,jn,L,P,jt,me,tt,xt,s,zt,Je||cn,ot),xe=[e,t,ee,fe,wn,Je?Fe:null,cn?qe:null];if(d){let Ie,ke,Se;if(yt){const Ze=I-T;if(!yt[Ze]){yt[Ze]={args:xe,declutterMode:C};continue}const rt=yt[Ze];Ie=rt.args,ke=rt.declutterMode,delete yt[Ze],Se=xD(Ie)}let Ue,ft;if(Ie&&(ke!=="declutter"||!d.collides(Se))&&(Ue=!0),(C!=="declutter"||!d.collides(fe.declutterBox))&&(ft=!0),ke==="declutter"&&C==="declutter"){const Ze=Ue&&ft;Ue=Ze,ft=Ze}Ue&&(ke!=="none"&&d.insert(Se),this.replayImageOrLabel_.apply(this,Ie)),ft&&(C!=="none"&&d.insert(fe.declutterBox),this.replayImageOrLabel_.apply(this,xe))}else this.replayImageOrLabel_.apply(this,xe)}++_;break;case Xn.DRAW_CHARS:const tn=Re[1],Zn=Re[2],lt=Re[3],Mt=Re[4];Q=Re[5];const kt=Re[6],In=Re[7],ii=Re[8];K=Re[9];const Ae=Re[10];te=Re[11],ce=Re[12];const Lt=[Re[13],Re[13]];C=Re[14]||"declutter";const gt=this.textStates[ce],ht=gt.font,ae=[gt.scale[0]*In,gt.scale[1]*In];let j;ht in this.widths_?j=this.widths_[ht]:(j={},this.widths_[ht]=j);const Z=Nz(g,tn,Zn,2),ne=Math.abs(ae[0])*lD(ht,te,j);if(Mt||ne<=Z){const fe=this.textStates[ce].textAlign,xe=(Z-ne)*mM(te,fe),Ie=Pj(g,tn,Zn,2,te,xe,kt,Math.abs(ae[0]),lD,ht,j,st?0:this.viewRotation_);e:if(Ie){const ke=[];let Se,Ue,ft,Ze,rt;if(K)for(Se=0,Ue=Ie.length;Se<Ue;++Se){rt=Ie[Se],ft=rt[4],Ze=this.createLabel(ft,ce,"",K),L=rt[2]+(ae[0]<0?-Ae:Ae),P=lt*Ze.height+(.5-lt)*2*Ae*ae[1]/ae[0]-ii;const nn=this.calculateImageOrLabelDimensions_(Ze.width,Ze.height,rt[0],rt[1],Ze.width,Ze.height,L,P,0,0,rt[3],Lt,!1,bf,!1,ot);if(d&&C==="declutter"&&d.collides(nn.declutterBox))break e;ke.push([e,t,Ze,nn,1,null,null])}if(Q)for(Se=0,Ue=Ie.length;Se<Ue;++Se){rt=Ie[Se],ft=rt[4],Ze=this.createLabel(ft,ce,Q,""),L=rt[2],P=lt*Ze.height-ii;const nn=this.calculateImageOrLabelDimensions_(Ze.width,Ze.height,rt[0],rt[1],Ze.width,Ze.height,L,P,0,0,rt[3],Lt,!1,bf,!1,ot);if(d&&C==="declutter"&&d.collides(nn.declutterBox))break e;ke.push([e,t,Ze,nn,1,null,null])}d&&C!=="none"&&d.load(ke.map(xD));for(let nn=0,fn=ke.length;nn<fn;++nn)this.replayImageOrLabel_.apply(this,ke[nn])}}++_;break;case Xn.END_GEOMETRY:if(a!==void 0){ot=Re[1];const fe=a(ot,Vt,C);if(fe)return fe}++_;break;case Xn.FILL:ut?pe++:this.fill_(e),++_;break;case Xn.MOVE_TO_LINE_TO:for(T=Re[1],I=Re[2],dt=g[T],Ct=g[T+1],e.moveTo(dt,Ct),O=dt+.5|0,z=Ct+.5|0,T+=2;T<I;T+=2)dt=g[T],Ct=g[T+1],H=dt+.5|0,Y=Ct+.5|0,(T==I-2||H!==O||Y!==z)&&(e.lineTo(dt,Ct),O=H,z=Y);++_;break;case Xn.SET_FILL_STYLE:Fe=Re,this.alignAndScaleFill_=Re[2],pe&&(this.fill_(e),pe=0,ze&&(e.stroke(),ze=0)),e.fillStyle=Re[1],++_;break;case Xn.SET_STROKE_STYLE:qe=Re,ze&&(e.stroke(),ze=0),this.setStrokeStyle_(e,Re),++_;break;case Xn.STROKE:ut?ze++:e.stroke(),++_;break;default:++_;break}}pe&&this.fill_(e),ze&&e.stroke()}execute(e,t,i,r,s,a){this.viewRotation_=r,this.execute_(e,t,i,this.instructions,s,void 0,void 0,a)}executeHitDetection(e,t,i,r,s){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,r,s)}}const vm=["Polygon","Circle","LineString","Image","Text","Default"],xB=["Image","Text"],Dj=vm.filter(n=>!xB.includes(n));class kj{constructor(e,t,i,r,s,a,o){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ol(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(s,o)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const s=e[i];for(const a in s){const o=s[a];r[a]=new Lj(this.resolution_,this.pixelRatio_,this.overlaps_,o,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let r=0,s=e.length;r<s;++r)if(e[r]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,r,s,a){r=Math.round(r);const o=r*2+1,d=ju(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-i,-e[0],-e[1]),p=!this.hitDetectionContext_;p&&(this.hitDetectionContext_=Zs(o,o,void 0,{willReadFrequently:!0}));const g=this.hitDetectionContext_;g.canvas.width!==o||g.canvas.height!==o?(g.canvas.width=o,g.canvas.height=o):p||g.clearRect(0,0,o,o);let _;this.renderBuffer_!==void 0&&(_=Da(),xy(_,e),R0(_,t*(this.renderBuffer_+r),_));const w=Fj(r);let T;function I(Y,ee,te){const ce=g.getImageData(0,0,o,o).data;for(let K=0,Q=w.length;K<Q;K++)if(ce[w[K]]>0){if(!a||te==="none"||T!=="Image"&&T!=="Text"||a.includes(Y)){const pe=(w[K]-3)/4,ze=r-pe%o,Fe=r-(pe/o|0),qe=s(Y,ee,ze*ze+Fe*Fe);if(qe)return qe}g.clearRect(0,0,o,o);break}}const L=Object.keys(this.executorsByZIndex_).map(Number);L.sort(Ou);let P,C,O,z,H;for(P=L.length-1;P>=0;--P){const Y=L[P].toString();for(O=this.executorsByZIndex_[Y],C=vm.length-1;C>=0;--C)if(T=vm[C],z=O[T],z!==void 0&&(H=z.executeHitDetection(g,d,i,I,_),H))return H}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],r=t[1],s=t[2],a=t[3],o=[i,r,i,a,s,a,s,r];return fd(o,0,8,2,e,o),o}isEmpty(){return Qm(this.executorsByZIndex_)}execute(e,t,i,r,s,a,o){const d=Object.keys(this.executorsByZIndex_).map(Number);d.sort(Ou),a=a||vm;const p=vm.length;let g,_,w,T,I;for(o&&d.reverse(),g=0,_=d.length;g<_;++g){const L=d[g].toString();for(I=this.executorsByZIndex_[L],w=0,T=a.length;w<T;++w){const P=a[w],C=I[P];if(C!==void 0){const O=o===null?void 0:C.getZIndexContext(),z=O?O.getContext():e,H=this.maxExtent_&&P!=="Image"&&P!=="Text";if(H&&(z.save(),this.clip(z,i)),!O||P==="Text"||P==="Image"?C.execute(z,t,i,r,s,o):O.pushFunction(Y=>C.execute(Y,t,i,r,s,o)),H&&z.restore(),O){O.offset();const Y=d[g]*p+w;this.deferredZIndexContexts_[Y]||(this.deferredZIndexContexts_[Y]=[]),this.deferredZIndexContexts_[Y].push(O)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){const e=this.deferredZIndexContexts_,t=Object.keys(e).map(Number).sort(Ou);for(let i=0,r=t.length;i<r;++i)e[t[i]].forEach(s=>{s.draw(this.renderedContext_),s.clear()}),e[t[i]].length=0}}const gM={};function Fj(n){if(gM[n]!==void 0)return gM[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let s=0;s<=n;++s)for(let a=0;a<=n;++a){const o=s*s+a*a;if(o>t)break;let d=i[o];d||(d=[],i[o]=d),d.push(((n+s)*e+(n+a))*4+3),s>0&&d.push(((n-s)*e+(n+a))*4+3),a>0&&(d.push(((n+s)*e+(n-a))*4+3),s>0&&d.push(((n-s)*e+(n-a))*4+3))}const r=[];for(let s=0,a=i.length;s<a;++s)i[s]&&r.push(...i[s]);return gM[n]=r,r}class Oj extends gB{constructor(e,t,i,r,s,a,o){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?ub(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=a,this.userTransform_=o,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ol()}drawImages_(e,t,i,r){if(!this.image_)return;const s=fd(e,t,i,r,this.transform_,this.pixelCoordinates_),a=this.context_,o=this.tmpLocalTransform_,d=a.globalAlpha;this.imageOpacity_!=1&&(a.globalAlpha=d*this.imageOpacity_);let p=this.imageRotation_;this.transformRotation_===0&&(p-=this.viewRotation_),this.imageRotateWithView_&&(p+=this.viewRotation_);for(let g=0,_=s.length;g<_;g+=2){const w=s[g]-this.imageAnchorX_,T=s[g+1]-this.imageAnchorY_;if(p!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const I=w+this.imageAnchorX_,L=T+this.imageAnchorY_;ju(o,I,L,1,1,p,-I,-L),a.save(),a.transform.apply(a,o),a.translate(I,L),a.scale(this.imageScale_[0],this.imageScale_[1]),a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),a.restore()}else a.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,w,T,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(a.globalAlpha=d)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=fd(e,t,i,r,this.transform_,this.pixelCoordinates_),a=this.context_;let o=this.textRotation_;for(this.transformRotation_===0&&(o-=this.viewRotation_),this.textRotateWithView_&&(o+=this.viewRotation_);t<i;t+=r){const d=s[t]+this.textOffsetX_,p=s[t+1]+this.textOffsetY_;o!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(a.save(),a.translate(d-this.textOffsetX_,p-this.textOffsetY_),a.rotate(o),a.translate(this.textOffsetX_,this.textOffsetY_),a.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&a.strokeText(this.text_,0,0),this.textFillState_&&a.fillText(this.text_,0,0),a.restore()):(this.textStrokeState_&&a.strokeText(this.text_,d,p),this.textFillState_&&a.fillText(this.text_,d,p))}}moveToLineTo_(e,t,i,r,s){const a=this.context_,o=fd(e,t,i,r,this.transform_,this.pixelCoordinates_);a.moveTo(o[0],o[1]);let d=o.length;s&&(d-=2);for(let p=2;p<d;p+=2)a.lineTo(o[p],o[p+1]);return s&&a.closePath(),i}drawRings_(e,t,i,r){for(let s=0,a=i.length;s<a;++s)t=this.moveToLineTo_(e,t,i[s],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!No(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=EW(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],s=Math.sqrt(i*i+r*r),a=this.context_;a.beginPath(),a.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&a.fill(),this.strokeState_&&a.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!No(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(No(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let s=0;const a=e.getEnds(),o=e.getStride();i.beginPath();for(let d=0,p=a.length;d<p;++d)s=this.moveToLineTo_(r,s,a[d],o,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!No(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!No(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const s=e.getEndss(),a=e.getStride();t.beginPath();for(let o=0,d=s.length;o<d;++o){const p=s[o];r=this.drawRings_(i,r,p,a)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Ku(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:c0;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:Ac(i||Jo)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),s=t.getLineDash(),a=t.getLineDashOffset(),o=t.getLineJoin(),d=t.getWidth(),p=t.getMiterLimit(),g=s||Bu;this.strokeState_={lineCap:r!==void 0?r:ig,lineDash:this.pixelRatio_===1?g:g.map(_=>_*this.pixelRatio_),lineDashOffset:(a||Uu)*this.pixelRatio_,lineJoin:o!==void 0?o:rg,lineWidth:(d!==void 0?d:u0)*this.pixelRatio_,miterLimit:p!==void 0?p:a0,strokeStyle:Ac(i||l0)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const a=e.getScaleArray();this.imageScale_=[a[0]*this.pixelRatio_/i,a[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const T=t.getColor();this.textFillState_={fillStyle:Ac(T||Jo)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const T=i.getColor(),I=i.getLineCap(),L=i.getLineDash(),P=i.getLineDashOffset(),C=i.getLineJoin(),O=i.getWidth(),z=i.getMiterLimit();this.textStrokeState_={lineCap:I!==void 0?I:ig,lineDash:L||Bu,lineDashOffset:P||Uu,lineJoin:C!==void 0?C:rg,lineWidth:O!==void 0?O:u0,miterLimit:z!==void 0?z:a0,strokeStyle:Ac(T||l0)}}const r=e.getFont(),s=e.getOffsetX(),a=e.getOffsetY(),o=e.getRotateWithView(),d=e.getRotation(),p=e.getScaleArray(),g=e.getText(),_=e.getTextAlign(),w=e.getTextBaseline();this.textState_={font:r!==void 0?r:rB,textAlign:_!==void 0?_:c0,textBaseline:w!==void 0?w:aw},this.text_=g!==void 0?Array.isArray(g)?g.reduce((T,I,L)=>T+=L%2?" ":I,""):g:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=a!==void 0?this.pixelRatio_*a:0,this.textRotateWithView_=o!==void 0?o:!1,this.textRotation_=d!==void 0?d:0,this.textScale_=[this.pixelRatio_*p[0],this.pixelRatio_*p[1]]}}}const Mc=.5;function Nj(n,e,t,i,r,s,a,o,d){const p=r,g=n[0]*Mc,_=n[1]*Mc,w=Zs(g,_);w.imageSmoothingEnabled=!1;const T=w.canvas,I=new Oj(w,Mc,r,null,a,o,null),L=t.length,P=Math.floor((256*256*256-1)/L),C={};for(let z=1;z<=L;++z){const H=t[z-1],Y=H.getStyleFunction()||i;if(!Y)continue;let ee=Y(H,s);if(!ee)continue;Array.isArray(ee)||(ee=[ee]);const ce=(z*P).toString(16).padStart(7,"#00000");for(let K=0,Q=ee.length;K<Q;++K){const pe=ee[K],ze=pe.getGeometryFunction()(H);if(!ze||!No(p,ze.getExtent()))continue;const Fe=pe.clone(),qe=Fe.getFill();qe&&qe.setColor(ce);const et=Fe.getStroke();et&&(et.setColor(ce),et.setLineDash(null)),Fe.setText(void 0);const Ne=pe.getImage();if(Ne){const ot=Ne.getImageSize();if(!ot)continue;const dt=Zs(ot[0],ot[1],void 0,{alpha:!1}),Ct=dt.canvas;dt.fillStyle=ce,dt.fillRect(0,0,Ct.width,Ct.height),Fe.setImage(new wb({img:Ct,anchor:Ne.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Ne.getOrigin(),opacity:1,size:Ne.getSize(),scale:Ne.getScale(),rotation:Ne.getRotation(),rotateWithView:Ne.getRotateWithView()}))}const st=Fe.getZIndex()||0;let Ee=C[st];Ee||(Ee={},C[st]=Ee,Ee.Polygon=[],Ee.Circle=[],Ee.LineString=[],Ee.Point=[]);const ut=ze.getType();if(ut==="GeometryCollection"){const ot=ze.getGeometriesArrayRecursive();for(let dt=0,Ct=ot.length;dt<Ct;++dt){const Vt=ot[dt];Ee[Vt.getType().replace("Multi","")].push(Vt,Fe)}}else Ee[ut.replace("Multi","")].push(ze,Fe)}}const O=Object.keys(C).map(Number).sort(Ou);for(let z=0,H=O.length;z<H;++z){const Y=C[O[z]];for(const ee in Y){const te=Y[ee];for(let ce=0,K=te.length;ce<K;ce+=2){I.setStyle(te[ce+1]);for(let Q=0,pe=e.length;Q<pe;++Q)I.setTransform(e[Q]),I.drawGeometry(te[ce])}}}return w.getImageData(0,0,T.width,T.height)}function zj(n,e,t){const i=[];if(t){const r=Math.floor(Math.round(n[0])*Mc),s=Math.floor(Math.round(n[1])*Mc),a=(es(r,0,t.width-1)+es(s,0,t.height-1)*t.width)*4,o=t.data[a],d=t.data[a+1],g=t.data[a+2]+256*(d+256*o),_=Math.floor((256*256*256-1)/e.length);g&&g%_===0&&i.push(e[g/_-1])}return i}const Bj=.5,wB={Point:qj,LineString:Wj,Polygon:Zj,MultiPoint:Xj,MultiLineString:jj,MultiPolygon:$j,GeometryCollection:Hj,Circle:Vj};function Uj(n,e){return parseInt(ai(n),10)-parseInt(ai(e),10)}function bD(n,e){const t=bB(n,e);return t*t}function bB(n,e){return Bj*n/e}function Vj(n,e,t,i,r){const s=t.getFill(),a=t.getStroke();if(s||a){const d=n.getBuilder(t.getZIndex(),"Circle");d.setFillStrokeStyle(s,a),d.drawCircle(e,i,r)}const o=t.getText();if(o&&o.getText()){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(o),d.drawText(e,i)}}function SD(n,e,t,i,r,s,a,o){const d=[],p=t.getImage();if(p){let w=!0;const T=p.getImageState();T==xi.LOADED||T==xi.ERROR?w=!1:T==xi.IDLE&&p.load(),w&&d.push(p.ready())}const g=t.getFill();g&&g.loading()&&d.push(g.ready());const _=d.length>0;return _&&Promise.all(d).then(()=>r(null)),Gj(n,e,t,i,s,a,o),_}function Gj(n,e,t,i,r,s,a){const o=t.getGeometryFunction()(e);if(!o)return;const d=o.simplifyTransformed(i,r);if(t.getRenderer())SB(n,d,t,e,a);else{const g=wB[d.getType()];g(n,d,t,e,a,s)}}function SB(n,e,t,i,r){if(e.getType()=="GeometryCollection"){const a=e.getGeometries();for(let o=0,d=a.length;o<d;++o)SB(n,a[o],t,i,r);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),r)}function Hj(n,e,t,i,r,s){const a=e.getGeometriesArray();let o,d;for(o=0,d=a.length;o<d;++o){const p=wB[a[o].getType()];p(n,a[o],t,i,r,s)}}function Wj(n,e,t,i,r){const s=t.getStroke();if(s){const o=n.getBuilder(t.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawLineString(e,i,r)}const a=t.getText();if(a&&a.getText()){const o=n.getBuilder(t.getZIndex(),"Text");o.setTextStyle(a),o.drawText(e,i,r)}}function jj(n,e,t,i,r){const s=t.getStroke();if(s){const o=n.getBuilder(t.getZIndex(),"LineString");o.setFillStrokeStyle(null,s),o.drawMultiLineString(e,i,r)}const a=t.getText();if(a&&a.getText()){const o=n.getBuilder(t.getZIndex(),"Text");o.setTextStyle(a),o.drawText(e,i,r)}}function $j(n,e,t,i,r){const s=t.getFill(),a=t.getStroke();if(a||s){const d=n.getBuilder(t.getZIndex(),"Polygon");d.setFillStrokeStyle(s,a),d.drawMultiPolygon(e,i,r)}const o=t.getText();if(o&&o.getText()){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(o),d.drawText(e,i,r)}}function qj(n,e,t,i,r,s){const a=t.getImage(),o=t.getText(),d=o&&o.getText(),p=s&&a&&d?{}:void 0;if(a){if(a.getImageState()!=xi.LOADED)return;const g=n.getBuilder(t.getZIndex(),"Image");g.setImageStyle(a,p),g.drawPoint(e,i,r)}if(d){const g=n.getBuilder(t.getZIndex(),"Text");g.setTextStyle(o,p),g.drawText(e,i,r)}}function Xj(n,e,t,i,r,s){const a=t.getImage(),o=a&&a.getOpacity()!==0,d=t.getText(),p=d&&d.getText(),g=s&&o&&p?{}:void 0;if(o){if(a.getImageState()!=xi.LOADED)return;const _=n.getBuilder(t.getZIndex(),"Image");_.setImageStyle(a,g),_.drawMultiPoint(e,i,r)}if(p){const _=n.getBuilder(t.getZIndex(),"Text");_.setTextStyle(d,g),_.drawText(e,i,r)}}function Zj(n,e,t,i,r){const s=t.getFill(),a=t.getStroke();if(s||a){const d=n.getBuilder(t.getZIndex(),"Polygon");d.setFillStrokeStyle(s,a),d.drawPolygon(e,i,r)}const o=t.getText();if(o&&o.getText()){const d=n.getBuilder(t.getZIndex(),"Text");d.setTextStyle(o),d.drawText(e,i,r)}}class Yj extends vB{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.clipped_=!1,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Da(),this.wrappedRenderedExtent_=Da(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.renderedFrameDeclutter_,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.targetContext_=null,this.opacity_=1}renderWorlds(e,t,i){const r=t.extent,s=t.viewState,a=s.center,o=s.resolution,d=s.projection,p=s.rotation,g=d.getExtent(),_=this.getLayer().getSource(),w=this.getLayer().getDeclutter(),T=t.pixelRatio,I=t.viewHints,L=!(I[mo.ANIMATING]||I[mo.INTERACTING]),P=this.context,C=Math.round(qi(r)/o*T),O=Math.round(js(r)/o*T),z=_.getWrapX()&&d.canWrapX(),H=z?qi(g):null,Y=z?Math.ceil((r[2]-g[2])/H)+1:1;let ee=z?Math.floor((r[0]-g[0])/H):0;do{let te=this.getRenderTransform(a,o,0,T,C,O,ee*H);t.declutter&&(te=te.slice(0)),e.execute(P,[P.canvas.width,P.canvas.height],te,p,L,i===void 0?vm:i?xB:Dj,i?w&&t.declutter[w]:void 0)}while(++ee<Y)}setDrawContext_(){this.opacity_!==1&&(this.targetContext_=this.context,this.context=Zs(this.context.canvas.width,this.context.canvas.height,vD))}resetDrawContext_(){if(this.opacity_!==1){const e=this.targetContext_.globalAlpha;this.targetContext_.globalAlpha=this.opacity_,this.targetContext_.drawImage(this.context.canvas,0,0),this.targetContext_.globalAlpha=e,yb(this.context),vD.push(this.context.canvas),this.context=this.targetContext_,this.targetContext_=null}}renderDeclutter(e){!this.replayGroup_||!this.getLayer().getDeclutter()||this.renderWorlds(this.replayGroup_,e,!0)}renderDeferredInternal(e){this.replayGroup_&&(this.replayGroup_.renderDeferred(),this.clipped_&&this.context.restore(),this.resetDrawContext_())}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex];this.opacity_=i.opacity;const r=e.viewState;this.prepareContainer(e,t);const s=this.context,a=this.replayGroup_;let o=a&&!a.isEmpty();if(!o&&!(this.getLayer().hasListener(sl.PRERENDER)||this.getLayer().hasListener(sl.POSTRENDER)))return null;if(this.setDrawContext_(),this.preRender(s,e),r.projection,this.clipped_=!1,o&&i.extent&&this.clipping){const d=Kh(i.extent);o=No(d,e.extent),this.clipped_=o&&!_m(d,e.extent),this.clipped_&&this.clipUnrotated(s,e,d)}return o&&this.renderWorlds(a,e,this.getLayer().getDeclutter()?!1:void 0),!e.declutter&&this.clipped_&&s.restore(),this.postRender(s,e),this.renderedRotation_!==r.rotation&&(this.renderedRotation_=r.rotation,this.hitDetectionImageData_=null),e.declutter||this.resetDrawContext_(),this.container}getFeatures(e){return new Promise(t=>{if(this.frameState&&!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=this.frameState.size.slice(),r=this.renderedCenter_,s=this.renderedResolution_,a=this.renderedRotation_,o=this.renderedProjection_,d=this.wrappedRenderedExtent_,p=this.getLayer(),g=[],_=i[0]*Mc,w=i[1]*Mc;g.push(this.getRenderTransform(r,s,a,Mc,_,w,0).slice());const T=p.getSource(),I=o.getExtent();if(T.getWrapX()&&o.canWrapX()&&!_m(I,d)){let L=d[0];const P=qi(I);let C=0,O;for(;L<I[0];)--C,O=P*C,g.push(this.getRenderTransform(r,s,a,Mc,_,w,O).slice()),L+=P;for(C=0,L=d[2];L>I[2];)++C,O=P*C,g.push(this.getRenderTransform(r,s,a,Mc,_,w,O).slice()),L-=P}this.hitDetectionImageData_=Nj(i,g,this.renderedFeatures_,p.getStyleFunction(),d,s,a,bD(s,this.renderedPixelRatio_))}t(zj(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,r,s){if(!this.replayGroup_)return;const a=t.viewState.resolution,o=t.viewState.rotation,d=this.getLayer(),p={},g=function(I,L,P){const C=ai(I),O=p[C];if(O){if(O!==!0&&P<O.distanceSq){if(P===0)return p[C]=!0,s.splice(s.lastIndexOf(O),1),r(I,d,L);O.geometry=L,O.distanceSq=P}}else{if(P===0)return p[C]=!0,r(I,d,L);s.push(p[C]={feature:I,layer:d,geometry:L,distanceSq:P,callback:r})}};let _;const w=[this.replayGroup_],T=this.getLayer().getDeclutter();return w.some(I=>_=I.forEachFeatureAtCoordinate(e,a,o,i,g,T&&t.declutter[T]?t.declutter[T].all().map(L=>L.value):null)),_}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const r=e.viewHints[mo.ANIMATING],s=e.viewHints[mo.INTERACTING],a=t.getUpdateWhileAnimating(),o=t.getUpdateWhileInteracting();if(this.ready&&!a&&r||!o&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const d=e.extent,p=e.viewState,g=p.projection,_=p.resolution,w=e.pixelRatio,T=t.getRevision(),I=t.getRenderBuffer();let L=t.getRenderOrder();L===void 0&&(L=Uj);const P=p.center.slice(),C=R0(d,I*_),O=C.slice(),z=[C.slice()],H=g.getExtent();if(i.getWrapX()&&g.canWrapX()&&!_m(H,e.extent)){const qe=qi(H),et=Math.max(qi(C)/2,qe);C[0]=H[0]-et,C[2]=H[2]+et,lA(P,g);const Ne=Cz(z[0],g);Ne[0]<H[0]&&Ne[2]<H[2]?z.push([Ne[0]+qe,Ne[1],Ne[2]+qe,Ne[3]]):Ne[0]>H[0]&&Ne[2]>H[2]&&z.push([Ne[0]-qe,Ne[1],Ne[2]-qe,Ne[3]])}if(this.ready&&this.renderedResolution_==_&&this.renderedRevision_==T&&this.renderedRenderOrder_==L&&this.renderedFrameDeclutter_===!!e.declutter&&_m(this.wrappedRenderedExtent_,C))return Ku(this.renderedExtent_,O)||(this.hitDetectionImageData_=null,this.renderedExtent_=O),this.renderedCenter_=P,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const Y=new Cj(bB(_,w),C,_,w);let ee;for(let qe=0,et=z.length;qe<et;++qe)i.loadFeatures(z[qe],_,g);const te=bD(_,w);let ce=!0;const K=(qe,et)=>{let Ne;const st=qe.getStyleFunction()||t.getStyleFunction();if(st&&(Ne=st(qe,_)),Ne){const Ee=this.renderFeature(qe,te,Ne,Y,ee,this.getLayer().getDeclutter(),et);ce=ce&&!Ee}},Q=db(C),pe=i.getFeaturesInExtent(Q);L&&pe.sort(L);for(let qe=0,et=pe.length;qe<et;++qe)K(pe[qe],qe);this.renderedFeatures_=pe,this.ready=ce;const ze=Y.finish(),Fe=new kj(C,_,w,i.getOverlaps(),ze,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=_,this.renderedRevision_=T,this.renderedRenderOrder_=L,this.renderedFrameDeclutter_=!!e.declutter,this.renderedExtent_=O,this.wrappedRenderedExtent_=C,this.renderedCenter_=P,this.renderedProjection_=g,this.renderedPixelRatio_=w,this.replayGroup_=Fe,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,r,s,a,o){if(!i)return!1;let d=!1;if(Array.isArray(i))for(let p=0,g=i.length;p<g;++p)d=SD(r,e,i[p],t,this.boundHandleStyleImageChange_,s,a,o)||d;else d=SD(r,e,i,t,this.boundHandleStyleImageChange_,s,a,o);return d}}class Eb extends mB{constructor(e){super(e)}createRenderer(){return new Yj(this)}}const Xr={ADD:"add",REMOVE:"remove"},MD={LENGTH:"length"};class sx extends la{constructor(e,t,i){super(e),this.element=t,this.index=i}}class vo extends Uc{constructor(e,t){if(super(),this.on,this.once,this.un,t=t||{},this.unique_=!!t.unique,this.array_=e||[],this.unique_)for(let i=0,r=this.array_.length;i<r;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(e){for(let t=0,i=e.length;t<i;++t)this.push(e[t]);return this}forEach(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)e(t[i],i,t)}getArray(){return this.array_}item(e){return this.array_[e]}getLength(){return this.get(MD.LENGTH)}insertAt(e,t){if(e<0||e>this.getLength())throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t),this.array_.splice(e,0,t),this.updateLength_(),this.dispatchEvent(new sx(Xr.ADD,t,e))}pop(){return this.removeAt(this.getLength()-1)}push(e){this.unique_&&this.assertUnique_(e);const t=this.getLength();return this.insertAt(t,e),this.getLength()}remove(e){const t=this.array_;for(let i=0,r=t.length;i<r;++i)if(t[i]===e)return this.removeAt(i)}removeAt(e){if(e<0||e>=this.getLength())return;const t=this.array_[e];return this.array_.splice(e,1),this.updateLength_(),this.dispatchEvent(new sx(Xr.REMOVE,t,e)),t}setAt(e,t){const i=this.getLength();if(e>=i){this.insertAt(e,t);return}if(e<0)throw new Error("Index out of bounds: "+e);this.unique_&&this.assertUnique_(t,e);const r=this.array_[e];this.array_[e]=t,this.dispatchEvent(new sx(Xr.REMOVE,r,e)),this.dispatchEvent(new sx(Xr.ADD,t,e))}updateLength_(){this.set(MD.LENGTH,this.array_.length)}assertUnique_(e,t){for(let i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===e&&i!==t)throw new Error("Duplicate item added to a unique collection")}}class dw{constructor(e){this.rbush_=new Zz(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[ai(t)]=i}load(e,t){const i=new Array(t.length);for(let r=0,s=t.length;r<s;r++){const a=e[r],o=t[r],d={minX:a[0],minY:a[1],maxX:a[2],maxY:a[3],value:o};i[r]=d,this.items_[ai(o)]=d}this.rbush_.load(i)}remove(e){const t=ai(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[ai(t)],r=[i.minX,i.minY,i.maxX,i.maxY];e0(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(r){return r.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let r=0,s=e.length;r<s;r++)if(i=t(e[r]),i)return i;return i}isEmpty(){return Qm(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return $u(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const ED=Ol();class Ja{constructor(e,t,i,r,s,a){this.styleFunction,this.extent_,this.id_=a,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?vy(this.flatCoordinates_):rA(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=qu(this.getExtent());this.flatInteriorPoints_=xA(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=UW(this.flatCoordinates_,this.ends_),t=jz(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=Vz(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=rw(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,s=i.length;r<s;++r){const a=i[r],o=rw(e,t,a,2,.5);ll(this.flatMidpoints_,o),t=a}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=aa(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const r=js(i)/js(t);ju(ED,i[0],i[3],r,-r,0,0,0),fd(this.flatCoordinates_,0,this.flatCoordinates_.length,2,ED,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new Ja(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=bz((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=pb(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=Dz(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,r);break;case"Polygon":r=[],i.length=yA(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,r);break}return r&&(this.simplifiedGeometry_=new Ja(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}Ja.prototype.getFlatCoordinates=Ja.prototype.getOrientedFlatCoordinates;let MB=class extends Uc{constructor(e){super(),this.projection=aa(e.projection),this.attributions_=TD(e.attributions),this.attributionsCollapsible_=e.attributionsCollapsible!==void 0?e.attributionsCollapsible:!0,this.loading=!1,this.state_=e.state!==void 0?e.state:"ready",this.wrapX_=e.wrapX!==void 0?e.wrapX:!1,this.interpolate_=!!e.interpolate,this.viewResolver=null,this.viewRejector=null;const t=this;this.viewPromise_=new Promise(function(i,r){t.viewResolver=i,t.viewRejector=r})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(e){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(e){this.attributions_=TD(e),this.changed()}setState(e){this.state_=e,this.changed()}};function TD(n){return n?Array.isArray(n)?function(e){return n}:typeof n=="function"?n:function(e){return[n]}:null}const fo={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Kj(n,e){return[[-1/0,-1/0,1/0,1/0]]}let Jj=!1;function Qj(n,e,t,i,r,s,a){const o=new XMLHttpRequest;o.open("GET",typeof n=="function"?n(t,i,r):n,!0),e.getType()=="arraybuffer"&&(o.responseType="arraybuffer"),o.withCredentials=Jj,o.onload=function(d){if(!o.status||o.status>=200&&o.status<300){const p=e.getType();try{let g;p=="text"||p=="json"?g=o.responseText:p=="xml"?g=o.responseXML||o.responseText:p=="arraybuffer"&&(g=o.response),g?s(e.readFeatures(g,{extent:t,featureProjection:r}),e.readProjection(g)):a()}catch{a()}}else a()},o.onerror=a,o.send()}function CD(n,e){return function(t,i,r,s,a){const o=this;Qj(n,e,t,i,r,function(d,p){o.addFeatures(d),s!==void 0&&s(d)},a||Jm)}}class Rh extends la{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class OA extends MB{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Jm,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(Bi(this.format_,"`format` must be set when `url` is set"),this.loader_=CD(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:Kj;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new dw:null,this.loadedExtentsRtree_=new dw,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(e.features)?r=e.features:e.features&&(i=e.features,r=i.getArray()),!t&&i===void 0&&(i=new vo(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=ai(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new Rh(fo.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof Ja||(this.featureChangeKeys_[e]=[fi(t,ti.CHANGE,this.handleFeatureChange_,this),fi(t,Km.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const r=String(t.getId());if(!(r in this.idIndex_))this.idIndex_[r]=t;else if(t instanceof Ja){const s=this.idIndex_[r];s instanceof Ja?Array.isArray(s)?s.push(t):this.idIndex_[r]=[s,t]:i=!1}else i=!1}return i&&(Bi(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],r=[];for(let s=0,a=e.length;s<a;s++){const o=e[s],d=ai(o);this.addToIndex_(d,o)&&i.push(o)}for(let s=0,a=i.length;s<a;s++){const o=i[s],d=ai(o);this.setupChangeEvents_(d,o);const p=o.getGeometry();if(p){const g=p.getExtent();t.push(g),r.push(o)}else this.nullGeometryFeatures_[d]=o}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(fo.ADDFEATURE))for(let s=0,a=i.length;s<a;s++)this.dispatchEvent(new Rh(fo.ADDFEATURE,i[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(fo.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(fo.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(Xr.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(Xr.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(cr);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(i);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new Rh(fo.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(r){const s=r.getGeometry();if(s instanceof Ja||s.intersectsCoordinate(e))return t(r)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const r=i.getGeometry();if(r instanceof Ja||r.intersectsExtent(e)){const s=t(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),Qm(this.nullGeometryFeatures_)||ll(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=Az(e,t);return[].concat(...r.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],r=e[1];let s=null;const a=[NaN,NaN];let o=1/0;const d=[-1/0,-1/0,1/0,1/0];return t=t||Gl,this.featuresRtree_.forEachInExtent(d,function(p){if(t(p)){const g=p.getGeometry(),_=o;if(o=g instanceof Ja?0:g.closestPointXY(i,r,a,o),o<_){s=p;const w=Math.sqrt(o);d[0]=i-w,d[1]=r-w,d[2]=i+w,d[3]=r+w}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=ai(t),r=t.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const a=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(a,t)):this.featuresRtree_&&this.featuresRtree_.update(a,t)}const s=t.getId();if(s!==void 0){const a=s.toString();this.idIndex_[a]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[a]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new Rh(fo.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:ai(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Qm(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const r=this.loadedExtentsRtree_,s=this.strategy_(e,t,i);for(let a=0,o=s.length;a<o;++a){const d=s[a];r.forEachInExtent(d,function(g){return _m(g.extent,d)})||(++this.loadingExtentsCount_,this.dispatchEvent(new Rh(fo.FEATURESLOADSTART)),this.loader_.call(this,d,t,i,g=>{--this.loadingExtentsCount_,this.dispatchEvent(new Rh(fo.FEATURESLOADEND,void 0,g))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new Rh(fo.FEATURESLOADERROR))}),r.insert(d,{extent:d.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(r){if(e0(r.extent,e))return i=r,!0}),i&&t.remove(i)}removeFeatures(e){const t=[];for(let i=0,r=e.length;i<r;++i){const s=e[i],a=this.removeFeatureInternal(s);a&&t.push(a)}t.length>0&&this.changed()}removeFeature(e){if(!e)return;this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=ai(e);if(!(t in this.uidIndex_))return;t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e);const i=this.featureChangeKeys_[t];i==null||i.forEach(cr),delete this.featureChangeKeys_[t];const r=e.getId();if(r!==void 0){const s=r.toString(),a=this.idIndex_[s];a===e?delete this.idIndex_[s]:Array.isArray(a)&&(a.splice(a.indexOf(e),1),a.length===1&&(this.idIndex_[s]=a[0]))}return delete this.uidIndex_[t],this.hasListener(fo.REMOVEFEATURE)&&this.dispatchEvent(new Rh(fo.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_){const r=this.idIndex_[i];if(e instanceof Ja&&Array.isArray(r)&&r.includes(e))r.splice(r.indexOf(e),1);else if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){Bi(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(CD(e,this.format_))}}function $T(n){const e=arguments;return function(t){let i=!0;for(let r=0,s=e.length;r<s&&(i=i&&e[r](t),!!i);++r);return i}}const e7=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},t7=function(n){const e=n.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},n7=function(n){const e=n.map.getTargetElement(),t=n.map.getOwnerDocument().activeElement;return e.contains(t)},EB=function(n){return n.map.getTargetElement().hasAttribute("tabindex")?n7(n):!0},p0=Gl,TB=function(n){const e=n.originalEvent;return e.button==0&&!(_9&&Jz&&e.ctrlKey)},qT=jf,CB=function(n){return n.type==Di.SINGLECLICK},NA=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},i7=function(n){const e=n.originalEvent;return Jz?e.metaKey:e.ctrlKey},zA=function(n){const e=n.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},AB=function(n){const e=n.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},_M=function(n){const e=n.originalEvent;return Bi(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.pointerType=="mouse"},IB=function(n){const e=n.originalEvent;return Bi(e!==void 0,"mapBrowserEvent must originate from a pointer event"),e.isPrimary&&e.button===0},ox={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class ax extends la{constructor(e,t){super(e),this.feature=t}}function r7(n,e){const t=[];for(let i=0;i<e.length;++i){const s=e[i].getGeometry();PB(n,s,t)}return t}function lx(n,e){return Nu(n[0],n[1],e[0],e[1])}function xm(n,e){const t=n.length;return e<0?n[e+t]:e>=t?n[e-t]:n[e]}function cx(n,e,t){let i,r;e<t?(i=e,r=t):(i=t,r=e);const s=Math.ceil(i),a=Math.floor(r);if(s>a){const d=wm(n,i),p=wm(n,r);return lx(d,p)}let o=0;if(i<s){const d=wm(n,i),p=xm(n,s);o+=lx(d,p)}if(a<r){const d=xm(n,a),p=wm(n,r);o+=lx(d,p)}for(let d=s;d<a-1;++d){const p=xm(n,d),g=xm(n,d+1);o+=lx(p,g)}return o}function PB(n,e,t){if(e instanceof zu){ux(n,e.getCoordinates(),!1,t);return}if(e instanceof n0){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r)ux(n,i[r],!1,t);return}if(e instanceof ka){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r)ux(n,i[r],!0,t);return}if(e instanceof r0){const i=e.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length;o<d;++o)ux(n,a[o],!0,t)}return}if(e instanceof nw){const i=e.getGeometries();for(let r=0;r<i.length;++r)PB(n,i[r],t);return}}const yM={index:-1,endIndex:NaN};function s7(n,e,t,i){const r=n[0],s=n[1];let a=1/0,o=-1,d=NaN;for(let _=0;_<e.targets.length;++_){const w=e.targets[_],T=w.coordinates;let I=1/0,L;for(let P=0;P<T.length-1;++P){const C=T[P],O=T[P+1],z=RB(r,s,C,O);z.squaredDistance<I&&(I=z.squaredDistance,L=P+z.along)}I<a&&(a=I,w.ring&&e.targetIndex===_&&(w.endIndex>w.startIndex?L<w.startIndex&&(L+=T.length):w.endIndex<w.startIndex&&L>w.startIndex&&(L-=T.length)),d=L,o=_)}const p=e.targets[o];let g=p.ring;if(e.targetIndex===o&&g){const _=wm(p.coordinates,d),w=t.getPixelFromCoordinate(_);J1(w,e.startPx)>i&&(g=!1)}if(g){const _=p.coordinates,w=_.length,T=p.startIndex,I=d;if(T<I){const L=cx(_,T,I);cx(_,T,I-w)<L&&(d-=w)}else{const L=cx(_,T,I);cx(_,T,I+w)<L&&(d+=w)}}return yM.index=o,yM.endIndex=d,yM}function ux(n,e,t,i){const r=n[0],s=n[1];for(let a=0,o=e.length-1;a<o;++a){const d=e[a],p=e[a+1],g=RB(r,s,d,p);if(g.squaredDistance===0){const _=a+g.along;i.push({coordinates:e,ring:t,startIndex:_,endIndex:_});return}}}const vM={along:0,squaredDistance:0};function RB(n,e,t,i){const r=t[0],s=t[1],a=i[0],o=i[1],d=a-r,p=o-s;let g=0,_=r,w=s;return(d!==0||p!==0)&&(g=es(((n-r)*d+(e-s)*p)/(d*d+p*p),0,1),_+=d*g,w+=p*g),vM.along=g,vM.squaredDistance=ub(Nu(n,e,_,w),10),vM}function wm(n,e){const t=n.length;let i=Math.floor(e);const r=e-i;i>=t?i-=t:i<0&&(i+=t);let s=i+1;s>=t&&(s-=t);const a=n[i],o=a[0],d=a[1],p=n[s],g=p[0]-o,_=p[1]-d;return[o+g*r,d+_*r]}class o7 extends Ju{constructor(e){const t=e;t.stopDown||(t.stopDown=jf),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=u7(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:Gl,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const r=this.mode_;if(r==="Circle")i=function(s,a,o){const d=a||new O0([NaN,NaN]),p=er(s[0]),g=Lc(p,er(s[s.length-1]));return d.setCenterAndRadius(p,Math.sqrt(g),this.geometryLayout_),d};else{let s;r==="Point"?s=pd:r==="LineString"?s=zu:r==="Polygon"&&(s=ka),i=function(a,o,d){return o?r==="Polygon"?a[0].length?o.setCoordinates([a[0].concat([a[0][0]])],this.geometryLayout_):o.setCoordinates([],this.geometryLayout_):o.setCoordinates(a,this.geometryLayout_):o=new s(a,this.geometryLayout_),o}}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new Eb({source:new OA({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:a7(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:NA,this.freehandCondition_,e.freehand?this.freehandCondition_=p0:this.freehandCondition_=e.freehandCondition?e.freehandCondition:zA,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(iw.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=p0:t=e:t=qT,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===ti.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===Di.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===Di.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===Di.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===Di.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===Di.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===Di.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===Di.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new Mu(Di.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),r=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),s=po([i,r]),a=this.traceSource_.getFeaturesInExtent(s);if(a.length===0)return;const o=r7(e.coordinate,a);o.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:o,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,r=e.startIndex<=t;i===r?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const r=Math.ceil(e);let s=Math.floor(t);s===t&&(s-=1),i=s-r+1}else{const r=Math.floor(e);let s=Math.ceil(t);s===t&&(s+=1),i=r-s+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const r=[];if(t<i){const s=Math.ceil(t);let a=Math.floor(i);a===i&&(a-=1);for(let o=s;o<=a;++o)r.push(xm(e.coordinates,o))}else{const s=Math.floor(t);let a=Math.ceil(i);a===i&&(a+=1);for(let o=s;o>=a;--o)r.push(xm(e.coordinates,o))}r.length&&this.appendCoordinates(r)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&J1(t.startPx,e.pixel)<this.snapTolerance_)return;const i=s7(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const d=t.targets[t.targetIndex];this.removeTracedCoordinates_(d.startIndex,d.endIndex)}const o=t.targets[i.index];this.addTracedCoordinates_(o,o.startIndex,i.endIndex)}else{const o=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(o,i.endIndex)}t.targetIndex=i.index;const r=t.targets[t.targetIndex];r.endIndex=i.endIndex;const s=wm(r.coordinates,r.endIndex),a=this.getMap().getPixelFromCoordinate(s);e.coordinate=s,e.pixel=[Math.round(a[0]),Math.round(a[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const r=!this.finishCoordinate_;r&&this.startDrawing_(e.coordinate),!r&&this.freehand_?this.finishDrawing():!this.freehand_&&(!r||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,r=t[0]-i[0],s=t[1]-i[1],a=r*r+s*s;if(this.shouldHandle_=this.freehand_?a>this.squaredClickTolerance_:a<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let r=!1,s=[this.finishCoordinate_];const a=this.mode_;if(a==="Point")i=!0;else if(a==="Circle")i=this.sketchCoords_.length===2;else if(a==="LineString")r=!t&&this.sketchCoords_.length>this.minPoints_;else if(a==="Polygon"){const o=this.sketchCoords_;r=o[0].length>this.minPoints_,s=[o[0][0],o[0][o[0].length-2]],t?s=[o[0][0]]:s=[o[0][0],o[0][o[0].length-2]]}if(r){const o=this.getMap();for(let d=0,p=s.length;d<p;d++){const g=s[d],_=o.getPixelFromCoordinate(g),w=e[0]-_[0],T=e[1]-_[1],I=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(w*w+T*T)<=I,i){this.finishCoordinate_=g;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new tl(new pd(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new tl);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new zu(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=tw(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new tl(new zu(this.sketchLineCoords_)));const r=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new tl,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new ax(ox.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),r=t.getView().getProjection(),s=tw(this.geometryLayout_);let a,o;for(;e.length<s;)e.push(0);this.mode_==="Point"?o=this.sketchCoords_:this.mode_==="Polygon"?(a=this.sketchCoords_[0],o=a[a.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(a=this.sketchCoords_,o=a[a.length-1]),o[0]=e[0],o[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,r),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let r,s;const a=this.mode_;return a==="LineString"||a==="Circle"?(this.finishCoordinate_=e.slice(),s=this.sketchCoords_,s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(e.slice()),this.geometryFunction_(s,t,i)):a==="Polygon"&&(s=this.sketchCoords_[0],s.length>=this.maxPoints_&&(this.freehand_?s.pop():r=!0),s.push(e.slice()),r&&(this.finishCoordinate_=s[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),r?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),r=this.mode_;for(let s=0;s<e;++s){let a;if(r==="LineString"||r==="Circle"){if(a=this.sketchCoords_,a.splice(-2,1),a.length>=2){this.finishCoordinate_=a[a.length-2].slice();const o=this.finishCoordinate_.slice();a[a.length-1]=o,this.createOrUpdateSketchPoint_(o)}this.geometryFunction_(a,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(r==="Polygon"){a=this.sketchCoords_[0],a.splice(-2,1);const o=this.sketchLine_.getGeometry();if(a.length>=2){const d=a[a.length-2].slice();a[a.length-1]=d,this.createOrUpdateSketchPoint_(d)}o.setCoordinates(a),this.geometryFunction_(this.sketchCoords_,t,i)}if(a.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),r=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,r)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,r),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new N0([t])):this.type_==="MultiLineString"?e.setGeometry(new n0([t])):this.type_==="MultiPolygon"&&e.setGeometry(new r0([t])),this.dispatchEvent(new ax(ox.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new ax(ox.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let r;if(t==="LineString"||t==="Circle")r=this.sketchCoords_;else if(t==="Polygon")r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&r.shift(),r.pop();for(let a=0;a<e.length;a++)this.addToDrawing_(e[a]);const s=e[e.length-1];this.sketchFeature_=this.addToDrawing_(s),this.modifyDrawing_(s)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.sketchPoint_=new tl(new pd(r)),this.updateSketchFeatures_(),this.dispatchEvent(new ax(ox.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function a7(){const n=DA();return function(e,t){return n[e.getGeometry().getType()]}}function l7(n,e){return function(t,i,r){const s=er(t[0]),a=er(t[t.length-1]),o=Math.sqrt(Lc(s,a));i=i||Hz(new O0(s),n);let d=e;{const p=a[0]-s[0],g=a[1]-s[1];d=Math.atan2(g,p)}return Wz(i,s,o,d),i}}function c7(){return function(n,e,t){const i=po([n[0],n[n.length-1]].map(function(s){return er(s)})),r=[[tg(i),D0(i),k0(i),Ad(i),tg(i)]];return e?e.setCoordinates(r):e=new ka(r),e}}function u7(n){switch(n){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+n)}}class h7 extends Tg{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==Di.DBLCLICK){const i=e.originalEvent,r=e.map,s=e.coordinate,a=i.shiftKey?-this.delta_:this.delta_,o=r.getView();bA(o,a,s,this.duration_),i.preventDefault(),t=!0}return!t}}class d7 extends tA{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",r=this.element_.style;r.left=Math.min(e[0],t[0])+i,r.top=Math.min(e[1],t[1])+i,r.width=Math.abs(t[0]-e[0])+i,r.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,r=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);r[4]=r[0].slice(),this.geometry_?this.geometry_.setCoordinates([r]):this.geometry_=new ka([r])}getGeometry(){return this.geometry_}}const F_={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class hx extends la{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class f7 extends Ju{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.box_=new d7(e.className||"ol-dragbox"),this.minArea_=e.minArea!==void 0?e.minArea:64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition?e.condition:TB,this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const r=i[0]-t[0],s=i[1]-t[1];return r*r+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new hx(F_.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;this.box_.setMap(null);const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new hx(t?F_.BOXEND:F_.BOXCANCEL,e.coordinate,e)),!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new hx(F_.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new hx(F_.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}}class p7 extends Ju{constructor(e){super({stopDown:jf}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:$T(NA,IB);this.condition_=e.onFocusOnly?$T(EB,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,r=t.getEventPixel(SA(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(r[0],r[1]),this.lastCentroid){const s=[this.lastCentroid[0]-r[0],r[1]-this.lastCentroid[1]],o=e.map.getView();hW(s,o.getResolution()),aA(s,o.getRotation()),o.adjustCenterInternal(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=r,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const r=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),a=i.getCenterInternal(),o=t.getPixelFromCoordinateInternal(a),d=t.getCoordinateFromPixelInternal([o[0]-r*Math.cos(s),o[1]-r*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(d),duration:500,easing:Eg})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class m7 extends Ju{constructor(e){e=e||{},super({stopDown:jf}),this.condition_=e.condition?e.condition:t7,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!_M(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===CA)return;const r=t.getSize(),s=e.pixel,a=Math.atan2(r[1]/2-s[1],s[0]-r[0]/2);if(this.lastAngle_!==void 0){const o=a-this.lastAngle_;i.adjustRotationInternal(-o)}this.lastAngle_=a}handleUpEvent(e){return _M(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return _M(e)&&TB(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class g7 extends f7{constructor(e){e=e||{};const t=e.condition?e.condition:zA;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let r=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(r),a=i.getResolutionForExtentInternal(s),o=i.getResolution()/a;r=r.clone(),r.scale(o*o)}i.fitInternal(r,{duration:this.duration_,easing:Eg})}}const nf={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class _7 extends Tg{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return NA(t)&&AB(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==ti.KEYDOWN){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==nf.DOWN||r==nf.LEFT||r==nf.RIGHT||r==nf.UP)){const a=e.map.getView(),o=a.getResolution()*this.pixelDelta_;let d=0,p=0;r==nf.DOWN?p=-o:r==nf.LEFT?d=-o:r==nf.RIGHT?d=o:p=o;const g=[d,p];aA(g,a.getRotation()),HW(a,g,this.duration_),i.preventDefault(),t=!0}}return!t}}class y7 extends Tg{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!i7(t)&&AB(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==ti.KEYDOWN||e.type==ti.KEYPRESS){const i=e.originalEvent,r=i.key;if(this.condition_(e)&&(r==="+"||r==="-")){const s=e.map,a=r==="+"?this.delta_:-this.delta_,o=s.getView();bA(o,a,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}const Uh={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},AD=0,Sy=1,ID=[0,0,0,0],Fm=[],xM={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class wM extends la{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class v7 extends Ju{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:IB,this.defaultDeleteCondition_=function(i){return e7(i)&&CB(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:p0,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new dw,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new Eb({source:new OA({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:w7(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new vo(this.source_.getFeatures()),this.source_.addEventListener(fo.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(fo.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(Xr.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(Xr.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const r=this.SEGMENT_WRITERS_[t.getType()];r&&r(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(ti.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new vo;const i=this.featuresBeingModified_.getArray();for(let r=0,s=t.length;r<s;++r){const a=t[r];for(let o=0,d=a.length;o<d;++o){const p=a[o].feature;p&&!i.includes(p)&&this.featuresBeingModified_.push(p)}}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new wM(xM.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(ti.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(r){e===r.feature&&i.push(r)});for(let r=i.length-1;r>=0;--r){const s=i[r];for(let a=this.dragSegments_.length-1;a>=0;--a)this.dragSegments_[a][0]===s&&this.dragSegments_.splice(a,1);t.remove(s)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),r={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),r)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r],o={feature:e,geometry:t,depth:[r],index:r,segment:[a,a]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r){const a=i.slice(r,r+2),o={feature:e,geometry:t,index:r,segment:a};this.rBush_.insert(po(a),o)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length-1;o<d;++o){const p=a.slice(o,o+2),g={feature:e,geometry:t,depth:[r],index:o,segment:p};this.rBush_.insert(po(p),g)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length-1;o<d;++o){const p=a.slice(o,o+2),g={feature:e,geometry:t,depth:[r],index:o,segment:p};this.rBush_.insert(po(p),g)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length;o<d;++o){const p=a[o];for(let g=0,_=p.length-1;g<_;++g){const w=p.slice(g,g+2),T={feature:e,geometry:t,depth:[o,r],index:g,segment:w};this.rBush_.insert(po(w),T)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),r={feature:e,geometry:t,index:AD,segment:[i,i]},s={feature:e,geometry:t,index:Sy,segment:[i,i]},a=[r,s];r.featureSegments=a,s.featureSegments=a,this.rBush_.insert(vy(i),r);let o=t;this.rBush_.insert(o.getExtent(),s)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=i[r],a=this.SEGMENT_WRITERS_[s.getType()];a(e,s)}}createOrUpdateVertexFeature_(e,t,i){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new tl(new pd(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==Di.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=Di.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==Di.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],r=[];for(let s=0,a=this.dragSegments_.length;s<a;++s){const o=this.dragSegments_[s],d=o[0],p=d.feature;i.includes(p)||i.push(p);const g=d.geometry;r.includes(g)||r.push(g);const _=d.depth;let w;const T=d.segment,I=o[1];for(;t.length<g.getStride();)t.push(T[I][t.length]);switch(g.getType()){case"Point":w=t,T[0]=t,T[1]=t;break;case"MultiPoint":w=g.getCoordinates(),w[d.index]=t,T[0]=t,T[1]=t;break;case"LineString":w=g.getCoordinates(),w[d.index+I]=t,T[I]=t;break;case"MultiLineString":w=g.getCoordinates(),w[_[0]][d.index+I]=t,T[I]=t;break;case"Polygon":w=g.getCoordinates(),w[_[0]][d.index+I]=t,T[I]=t;break;case"MultiPolygon":w=g.getCoordinates(),w[_[1]][_[0]][d.index+I]=t,T[I]=t;break;case"Circle":if(T[0]=t,T[1]=t,d.index===AD)this.changingFeature_=!0,g.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let L=J1(er(g.getCenter()),er(t));g.setRadius(L),this.changingFeature_=!1}break}w&&this.setGeometryCoordinates_(g,w)}this.createOrUpdateVertexFeature_(t,i,r)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){e.map.getView().getProjection();const r=[],s=i.getGeometry().getCoordinates(),a=po([s]),o=this.rBush_.getInExtent(a),d={};o.sort(x7);for(let p=0,g=o.length;p<g;++p){const _=o[p],w=_.segment;let T=ai(_.geometry);const I=_.depth;if(I&&(T+="-"+I.join("-")),d[T]||(d[T]=new Array(2)),_.geometry.getType()==="Circle"&&_.index===Sy){const L=RD(t,_);Il(L,s)&&!d[T][0]&&(this.dragSegments_.push([_,0]),d[T][0]=_);continue}if(Il(w[0],s)&&!d[T][0]){this.dragSegments_.push([_,0]),d[T][0]=_;continue}if(Il(w[1],s)&&!d[T][1]){if(d[T][0]&&d[T][0].index===0){let L=_.geometry.getCoordinates();switch(_.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":L=L[I[1]];case"Polygon":if(_.index!==L[I[0]].length-2)continue;break}}this.dragSegments_.push([_,1]),d[T][1]=_;continue}ai(w)in this.vertexSegments_&&!d[T][0]&&!d[T][1]&&this.insertVertexCondition_(e)&&r.push(_)}r.length&&this.willModifyFeatures_(e,[r]);for(let p=r.length-1;p>=0;--p)this.insertVertex_(r[p],s)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],r=i.geometry;if(r.getType()==="Circle"){const s=r.getCenter(),a=i.featureSegments[0],o=i.featureSegments[1];a.segment[0]=s,a.segment[1]=s,o.segment[0]=s,o.segment[1]=s,this.rBush_.update(vy(s),a);let d=r;this.rBush_.update(d.getExtent(),o)}else this.rBush_.update(po(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new wM(xM.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const r=i||t.getCoordinateFromPixel(e);t.getView().getProjection();const s=function(d,p){return PD(r,d)-PD(r,p)};let a,o;if(this.hitDetection_){const d=typeof this.hitDetection_=="object"?p=>p===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,(p,g,_)=>{_&&_.getType()==="Point"&&(_=new pd(Of(_.getCoordinates())));const w=_||p.getGeometry();if(p instanceof tl&&this.features_.getArray().includes(p)){o=w;const T=p.getGeometry().getFlatCoordinates().slice(0,2);a=[{feature:p,geometry:o,segment:[T,T]}]}return!0},{layerFilter:d})}if(!a){const d=Kh(vy(r,ID)),p=t.getView().getResolution()*this.pixelTolerance_,g=db(R0(d,p,ID));a=this.rBush_.getInExtent(g)}if(a&&a.length>0){const d=a.sort(s)[0],p=d.segment;let g=RD(r,d);const _=t.getPixelFromCoordinate(g);let w=J1(e,_);if(o||w<=this.pixelTolerance_){const T={};if(T[ai(p)]=!0,this.snapToPointer_||(this.delta_[0]=g[0]-r[0],this.delta_[1]=g[1]-r[1]),d.geometry.getType()==="Circle"&&d.index===Sy)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);else{const I=t.getPixelFromCoordinate(p[0]),L=t.getPixelFromCoordinate(p[1]),P=Lc(_,I),C=Lc(_,L);w=Math.sqrt(Math.min(P,C)),this.snappedToVertex_=w<=this.pixelTolerance_,this.snappedToVertex_&&(g=P>C?p[1]:p[0]),this.createOrUpdateVertexFeature_(g,[d.feature],[d.geometry]);const O={};O[ai(d.geometry)]=!0;for(let z=1,H=a.length;z<H;++z){const Y=a[z].segment;if(Il(p[0],Y[0])&&Il(p[1],Y[1])||Il(p[0],Y[1])&&Il(p[1],Y[0])){const ee=ai(a[z].geometry);ee in O||(O[ee]=!0,T[ai(Y)]=!0)}else break}}this.vertexSegments_=T;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,r=e.feature,s=e.geometry,a=e.depth,o=e.index;let d;for(;t.length<s.getStride();)t.push(0);switch(s.getType()){case"MultiLineString":d=s.getCoordinates(),d[a[0]].splice(o+1,0,t);break;case"Polygon":d=s.getCoordinates(),d[a[0]].splice(o+1,0,t);break;case"MultiPolygon":d=s.getCoordinates(),d[a[1]][a[0]].splice(o+1,0,t);break;case"LineString":d=s.getCoordinates(),d.splice(o+1,0,t);break;default:return}this.setGeometryCoordinates_(s,d);const p=this.rBush_;p.remove(e),this.updateSegmentIndices_(s,o,a,1);const g={segment:[i[0],t],feature:r,geometry:s,depth:a,index:o};p.insert(po(g.segment),g),this.dragSegments_.push([g,1]);const _={segment:[t,i[1]],feature:r,geometry:s,depth:a,index:o+1};p.insert(po(_.segment),_),this.dragSegments_.push([_,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=Di.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new wM(xM.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,r,s,a,o,d,p,g,_,w,T,I;for(d=e.length-1;d>=0;--d)a=e[d],T=a[0],I=ai(T.feature),T.depth&&(I+="-"+T.depth.join("-")),I in t||(t[I]={}),a[1]===0?(t[I].right=T,t[I].index=T.index):a[1]==1&&(t[I].left=T,t[I].index=T.index+1);for(I in t){switch(w=t[I].right,g=t[I].left,p=t[I].index,_=p-1,g!==void 0?T=g:T=w,_<0&&(_=0),o=T.geometry,s=o.getCoordinates(),r=s,i=!1,o.getType()){case"MultiLineString":s[T.depth[0]].length>2&&(s[T.depth[0]].splice(p,1),i=!0);break;case"LineString":s.length>2&&(s.splice(p,1),i=!0);break;case"MultiPolygon":r=r[T.depth[1]];case"Polygon":r=r[T.depth[0]],r.length>4&&(p==r.length-1&&(p=0),r.splice(p,1),i=!0,p===0&&(r.pop(),r.push(r[0]),_=r.length-1));break}if(i){this.setGeometryCoordinates_(o,s);const L=[];if(g!==void 0&&(this.rBush_.remove(g),L.push(g.segment[0])),w!==void 0&&(this.rBush_.remove(w),L.push(w.segment[1])),g!==void 0&&w!==void 0){const P={depth:T.depth,feature:T.feature,geometry:T.geometry,index:_,segment:L};this.rBush_.insert(po(P.segment),P)}this.updateSegmentIndices_(o,p,T.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,r){this.rBush_.forEachInExtent(e.getExtent(),function(s){s.geometry===e&&(i===void 0||s.depth===void 0||Ku(s.depth,i))&&s.index>t&&(s.index+=r)})}}function x7(n,e){return n.index-e.index}function PD(n,e,t){const i=e.geometry;if(i.getType()==="Circle"){let s=i;if(e.index===Sy){const a=Lc(s.getCenter(),er(n)),o=Math.sqrt(a)-s.getRadius();return o*o}}const r=er(n);return Fm[0]=er(e.segment[0]),Fm[1]=er(e.segment[1]),dW(r,Fm)}function RD(n,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===Sy)return Of(i.getClosestPoint(er(n)));const r=er(n);return Fm[0]=er(e.segment[0]),Fm[1]=er(e.segment[1]),Of(oA(r,Fm))}function w7(){const n=DA();return function(e,t){return n.Point}}class b7 extends Tg{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:p0;this.condition_=e.onFocusOnly?$T(EB,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(e){if(!this.condition_(e)||e.type!==ti.WHEEL)return!0;const i=e.map,r=e.originalEvent;r.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.coordinate);let s;if(e.type==ti.WHEEL&&(s=r.deltaY,m9&&r.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Qz),r.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const a=Date.now();this.startTime_===void 0&&(this.startTime_=a),(!this.mode_||a-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const o=i.getView();if(this.mode_==="trackpad"&&!(o.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(o.getAnimating()&&o.cancelAnimations(),o.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),o.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=a,!1;this.totalDelta_+=s;const d=Math.max(this.timeout_-(a-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),d),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-es(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),bA(t,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class S7 extends Ju{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=jf),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],r=this.targetPointers[1],s=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(this.lastAngle_!==void 0){const d=s-this.lastAngle_;this.rotationDelta_+=d,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=d}this.lastAngle_=s;const a=e.map,o=a.getView();o.getConstraints().rotation!==CA&&(this.anchor_=a.getCoordinateFromPixelInternal(a.getEventPixel(SA(this.targetPointers))),this.rotating_&&(a.render(),o.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class M7 extends Ju{constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=jf),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],r=this.targetPointers[1],s=i.clientX-r.clientX,a=i.clientY-r.clientY,o=Math.sqrt(s*s+a*a);this.lastDistance_!==void 0&&(t=this.lastDistance_/o),this.lastDistance_=o;const d=e.map,p=d.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=d.getCoordinateFromPixelInternal(d.getEventPixel(SA(this.targetPointers))),d.render(),p.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),r=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,r),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}const E7={SELECT:"select"};class T7 extends la{constructor(e,t,i,r){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=r}}const dx={};class BA extends Tg{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:CB,this.addCondition_=e.addCondition?e.addCondition:qT,this.removeCondition_=e.removeCondition?e.removeCondition:qT,this.toggleCondition_=e.toggleCondition?e.toggleCondition:zA,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:Gl,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:C7(),this.features_=e.features||new vo;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(r){return i.includes(r)}}else t=Gl;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[ai(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[ai(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(Xr.ADD,this.boundAddFeature_),this.features_.addEventListener(Xr.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(Xr.ADD,this.boundAddFeature_),this.features_.removeEventListener(Xr.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const i=this.getMap().getAllLayers().find(function(r){if(r instanceof Eb&&r.getSource()&&r.getSource().hasFeature(t))return r});i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=ai(e);t in dx||(dx[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){const s=t[r];if(s!==this&&s instanceof BA&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(s.getStyle());return}}const i=ai(e);e.setStyle(dx[i]),delete dx[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[ai(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),r=this.toggleCondition_(e),s=!t&&!i&&!r,a=e.map,o=this.getFeatures(),d=[],p=[];if(s){Mg(this.featureLayerAssociation_),a.forEachFeatureAtPixel(e.pixel,(g,_)=>{if(!(!(g instanceof tl)||!this.filter_(g,_)))return this.addFeatureLayerAssociation_(g,_),p.push(g),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let g=o.getLength()-1;g>=0;--g){const _=o.item(g),w=p.indexOf(_);w>-1?p.splice(w,1):(o.remove(_),d.push(_))}p.length!==0&&o.extend(p)}else{a.forEachFeatureAtPixel(e.pixel,(g,_)=>{if(!(!(g instanceof tl)||!this.filter_(g,_)))return(t||r)&&!o.getArray().includes(g)?(this.addFeatureLayerAssociation_(g,_),p.push(g)):(i||r)&&o.getArray().includes(g)&&(d.push(g),this.removeFeatureLayerAssociation_(g)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let g=d.length-1;g>=0;--g)o.remove(d[g]);o.extend(p)}return(p.length>0||d.length>0)&&this.dispatchEvent(new T7(E7.SELECT,p,d,e)),!0}}function C7(){const n=DA();return ll(n.Polygon,n.LineString),ll(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}const A7={SNAP:"snap"};class I7 extends la{constructor(e,t){super(e),this.vertex=t.vertex,this.vertexPixel=t.vertexPixel,this.feature=t.feature,this.segment=t.segment}}function LD(n){return n.feature?n.feature:n.element?n.element:null}const bM=[];class P7 extends Ju{constructor(e){e=e||{};const t=e;t.handleDownEvent||(t.handleDownEvent=Gl),t.stopDown||(t.stopDown=jf),super(t),this.on,this.once,this.un,this.source_=e.source?e.source:null,this.vertex_=e.vertex!==void 0?e.vertex:!0,this.edge_=e.edge!==void 0?e.edge:!0,this.features_=e.features?e.features:null,this.featuresListenerKeys_=[],this.featureChangeListenerKeys_={},this.indexedFeaturesExtents_={},this.pendingFeatures_={},this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.rBush_=new dw,this.GEOMETRY_SEGMENTERS_={Point:this.segmentPointGeometry_.bind(this),LineString:this.segmentLineStringGeometry_.bind(this),LinearRing:this.segmentLineStringGeometry_.bind(this),Polygon:this.segmentPolygonGeometry_.bind(this),MultiPoint:this.segmentMultiPointGeometry_.bind(this),MultiLineString:this.segmentMultiLineStringGeometry_.bind(this),MultiPolygon:this.segmentMultiPolygonGeometry_.bind(this),GeometryCollection:this.segmentGeometryCollectionGeometry_.bind(this),Circle:this.segmentCircleGeometry_.bind(this)}}addFeature(e,t){t=t!==void 0?t:!0;const i=ai(e),r=e.getGeometry();if(r){const s=this.GEOMETRY_SEGMENTERS_[r.getType()];if(s){this.indexedFeaturesExtents_[i]=r.getExtent(Da());const a=[];if(s(a,r),a.length===1)this.rBush_.insert(po(a[0]),{feature:e,segment:a[0]});else if(a.length>1){const o=a.map(p=>po(p)),d=a.map(p=>({feature:e,segment:p}));this.rBush_.load(o,d)}}}t&&(this.featureChangeListenerKeys_[i]=fi(e,ti.CHANGE,this.handleFeatureChange_,this))}getFeatures_(){let e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}handleEvent(e){const t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new I7(A7.SNAP,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature,segment:t.segment}))),super.handleEvent(e)}handleFeatureAdd_(e){const t=LD(e);t&&this.addFeature(t)}handleFeatureRemove_(e){const t=LD(e);t&&this.removeFeature(t)}handleFeatureChange_(e){const t=e.target;if(this.handlingDownUpSequence){const i=ai(t);i in this.pendingFeatures_||(this.pendingFeatures_[i]=t)}else this.updateFeature_(t)}handleUpEvent(e){const t=Object.values(this.pendingFeatures_);return t.length&&(t.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}removeFeature(e,t){const i=t!==void 0?t:!0,r=ai(e),s=this.indexedFeaturesExtents_[r];if(s){const a=this.rBush_,o=[];a.forEachInExtent(s,function(d){e===d.feature&&o.push(d)});for(let d=o.length-1;d>=0;--d)a.remove(o[d])}i&&(cr(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])}setMap(e){const t=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();t&&(i.forEach(cr),i.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(cr),this.featureChangeListenerKeys_={}),super.setMap(e),e&&(this.features_?i.push(fi(this.features_,Xr.ADD,this.handleFeatureAdd_,this),fi(this.features_,Xr.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(fi(this.source_,fo.ADDFEATURE,this.handleFeatureAdd_,this),fi(this.source_,fo.REMOVEFEATURE,this.handleFeatureRemove_,this)),r.forEach(s=>this.addFeature(s)))}snapTo(e,t,i){i.getView().getProjection();const r=er(t),s=db(R0(po([r]),i.getView().getResolution()*this.pixelTolerance_)),a=this.rBush_.getInExtent(s),o=a.length;if(o===0)return null;let d,p=1/0,g,_=null;const w=this.pixelTolerance_*this.pixelTolerance_,T=()=>{if(d){const I=i.getPixelFromCoordinate(d);if(Lc(e,I)<=w)return{vertex:d,vertexPixel:[Math.round(I[0]),Math.round(I[1])],feature:g,segment:_}}return null};if(this.vertex_){for(let L=0;L<o;++L){const P=a[L];P.feature.getGeometry().getType()!=="Circle"&&P.segment.forEach(C=>{const O=er(C),z=Lc(r,O);z<p&&(d=C,p=z,g=P.feature)})}const I=T();if(I)return I}if(this.edge_){for(let L=0;L<o;++L){let P=null;const C=a[L];if(C.feature.getGeometry().getType()==="Circle"){let O=C.feature.getGeometry();P=cW(r,O)}else{const[O,z]=C.segment;z&&(bM[0]=er(O),bM[1]=er(z),P=oA(r,bM))}if(P){const O=Lc(r,P);O<p&&(d=Of(P),_=C.feature.getGeometry().getType()==="Circle"?null:C.segment,p=O,g=C.feature)}}const I=T();if(I)return I}return null}updateFeature_(e){this.removeFeature(e,!1),this.addFeature(e,!1)}segmentCircleGeometry_(e,t){this.getMap().getView().getProjection();const s=Hz(t).getCoordinates()[0];for(let a=0,o=s.length-1;a<o;++a)e.push(s.slice(a,a+2))}segmentGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let r=0;r<i.length;++r){const s=this.GEOMETRY_SEGMENTERS_[i[r].getType()];s&&s(e,i[r])}}segmentLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length-1;r<s;++r)e.push(i.slice(r,r+2))}segmentMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length-1;o<d;++o)e.push(a.slice(o,o+2))}}segmentMultiPointGeometry_(e,t){t.getCoordinates().forEach(i=>{e.push([i])})}segmentMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length;o<d;++o){const p=a[o];for(let g=0,_=p.length-1;g<_;++g)e.push(p.slice(g,g+2))}}}segmentPointGeometry_(e,t){e.push([t.getCoordinates()])}segmentPolygonGeometry_(e,t){const i=t.getCoordinates();for(let r=0,s=i.length;r<s;++r){const a=i[r];for(let o=0,d=a.length-1;o<d;++o)e.push(a.slice(o,o+2))}}}const SM={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"};class MM extends la{constructor(e,t,i,r,s){super(e),this.features=t,this.coordinate=i,this.startCoordinate=r,this.mapBrowserEvent=s}}class R7 extends Ju{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=e.features!==void 0?e.features:null;let t;if(e.layers&&!this.features_)if(typeof e.layers=="function")t=e.layers;else{const i=e.layers;t=function(r){return i.includes(r)}}else t=Gl;this.layerFilter_=t,this.filter_=e.filter&&!this.features_?e.filter:Gl,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.condition_=e.condition?e.condition:p0,this.lastFeature_=null,this.addChangeListener(iw.ACTIVE,this.handleActiveChanged_)}handleDownEvent(e){if(!e.originalEvent||!this.condition_(e))return!1;if(this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=e.coordinate,this.lastCoordinate_=e.coordinate,this.handleMoveEvent(e);const t=this.features_||new vo([this.lastFeature_]);return this.dispatchEvent(new MM(SM.TRANSLATESTART,t,e.coordinate,this.startCoordinate_,e)),!0}return!1}handleUpEvent(e){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(e);const t=this.features_||new vo([this.lastFeature_]);return this.dispatchEvent(new MM(SM.TRANSLATEEND,t,e.coordinate,this.startCoordinate_,e)),this.startCoordinate_=null,!0}return!1}handleDragEvent(e){if(this.lastCoordinate_){const t=e.coordinate;e.map.getView().getProjection();const i=er(t),r=er(this.lastCoordinate_),s=i[0]-r[0],a=i[1]-r[1],o=this.features_||new vo([this.lastFeature_]);o.forEach(function(d){const p=d.getGeometry();p.translate(s,a),d.setGeometry(p)}),this.lastCoordinate_=t,this.dispatchEvent(new MM(SM.TRANSLATING,o,t,this.startCoordinate_,e))}}handleMoveEvent(e){const t=e.map.getViewport();this.featuresAtPixel_(e.pixel,e.map)?(t.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),t.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):t.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(e,t){return t.forEachFeatureAtPixel(e,(i,r)=>{if(!(!(i instanceof tl)||!this.filter_(i,r))&&!(this.features_&&!this.features_.getArray().includes(i)))return i},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(e){this.hitTolerance_=e}setMap(e){const t=this.getMap();super.setMap(e),this.updateState_(t)}handleActiveChanged_(){this.updateState_(null)}updateState_(e){let t=this.getMap();const i=this.getActive();(!t||!i)&&(t=t||e,t&&t.getViewport().classList.remove("ol-grab","ol-grabbing"))}}class L7{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const r=this.points_[t+2]-this.points_[i+2];if(r<1e3/60)return!1;const s=this.points_[t]-this.points_[i],a=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(a,s),this.initialVelocity_=Math.sqrt(s*s+a*a)/r,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}function LB(n){n=n||{};const e=new vo,t=new L7(-.005,.05,100);return(n.altShiftDragRotate!==void 0?n.altShiftDragRotate:!0)&&e.push(new m7),(n.doubleClickZoom!==void 0?n.doubleClickZoom:!0)&&e.push(new h7({delta:n.zoomDelta,duration:n.zoomDuration})),(n.dragPan!==void 0?n.dragPan:!0)&&e.push(new p7({onFocusOnly:n.onFocusOnly,kinetic:t})),(n.pinchRotate!==void 0?n.pinchRotate:!0)&&e.push(new S7),(n.pinchZoom!==void 0?n.pinchZoom:!0)&&e.push(new M7({duration:n.zoomDuration})),(n.keyboard!==void 0?n.keyboard:!0)&&(e.push(new _7),e.push(new y7({delta:n.zoomDelta,duration:n.zoomDuration}))),(n.mouseWheelZoom!==void 0?n.mouseWheelZoom:!0)&&e.push(new b7({onFocusOnly:n.onFocusOnly,duration:n.zoomDuration})),(n.shiftDragZoom!==void 0?n.shiftDragZoom:!0)&&e.push(new g7({duration:n.zoomDuration})),e}class D7 extends tA{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){Gi()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,r=e.pixelToCoordinateTransform;ju(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),Sz(r,i)}forEachFeatureAtCoordinate(e,t,i,r,s,a,o,d){let p;const g=t.viewState;function _(H,Y,ee,te){return s.call(a,Y,H?ee:null,te)}const w=g.projection,T=lA(e.slice(),w),I=[[0,0]];if(w.canWrapX()&&r){const H=w.getExtent(),Y=qi(H);I.push([-Y,0],[Y,0])}const L=t.layerStatesArray,P=L.length,C=[],O=[];for(let H=0;H<I.length;H++)for(let Y=P-1;Y>=0;--Y){const ee=L[Y],te=ee.layer;if(te.hasRenderer()&&AA(ee,g)&&o.call(d,te)){const ce=te.getRenderer(),K=te.getSource();if(ce&&K){const Q=K.getWrapX()?T:e,pe=_.bind(null,ee.managed);O[0]=Q[0]+I[H][0],O[1]=Q[1]+I[H][1],p=ce.forEachFeatureAtCoordinate(O,t,i,pe,C)}if(p)return p}}if(C.length===0)return;const z=1/C.length;return C.forEach((H,Y)=>H.distanceSq+=Y*z),C.sort((H,Y)=>H.distanceSq-Y.distanceSq),C.some(H=>p=H.callback(H.feature,H.layer,H.geometry)),p}hasFeatureAtCoordinate(e,t,i,r,s,a){return this.forEachFeatureAtCoordinate(e,t,i,r,Gl,this,s,a)!==void 0}getMap(){return this.map_}renderFrame(e){Gi()}scheduleExpireIconCache(e){Cc.canExpireCache()&&e.postRenderFunctions.push(k7)}}function k7(n,e){Cc.expire()}class F7 extends D7{constructor(e){super(e),this.fontChangeListenerKey_=fi(xu,Km.PROPERTYCHANGE,e.redrawText.bind(e)),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=Cg+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const r=new _B(e,void 0,t);i.dispatchEvent(r)}}disposeInternal(){cr(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(sl.PRECOMPOSE,e);const t=e.layerStatesArray.sort(function(o,d){return o.zIndex-d.zIndex});t.some(o=>o.layer instanceof mB&&o.layer.getDeclutter())&&(e.declutter={});const r=e.viewState;this.children_.length=0;const s=[];let a=null;for(let o=0,d=t.length;o<d;++o){const p=t[o];e.layerIndex=o;const g=p.layer,_=g.getSourceState();if(!AA(p,r)||_!="ready"&&_!="undefined"){g.unrender();continue}const w=g.render(e,a);w&&(w!==a&&(this.children_.push(w),a=w),s.push(p))}this.declutter(e,s),v9(this.element_,this.children_),this.dispatchRenderEvent(sl.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const r=t[i],s=r.layer;s.getDeclutter()&&s.renderDeclutter(e,r)}t.forEach(i=>i.layer.renderDeferred(e))}}}class Hh extends la{constructor(e,t){super(e),this.layer=t}}const EM={LAYERS:"layers"};class Ig extends qz{constructor(e){e=e||{};const t=Object.assign({},e);delete t.layers;let i=e.layers;super(t),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(EM.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new vo(i.slice(),{unique:!0}):Bi(typeof i.getArray=="function","Expected `layers` to be an array or a `Collection`"):i=new vo(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(cr),this.layersListenerKeys_.length=0;const e=this.getLayers();this.layersListenerKeys_.push(fi(e,Xr.ADD,this.handleLayersAdd_,this),fi(e,Xr.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(cr);Mg(this.listenerKeys_);const t=e.getArray();for(let i=0,r=t.length;i<r;i++){const s=t[i];this.registerLayerListeners_(s),this.dispatchEvent(new Hh("addlayer",s))}this.changed()}registerLayerListeners_(e){const t=[fi(e,Km.PROPERTYCHANGE,this.handleLayerChange_,this),fi(e,ti.CHANGE,this.handleLayerChange_,this)];e instanceof Ig&&t.push(fi(e,"addlayer",this.handleLayerGroupAdd_,this),fi(e,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[ai(e)]=t}handleLayerGroupAdd_(e){this.dispatchEvent(new Hh("addlayer",e.layer))}handleLayerGroupRemove_(e){this.dispatchEvent(new Hh("removelayer",e.layer))}handleLayersAdd_(e){const t=e.element;this.registerLayerListeners_(t),this.dispatchEvent(new Hh("addlayer",t)),this.changed()}handleLayersRemove_(e){const t=e.element,i=ai(t);this.listenerKeys_[i].forEach(cr),delete this.listenerKeys_[i],this.dispatchEvent(new Hh("removelayer",t)),this.changed()}getLayers(){return this.get(EM.LAYERS)}setLayers(e){const t=this.getLayers();if(t){const i=t.getArray();for(let r=0,s=i.length;r<s;++r)this.dispatchEvent(new Hh("removelayer",i[r]))}this.set(EM.LAYERS,e)}getLayersArray(e){return e=e!==void 0?e:[],this.getLayers().forEach(function(t){t.getLayersArray(e)}),e}getLayerStatesArray(e){const t=e!==void 0?e:[],i=t.length;this.getLayers().forEach(function(a){a.getLayerStatesArray(t)});const r=this.getLayerState();let s=r.zIndex;!e&&r.zIndex===void 0&&(s=0);for(let a=i,o=t.length;a<o;a++){const d=t[a];d.opacity*=r.opacity,d.visible=d.visible&&r.visible,d.maxResolution=Math.min(d.maxResolution,r.maxResolution),d.minResolution=Math.max(d.minResolution,r.minResolution),d.minZoom=Math.max(d.minZoom,r.minZoom),d.maxZoom=Math.min(d.maxZoom,r.maxZoom),r.extent!==void 0&&(d.extent!==void 0?d.extent=wy(d.extent,r.extent):d.extent=r.extent),d.zIndex===void 0&&(d.zIndex=s)}return t}getSourceState(){return"ready"}}const m0={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class O7 extends lb{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=fi(i,m0.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=fi(i,m0.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(ti.TOUCHMOVE,this.boundHandleTouchMove_,nB?{passive:!1}:!1)}emulateClick_(e){let t=new Mu(Di.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new Mu(Di.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new Mu(Di.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==Di.POINTERUP||t.type==Di.POINTERCANCEL){delete this.trackedTouches_[i];for(const r in this.trackedTouches_)if(this.trackedTouches_[r].target!==t.target){delete this.trackedTouches_[r];break}}else(t.type==Di.POINTERDOWN||t.type==Di.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new Mu(Di.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(cr),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new Mu(Di.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(fi(i,Di.POINTERMOVE,this.handlePointerMove_,this),fi(i,Di.POINTERUP,this.handlePointerUp_,this),fi(this.element_,Di.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(fi(this.element_.getRootNode(),Di.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new Mu(Di.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new Mu(Di.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(cr(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(ti.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(cr(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(cr),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Is={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},fw=1/0;class N7{constructor(e,t){this.priorityFunction_=e,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Mg(this.queuedElements_)}dequeue(){const e=this.elements_,t=this.priorities_,i=e[0];e.length==1?(e.length=0,t.length=0):(e[0]=e.pop(),t[0]=t.pop(),this.siftUp_(0));const r=this.keyFunction_(i);return delete this.queuedElements_[r],i}enqueue(e){Bi(!(this.keyFunction_(e)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const t=this.priorityFunction_(e);return t!=fw?(this.elements_.push(e),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(e)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(e){return e*2+1}getRightChildIndex_(e){return e*2+2}getParentIndex_(e){return e-1>>1}heapify_(){let e;for(e=(this.elements_.length>>1)-1;e>=0;e--)this.siftUp_(e)}isEmpty(){return this.elements_.length===0}isKeyQueued(e){return e in this.queuedElements_}isQueued(e){return this.isKeyQueued(this.keyFunction_(e))}siftUp_(e){const t=this.elements_,i=this.priorities_,r=t.length,s=t[e],a=i[e],o=e;for(;e<r>>1;){const d=this.getLeftChildIndex_(e),p=this.getRightChildIndex_(e),g=p<r&&i[p]<i[d]?p:d;t[e]=t[g],i[e]=i[g],e=g}t[e]=s,i[e]=a,this.siftDown_(o,e)}siftDown_(e,t){const i=this.elements_,r=this.priorities_,s=i[t],a=r[t];for(;t>e;){const o=this.getParentIndex_(t);if(r[o]>a)i[t]=i[o],r[t]=r[o],t=o;else break}i[t]=s,r[t]=a}reprioritize(){const e=this.priorityFunction_,t=this.elements_,i=this.priorities_;let r=0;const s=t.length;let a,o,d;for(o=0;o<s;++o)a=t[o],d=e(a),d==fw?delete this.queuedElements_[this.keyFunction_(a)]:(i[r]=d,t[r++]=a);t.length=r,i.length=r,this.heapify_()}}const Yn={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};class z7 extends N7{constructor(e,t){super(function(i){return e.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=t,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(e){const t=super.enqueue(e);return t&&e[0].addEventListener(ti.CHANGE,this.boundHandleTileChange_),t}getTilesLoading(){return this.tilesLoading_}handleTileChange(e){const t=e.target,i=t.getState();if(i===Yn.LOADED||i===Yn.ERROR||i===Yn.EMPTY){i!==Yn.ERROR&&t.removeEventListener(ti.CHANGE,this.boundHandleTileChange_);const r=t.getKey();r in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[r],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(e,t){let i=0,r,s,a;for(;this.tilesLoading_<e&&i<t&&this.getCount()>0;)s=this.dequeue()[0],a=s.getKey(),r=s.getState(),r===Yn.IDLE&&!(a in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[a]=!0,++this.tilesLoading_,++i,s.load())}}function B7(n,e,t,i,r){if(!n||!(t in n.wantedTiles)||!n.wantedTiles[t][e.getKey()])return fw;const s=n.viewState.center,a=i[0]-s[0],o=i[1]-s[1];return 65536*Math.log(r)+Math.sqrt(a*a+o*o)/r}class Pg extends Uc{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){VT(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(e){this.map_&&VT(this.element);for(let t=0,i=this.listenerKeys.length;t<i;++t)cr(this.listenerKeys[t]);this.listenerKeys.length=0,this.map_=e,e&&((this.target_?this.target_:e.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Jm&&this.listenerKeys.push(fi(e,Uh.POSTRENDER,this.render,this)),e.render())}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class U7 extends Pg{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",r=e.expandClassName!==void 0?e.expandClassName:t+"-expand",s=e.collapseLabel!==void 0?e.collapseLabel:"",a=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=a):this.collapseLabel_=s;const o=e.label!==void 0?e.label:"i";typeof o=="string"?(this.label_=document.createElement("span"),this.label_.textContent=o,this.label_.className=r):this.label_=o;const d=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(d),this.toggleButton_.addEventListener(ti.CLICK,this.handleClick_.bind(this),!1);const p=t+" "+Cg+" "+vb+(this.collapsed_&&this.collapsible_?" "+oD:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=p,g.appendChild(this.toggleButton_),g.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=Array.from(new Set(this.getMap().getAllLayers().flatMap(r=>r.getAttributions(e)))),i=!this.getMap().getAllLayers().some(r=>r.getSource()&&r.getSource().getAttributionsCollapsible()===!1);return this.overrideCollapsible_||this.setCollapsible(i),t}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(r=>VH(()=>r))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Ku(t,this.renderedAttributions_)){y9(this.ulElement_);for(let r=0,s=t.length;r<s;++r){const a=document.createElement("li");a.innerHTML=t[r],this.ulElement_.appendChild(a)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(oD),this.collapsed_?ow(this.collapseLabel_,this.label_):ow(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class V7 extends Pg{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"",r=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=r,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(r));const s=e.tipLabel?e.tipLabel:"Reset rotation",a=document.createElement("button");a.className=t+"-reset",a.setAttribute("type","button"),a.title=s,a.appendChild(this.label_),a.addEventListener(ti.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+Cg+" "+vb,d=this.element;d.className=o,d.appendChild(a),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(ix)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:Eg}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const r="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(ix);!s&&i===0?this.element.classList.add(ix):s&&i!==0&&this.element.classList.remove(ix)}this.label_.style.transform=r}this.rotation_=i}}class G7 extends Pg{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,r=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",s=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",a=e.zoomInLabel!==void 0?e.zoomInLabel:"+",o=e.zoomOutLabel!==void 0?e.zoomOutLabel:"",d=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",p=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",g=document.createElement("button");g.className=r,g.setAttribute("type","button"),g.title=d,g.appendChild(typeof a=="string"?document.createTextNode(a):a),g.addEventListener(ti.CLICK,this.handleClick_.bind(this,i),!1);const _=document.createElement("button");_.className=s,_.setAttribute("type","button"),_.title=p,_.appendChild(typeof o=="string"?document.createTextNode(o):o),_.addEventListener(ti.CLICK,this.handleClick_.bind(this,-i),!1);const w=t+" "+Cg+" "+vb,T=this.element;T.className=w,T.appendChild(g),T.appendChild(_),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const r=i.getZoom();if(r!==void 0){const s=i.getConstrainedZoom(r+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:Eg})):i.setZoom(s)}}}function DB(n){n=n||{};const e=new vo;return(n.zoom!==void 0?n.zoom:!0)&&e.push(new G7(n.zoomOptions)),(n.rotate!==void 0?n.rotate:!0)&&e.push(new V7(n.rotateOptions)),(n.attribution!==void 0?n.attribution:!0)&&e.push(new U7(n.attributionOptions)),e}function kB(n){if(n instanceof gb){n.setMapInternal(null);return}n instanceof Ig&&n.getLayers().forEach(kB)}function FB(n,e){if(n instanceof gb){n.setMapInternal(e);return}if(n instanceof Ig){const t=n.getLayers().getArray();for(let i=0,r=t.length;i<r;++i)FB(t[i],e)}}let H7=class extends Uc{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=W7(e);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:Qz,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ol(),this.pixelToCoordinateTransform_=Ol(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||DB(),this.interactions=t.interactions||LB({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new z7(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Is.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Is.VIEW,this.handleViewChanged_),this.addChangeListener(Is.SIZE,this.handleSizeChanged_),this.addChangeListener(Is.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof Sc)&&e.view.then(function(r){i.setView(new Sc(r))}),this.controls.addEventListener(Xr.ADD,r=>{r.element.setMap(this)}),this.controls.addEventListener(Xr.REMOVE,r=>{r.element.setMap(null)}),this.interactions.addEventListener(Xr.ADD,r=>{r.element.setMap(this)}),this.interactions.addEventListener(Xr.REMOVE,r=>{r.element.setMap(null)}),this.overlays_.addEventListener(Xr.ADD,r=>{this.addOverlayInternal_(r.element)}),this.overlays_.addEventListener(Xr.REMOVE,r=>{const s=r.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],r.element.setMap(null)}),this.controls.forEach(r=>{r.setMap(this)}),this.interactions.forEach(r=>{r.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){FB(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const r=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,a=i.layerFilter!==void 0?i.layerFilter:Gl,o=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,s,o,t,null,a,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(r){i.push(r)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(r){r instanceof Ig?t(r.getLayers()):e.push(r)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const r=t.layerFilter!==void 0?t.layerFilter:Gl,s=t.hitTolerance!==void 0?t.hitTolerance:0,a=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,a,r,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),r=this.getSize(),s=i.width/r[0],a=i.height/r[1],o="changedTouches"in e?e.changedTouches[0]:e;return[(o.clientX-i.left)/s,(o.clientY-i.top)/a]}getTarget(){return this.get(Is.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return Of(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?Ws(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Is.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof vo){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t];if(!r.visible)continue;const s=r.layer.getRenderer();if(s&&!s.ready)return!0;const a=r.layer.getSource();if(a&&a.loading)return!0}return!1}getPixelFromCoordinate(e){const t=er(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?Ws(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Is.SIZE)}getView(){return this.get(Is.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,r){return B7(this.frameState_,e,t,i,r)}handleBrowserEvent(e,t){t=t||e.type;const i=new Mu(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===m0.POINTERDOWN||i===ti.WHEEL||i===ti.KEYDOWN){const r=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():r,a=t.target;if(this.overlayContainerStopEvent_.contains(a)||!(s===r?r.documentElement:s).contains(a))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const r=this.getInteractions().getArray().slice();for(let s=r.length-1;s>=0;s--){const a=r[s];if(a.getMap()!==this||!a.getActive()||!this.getTargetElement())continue;if(!a.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let r=this.maxTilesLoading_,s=r;if(e){const a=e.viewHints;if(a[mo.ANIMATING]||a[mo.INTERACTING]){const o=Date.now()-e.time>8;r=o?0:8,s=o?0:2}}t.getTilesLoading()<r&&(t.reprioritize(),t.loadMoreTiles(r,s))}e&&this.renderer_&&!e.animate&&(this.renderComplete_===!0?(this.hasListener(sl.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(sl.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Qp(Uh.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Qp(Uh.LOADSTART,this,e))));const i=this.postRenderFunctions_;for(let r=0,s=i.length;r<s;++r)i[r](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,r=this.targetChangeHandlerKeys_.length;i<r;++i)cr(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(ti.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(ti.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,VT(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new F7(this)),this.mapBrowserEventHandler_=new O7(this,this.moveTolerance_);for(const s in Di)this.mapBrowserEventHandler_.addEventListener(Di[s],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(ti.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(ti.WHEEL,this.boundHandleBrowserEvent_,nB?{passive:!1}:!1);const i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[fi(i,ti.KEYDOWN,this.handleBrowserEvent,this),fi(i,ti.KEYPRESS,this.handleBrowserEvent,this)];const r=t.getRootNode();r instanceof ShadowRoot&&this.resizeObserver_.observe(r.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(cr(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(cr(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=fi(e,Km.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=fi(e,ti.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(cr),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Hh("addlayer",e)),this.layerGroupPropertyListenerKeys_=[fi(e,Km.PROPERTYCHANGE,this.render,this),fi(e,ti.CHANGE,this.render,this),fi(e,"addlayer",this.handleLayerAdd_,this),fi(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const r=e[t].layer;r.hasRenderer()&&r.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){kB(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),r=this.frameState_;let s=null;if(t!==void 0&&tD(t)&&i&&i.isDef()){const a=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),o=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:kT(o.center,o.resolution,o.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:o,viewHints:a,wantedTiles:{},mapId:ai(this),renderTargets:{}},o.nextCenter&&o.nextResolution){const d=isNaN(o.nextRotation)?o.rotation:o.nextRotation;s.nextExtent=kT(o.nextCenter,o.nextResolution,d,t)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),r&&(!this.previousExtent_||!cb(this.previousExtent_)&&!e0(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Qp(Uh.MOVESTART,this,r)),this.previousExtent_=L0(this.previousExtent_)),this.previousExtent_&&!s.viewHints[mo.ANIMATING]&&!s.viewHints[mo.INTERACTING]&&!e0(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Qp(Uh.MOVEEND,this,s)),Mz(s.extent,this.previousExtent_))),this.dispatchEvent(new Qp(Uh.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(Uh.LOADSTART)||this.hasListener(Uh.LOADEND)||this.hasListener(sl.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Hh("removelayer",t)),this.set(Is.LAYERGROUP,e)}setSize(e){this.set(Is.SIZE,e)}setTarget(e){this.set(Is.TARGET,e)}setView(e){if(!e||e instanceof Sc){this.set(Is.VIEW,e);return}this.set(Is.VIEW,new Sc);const t=this;e.then(function(i){t.setView(new Sc(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const r=getComputedStyle(e),s=e.offsetWidth-parseFloat(r.borderLeftWidth)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)-parseFloat(r.borderRightWidth),a=e.offsetHeight-parseFloat(r.borderTopWidth)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)-parseFloat(r.borderBottomWidth);!isNaN(s)&&!isNaN(a)&&(t=[s,a],!tD(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&Pz("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!Ku(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}};function W7(n){let e=null;n.keyboardEventTarget!==void 0&&(e=typeof n.keyboardEventTarget=="string"?document.getElementById(n.keyboardEventTarget):n.keyboardEventTarget);const t={},i=n.layers&&typeof n.layers.getLayers=="function"?n.layers:new Ig({layers:n.layers});t[Is.LAYERGROUP]=i,t[Is.TARGET]=n.target,t[Is.VIEW]=n.view instanceof Sc?n.view:new Sc;let r;n.controls!==void 0&&(Array.isArray(n.controls)?r=new vo(n.controls.slice()):(Bi(typeof n.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),r=n.controls));let s;n.interactions!==void 0&&(Array.isArray(n.interactions)?s=new vo(n.interactions.slice()):(Bi(typeof n.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),s=n.interactions));let a;return n.overlays!==void 0?Array.isArray(n.overlays)?a=new vo(n.overlays.slice()):(Bi(typeof n.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),a=n.overlays):a=new vo,{controls:r,interactions:s,keyboardEventTarget:e,overlays:a,values:t}}class j7{constructor(e){this.highWaterMark=e!==void 0?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(e){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(e){return this.entries_.hasOwnProperty(e)}forEach(e){let t=this.oldest_;for(;t;)e(t.value_,t.key_,this),t=t.newer}get(e,t){const i=this.entries_[e];return Bi(i!==void 0,"Tried to get a value for a key that does not exist in the cache"),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(e){const t=this.entries_[e];return Bi(t!==void 0,"Tried to get a value for a key that does not exist in the cache"),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[e],--this.count_,t.value_}getCount(){return this.count_}getKeys(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.key_;return e}getValues(){const e=new Array(this.count_);let t=0,i;for(i=this.newest_;i;i=i.older)e[t++]=i.value_;return e}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(e){var t;return(t=this.entries_[e])==null?void 0:t.value_}pop(){const e=this.oldest_;return delete this.entries_[e.key_],e.newer&&(e.newer.older=null),this.oldest_=e.newer,this.oldest_||(this.newest_=null),--this.count_,e.value_}replace(e,t){this.get(e),this.entries_[e].value_=t}set(e,t){Bi(!(e in this.entries_),"Tried to set a value for a key that is used already");const i={key_:e,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[e]=i,++this.count_}setSize(e){this.highWaterMark=e}}class OB extends lb{constructor(e,t,i){super(),i=i||{},this.tileCoord=e,this.state=t,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(ti.CHANGE)}release(){this.state===Yn.ERROR&&this.setState(Yn.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let e=this.interimTile;if(!e)return this;do{if(e.getState()==Yn.LOADED)return this.transition_=0,e;e=e.interimTile}while(e);return this}refreshInterimChain(){let e=this.interimTile;if(!e)return;let t=this;do{if(e.getState()==Yn.LOADED){e.interimTile=null;break}e.getState()==Yn.LOADING?t=e:e.getState()==Yn.IDLE?t.interimTile=e.interimTile:t=e,e=t.interimTile}while(e)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(e){if(this.state!==Yn.ERROR&&this.state>e)throw new Error("Tile load sequence violation");this.state=e,this.changed()}load(){Gi()}getAlpha(e,t){if(!this.transition_)return 1;let i=this.transitionStarts_[e];if(!i)i=t,this.transitionStarts_[e]=i;else if(i===-1)return 1;const r=t-i+1e3/60;return r>=this.transition_?1:$z(r/this.transition_)}inTransition(e){return this.transition_?this.transitionStarts_[e]!==-1:!1}endTransition(e){this.transition_&&(this.transitionStarts_[e]=-1)}}class NB extends OB{constructor(e,t,i,r,s,a){super(e,t,a),this.crossOrigin_=r,this.src_=i,this.key=i,this.image_=new Image,r!==null&&(this.image_.crossOrigin=r),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(e){this.image_=e,this.state=Yn.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=Yn.ERROR,this.unlistenImage_(),this.image_=$7(),this.changed()}handleImageLoad_(){const e=this.image_;e.naturalWidth&&e.naturalHeight?this.state=Yn.LOADED:this.state=Yn.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==Yn.ERROR&&(this.state=Yn.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Yn.IDLE&&(this.state=Yn.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=x9(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function $7(){const n=Zs(1,1);return n.fillStyle="rgba(0,0,0,0)",n.fillRect(0,0,1,1),n.canvas}const q7=.5,X7=10,DD=.25;class Z7{constructor(e,t,i,r,s,a){this.sourceProj_=e,this.targetProj_=t;let o={};const d=ew(this.targetProj_,this.sourceProj_);this.transformInv_=function(O){const z=O[0]+"/"+O[1];return o[z]||(o[z]=d(O)),o[z]},this.maxSourceExtent_=r,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&qi(r)>=qi(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?qi(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?qi(this.targetProj_.getExtent()):null;const p=Ad(i),g=k0(i),_=D0(i),w=tg(i),T=this.transformInv_(p),I=this.transformInv_(g),L=this.transformInv_(_),P=this.transformInv_(w),C=X7+(a?Math.max(0,Math.ceil(Math.log2(DT(i)/(a*a*256*256)))):0);if(this.addQuad_(p,g,_,w,T,I,L,P,C),this.wrapsXInSource_){let O=1/0;this.triangles_.forEach(function(z,H,Y){O=Math.min(O,z.source[0][0],z.source[1][0],z.source[2][0])}),this.triangles_.forEach(z=>{if(Math.max(z.source[0][0],z.source[1][0],z.source[2][0])-O>this.sourceWorldWidth_/2){const H=[[z.source[0][0],z.source[0][1]],[z.source[1][0],z.source[1][1]],[z.source[2][0],z.source[2][1]]];H[0][0]-O>this.sourceWorldWidth_/2&&(H[0][0]-=this.sourceWorldWidth_),H[1][0]-O>this.sourceWorldWidth_/2&&(H[1][0]-=this.sourceWorldWidth_),H[2][0]-O>this.sourceWorldWidth_/2&&(H[2][0]-=this.sourceWorldWidth_);const Y=Math.min(H[0][0],H[1][0],H[2][0]);Math.max(H[0][0],H[1][0],H[2][0])-Y<this.sourceWorldWidth_/2&&(z.source=H)}})}o={}}addTriangle_(e,t,i,r,s,a){this.triangles_.push({source:[r,s,a],target:[e,t,i]})}addQuad_(e,t,i,r,s,a,o,d,p){const g=po([s,a,o,d]),_=this.sourceWorldWidth_?qi(g)/this.sourceWorldWidth_:null,w=this.sourceWorldWidth_,T=this.sourceProj_.canWrapX()&&_>.5&&_<1;let I=!1;if(p>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const P=po([e,t,i,r]);I=qi(P)/this.targetWorldWidth_>DD||I}!T&&this.sourceProj_.isGlobal()&&_&&(I=_>DD||I)}if(!I&&this.maxSourceExtent_&&isFinite(g[0])&&isFinite(g[1])&&isFinite(g[2])&&isFinite(g[3])&&!No(g,this.maxSourceExtent_))return;let L=0;if(!I&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(d[0])||!isFinite(d[1]))){if(p>0)I=!0;else if(L=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(a[0])||!isFinite(a[1])?4:0)+(!isFinite(o[0])||!isFinite(o[1])?2:0)+(!isFinite(d[0])||!isFinite(d[1])?1:0),L!=1&&L!=2&&L!=4&&L!=8)return}if(p>0){if(!I){const P=[(e[0]+i[0])/2,(e[1]+i[1])/2],C=this.transformInv_(P);let O;T?O=(Af(s[0],w)+Af(o[0],w))/2-Af(C[0],w):O=(s[0]+o[0])/2-C[0];const z=(s[1]+o[1])/2-C[1];I=O*O+z*z>this.errorThresholdSquared_}if(I){if(Math.abs(e[0]-i[0])<=Math.abs(e[1]-i[1])){const P=[(t[0]+i[0])/2,(t[1]+i[1])/2],C=this.transformInv_(P),O=[(r[0]+e[0])/2,(r[1]+e[1])/2],z=this.transformInv_(O);this.addQuad_(e,t,P,O,s,a,C,z,p-1),this.addQuad_(O,P,i,r,z,C,o,d,p-1)}else{const P=[(e[0]+t[0])/2,(e[1]+t[1])/2],C=this.transformInv_(P),O=[(i[0]+r[0])/2,(i[1]+r[1])/2],z=this.transformInv_(O);this.addQuad_(e,P,O,r,s,C,z,d,p-1),this.addQuad_(P,t,i,O,C,a,o,z,p-1)}return}}if(T){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}L&11||this.addTriangle_(e,i,r,s,o,d),L&14||this.addTriangle_(e,i,t,s,o,a),L&&(L&13||this.addTriangle_(t,r,e,a,d,s),L&7||this.addTriangle_(t,r,i,a,d,o))}calculateSourceExtent(){const e=Da();return this.triangles_.forEach(function(t,i,r){const s=t.source;xy(e,s[0]),xy(e,s[1]),xy(e,s[2])}),e}getTriangles(){return this.triangles_}}let TM;const Om=[];function kD(n,e,t,i,r){n.beginPath(),n.moveTo(0,0),n.lineTo(e,t),n.lineTo(i,r),n.closePath(),n.save(),n.clip(),n.fillRect(0,0,Math.max(e,i)+1,Math.max(t,r)),n.restore()}function CM(n,e){return Math.abs(n[e*4]-210)>2||Math.abs(n[e*4+3]-.75*255)>2}function Y7(){if(TM===void 0){const n=Zs(6,6,Om);n.globalCompositeOperation="lighter",n.fillStyle="rgba(210, 0, 0, 0.75)",kD(n,4,5,4,0),kD(n,4,5,0,5);const e=n.getImageData(0,0,3,3).data;TM=CM(e,0)||CM(e,4)||CM(e,8),yb(n),Om.push(n.canvas)}return TM}function FD(n,e,t,i){const r=xW(t,e,n);let s=Q1(e,i,t);const a=e.getMetersPerUnit();a!==void 0&&(s*=a);const o=n.getMetersPerUnit();o!==void 0&&(s/=o);const d=n.getExtent();if(!d||eg(d,r)){const p=Q1(n,s,r)/s;isFinite(p)&&p>0&&(s/=p)}return s}function K7(n,e,t,i){const r=qu(t);let s=FD(n,e,r,i);return(!isFinite(s)||s<=0)&&sA(t,function(a){return s=FD(n,e,a,i),isFinite(s)&&s>0}),s}function J7(n,e,t,i,r,s,a,o,d,p,g,_,w,T){const I=Zs(Math.round(t*n),Math.round(t*e),Om);if(_||(I.imageSmoothingEnabled=!1),d.length===0)return I.canvas;I.scale(t,t);function L(Y){return Math.round(Y*t)/t}I.globalCompositeOperation="lighter";const P=Da();d.forEach(function(Y,ee,te){Ez(P,Y.extent)});let C;const O=t/i,z=(_?1:1+Math.pow(2,-24))/O;{if(C=Zs(Math.round(qi(P)*O),Math.round(js(P)*O),Om),_||(C.imageSmoothingEnabled=!1),r&&T){const Y=(r[0]-P[0])*O,ee=-(r[3]-P[3])*O,te=qi(r)*O,ce=js(r)*O;C.rect(Y,ee,te,ce),C.clip()}d.forEach(function(Y,ee,te){if(Y.image.width>0&&Y.image.height>0){if(Y.clipExtent){C.save();const ze=(Y.clipExtent[0]-P[0])*O,Fe=-(Y.clipExtent[3]-P[3])*O,qe=qi(Y.clipExtent)*O,et=js(Y.clipExtent)*O;C.rect(_?ze:Math.round(ze),_?Fe:Math.round(Fe),_?qe:Math.round(ze+qe)-Math.round(ze),_?et:Math.round(Fe+et)-Math.round(Fe)),C.clip()}const ce=(Y.extent[0]-P[0])*O,K=-(Y.extent[3]-P[3])*O,Q=qi(Y.extent)*O,pe=js(Y.extent)*O;C.drawImage(Y.image,p,p,Y.image.width-2*p,Y.image.height-2*p,_?ce:Math.round(ce),_?K:Math.round(K),_?Q:Math.round(ce+Q)-Math.round(ce),_?pe:Math.round(K+pe)-Math.round(K)),Y.clipExtent&&C.restore()}})}const H=Ad(a);return o.getTriangles().forEach(function(Y,ee,te){const ce=Y.source,K=Y.target;let Q=ce[0][0],pe=ce[0][1],ze=ce[1][0],Fe=ce[1][1],qe=ce[2][0],et=ce[2][1];const Ne=L((K[0][0]-H[0])/s),st=L(-(K[0][1]-H[1])/s),Ee=L((K[1][0]-H[0])/s),ut=L(-(K[1][1]-H[1])/s),ot=L((K[2][0]-H[0])/s),dt=L(-(K[2][1]-H[1])/s),Ct=Q,Vt=pe;Q=0,pe=0,ze-=Ct,Fe-=Vt,qe-=Ct,et-=Vt;const Re=[[ze,Fe,0,0,Ee-Ne],[qe,et,0,0,ot-Ne],[0,0,ze,Fe,ut-st],[0,0,qe,et,dt-st]],mt=aW(Re);if(!mt)return;if(I.save(),I.beginPath(),Y7()||!_){I.moveTo(Ee,ut);const It=4,vn=Ne-Ee,xn=st-ut;for(let at=0;at<It;at++)I.lineTo(Ee+L((at+1)*vn/It),ut+L(at*xn/(It-1))),at!=It-1&&I.lineTo(Ee+L((at+1)*vn/It),ut+L((at+1)*xn/(It-1)));I.lineTo(ot,dt)}else I.moveTo(Ee,ut),I.lineTo(Ne,st),I.lineTo(ot,dt);I.clip(),I.transform(mt[0],mt[2],mt[1],mt[3],Ne,st),I.translate(P[0]-Ct,P[3]-Vt);let Et;if(C)Et=C.canvas,I.scale(z,-z);else{const It=d[0],vn=It.extent;Et=It.image,I.scale(qi(vn)/Et.width,-js(vn)/Et.height)}I.drawImage(Et,0,0),I.restore()}),C&&(yb(C),Om.push(C.canvas)),g&&(I.save(),I.globalCompositeOperation="source-over",I.strokeStyle="black",I.lineWidth=1,o.getTriangles().forEach(function(Y,ee,te){const ce=Y.target,K=(ce[0][0]-H[0])/s,Q=-(ce[0][1]-H[1])/s,pe=(ce[1][0]-H[0])/s,ze=-(ce[1][1]-H[1])/s,Fe=(ce[2][0]-H[0])/s,qe=-(ce[2][1]-H[1])/s;I.beginPath(),I.moveTo(pe,ze),I.lineTo(K,Q),I.lineTo(Fe,qe),I.closePath(),I.stroke()}),I.restore()),I.canvas}class XT extends OB{constructor(e,t,i,r,s,a,o,d,p,g,_,w){super(s,Yn.IDLE,w),this.renderEdges_=_!==void 0?_:!1,this.pixelRatio_=o,this.gutter_=d,this.canvas_=null,this.sourceTileGrid_=t,this.targetTileGrid_=r,this.wrappedTileCoord_=a||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0,this.clipExtent_=e.canWrapX()?e.getExtent():void 0;const T=r.getTileCoordExtent(this.wrappedTileCoord_),I=this.targetTileGrid_.getExtent();let L=this.sourceTileGrid_.getExtent();const P=I?wy(T,I):T;if(DT(P)===0){this.state=Yn.EMPTY;return}const C=e.getExtent();C&&(L?L=wy(L,C):L=C);const O=r.getResolution(this.wrappedTileCoord_[0]),z=K7(e,i,P,O);if(!isFinite(z)||z<=0){this.state=Yn.EMPTY;return}const H=g!==void 0?g:q7;if(this.triangulation_=new Z7(e,i,P,L,z*H,O),this.triangulation_.getTriangles().length===0){this.state=Yn.EMPTY;return}this.sourceZ_=t.getZForResolution(z);let Y=this.triangulation_.calculateSourceExtent();if(L&&(e.canWrapX()?(Y[1]=es(Y[1],L[1],L[3]),Y[3]=es(Y[3],L[1],L[3])):Y=wy(Y,L)),!DT(Y))this.state=Yn.EMPTY;else{let ee=0,te=0;e.canWrapX()&&(ee=qi(C),te=Math.floor((Y[0]-C[0])/ee)),Az(Y.slice(),e,!0).forEach(K=>{const Q=t.getTileRangeForExtentAndZ(K,this.sourceZ_);for(let pe=Q.minX;pe<=Q.maxX;pe++)for(let ze=Q.minY;ze<=Q.maxY;ze++){const Fe=p(this.sourceZ_,pe,ze,o);if(Fe){const qe=te*ee;this.sourceTiles_.push({tile:Fe,offset:qe})}}++te}),this.sourceTiles_.length===0&&(this.state=Yn.EMPTY)}}getImage(){return this.canvas_}reproject_(){const e=[];if(this.sourceTiles_.forEach(t=>{var r;const i=t.tile;if(i&&i.getState()==Yn.LOADED){const s=this.sourceTileGrid_.getTileCoordExtent(i.tileCoord);s[0]+=t.offset,s[2]+=t.offset;const a=(r=this.clipExtent_)==null?void 0:r.slice();a&&(a[0]+=t.offset,a[2]+=t.offset),e.push({extent:s,clipExtent:a,image:i.getImage()})}}),this.sourceTiles_.length=0,e.length===0)this.state=Yn.ERROR;else{const t=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(t),r=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],a=this.targetTileGrid_.getResolution(t),o=this.sourceTileGrid_.getResolution(this.sourceZ_),d=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=J7(r,s,this.pixelRatio_,o,this.sourceTileGrid_.getExtent(),a,d,this.triangulation_,e,this.gutter_,this.renderEdges_,this.interpolate),this.state=Yn.LOADED}this.changed()}load(){if(this.state==Yn.IDLE){this.state=Yn.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const i=t.getState();if(i==Yn.IDLE||i==Yn.LOADING){e++;const r=fi(t,ti.CHANGE,function(s){const a=t.getState();(a==Yn.LOADED||a==Yn.ERROR||a==Yn.EMPTY)&&(cr(r),e--,e===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(r)}}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t},i,r){t.getState()==Yn.IDLE&&t.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(cr),this.sourcesListenerKeys_=null}release(){this.canvas_&&(yb(this.canvas_.getContext("2d")),Om.push(this.canvas_),this.canvas_=null),super.release()}}function OD(n,e,t,i){return i!==void 0?(i[0]=n,i[1]=e,i[2]=t,i):[n,e,t]}function Tb(n,e,t){return n+"/"+e+"/"+t}function zB(n){return Tb(n[0],n[1],n[2])}function Q7(n){return n.split("/").map(Number)}function e$(n){return(n[1]<<n[0])+n[2]}function t$(n,e){const t=n[0],i=n[1],r=n[2];if(e.getMinZoom()>t||t>e.getMaxZoom())return!1;const s=e.getFullTileRange(t);return s?s.containsXY(i,r):!0}class BB extends j7{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(e){for(;this.canExpireCache()&&!(this.peekLast().getKey()in e);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const e=this.peekFirstKey(),i=Q7(e)[0];this.forEach(r=>{r.tileCoord[0]!==i&&(this.remove(zB(r.tileCoord)),r.release())})}}const AM={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};class UA{constructor(e,t,i,r){this.minX=e,this.maxX=t,this.minY=i,this.maxY=r}contains(e){return this.containsXY(e[1],e[2])}containsTileRange(e){return this.minX<=e.minX&&e.maxX<=this.maxX&&this.minY<=e.minY&&e.maxY<=this.maxY}containsXY(e,t){return this.minX<=e&&e<=this.maxX&&this.minY<=t&&t<=this.maxY}equals(e){return this.minX==e.minX&&this.minY==e.minY&&this.maxX==e.maxX&&this.maxY==e.maxY}extend(e){e.minX<this.minX&&(this.minX=e.minX),e.maxX>this.maxX&&(this.maxX=e.maxX),e.minY<this.minY&&(this.minY=e.minY),e.maxY>this.maxY&&(this.maxY=e.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(e){return this.minX<=e.maxX&&this.maxX>=e.minX&&this.minY<=e.maxY&&this.maxY>=e.minY}}function Pp(n,e,t,i,r){return r!==void 0?(r.minX=n,r.maxX=e,r.minY=t,r.maxY=i,r):new UA(n,e,t,i)}const Rp=[0,0,0],Lh=5;class UB{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,Bi(UH(this.resolutions_,(r,s)=>s-r),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let r=0,s=this.resolutions_.length-1;r<s;++r)if(!t)t=this.resolutions_[r]/this.resolutions_[r+1];else if(this.resolutions_[r]/this.resolutions_[r+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,Bi(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));const i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Ad(i)),Bi(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,Bi(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:MA,Bi(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((r,s)=>{const a=new UA(Math.min(0,r[0]),Math.max(r[0]-1,-1),Math.min(0,r[1]),Math.max(r[1]-1,-1));if(i){const o=this.getTileRangeForExtentAndZ(i,s);a.minX=Math.max(o.minX,a.minX),a.maxX=Math.min(o.maxX,a.maxX),a.minY=Math.max(o.minY,a.minY),a.maxY=Math.min(o.maxY,a.maxY)}return a}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){const r=this.getTileRangeForExtentAndZ(e,t);for(let s=r.minX,a=r.maxX;s<=a;++s)for(let o=r.minY,d=r.maxY;o<=d;++o)i([t,s,o])}forEachTileCoordParentTileRange(e,t,i,r){let s,a,o,d=null,p=e[0]-1;for(this.zoomFactor_===2?(a=e[1],o=e[2]):d=this.getTileCoordExtent(e,r);p>=this.minZoom;){if(a!==void 0&&o!==void 0?(a=Math.floor(a/2),o=Math.floor(o/2),s=Pp(a,a,o,o,i)):s=this.getTileRangeForExtentAndZ(d,p,i),t(p,s))return!0;--p}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){const s=e[1]*2,a=e[2]*2;return Pp(s,s+1,a,a+1,t)}const r=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(r,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;const r=e[0],s=e[1],a=e[2];if(t===r)return Pp(s,a,s,a,i);if(this.zoomFactor_){const d=Math.pow(this.zoomFactor_,t-r),p=Math.floor(s*d),g=Math.floor(a*d);if(t<r)return Pp(p,p,g,g,i);const _=Math.floor(d*(s+1))-1,w=Math.floor(d*(a+1))-1;return Pp(p,_,g,w,i)}const o=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,Rp);const r=Rp[1],s=Rp[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,Rp);const a=Rp[1],o=Rp[2];return Pp(r,a,s,o,i)}getTileCoordCenter(e){const t=this.getOrigin(e[0]),i=this.getResolution(e[0]),r=Ia(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*r[0]*i,t[1]-(e[2]+.5)*r[1]*i]}getTileCoordExtent(e,t){const i=this.getOrigin(e[0]),r=this.getResolution(e[0]),s=Ia(this.getTileSize(e[0]),this.tmpSize_),a=i[0]+e[1]*s[0]*r,o=i[1]-(e[2]+1)*s[1]*r,d=a+s[0]*r,p=o+s[1]*r;return $u(a,o,d,p,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,r,s){const a=this.getZForResolution(i),o=i/this.getResolution(a),d=this.getOrigin(a),p=Ia(this.getTileSize(a),this.tmpSize_);let g=o*(e-d[0])/i/p[0],_=o*(d[1]-t)/i/p[1];return r?(g=Qv(g,Lh)-1,_=Qv(_,Lh)-1):(g=Jv(g,Lh),_=Jv(_,Lh)),OD(a,g,_,s)}getTileCoordForXYAndZ_(e,t,i,r,s){const a=this.getOrigin(i),o=this.getResolution(i),d=Ia(this.getTileSize(i),this.tmpSize_);let p=(e-a[0])/o/d[0],g=(a[1]-t)/o/d[1];return r?(p=Qv(p,Lh)-1,g=Qv(g,Lh)-1):(p=Jv(p,Lh),g=Jv(g,Lh)),OD(i,p,g,s)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){const i=nA(this.resolutions_,e,t||0);return es(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Fz(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){const t=this.resolutions_.length,i=new Array(t);for(let r=this.minZoom;r<t;++r)i[r]=this.getTileRangeForExtentAndZ(e,r);this.fullTileRanges_=i}}function VB(n){let e=n.getDefaultTileGrid();return e||(e=s$(n),n.setDefaultTileGrid(e)),e}function n$(n,e,t){const i=e[0],r=n.getTileCoordCenter(e),s=VA(t);if(!eg(s,r)){const a=qi(s),o=Math.ceil((s[0]-r[0])/a);return r[0]+=a*o,n.getTileCoordForCoordAndZ(r,i)}return e}function i$(n,e,t,i){i=i!==void 0?i:"top-left";const r=GB(n,e,t);return new UB({extent:n,origin:XH(n,i),resolutions:r,tileSize:t})}function r$(n){const e=n||{},t=e.extent||aa("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:GB(t,e.maxZoom,e.tileSize,e.maxResolution)};return new UB(i)}function GB(n,e,t,i){e=e!==void 0?e:WW,t=Ia(t!==void 0?t:MA);const r=js(n),s=qi(n);i=i>0?i:Math.max(s/t[0],r/t[1]);const a=e+1,o=new Array(a);for(let d=0;d<a;++d)o[d]=i/Math.pow(2,d);return o}function s$(n,e,t,i){const r=VA(n);return i$(r,e,t,i)}function VA(n){n=aa(n);let e=n.getExtent();if(!e){const t=180*ng.degrees/n.getMetersPerUnit();e=$u(-t,-t,t,t)}return e}class o$ extends MB{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.opaque_=e.opaque!==void 0?e.opaque:!1,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;const t=[256,256];this.tileGrid&&Ia(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tileCache=new BB(e.cacheSize||0),this.tmpSize=[0,0],this.key_=e.key||"",this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(e,t){const i=this.getTileCacheForProjection(e);i&&i.expireCache(t)}forEachLoadedTile(e,t,i,r){const s=this.getTileCacheForProjection(e);if(!s)return!1;let a=!0,o,d,p;for(let g=i.minX;g<=i.maxX;++g)for(let _=i.minY;_<=i.maxY;++_)d=Tb(t,g,_),p=!1,s.containsKey(d)&&(o=s.get(d),p=o.getState()===Yn.LOADED,p&&(p=r(o)!==!1)),p||(a=!1);return a}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getOpaque(e){return this.opaque_}getResolutions(e){const t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,r,s){return Gi()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:VB(e)}getTileCacheForProjection(e){const t=this.getProjection();return Bi(t===null||Jp(t,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),s=this.getTilePixelRatio(t),a=Ia(r.getTileSize(e),this.tmpSize);return s==1?a:a9(a,s,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){t=t!==void 0?t:this.getProjection();const i=this.getTileGridForProjection(t);return this.getWrapX()&&t.isGlobal()&&(e=n$(i,e,t)),t$(e,i)?e:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(e,t){const i=this.getTileCacheForProjection(t);e>i.highWaterMark&&(i.highWaterMark=e)}useTile(e,t,i,r){}}class a$ extends la{constructor(e,t){super(e),this.tile=t}}function l$(n,e){const t=/\{z\}/g,i=/\{x\}/g,r=/\{y\}/g,s=/\{-y\}/g;return function(a,o,d){if(a)return n.replace(t,a[0].toString()).replace(i,a[1].toString()).replace(r,a[2].toString()).replace(s,function(){const p=a[0],g=e.getFullTileRange(p);if(!g)throw new Error("The {-y} placeholder requires a tile grid with extent");return(g.getHeight()-a[2]-1).toString()})}}function c$(n,e){const t=n.length,i=new Array(t);for(let r=0;r<t;++r)i[r]=l$(n[r],e);return u$(i)}function u$(n){return n.length===1?n[0]:function(e,t,i){if(!e)return;const r=e$(e),s=Af(r,n.length);return n[s](e,t,i)}}function h$(n){const e=[];let t=/\{([a-z])-([a-z])\}/.exec(n);if(t){const i=t[1].charCodeAt(0),r=t[2].charCodeAt(0);let s;for(s=i;s<=r;++s)e.push(n.replace(t[0],String.fromCharCode(s)));return e}if(t=/\{(\d+)-(\d+)\}/.exec(n),t){const i=parseInt(t[2],10);for(let r=parseInt(t[1],10);r<=i;r++)e.push(n.replace(t[0],r.toString()));return e}return e.push(n),e}class GA extends o${constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tilePixelRatio:e.tilePixelRatio,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===GA.prototype.tileUrlFunction,this.tileLoadFunction=e.tileLoadFunction,e.tileUrlFunction&&(this.tileUrlFunction=e.tileUrlFunction),this.urls=null,e.urls?this.setUrls(e.urls):e.url&&this.setUrl(e.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(e){const t=e.target,i=ai(t),r=t.getState();let s;r==Yn.LOADING?(this.tileLoadingKeys_[i]=!0,s=AM.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=r==Yn.ERROR?AM.TILELOADERROR:r==Yn.LOADED?AM.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new a$(s,t))}setTileLoadFunction(e){this.tileCache.clear(),this.tileLoadFunction=e,this.changed()}setTileUrlFunction(e,t){this.tileUrlFunction=e,this.tileCache.pruneExceptNewestZ(),typeof t<"u"?this.setKey(t):this.changed()}setUrl(e){const t=h$(e);this.urls=t,this.setUrls(t)}setUrls(e){this.urls=e;const t=e.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(c$(e,this.tileGrid),t):this.setKey(t)}tileUrlFunction(e,t,i){}useTile(e,t,i){const r=Tb(e,t,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)}}class d$ extends GA{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,opaque:e.opaque,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:f$,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:NB,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const e in this.tileCacheForProjection)if(this.tileCacheForProjection[e].canExpireCache())return!0;return!1}expireCache(e,t){const i=this.getTileCacheForProjection(e);this.tileCache.expireCache(this.tileCache==i?t:{});for(const r in this.tileCacheForProjection){const s=this.tileCacheForProjection[r];s.expireCache(s==i?t:{})}}getGutterForProjection(e){return this.getProjection()&&e&&!Jp(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getOpaque(e){return this.getProjection()&&e&&!Jp(this.getProjection(),e)?!1:super.getOpaque(e)}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Jp(t,e)))return this.tileGrid;const i=ai(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=VB(e)),this.tileGridForProjection[i]}getTileCacheForProjection(e){const t=this.getProjection();if(!t||Jp(t,e))return this.tileCache;const i=ai(e);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new BB(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}createTile_(e,t,i,r,s,a){const o=[e,t,i],d=this.getTileCoordForTileUrlFunction(o,s),p=d?this.tileUrlFunction(d,r,s):void 0,g=new this.tileClass(o,p!==void 0?Yn.IDLE:Yn.EMPTY,p!==void 0?p:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return g.key=a,g.addEventListener(ti.CHANGE,this.handleTileChange.bind(this)),g}getTile(e,t,i,r,s){const a=this.getProjection();if(!a||!s||Jp(a,s))return this.getTileInternal(e,t,i,r,a||s);const o=this.getTileCacheForProjection(s),d=[e,t,i];let p;const g=zB(d);o.containsKey(g)&&(p=o.get(g));const _=this.getKey();if(p&&p.key==_)return p;const w=this.getTileGridForProjection(a),T=this.getTileGridForProjection(s),I=this.getTileCoordForTileUrlFunction(d,s),L=new XT(a,w,s,T,d,I,this.getTilePixelRatio(r),this.getGutter(),(P,C,O,z)=>this.getTileInternal(P,C,O,z,a),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return L.key=_,p?(L.interimTile=p,L.refreshInterimChain(),o.replace(g,L)):o.set(g,L),L}getTileInternal(e,t,i,r,s){let a=null;const o=Tb(e,t,i),d=this.getKey();if(!this.tileCache.containsKey(o))a=this.createTile_(e,t,i,r,s,d),this.tileCache.set(o,a);else if(a=this.tileCache.get(o),a.key!=d){const p=a;a=this.createTile_(e,t,i,r,s,d),p.getState()==Yn.IDLE?a.interimTile=p.interimTile:a.interimTile=p,a.refreshInterimChain(),this.tileCache.replace(o,a)}return a}setRenderReprojectionEdges(e){if(this.renderReprojectionEdges_!=e){this.renderReprojectionEdges_=e;for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear();this.changed()}}setTileGridForProjection(e,t){const i=aa(e);if(i){const r=ai(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=t)}}clear(){super.clear();for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear()}}function f$(n,e){n.getImage().src=e}class p$ extends d${constructor(e){e=e||{};const t=e.projection!==void 0?e.projection:"EPSG:3857",i=e.tileGrid!==void 0?e.tileGrid:r$({extent:VA(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,opaque:e.opaque,projection:t,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0}getGutter(){return this.gutter_}}const m$={},g$=Object.freeze(Object.defineProperty({__proto__:null,default:m$},Symbol.toStringTag,{value:"Module"})),_$='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class y$ extends p${constructor(e){e=e||{};let t;e.attributions!==void 0?t=e.attributions:t=[_$];const i=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",r=e.url!==void 0?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:i,interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}const fx={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class v$ extends gb{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.setPreload(e.preload!==void 0?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0)}getPreload(){return this.get(fx.PRELOAD)}setPreload(e){this.set(fx.PRELOAD,e)}getUseInterimTilesOnError(){return this.get(fx.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(e){this.set(fx.USE_INTERIM_TILES_ON_ERROR,e)}getData(e){return super.getData(e)}}class x$ extends vB{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Da(),this.tmpTileRange_=new UA(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),i=e.getState(),r=t.getUseInterimTilesOnError();return i==Yn.LOADED||i==Yn.EMPTY||i==Yn.ERROR&&!r}getTile(e,t,i,r){const s=r.pixelRatio,a=r.viewState.projection,o=this.getLayer();let p=o.getSource().getTile(e,t,i,s,a);return p.getState()==Yn.ERROR&&o.getUseInterimTilesOnError()&&o.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(p)||(p=p.getInterimTile()),p}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=Ws(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!eg(s,r))return null;const a=t.pixelRatio,o=t.viewState.projection,d=t.viewState,p=i.getRenderSource(),g=p.getTileGridForProjection(d.projection),_=p.getTilePixelRatio(t.pixelRatio);for(let w=g.getZForResolution(d.resolution);w>=g.getMinZoom();--w){const T=g.getTileCoordForCoordAndZ(r,w),I=p.getTile(w,T[1],T[2],a,o);if(!(I instanceof NB||I instanceof XT)||I instanceof XT&&I.getState()===Yn.EMPTY)return null;if(I.getState()!==Yn.LOADED)continue;const L=g.getOrigin(w),P=Ia(g.getTileSize(w)),C=g.getResolution(w),O=Math.floor(_*((r[0]-L[0])/C-T[1]*P[0])),z=Math.floor(_*((L[1]-r[1])/C-T[2]*P[1])),H=Math.round(_*p.getGutterForProjection(d.projection));return this.getImageData(I.getImage(),O+H,z+H)}return null}loadedTileCallback(e,t,i){return this.isDrawableTile(i)?super.loadedTileCallback(e,t,i):!1}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const i=e.layerStatesArray[e.layerIndex],r=e.viewState,s=r.projection,a=r.resolution,o=r.center,d=r.rotation,p=e.pixelRatio,g=this.getLayer(),_=g.getSource(),w=_.getRevision(),T=_.getTileGridForProjection(s),I=T.getZForResolution(a,_.zDirection),L=T.getResolution(I);let P=e.extent;const C=e.viewState.resolution,O=_.getTilePixelRatio(p);this.prepareContainer(e,t);const z=this.context.canvas.width,H=this.context.canvas.height,Y=i.extent&&Kh(i.extent);Y&&(P=wy(P,Kh(i.extent)));const ee=L*z/2/O,te=L*H/2/O,ce=[o[0]-ee,o[1]-te,o[0]+ee,o[1]+te],K=T.getTileRangeForExtentAndZ(P,I),Q={};Q[I]={};const pe=this.createLoadedTileFinder(_,s,Q),ze=this.tmpExtent,Fe=this.tmpTileRange_;this.newTiles_=!1;const qe=d?FT(r.center,C,d,e.size):void 0;for(let dt=K.minX;dt<=K.maxX;++dt)for(let Ct=K.minY;Ct<=K.maxY;++Ct){if(d&&!T.tileCoordIntersectsViewport([I,dt,Ct],qe))continue;const Vt=this.getTile(I,dt,Ct,e);if(this.isDrawableTile(Vt)){const Et=ai(this);if(Vt.getState()==Yn.LOADED){Q[I][Vt.tileCoord.toString()]=Vt;let It=Vt.inTransition(Et);It&&i.opacity!==1&&(Vt.endTransition(Et),It=!1),!this.newTiles_&&(It||!this.renderedTiles.includes(Vt))&&(this.newTiles_=!0)}if(Vt.getAlpha(Et,e.time)===1)continue}const Re=T.getTileCoordChildTileRange(Vt.tileCoord,Fe,ze);let mt=!1;Re&&(mt=pe(I+1,Re)),mt||T.forEachTileCoordParentTileRange(Vt.tileCoord,pe,Fe,ze)}const et=L/a*p/O,Ne=this.getRenderContext(e);ju(this.tempTransform,z/2,H/2,et,et,0,-z/2,-H/2),Y&&this.clipUnrotated(Ne,e,Y),_.getInterpolate()||(Ne.imageSmoothingEnabled=!1),this.preRender(Ne,e),this.renderedTiles.length=0;let st=Object.keys(Q).map(Number);st.sort(Ou);let Ee,ut,ot;i.opacity===1&&(!this.containerReused||_.getOpaque(e.viewState.projection))?st=st.reverse():(Ee=[],ut=[]);for(let dt=st.length-1;dt>=0;--dt){const Ct=st[dt],Vt=_.getTilePixelSize(Ct,p,s),mt=T.getResolution(Ct)/L,Et=Vt[0]*mt*et,It=Vt[1]*mt*et,vn=T.getTileCoordForCoordAndZ(Ad(ce),Ct),xn=T.getTileCoordExtent(vn),at=Ws(this.tempTransform,[O*(xn[0]-ce[0])/L,O*(ce[3]-xn[3])/L]),Rn=O*_.getGutterForProjection(s),Me=Q[Ct];for(const Jn in Me){const on=Me[Jn],Vn=on.tileCoord,Te=vn[1]-Vn[1],jn=Math.round(at[0]-(Te-1)*Et),wn=vn[2]-Vn[2],jt=Math.round(at[1]-(wn-1)*It),me=Math.round(at[0]-Te*Et),le=Math.round(at[1]-wn*It),tt=jn-me,xt=jt-le,St=I===Ct,yt=St&&on.getAlpha(ai(this),e.time)!==1;let hn=!1;if(!yt)if(Ee){ot=[me,le,me+tt,le,me+tt,le+xt,me,le+xt];for(let zt=0,Je=Ee.length;zt<Je;++zt)if(I!==Ct&&Ct<ut[zt]){const cn=Ee[zt];No([me,le,me+tt,le+xt],[cn[0],cn[3],cn[4],cn[7]])&&(hn||(Ne.save(),hn=!0),Ne.beginPath(),Ne.moveTo(ot[0],ot[1]),Ne.lineTo(ot[2],ot[3]),Ne.lineTo(ot[4],ot[5]),Ne.lineTo(ot[6],ot[7]),Ne.moveTo(cn[6],cn[7]),Ne.lineTo(cn[4],cn[5]),Ne.lineTo(cn[2],cn[3]),Ne.lineTo(cn[0],cn[1]),Ne.clip())}Ee.push(ot),ut.push(Ct)}else Ne.clearRect(me,le,tt,xt);this.drawTileImage(on,e,me,le,tt,xt,Rn,St),Ee&&!yt?(hn&&Ne.restore(),this.renderedTiles.unshift(on)):this.renderedTiles.push(on),this.updateUsedTiles(e.usedTiles,_,on)}}return this.renderedRevision=w,this.renderedResolution=L,this.extentChanged=!this.renderedExtent_||!e0(this.renderedExtent_,ce),this.renderedExtent_=ce,this.renderedPixelRatio=p,this.renderedProjection=s,this.manageTilePyramid(e,_,T,p,s,P,I,g.getPreload()),this.scheduleExpireCache(e,_),this.postRender(this.context,e),i.extent&&Ne.restore(),Ne.imageSmoothingEnabled=!0,this.container}drawTileImage(e,t,i,r,s,a,o,d){const p=this.getTileImage(e);if(!p)return;const g=this.getRenderContext(t),_=ai(this),w=t.layerStatesArray[t.layerIndex],T=w.opacity*(d?e.getAlpha(_,t.time):1),I=T!==g.globalAlpha;I&&(g.save(),g.globalAlpha=T),g.drawImage(p,o,o,p.width-2*o,p.height-2*o,i,r,s,a),I&&g.restore(),T!==w.opacity?t.animate=!0:d&&e.endTransition(_)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const i=(function(r,s,a){const o=ai(r);o in a.usedTiles&&r.expireCache(a.viewState.projection,a.usedTiles[o])}).bind(null,t);e.postRenderFunctions.push(i)}}updateUsedTiles(e,t,i){const r=ai(t);r in e||(e[r]={}),e[r][i.getKey()]=!0}manageTilePyramid(e,t,i,r,s,a,o,d,p){const g=ai(t);g in e.wantedTiles||(e.wantedTiles[g]={});const _=e.wantedTiles[g],w=e.tileQueue,T=i.getMinZoom(),I=e.viewState.rotation,L=I?FT(e.viewState.center,e.viewState.resolution,I,e.size):void 0;let P=0,C,O,z,H,Y,ee;for(ee=T;ee<=o;++ee)for(O=i.getTileRangeForExtentAndZ(a,ee,O),z=i.getResolution(ee),H=O.minX;H<=O.maxX;++H)for(Y=O.minY;Y<=O.maxY;++Y)I&&!i.tileCoordIntersectsViewport([ee,H,Y],L)||(o-ee<=d?(++P,C=t.getTile(ee,H,Y,r,s),C.getState()==Yn.IDLE&&(_[C.getKey()]=!0,w.isKeyQueued(C.getKey())||w.enqueue([C,g,i.getTileCoordCenter(C.tileCoord),z])),p!==void 0&&p(C)):t.useTile(ee,H,Y,s));t.updateCacheSize(P,s)}}class w$ extends v${constructor(e){super(e)}createRenderer(){return new x$(this)}}const b$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='48'%20height='48'%20viewBox='0%20-960%20960%20960'%3e%3cpath%20d='M796-121%20533-384q-30%2026-69.96%2040.5Q423.08-329%20378-329q-108.16%200-183.08-75Q120-479%20120-585t75-181q75-75%20181.5-75t181%2075Q632-691%20632-584.85%20632-542%20618-502q-14%2040-42%2075l264%20262-44%2044ZM377-389q81.25%200%20138.13-57.5Q572-504%20572-585t-56.87-138.5Q458.25-781%20377-781q-82.08%200-139.54%2057.5Q180-666%20180-585t57.46%20138.5Q294.92-389%20377-389ZM275-556v-60h201v60H275Z'/%3e%3c/svg%3e",S$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='48'%20height='48'%20viewBox='0%20-960%20960%20960'%3e%3cpath%20d='M796-121%20533-384q-30%2026-69.96%2040.5Q423.08-329%20378-329q-108.16%200-183.08-75Q120-479%20120-585t75-181q75-75%20181.5-75t181%2075Q632-691%20632-584.85%20632-542%20618-502q-14%2040-42%2075l264%20262-44%2044ZM377-389q81.25%200%20138.13-57.5Q572-504%20572-585t-56.87-138.5Q458.25-781%20377-781q-82.08%200-139.54%2057.5Q180-666%20180-585t57.46%20138.5Q294.92-389%20377-389Zm-31-85v-82h-82v-60h82v-81h60v81h81v60h-81v82h-60Z'/%3e%3c/svg%3e",M$="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='48'%20height='48'%20viewBox='0%20-960%20960%20960'%3e%3cpath%20d='M259-200v-60h310q70%200%20120.5-46.5T740-422q0-69-50.5-115.5T569-584H274l114%20114-42%2042-186-186%20186-186%2042%2042-114%20114h294q95%200%20163.5%2064T800-422q0%2094-68.5%20158T568-200H259Z'/%3e%3c/svg%3e",ND=["fullscreenchange","webkitfullscreenchange","MSFullscreenChange"],zD={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class E$ extends Pg{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const r=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=r,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(ti.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${Cg} ${vb}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(BD(t))if(UD(t))C$(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?T$(i):HB(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=UD(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(ow(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(zD.ENTERFULLSCREEN)):(ow(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(zD.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(Is.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(Is.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,r=e.length;i<r;++i)cr(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();BD(i)?this.element.classList.remove(sD):this.element.classList.add(sD);for(let r=0,s=ND.length;r<s;++r)e.push(fi(i,ND[r],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function BD(n){const e=n.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&n.fullscreenEnabled)}function UD(n){return!!(n.webkitIsFullScreen||n.fullscreenElement)}function HB(n){n.requestFullscreen?n.requestFullscreen():n.webkitRequestFullscreen&&n.webkitRequestFullscreen()}function T$(n){n.webkitRequestFullscreen?n.webkitRequestFullscreen():HB(n)}function C$(n){n.exitFullscreen?n.exitFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen()}const IM="projection",VD="coordinateFormat";class A$ extends Pg{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(IM,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(VD)}getProjection(){return this.get(IM)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(fi(t,m0.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(fi(t,m0.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(VD,e)}setProjection(e){this.set(IM,aa(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const s=this.getProjection();s?this.transform_=hb(this.mapProjection_,s):this.transform_=uA}const r=this.getMap().getCoordinateFromPixelInternal(e);if(r){if(this.transform_(r,r),this.wrapX_){const a=this.getProjection()||this.mapProjection_;lA(r,a)}const s=this.getCoordinateFormat();s?t=s(r):t=r.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const PM="units",I$=[1,2,5],O_=25.4/.28;class RM extends Pg{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+Cg,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(PM,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(PM)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(PM,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,r=this.getUnits(),s=r=="degrees"?"degrees":"m";let a=Q1(i,e.resolution,t,s);const o=this.minWidth_*(this.dpi_||O_)/O_,d=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||O_)/O_:void 0;let p=o*a,g="";if(r=="degrees"){const z=ng.degrees;p*=z,p<z/60?(g="",a*=3600):p<z?(g="",a*=60):g=""}else if(r=="imperial")p<.9144?(g="in",a/=.0254):p<1609.344?(g="ft",a/=.3048):(g="mi",a/=1609.344);else if(r=="nautical")a/=1852,g="NM";else if(r=="metric")p<1e-6?(g="nm",a*=1e9):p<.001?(g="m",a*=1e6):p<1?(g="mm",a*=1e3):p<1e3?g="m":(g="km",a/=1e3);else if(r=="us")p<.9144?(g="in",a*=39.37):p<1609.344?(g="ft",a/=.30480061):(g="mi",a/=1609.3472);else throw new Error("Invalid units");let _=3*Math.floor(Math.log(o*a)/Math.log(10)),w,T,I,L,P,C;for(;;){I=Math.floor(_/3);const z=Math.pow(10,I);if(w=I$[(_%3+3)%3]*z,T=Math.round(w/a),isNaN(T)){this.element.style.display="none",this.renderedVisible_=!1;return}if(d!==void 0&&T>=d){w=L,T=P,I=C;break}else if(T>=o)break;L=w,P=T,C=I,++_}const O=this.scaleBar_?this.createScaleBar(T,w,g):w.toFixed(I<0?-I:0)+" "+g;this.renderedHTML_!=O&&(this.innerElement_.innerHTML=O,this.renderedHTML_=O),this.renderedWidth_!=T&&(this.innerElement_.style.width=T+"px",this.renderedWidth_=T),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const r=this.getScaleForResolution(),s=r<1?Math.round(1/r).toLocaleString()+" : 1":"1 : "+Math.round(r).toLocaleString(),a=this.scaleBarSteps_,o=e/a,d=[this.createMarker("absolute")];for(let g=0;g<a;++g){const _=g%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";d.push(`<div><div class="ol-scale-singlebar ${_}" style="width: ${o}px;"></div>`+this.createMarker("relative")+(g%2===0||a===2?this.createStepText(g,e,!1,t,i):"")+"</div>")}return d.push(this.createStepText(a,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+s+"</div>":"")+d.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,r,s){const o=(e===0?0:Math.round(r/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+s),d=e===0?-3:t/this.scaleBarSteps_*-1,p=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${d}px;text-align: ${e===0?"left":"center"};min-width: ${p}px;left: ${i?t+"px":"unset"};">`+o+"</div>"}getScaleForResolution(){const e=Q1(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||O_,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}function P$(n){n("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),n("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),n("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),n.WGS84=n["EPSG:4326"],n["EPSG:3785"]=n["EPSG:3857"],n.GOOGLE=n["EPSG:3857"],n["EPSG:900913"]=n["EPSG:3857"],n["EPSG:102113"]=n["EPSG:3857"]}var Nf=1,zf=2,Nm=3,R$=4,ZT=5,GD=6378137,L$=6356752314e-3,HD=.0066943799901413165,My=484813681109536e-20,Bt=Math.PI/2,D$=.16666666666666666,k$=.04722222222222222,F$=.022156084656084655,_n=1e-10,Hs=.017453292519943295,Ic=57.29577951308232,Ji=Math.PI/4,g0=Math.PI*2,Jr=3.14159265359,ca={};ca.greenwich=0;ca.lisbon=-9.131906111111;ca.paris=2.337229166667;ca.bogota=-74.080916666667;ca.madrid=-3.687938888889;ca.rome=12.452333333333;ca.bern=7.439583333333;ca.jakarta=106.807719444444;ca.ferro=-17.666666666667;ca.brussels=4.367975;ca.stockholm=18.058277777778;ca.athens=23.7163375;ca.oslo=10.722916666667;const O$={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}};var WD=/[\s_\-\/\(\)]/g;function bd(n,e){if(n[e])return n[e];for(var t=Object.keys(n),i=e.toLowerCase().replace(WD,""),r=-1,s,a;++r<t.length;)if(s=t[r],a=s.toLowerCase().replace(WD,""),a===i)return n[s]}function YT(n){var e={},t=n.split("+").map(function(o){return o.trim()}).filter(function(o){return o}).reduce(function(o,d){var p=d.split("=");return p.push(!0),o[p[0].toLowerCase()]=p[1],o},{}),i,r,s,a={proj:"projName",datum:"datumCode",rf:function(o){e.rf=parseFloat(o)},lat_0:function(o){e.lat0=o*Hs},lat_1:function(o){e.lat1=o*Hs},lat_2:function(o){e.lat2=o*Hs},lat_ts:function(o){e.lat_ts=o*Hs},lon_0:function(o){e.long0=o*Hs},lon_1:function(o){e.long1=o*Hs},lon_2:function(o){e.long2=o*Hs},alpha:function(o){e.alpha=parseFloat(o)*Hs},gamma:function(o){e.rectified_grid_angle=parseFloat(o)},lonc:function(o){e.longc=o*Hs},x_0:function(o){e.x0=parseFloat(o)},y_0:function(o){e.y0=parseFloat(o)},k_0:function(o){e.k0=parseFloat(o)},k:function(o){e.k0=parseFloat(o)},a:function(o){e.a=parseFloat(o)},b:function(o){e.b=parseFloat(o)},r:function(o){e.a=e.b=parseFloat(o)},r_a:function(){e.R_A=!0},zone:function(o){e.zone=parseInt(o,10)},south:function(){e.utmSouth=!0},towgs84:function(o){e.datum_params=o.split(",").map(function(d){return parseFloat(d)})},to_meter:function(o){e.to_meter=parseFloat(o)},units:function(o){e.units=o;var d=bd(O$,o);d&&(e.to_meter=d.to_meter)},from_greenwich:function(o){e.from_greenwich=o*Hs},pm:function(o){var d=bd(ca,o);e.from_greenwich=(d||parseFloat(o))*Hs},nadgrids:function(o){o==="@null"?e.datumCode="none":e.nadgrids=o},axis:function(o){var d="ewnsud";o.length===3&&d.indexOf(o.substr(0,1))!==-1&&d.indexOf(o.substr(1,1))!==-1&&d.indexOf(o.substr(2,1))!==-1&&(e.axis=o)},approx:function(){e.approx=!0}};for(i in t)r=t[i],i in a?(s=a[i],typeof s=="function"?s(r):e[s]=r):e[i]=r;return typeof e.datumCode=="string"&&e.datumCode!=="WGS84"&&(e.datumCode=e.datumCode.toLowerCase()),e}var _0=1,WB=2,jB=3,pw=4,$B=5,HA=-1,N$=/\s/,z$=/[A-Za-z]/,B$=/[A-Za-z84_]/,Cb=/[,\]]/,qB=/[\d\.E\-\+]/;function eh(n){if(typeof n!="string")throw new Error("not a string");this.text=n.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=_0}eh.prototype.readCharicter=function(){var n=this.text[this.place++];if(this.state!==pw)for(;N$.test(n);){if(this.place>=this.text.length)return;n=this.text[this.place++]}switch(this.state){case _0:return this.neutral(n);case WB:return this.keyword(n);case pw:return this.quoted(n);case $B:return this.afterquote(n);case jB:return this.number(n);case HA:return}};eh.prototype.afterquote=function(n){if(n==='"'){this.word+='"',this.state=pw;return}if(Cb.test(n)){this.word=this.word.trim(),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in afterquote yet, index '+this.place)};eh.prototype.afterItem=function(n){if(n===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=_0;return}if(n==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=_0,this.currentObject=this.stack.pop(),this.currentObject||(this.state=HA);return}};eh.prototype.number=function(n){if(qB.test(n)){this.word+=n;return}if(Cb.test(n)){this.word=parseFloat(this.word),this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in number yet, index '+this.place)};eh.prototype.quoted=function(n){if(n==='"'){this.state=$B;return}this.word+=n};eh.prototype.keyword=function(n){if(B$.test(n)){this.word+=n;return}if(n==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=_0;return}if(Cb.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in keyword yet, index '+this.place)};eh.prototype.neutral=function(n){if(z$.test(n)){this.word=n,this.state=WB;return}if(n==='"'){this.word="",this.state=pw;return}if(qB.test(n)){this.word=n,this.state=jB;return}if(Cb.test(n)){this.afterItem(n);return}throw new Error(`havn't handled "`+n+'" in neutral yet, index '+this.place)};eh.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===HA)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function U$(n){var e=new eh(n);return e.output()}function jD(n,e,t){Array.isArray(e)&&(t.unshift(e),e=null);var i=e?{}:n,r=t.reduce(function(s,a){return bm(a,s),s},i);e&&(n[e]=r)}function bm(n,e){if(!Array.isArray(n)){e[n]=!0;return}var t=n.shift();if(t==="PARAMETER"&&(t=n.shift()),n.length===1){if(Array.isArray(n[0])){e[t]={},bm(n[0],e[t]);return}e[t]=n[0];return}if(!n.length){e[t]=!0;return}if(t==="TOWGS84"){e[t]=n;return}if(t==="AXIS"){t in e||(e[t]=[]),e[t].push(n);return}Array.isArray(t)||(e[t]={});var i;switch(t){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[t]={name:n[0].toLowerCase(),convert:n[1]},n.length===3&&bm(n[2],e[t]);return;case"SPHEROID":case"ELLIPSOID":e[t]={name:n[0],a:n[1],rf:n[2]},n.length===4&&bm(n[3],e[t]);return;case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":n[0]=["name",n[0]],jD(e,t,n);return;default:for(i=-1;++i<n.length;)if(!Array.isArray(n[i]))return bm(n,e[t]);return jD(e,t,n)}}var V$=.017453292519943295;function G$(n,e){var t=e[0],i=e[1];!(t in n)&&i in n&&(n[t]=n[i],e.length===3&&(n[t]=e[2](n[t])))}function yc(n){return n*V$}function H$(n){if(n.type==="GEOGCS"?n.projName="longlat":n.type==="LOCAL_CS"?(n.projName="identity",n.local=!0):typeof n.PROJECTION=="object"?n.projName=Object.keys(n.PROJECTION)[0]:n.projName=n.PROJECTION,n.AXIS){for(var e="",t=0,i=n.AXIS.length;t<i;++t){var r=[n.AXIS[t][0].toLowerCase(),n.AXIS[t][1].toLowerCase()];r[0].indexOf("north")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="north"?e+="n":r[0].indexOf("south")!==-1||(r[0]==="y"||r[0]==="lat")&&r[1]==="south"?e+="s":r[0].indexOf("east")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="east"?e+="e":(r[0].indexOf("west")!==-1||(r[0]==="x"||r[0]==="lon")&&r[1]==="west")&&(e+="w")}e.length===2&&(e+="u"),e.length===3&&(n.axis=e)}n.UNIT&&(n.units=n.UNIT.name.toLowerCase(),n.units==="metre"&&(n.units="meter"),n.UNIT.convert&&(n.type==="GEOGCS"?n.DATUM&&n.DATUM.SPHEROID&&(n.to_meter=n.UNIT.convert*n.DATUM.SPHEROID.a):n.to_meter=n.UNIT.convert));var s=n.GEOGCS;n.type==="GEOGCS"&&(s=n),s&&(s.DATUM?n.datumCode=s.DATUM.name.toLowerCase():n.datumCode=s.name.toLowerCase(),n.datumCode.slice(0,2)==="d_"&&(n.datumCode=n.datumCode.slice(2)),(n.datumCode==="new_zealand_geodetic_datum_1949"||n.datumCode==="new_zealand_1949")&&(n.datumCode="nzgd49"),(n.datumCode==="wgs_1984"||n.datumCode==="world_geodetic_system_1984")&&(n.PROJECTION==="Mercator_Auxiliary_Sphere"&&(n.sphere=!0),n.datumCode="wgs84"),n.datumCode.slice(-6)==="_ferro"&&(n.datumCode=n.datumCode.slice(0,-6)),n.datumCode.slice(-8)==="_jakarta"&&(n.datumCode=n.datumCode.slice(0,-8)),~n.datumCode.indexOf("belge")&&(n.datumCode="rnb72"),s.DATUM&&s.DATUM.SPHEROID&&(n.ellps=s.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),n.ellps.toLowerCase().slice(0,13)==="international"&&(n.ellps="intl"),n.a=s.DATUM.SPHEROID.a,n.rf=parseFloat(s.DATUM.SPHEROID.rf,10)),s.DATUM&&s.DATUM.TOWGS84&&(n.datum_params=s.DATUM.TOWGS84),~n.datumCode.indexOf("osgb_1936")&&(n.datumCode="osgb36"),~n.datumCode.indexOf("osni_1952")&&(n.datumCode="osni52"),(~n.datumCode.indexOf("tm65")||~n.datumCode.indexOf("geodetic_datum_of_1965"))&&(n.datumCode="ire65"),n.datumCode==="ch1903+"&&(n.datumCode="ch1903"),~n.datumCode.indexOf("israel")&&(n.datumCode="isr93")),n.b&&!isFinite(n.b)&&(n.b=n.a);function a(p){var g=n.to_meter||1;return p*g}var o=function(p){return G$(n,p)},d=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",yc],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",yc],["x0","false_easting",a],["y0","false_northing",a],["long0","central_meridian",yc],["lat0","latitude_of_origin",yc],["lat0","standard_parallel_1",yc],["lat1","standard_parallel_1",yc],["lat2","standard_parallel_2",yc],["azimuth","Azimuth"],["alpha","azimuth",yc],["srsCode","name"]];d.forEach(o),!n.long0&&n.longc&&(n.projName==="Albers_Conic_Equal_Area"||n.projName==="Lambert_Azimuthal_Equal_Area")&&(n.long0=n.longc),!n.lat_ts&&n.lat1&&(n.projName==="Stereographic_South_Pole"||n.projName==="Polar Stereographic (variant B)")?(n.lat0=yc(n.lat1>0?90:-90),n.lat_ts=n.lat1):!n.lat_ts&&n.lat0&&n.projName==="Polar_Stereographic"&&(n.lat_ts=n.lat0,n.lat0=yc(n.lat0>0?90:-90))}function XB(n){var e=U$(n),t=e.shift(),i=e.shift();e.unshift(["name",i]),e.unshift(["type",t]);var r={};return bm(e,r),H$(r),r}function ko(n){var e=this;if(arguments.length===2){var t=arguments[1];typeof t=="string"?t.charAt(0)==="+"?ko[n]=YT(arguments[1]):ko[n]=XB(arguments[1]):ko[n]=t}else if(arguments.length===1){if(Array.isArray(n))return n.map(function(i){Array.isArray(i)?ko.apply(e,i):ko(i)});if(typeof n=="string"){if(n in ko)return ko[n]}else"EPSG"in n?ko["EPSG:"+n.EPSG]=n:"ESRI"in n?ko["ESRI:"+n.ESRI]=n:"IAU2000"in n?ko["IAU2000:"+n.IAU2000]=n:console.log(n);return}}P$(ko);function W$(n){return typeof n=="string"}function j$(n){return n in ko}var $$=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function q$(n){return $$.some(function(e){return n.indexOf(e)>-1})}var X$=["3857","900913","3785","102113"];function Z$(n){var e=bd(n,"authority");if(e){var t=bd(e,"epsg");return t&&X$.indexOf(t)>-1}}function Y$(n){var e=bd(n,"extension");if(e)return bd(e,"proj4")}function K$(n){return n[0]==="+"}function J$(n){if(W$(n)){if(j$(n))return ko[n];if(q$(n)){var e=XB(n);if(Z$(e))return ko["EPSG:3857"];var t=Y$(e);return t?YT(t):e}if(K$(n))return YT(n)}else return n}function $D(n,e){n=n||{};var t,i;if(!e)return n;for(i in e)t=e[i],t!==void 0&&(n[i]=t);return n}function Nc(n,e,t){var i=n*e;return t/Math.sqrt(1-i*i)}function U0(n){return n<0?-1:1}function En(n){return Math.abs(n)<=Jr?n:n-U0(n)*g0}function Nl(n,e,t){var i=n*t,r=.5*n;return i=Math.pow((1-i)/(1+i),r),Math.tan(.5*(Bt-e))/i}function y0(n,e){for(var t=.5*n,i,r,s=Bt-2*Math.atan(e),a=0;a<=15;a++)if(i=n*Math.sin(s),r=Bt-2*Math.atan(e*Math.pow((1-i)/(1+i),t))-s,s+=r,Math.abs(r)<=1e-10)return s;return-9999}function Q$(){var n=this.b/this.a;this.es=1-n*n,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=Nc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)}function eq(n){var e=n.x,t=n.y;if(t*Ic>90&&t*Ic<-90&&e*Ic>180&&e*Ic<-180)return null;var i,r;if(Math.abs(Math.abs(t)-Bt)<=_n)return null;if(this.sphere)i=this.x0+this.a*this.k0*En(e-this.long0),r=this.y0+this.a*this.k0*Math.log(Math.tan(Ji+.5*t));else{var s=Math.sin(t),a=Nl(this.e,t,s);i=this.x0+this.a*this.k0*En(e-this.long0),r=this.y0-this.a*this.k0*Math.log(a)}return n.x=i,n.y=r,n}function tq(n){var e=n.x-this.x0,t=n.y-this.y0,i,r;if(this.sphere)r=Bt-2*Math.atan(Math.exp(-t/(this.a*this.k0)));else{var s=Math.exp(-t/(this.a*this.k0));if(r=y0(this.e,s),r===-9999)return null}return i=En(this.long0+e/(this.a*this.k0)),n.x=i,n.y=r,n}var nq=["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"];const iq={init:Q$,forward:eq,inverse:tq,names:nq};function rq(){}function qD(n){return n}var sq=["longlat","identity"];const oq={init:rq,forward:qD,inverse:qD,names:sq};var aq=[iq,oq],o1={},mw=[];function ZB(n,e){var t=mw.length;return n.names?(mw[t]=n,n.names.forEach(function(i){o1[i.toLowerCase()]=t}),this):(console.log(e),!0)}function lq(n){if(!n)return!1;var e=n.toLowerCase();if(typeof o1[e]<"u"&&mw[o1[e]])return mw[o1[e]]}function cq(){aq.forEach(ZB)}const uq={start:cq,add:ZB,get:lq};var li={};li.MERIT={a:6378137,rf:298.257,ellipseName:"MERIT 1983"};li.SGS85={a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"};li.GRS80={a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"};li.IAU76={a:6378140,rf:298.257,ellipseName:"IAU 1976"};li.airy={a:6377563396e-3,b:635625691e-2,ellipseName:"Airy 1830"};li.APL4={a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"};li.NWL9D={a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"};li.mod_airy={a:6377340189e-3,b:6356034446e-3,ellipseName:"Modified Airy"};li.andrae={a:637710443e-2,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"};li.aust_SA={a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"};li.GRS67={a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"};li.bessel={a:6377397155e-3,rf:299.1528128,ellipseName:"Bessel 1841"};li.bess_nam={a:6377483865e-3,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"};li.clrk66={a:63782064e-1,b:63565838e-1,ellipseName:"Clarke 1866"};li.clrk80={a:6378249145e-3,rf:293.4663,ellipseName:"Clarke 1880 mod."};li.clrk80ign={a:63782492e-1,b:6356515,rf:293.4660213,ellipseName:"Clarke 1880 (IGN)"};li.clrk58={a:6378293645208759e-9,rf:294.2606763692654,ellipseName:"Clarke 1858"};li.CPM={a:63757387e-1,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"};li.delmbr={a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"};li.engelis={a:637813605e-2,rf:298.2566,ellipseName:"Engelis 1985"};li.evrst30={a:6377276345e-3,rf:300.8017,ellipseName:"Everest 1830"};li.evrst48={a:6377304063e-3,rf:300.8017,ellipseName:"Everest 1948"};li.evrst56={a:6377301243e-3,rf:300.8017,ellipseName:"Everest 1956"};li.evrst69={a:6377295664e-3,rf:300.8017,ellipseName:"Everest 1969"};li.evrstSS={a:6377298556e-3,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"};li.fschr60={a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"};li.fschr60m={a:6378155,rf:298.3,ellipseName:"Fischer 1960"};li.fschr68={a:6378150,rf:298.3,ellipseName:"Fischer 1968"};li.helmert={a:6378200,rf:298.3,ellipseName:"Helmert 1906"};li.hough={a:6378270,rf:297,ellipseName:"Hough"};li.intl={a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"};li.kaula={a:6378163,rf:298.24,ellipseName:"Kaula 1961"};li.lerch={a:6378139,rf:298.257,ellipseName:"Lerch 1979"};li.mprts={a:6397300,rf:191,ellipseName:"Maupertius 1738"};li.new_intl={a:63781575e-1,b:63567722e-1,ellipseName:"New International 1967"};li.plessis={a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"};li.krass={a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"};li.SEasia={a:6378155,b:63567733205e-4,ellipseName:"Southeast Asia"};li.walbeck={a:6376896,b:63558348467e-4,ellipseName:"Walbeck"};li.WGS60={a:6378165,rf:298.3,ellipseName:"WGS 60"};li.WGS66={a:6378145,rf:298.25,ellipseName:"WGS 66"};li.WGS7={a:6378135,rf:298.26,ellipseName:"WGS 72"};var hq=li.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};li.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};function dq(n,e,t,i){var r=n*n,s=e*e,a=(r-s)/r,o=0;i?(n*=1-a*(D$+a*(k$+a*F$)),r=n*n,a=0):o=Math.sqrt(a);var d=(r-s)/s;return{es:a,e:o,ep2:d}}function fq(n,e,t,i,r){if(!n){var s=bd(li,i);s||(s=hq),n=s.a,e=s.b,t=s.rf}return t&&!e&&(e=(1-1/t)*n),(t===0||Math.abs(n-e)<_n)&&(r=!0,e=n),{a:n,b:e,rf:t,sphere:r}}var ts={};ts.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"};ts.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"};ts.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"};ts.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"};ts.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"};ts.potsdam={towgs84:"598.1,73.7,418.2,0.202,0.045,-2.455,6.7",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"};ts.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"};ts.hermannskogel={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Hermannskogel"};ts.militargeographische_institut={towgs84:"577.326,90.129,463.919,5.137,1.474,5.297,2.4232",ellipse:"bessel",datumName:"Militar-Geographische Institut"};ts.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"};ts.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"};ts.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"};ts.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"};ts.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"};ts.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"};ts.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"};ts.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"};ts.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"};function pq(n,e,t,i,r,s,a){var o={};return n===void 0||n==="none"?o.datum_type=ZT:o.datum_type=R$,e&&(o.datum_params=e.map(parseFloat),(o.datum_params[0]!==0||o.datum_params[1]!==0||o.datum_params[2]!==0)&&(o.datum_type=Nf),o.datum_params.length>3&&(o.datum_params[3]!==0||o.datum_params[4]!==0||o.datum_params[5]!==0||o.datum_params[6]!==0)&&(o.datum_type=zf,o.datum_params[3]*=My,o.datum_params[4]*=My,o.datum_params[5]*=My,o.datum_params[6]=o.datum_params[6]/1e6+1)),a&&(o.datum_type=Nm,o.grids=a),o.a=t,o.b=i,o.es=r,o.ep2=s,o}var YB={};function mq(n,e){var t=new DataView(e),i=yq(t),r=vq(t,i),s=xq(t,r,i),a={header:r,subgrids:s};return YB[n]=a,a}function gq(n){if(n===void 0)return null;var e=n.split(",");return e.map(_q)}function _q(n){if(n.length===0)return null;var e=n[0]==="@";return e&&(n=n.slice(1)),n==="null"?{name:"null",mandatory:!e,grid:null,isNull:!0}:{name:n,mandatory:!e,grid:YB[n]||null,isNull:!1}}function Sm(n){return n/3600*Math.PI/180}function yq(n){var e=n.getInt32(8,!1);return e===11?!1:(e=n.getInt32(8,!0),e!==11&&console.warn("Failed to detect nadgrid endian-ness, defaulting to little-endian"),!0)}function vq(n,e){return{nFields:n.getInt32(8,e),nSubgridFields:n.getInt32(24,e),nSubgrids:n.getInt32(40,e),shiftType:KT(n,56,64).trim(),fromSemiMajorAxis:n.getFloat64(120,e),fromSemiMinorAxis:n.getFloat64(136,e),toSemiMajorAxis:n.getFloat64(152,e),toSemiMinorAxis:n.getFloat64(168,e)}}function KT(n,e,t){return String.fromCharCode.apply(null,new Uint8Array(n.buffer.slice(e,t)))}function xq(n,e,t){for(var i=176,r=[],s=0;s<e.nSubgrids;s++){var a=bq(n,i,t),o=Sq(n,i,a,t),d=Math.round(1+(a.upperLongitude-a.lowerLongitude)/a.longitudeInterval),p=Math.round(1+(a.upperLatitude-a.lowerLatitude)/a.latitudeInterval);r.push({ll:[Sm(a.lowerLongitude),Sm(a.lowerLatitude)],del:[Sm(a.longitudeInterval),Sm(a.latitudeInterval)],lim:[d,p],count:a.gridNodeCount,cvs:wq(o)}),i+=176+a.gridNodeCount*16}return r}function wq(n){return n.map(function(e){return[Sm(e.longitudeShift),Sm(e.latitudeShift)]})}function bq(n,e,t){return{name:KT(n,e+8,e+16).trim(),parent:KT(n,e+24,e+24+8).trim(),lowerLatitude:n.getFloat64(e+72,t),upperLatitude:n.getFloat64(e+88,t),lowerLongitude:n.getFloat64(e+104,t),upperLongitude:n.getFloat64(e+120,t),latitudeInterval:n.getFloat64(e+136,t),longitudeInterval:n.getFloat64(e+152,t),gridNodeCount:n.getInt32(e+168,t)}}function Sq(n,e,t,i){for(var r=e+176,s=16,a=[],o=0;o<t.gridNodeCount;o++){var d={latitudeShift:n.getFloat32(r+o*s,i),longitudeShift:n.getFloat32(r+o*s+4,i),latitudeAccuracy:n.getFloat32(r+o*s+8,i),longitudeAccuracy:n.getFloat32(r+o*s+12,i)};a.push(d)}return a}function Fc(n,e){if(!(this instanceof Fc))return new Fc(n);e=e||function(p){if(p)throw p};var t=J$(n);if(typeof t!="object"){e(n);return}var i=Fc.projections.get(t.projName);if(!i){e(n);return}if(t.datumCode&&t.datumCode!=="none"){var r=bd(ts,t.datumCode);r&&(t.datum_params=t.datum_params||(r.towgs84?r.towgs84.split(","):null),t.ellps=r.ellipse,t.datumName=r.datumName?r.datumName:t.datumCode)}t.k0=t.k0||1,t.axis=t.axis||"enu",t.ellps=t.ellps||"wgs84",t.lat1=t.lat1||t.lat0;var s=fq(t.a,t.b,t.rf,t.ellps,t.sphere),a=dq(s.a,s.b,s.rf,t.R_A),o=gq(t.nadgrids),d=t.datum||pq(t.datumCode,t.datum_params,s.a,s.b,a.es,a.ep2,o);$D(this,t),$D(this,i),this.a=s.a,this.b=s.b,this.rf=s.rf,this.sphere=s.sphere,this.es=a.es,this.e=a.e,this.ep2=a.ep2,this.datum=d,this.init(),e(null,this)}Fc.projections=uq;Fc.projections.start();function Mq(n,e){return n.datum_type!==e.datum_type||n.a!==e.a||Math.abs(n.es-e.es)>5e-11?!1:n.datum_type===Nf?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]:n.datum_type===zf?n.datum_params[0]===e.datum_params[0]&&n.datum_params[1]===e.datum_params[1]&&n.datum_params[2]===e.datum_params[2]&&n.datum_params[3]===e.datum_params[3]&&n.datum_params[4]===e.datum_params[4]&&n.datum_params[5]===e.datum_params[5]&&n.datum_params[6]===e.datum_params[6]:!0}function KB(n,e,t){var i=n.x,r=n.y,s=n.z?n.z:0,a,o,d,p;if(r<-Bt&&r>-1.001*Bt)r=-Bt;else if(r>Bt&&r<1.001*Bt)r=Bt;else{if(r<-Bt)return{x:-1/0,y:-1/0,z:n.z};if(r>Bt)return{x:1/0,y:1/0,z:n.z}}return i>Math.PI&&(i-=2*Math.PI),o=Math.sin(r),p=Math.cos(r),d=o*o,a=t/Math.sqrt(1-e*d),{x:(a+s)*p*Math.cos(i),y:(a+s)*p*Math.sin(i),z:(a*(1-e)+s)*o}}function JB(n,e,t,i){var r=1e-12,s=r*r,a=30,o,d,p,g,_,w,T,I,L,P,C,O,z,H=n.x,Y=n.y,ee=n.z?n.z:0,te,ce,K;if(o=Math.sqrt(H*H+Y*Y),d=Math.sqrt(H*H+Y*Y+ee*ee),o/t<r){if(te=0,d/t<r)return ce=Bt,K=-i,{x:n.x,y:n.y,z:n.z}}else te=Math.atan2(Y,H);p=ee/d,g=o/d,_=1/Math.sqrt(1-e*(2-e)*g*g),I=g*(1-e)*_,L=p*_,z=0;do z++,T=t/Math.sqrt(1-e*L*L),K=o*I+ee*L-T*(1-e*L*L),w=e*T/(T+K),_=1/Math.sqrt(1-w*(2-w)*g*g),P=g*(1-w)*_,C=p*_,O=C*I-P*L,I=P,L=C;while(O*O>s&&z<a);return ce=Math.atan(C/Math.abs(P)),{x:te,y:ce,z:K}}function Eq(n,e,t){if(e===Nf)return{x:n.x+t[0],y:n.y+t[1],z:n.z+t[2]};if(e===zf){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],d=t[5],p=t[6];return{x:p*(n.x-d*n.y+o*n.z)+i,y:p*(d*n.x+n.y-a*n.z)+r,z:p*(-o*n.x+a*n.y+n.z)+s}}}function Tq(n,e,t){if(e===Nf)return{x:n.x-t[0],y:n.y-t[1],z:n.z-t[2]};if(e===zf){var i=t[0],r=t[1],s=t[2],a=t[3],o=t[4],d=t[5],p=t[6],g=(n.x-i)/p,_=(n.y-r)/p,w=(n.z-s)/p;return{x:g+d*_-o*w,y:-d*g+_+a*w,z:o*g-a*_+w}}}function px(n){return n===Nf||n===zf}function Cq(n,e,t){if(Mq(n,e)||n.datum_type===ZT||e.datum_type===ZT)return t;var i=n.a,r=n.es;if(n.datum_type===Nm){var s=XD(n,!1,t);if(s!==0)return;i=GD,r=HD}var a=e.a,o=e.b,d=e.es;if(e.datum_type===Nm&&(a=GD,o=L$,d=HD),r===d&&i===a&&!px(n.datum_type)&&!px(e.datum_type))return t;if(t=KB(t,r,i),px(n.datum_type)&&(t=Eq(t,n.datum_type,n.datum_params)),px(e.datum_type)&&(t=Tq(t,e.datum_type,e.datum_params)),t=JB(t,d,a,o),e.datum_type===Nm){var p=XD(e,!0,t);if(p!==0)return}return t}function XD(n,e,t){if(n.grids===null||n.grids.length===0)return console.log("Grid shift grids not found"),-1;var i={x:-t.x,y:t.y},r={x:Number.NaN,y:Number.NaN},s=[];e:for(var a=0;a<n.grids.length;a++){var o=n.grids[a];if(s.push(o.name),o.isNull){r=i;break}if(o.mandatory,o.grid===null){if(o.mandatory)return console.log("Unable to find mandatory grid '"+o.name+"'"),-1;continue}for(var d=o.grid.subgrids,p=0,g=d.length;p<g;p++){var _=d[p],w=(Math.abs(_.del[1])+Math.abs(_.del[0]))/1e4,T=_.ll[0]-w,I=_.ll[1]-w,L=_.ll[0]+(_.lim[0]-1)*_.del[0]+w,P=_.ll[1]+(_.lim[1]-1)*_.del[1]+w;if(!(I>i.y||T>i.x||P<i.y||L<i.x)&&(r=Aq(i,e,_),!isNaN(r.x)))break e}}return isNaN(r.x)?(console.log("Failed to find a grid shift table for location '"+-i.x*Ic+" "+i.y*Ic+" tried: '"+s+"'"),-1):(t.x=-r.x,t.y=r.y,0)}function Aq(n,e,t){var i={x:Number.NaN,y:Number.NaN};if(isNaN(n.x))return i;var r={x:n.x,y:n.y};r.x-=t.ll[0],r.y-=t.ll[1],r.x=En(r.x-Math.PI)+Math.PI;var s=ZD(r,t);if(e){if(isNaN(s.x))return i;s.x=r.x-s.x,s.y=r.y-s.y;var a=9,o=1e-12,d,p;do{if(p=ZD(s,t),isNaN(p.x)){console.log("Inverse grid shift iteration failed, presumably at grid edge.  Using first approximation.");break}d={x:r.x-(p.x+s.x),y:r.y-(p.y+s.y)},s.x+=d.x,s.y+=d.y}while(a--&&Math.abs(d.x)>o&&Math.abs(d.y)>o);if(a<0)return console.log("Inverse grid shift iterator failed to converge."),i;i.x=En(s.x+t.ll[0]),i.y=s.y+t.ll[1]}else isNaN(s.x)||(i.x=n.x+s.x,i.y=n.y+s.y);return i}function ZD(n,e){var t={x:n.x/e.del[0],y:n.y/e.del[1]},i={x:Math.floor(t.x),y:Math.floor(t.y)},r={x:t.x-1*i.x,y:t.y-1*i.y},s={x:Number.NaN,y:Number.NaN},a;if(i.x<0||i.x>=e.lim[0]||i.y<0||i.y>=e.lim[1])return s;a=i.y*e.lim[0]+i.x;var o={x:e.cvs[a][0],y:e.cvs[a][1]};a++;var d={x:e.cvs[a][0],y:e.cvs[a][1]};a+=e.lim[0];var p={x:e.cvs[a][0],y:e.cvs[a][1]};a--;var g={x:e.cvs[a][0],y:e.cvs[a][1]},_=r.x*r.y,w=r.x*(1-r.y),T=(1-r.x)*(1-r.y),I=(1-r.x)*r.y;return s.x=T*o.x+w*d.x+I*g.x+_*p.x,s.y=T*o.y+w*d.y+I*g.y+_*p.y,s}function YD(n,e,t){var i=t.x,r=t.y,s=t.z||0,a,o,d,p={};for(d=0;d<3;d++)if(!(e&&d===2&&t.z===void 0))switch(d===0?(a=i,"ew".indexOf(n.axis[d])!==-1?o="x":o="y"):d===1?(a=r,"ns".indexOf(n.axis[d])!==-1?o="y":o="x"):(a=s,o="z"),n.axis[d]){case"e":p[o]=a;break;case"w":p[o]=-a;break;case"n":p[o]=a;break;case"s":p[o]=-a;break;case"u":t[o]!==void 0&&(p.z=a);break;case"d":t[o]!==void 0&&(p.z=-a);break;default:return null}return p}function QB(n){var e={x:n[0],y:n[1]};return n.length>2&&(e.z=n[2]),n.length>3&&(e.m=n[3]),e}function Iq(n){KD(n.x),KD(n.y)}function KD(n){if(typeof Number.isFinite=="function"){if(Number.isFinite(n))return;throw new TypeError("coordinates must be finite numbers")}if(typeof n!="number"||n!==n||!isFinite(n))throw new TypeError("coordinates must be finite numbers")}function Pq(n,e){return(n.datum.datum_type===Nf||n.datum.datum_type===zf||n.datum.datum_type===Nm)&&e.datumCode!=="WGS84"||(e.datum.datum_type===Nf||e.datum.datum_type===zf||e.datum.datum_type===Nm)&&n.datumCode!=="WGS84"}function gw(n,e,t,i){var r;Array.isArray(t)?t=QB(t):t={x:t.x,y:t.y,z:t.z,m:t.m};var s=t.z!==void 0;if(Iq(t),n.datum&&e.datum&&Pq(n,e)&&(r=new Fc("WGS84"),t=gw(n,r,t,i),n=r),i&&n.axis!=="enu"&&(t=YD(n,!1,t)),n.projName==="longlat")t={x:t.x*Hs,y:t.y*Hs,z:t.z||0};else if(n.to_meter&&(t={x:t.x*n.to_meter,y:t.y*n.to_meter,z:t.z||0}),t=n.inverse(t),!t)return;if(n.from_greenwich&&(t.x+=n.from_greenwich),t=Cq(n.datum,e.datum,t),!!t)return e.from_greenwich&&(t={x:t.x-e.from_greenwich,y:t.y,z:t.z||0}),e.projName==="longlat"?t={x:t.x*Ic,y:t.y*Ic,z:t.z||0}:(t=e.forward(t),e.to_meter&&(t={x:t.x/e.to_meter,y:t.y/e.to_meter,z:t.z||0})),i&&e.axis!=="enu"?YD(e,!0,t):(t&&!s&&delete t.z,t)}var JD=Fc("WGS84");function LM(n,e,t,i){var r,s,a;return Array.isArray(t)?(r=gw(n,e,t,i)||{x:NaN,y:NaN},t.length>2?typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"?typeof r.z=="number"?[r.x,r.y,r.z].concat(t.splice(3)):[r.x,r.y,t[2]].concat(t.splice(3)):[r.x,r.y].concat(t.splice(2)):[r.x,r.y]):(s=gw(n,e,t,i),a=Object.keys(t),a.length===2||a.forEach(function(o){if(typeof n.name<"u"&&n.name==="geocent"||typeof e.name<"u"&&e.name==="geocent"){if(o==="x"||o==="y"||o==="z")return}else if(o==="x"||o==="y")return;s[o]=t[o]}),s)}function QD(n){return n instanceof Fc?n:n.oProj?n.oProj:Fc(n)}function Fa(n,e,t){n=QD(n);var i=!1,r;return typeof e>"u"?(e=n,n=JD,i=!0):(typeof e.x<"u"||Array.isArray(e))&&(t=e,e=n,n=JD,i=!0),e=QD(e),t?LM(n,e,t):(r={forward:function(s,a){return LM(n,e,s,a)},inverse:function(s,a){return LM(e,n,s,a)}},i&&(r.oProj=e),r)}var e3=6,eU="AJSAJS",tU="AFAFAF",Mm=65,Yo=73,Ya=79,ry=86,sy=90;const Rq={forward:nU,inverse:Lq,toPoint:iU};function nU(n,e){return e=e||5,Fq(Dq({lat:n[1],lon:n[0]}),e)}function Lq(n){var e=WA(sU(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat,e.lon,e.lat]:[e.left,e.bottom,e.right,e.top]}function iU(n){var e=WA(sU(n.toUpperCase()));return e.lat&&e.lon?[e.lon,e.lat]:[(e.left+e.right)/2,(e.top+e.bottom)/2]}function DM(n){return n*(Math.PI/180)}function t3(n){return 180*(n/Math.PI)}function Dq(n){var e=n.lat,t=n.lon,i=6378137,r=.00669438,s=.9996,a,o,d,p,g,_,w,T=DM(e),I=DM(t),L,P;P=Math.floor((t+180)/6)+1,t===180&&(P=60),e>=56&&e<64&&t>=3&&t<12&&(P=32),e>=72&&e<84&&(t>=0&&t<9?P=31:t>=9&&t<21?P=33:t>=21&&t<33?P=35:t>=33&&t<42&&(P=37)),a=(P-1)*6-180+3,L=DM(a),o=r/(1-r),d=i/Math.sqrt(1-r*Math.sin(T)*Math.sin(T)),p=Math.tan(T)*Math.tan(T),g=o*Math.cos(T)*Math.cos(T),_=Math.cos(T)*(I-L),w=i*((1-r/4-3*r*r/64-5*r*r*r/256)*T-(3*r/8+3*r*r/32+45*r*r*r/1024)*Math.sin(2*T)+(15*r*r/256+45*r*r*r/1024)*Math.sin(4*T)-35*r*r*r/3072*Math.sin(6*T));var C=s*d*(_+(1-p+g)*_*_*_/6+(5-18*p+p*p+72*g-58*o)*_*_*_*_*_/120)+5e5,O=s*(w+d*Math.tan(T)*(_*_/2+(5-p+9*g+4*g*g)*_*_*_*_/24+(61-58*p+p*p+600*g-330*o)*_*_*_*_*_*_/720));return e<0&&(O+=1e7),{northing:Math.round(O),easting:Math.round(C),zoneNumber:P,zoneLetter:kq(e)}}function WA(n){var e=n.northing,t=n.easting,i=n.zoneLetter,r=n.zoneNumber;if(r<0||r>60)return null;var s=.9996,a=6378137,o=.00669438,d,p=(1-Math.sqrt(1-o))/(1+Math.sqrt(1-o)),g,_,w,T,I,L,P,C,O,z=t-5e5,H=e;i<"N"&&(H-=1e7),P=(r-1)*6-180+3,d=o/(1-o),L=H/s,C=L/(a*(1-o/4-3*o*o/64-5*o*o*o/256)),O=C+(3*p/2-27*p*p*p/32)*Math.sin(2*C)+(21*p*p/16-55*p*p*p*p/32)*Math.sin(4*C)+151*p*p*p/96*Math.sin(6*C),g=a/Math.sqrt(1-o*Math.sin(O)*Math.sin(O)),_=Math.tan(O)*Math.tan(O),w=d*Math.cos(O)*Math.cos(O),T=a*(1-o)/Math.pow(1-o*Math.sin(O)*Math.sin(O),1.5),I=z/(g*s);var Y=O-g*Math.tan(O)/T*(I*I/2-(5+3*_+10*w-4*w*w-9*d)*I*I*I*I/24+(61+90*_+298*w+45*_*_-252*d-3*w*w)*I*I*I*I*I*I/720);Y=t3(Y);var ee=(I-(1+2*_+w)*I*I*I/6+(5-2*w+28*_-3*w*w+8*d+24*_*_)*I*I*I*I*I/120)/Math.cos(O);ee=P+t3(ee);var te;if(n.accuracy){var ce=WA({northing:n.northing+n.accuracy,easting:n.easting+n.accuracy,zoneLetter:n.zoneLetter,zoneNumber:n.zoneNumber});te={top:ce.lat,right:ce.lon,bottom:Y,left:ee}}else te={lat:Y,lon:ee};return te}function kq(n){var e="Z";return 84>=n&&n>=72?e="X":72>n&&n>=64?e="W":64>n&&n>=56?e="V":56>n&&n>=48?e="U":48>n&&n>=40?e="T":40>n&&n>=32?e="S":32>n&&n>=24?e="R":24>n&&n>=16?e="Q":16>n&&n>=8?e="P":8>n&&n>=0?e="N":0>n&&n>=-8?e="M":-8>n&&n>=-16?e="L":-16>n&&n>=-24?e="K":-24>n&&n>=-32?e="J":-32>n&&n>=-40?e="H":-40>n&&n>=-48?e="G":-48>n&&n>=-56?e="F":-56>n&&n>=-64?e="E":-64>n&&n>=-72?e="D":-72>n&&n>=-80&&(e="C"),e}function Fq(n,e){var t="00000"+n.easting,i="00000"+n.northing;return n.zoneNumber+n.zoneLetter+Oq(n.easting,n.northing,n.zoneNumber)+t.substr(t.length-5,e)+i.substr(i.length-5,e)}function Oq(n,e,t){var i=rU(t),r=Math.floor(n/1e5),s=Math.floor(e/1e5)%20;return Nq(r,s,i)}function rU(n){var e=n%e3;return e===0&&(e=e3),e}function Nq(n,e,t){var i=t-1,r=eU.charCodeAt(i),s=tU.charCodeAt(i),a=r+n-1,o=s+e,d=!1;a>sy&&(a=a-sy+Mm-1,d=!0),(a===Yo||r<Yo&&a>Yo||(a>Yo||r<Yo)&&d)&&a++,(a===Ya||r<Ya&&a>Ya||(a>Ya||r<Ya)&&d)&&(a++,a===Yo&&a++),a>sy&&(a=a-sy+Mm-1),o>ry?(o=o-ry+Mm-1,d=!0):d=!1,(o===Yo||s<Yo&&o>Yo||(o>Yo||s<Yo)&&d)&&o++,(o===Ya||s<Ya&&o>Ya||(o>Ya||s<Ya)&&d)&&(o++,o===Yo&&o++),o>ry&&(o=o-ry+Mm-1);var p=String.fromCharCode(a)+String.fromCharCode(o);return p}function sU(n){if(n&&n.length===0)throw"MGRSPoint coverting from nothing";for(var e=n.length,t=null,i="",r,s=0;!/[A-Z]/.test(r=n.charAt(s));){if(s>=2)throw"MGRSPoint bad conversion from: "+n;i+=r,s++}var a=parseInt(i,10);if(s===0||s+3>e)throw"MGRSPoint bad conversion from: "+n;var o=n.charAt(s++);if(o<="A"||o==="B"||o==="Y"||o>="Z"||o==="I"||o==="O")throw"MGRSPoint zone letter "+o+" not handled: "+n;t=n.substring(s,s+=2);for(var d=rU(a),p=zq(t.charAt(0),d),g=Bq(t.charAt(1),d);g<Uq(o);)g+=2e6;var _=e-s;if(_%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+n;var w=_/2,T=0,I=0,L,P,C,O,z;return w>0&&(L=1e5/Math.pow(10,w),P=n.substring(s,s+w),T=parseFloat(P)*L,C=n.substring(s+w),I=parseFloat(C)*L),O=T+p,z=I+g,{easting:O,northing:z,zoneLetter:o,zoneNumber:a,accuracy:L}}function zq(n,e){for(var t=eU.charCodeAt(e-1),i=1e5,r=!1;t!==n.charCodeAt(0);){if(t++,t===Yo&&t++,t===Ya&&t++,t>sy){if(r)throw"Bad character: "+n;t=Mm,r=!0}i+=1e5}return i}function Bq(n,e){if(n>"V")throw"MGRSPoint given invalid Northing "+n;for(var t=tU.charCodeAt(e-1),i=0,r=!1;t!==n.charCodeAt(0);){if(t++,t===Yo&&t++,t===Ya&&t++,t>ry){if(r)throw"Bad character: "+n;t=Mm,r=!0}i+=1e5}return i}function Uq(n){var e;switch(n){case"C":e=11e5;break;case"D":e=2e6;break;case"E":e=28e5;break;case"F":e=37e5;break;case"G":e=46e5;break;case"H":e=55e5;break;case"J":e=64e5;break;case"K":e=73e5;break;case"L":e=82e5;break;case"M":e=91e5;break;case"N":e=0;break;case"P":e=8e5;break;case"Q":e=17e5;break;case"R":e=26e5;break;case"S":e=35e5;break;case"T":e=44e5;break;case"U":e=53e5;break;case"V":e=62e5;break;case"W":e=7e6;break;case"X":e=79e5;break;default:e=-1}if(e>=0)return e;throw"Invalid zone letter: "+n}function sg(n,e,t){if(!(this instanceof sg))return new sg(n,e,t);if(Array.isArray(n))this.x=n[0],this.y=n[1],this.z=n[2]||0;else if(typeof n=="object")this.x=n.x,this.y=n.y,this.z=n.z||0;else if(typeof n=="string"&&typeof e>"u"){var i=n.split(",");this.x=parseFloat(i[0],10),this.y=parseFloat(i[1],10),this.z=parseFloat(i[2],10)||0}else this.x=n,this.y=e,this.z=t||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}sg.fromMGRS=function(n){return new sg(iU(n))};sg.prototype.toMGRS=function(n){return nU([this.x,this.y],n)};var Vq=1,Gq=.25,n3=.046875,i3=.01953125,r3=.01068115234375,Hq=.75,Wq=.46875,jq=.013020833333333334,$q=.007120768229166667,qq=.3645833333333333,Xq=.005696614583333333,Zq=.3076171875;function oU(n){var e=[];e[0]=Vq-n*(Gq+n*(n3+n*(i3+n*r3))),e[1]=n*(Hq-n*(n3+n*(i3+n*r3)));var t=n*n;return e[2]=t*(Wq-n*(jq+n*$q)),t*=n,e[3]=t*(qq-n*Xq),e[4]=t*n*Zq,e}function Ab(n,e,t,i){return t*=e,e*=e,i[0]*n-t*(i[1]+e*(i[2]+e*(i[3]+e*i[4])))}var Yq=20;function aU(n,e,t){for(var i=1/(1-e),r=n,s=Yq;s;--s){var a=Math.sin(r),o=1-e*a*a;if(o=(Ab(r,a,Math.cos(r),t)-n)*(o*Math.sqrt(o))*i,r-=o,Math.abs(o)<_n)return r}return r}function Kq(){this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.es&&(this.en=oU(this.es),this.ml0=Ab(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))}function Jq(n){var e=n.x,t=n.y,i=En(e-this.long0),r,s,a,o=Math.sin(t),d=Math.cos(t);if(this.es){var g=d*i,_=Math.pow(g,2),w=this.ep2*Math.pow(d,2),T=Math.pow(w,2),I=Math.abs(d)>_n?Math.tan(t):0,L=Math.pow(I,2),P=Math.pow(L,2);r=1-this.es*Math.pow(o,2),g=g/Math.sqrt(r);var C=Ab(t,o,d,this.en);s=this.a*(this.k0*g*(1+_/6*(1-L+w+_/20*(5-18*L+P+14*w-58*L*w+_/42*(61+179*P-P*L-479*L)))))+this.x0,a=this.a*(this.k0*(C-this.ml0+o*i*g/2*(1+_/12*(5-L+9*w+4*T+_/30*(61+P-58*L+270*w-330*L*w+_/56*(1385+543*P-P*L-3111*L))))))+this.y0}else{var p=d*Math.sin(i);if(Math.abs(Math.abs(p)-1)<_n)return 93;if(s=.5*this.a*this.k0*Math.log((1+p)/(1-p))+this.x0,a=d*Math.cos(i)/Math.sqrt(1-Math.pow(p,2)),p=Math.abs(a),p>=1){if(p-1>_n)return 93;a=0}else a=Math.acos(a);t<0&&(a=-a),a=this.a*this.k0*(a-this.lat0)+this.y0}return n.x=s,n.y=a,n}function Qq(n){var e,t,i,r,s=(n.x-this.x0)*(1/this.a),a=(n.y-this.y0)*(1/this.a);if(this.es)if(e=this.ml0+a/this.k0,t=aU(e,this.es,this.en),Math.abs(t)<Bt){var _=Math.sin(t),w=Math.cos(t),T=Math.abs(w)>_n?Math.tan(t):0,I=this.ep2*Math.pow(w,2),L=Math.pow(I,2),P=Math.pow(T,2),C=Math.pow(P,2);e=1-this.es*Math.pow(_,2);var O=s*Math.sqrt(e)/this.k0,z=Math.pow(O,2);e=e*T,i=t-e*z/(1-this.es)*.5*(1-z/12*(5+3*P-9*I*P+I-4*L-z/30*(61+90*P-252*I*P+45*C+46*I-z/56*(1385+3633*P+4095*C+1574*C*P)))),r=En(this.long0+O*(1-z/6*(1+2*P+I-z/20*(5+28*P+24*C+8*I*P+6*I-z/42*(61+662*P+1320*C+720*C*P))))/w)}else i=Bt*U0(a),r=0;else{var o=Math.exp(s/this.k0),d=.5*(o-1/o),p=this.lat0+a/this.k0,g=Math.cos(p);e=Math.sqrt((1-Math.pow(g,2))/(1+Math.pow(d,2))),i=Math.asin(e),a<0&&(i=-i),d===0&&g===0?r=0:r=En(Math.atan2(d,g)+this.long0)}return n.x=r,n.y=i,n}var eX=["Fast_Transverse_Mercator","Fast Transverse Mercator"];const a1={init:Kq,forward:Jq,inverse:Qq,names:eX};function lU(n){var e=Math.exp(n);return e=(e-1/e)/2,e}function il(n,e){n=Math.abs(n),e=Math.abs(e);var t=Math.max(n,e),i=Math.min(n,e)/(t||1);return t*Math.sqrt(1+Math.pow(i,2))}function tX(n){var e=1+n,t=e-1;return t===0?n:n*Math.log(e)/t}function nX(n){var e=Math.abs(n);return e=tX(e*(1+e/(il(1,e)+1))),n<0?-e:e}function jA(n,e){for(var t=2*Math.cos(2*e),i=n.length-1,r=n[i],s=0,a;--i>=0;)a=-s+t*r+n[i],s=r,r=a;return e+a*Math.sin(2*e)}function iX(n,e){for(var t=2*Math.cos(e),i=n.length-1,r=n[i],s=0,a;--i>=0;)a=-s+t*r+n[i],s=r,r=a;return Math.sin(e)*a}function rX(n){var e=Math.exp(n);return e=(e+1/e)/2,e}function cU(n,e,t){for(var i=Math.sin(e),r=Math.cos(e),s=lU(t),a=rX(t),o=2*r*a,d=-2*i*s,p=n.length-1,g=n[p],_=0,w=0,T=0,I,L;--p>=0;)I=w,L=_,w=g,_=T,g=-I+o*w-d*_+n[p],T=-L+d*w+o*_;return o=i*a,d=r*s,[o*g-d*T,o*T+d*g]}function sX(){if(!this.approx&&(isNaN(this.es)||this.es<=0))throw new Error('Incorrect elliptical usage. Try using the +approx option in the proj string, or PROJECTION["Fast_Transverse_Mercator"] in the WKT.');this.approx&&(a1.init.apply(this),this.forward=a1.forward,this.inverse=a1.inverse),this.x0=this.x0!==void 0?this.x0:0,this.y0=this.y0!==void 0?this.y0:0,this.long0=this.long0!==void 0?this.long0:0,this.lat0=this.lat0!==void 0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var n=this.es/(1+Math.sqrt(1-this.es)),e=n/(2-n),t=e;this.cgb[0]=e*(2+e*(-2/3+e*(-2+e*(116/45+e*(26/45+e*(-2854/675)))))),this.cbg[0]=e*(-2+e*(2/3+e*(4/3+e*(-82/45+e*(32/45+e*(4642/4725)))))),t=t*e,this.cgb[1]=t*(7/3+e*(-8/5+e*(-227/45+e*(2704/315+e*(2323/945))))),this.cbg[1]=t*(5/3+e*(-16/15+e*(-13/9+e*(904/315+e*(-1522/945))))),t=t*e,this.cgb[2]=t*(56/15+e*(-136/35+e*(-1262/105+e*(73814/2835)))),this.cbg[2]=t*(-26/15+e*(34/21+e*(8/5+e*(-12686/2835)))),t=t*e,this.cgb[3]=t*(4279/630+e*(-332/35+e*(-399572/14175))),this.cbg[3]=t*(1237/630+e*(-12/5+e*(-24832/14175))),t=t*e,this.cgb[4]=t*(4174/315+e*(-144838/6237)),this.cbg[4]=t*(-734/315+e*(109598/31185)),t=t*e,this.cgb[5]=t*(601676/22275),this.cbg[5]=t*(444337/155925),t=Math.pow(e,2),this.Qn=this.k0/(1+e)*(1+t*(1/4+t*(1/64+t/256))),this.utg[0]=e*(-.5+e*(2/3+e*(-37/96+e*(1/360+e*(81/512+e*(-96199/604800)))))),this.gtu[0]=e*(.5+e*(-2/3+e*(5/16+e*(41/180+e*(-127/288+e*(7891/37800)))))),this.utg[1]=t*(-1/48+e*(-1/15+e*(437/1440+e*(-46/105+e*(1118711/3870720))))),this.gtu[1]=t*(13/48+e*(-3/5+e*(557/1440+e*(281/630+e*(-1983433/1935360))))),t=t*e,this.utg[2]=t*(-17/480+e*(37/840+e*(209/4480+e*(-5569/90720)))),this.gtu[2]=t*(61/240+e*(-103/140+e*(15061/26880+e*(167603/181440)))),t=t*e,this.utg[3]=t*(-4397/161280+e*(11/504+e*(830251/7257600))),this.gtu[3]=t*(49561/161280+e*(-179/168+e*(6601661/7257600))),t=t*e,this.utg[4]=t*(-4583/161280+e*(108847/3991680)),this.gtu[4]=t*(34729/80640+e*(-3418889/1995840)),t=t*e,this.utg[5]=t*(-20648693/638668800),this.gtu[5]=t*(212378941/319334400);var i=jA(this.cbg,this.lat0);this.Zb=-this.Qn*(i+iX(this.gtu,2*i))}function oX(n){var e=En(n.x-this.long0),t=n.y;t=jA(this.cbg,t);var i=Math.sin(t),r=Math.cos(t),s=Math.sin(e),a=Math.cos(e);t=Math.atan2(i,a*r),e=Math.atan2(s*r,il(i,r*a)),e=nX(Math.tan(e));var o=cU(this.gtu,2*t,2*e);t=t+o[0],e=e+o[1];var d,p;return Math.abs(e)<=2.623395162778?(d=this.a*(this.Qn*e)+this.x0,p=this.a*(this.Qn*t+this.Zb)+this.y0):(d=1/0,p=1/0),n.x=d,n.y=p,n}function aX(n){var e=(n.x-this.x0)*(1/this.a),t=(n.y-this.y0)*(1/this.a);t=(t-this.Zb)/this.Qn,e=e/this.Qn;var i,r;if(Math.abs(e)<=2.623395162778){var s=cU(this.utg,2*t,2*e);t=t+s[0],e=e+s[1],e=Math.atan(lU(e));var a=Math.sin(t),o=Math.cos(t),d=Math.sin(e),p=Math.cos(e);t=Math.atan2(a*p,il(d,p*o)),e=Math.atan2(d,p*o),i=En(e+this.long0),r=jA(this.cgb,t)}else i=1/0,r=1/0;return n.x=i,n.y=r,n}var lX=["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc","Transverse_Mercator","Transverse Mercator","Gauss Kruger","Gauss_Kruger","tmerc"];const l1={init:sX,forward:oX,inverse:aX,names:lX};function cX(n,e){if(n===void 0){if(n=Math.floor((En(e)+Math.PI)*30/Math.PI)+1,n<0)return 0;if(n>60)return 60}return n}var uX="etmerc";function hX(){var n=cX(this.zone,this.long0);if(n===void 0)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(n)-183)*Hs,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,l1.init.apply(this),this.forward=l1.forward,this.inverse=l1.inverse}var dX=["Universal Transverse Mercator System","utm"];const fX={init:hX,names:dX,dependsOn:uX};function $A(n,e){return Math.pow((1-n)/(1+n),e)}var pX=20;function mX(){var n=Math.sin(this.lat0),e=Math.cos(this.lat0);e*=e,this.rc=Math.sqrt(1-this.es)/(1-this.es*n*n),this.C=Math.sqrt(1+this.es*e*e/(1-this.es)),this.phic0=Math.asin(n/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ji)/(Math.pow(Math.tan(.5*this.lat0+Ji),this.C)*$A(this.e*n,this.ratexp))}function gX(n){var e=n.x,t=n.y;return n.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*t+Ji),this.C)*$A(this.e*Math.sin(t),this.ratexp))-Bt,n.x=this.C*e,n}function _X(n){for(var e=1e-14,t=n.x/this.C,i=n.y,r=Math.pow(Math.tan(.5*i+Ji)/this.K,1/this.C),s=pX;s>0&&(i=2*Math.atan(r*$A(this.e*Math.sin(n.y),-.5*this.e))-Bt,!(Math.abs(i-n.y)<e));--s)n.y=i;return s?(n.x=t,n.y=i,n):null}var yX=["gauss"];const qA={init:mX,forward:gX,inverse:_X,names:yX};function vX(){qA.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))}function xX(n){var e,t,i,r;return n.x=En(n.x-this.long0),qA.forward.apply(this,[n]),e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r=this.k0*this.R2/(1+this.sinc0*e+this.cosc0*t*i),n.x=r*t*Math.sin(n.x),n.y=r*(this.cosc0*e-this.sinc0*t*i),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function wX(n){var e,t,i,r,s;if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,s=il(n.x,n.y)){var a=2*Math.atan2(s,this.R2);e=Math.sin(a),t=Math.cos(a),r=Math.asin(t*this.sinc0+n.y*e*this.cosc0/s),i=Math.atan2(n.x*e,s*this.cosc0*t-n.y*this.sinc0*e)}else r=this.phic0,i=0;return n.x=i,n.y=r,qA.inverse.apply(this,[n]),n.x=En(n.x+this.long0),n}var bX=["Stereographic_North_Pole","Oblique_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"];const SX={init:vX,forward:xX,inverse:wX,names:bX};function MX(n,e,t){return e*=t,Math.tan(.5*(Bt+n))*Math.pow((1-e)/(1+e),.5*t)}function EX(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=_n&&(this.k0=.5*(1+U0(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=_n&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),this.k0===1&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=_n&&Math.abs(Math.cos(this.lat_ts))>_n&&(this.k0=.5*this.cons*Nc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/Nl(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=Nc(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Bt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))}function TX(n){var e=n.x,t=n.y,i=Math.sin(t),r=Math.cos(t),s,a,o,d,p,g,_=En(e-this.long0);return Math.abs(Math.abs(e-this.long0)-Math.PI)<=_n&&Math.abs(t+this.lat0)<=_n?(n.x=NaN,n.y=NaN,n):this.sphere?(s=2*this.k0/(1+this.sinlat0*i+this.coslat0*r*Math.cos(_)),n.x=this.a*s*r*Math.sin(_)+this.x0,n.y=this.a*s*(this.coslat0*i-this.sinlat0*r*Math.cos(_))+this.y0,n):(a=2*Math.atan(this.ssfn_(t,i,this.e))-Bt,d=Math.cos(a),o=Math.sin(a),Math.abs(this.coslat0)<=_n?(p=Nl(this.e,t*this.con,this.con*i),g=2*this.a*this.k0*p/this.cons,n.x=this.x0+g*Math.sin(e-this.long0),n.y=this.y0-this.con*g*Math.cos(e-this.long0),n):(Math.abs(this.sinlat0)<_n?(s=2*this.a*this.k0/(1+d*Math.cos(_)),n.y=s*o):(s=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*o+this.cosX0*d*Math.cos(_))),n.y=s*(this.cosX0*o-this.sinX0*d*Math.cos(_))+this.y0),n.x=s*d*Math.sin(_)+this.x0,n))}function CX(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,s,a=Math.sqrt(n.x*n.x+n.y*n.y);if(this.sphere){var o=2*Math.atan(a/(2*this.a*this.k0));return e=this.long0,t=this.lat0,a<=_n?(n.x=e,n.y=t,n):(t=Math.asin(Math.cos(o)*this.sinlat0+n.y*Math.sin(o)*this.coslat0/a),Math.abs(this.coslat0)<_n?this.lat0>0?e=En(this.long0+Math.atan2(n.x,-1*n.y)):e=En(this.long0+Math.atan2(n.x,n.y)):e=En(this.long0+Math.atan2(n.x*Math.sin(o),a*this.coslat0*Math.cos(o)-n.y*this.sinlat0*Math.sin(o))),n.x=e,n.y=t,n)}else if(Math.abs(this.coslat0)<=_n){if(a<=_n)return t=this.lat0,e=this.long0,n.x=e,n.y=t,n;n.x*=this.con,n.y*=this.con,i=a*this.cons/(2*this.a*this.k0),t=this.con*y0(this.e,i),e=this.con*En(this.con*this.long0+Math.atan2(n.x,-1*n.y))}else r=2*Math.atan(a*this.cosX0/(2*this.a*this.k0*this.ms1)),e=this.long0,a<=_n?s=this.X0:(s=Math.asin(Math.cos(r)*this.sinX0+n.y*Math.sin(r)*this.cosX0/a),e=En(this.long0+Math.atan2(n.x*Math.sin(r),a*this.cosX0*Math.cos(r)-n.y*this.sinX0*Math.sin(r)))),t=-1*y0(this.e,Math.tan(.5*(Bt+s)));return n.x=e,n.y=t,n}var AX=["stere","Stereographic_South_Pole","Polar Stereographic (variant B)","Polar_Stereographic"];const IX={init:EX,forward:TX,inverse:CX,names:AX,ssfn_:MX};function PX(){var n=this.lat0;this.lambda0=this.long0;var e=Math.sin(n),t=this.a,i=this.rf,r=1/i,s=2*r-Math.pow(r,2),a=this.e=Math.sqrt(s);this.R=this.k0*t*Math.sqrt(1-s)/(1-s*Math.pow(e,2)),this.alpha=Math.sqrt(1+s/(1-s)*Math.pow(Math.cos(n),4)),this.b0=Math.asin(e/this.alpha);var o=Math.log(Math.tan(Math.PI/4+this.b0/2)),d=Math.log(Math.tan(Math.PI/4+n/2)),p=Math.log((1+a*e)/(1-a*e));this.K=o-this.alpha*d+this.alpha*a/2*p}function RX(n){var e=Math.log(Math.tan(Math.PI/4-n.y/2)),t=this.e/2*Math.log((1+this.e*Math.sin(n.y))/(1-this.e*Math.sin(n.y))),i=-this.alpha*(e+t)+this.K,r=2*(Math.atan(Math.exp(i))-Math.PI/4),s=this.alpha*(n.x-this.lambda0),a=Math.atan(Math.sin(s)/(Math.sin(this.b0)*Math.tan(r)+Math.cos(this.b0)*Math.cos(s))),o=Math.asin(Math.cos(this.b0)*Math.sin(r)-Math.sin(this.b0)*Math.cos(r)*Math.cos(s));return n.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0,n.x=this.R*a+this.x0,n}function LX(n){for(var e=n.x-this.x0,t=n.y-this.y0,i=e/this.R,r=2*(Math.atan(Math.exp(t/this.R))-Math.PI/4),s=Math.asin(Math.cos(this.b0)*Math.sin(r)+Math.sin(this.b0)*Math.cos(r)*Math.cos(i)),a=Math.atan(Math.sin(i)/(Math.cos(this.b0)*Math.cos(i)-Math.sin(this.b0)*Math.tan(r))),o=this.lambda0+a/this.alpha,d=0,p=s,g=-1e3,_=0;Math.abs(p-g)>1e-7;){if(++_>20)return;d=1/this.alpha*(Math.log(Math.tan(Math.PI/4+s/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(p))/2)),g=p,p=2*Math.atan(Math.exp(d))-Math.PI/2}return n.x=o,n.y=p,n}var DX=["somerc"];const kX={init:PX,forward:RX,inverse:LX,names:DX};var im=1e-7;function FX(n){var e=["Hotine_Oblique_Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin"],t=typeof n.PROJECTION=="object"?Object.keys(n.PROJECTION)[0]:n.PROJECTION;return"no_uoff"in n||"no_off"in n||e.indexOf(t)!==-1}function OX(){var n,e,t,i,r,s,a,o,d,p,g=0,_,w=0,T=0,I=0,L=0,P=0,C=0;this.no_off=FX(this),this.no_rot="no_rot"in this;var O=!1;"alpha"in this&&(O=!0);var z=!1;if("rectified_grid_angle"in this&&(z=!0),O&&(C=this.alpha),z&&(g=this.rectified_grid_angle*Hs),O||z)w=this.longc;else if(T=this.long1,L=this.lat1,I=this.long2,P=this.lat2,Math.abs(L-P)<=im||(n=Math.abs(L))<=im||Math.abs(n-Bt)<=im||Math.abs(Math.abs(this.lat0)-Bt)<=im||Math.abs(Math.abs(P)-Bt)<=im)throw new Error;var H=1-this.es;e=Math.sqrt(H),Math.abs(this.lat0)>_n?(o=Math.sin(this.lat0),t=Math.cos(this.lat0),n=1-this.es*o*o,this.B=t*t,this.B=Math.sqrt(1+this.es*this.B*this.B/H),this.A=this.B*this.k0*e/n,i=this.B*e/(t*Math.sqrt(n)),r=i*i-1,r<=0?r=0:(r=Math.sqrt(r),this.lat0<0&&(r=-r)),this.E=r+=i,this.E*=Math.pow(Nl(this.e,this.lat0,o),this.B)):(this.B=1/e,this.A=this.k0,this.E=i=r=1),O||z?(O?(_=Math.asin(Math.sin(C)/i),z||(g=C)):(_=g,C=Math.asin(i*Math.sin(_))),this.lam0=w-Math.asin(.5*(r-1/r)*Math.tan(_))/this.B):(s=Math.pow(Nl(this.e,L,Math.sin(L)),this.B),a=Math.pow(Nl(this.e,P,Math.sin(P)),this.B),r=this.E/s,d=(a-s)/(a+s),p=this.E*this.E,p=(p-a*s)/(p+a*s),n=T-I,n<-Math.pi?I-=g0:n>Math.pi&&(I+=g0),this.lam0=En(.5*(T+I)-Math.atan(p*Math.tan(.5*this.B*(T-I))/d)/this.B),_=Math.atan(2*Math.sin(this.B*En(T-this.lam0))/(r-1/r)),g=C=Math.asin(i*Math.sin(_))),this.singam=Math.sin(_),this.cosgam=Math.cos(_),this.sinrot=Math.sin(g),this.cosrot=Math.cos(g),this.rB=1/this.B,this.ArB=this.A*this.rB,this.BrA=1/this.ArB,this.A*this.B,this.no_off?this.u_0=0:(this.u_0=Math.abs(this.ArB*Math.atan(Math.sqrt(i*i-1)/Math.cos(C))),this.lat0<0&&(this.u_0=-this.u_0)),r=.5*_,this.v_pole_n=this.ArB*Math.log(Math.tan(Ji-r)),this.v_pole_s=this.ArB*Math.log(Math.tan(Ji+r))}function NX(n){var e={},t,i,r,s,a,o,d,p;if(n.x=n.x-this.lam0,Math.abs(Math.abs(n.y)-Bt)>_n){if(a=this.E/Math.pow(Nl(this.e,n.y,Math.sin(n.y)),this.B),o=1/a,t=.5*(a-o),i=.5*(a+o),s=Math.sin(this.B*n.x),r=(t*this.singam-s*this.cosgam)/i,Math.abs(Math.abs(r)-1)<_n)throw new Error;p=.5*this.ArB*Math.log((1-r)/(1+r)),o=Math.cos(this.B*n.x),Math.abs(o)<im?d=this.A*n.x:d=this.ArB*Math.atan2(t*this.cosgam+s*this.singam,o)}else p=n.y>0?this.v_pole_n:this.v_pole_s,d=this.ArB*n.y;return this.no_rot?(e.x=d,e.y=p):(d-=this.u_0,e.x=p*this.cosrot+d*this.sinrot,e.y=d*this.cosrot-p*this.sinrot),e.x=this.a*e.x+this.x0,e.y=this.a*e.y+this.y0,e}function zX(n){var e,t,i,r,s,a,o,d={};if(n.x=(n.x-this.x0)*(1/this.a),n.y=(n.y-this.y0)*(1/this.a),this.no_rot?(t=n.y,e=n.x):(t=n.x*this.cosrot-n.y*this.sinrot,e=n.y*this.cosrot+n.x*this.sinrot+this.u_0),i=Math.exp(-this.BrA*t),r=.5*(i-1/i),s=.5*(i+1/i),a=Math.sin(this.BrA*e),o=(a*this.cosgam+r*this.singam)/s,Math.abs(Math.abs(o)-1)<_n)d.x=0,d.y=o<0?-Bt:Bt;else{if(d.y=this.E/Math.sqrt((1+o)/(1-o)),d.y=y0(this.e,Math.pow(d.y,1/this.B)),d.y===1/0)throw new Error;d.x=-this.rB*Math.atan2(r*this.cosgam-a*this.singam,Math.cos(this.BrA*e))}return d.x+=this.lam0,d}var BX=["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Two_Point_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","Oblique_Mercator","omerc"];const UX={init:OX,forward:NX,inverse:zX,names:BX};function VX(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<_n)){var n=this.b/this.a;this.e=Math.sqrt(1-n*n);var e=Math.sin(this.lat1),t=Math.cos(this.lat1),i=Nc(this.e,e,t),r=Nl(this.e,this.lat1,e),s=Math.sin(this.lat2),a=Math.cos(this.lat2),o=Nc(this.e,s,a),d=Nl(this.e,this.lat2,s),p=Nl(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>_n?this.ns=Math.log(i/o)/Math.log(r/d):this.ns=e,isNaN(this.ns)&&(this.ns=e),this.f0=i/(this.ns*Math.pow(r,this.ns)),this.rh=this.a*this.f0*Math.pow(p,this.ns),this.title||(this.title="Lambert Conformal Conic")}}function GX(n){var e=n.x,t=n.y;Math.abs(2*Math.abs(t)-Math.PI)<=_n&&(t=U0(t)*(Bt-2*_n));var i=Math.abs(Math.abs(t)-Bt),r,s;if(i>_n)r=Nl(this.e,t,Math.sin(t)),s=this.a*this.f0*Math.pow(r,this.ns);else{if(i=t*this.ns,i<=0)return null;s=0}var a=this.ns*En(e-this.long0);return n.x=this.k0*(s*Math.sin(a))+this.x0,n.y=this.k0*(this.rh-s*Math.cos(a))+this.y0,n}function HX(n){var e,t,i,r,s,a=(n.x-this.x0)/this.k0,o=this.rh-(n.y-this.y0)/this.k0;this.ns>0?(e=Math.sqrt(a*a+o*o),t=1):(e=-Math.sqrt(a*a+o*o),t=-1);var d=0;if(e!==0&&(d=Math.atan2(t*a,t*o)),e!==0||this.ns>0){if(t=1/this.ns,i=Math.pow(e/(this.a*this.f0),t),r=y0(this.e,i),r===-9999)return null}else r=-Bt;return s=En(d/this.ns+this.long0),n.x=s,n.y=r,n}var WX=["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_1SP","Lambert_Conformal_Conic_2SP","lcc","Lambert Conic Conformal (1SP)","Lambert Conic Conformal (2SP)"];const jX={init:VX,forward:GX,inverse:HX,names:WX};function $X(){this.a=6377397155e-3,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.7417649320975901-.308341501185665),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq}function qX(n){var e,t,i,r,s,a,o,d=n.x,p=n.y,g=En(d-this.long0);return e=Math.pow((1+this.e*Math.sin(p))/(1-this.e*Math.sin(p)),this.alfa*this.e/2),t=2*(Math.atan(this.k*Math.pow(Math.tan(p/2+this.s45),this.alfa)/e)-this.s45),i=-g*this.alfa,r=Math.asin(Math.cos(this.ad)*Math.sin(t)+Math.sin(this.ad)*Math.cos(t)*Math.cos(i)),s=Math.asin(Math.cos(t)*Math.sin(i)/Math.cos(r)),a=this.n*s,o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(r/2+this.s45),this.n),n.y=o*Math.cos(a)/1,n.x=o*Math.sin(a)/1,this.czech||(n.y*=-1,n.x*=-1),n}function XX(n){var e,t,i,r,s,a,o,d,p=n.x;n.x=n.y,n.y=p,this.czech||(n.y*=-1,n.x*=-1),a=Math.sqrt(n.x*n.x+n.y*n.y),s=Math.atan2(n.y,n.x),r=s/Math.sin(this.s0),i=2*(Math.atan(Math.pow(this.ro0/a,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),e=Math.asin(Math.cos(this.ad)*Math.sin(i)-Math.sin(this.ad)*Math.cos(i)*Math.cos(r)),t=Math.asin(Math.cos(i)*Math.sin(r)/Math.cos(e)),n.x=this.long0-t/this.alfa,o=e,d=0;var g=0;do n.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(e/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45),Math.abs(o-n.y)<1e-10&&(d=1),o=n.y,g+=1;while(d===0&&g<15);return g>=15?null:n}var ZX=["Krovak","krovak"];const YX={init:$X,forward:qX,inverse:XX,names:ZX};function zo(n,e,t,i,r){return n*r-e*Math.sin(2*r)+t*Math.sin(4*r)-i*Math.sin(6*r)}function V0(n){return 1-.25*n*(1+n/16*(3+1.25*n))}function G0(n){return .375*n*(1+.25*n*(1+.46875*n))}function H0(n){return .05859375*n*n*(1+.75*n)}function W0(n){return n*n*n*(35/3072)}function og(n,e,t){var i=e*t;return n/Math.sqrt(1-i*i)}function Rg(n){return Math.abs(n)<Bt?n:n-U0(n)*Math.PI}function _w(n,e,t,i,r){var s,a;s=n/e;for(var o=0;o<15;o++)if(a=(n-(e*s-t*Math.sin(2*s)+i*Math.sin(4*s)-r*Math.sin(6*s)))/(e-2*t*Math.cos(2*s)+4*i*Math.cos(4*s)-6*r*Math.cos(6*s)),s+=a,Math.abs(a)<=1e-10)return s;return NaN}function KX(){this.sphere||(this.e0=V0(this.es),this.e1=G0(this.es),this.e2=H0(this.es),this.e3=W0(this.es),this.ml0=this.a*zo(this.e0,this.e1,this.e2,this.e3,this.lat0))}function JX(n){var e,t,i=n.x,r=n.y;if(i=En(i-this.long0),this.sphere)e=this.a*Math.asin(Math.cos(r)*Math.sin(i)),t=this.a*(Math.atan2(Math.tan(r),Math.cos(i))-this.lat0);else{var s=Math.sin(r),a=Math.cos(r),o=og(this.a,this.e,s),d=Math.tan(r)*Math.tan(r),p=i*Math.cos(r),g=p*p,_=this.es*a*a/(1-this.es),w=this.a*zo(this.e0,this.e1,this.e2,this.e3,r);e=o*p*(1-g*d*(1/6-(8-d+8*_)*g/120)),t=w-this.ml0+o*s/a*g*(.5+(5-d+6*_)*g/24)}return n.x=e+this.x0,n.y=t+this.y0,n}function QX(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r;if(this.sphere){var s=t+this.lat0;i=Math.asin(Math.sin(s)*Math.cos(e)),r=Math.atan2(Math.tan(e),Math.cos(s))}else{var a=this.ml0/this.a+t,o=_w(a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(o)-Bt)<=_n)return n.x=this.long0,n.y=Bt,t<0&&(n.y*=-1),n;var d=og(this.a,this.e,Math.sin(o)),p=d*d*d/this.a/this.a*(1-this.es),g=Math.pow(Math.tan(o),2),_=e*this.a/d,w=_*_;i=o-d*Math.tan(o)/p*_*_*(.5-(1+3*g)*_*_/24),r=_*(1-w*(g/3+(1+3*g)*g*w/15))/Math.cos(o)}return n.x=En(r+this.long0),n.y=Rg(i),n}var eZ=["Cassini","Cassini_Soldner","cass"];const tZ={init:KX,forward:JX,inverse:QX,names:eZ};function gd(n,e){var t;return n>1e-7?(t=n*e,(1-n*n)*(e/(1-t*t)-.5/n*Math.log((1-t)/(1+t)))):2*e}var nZ=1,iZ=2,rZ=3,sZ=4;function oZ(){var n=Math.abs(this.lat0);if(Math.abs(n-Bt)<_n?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(n)<_n?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0){var e;switch(this.qp=gd(this.e,1),this.mmf=.5/(1-this.es),this.apa=mZ(this.es),this.mode){case this.N_POLE:this.dd=1;break;case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),e=Math.sin(this.lat0),this.sinb1=gd(this.e,e)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*e*e)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd;break}}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))}function aZ(n){var e,t,i,r,s,a,o,d,p,g,_=n.x,w=n.y;if(_=En(_-this.long0),this.sphere){if(s=Math.sin(w),g=Math.cos(w),i=Math.cos(_),this.mode===this.OBLIQ||this.mode===this.EQUIT){if(t=this.mode===this.EQUIT?1+g*i:1+this.sinph0*s+this.cosph0*g*i,t<=_n)return null;t=Math.sqrt(2/t),e=t*g*Math.sin(_),t*=this.mode===this.EQUIT?s:this.cosph0*s-this.sinph0*g*i}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(i=-i),Math.abs(w+this.lat0)<_n)return null;t=Ji-w*.5,t=2*(this.mode===this.S_POLE?Math.cos(t):Math.sin(t)),e=t*Math.sin(_),t*=i}}else{switch(o=0,d=0,p=0,i=Math.cos(_),r=Math.sin(_),s=Math.sin(w),a=gd(this.e,s),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(o=a/this.qp,d=Math.sqrt(1-o*o)),this.mode){case this.OBLIQ:p=1+this.sinb1*o+this.cosb1*d*i;break;case this.EQUIT:p=1+d*i;break;case this.N_POLE:p=Bt+w,a=this.qp-a;break;case this.S_POLE:p=w-Bt,a=this.qp+a;break}if(Math.abs(p)<_n)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:p=Math.sqrt(2/p),this.mode===this.OBLIQ?t=this.ymf*p*(this.cosb1*o-this.sinb1*d*i):t=(p=Math.sqrt(2/(1+d*i)))*o*this.ymf,e=this.xmf*p*d*r;break;case this.N_POLE:case this.S_POLE:a>=0?(e=(p=Math.sqrt(a))*r,t=i*(this.mode===this.S_POLE?p:-p)):e=t=0;break}}return n.x=this.a*e+this.x0,n.y=this.a*t+this.y0,n}function lZ(n){n.x-=this.x0,n.y-=this.y0;var e=n.x/this.a,t=n.y/this.a,i,r,s,a,o,d,p;if(this.sphere){var g=0,_,w=0;if(_=Math.sqrt(e*e+t*t),r=_*.5,r>1)return null;switch(r=2*Math.asin(r),(this.mode===this.OBLIQ||this.mode===this.EQUIT)&&(w=Math.sin(r),g=Math.cos(r)),this.mode){case this.EQUIT:r=Math.abs(_)<=_n?0:Math.asin(t*w/_),e*=w,t=g*_;break;case this.OBLIQ:r=Math.abs(_)<=_n?this.lat0:Math.asin(g*this.sinph0+t*w*this.cosph0/_),e*=w*this.cosph0,t=(g-Math.sin(r)*this.sinph0)*_;break;case this.N_POLE:t=-t,r=Bt-r;break;case this.S_POLE:r-=Bt;break}i=t===0&&(this.mode===this.EQUIT||this.mode===this.OBLIQ)?0:Math.atan2(e,t)}else{if(p=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(e/=this.dd,t*=this.dd,d=Math.sqrt(e*e+t*t),d<_n)return n.x=this.long0,n.y=this.lat0,n;a=2*Math.asin(.5*d/this.rq),s=Math.cos(a),e*=a=Math.sin(a),this.mode===this.OBLIQ?(p=s*this.sinb1+t*a*this.cosb1/d,o=this.qp*p,t=d*this.cosb1*s-t*this.sinb1*a):(p=t*a/d,o=this.qp*p,t=d*s)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(t=-t),o=e*e+t*t,!o)return n.x=this.long0,n.y=this.lat0,n;p=1-o/this.qp,this.mode===this.S_POLE&&(p=-p)}i=Math.atan2(e,t),r=gZ(Math.asin(p),this.apa)}return n.x=En(this.long0+i),n.y=r,n}var cZ=.3333333333333333,uZ=.17222222222222222,hZ=.10257936507936508,dZ=.06388888888888888,fZ=.0664021164021164,pZ=.016415012942191543;function mZ(n){var e,t=[];return t[0]=n*cZ,e=n*n,t[0]+=e*uZ,t[1]=e*dZ,e*=n,t[0]+=e*hZ,t[1]+=e*fZ,t[2]=e*pZ,t}function gZ(n,e){var t=n+n;return n+e[0]*Math.sin(t)+e[1]*Math.sin(t+t)+e[2]*Math.sin(t+t+t)}var _Z=["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"];const yZ={init:oZ,forward:aZ,inverse:lZ,names:_Z,S_POLE:nZ,N_POLE:iZ,EQUIT:rZ,OBLIQ:sZ};function Sd(n){return Math.abs(n)>1&&(n=n>1?1:-1),Math.asin(n)}function vZ(){Math.abs(this.lat1+this.lat2)<_n||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=Nc(this.e3,this.sin_po,this.cos_po),this.qs1=gd(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=Nc(this.e3,this.sin_po,this.cos_po),this.qs2=gd(this.e3,this.sin_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=gd(this.e3,this.sin_po),Math.abs(this.lat1-this.lat2)>_n?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)}function xZ(n){var e=n.x,t=n.y;this.sin_phi=Math.sin(t),this.cos_phi=Math.cos(t);var i=gd(this.e3,this.sin_phi),r=this.a*Math.sqrt(this.c-this.ns0*i)/this.ns0,s=this.ns0*En(e-this.long0),a=r*Math.sin(s)+this.x0,o=this.rh-r*Math.cos(s)+this.y0;return n.x=a,n.y=o,n}function wZ(n){var e,t,i,r,s,a;return n.x-=this.x0,n.y=this.rh-n.y+this.y0,this.ns0>=0?(e=Math.sqrt(n.x*n.x+n.y*n.y),i=1):(e=-Math.sqrt(n.x*n.x+n.y*n.y),i=-1),r=0,e!==0&&(r=Math.atan2(i*n.x,i*n.y)),i=e*this.ns0/this.a,this.sphere?a=Math.asin((this.c-i*i)/(2*this.ns0)):(t=(this.c-i*i)/this.ns0,a=this.phi1z(this.e3,t)),s=En(r/this.ns0+this.long0),n.x=s,n.y=a,n}function bZ(n,e){var t,i,r,s,a,o=Sd(.5*e);if(n<_n)return o;for(var d=n*n,p=1;p<=25;p++)if(t=Math.sin(o),i=Math.cos(o),r=n*t,s=1-r*r,a=.5*s*s/i*(e/(1-d)-t/s+.5/n*Math.log((1-r)/(1+r))),o=o+a,Math.abs(a)<=1e-7)return o;return null}var SZ=["Albers_Conic_Equal_Area","Albers","aea"];const MZ={init:vZ,forward:xZ,inverse:wZ,names:SZ,phi1z:bZ};function EZ(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1}function TZ(n){var e,t,i,r,s,a,o,d,p=n.x,g=n.y;return i=En(p-this.long0),e=Math.sin(g),t=Math.cos(g),r=Math.cos(i),a=this.sin_p14*e+this.cos_p14*t*r,s=1,a>0||Math.abs(a)<=_n?(o=this.x0+this.a*s*t*Math.sin(i)/a,d=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*r)/a):(o=this.x0+this.infinity_dist*t*Math.sin(i),d=this.y0+this.infinity_dist*(this.cos_p14*e-this.sin_p14*t*r)),n.x=o,n.y=d,n}function CZ(n){var e,t,i,r,s,a;return n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,n.x/=this.k0,n.y/=this.k0,(e=Math.sqrt(n.x*n.x+n.y*n.y))?(r=Math.atan2(e,this.rc),t=Math.sin(r),i=Math.cos(r),a=Sd(i*this.sin_p14+n.y*t*this.cos_p14/e),s=Math.atan2(n.x*t,e*this.cos_p14*i-n.y*this.sin_p14*t),s=En(this.long0+s)):(a=this.phic0,s=0),n.x=s,n.y=a,n}var AZ=["gnom"];const IZ={init:EZ,forward:TZ,inverse:CZ,names:AZ};function PZ(n,e){var t=1-(1-n*n)/(2*n)*Math.log((1-n)/(1+n));if(Math.abs(Math.abs(e)-t)<1e-6)return e<0?-1*Bt:Bt;for(var i=Math.asin(.5*e),r,s,a,o,d=0;d<30;d++)if(s=Math.sin(i),a=Math.cos(i),o=n*s,r=Math.pow(1-o*o,2)/(2*a)*(e/(1-n*n)-s/(1-o*o)+.5/n*Math.log((1-o)/(1+o))),i+=r,Math.abs(r)<=1e-10)return i;return NaN}function RZ(){this.sphere||(this.k0=Nc(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))}function LZ(n){var e=n.x,t=n.y,i,r,s=En(e-this.long0);if(this.sphere)i=this.x0+this.a*s*Math.cos(this.lat_ts),r=this.y0+this.a*Math.sin(t)/Math.cos(this.lat_ts);else{var a=gd(this.e,Math.sin(t));i=this.x0+this.a*this.k0*s,r=this.y0+this.a*a*.5/this.k0}return n.x=i,n.y=r,n}function DZ(n){n.x-=this.x0,n.y-=this.y0;var e,t;return this.sphere?(e=En(this.long0+n.x/this.a/Math.cos(this.lat_ts)),t=Math.asin(n.y/this.a*Math.cos(this.lat_ts))):(t=PZ(this.e,2*n.y*this.k0/this.a),e=En(this.long0+n.x/(this.a*this.k0))),n.x=e,n.y=t,n}var kZ=["cea"];const FZ={init:RZ,forward:LZ,inverse:DZ,names:kZ};function OZ(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)}function NZ(n){var e=n.x,t=n.y,i=En(e-this.long0),r=Rg(t-this.lat0);return n.x=this.x0+this.a*i*this.rc,n.y=this.y0+this.a*r,n}function zZ(n){var e=n.x,t=n.y;return n.x=En(this.long0+(e-this.x0)/(this.a*this.rc)),n.y=Rg(this.lat0+(t-this.y0)/this.a),n}var BZ=["Equirectangular","Equidistant_Cylindrical","eqc"];const UZ={init:OZ,forward:NZ,inverse:zZ,names:BZ};var s3=20;function VZ(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=V0(this.es),this.e1=G0(this.es),this.e2=H0(this.es),this.e3=W0(this.es),this.ml0=this.a*zo(this.e0,this.e1,this.e2,this.e3,this.lat0)}function GZ(n){var e=n.x,t=n.y,i,r,s,a=En(e-this.long0);if(s=a*Math.sin(t),this.sphere)Math.abs(t)<=_n?(i=this.a*a,r=-1*this.a*this.lat0):(i=this.a*Math.sin(s)/Math.tan(t),r=this.a*(Rg(t-this.lat0)+(1-Math.cos(s))/Math.tan(t)));else if(Math.abs(t)<=_n)i=this.a*a,r=-1*this.ml0;else{var o=og(this.a,this.e,Math.sin(t))/Math.tan(t);i=o*Math.sin(s),r=this.a*zo(this.e0,this.e1,this.e2,this.e3,t)-this.ml0+o*(1-Math.cos(s))}return n.x=i+this.x0,n.y=r+this.y0,n}function HZ(n){var e,t,i,r,s,a,o,d,p;if(i=n.x-this.x0,r=n.y-this.y0,this.sphere)if(Math.abs(r+this.a*this.lat0)<=_n)e=En(i/this.a+this.long0),t=0;else{a=this.lat0+r/this.a,o=i*i/this.a/this.a+a*a,d=a;var g;for(s=s3;s;--s)if(g=Math.tan(d),p=-1*(a*(d*g+1)-d-.5*(d*d+o)*g)/((d-a)/g-1),d+=p,Math.abs(p)<=_n){t=d;break}e=En(this.long0+Math.asin(i*Math.tan(d)/this.a)/Math.sin(t))}else if(Math.abs(r+this.ml0)<=_n)t=0,e=En(this.long0+i/this.a);else{a=(this.ml0+r)/this.a,o=i*i/this.a/this.a+a*a,d=a;var _,w,T,I,L;for(s=s3;s;--s)if(L=this.e*Math.sin(d),_=Math.sqrt(1-L*L)*Math.tan(d),w=this.a*zo(this.e0,this.e1,this.e2,this.e3,d),T=this.e0-2*this.e1*Math.cos(2*d)+4*this.e2*Math.cos(4*d)-6*this.e3*Math.cos(6*d),I=w/this.a,p=(a*(_*I+1)-I-.5*_*(I*I+o))/(this.es*Math.sin(2*d)*(I*I+o-2*a*I)/(4*_)+(a-I)*(_*T-2/Math.sin(2*d))-T),d-=p,Math.abs(p)<=_n){t=d;break}_=Math.sqrt(1-this.es*Math.pow(Math.sin(t),2))*Math.tan(t),e=En(this.long0+Math.asin(i*_/this.a)/Math.sin(t))}return n.x=e,n.y=t,n}var WZ=["Polyconic","poly"];const jZ={init:VZ,forward:GZ,inverse:HZ,names:WZ};function $Z(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013}function qZ(n){var e,t=n.x,i=n.y,r=i-this.lat0,s=t-this.long0,a=r/My*1e-5,o=s,d=1,p=0;for(e=1;e<=10;e++)d=d*a,p=p+this.A[e]*d;var g=p,_=o,w=1,T=0,I,L,P=0,C=0;for(e=1;e<=6;e++)I=w*g-T*_,L=T*g+w*_,w=I,T=L,P=P+this.B_re[e]*w-this.B_im[e]*T,C=C+this.B_im[e]*w+this.B_re[e]*T;return n.x=C*this.a+this.x0,n.y=P*this.a+this.y0,n}function XZ(n){var e,t=n.x,i=n.y,r=t-this.x0,s=i-this.y0,a=s/this.a,o=r/this.a,d=1,p=0,g,_,w=0,T=0;for(e=1;e<=6;e++)g=d*a-p*o,_=p*a+d*o,d=g,p=_,w=w+this.C_re[e]*d-this.C_im[e]*p,T=T+this.C_im[e]*d+this.C_re[e]*p;for(var I=0;I<this.iterations;I++){var L=w,P=T,C,O,z=a,H=o;for(e=2;e<=6;e++)C=L*w-P*T,O=P*w+L*T,L=C,P=O,z=z+(e-1)*(this.B_re[e]*L-this.B_im[e]*P),H=H+(e-1)*(this.B_im[e]*L+this.B_re[e]*P);L=1,P=0;var Y=this.B_re[1],ee=this.B_im[1];for(e=2;e<=6;e++)C=L*w-P*T,O=P*w+L*T,L=C,P=O,Y=Y+e*(this.B_re[e]*L-this.B_im[e]*P),ee=ee+e*(this.B_im[e]*L+this.B_re[e]*P);var te=Y*Y+ee*ee;w=(z*Y+H*ee)/te,T=(H*Y-z*ee)/te}var ce=w,K=T,Q=1,pe=0;for(e=1;e<=9;e++)Q=Q*ce,pe=pe+this.D[e]*Q;var ze=this.lat0+pe*My*1e5,Fe=this.long0+K;return n.x=Fe,n.y=ze,n}var ZZ=["New_Zealand_Map_Grid","nzmg"];const YZ={init:$Z,forward:qZ,inverse:XZ,names:ZZ};function KZ(){}function JZ(n){var e=n.x,t=n.y,i=En(e-this.long0),r=this.x0+this.a*i,s=this.y0+this.a*Math.log(Math.tan(Math.PI/4+t/2.5))*1.25;return n.x=r,n.y=s,n}function QZ(n){n.x-=this.x0,n.y-=this.y0;var e=En(this.long0+n.x/this.a),t=2.5*(Math.atan(Math.exp(.8*n.y/this.a))-Math.PI/4);return n.x=e,n.y=t,n}var eY=["Miller_Cylindrical","mill"];const tY={init:KZ,forward:JZ,inverse:QZ,names:eY};var nY=20;function iY(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=oU(this.es)}function rY(n){var e,t,i=n.x,r=n.y;if(i=En(i-this.long0),this.sphere){if(!this.m)r=this.n!==1?Math.asin(this.n*Math.sin(r)):r;else for(var s=this.n*Math.sin(r),a=nY;a;--a){var o=(this.m*r+Math.sin(r)-s)/(this.m+Math.cos(r));if(r-=o,Math.abs(o)<_n)break}e=this.a*this.C_x*i*(this.m+Math.cos(r)),t=this.a*this.C_y*r}else{var d=Math.sin(r),p=Math.cos(r);t=this.a*Ab(r,d,p,this.en),e=this.a*i*p/Math.sqrt(1-this.es*d*d)}return n.x=e,n.y=t,n}function sY(n){var e,t,i,r;return n.x-=this.x0,i=n.x/this.a,n.y-=this.y0,e=n.y/this.a,this.sphere?(e/=this.C_y,i=i/(this.C_x*(this.m+Math.cos(e))),this.m?e=Sd((this.m*e+Math.sin(e))/this.n):this.n!==1&&(e=Sd(Math.sin(e)/this.n)),i=En(i+this.long0),e=Rg(e)):(e=aU(n.y/this.a,this.es,this.en),r=Math.abs(e),r<Bt?(r=Math.sin(e),t=this.long0+n.x*Math.sqrt(1-this.es*r*r)/(this.a*Math.cos(e)),i=En(t)):r-_n<Bt&&(i=this.long0)),n.x=i,n.y=e,n}var oY=["Sinusoidal","sinu"];const aY={init:iY,forward:rY,inverse:sY,names:oY};function lY(){}function cY(n){for(var e=n.x,t=n.y,i=En(e-this.long0),r=t,s=Math.PI*Math.sin(t);;){var a=-(r+Math.sin(r)-s)/(1+Math.cos(r));if(r+=a,Math.abs(a)<_n)break}r/=2,Math.PI/2-Math.abs(t)<_n&&(i=0);var o=.900316316158*this.a*i*Math.cos(r)+this.x0,d=1.4142135623731*this.a*Math.sin(r)+this.y0;return n.x=o,n.y=d,n}function uY(n){var e,t;n.x-=this.x0,n.y-=this.y0,t=n.y/(1.4142135623731*this.a),Math.abs(t)>.999999999999&&(t=.999999999999),e=Math.asin(t);var i=En(this.long0+n.x/(.900316316158*this.a*Math.cos(e)));i<-Math.PI&&(i=-Math.PI),i>Math.PI&&(i=Math.PI),t=(2*e+Math.sin(2*e))/Math.PI,Math.abs(t)>1&&(t=1);var r=Math.asin(t);return n.x=i,n.y=r,n}var hY=["Mollweide","moll"];const dY={init:lY,forward:cY,inverse:uY,names:hY};function fY(){Math.abs(this.lat1+this.lat2)<_n||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=V0(this.es),this.e1=G0(this.es),this.e2=H0(this.es),this.e3=W0(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=Nc(this.e,this.sinphi,this.cosphi),this.ml1=zo(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<_n?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=Nc(this.e,this.sinphi,this.cosphi),this.ml2=zo(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=zo(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))}function pY(n){var e=n.x,t=n.y,i;if(this.sphere)i=this.a*(this.g-t);else{var r=zo(this.e0,this.e1,this.e2,this.e3,t);i=this.a*(this.g-r)}var s=this.ns*En(e-this.long0),a=this.x0+i*Math.sin(s),o=this.y0+this.rh-i*Math.cos(s);return n.x=a,n.y=o,n}function mY(n){n.x-=this.x0,n.y=this.rh-n.y+this.y0;var e,t,i,r;this.ns>=0?(t=Math.sqrt(n.x*n.x+n.y*n.y),e=1):(t=-Math.sqrt(n.x*n.x+n.y*n.y),e=-1);var s=0;if(t!==0&&(s=Math.atan2(e*n.x,e*n.y)),this.sphere)return r=En(this.long0+s/this.ns),i=Rg(this.g-t/this.a),n.x=r,n.y=i,n;var a=this.g-t/this.a;return i=_w(a,this.e0,this.e1,this.e2,this.e3),r=En(this.long0+s/this.ns),n.x=r,n.y=i,n}var gY=["Equidistant_Conic","eqdc"];const _Y={init:fY,forward:pY,inverse:mY,names:gY};function yY(){this.R=this.a}function vY(n){var e=n.x,t=n.y,i=En(e-this.long0),r,s;Math.abs(t)<=_n&&(r=this.x0+this.R*i,s=this.y0);var a=Sd(2*Math.abs(t/Math.PI));(Math.abs(i)<=_n||Math.abs(Math.abs(t)-Bt)<=_n)&&(r=this.x0,t>=0?s=this.y0+Math.PI*this.R*Math.tan(.5*a):s=this.y0+Math.PI*this.R*-Math.tan(.5*a));var o=.5*Math.abs(Math.PI/i-i/Math.PI),d=o*o,p=Math.sin(a),g=Math.cos(a),_=g/(p+g-1),w=_*_,T=_*(2/p-1),I=T*T,L=Math.PI*this.R*(o*(_-I)+Math.sqrt(d*(_-I)*(_-I)-(I+d)*(w-I)))/(I+d);i<0&&(L=-L),r=this.x0+L;var P=d+_;return L=Math.PI*this.R*(T*P-o*Math.sqrt((I+d)*(d+1)-P*P))/(I+d),t>=0?s=this.y0+L:s=this.y0-L,n.x=r,n.y=s,n}function xY(n){var e,t,i,r,s,a,o,d,p,g,_,w,T;return n.x-=this.x0,n.y-=this.y0,_=Math.PI*this.R,i=n.x/_,r=n.y/_,s=i*i+r*r,a=-Math.abs(r)*(1+s),o=a-2*r*r+i*i,d=-2*a+1+2*r*r+s*s,T=r*r/d+(2*o*o*o/d/d/d-9*a*o/d/d)/27,p=(a-o*o/3/d)/d,g=2*Math.sqrt(-p/3),_=3*T/p/g,Math.abs(_)>1&&(_>=0?_=1:_=-1),w=Math.acos(_)/3,n.y>=0?t=(-g*Math.cos(w+Math.PI/3)-o/3/d)*Math.PI:t=-(-g*Math.cos(w+Math.PI/3)-o/3/d)*Math.PI,Math.abs(i)<_n?e=this.long0:e=En(this.long0+Math.PI*(s-1+Math.sqrt(1+2*(i*i-r*r)+s*s))/2/i),n.x=e,n.y=t,n}var wY=["Van_der_Grinten_I","VanDerGrinten","vandg"];const bY={init:yY,forward:vY,inverse:xY,names:wY};function SY(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)}function MY(n){var e=n.x,t=n.y,i=Math.sin(n.y),r=Math.cos(n.y),s=En(e-this.long0),a,o,d,p,g,_,w,T,I,L,P,C,O,z,H,Y,ee,te,ce,K,Q,pe,ze;return this.sphere?Math.abs(this.sin_p12-1)<=_n?(n.x=this.x0+this.a*(Bt-t)*Math.sin(s),n.y=this.y0-this.a*(Bt-t)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=_n?(n.x=this.x0+this.a*(Bt+t)*Math.sin(s),n.y=this.y0+this.a*(Bt+t)*Math.cos(s),n):(te=this.sin_p12*i+this.cos_p12*r*Math.cos(s),Y=Math.acos(te),ee=Y?Y/Math.sin(Y):1,n.x=this.x0+this.a*ee*r*Math.sin(s),n.y=this.y0+this.a*ee*(this.cos_p12*i-this.sin_p12*r*Math.cos(s)),n):(a=V0(this.es),o=G0(this.es),d=H0(this.es),p=W0(this.es),Math.abs(this.sin_p12-1)<=_n?(g=this.a*zo(a,o,d,p,Bt),_=this.a*zo(a,o,d,p,t),n.x=this.x0+(g-_)*Math.sin(s),n.y=this.y0-(g-_)*Math.cos(s),n):Math.abs(this.sin_p12+1)<=_n?(g=this.a*zo(a,o,d,p,Bt),_=this.a*zo(a,o,d,p,t),n.x=this.x0+(g+_)*Math.sin(s),n.y=this.y0+(g+_)*Math.cos(s),n):(w=i/r,T=og(this.a,this.e,this.sin_p12),I=og(this.a,this.e,i),L=Math.atan((1-this.es)*w+this.es*T*this.sin_p12/(I*r)),P=Math.atan2(Math.sin(s),this.cos_p12*Math.tan(L)-this.sin_p12*Math.cos(s)),P===0?ce=Math.asin(this.cos_p12*Math.sin(L)-this.sin_p12*Math.cos(L)):Math.abs(Math.abs(P)-Math.PI)<=_n?ce=-Math.asin(this.cos_p12*Math.sin(L)-this.sin_p12*Math.cos(L)):ce=Math.asin(Math.sin(s)*Math.cos(L)/Math.sin(P)),C=this.e*this.sin_p12/Math.sqrt(1-this.es),O=this.e*this.cos_p12*Math.cos(P)/Math.sqrt(1-this.es),z=C*O,H=O*O,K=ce*ce,Q=K*ce,pe=Q*ce,ze=pe*ce,Y=T*ce*(1-K*H*(1-H)/6+Q/8*z*(1-2*H)+pe/120*(H*(4-7*H)-3*C*C*(1-7*H))-ze/48*z),n.x=this.x0+Y*Math.sin(P),n.y=this.y0+Y*Math.cos(P),n))}function EY(n){n.x-=this.x0,n.y-=this.y0;var e,t,i,r,s,a,o,d,p,g,_,w,T,I,L,P,C,O,z,H,Y,ee,te,ce;return this.sphere?(e=Math.sqrt(n.x*n.x+n.y*n.y),e>2*Bt*this.a?void 0:(t=e/this.a,i=Math.sin(t),r=Math.cos(t),s=this.long0,Math.abs(e)<=_n?a=this.lat0:(a=Sd(r*this.sin_p12+n.y*i*this.cos_p12/e),o=Math.abs(this.lat0)-Bt,Math.abs(o)<=_n?this.lat0>=0?s=En(this.long0+Math.atan2(n.x,-n.y)):s=En(this.long0-Math.atan2(-n.x,n.y)):s=En(this.long0+Math.atan2(n.x*i,e*this.cos_p12*r-n.y*this.sin_p12*i))),n.x=s,n.y=a,n)):(d=V0(this.es),p=G0(this.es),g=H0(this.es),_=W0(this.es),Math.abs(this.sin_p12-1)<=_n?(w=this.a*zo(d,p,g,_,Bt),e=Math.sqrt(n.x*n.x+n.y*n.y),T=w-e,a=_w(T/this.a,d,p,g,_),s=En(this.long0+Math.atan2(n.x,-1*n.y)),n.x=s,n.y=a,n):Math.abs(this.sin_p12+1)<=_n?(w=this.a*zo(d,p,g,_,Bt),e=Math.sqrt(n.x*n.x+n.y*n.y),T=e-w,a=_w(T/this.a,d,p,g,_),s=En(this.long0+Math.atan2(n.x,n.y)),n.x=s,n.y=a,n):(e=Math.sqrt(n.x*n.x+n.y*n.y),P=Math.atan2(n.x,n.y),I=og(this.a,this.e,this.sin_p12),C=Math.cos(P),O=this.e*this.cos_p12*C,z=-O*O/(1-this.es),H=3*this.es*(1-z)*this.sin_p12*this.cos_p12*C/(1-this.es),Y=e/I,ee=Y-z*(1+z)*Math.pow(Y,3)/6-H*(1+3*z)*Math.pow(Y,4)/24,te=1-z*ee*ee/2-Y*ee*ee*ee/6,L=Math.asin(this.sin_p12*Math.cos(ee)+this.cos_p12*Math.sin(ee)*C),s=En(this.long0+Math.asin(Math.sin(P)*Math.sin(ee)/Math.cos(L))),ce=Math.sin(L),a=Math.atan2((ce-this.es*te*this.sin_p12)*Math.tan(L),ce*(1-this.es)),n.x=s,n.y=a,n))}var TY=["Azimuthal_Equidistant","aeqd"];const CY={init:SY,forward:MY,inverse:EY,names:TY};function AY(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)}function IY(n){var e,t,i,r,s,a,o,d,p=n.x,g=n.y;return i=En(p-this.long0),e=Math.sin(g),t=Math.cos(g),r=Math.cos(i),a=this.sin_p14*e+this.cos_p14*t*r,s=1,(a>0||Math.abs(a)<=_n)&&(o=this.a*s*t*Math.sin(i),d=this.y0+this.a*s*(this.cos_p14*e-this.sin_p14*t*r)),n.x=o,n.y=d,n}function PY(n){var e,t,i,r,s,a,o;return n.x-=this.x0,n.y-=this.y0,e=Math.sqrt(n.x*n.x+n.y*n.y),t=Sd(e/this.a),i=Math.sin(t),r=Math.cos(t),a=this.long0,Math.abs(e)<=_n?(o=this.lat0,n.x=a,n.y=o,n):(o=Sd(r*this.sin_p14+n.y*i*this.cos_p14/e),s=Math.abs(this.lat0)-Bt,Math.abs(s)<=_n?(this.lat0>=0?a=En(this.long0+Math.atan2(n.x,-n.y)):a=En(this.long0-Math.atan2(-n.x,n.y)),n.x=a,n.y=o,n):(a=En(this.long0+Math.atan2(n.x*i,e*this.cos_p14*r-n.y*this.sin_p14*i)),n.x=a,n.y=o,n))}var RY=["ortho"];const LY={init:AY,forward:IY,inverse:PY,names:RY};var Ur={FRONT:1,RIGHT:2,BACK:3,LEFT:4,TOP:5,BOTTOM:6},Qi={AREA_0:1,AREA_1:2,AREA_2:3,AREA_3:4};function DY(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Bt-Ji/2?this.face=Ur.TOP:this.lat0<=-(Bt-Ji/2)?this.face=Ur.BOTTOM:Math.abs(this.long0)<=Ji?this.face=Ur.FRONT:Math.abs(this.long0)<=Bt+Ji?this.face=this.long0>0?Ur.RIGHT:Ur.LEFT:this.face=Ur.BACK,this.es!==0&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)}function kY(n){var e={x:0,y:0},t,i,r,s,a,o,d={value:0};if(n.x-=this.long0,this.es!==0?t=Math.atan(this.one_minus_f_squared*Math.tan(n.y)):t=n.y,i=n.x,this.face===Ur.TOP)s=Bt-t,i>=Ji&&i<=Bt+Ji?(d.value=Qi.AREA_0,r=i-Bt):i>Bt+Ji||i<=-(Bt+Ji)?(d.value=Qi.AREA_1,r=i>0?i-Jr:i+Jr):i>-(Bt+Ji)&&i<=-Ji?(d.value=Qi.AREA_2,r=i+Bt):(d.value=Qi.AREA_3,r=i);else if(this.face===Ur.BOTTOM)s=Bt+t,i>=Ji&&i<=Bt+Ji?(d.value=Qi.AREA_0,r=-i+Bt):i<Ji&&i>=-Ji?(d.value=Qi.AREA_1,r=-i):i<-Ji&&i>=-(Bt+Ji)?(d.value=Qi.AREA_2,r=-i-Bt):(d.value=Qi.AREA_3,r=i>0?-i+Jr:-i-Jr);else{var p,g,_,w,T,I,L;this.face===Ur.RIGHT?i=zm(i,+Bt):this.face===Ur.BACK?i=zm(i,+Jr):this.face===Ur.LEFT&&(i=zm(i,-Bt)),w=Math.sin(t),T=Math.cos(t),I=Math.sin(i),L=Math.cos(i),p=T*L,g=T*I,_=w,this.face===Ur.FRONT?(s=Math.acos(p),r=mx(s,_,g,d)):this.face===Ur.RIGHT?(s=Math.acos(g),r=mx(s,_,-p,d)):this.face===Ur.BACK?(s=Math.acos(-p),r=mx(s,_,-g,d)):this.face===Ur.LEFT?(s=Math.acos(-g),r=mx(s,_,p,d)):(s=r=0,d.value=Qi.AREA_0)}return o=Math.atan(12/Jr*(r+Math.acos(Math.sin(r)*Math.cos(Ji))-Bt)),a=Math.sqrt((1-Math.cos(s))/(Math.cos(o)*Math.cos(o))/(1-Math.cos(Math.atan(1/Math.cos(r))))),d.value===Qi.AREA_1?o+=Bt:d.value===Qi.AREA_2?o+=Jr:d.value===Qi.AREA_3&&(o+=1.5*Jr),e.x=a*Math.cos(o),e.y=a*Math.sin(o),e.x=e.x*this.a+this.x0,e.y=e.y*this.a+this.y0,n.x=e.x,n.y=e.y,n}function FY(n){var e={lam:0,phi:0},t,i,r,s,a,o,d,p,g,_={value:0};if(n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a,i=Math.atan(Math.sqrt(n.x*n.x+n.y*n.y)),t=Math.atan2(n.y,n.x),n.x>=0&&n.x>=Math.abs(n.y)?_.value=Qi.AREA_0:n.y>=0&&n.y>=Math.abs(n.x)?(_.value=Qi.AREA_1,t-=Bt):n.x<0&&-n.x>=Math.abs(n.y)?(_.value=Qi.AREA_2,t=t<0?t+Jr:t-Jr):(_.value=Qi.AREA_3,t+=Bt),g=Jr/12*Math.tan(t),a=Math.sin(g)/(Math.cos(g)-1/Math.sqrt(2)),o=Math.atan(a),r=Math.cos(t),s=Math.tan(i),d=1-r*r*s*s*(1-Math.cos(Math.atan(1/Math.cos(o)))),d<-1?d=-1:d>1&&(d=1),this.face===Ur.TOP)p=Math.acos(d),e.phi=Bt-p,_.value===Qi.AREA_0?e.lam=o+Bt:_.value===Qi.AREA_1?e.lam=o<0?o+Jr:o-Jr:_.value===Qi.AREA_2?e.lam=o-Bt:e.lam=o;else if(this.face===Ur.BOTTOM)p=Math.acos(d),e.phi=p-Bt,_.value===Qi.AREA_0?e.lam=-o+Bt:_.value===Qi.AREA_1?e.lam=-o:_.value===Qi.AREA_2?e.lam=-o-Bt:e.lam=o<0?-o-Jr:-o+Jr;else{var w,T,I;w=d,g=w*w,g>=1?I=0:I=Math.sqrt(1-g)*Math.sin(o),g+=I*I,g>=1?T=0:T=Math.sqrt(1-g),_.value===Qi.AREA_1?(g=T,T=-I,I=g):_.value===Qi.AREA_2?(T=-T,I=-I):_.value===Qi.AREA_3&&(g=T,T=I,I=-g),this.face===Ur.RIGHT?(g=w,w=-T,T=g):this.face===Ur.BACK?(w=-w,T=-T):this.face===Ur.LEFT&&(g=w,w=T,T=-g),e.phi=Math.acos(-I)-Bt,e.lam=Math.atan2(T,w),this.face===Ur.RIGHT?e.lam=zm(e.lam,-Bt):this.face===Ur.BACK?e.lam=zm(e.lam,-Jr):this.face===Ur.LEFT&&(e.lam=zm(e.lam,+Bt))}if(this.es!==0){var L,P,C;L=e.phi<0?1:0,P=Math.tan(e.phi),C=this.b/Math.sqrt(P*P+this.one_minus_f_squared),e.phi=Math.atan(Math.sqrt(this.a*this.a-C*C)/(this.one_minus_f*C)),L&&(e.phi=-e.phi)}return e.lam+=this.long0,n.x=e.lam,n.y=e.phi,n}function mx(n,e,t,i){var r;return n<_n?(i.value=Qi.AREA_0,r=0):(r=Math.atan2(e,t),Math.abs(r)<=Ji?i.value=Qi.AREA_0:r>Ji&&r<=Bt+Ji?(i.value=Qi.AREA_1,r-=Bt):r>Bt+Ji||r<=-(Bt+Ji)?(i.value=Qi.AREA_2,r=r>=0?r-Jr:r+Jr):(i.value=Qi.AREA_3,r+=Bt)),r}function zm(n,e){var t=n+e;return t<-Jr?t+=g0:t>+Jr&&(t-=g0),t}var OY=["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"];const NY={init:DY,forward:kY,inverse:FY,names:OY};var JT=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-986701e-12],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,18736e-12],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,934959e-12],[.7986,-.00755338,-500009e-10,935324e-12],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],oy=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-126793e-14,422642e-15],[.124,.0124,507171e-14,-160604e-14],[.186,.0123999,-190189e-13,600152e-14],[.248,.0124002,710039e-13,-224e-10],[.31,.0123992,-264997e-12,835986e-13],[.372,.0124029,988983e-12,-311994e-12],[.434,.0123893,-369093e-11,-435621e-12],[.4958,.0123198,-102252e-10,-345523e-12],[.5571,.0121916,-154081e-10,-582288e-12],[.6176,.0119938,-241424e-10,-525327e-12],[.6769,.011713,-320223e-10,-516405e-12],[.7346,.0113541,-397684e-10,-609052e-12],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-140374e-14],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],uU=.8487,hU=1.3523,dU=Ic/5,zY=1/dU,Em=18,yw=function(n,e){return n[0]+e*(n[1]+e*(n[2]+e*n[3]))},BY=function(n,e){return n[1]+e*(2*n[2]+e*3*n[3])};function UY(n,e,t,i){for(var r=e;i;--i){var s=n(r);if(r-=s,Math.abs(s)<t)break}return r}function VY(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"}function GY(n){var e=En(n.x-this.long0),t=Math.abs(n.y),i=Math.floor(t*dU);i<0?i=0:i>=Em&&(i=Em-1),t=Ic*(t-zY*i);var r={x:yw(JT[i],t)*e,y:yw(oy[i],t)};return n.y<0&&(r.y=-r.y),r.x=r.x*this.a*uU+this.x0,r.y=r.y*this.a*hU+this.y0,r}function HY(n){var e={x:(n.x-this.x0)/(this.a*uU),y:Math.abs(n.y-this.y0)/(this.a*hU)};if(e.y>=1)e.x/=JT[Em][0],e.y=n.y<0?-Bt:Bt;else{var t=Math.floor(e.y*Em);for(t<0?t=0:t>=Em&&(t=Em-1);;)if(oy[t][0]>e.y)--t;else if(oy[t+1][0]<=e.y)++t;else break;var i=oy[t],r=5*(e.y-i[0])/(oy[t+1][0]-i[0]);r=UY(function(s){return(yw(i,s)-e.y)/BY(i,s)},r,_n,100),e.x/=yw(JT[t],r),e.y=(5*t+r)*Hs,n.y<0&&(e.y=-e.y)}return e.x=En(e.x+this.long0),e}var WY=["Robinson","robin"];const jY={init:VY,forward:GY,inverse:HY,names:WY};function $Y(){this.name="geocent"}function qY(n){var e=KB(n,this.es,this.a);return e}function XY(n){var e=JB(n,this.es,this.a,this.b);return e}var ZY=["Geocentric","geocentric","geocent","Geocent"];const YY={init:$Y,forward:qY,inverse:XY,names:ZY};var go={N_POLE:0,S_POLE:1,EQUIT:2,OBLIQ:3},N_={h:{def:1e5,num:!0},azi:{def:0,num:!0,degrees:!0},tilt:{def:0,num:!0,degrees:!0},long0:{def:0,num:!0},lat0:{def:0,num:!0}};function KY(){if(Object.keys(N_).forEach((function(t){if(typeof this[t]>"u")this[t]=N_[t].def;else{if(N_[t].num&&isNaN(this[t]))throw new Error("Invalid parameter value, must be numeric "+t+" = "+this[t]);N_[t].num&&(this[t]=parseFloat(this[t]))}N_[t].degrees&&(this[t]=this[t]*Hs)}).bind(this)),Math.abs(Math.abs(this.lat0)-Bt)<_n?this.mode=this.lat0<0?go.S_POLE:go.N_POLE:Math.abs(this.lat0)<_n?this.mode=go.EQUIT:(this.mode=go.OBLIQ,this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0)),this.pn1=this.h/this.a,this.pn1<=0||this.pn1>1e10)throw new Error("Invalid height");this.p=1+this.pn1,this.rp=1/this.p,this.h1=1/this.pn1,this.pfact=(this.p+1)*this.h1,this.es=0;var n=this.tilt,e=this.azi;this.cg=Math.cos(e),this.sg=Math.sin(e),this.cw=Math.cos(n),this.sw=Math.sin(n)}function JY(n){n.x-=this.long0;var e=Math.sin(n.y),t=Math.cos(n.y),i=Math.cos(n.x),r,s;switch(this.mode){case go.OBLIQ:s=this.sinph0*e+this.cosph0*t*i;break;case go.EQUIT:s=t*i;break;case go.S_POLE:s=-e;break;case go.N_POLE:s=e;break}switch(s=this.pn1/(this.p-s),r=s*t*Math.sin(n.x),this.mode){case go.OBLIQ:s*=this.cosph0*e-this.sinph0*t*i;break;case go.EQUIT:s*=e;break;case go.N_POLE:s*=-(t*i);break;case go.S_POLE:s*=t*i;break}var a,o;return a=s*this.cg+r*this.sg,o=1/(a*this.sw*this.h1+this.cw),r=(r*this.cg-s*this.sg)*this.cw*o,s=a*o,n.x=r*this.a,n.y=s*this.a,n}function QY(n){n.x/=this.a,n.y/=this.a;var e={x:n.x,y:n.y},t,i,r;r=1/(this.pn1-n.y*this.sw),t=this.pn1*n.x*r,i=this.pn1*n.y*this.cw*r,n.x=t*this.cg+i*this.sg,n.y=i*this.cg-t*this.sg;var s=il(n.x,n.y);if(Math.abs(s)<_n)e.x=0,e.y=n.y;else{var a,o;switch(o=1-s*s*this.pfact,o=(this.p-Math.sqrt(o))/(this.pn1/s+s/this.pn1),a=Math.sqrt(1-o*o),this.mode){case go.OBLIQ:e.y=Math.asin(a*this.sinph0+n.y*o*this.cosph0/s),n.y=(a-this.sinph0*Math.sin(e.y))*s,n.x*=o*this.cosph0;break;case go.EQUIT:e.y=Math.asin(n.y*o/s),n.y=a*s,n.x*=o;break;case go.N_POLE:e.y=Math.asin(a),n.y=-n.y;break;case go.S_POLE:e.y=-Math.asin(a);break}e.x=Math.atan2(n.x,n.y)}return n.x=e.x+this.long0,n.y=e.y,n}var eK=["Tilted_Perspective","tpers"];const tK={init:KY,forward:JY,inverse:QY,names:eK};function nK(){if(this.flip_axis=this.sweep==="x"?1:0,this.h=Number(this.h),this.radius_g_1=this.h/this.a,this.radius_g_1<=0||this.radius_g_1>1e10)throw new Error;if(this.radius_g=1+this.radius_g_1,this.C=this.radius_g*this.radius_g-1,this.es!==0){var n=1-this.es,e=1/n;this.radius_p=Math.sqrt(n),this.radius_p2=n,this.radius_p_inv2=e,this.shape="ellipse"}else this.radius_p=1,this.radius_p2=1,this.radius_p_inv2=1,this.shape="sphere";this.title||(this.title="Geostationary Satellite View")}function iK(n){var e=n.x,t=n.y,i,r,s,a;if(e=e-this.long0,this.shape==="ellipse"){t=Math.atan(this.radius_p2*Math.tan(t));var o=this.radius_p/il(this.radius_p*Math.cos(t),Math.sin(t));if(r=o*Math.cos(e)*Math.cos(t),s=o*Math.sin(e)*Math.cos(t),a=o*Math.sin(t),(this.radius_g-r)*r-s*s-a*a*this.radius_p_inv2<0)return n.x=Number.NaN,n.y=Number.NaN,n;i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/il(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(s/i),n.y=this.radius_g_1*Math.atan(a/il(s,i)))}else this.shape==="sphere"&&(i=Math.cos(t),r=Math.cos(e)*i,s=Math.sin(e)*i,a=Math.sin(t),i=this.radius_g-r,this.flip_axis?(n.x=this.radius_g_1*Math.atan(s/il(a,i)),n.y=this.radius_g_1*Math.atan(a/i)):(n.x=this.radius_g_1*Math.atan(s/i),n.y=this.radius_g_1*Math.atan(a/il(s,i))));return n.x=n.x*this.a,n.y=n.y*this.a,n}function rK(n){var e=-1,t=0,i=0,r,s,a,o;if(n.x=n.x/this.a,n.y=n.y/this.a,this.shape==="ellipse"){this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*il(1,i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*il(1,t));var d=i/this.radius_p;if(r=t*t+d*d+e*e,s=2*this.radius_g*e,a=s*s-4*r*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*r),e=this.radius_g+o*e,t*=o,i*=o,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e),n.y=Math.atan(this.radius_p_inv2*Math.tan(n.y))}else if(this.shape==="sphere"){if(this.flip_axis?(i=Math.tan(n.y/this.radius_g_1),t=Math.tan(n.x/this.radius_g_1)*Math.sqrt(1+i*i)):(t=Math.tan(n.x/this.radius_g_1),i=Math.tan(n.y/this.radius_g_1)*Math.sqrt(1+t*t)),r=t*t+i*i+e*e,s=2*this.radius_g*e,a=s*s-4*r*this.C,a<0)return n.x=Number.NaN,n.y=Number.NaN,n;o=(-s-Math.sqrt(a))/(2*r),e=this.radius_g+o*e,t*=o,i*=o,n.x=Math.atan2(t,e),n.y=Math.atan(i*Math.cos(n.x)/e)}return n.x=n.x+this.long0,n}var sK=["Geostationary Satellite View","Geostationary_Satellite","geos"];const oK={init:nK,forward:iK,inverse:rK,names:sK};var Ey=1.340264,Ty=-.081106,Cy=893e-6,Ay=.003796,vw=Math.sqrt(3)/2;function aK(){this.es=0,this.long0=this.long0!==void 0?this.long0:0}function lK(n){var e=En(n.x-this.long0),t=n.y,i=Math.asin(vw*Math.sin(t)),r=i*i,s=r*r*r;return n.x=e*Math.cos(i)/(vw*(Ey+3*Ty*r+s*(7*Cy+9*Ay*r))),n.y=i*(Ey+Ty*r+s*(Cy+Ay*r)),n.x=this.a*n.x+this.x0,n.y=this.a*n.y+this.y0,n}function cK(n){n.x=(n.x-this.x0)/this.a,n.y=(n.y-this.y0)/this.a;var e=1e-9,t=12,i=n.y,r,s,a,o,d,p;for(p=0;p<t&&(r=i*i,s=r*r*r,a=i*(Ey+Ty*r+s*(Cy+Ay*r))-n.y,o=Ey+3*Ty*r+s*(7*Cy+9*Ay*r),i-=d=a/o,!(Math.abs(d)<e));++p);return r=i*i,s=r*r*r,n.x=vw*n.x*(Ey+3*Ty*r+s*(7*Cy+9*Ay*r))/Math.cos(i),n.y=Math.asin(Math.sin(i)/vw),n.x=En(n.x+this.long0),n}var uK=["eqearth","Equal Earth","Equal_Earth"];const hK={init:aK,forward:lK,inverse:cK,names:uK};function dK(n){n.Proj.projections.add(a1),n.Proj.projections.add(l1),n.Proj.projections.add(fX),n.Proj.projections.add(SX),n.Proj.projections.add(IX),n.Proj.projections.add(kX),n.Proj.projections.add(UX),n.Proj.projections.add(jX),n.Proj.projections.add(YX),n.Proj.projections.add(tZ),n.Proj.projections.add(yZ),n.Proj.projections.add(MZ),n.Proj.projections.add(IZ),n.Proj.projections.add(FZ),n.Proj.projections.add(UZ),n.Proj.projections.add(jZ),n.Proj.projections.add(YZ),n.Proj.projections.add(tY),n.Proj.projections.add(aY),n.Proj.projections.add(dY),n.Proj.projections.add(_Y),n.Proj.projections.add(bY),n.Proj.projections.add(CY),n.Proj.projections.add(LY),n.Proj.projections.add(NY),n.Proj.projections.add(jY),n.Proj.projections.add(YY),n.Proj.projections.add(tK),n.Proj.projections.add(oK),n.Proj.projections.add(hK)}Fa.defaultDatum="WGS84";Fa.Proj=Fc;Fa.WGS84=new Fa.Proj("WGS84");Fa.Point=sg;Fa.toPoint=QB;Fa.defs=ko;Fa.nadgrid=mq;Fa.transform=gw;Fa.mgrs=Rq;Fa.version="__VERSION__";dK(Fa);Fa.defs("EPSG:32632","+proj=utm +zone=32 +ellps=WGS84 +datum=WGS84 +units=m +no_defs");const kM=(n,e)=>ln.jsx("img",{src:e,className:n,alt:"Dark Mode Icon"}),fK=()=>{const[n,e]=Ht.useState(null),[t,i]=Ht.useState(null),[r,s]=Ht.useState("None"),[a]=Ht.useState(new OA({wrapX:!1})),[o]=Ht.useState(new y$),d={Point:"rgba(100,255,0,0.4)",LineString:"rgba(200, 178, 0, 0.6)",Polygon:"rgba(100, 255, 0, 0.6)",Circle:"rgba(253, 165, 220, 0.6)"},p={Point:{"fill-color":d.Point,"stroke-color":"purple","stroke-width":2,"circle-fill-color":"purple","circle-radius":6,"circle-stroke-color":"rgba(100, 255, 0, 0.9)"},LineString:{"fill-color":d.LineString,"stroke-color":"purple","stroke-width":2,"circle-fill-color":"purple","circle-radius":6,"circle-stroke-color":"rgba(100, 255, 0, 0.9)"},Polygon:{"fill-color":d.Polygon,"stroke-color":"purple","stroke-width":2,"circle-fill-color":"purple","circle-radius":6,"circle-stroke-color":"rgba(100, 255, 0, 0.9)"},Circle:{"fill-color":d.Circle,"stroke-color":"purple","stroke-width":2,"circle-fill-color":"purple","circle-radius":6,"circle-stroke-color":"rgba(100, 255, 0, 0.9)"}},g={style:new na({image:new md({fill:new nl({color:d.LineString}),stroke:new Ll({color:"purple",width:2}),radius:5}),fill:new nl({color:d.LineString}),stroke:new Ll({color:"purple",width:2})})},[_,w]=Ht.useState(new BA(g)),[T,I]=Ht.useState(new R7({features:_==null?void 0:_.getFeatures()})),L=Ht.useRef(null),[P,C]=Ht.useState(new A$({coordinateFormat:WL(4),projection:"EPSG:4326",className:"custom-mouse-position"})),O=new w$({source:o}),z=new na({fill:new nl({color:"rgba(100, 255, 0, 0.6)"}),stroke:new Ll({color:"purple",width:2}),image:new md({radius:6,fill:new nl({color:"purple"}),stroke:new Ll({color:"rgba(100, 255, 0, 0.9)"})})});function H(at){let Rn,Me,Jn;const on=at.getType();if(on==="Polygon"){let Te=0,jn=0,wn=0;Me=at.getCoordinates()[0].slice(1),Me.forEach(function(jt){Te+=jt[0],jn+=jt[1],wn++}),Rn=[Te/wn,jn/wn]}else on==="LineString"?(Rn=at.getCoordinateAt(.5),Me=at.getCoordinates()):Rn=qu(at.getExtent());let Vn;return Me?(Vn=Me.map(function(Te){const jn=Te[0]-Rn[0],wn=Te[1]-Rn[1];return jn*jn+wn*wn}),Jn=Math.sqrt(Math.max.apply(Math,Vn))/3):Jn=Math.max(qi(at.getExtent()),js(at.getExtent()))/3,{center:Rn,coordinates:Me,minRadius:Jn,sqDistances:Vn}}const Y=new Eb({source:a,style:function(at){const Rn=[z],Me=at.get("modifyGeometry"),Jn=Me?Me.geometry:at.getGeometry(),on=H(Jn);if(on.center){const Te=on.coordinates;if(Te){const jn=on.minRadius,wn=on.sqDistances,jt=jn*jn,me=Te.filter(function(le,tt){return wn[tt]>jt});Rn.push(new na({geometry:new N0(me),image:new md({radius:6,fill:new nl({color:"#33cc33"})})}))}}return Rn}}),[ee]=Ht.useState(new P7({source:a}));n==null||n.addInteraction(ee);const te=new v7({source:a,style:{"stroke-color":"purple","circle-stroke-color":"rgba(100, 255, 0, 0.9)"}});n==null||n.addInteraction(te);const[ce,K]=Ht.useState("metric"),[Q,pe]=Ht.useState("scaleline"),[ze,Fe]=Ht.useState(4),[qe,et]=Ht.useState(!0),[Ne,st]=Ht.useState(new RM({units:ce}));Ht.useState(!1),Ht.useEffect(()=>{n&&n.removeControl(Ne);const at=Ee();st(at),n&&n.addControl(at)},[n,ce,Q,ze,qe]);const Ee=()=>Q==="scaleline"?new RM({units:ce,minWidth:140}):new RM({units:ce,bar:!0,steps:ze,text:qe,minWidth:200}),ut=at=>{K(at.target.value)},ot=at=>{pe(at.target.value)},dt=at=>{Fe(parseInt(at.target.value))},Ct=at=>{et(at.target.checked)};Ht.useState(null);const Vt=()=>{let at=r;if(at!=="None"){let Rn;at==="Square"?(at="Circle",Rn=l7(4)):at==="Box"?(at="Circle",Rn=c7()):at==="Star"&&(at="Circle",Rn=(Jn,on)=>{const Vn=Jn[0],Te=Jn[Jn.length-1],jn=Vn[0]-Te[0],wn=Vn[1]-Te[1],jt=Math.sqrt(jn*jn+wn*wn),me=Math.atan2(wn,jn),le=[],tt=12;for(let xt=0;xt<tt;++xt){const St=me+xt*2*Math.PI/tt,yt=xt%2===0?1:.5,hn=jt*yt*Math.cos(St),zt=jt*yt*Math.sin(St);le.push([Vn[0]+hn,Vn[1]+zt])}return le.push(le[0].slice()),on?on instanceof ka&&on.setCoordinates([le]):on=new ka([le]),on});const Me=new o7({source:a,type:at,trace:!0,traceSource:a,style:p[at],geometryFunction:Rn});n==null||n.addInteraction(Me),i(Me)}};Ht.useEffect(()=>{var Me;const at=(Me=aa("EPSG:32632"))==null?void 0:Me.getExtent().slice();at&&(at[0]+=at[0],at[2]+=at[2]);const Rn=new H7({controls:DB().extend([P]),interactions:LB().extend([_,T]),layers:[O,Y],target:"map",view:new Sc({center:[0,0],zoom:2})});if(e(Rn),L.current){const Jn=new E$({className:"custom-full-screen",target:L.current});Rn.addControl(Jn)}return()=>{Rn.setTarget(void 0)}},[]),Ht.useEffect(()=>{n&&(t&&n.removeInteraction(t),Vt())},[r]);const Re=()=>{if(n){const at=n.getView(),Rn=at.getZoom();at.setZoom(Rn?Rn-1:1)}},mt=()=>{if(n){const at=n.getView(),Rn=at.getZoom();at.setZoom(Rn?Rn+1:1)}},Et=at=>{s(at.currentTarget.value),t&&(n==null||n.removeInteraction(t))},It=()=>{t&&t.removeLastPoint()},vn=at=>{P.setProjection(at.target.value)},xn=at=>{const Rn=WL(at.target.valueAsNumber);P.setCoordinateFormat(Rn)};return ln.jsxs("div",{children:[ln.jsx("a",{className:"skiplink",href:"#map",children:"Go to map"}),ln.jsx("div",{id:"map",className:"map mb-2",tabIndex:0}),ln.jsxs("div",{className:"flex",children:[ln.jsxs("div",{children:[ln.jsxs("form",{className:"flex my-2",children:[ln.jsx("label",{htmlFor:"projection",className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",children:"Projection "}),ln.jsxs("select",{onChange:vn,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-e-lg border-s-gray-100 dark:border-s-gray-700 border-s-2 focus:ring-blue-500 focus:border-blue-500 block w-fit p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 mr-2",children:[ln.jsx("option",{value:"EPSG:4326",children:"EPSG:4326"}),ln.jsx("option",{value:"EPSG:3857",children:"EPSG:3857"}),ln.jsx("option",{value:"EPSG:32632",children:"EPSG:32632"})]}),ln.jsx("label",{htmlFor:"precision",className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",children:"Precision"}),ln.jsx("input",{onChange:at=>xn(at),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-e-lg border-s-gray-100 dark:border-s-gray-700 border-s-2 focus:ring-blue-500 focus:border-blue-500 block w-fit p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",type:"number",min:0,max:"12",defaultValue:4})]}),ln.jsxs("div",{className:"flex flex-wrap",children:[ln.jsxs("span",{className:"flex items-center",children:[ln.jsx("label",{className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",htmlFor:"type",children:"Geometry type:"}),ln.jsxs("select",{className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-e-lg border-s-gray-100 dark:border-s-gray-700 border-s-2 focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",onChange:Et,value:r,children:[ln.jsx("option",{value:"Point",children:"Point"}),ln.jsx("option",{value:"LineString",children:"LineString"}),ln.jsx("option",{value:"Polygon",children:"Polygon"}),ln.jsx("option",{value:"Circle",children:"Circle"}),ln.jsx("option",{value:"Square",children:"Square"}),ln.jsx("option",{value:"Box",children:"Box"}),ln.jsx("option",{value:"Star",children:"Star"}),ln.jsx("option",{value:"None",children:"None"})]})]}),ln.jsx("button",{className:"mx-1 bg-blue-500 hover:bg-blue-700 text-white py-2 px-2 rounded-full",type:"button",onClick:It,children:kM("w-5",M$)}),ln.jsx("button",{className:"mx-1 bg-blue-500 hover:bg-blue-700 text-white py-2 px-2 rounded-full",onClick:Re,children:kM("w-5",b$)}),ln.jsx("button",{className:"mx-1 bg-blue-500 hover:bg-blue-700 text-white py-2 px-2 rounded-full",onClick:mt,children:kM("w-5",S$)}),ln.jsx("div",{className:"mx-1",ref:L})]})]}),ln.jsx("div",{className:"px-2",children:ln.jsxs("form",{className:"my-2 text-left",children:[ln.jsx("label",{htmlFor:"units",className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",children:"Units:"}),ln.jsxs("select",{onChange:ut,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-e-lg border-s-gray-100 dark:border-s-gray-700 border-s-2 focus:ring-blue-500 focus:border-blue-500 w-24 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 mr-2",children:[ln.jsx("option",{value:"degrees",children:"degrees"}),ln.jsx("option",{value:"imperial",children:"imperial inch"}),ln.jsx("option",{value:"us",children:"us inch"}),ln.jsx("option",{value:"nautical",children:"nautical mile"}),ln.jsx("option",{value:"metric",selected:!0,children:"metric"})]}),ln.jsx("label",{htmlFor:"type",className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",children:"Type:"}),ln.jsxs("select",{id:"type",value:Q,onChange:ot,className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-e-lg border-s-gray-100 dark:border-s-gray-700 border-s-2 focus:ring-blue-500 focus:border-blue-500 w-fit p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500 mr-2",children:[ln.jsx("option",{value:"scaleline",children:"ScaleLine"}),ln.jsx("option",{value:"scalebar",children:"ScaleBar"})]}),Q==="scalebar"&&ln.jsxs("div",{className:"my-2 flex",children:[ln.jsx("label",{htmlFor:"steps",className:"flex-shrink-0 z-10 inline-flex items-center py-2.5 px-4 text-sm font-medium text-center text-gray-500 bg-gray-100 border border-gray-300 rounded-s-lg focus:ring-4 focus:outline-none focus:ring-gray-100 dark:bg-gray-700 dark:focus:ring-gray-700 dark:text-white dark:border-gray-600",children:"Steps:"}),ln.jsx("input",{className:"ml-2",id:"steps",onChange:dt,value:ze,type:"range",defaultValue:4,min:1,max:8}),ln.jsx("span",{className:"flex flex-col",children:ln.jsxs("label",{className:"ml-2",children:[ln.jsx("input",{type:"checkbox",checked:qe,onChange:Ct})," Show scale text"]})})]})]})}),ln.jsx("div",{})]})]})},pK=()=>ln.jsxs(ln.Fragment,{children:[ln.jsx(rM,{className:"block",to:"/openlayers",children:"OpenLayers"}),ln.jsx(rM,{className:"block",to:"/MapWith3DModels",children:"MapWith3DModels"}),ln.jsx(rM,{className:"block",to:"/maplibre",children:"MapLibre"})]});var fU={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.4.0/LICENSE.txt
 */(function(n,e){(function(t,i){n.exports=i()})(Iu,function(){var t={},i={};function r(a,o,d){if(i[a]=d,a==="index"){var p="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",g={};return i.shared(g),i.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}r("shared",["exports"],function(a){function o(u,l,h,m){return new(h||(h=Promise))(function(v,b){function E(B){try{k(m.next(B))}catch(V){b(V)}}function A(B){try{k(m.throw(B))}catch(V){b(V)}}function k(B){var V;B.done?v(B.value):(V=B.value,V instanceof h?V:new h(function(W){W(V)})).then(E,A)}k((m=m.apply(u,l||[])).next())})}function d(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(u,l){this.x=u,this.y=l}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,l){return this.clone()._rotateAround(u,l)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var l=u.x-this.x,h=u.y-this.y;return l*l+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,l){return Math.atan2(this.x*l-this.y*u,this.x*u+this.y*l)},_matMult:function(u){var l=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=l,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var l=Math.cos(u),h=Math.sin(u),m=h*this.x+l*this.y;return this.x=l*this.x-h*this.y,this.y=m,this},_rotateAround:function(u,l){var h=Math.cos(u),m=Math.sin(u),v=l.y+m*(this.x-l.x)+h*(this.y-l.y);return this.x=l.x+h*(this.x-l.x)-m*(this.y-l.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(u){return u instanceof g?u:Array.isArray(u)?new g(u[0],u[1]):u};var _=d(p),w=T;function T(u,l,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=h,this.p2y=m}T.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<l)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=v/b}var E=0,A=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<l));m++)u>v?E=h:A=h,h=.5*(A-E)+E;return h},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var I=d(w);let L,P;function C(){return L==null&&(L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),L}function O(){if(P==null&&(P=!1,C())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let m=0;m<5*5;m++){const v=4*m;l.fillStyle=`rgb(${v},${v+1},${v+2})`,l.fillRect(m%5,Math.floor(m/5),1,1)}const h=l.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){P=!0;break}}}return P||!1}function z(u,l,h,m){const v=new I(u,l,h,m);return b=>v.solve(b)}const H=z(.25,.1,.25,1);function Y(u,l,h){return Math.min(h,Math.max(l,u))}function ee(u,l,h){const m=h-l,v=((u-l)%m+m)%m+l;return v===l?h:v}function te(u,...l){for(const h of l)for(const m in h)u[m]=h[m];return u}let ce=1;function K(u,l,h){const m={};for(const v in u)m[v]=l.call(this,u[v],v,u);return m}function Q(u,l,h){const m={};for(const v in u)l.call(this,u[v],v,u)&&(m[v]=u[v]);return m}function pe(u){return Array.isArray(u)?u.map(pe):typeof u=="object"&&u?K(u,pe):u}const ze={};function Fe(u){ze[u]||(typeof console<"u"&&console.warn(u),ze[u]=!0)}function qe(u,l,h){return(h.y-u.y)*(l.x-u.x)>(l.y-u.y)*(h.x-u.x)}function et(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Ne=null;function st(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ut(u,l,h,m,v){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(u,{timestamp:0});try{const E=b==null?void 0:b.format;if(!E||!E.startsWith("BGR")&&!E.startsWith("RGB"))throw new Error(`Unrecognized format ${E}`);const A=E.startsWith("BGR"),k=new Uint8ClampedArray(m*v*4);if(yield b.copyTo(k,function(B,V,W,X,J){const se=4*Math.max(-V,0),he=(Math.max(0,W)-W)*X*4+se,_e=4*X,be=Math.max(0,V),je=Math.max(0,W);return{rect:{x:be,y:je,width:Math.min(B.width,V+X)-be,height:Math.min(B.height,W+J)-je},layout:[{offset:he,stride:_e}]}}(u,l,h,m,v)),A)for(let B=0;B<k.length;B+=4){const V=k[B];k[B]=k[B+2],k[B+2]=V}return k}finally{b.close()}})}let ot,dt;const Ct="AbortError";function Vt(){return new Error(Ct)}const Re={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function mt(u){return Re.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Et="global-dispatcher";class It extends Error{constructor(l,h,m,v){super(`AJAXError: ${h} (${l}): ${m}`),this.status=l,this.statusText=h,this.url=m,this.body=v}}const vn=()=>et(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xn=function(u,l){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const m=mt(u.url);if(m)return m(u,l);if(et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Et},l)}if(!(/^file:/.test(h=u.url)||/^file:/.test(vn())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return o(this,void 0,void 0,function*(){const b=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:vn(),signal:v.signal});m.type!=="json"||b.headers.has("Accept")||b.headers.set("Accept","application/json");const E=yield fetch(b);if(!E.ok){const B=yield E.blob();throw new It(E.status,E.statusText,m.url,B)}let A;A=m.type==="arrayBuffer"||m.type==="image"?E.arrayBuffer():m.type==="json"?E.json():E.text();const k=yield A;if(v.signal.aborted)throw Vt();return{data:k,cacheControl:E.headers.get("Cache-Control"),expires:E.headers.get("Expires")}})}(u,l);if(et(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Et},l)}var h;return function(m,v){return new Promise((b,E)=>{var A;const k=new XMLHttpRequest;k.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(k.responseType="arraybuffer");for(const B in m.headers)k.setRequestHeader(B,m.headers[B]);m.type==="json"&&(k.responseType="text",!((A=m.headers)===null||A===void 0)&&A.Accept||k.setRequestHeader("Accept","application/json")),k.withCredentials=m.credentials==="include",k.onerror=()=>{E(new Error(k.statusText))},k.onload=()=>{if(!v.signal.aborted)if((k.status>=200&&k.status<300||k.status===0)&&k.response!==null){let B=k.response;if(m.type==="json")try{B=JSON.parse(k.response)}catch(V){return void E(V)}b({data:B,cacheControl:k.getResponseHeader("Cache-Control"),expires:k.getResponseHeader("Expires")})}else{const B=new Blob([k.response],{type:k.getResponseHeader("Content-Type")});E(new It(k.status,k.statusText,m.url,B))}},v.signal.addEventListener("abort",()=>{k.abort(),E(Vt())}),k.send(m.body)})}(u,l)};function at(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const l=new URL(u),h=window.location;return l.protocol===h.protocol&&l.host===h.host}function Rn(u,l,h){h[u]&&h[u].indexOf(l)!==-1||(h[u]=h[u]||[],h[u].push(l))}function Me(u,l,h){if(h&&h[u]){const m=h[u].indexOf(l);m!==-1&&h[u].splice(m,1)}}class Jn{constructor(l,h={}){te(this,h),this.type=l}}class on extends Jn{constructor(l,h={}){super("error",te({error:l},h))}}class Vn{on(l,h){return this._listeners=this._listeners||{},Rn(l,h,this._listeners),this}off(l,h){return Me(l,h,this._listeners),Me(l,h,this._oneTimeListeners),this}once(l,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Rn(l,h,this._oneTimeListeners),this):new Promise(m=>this.once(l,m))}fire(l,h){typeof l=="string"&&(l=new Jn(l,h||{}));const m=l.type;if(this.listens(m)){l.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const A of v)A.call(this,l);const b=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const A of b)Me(m,A,this._oneTimeListeners),A.call(this,l);const E=this._eventedParent;E&&(te(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),E.fire(l))}else l instanceof on&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,h){return this._eventedParent=l,this._eventedParentData=h,this}}var Te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const jn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wn(u,l){const h={};for(const m in u)m!=="ref"&&(h[m]=u[m]);return jn.forEach(m=>{m in l&&(h[m]=l[m])}),h}function jt(u,l){if(Array.isArray(u)){if(!Array.isArray(l)||u.length!==l.length)return!1;for(let h=0;h<u.length;h++)if(!jt(u[h],l[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&l!==null){if(typeof l!="object"||Object.keys(u).length!==Object.keys(l).length)return!1;for(const h in u)if(!jt(u[h],l[h]))return!1;return!0}return u===l}function me(u,l){u.push(l)}function le(u,l,h){me(h,{command:"addSource",args:[u,l[u]]})}function tt(u,l,h){me(l,{command:"removeSource",args:[u]}),h[u]=!0}function xt(u,l,h,m){tt(u,h,m),le(u,l,h)}function St(u,l,h){let m;for(m in u[h])if(Object.prototype.hasOwnProperty.call(u[h],m)&&m!=="data"&&!jt(u[h][m],l[h][m]))return!1;for(m in l[h])if(Object.prototype.hasOwnProperty.call(l[h],m)&&m!=="data"&&!jt(u[h][m],l[h][m]))return!1;return!0}function yt(u,l,h,m,v,b){u=u||{},l=l||{};for(const E in u)Object.prototype.hasOwnProperty.call(u,E)&&(jt(u[E],l[E])||h.push({command:b,args:[m,E,l[E],v]}));for(const E in l)Object.prototype.hasOwnProperty.call(l,E)&&!Object.prototype.hasOwnProperty.call(u,E)&&(jt(u[E],l[E])||h.push({command:b,args:[m,E,l[E],v]}))}function hn(u){return u.id}function zt(u,l){return u[l.id]=l,u}class Je{constructor(l,h,m,v){this.message=(l?`${l}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function cn(u,...l){for(const h of l)for(const m in h)u[m]=h[m];return u}class At extends Error{constructor(l,h){super(h),this.message=h,this.key=l}}class tn{constructor(l,h=[]){this.parent=l,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(l){return new tn(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Zn={kind:"null"},lt={kind:"number"},Mt={kind:"string"},kt={kind:"boolean"},In={kind:"color"},ii={kind:"object"},Ae={kind:"value"},Lt={kind:"collator"},gt={kind:"formatted"},ht={kind:"padding"},ae={kind:"resolvedImage"},j={kind:"variableAnchorOffsetCollection"};function Z(u,l){return{kind:"array",itemType:u,N:l}}function ne(u){if(u.kind==="array"){const l=ne(u.itemType);return typeof u.N=="number"?`array<${l}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${l}>`}return u.kind}const fe=[Zn,lt,Mt,kt,In,gt,ii,Z(Ae),ht,ae,j];function xe(u,l){if(l.kind==="error")return null;if(u.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!xe(u.itemType,l.itemType))&&(typeof u.N!="number"||u.N===l.N))return null}else{if(u.kind===l.kind)return null;if(u.kind==="value"){for(const h of fe)if(!xe(h,l))return null}}return`Expected ${ne(u)} but found ${ne(l)} instead.`}function Ie(u,l){return l.some(h=>h.kind===u.kind)}function ke(u,l){return l.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function Se(u,l){return u.kind==="array"&&l.kind==="array"?u.itemType.kind===l.itemType.kind&&typeof u.N=="number":u.kind===l.kind}const Ue=.96422,ft=.82521,Ze=4/29,rt=6/29,nn=3*rt*rt,fn=rt*rt*rt,Hn=Math.PI/180,Fn=180/Math.PI;function ni(u){return(u%=360)<0&&(u+=360),u}function wi([u,l,h,m]){let v,b;const E=yr((.2225045*(u=Ui(u))+.7168786*(l=Ui(l))+.0606169*(h=Ui(h)))/1);u===l&&l===h?v=b=E:(v=yr((.4360747*u+.3850649*l+.1430804*h)/Ue),b=yr((.0139322*u+.0971045*l+.7141733*h)/ft));const A=116*E-16;return[A<0?0:A,500*(v-E),200*(E-b),m]}function Ui(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function yr(u){return u>fn?Math.pow(u,1/3):u/nn+Ze}function oe([u,l,h,m]){let v=(u+16)/116,b=isNaN(l)?v:v+l/500,E=isNaN(h)?v:v-h/200;return v=1*Qe(v),b=Ue*Qe(b),E=ft*Qe(E),[Be(3.1338561*b-1.6168667*v-.4906146*E),Be(-.9787684*b+1.9161415*v+.033454*E),Be(.0719453*b-.2289914*v+1.4052427*E),m]}function Be(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Qe(u){return u>rt?u*u*u:nn*(u-Ze)}function it(u){return parseInt(u.padEnd(2,u),16)/255}function $e(u,l){return Pt(l?u/100:u,0,1)}function Pt(u,l,h){return Math.min(Math.max(l,u),h)}function rn(u){return!u.some(Number.isNaN)}const Cn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ft{constructor(l,h,m,v=1,b=!0){this.r=l,this.g=h,this.b=m,this.a=v,b||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[l,h,m,v]))}static parse(l){if(l instanceof Ft)return l;if(typeof l!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=Cn[m];if(v){const[E,A,k]=v;return[E/255,A/255,k/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const E=m.length<6?1:2;let A=1;return[it(m.slice(A,A+=E)),it(m.slice(A,A+=E)),it(m.slice(A,A+=E)),it(m.slice(A,A+E)||"ff")]}if(m.startsWith("rgb")){const E=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(E){const[A,k,B,V,W,X,J,se,he,_e,be,je]=E,Pe=[V||" ",J||" ",_e].join("");if(Pe==="  "||Pe==="  /"||Pe===",,"||Pe===",,,"){const Ge=[B,X,he].join(""),ct=Ge==="%%%"?100:Ge===""?255:0;if(ct){const wt=[Pt(+k/ct,0,1),Pt(+W/ct,0,1),Pt(+se/ct,0,1),be?$e(+be,je):1];if(rn(wt))return wt}}return}}const b=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[E,A,k,B,V,W,X,J,se]=b,he=[k||" ",V||" ",X].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const _e=[+A,Pt(+B,0,100),Pt(+W,0,100),J?$e(+J,se):1];if(rn(_e))return function([be,je,Pe,Ge]){function ct(wt){const Xt=(wt+be/30)%12,Dn=je*Math.min(Pe,1-Pe);return Pe-Dn*Math.max(-1,Math.min(Xt-3,9-Xt,1))}return be=ni(be),je/=100,Pe/=100,[ct(0),ct(8),ct(4),Ge]}(_e)}}}(l);return h?new Ft(...h,!1):void 0}get rgb(){const{r:l,g:h,b:m,a:v}=this,b=v||1/0;return this.overwriteGetter("rgb",[l/b,h/b,m/b,v])}get hcl(){return this.overwriteGetter("hcl",function(l){const[h,m,v,b]=wi(l),E=Math.sqrt(m*m+v*v);return[Math.round(1e4*E)?ni(Math.atan2(v,m)*Fn):NaN,E,h,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",wi(this.rgb))}overwriteGetter(l,h){return Object.defineProperty(this,l,{value:h}),h}toString(){const[l,h,m,v]=this.rgb;return`rgba(${[l,h,m].map(b=>Math.round(255*b)).join(",")},${v})`}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class zn{constructor(l,h,m){this.sensitivity=l?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,h){return this.collator.compare(l,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Un{constructor(l,h,m,v,b){this.text=l,this.image=h,this.scale=m,this.fontStack=v,this.textColor=b}}class Zt{constructor(l){this.sections=l}static fromString(l){return new Zt([new Un(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof Zt?l:Zt.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Kn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Kn)return l;if(typeof l=="number")return new Kn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const h of l)if(typeof h!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Kn(l)}}toString(){return JSON.stringify(this.values)}}const ki=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Qn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Qn)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let h=0;h<l.length;h+=2){const m=l[h],v=l[h+1];if(typeof m!="string"||!ki.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new Qn(l)}}toString(){return JSON.stringify(this.values)}}class vi{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new vi({name:l,available:!1}):null}}function pi(u,l,h,m){return typeof u=="number"&&u>=0&&u<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[u,l,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,l,h,m]:[u,l,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function pn(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof Ft||u instanceof zn||u instanceof Zt||u instanceof Kn||u instanceof Qn||u instanceof vi)return!0;if(Array.isArray(u)){for(const l of u)if(!pn(l))return!1;return!0}if(typeof u=="object"){for(const l in u)if(!pn(u[l]))return!1;return!0}return!1}function ei(u){if(u===null)return Zn;if(typeof u=="string")return Mt;if(typeof u=="boolean")return kt;if(typeof u=="number")return lt;if(u instanceof Ft)return In;if(u instanceof zn)return Lt;if(u instanceof Zt)return gt;if(u instanceof Kn)return ht;if(u instanceof Qn)return j;if(u instanceof vi)return ae;if(Array.isArray(u)){const l=u.length;let h;for(const m of u){const v=ei(m);if(h){if(h===v)continue;h=Ae;break}h=v}return Z(h||Ae,l)}return ii}function hi(u){const l=typeof u;return u===null?"":l==="string"||l==="number"||l==="boolean"?String(u):u instanceof Ft||u instanceof Zt||u instanceof Kn||u instanceof Qn||u instanceof vi?u.toString():JSON.stringify(u)}class Or{constructor(l,h){this.type=l,this.value=h}static parse(l,h){if(l.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!pn(l[1]))return h.error("invalid value");const m=l[1];let v=ei(m);const b=h.expectedType;return v.kind!=="array"||v.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(v=b),new Or(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Fi{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const br={string:Mt,number:lt,boolean:kt,object:ii};class ns{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");let m,v=1;const b=l[0];if(b==="array"){let A,k;if(l.length>2){const B=l[1];if(typeof B!="string"||!(B in br)||B==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);A=br[B],v++}else A=Ae;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return h.error('The length argument to "array" must be a positive integer literal',2);k=l[2],v++}m=Z(A,k)}else{if(!br[b])throw new Error(`Types doesn't contain name = ${b}`);m=br[b]}const E=[];for(;v<l.length;v++){const A=h.parse(l[v],v,Ae);if(!A)return null;E.push(A)}return new ns(m,E)}evaluate(l){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(l);if(!xe(this.type,ei(m)))return m;if(h===this.args.length-1)throw new Fi(`Expected value to be of type ${ne(this.type)}, but found ${ne(ei(m))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const Hi={"to-boolean":kt,"to-color":In,"to-number":lt,"to-string":Mt};class Rr{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[0];if(!Hi[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&l.length!==2)return h.error("Expected one argument.");const v=Hi[m],b=[];for(let E=1;E<l.length;E++){const A=h.parse(l[E],E,Ae);if(!A)return null;b.push(A)}return new Rr(v,b)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let h,m;for(const v of this.args){if(h=v.evaluate(l),m=null,h instanceof Ft)return h;if(typeof h=="string"){const b=l.parseColor(h);if(b)return b}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:pi(h[0],h[1],h[2],h[3]),!m))return new Ft(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Fi(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(l);const v=Kn.parse(h);if(v)return v}throw new Fi(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(l);const v=Qn.parse(h);if(v)return v}throw new Fi(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(l),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new Fi(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Zt.fromString(hi(this.args[0].evaluate(l)));case"resolvedImage":return vi.fromString(hi(this.args[0].evaluate(l)));default:return hi(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const za=["Unknown","Point","LineString","Polygon"];class Nr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?za[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let h=this._parseColorCache[l];return h||(h=this._parseColorCache[l]=Ft.parse(l)),h}}class mi{constructor(l,h,m=[],v,b=new tn,E=[]){this.registry=l,this.path=m,this.key=m.map(A=>`[${A}]`).join(""),this.scope=b,this.errors=E,this.expectedType=v,this._isConstant=h}parse(l,h,m,v,b={}){return h?this.concat(h,m,v)._parse(l,b):this._parse(l,b)}_parse(l,h){function m(v,b,E){return E==="assert"?new ns(b,[v]):E==="coerce"?new Rr(b,[v]):v}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=l[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[v];if(b){let E=b.parse(l,this);if(!E)return null;if(this.expectedType){const A=this.expectedType,k=E.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||k.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||k.kind!=="value"&&k.kind!=="string")if(A.kind!=="padding"||k.kind!=="value"&&k.kind!=="number"&&k.kind!=="array")if(A.kind!=="variableAnchorOffsetCollection"||k.kind!=="value"&&k.kind!=="array"){if(this.checkSubtype(A,k))return null}else E=m(E,A,h.typeAnnotation||"coerce");else E=m(E,A,h.typeAnnotation||"coerce");else E=m(E,A,h.typeAnnotation||"coerce");else E=m(E,A,h.typeAnnotation||"assert")}if(!(E instanceof Or)&&E.type.kind!=="resolvedImage"&&this._isConstant(E)){const A=new Nr;try{E=new Or(E.type,E.evaluate(A))}catch(k){return this.error(k.message),null}}return E}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,h,m){const v=typeof l=="number"?this.path.concat(l):this.path,b=m?this.scope.concat(m):this.scope;return new mi(this.registry,this._isConstant,v,h||null,b,this.errors)}error(l,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new At(m,l))}checkSubtype(l,h){const m=xe(l,h);return m&&this.error(m),m}}class jl{constructor(l,h){this.type=h.type,this.bindings=[].concat(l),this.result=h}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const h of this.bindings)l(h[1]);l(this.result)}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const m=[];for(let b=1;b<l.length-1;b+=2){const E=l[b];if(typeof E!="string")return h.error(`Expected string, but found ${typeof E} instead.`,b);if(/[^a-zA-Z0-9_]/.test(E))return h.error("Variable names must contain only alphanumeric characters or '_'.",b);const A=h.parse(l[b+1],b+1);if(!A)return null;m.push([E,A])}const v=h.parse(l[l.length-1],l.length-1,h.expectedType,m);return v?new jl(m,v):null}outputDefined(){return this.result.outputDefined()}}class Js{constructor(l,h){this.type=h.type,this.name=l,this.boundExpression=h}static parse(l,h){if(l.length!==2||typeof l[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=l[1];return h.scope.has(m)?new Js(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class R{constructor(l,h,m){this.type=l,this.index=h,this.input=m}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,lt),v=h.parse(l[2],2,Z(h.expectedType||Ae));return m&&v?new R(v.type.itemType,m,v):null}evaluate(l){const h=this.index.evaluate(l),m=this.input.evaluate(l);if(h<0)throw new Fi(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Fi(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Fi(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class U{constructor(l,h){this.type=kt,this.needle=l,this.haystack=h}static parse(l,h){if(l.length!==3)return h.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Ae),v=h.parse(l[2],2,Ae);return m&&v?Ie(m.type,[kt,Mt,lt,Zn,Ae])?new U(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(m.type)} instead`):null}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!m)return!1;if(!ke(h,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${ne(ei(h))} instead.`);if(!ke(m,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${ne(ei(m))} instead.`);return m.indexOf(h)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class ie{constructor(l,h,m){this.type=lt,this.needle=l,this.haystack=h,this.fromIndex=m}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Ae),v=h.parse(l[2],2,Ae);if(!m||!v)return null;if(!Ie(m.type,[kt,Mt,lt,Zn,Ae]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(m.type)} instead`);if(l.length===4){const b=h.parse(l[3],3,lt);return b?new ie(m,v,b):null}return new ie(m,v)}evaluate(l){const h=this.needle.evaluate(l),m=this.haystack.evaluate(l);if(!ke(h,["boolean","string","number","null"]))throw new Fi(`Expected first argument to be of type boolean, string, number or null, but found ${ne(ei(h))} instead.`);if(!ke(m,["string","array"]))throw new Fi(`Expected second argument to be of type array or string, but found ${ne(ei(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(l);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class ve{constructor(l,h,m,v,b,E){this.inputType=l,this.type=h,this.input=m,this.cases=v,this.outputs=b,this.otherwise=E}static parse(l,h){if(l.length<5)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const b={},E=[];for(let B=2;B<l.length-1;B+=2){let V=l[B];const W=l[B+1];Array.isArray(V)||(V=[V]);const X=h.concat(B);if(V.length===0)return X.error("Expected at least one branch label.");for(const se of V){if(typeof se!="number"&&typeof se!="string")return X.error("Branch labels must be numbers or strings.");if(typeof se=="number"&&Math.abs(se)>Number.MAX_SAFE_INTEGER)return X.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof se=="number"&&Math.floor(se)!==se)return X.error("Numeric branch labels must be integer values.");if(m){if(X.checkSubtype(m,ei(se)))return null}else m=ei(se);if(b[String(se)]!==void 0)return X.error("Branch labels must be unique.");b[String(se)]=E.length}const J=h.parse(W,B,v);if(!J)return null;v=v||J.type,E.push(J)}const A=h.parse(l[1],1,Ae);if(!A)return null;const k=h.parse(l[l.length-1],l.length-1,v);return k?A.type.kind!=="value"&&h.concat(1).checkSubtype(m,A.type)?null:new ve(m,v,A,b,E,k):null}evaluate(l){const h=this.input.evaluate(l);return(ei(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class Le{constructor(l,h,m){this.type=l,this.branches=h,this.otherwise=m}static parse(l,h){if(l.length<4)return h.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let E=1;E<l.length-1;E+=2){const A=h.parse(l[E],E,kt);if(!A)return null;const k=h.parse(l[E+1],E+1,m);if(!k)return null;v.push([A,k]),m=m||k.type}const b=h.parse(l[l.length-1],l.length-1,m);if(!b)return null;if(!m)throw new Error("Can't infer output type");return new Le(m,v,b)}evaluate(l){for(const[h,m]of this.branches)if(h.evaluate(l))return m.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[h,m]of this.branches)l(h),l(m);l(this.otherwise)}outputDefined(){return this.branches.every(([l,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class De{constructor(l,h,m,v){this.type=l,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(l,h){if(l.length<=2||l.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const m=h.parse(l[1],1,Ae),v=h.parse(l[2],2,lt);if(!m||!v)return null;if(!Ie(m.type,[Z(Ae),Mt,Ae]))return h.error(`Expected first argument to be of type array or string, but found ${ne(m.type)} instead`);if(l.length===4){const b=h.parse(l[3],3,lt);return b?new De(m.type,m,v,b):null}return new De(m.type,m,v)}evaluate(l){const h=this.input.evaluate(l),m=this.beginIndex.evaluate(l);if(!ke(h,["string","array"]))throw new Fi(`Expected first argument to be of type array or string, but found ${ne(ei(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(l);return h.slice(m,v)}return h.slice(m)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function He(u,l){const h=u.length-1;let m,v,b=0,E=h,A=0;for(;b<=E;)if(A=Math.floor((b+E)/2),m=u[A],v=u[A+1],m<=l){if(A===h||l<v)return A;b=A+1}else{if(!(m>l))throw new Fi("Input is not a number.");E=A-1}return 0}class Tt{constructor(l,h,m){this.type=l,this.input=h,this.labels=[],this.outputs=[];for(const[v,b]of m)this.labels.push(v),this.outputs.push(b)}static parse(l,h){if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(l[1],1,lt);if(!m)return null;const v=[];let b=null;h.expectedType&&h.expectedType.kind!=="value"&&(b=h.expectedType);for(let E=1;E<l.length;E+=2){const A=E===1?-1/0:l[E],k=l[E+1],B=E,V=E+1;if(typeof A!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(v.length&&v[v.length-1][0]>=A)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);const W=h.parse(k,V,b);if(!W)return null;b=b||W.type,v.push([A,W])}return new Tt(b,m,v)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const v=this.input.evaluate(l);if(v<=h[0])return m[0].evaluate(l);const b=h.length;return v>=h[b-1]?m[b-1].evaluate(l):m[He(h,v)].evaluate(l)}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Ot(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Kt=Yt;function Yt(u,l,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(m-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=l,this.p2x=h,this.p2y=m}Yt.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,l){if(l===void 0&&(l=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<l)return h;var b=this.sampleCurveDerivativeX(h);if(Math.abs(b)<1e-6)break;h-=v/b}var E=0,A=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<l));m++)u>v?E=h:A=h,h=.5*(A-E)+E;return h},solve:function(u,l){return this.sampleCurveY(this.solveCurveX(u,l))}};var Gt=Ot(Kt);function Nn(u,l,h){return u+h*(l-u)}function Xi(u,l,h){return u.map((m,v)=>Nn(m,l[v],h))}const kn={number:Nn,color:function(u,l,h,m="rgb"){switch(m){case"rgb":{const[v,b,E,A]=Xi(u.rgb,l.rgb,h);return new Ft(v,b,E,A,!1)}case"hcl":{const[v,b,E,A]=u.hcl,[k,B,V,W]=l.hcl;let X,J;if(isNaN(v)||isNaN(k))isNaN(v)?isNaN(k)?X=NaN:(X=k,E!==1&&E!==0||(J=B)):(X=v,V!==1&&V!==0||(J=b));else{let je=k-v;k>v&&je>180?je-=360:k<v&&v-k>180&&(je+=360),X=v+h*je}const[se,he,_e,be]=function([je,Pe,Ge,ct]){return je=isNaN(je)?0:je*Hn,oe([Ge,Math.cos(je)*Pe,Math.sin(je)*Pe,ct])}([X,J??Nn(b,B,h),Nn(E,V,h),Nn(A,W,h)]);return new Ft(se,he,_e,be,!1)}case"lab":{const[v,b,E,A]=oe(Xi(u.lab,l.lab,h));return new Ft(v,b,E,A,!1)}}},array:Xi,padding:function(u,l,h){return new Kn(Xi(u.values,l.values,h))},variableAnchorOffsetCollection:function(u,l,h){const m=u.values,v=l.values;if(m.length!==v.length)throw new Fi(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${l.toString()}`);const b=[];for(let E=0;E<m.length;E+=2){if(m[E]!==v[E])throw new Fi(`Cannot interpolate values containing mismatched anchors. from[${E}]: ${m[E]}, to[${E}]: ${v[E]}`);b.push(m[E]);const[A,k]=m[E+1],[B,V]=v[E+1];b.push([Nn(A,B,h),Nn(k,V,h)])}return new Qn(b)}};class Ei{constructor(l,h,m,v,b){this.type=l,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[E,A]of b)this.labels.push(E),this.outputs.push(A)}static interpolationFactor(l,h,m,v){let b=0;if(l.name==="exponential")b=vt(h,l.base,m,v);else if(l.name==="linear")b=vt(h,1,m,v);else if(l.name==="cubic-bezier"){const E=l.controlPoints;b=new Gt(E[0],E[1],E[2],E[3]).solve(vt(h,1,m,v))}return b}static parse(l,h){let[m,v,b,...E]=l;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const B=v[1];if(typeof B!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:B}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const B=v.slice(1);if(B.length!==4||B.some(V=>typeof V!="number"||V<0||V>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:B}}}if(l.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(b=h.parse(b,2,lt),!b)return null;const A=[];let k=null;m==="interpolate-hcl"||m==="interpolate-lab"?k=In:h.expectedType&&h.expectedType.kind!=="value"&&(k=h.expectedType);for(let B=0;B<E.length;B+=2){const V=E[B],W=E[B+1],X=B+3,J=B+4;if(typeof V!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',X);if(A.length&&A[A.length-1][0]>=V)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',X);const se=h.parse(W,J,k);if(!se)return null;k=k||se.type,A.push([V,se])}return Se(k,lt)||Se(k,In)||Se(k,ht)||Se(k,j)||Se(k,Z(lt))?new Ei(k,m,v,b,A):h.error(`Type ${ne(k)} is not interpolatable.`)}evaluate(l){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(l);const v=this.input.evaluate(l);if(v<=h[0])return m[0].evaluate(l);const b=h.length;if(v>=h[b-1])return m[b-1].evaluate(l);const E=He(h,v),A=Ei.interpolationFactor(this.interpolation,v,h[E],h[E+1]),k=m[E].evaluate(l),B=m[E+1].evaluate(l);switch(this.operator){case"interpolate":return kn[this.type.kind](k,B,A);case"interpolate-hcl":return kn.color(k,B,A,"hcl");case"interpolate-lab":return kn.color(k,B,A,"lab")}}eachChild(l){l(this.input);for(const h of this.outputs)l(h)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function vt(u,l,h,m){const v=m-h,b=u-h;return v===0?0:l===1?b/v:(Math.pow(l,b)-1)/(Math.pow(l,v)-1)}class bn{constructor(l,h){this.type=l,this.args=h}static parse(l,h){if(l.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const b=[];for(const A of l.slice(1)){const k=h.parse(A,1+b.length,m,void 0,{typeAnnotation:"omit"});if(!k)return null;m=m||k.type,b.push(k)}if(!m)throw new Error("No output type");const E=v&&b.some(A=>xe(v,A.type));return new bn(E?Ae:m,b)}evaluate(l){let h,m=null,v=0;for(const b of this.args)if(v++,m=b.evaluate(l),m&&m instanceof vi&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function Ri(u,l){return u==="=="||u==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Lr(u,l,h,m){return m.compare(l,h)===0}function nr(u,l,h){const m=u!=="=="&&u!=="!=";return class pU{constructor(b,E,A){this.type=kt,this.lhs=b,this.rhs=E,this.collator=A,this.hasUntypedArgument=b.type.kind==="value"||E.type.kind==="value"}static parse(b,E){if(b.length!==3&&b.length!==4)return E.error("Expected two or three arguments.");const A=b[0];let k=E.parse(b[1],1,Ae);if(!k)return null;if(!Ri(A,k.type))return E.concat(1).error(`"${A}" comparisons are not supported for type '${ne(k.type)}'.`);let B=E.parse(b[2],2,Ae);if(!B)return null;if(!Ri(A,B.type))return E.concat(2).error(`"${A}" comparisons are not supported for type '${ne(B.type)}'.`);if(k.type.kind!==B.type.kind&&k.type.kind!=="value"&&B.type.kind!=="value")return E.error(`Cannot compare types '${ne(k.type)}' and '${ne(B.type)}'.`);m&&(k.type.kind==="value"&&B.type.kind!=="value"?k=new ns(B.type,[k]):k.type.kind!=="value"&&B.type.kind==="value"&&(B=new ns(k.type,[B])));let V=null;if(b.length===4){if(k.type.kind!=="string"&&B.type.kind!=="string"&&k.type.kind!=="value"&&B.type.kind!=="value")return E.error("Cannot use collator to compare non-string types.");if(V=E.parse(b[3],3,Lt),!V)return null}return new pU(k,B,V)}evaluate(b){const E=this.lhs.evaluate(b),A=this.rhs.evaluate(b);if(m&&this.hasUntypedArgument){const k=ei(E),B=ei(A);if(k.kind!==B.kind||k.kind!=="string"&&k.kind!=="number")throw new Fi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${k.kind}, ${B.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const k=ei(E),B=ei(A);if(k.kind!=="string"||B.kind!=="string")return l(b,E,A)}return this.collator?h(b,E,A,this.collator.evaluate(b)):l(b,E,A)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Dd=nr("==",function(u,l,h){return l===h},Lr),Yf=nr("!=",function(u,l,h){return l!==h},function(u,l,h,m){return!Lr(0,l,h,m)}),Zi=nr("<",function(u,l,h){return l<h},function(u,l,h,m){return m.compare(l,h)<0}),Kf=nr(">",function(u,l,h){return l>h},function(u,l,h,m){return m.compare(l,h)>0}),Bg=nr("<=",function(u,l,h){return l<=h},function(u,l,h,m){return m.compare(l,h)<=0}),ua=nr(">=",function(u,l,h){return l>=h},function(u,l,h,m){return m.compare(l,h)>=0});class $c{constructor(l,h,m){this.type=Lt,this.locale=m,this.caseSensitive=l,this.diacriticSensitive=h}static parse(l,h){if(l.length!==2)return h.error("Expected one argument.");const m=l[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,kt);if(!v)return null;const b=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,kt);if(!b)return null;let E=null;return m.locale&&(E=h.parse(m.locale,1,Mt),!E)?null:new $c(v,b,E)}evaluate(l){return new zn(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class nh{constructor(l,h,m,v,b){this.type=Mt,this.number=l,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=b}static parse(l,h){if(l.length!==3)return h.error("Expected two arguments.");const m=h.parse(l[1],1,lt);if(!m)return null;const v=l[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let b=null;if(v.locale&&(b=h.parse(v.locale,1,Mt),!b))return null;let E=null;if(v.currency&&(E=h.parse(v.currency,1,Mt),!E))return null;let A=null;if(v["min-fraction-digits"]&&(A=h.parse(v["min-fraction-digits"],1,lt),!A))return null;let k=null;return v["max-fraction-digits"]&&(k=h.parse(v["max-fraction-digits"],1,lt),!k)?null:new nh(m,b,E,A,k)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class qc{constructor(l){this.type=gt,this.sections=l}static parse(l,h){if(l.length<2)return h.error("Expected at least one argument.");const m=l[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let b=!1;for(let E=1;E<=l.length-1;++E){const A=l[E];if(b&&typeof A=="object"&&!Array.isArray(A)){b=!1;let k=null;if(A["font-scale"]&&(k=h.parse(A["font-scale"],1,lt),!k))return null;let B=null;if(A["text-font"]&&(B=h.parse(A["text-font"],1,Z(Mt)),!B))return null;let V=null;if(A["text-color"]&&(V=h.parse(A["text-color"],1,In),!V))return null;const W=v[v.length-1];W.scale=k,W.font=B,W.textColor=V}else{const k=h.parse(l[E],1,Ae);if(!k)return null;const B=k.type.kind;if(B!=="string"&&B!=="value"&&B!=="null"&&B!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,v.push({content:k,scale:null,font:null,textColor:null})}}return new qc(v)}evaluate(l){return new Zt(this.sections.map(h=>{const m=h.content.evaluate(l);return ei(m)===ae?new Un("",m,null,null,null):new Un(hi(m),null,h.scale?h.scale.evaluate(l):null,h.font?h.font.evaluate(l).join(","):null,h.textColor?h.textColor.evaluate(l):null)}))}eachChild(l){for(const h of this.sections)l(h.content),h.scale&&l(h.scale),h.font&&l(h.font),h.textColor&&l(h.textColor)}outputDefined(){return!1}}class Xc{constructor(l){this.type=ae,this.input=l}static parse(l,h){if(l.length!==2)return h.error("Expected two arguments.");const m=h.parse(l[1],1,Mt);return m?new Xc(m):h.error("No image name provided.")}evaluate(l){const h=this.input.evaluate(l),m=vi.fromString(h);return m&&l.availableImages&&(m.available=l.availableImages.indexOf(h)>-1),m}eachChild(l){l(this.input)}outputDefined(){return!1}}class $l{constructor(l){this.type=lt,this.input=l}static parse(l,h){if(l.length!==2)return h.error(`Expected 1 argument, but found ${l.length-1} instead.`);const m=h.parse(l[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ne(m.type)} instead.`):new $l(m):null}evaluate(l){const h=this.input.evaluate(l);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Fi(`Expected value to be of type string or array, but found ${ne(ei(h))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const _s=8192;function Ti(u,l){const h=(180+u[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,v=Math.pow(2,l.z);return[Math.round(h*v*_s),Math.round(m*v*_s)]}function kd(u,l){const h=Math.pow(2,l.z);return[(v=(u[0]/_s+l.x)/h,360*v-180),(m=(u[1]/_s+l.y)/h,360/Math.PI*Math.atan(Math.exp((180-360*m)*Math.PI/180))-90)];var m,v}function Zc(u,l){u[0]=Math.min(u[0],l[0]),u[1]=Math.min(u[1],l[1]),u[2]=Math.max(u[2],l[0]),u[3]=Math.max(u[3],l[1])}function ql(u,l){return!(u[0]<=l[0]||u[2]>=l[2]||u[1]<=l[1]||u[3]>=l[3])}function Jf(u,l,h){const m=u[0]-l[0],v=u[1]-l[1],b=u[0]-h[0],E=u[1]-h[1];return m*E-b*v==0&&m*b<=0&&v*E<=0}function Yc(u,l,h,m){return(v=[m[0]-h[0],m[1]-h[1]])[0]*(b=[l[0]-u[0],l[1]-u[1]])[1]-v[1]*b[0]!=0&&!(!So(u,l,h,m)||!So(h,m,u,l));var v,b}function Ug(u,l,h){for(const m of h)for(let v=0;v<m.length-1;++v)if(Yc(u,l,m[v],m[v+1]))return!0;return!1}function Xl(u,l,h=!1){let m=!1;for(const A of l)for(let k=0;k<A.length-1;k++){if(Jf(u,A[k],A[k+1]))return h;(b=A[k])[1]>(v=u)[1]!=(E=A[k+1])[1]>v[1]&&v[0]<(E[0]-b[0])*(v[1]-b[1])/(E[1]-b[1])+b[0]&&(m=!m)}var v,b,E;return m}function ih(u,l){for(const h of l)if(Xl(u,h))return!0;return!1}function rh(u,l){for(const h of u)if(!Xl(h,l))return!1;for(let h=0;h<u.length-1;++h)if(Ug(u[h],u[h+1],l))return!1;return!0}function Qf(u,l){for(const h of l)if(rh(u,h))return!0;return!1}function So(u,l,h,m){const v=m[0]-h[0],b=m[1]-h[1],E=(u[0]-h[0])*b-v*(u[1]-h[1]),A=(l[0]-h[0])*b-v*(l[1]-h[1]);return E>0&&A<0||E<0&&A>0}function sh(u,l,h){const m=[];for(let v=0;v<u.length;v++){const b=[];for(let E=0;E<u[v].length;E++){const A=Ti(u[v][E],h);Zc(l,A),b.push(A)}m.push(b)}return m}function Fd(u,l,h){const m=[];for(let v=0;v<u.length;v++){const b=sh(u[v],l,h);m.push(b)}return m}function ep(u,l,h,m){if(u[0]<h[0]||u[0]>h[2]){const v=.5*m;let b=u[0]-h[0]>v?-m:h[0]-u[0]>v?m:0;b===0&&(b=u[0]-h[2]>v?-m:h[2]-u[0]>v?m:0),u[0]+=b}Zc(l,u)}function Od(u,l,h,m){const v=Math.pow(2,m.z)*_s,b=[m.x*_s,m.y*_s],E=[];for(const A of u)for(const k of A){const B=[k.x+b[0],k.y+b[1]];ep(B,l,h,v),E.push(B)}return E}function Kc(u,l,h,m){const v=Math.pow(2,m.z)*_s,b=[m.x*_s,m.y*_s],E=[];for(const k of u){const B=[];for(const V of k){const W=[V.x+b[0],V.y+b[1]];Zc(l,W),B.push(W)}E.push(B)}if(l[2]-l[0]<=v/2){(A=l)[0]=A[1]=1/0,A[2]=A[3]=-1/0;for(const k of E)for(const B of k)ep(B,l,h,v)}var A;return E}class Ba{constructor(l,h){this.type=kt,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(pn(l[1])){const m=l[1];if(m.type==="FeatureCollection"){const v=[];for(const b of m.features){const{type:E,coordinates:A}=b.geometry;E==="Polygon"&&v.push(A),E==="MultiPolygon"&&v.push(...A)}if(v.length)return new Ba(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Ba(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Ba(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(m.type==="Polygon"){const A=sh(m.coordinates,b,E),k=Od(h.geometry(),v,b,E);if(!ql(v,b))return!1;for(const B of k)if(!Xl(B,A))return!1}if(m.type==="MultiPolygon"){const A=Fd(m.coordinates,b,E),k=Od(h.geometry(),v,b,E);if(!ql(v,b))return!1;for(const B of k)if(!ih(B,A))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],E=h.canonicalID();if(m.type==="Polygon"){const A=sh(m.coordinates,b,E),k=Kc(h.geometry(),v,b,E);if(!ql(v,b))return!1;for(const B of k)if(!rh(B,A))return!1}if(m.type==="MultiPolygon"){const A=Fd(m.coordinates,b,E),k=Kc(h.geometry(),v,b,E);if(!ql(v,b))return!1;for(const B of k)if(!Qf(B,A))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Nd=class{constructor(u=[],l=Vg){if(this.data=u,this.length=this.data.length,this.compare=l,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(u){this.data.push(u),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const u=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),u}peek(){return this.data[0]}_up(u){const{data:l,compare:h}=this,m=l[u];for(;u>0;){const v=u-1>>1,b=l[v];if(h(m,b)>=0)break;l[u]=b,u=v}l[u]=m}_down(u){const{data:l,compare:h}=this,m=this.length>>1,v=l[u];for(;u<m;){let b=1+(u<<1),E=l[b];const A=b+1;if(A<this.length&&h(l[A],E)<0&&(b=A,E=l[A]),h(E,v)>=0)break;l[u]=E,u=b}l[u]=v}};function Vg(u,l){return u<l?-1:u>l?1:0}function dl(u,l,h,m,v){zd(u,l,h,m||u.length-1,v||Gg)}function zd(u,l,h,m,v){for(;m>h;){if(m-h>600){var b=m-h+1,E=l-h+1,A=Math.log(b),k=.5*Math.exp(2*A/3),B=.5*Math.sqrt(A*k*(b-k)/b)*(E-b/2<0?-1:1);zd(u,l,Math.max(h,Math.floor(l-E*k/b+B)),Math.min(m,Math.floor(l+(b-E)*k/b+B)),v)}var V=u[l],W=h,X=m;for(Jc(u,h,l),v(u[m],V)>0&&Jc(u,h,m);W<X;){for(Jc(u,W,X),W++,X--;v(u[W],V)<0;)W++;for(;v(u[X],V)>0;)X--}v(u[h],V)===0?Jc(u,h,X):Jc(u,++X,m),X<=l&&(h=X+1),l<=X&&(m=X-1)}}function Jc(u,l,h){var m=u[l];u[l]=u[h],u[h]=m}function Gg(u,l){return u<l?-1:u>l?1:0}function Zl(u,l){if(u.length<=1)return[u];const h=[];let m,v;for(const b of u){const E=Bd(b);E!==0&&(b.area=Math.abs(E),v===void 0&&(v=E<0),v===E<0?(m&&h.push(m),m=[b]):m.push(b))}if(m&&h.push(m),l>1)for(let b=0;b<h.length;b++)h[b].length<=l||(dl(h[b],l,1,h[b].length-1,Qc),h[b]=h[b].slice(0,l));return h}function Qc(u,l){return l.area-u.area}function Bd(u){let l=0;for(let h,m,v=0,b=u.length,E=b-1;v<b;E=v++)h=u[v],m=u[E],l+=(m.x-h.x)*(h.y+m.y);return l}const oh=1/298.257223563,ah=oh*(2-oh),Yl=Math.PI/180;class Ud{constructor(l){const h=6378.137*Yl*1e3,m=Math.cos(l*Yl),v=1/(1-ah*(1-m*m)),b=Math.sqrt(v);this.kx=h*b*m,this.ky=h*b*v*(1-ah)}distance(l,h){const m=this.wrap(l[0]-h[0])*this.kx,v=(l[1]-h[1])*this.ky;return Math.sqrt(m*m+v*v)}pointOnLine(l,h){let m,v,b,E,A=1/0;for(let k=0;k<l.length-1;k++){let B=l[k][0],V=l[k][1],W=this.wrap(l[k+1][0]-B)*this.kx,X=(l[k+1][1]-V)*this.ky,J=0;W===0&&X===0||(J=(this.wrap(h[0]-B)*this.kx*W+(h[1]-V)*this.ky*X)/(W*W+X*X),J>1?(B=l[k+1][0],V=l[k+1][1]):J>0&&(B+=W/this.kx*J,V+=X/this.ky*J)),W=this.wrap(h[0]-B)*this.kx,X=(h[1]-V)*this.ky;const se=W*W+X*X;se<A&&(A=se,m=B,v=V,b=k,E=J)}return{point:[m,v],index:b,t:Math.max(0,Math.min(1,E))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function tp(u,l){return l[0]-u[0]}function Kl(u){return u[1]-u[0]+1}function ha(u,l){return u[1]>=u[0]&&u[1]<l}function Vd(u,l){if(u[0]>u[1])return[null,null];const h=Kl(u);if(l){if(h===2)return[u,null];const v=Math.floor(h/2);return[[u[0],u[0]+v],[u[0]+v,u[1]]]}if(h===1)return[u,null];const m=Math.floor(h/2)-1;return[[u[0],u[0]+m],[u[0]+m+1,u[1]]]}function lh(u,l){if(!ha(l,u.length))return[1/0,1/0,-1/0,-1/0];const h=[1/0,1/0,-1/0,-1/0];for(let m=l[0];m<=l[1];++m)Zc(h,u[m]);return h}function eu(u){const l=[1/0,1/0,-1/0,-1/0];for(const h of u)for(const m of h)Zc(l,m);return l}function Vi(u){return u[0]!==-1/0&&u[1]!==-1/0&&u[2]!==1/0&&u[3]!==1/0}function Mo(u,l,h){if(!Vi(u)||!Vi(l))return NaN;let m=0,v=0;return u[2]<l[0]&&(m=l[0]-u[2]),u[0]>l[2]&&(m=u[0]-l[2]),u[1]>l[3]&&(v=u[1]-l[3]),u[3]<l[1]&&(v=l[1]-u[3]),h.distance([0,0],[m,v])}function $n(u,l,h){const m=h.pointOnLine(l,u);return h.distance(u,m.point)}function Ua(u,l,h,m,v){const b=Math.min($n(u,[h,m],v),$n(l,[h,m],v)),E=Math.min($n(h,[u,l],v),$n(m,[u,l],v));return Math.min(b,E)}function Li(u,l,h,m,v){if(!ha(l,u.length)||!ha(m,h.length))return 1/0;let b=1/0;for(let E=l[0];E<l[1];++E){const A=u[E],k=u[E+1];for(let B=m[0];B<m[1];++B){const V=h[B],W=h[B+1];if(Yc(A,k,V,W))return 0;b=Math.min(b,Ua(A,k,V,W,v))}}return b}function ir(u,l,h,m,v){if(!ha(l,u.length)||!ha(m,h.length))return NaN;let b=1/0;for(let E=l[0];E<=l[1];++E)for(let A=m[0];A<=m[1];++A)if(b=Math.min(b,v.distance(u[E],h[A])),b===0)return b;return b}function fl(u,l,h){if(Xl(u,l,!0))return 0;let m=1/0;for(const v of l){const b=v[0],E=v[v.length-1];if(b!==E&&(m=Math.min(m,$n(u,[E,b],h)),m===0))return m;const A=h.pointOnLine(v,u);if(m=Math.min(m,h.distance(u,A.point)),m===0)return m}return m}function Jl(u,l,h,m){if(!ha(l,u.length))return NaN;for(let b=l[0];b<=l[1];++b)if(Xl(u[b],h,!0))return 0;let v=1/0;for(let b=l[0];b<l[1];++b){const E=u[b],A=u[b+1];for(const k of h)for(let B=0,V=k.length,W=V-1;B<V;W=B++){const X=k[W],J=k[B];if(Yc(E,A,X,J))return 0;v=Math.min(v,Ua(E,A,X,J,m))}}return v}function ch(u,l){for(const h of u)for(const m of h)if(Xl(m,l,!0))return!0;return!1}function np(u,l,h,m=1/0){const v=eu(u),b=eu(l);if(m!==1/0&&Mo(v,b,h)>=m)return m;if(ql(v,b)){if(ch(u,l))return 0}else if(ch(l,u))return 0;let E=1/0;for(const A of u)for(let k=0,B=A.length,V=B-1;k<B;V=k++){const W=A[V],X=A[k];for(const J of l)for(let se=0,he=J.length,_e=he-1;se<he;_e=se++){const be=J[_e],je=J[se];if(Yc(W,X,be,je))return 0;E=Math.min(E,Ua(W,X,be,je,h))}}return E}function ip(u,l,h,m,v,b){if(!b)return;const E=Mo(lh(m,b),v,h);E<l&&u.push([E,b,[0,0]])}function uh(u,l,h,m,v,b,E){if(!b||!E)return;const A=Mo(lh(m,b),lh(v,E),h);A<l&&u.push([A,b,E])}function tu(u,l,h,m,v=1/0){let b=Math.min(m.distance(u[0],h[0][0]),v);if(b===0)return b;const E=new Nd([[0,[0,u.length-1],[0,0]]],tp),A=eu(h);for(;E.length>0;){const k=E.pop();if(k[0]>=b)continue;const B=k[1],V=l?50:100;if(Kl(B)<=V){if(!ha(B,u.length))return NaN;if(l){const W=Jl(u,B,h,m);if(isNaN(W)||W===0)return W;b=Math.min(b,W)}else for(let W=B[0];W<=B[1];++W){const X=fl(u[W],h,m);if(b=Math.min(b,X),b===0)return 0}}else{const W=Vd(B,l);ip(E,b,m,u,A,W[0]),ip(E,b,m,u,A,W[1])}}return b}function Ql(u,l,h,m,v,b=1/0){let E=Math.min(b,v.distance(u[0],h[0]));if(E===0)return E;const A=new Nd([[0,[0,u.length-1],[0,h.length-1]]],tp);for(;A.length>0;){const k=A.pop();if(k[0]>=E)continue;const B=k[1],V=k[2],W=l?50:100,X=m?50:100;if(Kl(B)<=W&&Kl(V)<=X){if(!ha(B,u.length)&&ha(V,h.length))return NaN;let J;if(l&&m)J=Li(u,B,h,V,v),E=Math.min(E,J);else if(l&&!m){const se=u.slice(B[0],B[1]+1);for(let he=V[0];he<=V[1];++he)if(J=$n(h[he],se,v),E=Math.min(E,J),E===0)return E}else if(!l&&m){const se=h.slice(V[0],V[1]+1);for(let he=B[0];he<=B[1];++he)if(J=$n(u[he],se,v),E=Math.min(E,J),E===0)return E}else J=ir(u,B,h,V,v),E=Math.min(E,J)}else{const J=Vd(B,l),se=Vd(V,m);uh(A,E,v,u,h,J[0],se[0]),uh(A,E,v,u,h,J[0],se[1]),uh(A,E,v,u,h,J[1],se[0]),uh(A,E,v,u,h,J[1],se[1])}}return E}function pl(u){return u.type==="MultiPolygon"?u.coordinates.map(l=>({type:"Polygon",coordinates:l})):u.type==="MultiLineString"?u.coordinates.map(l=>({type:"LineString",coordinates:l})):u.type==="MultiPoint"?u.coordinates.map(l=>({type:"Point",coordinates:l})):[u]}class Os{constructor(l,h){this.type=lt,this.geojson=l,this.geometries=h}static parse(l,h){if(l.length!==2)return h.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(pn(l[1])){const m=l[1];if(m.type==="FeatureCollection")return new Os(m,m.features.map(v=>pl(v.geometry)).flat());if(m.type==="Feature")return new Os(m,pl(m.geometry));if("type"in m&&"coordinates"in m)return new Os(m,pl(m))}return h.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(h,m){const v=h.geometry(),b=v.flat().map(k=>kd([k.x,k.y],h.canonical));if(v.length===0)return NaN;const E=new Ud(b[0][1]);let A=1/0;for(const k of m){switch(k.type){case"Point":A=Math.min(A,Ql(b,!1,[k.coordinates],!1,E,A));break;case"LineString":A=Math.min(A,Ql(b,!1,k.coordinates,!0,E,A));break;case"Polygon":A=Math.min(A,tu(b,!1,k.coordinates,E,A))}if(A===0)return A}return A}(l,this.geometries);if(l.geometryType()==="LineString")return function(h,m){const v=h.geometry(),b=v.flat().map(k=>kd([k.x,k.y],h.canonical));if(v.length===0)return NaN;const E=new Ud(b[0][1]);let A=1/0;for(const k of m){switch(k.type){case"Point":A=Math.min(A,Ql(b,!0,[k.coordinates],!1,E,A));break;case"LineString":A=Math.min(A,Ql(b,!0,k.coordinates,!0,E,A));break;case"Polygon":A=Math.min(A,tu(b,!0,k.coordinates,E,A))}if(A===0)return A}return A}(l,this.geometries);if(l.geometryType()==="Polygon")return function(h,m){const v=h.geometry();if(v.length===0||v[0].length===0)return NaN;const b=Zl(v,0).map(k=>k.map(B=>B.map(V=>kd([V.x,V.y],h.canonical)))),E=new Ud(b[0][0][0][1]);let A=1/0;for(const k of m)for(const B of b){switch(k.type){case"Point":A=Math.min(A,tu([k.coordinates],!1,B,E,A));break;case"LineString":A=Math.min(A,tu(k.coordinates,!0,B,E,A));break;case"Polygon":A=Math.min(A,np(B,k.coordinates,E,A))}if(A===0)return A}return A}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ml={"==":Dd,"!=":Yf,">":Kf,"<":Zi,">=":ua,"<=":Bg,array:ns,at:R,boolean:ns,case:Le,coalesce:bn,collator:$c,format:qc,image:Xc,in:U,"index-of":ie,interpolate:Ei,"interpolate-hcl":Ei,"interpolate-lab":Ei,length:$l,let:jl,literal:Or,match:ve,number:ns,"number-format":nh,object:ns,slice:De,step:Tt,string:ns,"to-boolean":Rr,"to-color":Rr,"to-number":Rr,"to-string":Rr,var:Js,within:Ba,distance:Os};class Sr{constructor(l,h,m,v){this.name=l,this.type=h,this._evaluate=m,this.args=v}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,h){const m=l[0],v=Sr.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(v)?v[0]:v.type,E=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,A=E.filter(([B])=>!Array.isArray(B)||B.length===l.length-1);let k=null;for(const[B,V]of A){k=new mi(h.registry,_l,h.path,null,h.scope);const W=[];let X=!1;for(let J=1;J<l.length;J++){const se=l[J],he=Array.isArray(B)?B[J-1]:B.type,_e=k.parse(se,1+W.length,he);if(!_e){X=!0;break}W.push(_e)}if(!X)if(Array.isArray(B)&&B.length!==W.length)k.error(`Expected ${B.length} arguments, but found ${W.length} instead.`);else{for(let J=0;J<W.length;J++){const se=Array.isArray(B)?B[J]:B.type,he=W[J];k.concat(J+1).checkSubtype(se,he.type)}if(k.errors.length===0)return new Sr(m,b,V,W)}}if(A.length===1)h.errors.push(...k.errors);else{const B=(A.length?A:E).map(([W])=>{return X=W,Array.isArray(X)?`(${X.map(ne).join(", ")})`:`(${ne(X.type)}...)`;var X}).join(" | "),V=[];for(let W=1;W<l.length;W++){const X=h.parse(l[W],1+V.length);if(!X)return null;V.push(ne(X.type))}h.error(`Expected arguments of type ${B}, but found (${V.join(", ")}) instead.`)}return null}static register(l,h){Sr.definitions=h;for(const m in h)l[m]=Sr}}function rp(u,[l,h,m,v]){l=l.evaluate(u),h=h.evaluate(u),m=m.evaluate(u);const b=v?v.evaluate(u):1,E=pi(l,h,m,b);if(E)throw new Fi(E);return new Ft(l/255,h/255,m/255,b,!1)}function Va(u,l){return u in l}function hh(u,l){const h=l[u];return h===void 0?null:h}function gl(u){return{type:u}}function _l(u){if(u instanceof Js)return _l(u.boundExpression);if(u instanceof Sr&&u.name==="error"||u instanceof $c||u instanceof Ba||u instanceof Os)return!1;const l=u instanceof Rr||u instanceof ns;let h=!0;return u.eachChild(m=>{h=l?h&&_l(m):h&&m instanceof Or}),!!h&&ec(u)&&nu(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function ec(u){if(u instanceof Sr&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Ba||u instanceof Os)return!1;let l=!0;return u.eachChild(h=>{l&&!ec(h)&&(l=!1)}),l}function tc(u){if(u instanceof Sr&&u.name==="feature-state")return!1;let l=!0;return u.eachChild(h=>{l&&!tc(h)&&(l=!1)}),l}function nu(u,l){if(u instanceof Sr&&l.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(m=>{h&&!nu(m,l)&&(h=!1)}),h}function dh(u){return{result:"success",value:u}}function Eo(u){return{result:"error",value:u}}function Wo(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function sp(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function We(u){return!!u.expression&&u.expression.interpolated}function Ke(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Wt(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Ln(u){return u}function Oi(u,l){const h=l.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",v=m||!(m||u.property!==void 0),b=u.type||(We(l)?"exponential":"interval");if(h||l.type==="padding"){const V=h?Ft.parse:Kn.parse;(u=cn({},u)).stops&&(u.stops=u.stops.map(W=>[W[0],V(W[1])])),u.default=V(u.default?u.default:l.default)}if(u.colorSpace&&(E=u.colorSpace)!=="rgb"&&E!=="hcl"&&E!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var E;let A,k,B;if(b==="exponential")A=Ns;else if(b==="interval")A=Mr;else if(b==="categorical"){A=dr,k=Object.create(null);for(const V of u.stops)k[V[0]]=V[1];B=typeof u.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);A=vr}if(m){const V={},W=[];for(let se=0;se<u.stops.length;se++){const he=u.stops[se],_e=he[0].zoom;V[_e]===void 0&&(V[_e]={zoom:_e,type:u.type,property:u.property,default:u.default,stops:[]},W.push(_e)),V[_e].stops.push([he[0].value,he[1]])}const X=[];for(const se of W)X.push([V[se].zoom,Oi(V[se],l)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:Ei.interpolationFactor.bind(void 0,J),zoomStops:X.map(se=>se[0]),evaluate:({zoom:se},he)=>Ns({stops:X,base:u.base},l,se).evaluate(se,he)}}if(v){const V=b==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:V,interpolationFactor:Ei.interpolationFactor.bind(void 0,V),zoomStops:u.stops.map(W=>W[0]),evaluate:({zoom:W})=>A(u,l,W,k,B)}}return{kind:"source",evaluate(V,W){const X=W&&W.properties?W.properties[u.property]:void 0;return X===void 0?si(u.default,l.default):A(u,l,X,k,B)}}}function si(u,l,h){return u!==void 0?u:l!==void 0?l:h!==void 0?h:void 0}function dr(u,l,h,m,v){return si(typeof h===v?m[h]:void 0,u.default,l.default)}function Mr(u,l,h){if(Ke(h)!=="number")return si(u.default,l.default);const m=u.stops.length;if(m===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[m-1][0])return u.stops[m-1][1];const v=He(u.stops.map(b=>b[0]),h);return u.stops[v][1]}function Ns(u,l,h){const m=u.base!==void 0?u.base:1;if(Ke(h)!=="number")return si(u.default,l.default);const v=u.stops.length;if(v===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[v-1][0])return u.stops[v-1][1];const b=He(u.stops.map(V=>V[0]),h),E=function(V,W,X,J){const se=J-X,he=V-X;return se===0?0:W===1?he/se:(Math.pow(W,he)-1)/(Math.pow(W,se)-1)}(h,m,u.stops[b][0],u.stops[b+1][0]),A=u.stops[b][1],k=u.stops[b+1][1],B=kn[l.type]||Ln;return typeof A.evaluate=="function"?{evaluate(...V){const W=A.evaluate.apply(void 0,V),X=k.evaluate.apply(void 0,V);if(W!==void 0&&X!==void 0)return B(W,X,E,u.colorSpace)}}:B(A,k,E,u.colorSpace)}function vr(u,l,h){switch(l.type){case"color":h=Ft.parse(h);break;case"formatted":h=Zt.fromString(h.toString());break;case"resolvedImage":h=vi.fromString(h.toString());break;case"padding":h=Kn.parse(h);break;default:Ke(h)===l.type||l.type==="enum"&&l.values[h]||(h=void 0)}return si(h,u.default,l.default)}Sr.register(ml,{error:[{kind:"error"},[Mt],(u,[l])=>{throw new Fi(l.evaluate(u))}],typeof:[Mt,[Ae],(u,[l])=>ne(ei(l.evaluate(u)))],"to-rgba":[Z(lt,4),[In],(u,[l])=>{const[h,m,v,b]=l.evaluate(u).rgb;return[255*h,255*m,255*v,b]}],rgb:[In,[lt,lt,lt],rp],rgba:[In,[lt,lt,lt,lt],rp],has:{type:kt,overloads:[[[Mt],(u,[l])=>Va(l.evaluate(u),u.properties())],[[Mt,ii],(u,[l,h])=>Va(l.evaluate(u),h.evaluate(u))]]},get:{type:Ae,overloads:[[[Mt],(u,[l])=>hh(l.evaluate(u),u.properties())],[[Mt,ii],(u,[l,h])=>hh(l.evaluate(u),h.evaluate(u))]]},"feature-state":[Ae,[Mt],(u,[l])=>hh(l.evaluate(u),u.featureState||{})],properties:[ii,[],u=>u.properties()],"geometry-type":[Mt,[],u=>u.geometryType()],id:[Ae,[],u=>u.id()],zoom:[lt,[],u=>u.globals.zoom],"heatmap-density":[lt,[],u=>u.globals.heatmapDensity||0],"line-progress":[lt,[],u=>u.globals.lineProgress||0],accumulated:[Ae,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[lt,gl(lt),(u,l)=>{let h=0;for(const m of l)h+=m.evaluate(u);return h}],"*":[lt,gl(lt),(u,l)=>{let h=1;for(const m of l)h*=m.evaluate(u);return h}],"-":{type:lt,overloads:[[[lt,lt],(u,[l,h])=>l.evaluate(u)-h.evaluate(u)],[[lt],(u,[l])=>-l.evaluate(u)]]},"/":[lt,[lt,lt],(u,[l,h])=>l.evaluate(u)/h.evaluate(u)],"%":[lt,[lt,lt],(u,[l,h])=>l.evaluate(u)%h.evaluate(u)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(u,[l,h])=>Math.pow(l.evaluate(u),h.evaluate(u))],sqrt:[lt,[lt],(u,[l])=>Math.sqrt(l.evaluate(u))],log10:[lt,[lt],(u,[l])=>Math.log(l.evaluate(u))/Math.LN10],ln:[lt,[lt],(u,[l])=>Math.log(l.evaluate(u))],log2:[lt,[lt],(u,[l])=>Math.log(l.evaluate(u))/Math.LN2],sin:[lt,[lt],(u,[l])=>Math.sin(l.evaluate(u))],cos:[lt,[lt],(u,[l])=>Math.cos(l.evaluate(u))],tan:[lt,[lt],(u,[l])=>Math.tan(l.evaluate(u))],asin:[lt,[lt],(u,[l])=>Math.asin(l.evaluate(u))],acos:[lt,[lt],(u,[l])=>Math.acos(l.evaluate(u))],atan:[lt,[lt],(u,[l])=>Math.atan(l.evaluate(u))],min:[lt,gl(lt),(u,l)=>Math.min(...l.map(h=>h.evaluate(u)))],max:[lt,gl(lt),(u,l)=>Math.max(...l.map(h=>h.evaluate(u)))],abs:[lt,[lt],(u,[l])=>Math.abs(l.evaluate(u))],round:[lt,[lt],(u,[l])=>{const h=l.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[lt,[lt],(u,[l])=>Math.floor(l.evaluate(u))],ceil:[lt,[lt],(u,[l])=>Math.ceil(l.evaluate(u))],"filter-==":[kt,[Mt,Ae],(u,[l,h])=>u.properties()[l.value]===h.value],"filter-id-==":[kt,[Ae],(u,[l])=>u.id()===l.value],"filter-type-==":[kt,[Mt],(u,[l])=>u.geometryType()===l.value],"filter-<":[kt,[Mt,Ae],(u,[l,h])=>{const m=u.properties()[l.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[kt,[Ae],(u,[l])=>{const h=u.id(),m=l.value;return typeof h==typeof m&&h<m}],"filter->":[kt,[Mt,Ae],(u,[l,h])=>{const m=u.properties()[l.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[kt,[Ae],(u,[l])=>{const h=u.id(),m=l.value;return typeof h==typeof m&&h>m}],"filter-<=":[kt,[Mt,Ae],(u,[l,h])=>{const m=u.properties()[l.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[kt,[Ae],(u,[l])=>{const h=u.id(),m=l.value;return typeof h==typeof m&&h<=m}],"filter->=":[kt,[Mt,Ae],(u,[l,h])=>{const m=u.properties()[l.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[kt,[Ae],(u,[l])=>{const h=u.id(),m=l.value;return typeof h==typeof m&&h>=m}],"filter-has":[kt,[Ae],(u,[l])=>l.value in u.properties()],"filter-has-id":[kt,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[kt,[Z(Mt)],(u,[l])=>l.value.indexOf(u.geometryType())>=0],"filter-id-in":[kt,[Z(Ae)],(u,[l])=>l.value.indexOf(u.id())>=0],"filter-in-small":[kt,[Mt,Z(Ae)],(u,[l,h])=>h.value.indexOf(u.properties()[l.value])>=0],"filter-in-large":[kt,[Mt,Z(Ae)],(u,[l,h])=>function(m,v,b,E){for(;b<=E;){const A=b+E>>1;if(v[A]===m)return!0;v[A]>m?E=A-1:b=A+1}return!1}(u.properties()[l.value],h.value,0,h.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(u,[l,h])=>l.evaluate(u)&&h.evaluate(u)],[gl(kt),(u,l)=>{for(const h of l)if(!h.evaluate(u))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(u,[l,h])=>l.evaluate(u)||h.evaluate(u)],[gl(kt),(u,l)=>{for(const h of l)if(h.evaluate(u))return!0;return!1}]]},"!":[kt,[kt],(u,[l])=>!l.evaluate(u)],"is-supported-script":[kt,[Mt],(u,[l])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(l.evaluate(u))}],upcase:[Mt,[Mt],(u,[l])=>l.evaluate(u).toUpperCase()],downcase:[Mt,[Mt],(u,[l])=>l.evaluate(u).toLowerCase()],concat:[Mt,gl(Ae),(u,l)=>l.map(h=>hi(h.evaluate(u))).join("")],"resolved-locale":[Mt,[Lt],(u,[l])=>l.evaluate(u).resolvedLocale()]});class Er{constructor(l,h){var m;this.expression=l,this._warningHistory={},this._evaluator=new Nr,this._defaultValue=h?(m=h).type==="color"&&Wt(m.default)?new Ft(0,0,0,0):m.type==="color"?Ft.parse(m.default)||null:m.type==="padding"?Kn.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?Qn.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(l,h,m,v,b,E){return this._evaluator.globals=l,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)}evaluate(l,h,m,v,b,E){this._evaluator.globals=l,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=E||null;try{const A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Fi(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function zs(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in ml}function Qs(u,l){const h=new mi(ml,_l,[],l?function(v){const b={color:In,string:Mt,number:lt,enum:Mt,boolean:kt,formatted:gt,padding:ht,resolvedImage:ae,variableAnchorOffsetCollection:j};return v.type==="array"?Z(b[v.value]||Ae,v.length):b[v.type]}(l):void 0),m=h.parse(u,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?dh(new Er(m,l)):Eo(h.errors)}class Zr{constructor(l,h){this.kind=l,this._styleExpression=h,this.isStateDependent=l!=="constant"&&!tc(h.expression)}evaluateWithoutErrorHandling(l,h,m,v,b,E){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,v,b,E)}evaluate(l,h,m,v,b,E){return this._styleExpression.evaluate(l,h,m,v,b,E)}}class To{constructor(l,h,m,v){this.kind=l,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=l!=="camera"&&!tc(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(l,h,m,v,b,E){return this._styleExpression.evaluateWithoutErrorHandling(l,h,m,v,b,E)}evaluate(l,h,m,v,b,E){return this._styleExpression.evaluate(l,h,m,v,b,E)}interpolationFactor(l,h,m){return this.interpolationType?Ei.interpolationFactor(this.interpolationType,l,h,m):0}}function jo(u,l){const h=Qs(u,l);if(h.result==="error")return h;const m=h.value.expression,v=ec(m);if(!v&&!Wo(l))return Eo([new At("","data expressions not supported")]);const b=nu(m,["zoom"]);if(!b&&!sp(l))return Eo([new At("","zoom expressions not supported")]);const E=Tr(m);return E||b?E instanceof At?Eo([E]):E instanceof Ei&&!We(l)?Eo([new At("",'"interpolate" expressions cannot be used with this property')]):dh(E?new To(v?"camera":"composite",h.value,E.labels,E instanceof Ei?E.interpolation:void 0):new Zr(v?"constant":"source",h.value)):Eo([new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $o{constructor(l,h){this._parameters=l,this._specification=h,cn(this,Oi(this._parameters,this._specification))}static deserialize(l){return new $o(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function Tr(u){let l=null;if(u instanceof jl)l=Tr(u.result);else if(u instanceof bn){for(const h of u.args)if(l=Tr(h),l)break}else(u instanceof Tt||u instanceof Ei)&&u.input instanceof Sr&&u.input.name==="zoom"&&(l=u);return l instanceof At||u.eachChild(h=>{const m=Tr(h);m instanceof At?l=m:!l&&m?l=new At("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&m&&l!==m&&(l=new At("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Co(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const l of u.slice(1))if(!Co(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const Gd={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Hd(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Co(u)||(u=bi(u));const l=Qs(u,Gd);if(l.result==="error")throw new Error(l.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>l.value.evaluate(h,m,{},v),needGeometry:Ci(u)}}function Hg(u,l){return u<l?-1:u>l?1:0}function Ci(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let l=1;l<u.length;l++)if(Ci(u[l]))return!0;return!1}function bi(u){if(!u)return!0;const l=u[0];return u.length<=1?l!=="any":l==="=="?Ga(u[1],u[2],"=="):l==="!="?cs(Ga(u[1],u[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Ga(u[1],u[2],l):l==="any"?(h=u.slice(1),["any"].concat(h.map(bi))):l==="all"?["all"].concat(u.slice(1).map(bi)):l==="none"?["all"].concat(u.slice(1).map(bi).map(cs)):l==="in"?da(u[1],u.slice(2)):l==="!in"?cs(da(u[1],u.slice(2))):l==="has"?nc(u[1]):l!=="!has"||cs(nc(u[1]));var h}function Ga(u,l,h){switch(u){case"$type":return[`filter-type-${h}`,l];case"$id":return[`filter-id-${h}`,l];default:return[`filter-${h}`,u,l]}}function da(u,l){if(l.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(h=>typeof h!=typeof l[0])?["filter-in-large",u,["literal",l.sort(Hg)]]:["filter-in-small",u,["literal",l]]}}function nc(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function cs(u){return["!",u]}function us(u){const l=typeof u;if(l==="number"||l==="boolean"||l==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let v="[";for(const b of u)v+=`${us(b)},`;return`${v}]`}const h=Object.keys(u).sort();let m="{";for(let v=0;v<h.length;v++)m+=`${JSON.stringify(h[v])}:${us(u[h[v]])},`;return`${m}}`}function Ha(u){let l="";for(const h of jn)l+=`/${us(u[h])}`;return l}function Wa(u){const l=u.value;return l?[new Je(u.key,l,"constants have been deprecated as of v8")]:[]}function Yi(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function ys(u){if(Array.isArray(u))return u.map(ys);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const l={};for(const h in u)l[h]=ys(u[h]);return l}return Yi(u)}function zr(u){const l=u.key,h=u.value,m=u.valueSpec||{},v=u.objectElementValidators||{},b=u.style,E=u.styleSpec,A=u.validateSpec;let k=[];const B=Ke(h);if(B!=="object")return[new Je(l,h,`object expected, ${B} found`)];for(const V in h){const W=V.split(".")[0],X=m[W]||m["*"];let J;if(v[W])J=v[W];else if(m[W])J=A;else if(v["*"])J=v["*"];else{if(!m["*"]){k.push(new Je(l,h[V],`unknown property "${V}"`));continue}J=A}k=k.concat(J({key:(l&&`${l}.`)+V,value:h[V],valueSpec:X,style:b,styleSpec:E,object:h,objectKey:V,validateSpec:A},h))}for(const V in m)v[V]||m[V].required&&m[V].default===void 0&&h[V]===void 0&&k.push(new Je(l,h,`missing required property "${V}"`));return k}function iu(u){const l=u.value,h=u.valueSpec,m=u.style,v=u.styleSpec,b=u.key,E=u.arrayElementValidator||u.validateSpec;if(Ke(l)!=="array")return[new Je(b,l,`array expected, ${Ke(l)} found`)];if(h.length&&l.length!==h.length)return[new Je(b,l,`array length ${h.length} expected, length ${l.length} found`)];if(h["min-length"]&&l.length<h["min-length"])return[new Je(b,l,`array length at least ${h["min-length"]} expected, length ${l.length} found`)];let A={type:h.value,values:h.values};v.$version<7&&(A.function=h.function),Ke(h.value)==="object"&&(A=h.value);let k=[];for(let B=0;B<l.length;B++)k=k.concat(E({array:l,arrayIndex:B,value:l[B],valueSpec:A,validateSpec:u.validateSpec,style:m,styleSpec:v,key:`${b}[${B}]`}));return k}function ic(u){const l=u.key,h=u.value,m=u.valueSpec;let v=Ke(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new Je(l,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new Je(l,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new Je(l,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function rc(u){const l=u.valueSpec,h=Yi(u.value.type);let m,v,b,E={};const A=h!=="categorical"&&u.value.property===void 0,k=!A,B=Ke(u.value.stops)==="array"&&Ke(u.value.stops[0])==="array"&&Ke(u.value.stops[0][0])==="object",V=zr({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(J){if(h==="identity")return[new Je(J.key,J.value,'identity function may not have a "stops" property')];let se=[];const he=J.value;return se=se.concat(iu({key:J.key,value:he,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:W})),Ke(he)==="array"&&he.length===0&&se.push(new Je(J.key,he,"array must have at least one stop")),se},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:l,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return h==="identity"&&A&&V.push(new Je(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||V.push(new Je(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!We(u.valueSpec)&&V.push(new Je(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(k&&!Wo(u.valueSpec)?V.push(new Je(u.key,u.value,"property functions not supported")):A&&!sp(u.valueSpec)&&V.push(new Je(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!B||u.value.property!==void 0||V.push(new Je(u.key,u.value,'"property" property is required')),V;function W(J){let se=[];const he=J.value,_e=J.key;if(Ke(he)!=="array")return[new Je(_e,he,`array expected, ${Ke(he)} found`)];if(he.length!==2)return[new Je(_e,he,`array length 2 expected, length ${he.length} found`)];if(B){if(Ke(he[0])!=="object")return[new Je(_e,he,`object expected, ${Ke(he[0])} found`)];if(he[0].zoom===void 0)return[new Je(_e,he,"object stop key must have zoom")];if(he[0].value===void 0)return[new Je(_e,he,"object stop key must have value")];if(b&&b>Yi(he[0].zoom))return[new Je(_e,he[0].zoom,"stop zoom values must appear in ascending order")];Yi(he[0].zoom)!==b&&(b=Yi(he[0].zoom),v=void 0,E={}),se=se.concat(zr({key:`${_e}[0]`,value:he[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:ic,value:X}}))}else se=se.concat(X({key:`${_e}[0]`,value:he[0],valueSpec:{},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},he));return zs(ys(he[1]))?se.concat([new Je(`${_e}[1]`,he[1],"expressions are not allowed in function stops.")]):se.concat(J.validateSpec({key:`${_e}[1]`,value:he[1],valueSpec:l,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function X(J,se){const he=Ke(J.value),_e=Yi(J.value),be=J.value!==null?J.value:se;if(m){if(he!==m)return[new Je(J.key,be,`${he} stop domain type must match previous stop domain type ${m}`)]}else m=he;if(he!=="number"&&he!=="string"&&he!=="boolean")return[new Je(J.key,be,"stop domain value must be a number, string, or boolean")];if(he!=="number"&&h!=="categorical"){let je=`number expected, ${he} found`;return Wo(l)&&h===void 0&&(je+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Je(J.key,be,je)]}return h!=="categorical"||he!=="number"||isFinite(_e)&&Math.floor(_e)===_e?h!=="categorical"&&he==="number"&&v!==void 0&&_e<v?[new Je(J.key,be,"stop domain values must appear in ascending order")]:(v=_e,h==="categorical"&&_e in E?[new Je(J.key,be,"stop domain values must be unique")]:(E[_e]=!0,[])):[new Je(J.key,be,`integer expected, found ${_e}`)]}}function eo(u){const l=(u.expressionContext==="property"?jo:Qs)(ys(u.value),u.valueSpec);if(l.result==="error")return l.value.map(m=>new Je(`${u.key}${m.key}`,u.value,m.message));const h=l.value.expression||l.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new Je(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!tc(h))return[new Je(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!tc(h))return[new Je(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!nu(h,["zoom","feature-state"]))return[new Je(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!ec(h))return[new Je(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fa(u){const l=u.key,h=u.value,m=u.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(Yi(h))===-1&&v.push(new Je(l,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(Yi(h))===-1&&v.push(new Je(l,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ru(u){return Co(ys(u.value))?eo(cn({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):sc(u)}function sc(u){const l=u.value,h=u.key;if(Ke(l)!=="array")return[new Je(h,l,`array expected, ${Ke(l)} found`)];const m=u.styleSpec;let v,b=[];if(l.length<1)return[new Je(h,l,"filter array must have at least 1 element")];switch(b=b.concat(fa({key:`${h}[0]`,value:l[0],valueSpec:m.filter_operator,style:u.style,styleSpec:u.styleSpec})),Yi(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Yi(l[1])==="$type"&&b.push(new Je(h,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&b.push(new Je(h,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(v=Ke(l[1]),v!=="string"&&b.push(new Je(`${h}[1]`,l[1],`string expected, ${v} found`)));for(let E=2;E<l.length;E++)v=Ke(l[E]),Yi(l[1])==="$type"?b=b.concat(fa({key:`${h}[${E}]`,value:l[E],valueSpec:m.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&b.push(new Je(`${h}[${E}]`,l[E],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let E=1;E<l.length;E++)b=b.concat(sc({key:`${h}[${E}]`,value:l[E],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=Ke(l[1]),l.length!==2?b.push(new Je(h,l,`filter array for "${l[0]}" operator must have 2 elements`)):v!=="string"&&b.push(new Je(`${h}[1]`,l[1],`string expected, ${v} found`))}return b}function oc(u,l){const h=u.key,m=u.validateSpec,v=u.style,b=u.styleSpec,E=u.value,A=u.objectKey,k=b[`${l}_${u.layerType}`];if(!k)return[];const B=A.match(/^(.*)-transition$/);if(l==="paint"&&B&&k[B[1]]&&k[B[1]].transition)return m({key:h,value:E,valueSpec:b.transition,style:v,styleSpec:b});const V=u.valueSpec||k[A];if(!V)return[new Je(h,E,`unknown property "${A}"`)];let W;if(Ke(E)==="string"&&Wo(V)&&!V.tokens&&(W=/^{([^}]+)}$/.exec(E)))return[new Je(h,E,`"${A}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const X=[];return u.layerType==="symbol"&&(A==="text-field"&&v&&!v.glyphs&&X.push(new Je(h,E,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Wt(ys(E))&&Yi(E.type)==="identity"&&X.push(new Je(h,E,'"text-font" does not support identity functions'))),X.concat(m({key:u.key,value:E,valueSpec:V,style:v,styleSpec:b,expressionContext:"property",propertyType:l,propertyKey:A}))}function op(u){return oc(u,"paint")}function Wg(u){return oc(u,"layout")}function Y0(u){let l=[];const h=u.value,m=u.key,v=u.style,b=u.styleSpec;h.type||h.ref||l.push(new Je(m,h,'either "type" or "ref" is required'));let E=Yi(h.type);const A=Yi(h.ref);if(h.id){const k=Yi(h.id);for(let B=0;B<u.arrayIndex;B++){const V=v.layers[B];Yi(V.id)===k&&l.push(new Je(m,h.id,`duplicate layer id "${h.id}", previously used at line ${V.id.__line__}`))}}if("ref"in h){let k;["type","source","source-layer","filter","layout"].forEach(B=>{B in h&&l.push(new Je(m,h[B],`"${B}" is prohibited for ref layers`))}),v.layers.forEach(B=>{Yi(B.id)===A&&(k=B)}),k?k.ref?l.push(new Je(m,h.ref,"ref cannot reference another ref layer")):E=Yi(k.type):l.push(new Je(m,h.ref,`ref layer "${A}" not found`))}else if(E!=="background")if(h.source){const k=v.sources&&v.sources[h.source],B=k&&Yi(k.type);k?B==="vector"&&E==="raster"?l.push(new Je(m,h.source,`layer "${h.id}" requires a raster source`)):B!=="raster-dem"&&E==="hillshade"?l.push(new Je(m,h.source,`layer "${h.id}" requires a raster-dem source`)):B==="raster"&&E!=="raster"?l.push(new Je(m,h.source,`layer "${h.id}" requires a vector source`)):B!=="vector"||h["source-layer"]?B==="raster-dem"&&E!=="hillshade"?l.push(new Je(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="line"||!h.paint||!h.paint["line-gradient"]||B==="geojson"&&k.lineMetrics||l.push(new Je(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Je(m,h,`layer "${h.id}" must specify a "source-layer"`)):l.push(new Je(m,h.source,`source "${h.source}" not found`))}else l.push(new Je(m,h,'missing required property "source"'));return l=l.concat(zr({key:m,value:h,valueSpec:b.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${m}.type`,value:h.type,valueSpec:b.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:ru,layout:k=>zr({layer:h,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":B=>Wg(cn({layerType:E},B))}}),paint:k=>zr({layer:h,key:k.key,value:k.value,style:k.style,styleSpec:k.styleSpec,validateSpec:k.validateSpec,objectElementValidators:{"*":B=>op(cn({layerType:E},B))}})}})),l}function ac(u){const l=u.value,h=u.key,m=Ke(l);return m!=="string"?[new Je(h,l,`string expected, ${m} found`)]:[]}const K0={promoteId:function({key:u,value:l}){if(Ke(l)==="string")return ac({key:u,value:l});{const h=[];for(const m in l)h.push(...ac({key:`${u}.${m}`,value:l[m]}));return h}}};function jg(u){const l=u.value,h=u.key,m=u.styleSpec,v=u.style,b=u.validateSpec;if(!l.type)return[new Je(h,l,'"type" is required')];const E=Yi(l.type);let A;switch(E){case"vector":case"raster":return A=zr({key:h,value:l,valueSpec:m[`source_${E.replace("-","_")}`],style:u.style,styleSpec:m,objectElementValidators:K0,validateSpec:b}),A;case"raster-dem":return A=function(k){var B;const V=(B=k.sourceName)!==null&&B!==void 0?B:"",W=k.value,X=k.styleSpec,J=X.source_raster_dem,se=k.style;let he=[];const _e=Ke(W);if(W===void 0)return he;if(_e!=="object")return he.push(new Je("source_raster_dem",W,`object expected, ${_e} found`)),he;const be=Yi(W.encoding)==="custom",je=["redFactor","greenFactor","blueFactor","baseShift"],Pe=k.value.encoding?`"${k.value.encoding}"`:"Default";for(const Ge in W)!be&&je.includes(Ge)?he.push(new Je(Ge,W[Ge],`In "${V}": "${Ge}" is only valid when "encoding" is set to "custom". ${Pe} encoding found`)):J[Ge]?he=he.concat(k.validateSpec({key:Ge,value:W[Ge],valueSpec:J[Ge],validateSpec:k.validateSpec,style:se,styleSpec:X})):he.push(new Je(Ge,W[Ge],`unknown property "${Ge}"`));return he}({sourceName:h,value:l,style:u.style,styleSpec:m,validateSpec:b}),A;case"geojson":if(A=zr({key:h,value:l,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:b,objectElementValidators:K0}),l.cluster)for(const k in l.clusterProperties){const[B,V]=l.clusterProperties[k],W=typeof B=="string"?[B,["accumulated"],["get",k]]:B;A.push(...eo({key:`${h}.${k}.map`,value:V,validateSpec:b,expressionContext:"cluster-map"})),A.push(...eo({key:`${h}.${k}.reduce`,value:W,validateSpec:b,expressionContext:"cluster-reduce"}))}return A;case"video":return zr({key:h,value:l,valueSpec:m.source_video,style:v,validateSpec:b,styleSpec:m});case"image":return zr({key:h,value:l,valueSpec:m.source_image,style:v,validateSpec:b,styleSpec:m});case"canvas":return[new Je(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fa({key:`${h}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:b,styleSpec:m})}}function $g(u){const l=u.value,h=u.styleSpec,m=h.light,v=u.style;let b=[];const E=Ke(l);if(l===void 0)return b;if(E!=="object")return b=b.concat([new Je("light",l,`object expected, ${E} found`)]),b;for(const A in l){const k=A.match(/^(.*)-transition$/);b=b.concat(k&&m[k[1]]&&m[k[1]].transition?u.validateSpec({key:A,value:l[A],valueSpec:h.transition,validateSpec:u.validateSpec,style:v,styleSpec:h}):m[A]?u.validateSpec({key:A,value:l[A],valueSpec:m[A],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new Je(A,l[A],`unknown property "${A}"`)])}return b}function qg(u){const l=u.value,h=u.styleSpec,m=h.sky,v=u.style,b=Ke(l);if(l===void 0)return[];if(b!=="object")return[new Je("sky",l,`object expected, ${b} found`)];let E=[];for(const A in l)E=E.concat(m[A]?u.validateSpec({key:A,value:l[A],valueSpec:m[A],style:v,styleSpec:h}):[new Je(A,l[A],`unknown property "${A}"`)]);return E}function J0(u){const l=u.value,h=u.styleSpec,m=h.terrain,v=u.style;let b=[];const E=Ke(l);if(l===void 0)return b;if(E!=="object")return b=b.concat([new Je("terrain",l,`object expected, ${E} found`)]),b;for(const A in l)b=b.concat(m[A]?u.validateSpec({key:A,value:l[A],valueSpec:m[A],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new Je(A,l[A],`unknown property "${A}"`)]);return b}function Q0(u){let l=[];const h=u.value,m=u.key;if(Array.isArray(h)){const v=[],b=[];for(const E in h)h[E].id&&v.includes(h[E].id)&&l.push(new Je(m,h,`all the sprites' ids must be unique, but ${h[E].id} is duplicated`)),v.push(h[E].id),h[E].url&&b.includes(h[E].url)&&l.push(new Je(m,h,`all the sprites' URLs must be unique, but ${h[E].url} is duplicated`)),b.push(h[E].url),l=l.concat(zr({key:`${m}[${E}]`,value:h[E],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return l}return ac({key:m,value:h})}const Xg={"*":()=>[],array:iu,boolean:function(u){const l=u.value,h=u.key,m=Ke(l);return m!=="boolean"?[new Je(h,l,`boolean expected, ${m} found`)]:[]},number:ic,color:function(u){const l=u.key,h=u.value,m=Ke(h);return m!=="string"?[new Je(l,h,`color expected, ${m} found`)]:Ft.parse(String(h))?[]:[new Je(l,h,`color expected, "${h}" found`)]},constants:Wa,enum:fa,filter:ru,function:rc,layer:Y0,object:zr,source:jg,light:$g,sky:qg,terrain:J0,projection:function(u){const l=u.value,h=u.styleSpec,m=h.projection,v=u.style,b=Ke(l);if(l===void 0)return[];if(b!=="object")return[new Je("projection",l,`object expected, ${b} found`)];let E=[];for(const A in l)E=E.concat(m[A]?u.validateSpec({key:A,value:l[A],valueSpec:m[A],style:v,styleSpec:h}):[new Je(A,l[A],`unknown property "${A}"`)]);return E},string:ac,formatted:function(u){return ac(u).length===0?[]:eo(u)},resolvedImage:function(u){return ac(u).length===0?[]:eo(u)},padding:function(u){const l=u.key,h=u.value;if(Ke(h)==="array"){if(h.length<1||h.length>4)return[new Je(l,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let v=[];for(let b=0;b<h.length;b++)v=v.concat(u.validateSpec({key:`${l}[${b}]`,value:h[b],validateSpec:u.validateSpec,valueSpec:m}));return v}return ic({key:l,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const l=u.key,h=u.value,m=Ke(h),v=u.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new Je(l,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let E=0;E<h.length;E+=2)b=b.concat(fa({key:`${l}[${E}]`,value:h[E],valueSpec:v.layout_symbol["text-anchor"]})),b=b.concat(iu({key:`${l}[${E+1}]`,value:h[E+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:v}));return b},sprite:Q0};function fh(u){const l=u.value,h=u.valueSpec,m=u.styleSpec;return u.validateSpec=fh,h.expression&&Wt(Yi(l))?rc(u):h.expression&&zs(ys(l))?eo(u):h.type&&Xg[h.type]?Xg[h.type](u):zr(cn({},u,{valueSpec:h.type?m[h.type]:h}))}function Zg(u){const l=u.value,h=u.key,m=ac(u);return m.length||(l.indexOf("{fontstack}")===-1&&m.push(new Je(h,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&m.push(new Je(h,l,'"glyphs" url must include a "{range}" token'))),m}function qo(u,l=Te){let h=[];return h=h.concat(fh({key:"",value:u,valueSpec:l.$root,styleSpec:l,style:u,validateSpec:fh,objectElementValidators:{glyphs:Zg,"*":()=>[]}})),u.constants&&(h=h.concat(Wa({key:"constants",value:u.constants,style:u,styleSpec:l,validateSpec:fh}))),ev(h)}function Ao(u){return function(l){return u({...l,validateSpec:fh})}}function ev(u){return[].concat(u).sort((l,h)=>l.line-h.line)}function Xo(u){return function(...l){return ev(u.apply(this,l))}}qo.source=Xo(Ao(jg)),qo.sprite=Xo(Ao(Q0)),qo.glyphs=Xo(Ao(Zg)),qo.light=Xo(Ao($g)),qo.sky=Xo(Ao(qg)),qo.terrain=Xo(Ao(J0)),qo.layer=Xo(Ao(Y0)),qo.filter=Xo(Ao(ru)),qo.paintProperty=Xo(Ao(op)),qo.layoutProperty=Xo(Ao(Wg));const Wd=qo,Bb=Wd.light,tv=Wd.paintProperty,nv=Wd.layoutProperty;function Yg(u,l){let h=!1;if(l&&l.length)for(const m of l)u.fire(new on(new Error(m.message))),h=!0;return h}class jd{constructor(l,h,m){const v=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const E=new Int32Array(this.arrayBuffer);l=E[0],this.d=(h=E[1])+2*(m=E[2]);for(let k=0;k<this.d*this.d;k++){const B=E[3+k],V=E[3+k+1];v.push(B===V?null:E.subarray(B,V))}const A=E[3+v.length+1];this.keys=E.subarray(E[3+v.length],A),this.bboxes=E.subarray(A),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let E=0;E<this.d*this.d;E++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=l,this.padding=m,this.scale=h/l,this.uid=0;const b=m/h*l;this.min=-b,this.max=l+b}insert(l,h,m,v,b){this._forEachCell(h,m,v,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,h,m,v,b,E){this.cells[b].push(E)}query(l,h,m,v,b){const E=this.min,A=this.max;if(l<=E&&h<=E&&A<=m&&A<=v&&!b)return Array.prototype.slice.call(this.keys);{const k=[];return this._forEachCell(l,h,m,v,this._queryCell,k,{},b),k}}_queryCell(l,h,m,v,b,E,A,k){const B=this.cells[b];if(B!==null){const V=this.keys,W=this.bboxes;for(let X=0;X<B.length;X++){const J=B[X];if(A[J]===void 0){const se=4*J;(k?k(W[se+0],W[se+1],W[se+2],W[se+3]):l<=W[se+2]&&h<=W[se+3]&&m>=W[se+0]&&v>=W[se+1])?(A[J]=!0,E.push(V[J])):A[J]=!1}}}}_forEachCell(l,h,m,v,b,E,A,k){const B=this._convertToCellCoord(l),V=this._convertToCellCoord(h),W=this._convertToCellCoord(m),X=this._convertToCellCoord(v);for(let J=B;J<=W;J++)for(let se=V;se<=X;se++){const he=this.d*se+J;if((!k||k(this._convertFromCellCoord(J),this._convertFromCellCoord(se),this._convertFromCellCoord(J+1),this._convertFromCellCoord(se+1)))&&b.call(this,l,h,m,v,he,E,A,k))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,h=3+this.cells.length+1+1;let m=0;for(let E=0;E<this.cells.length;E++)m+=this.cells[E].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let b=h;for(let E=0;E<l.length;E++){const A=l[E];v[3+E]=b,v.set(A,b),b+=A.length}return v[3+l.length]=b,v.set(this.keys,b),b+=this.keys.length,v[3+l.length+1]=b,v.set(this.bboxes,b),b+=this.bboxes.length,v.buffer}static serialize(l,h){const m=l.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(l){return new jd(l.buffer)}}const lc={};function dn(u,l,h={}){if(lc[u])throw new Error(`${u} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:u,writeable:!1}),lc[u]={klass:l,omit:h.omit||[],shallow:h.shallow||[]}}dn("Object",Object),dn("TransferableGridIndex",jd),dn("Color",Ft),dn("Error",Error),dn("AJAXError",It),dn("ResolvedImage",vi),dn("StylePropertyFunction",$o),dn("StyleExpression",Er,{omit:["_evaluator"]}),dn("ZoomDependentExpression",To),dn("ZoomConstantExpression",Zr),dn("CompoundExpression",Sr,{omit:["_evaluate"]});for(const u in ml)ml[u]._classRegistryKey||dn(`Expression_${u}`,ml[u]);function iv(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function $d(u,l){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(iv(u)||st(u))return l&&l.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return l&&l.push(h.buffer),h}if(u instanceof ImageData)return l&&l.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const m of u)h.push($d(m,l));return h}if(typeof u=="object"){const h=u.constructor,m=h._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!lc[m])throw new Error(`${m} is not registered.`);const v=h.serialize?h.serialize(u,l):{};if(h.serialize){if(l&&v===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in u){if(!u.hasOwnProperty(b)||lc[m].omit.indexOf(b)>=0)continue;const E=u[b];v[b]=lc[m].shallow.indexOf(b)>=0?E:$d(E,l)}u instanceof Error&&(v.message=u.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof u)}function ja(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||iv(u)||st(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(ja);if(typeof u=="object"){const l=u.$name||"Object";if(!lc[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:h}=lc[l];if(!h)throw new Error(`can't deserialize unregistered class ${l}`);if(h.deserialize)return h.deserialize(u);const m=Object.create(h.prototype);for(const v of Object.keys(u)){if(v==="$name")continue;const b=u[v];m[v]=lc[l].shallow.indexOf(v)>=0?b:ja(b)}return m}throw new Error("can't deserialize object of type "+typeof u)}class rv{constructor(){this.first=!0}update(l,h){const m=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=m,!0))}}const en={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function Kg(u){for(const l of u)if(Jg(l.charCodeAt(0)))return!0;return!1}function Ub(u){for(const l of u)if(!sv(l.charCodeAt(0)))return!1;return!0}function sv(u){return!(en.Arabic(u)||en["Arabic Supplement"](u)||en["Arabic Extended-A"](u)||en["Arabic Presentation Forms-A"](u)||en["Arabic Presentation Forms-B"](u))}function Jg(u){return!(u!==746&&u!==747&&(u<4352||!(en["Bopomofo Extended"](u)||en.Bopomofo(u)||en["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||en["CJK Compatibility Ideographs"](u)||en["CJK Compatibility"](u)||en["CJK Radicals Supplement"](u)||en["CJK Strokes"](u)||!(!en["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||en["CJK Unified Ideographs Extension A"](u)||en["CJK Unified Ideographs"](u)||en["Enclosed CJK Letters and Months"](u)||en["Hangul Compatibility Jamo"](u)||en["Hangul Jamo Extended-A"](u)||en["Hangul Jamo Extended-B"](u)||en["Hangul Jamo"](u)||en["Hangul Syllables"](u)||en.Hiragana(u)||en["Ideographic Description Characters"](u)||en.Kanbun(u)||en["Kangxi Radicals"](u)||en["Katakana Phonetic Extensions"](u)||en.Katakana(u)&&u!==12540||!(!en["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!en["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||en["Unified Canadian Aboriginal Syllabics"](u)||en["Unified Canadian Aboriginal Syllabics Extended"](u)||en["Vertical Forms"](u)||en["Yijing Hexagram Symbols"](u)||en["Yi Syllables"](u)||en["Yi Radicals"](u))))}function ov(u){return!(Jg(u)||function(l){return!!(en["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||en["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||en["Letterlike Symbols"](l)||en["Number Forms"](l)||en["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||en["Control Pictures"](l)&&l!==9251||en["Optical Character Recognition"](l)||en["Enclosed Alphanumerics"](l)||en["Geometric Shapes"](l)||en["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||en["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||en["CJK Symbols and Punctuation"](l)||en.Katakana(l)||en["Private Use Area"](l)||en["CJK Compatibility Forms"](l)||en["Small Form Variants"](l)||en["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(u))}function cc(u){return u>=1424&&u<=2303||en["Arabic Presentation Forms-A"](u)||en["Arabic Presentation Forms-B"](u)}function av(u,l){return!(!l&&cc(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||en.Khmer(u))}function Qg(u){for(const l of u)if(cc(l.charCodeAt(0)))return!0;return!1}const uc=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class rr{constructor(l,h){this.zoom=l,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rv,this.transition={})}isSupportedScript(l){return function(h,m){for(const v of h)if(!av(v.charCodeAt(0),m))return!1;return!0}(l,uc.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,h=l-Math.floor(l),m=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class ap{constructor(l,h){this.property=l,this.value=h,this.expression=function(m,v){if(Wt(m))return new $o(m,v);if(zs(m)){const b=jo(m,v);if(b.result==="error")throw new Error(b.value.map(E=>`${E.key}: ${E.message}`).join(", "));return b.value}{let b=m;return v.type==="color"&&typeof m=="string"?b=Ft.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(b=Qn.parse(m)):b=Kn.parse(m),{kind:"constant",evaluate:()=>b}}}(h===void 0?l.specification.default:h,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,h,m){return this.property.possiblyEvaluate(this,l,h,m)}}class ph{constructor(l){this.property=l,this.value=new ap(l,void 0)}transitioned(l,h){return new lv(this.property,this.value,h,te({},l.transition,this.transition),l.now)}untransitioned(){return new lv(this.property,this.value,null,{},0)}}class mh{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return pe(this._values[l].value.value)}setValue(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new ph(this._values[l].property)),this._values[l].value=new ap(this._values[l].property,h===null?void 0:pe(h))}getTransition(l){return pe(this._values[l].transition)}setTransition(l,h){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new ph(this._values[l].property)),this._values[l].transition=pe(h)||void 0}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m);const v=this.getTransition(h);v!==void 0&&(l[`${h}-transition`]=v)}return l}transitioned(l,h){const m=new e_(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(l,h._values[v]);return m}untransitioned(){const l=new e_(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].untransitioned();return l}}class lv{constructor(l,h,m,v,b){this.property=l,this.value=h,this.begin=b+v.delay||0,this.end=this.begin+v.duration||0,l.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(l,h,m){const v=l.now||0,b=this.value.possiblyEvaluate(l,h,m),E=this.prior;if(E){if(v>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(v<this.begin)return E.possiblyEvaluate(l,h,m);{const A=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(l,h,m),b,function(k){if(k<=0)return 0;if(k>=1)return 1;const B=k*k,V=B*k;return 4*(k<.5?V:3*(k-B)+V-.75)}(A))}}return b}}class e_{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,h,m){const v=new lp(this._properties);for(const b of Object.keys(this._values))v._values[b]=this._values[b].possiblyEvaluate(l,h,m);return v}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class qd{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return pe(this._values[l].value)}setValue(l,h){this._values[l]=new ap(this._values[l].property,h===null?void 0:pe(h))}serialize(){const l={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(l[h]=m)}return l}possiblyEvaluate(l,h,m){const v=new lp(this._properties);for(const b of Object.keys(this._values))v._values[b]=this._values[b].possiblyEvaluate(l,h,m);return v}}class $a{constructor(l,h,m){this.property=l,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,h,m,v){return this.property.evaluate(this.value,this.parameters,l,h,m,v)}}class lp{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Tn{constructor(l){this.specification=l}possiblyEvaluate(l,h){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(h)}interpolate(l,h,m){const v=kn[this.specification.type];return v?v(l,h,m):l}}class On{constructor(l,h){this.specification=l,this.overrides=h}possiblyEvaluate(l,h,m,v){return new $a(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(h,null,{},m,v)}:l.expression,h)}interpolate(l,h,m){if(l.value.kind!=="constant"||h.value.kind!=="constant")return l;if(l.value.value===void 0||h.value.value===void 0)return new $a(this,{kind:"constant",value:void 0},l.parameters);const v=kn[this.specification.type];if(v){const b=v(l.value.value,h.value.value,m);return new $a(this,{kind:"constant",value:b},l.parameters)}return l}evaluate(l,h,m,v,b,E){return l.kind==="constant"?l.value:l.evaluate(h,m,v,b,E)}}class S extends On{possiblyEvaluate(l,h,m,v){if(l.value===void 0)return new $a(this,{kind:"constant",value:void 0},h);if(l.expression.kind==="constant"){const b=l.expression.evaluate(h,null,{},m,v),E=l.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,A=this._calculate(E,E,E,h);return new $a(this,{kind:"constant",value:A},h)}if(l.expression.kind==="camera"){const b=this._calculate(l.expression.evaluate({zoom:h.zoom-1}),l.expression.evaluate({zoom:h.zoom}),l.expression.evaluate({zoom:h.zoom+1}),h);return new $a(this,{kind:"constant",value:b},h)}return new $a(this,l.expression,h)}evaluate(l,h,m,v,b,E){if(l.kind==="source"){const A=l.evaluate(h,m,v,b,E);return this._calculate(A,A,A,h)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(h.zoom)-1},m,v),l.evaluate({zoom:Math.floor(h.zoom)},m,v),l.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):l.value}_calculate(l,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class c{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,v){if(l.value!==void 0){if(l.expression.kind==="constant"){const b=l.expression.evaluate(h,null,{},m,v);return this._calculate(b,b,b,h)}return this._calculate(l.expression.evaluate(new rr(Math.floor(h.zoom-1),h)),l.expression.evaluate(new rr(Math.floor(h.zoom),h)),l.expression.evaluate(new rr(Math.floor(h.zoom+1),h)),h)}}_calculate(l,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:l,to:h}:{from:m,to:h}}interpolate(l){return l}}class f{constructor(l){this.specification=l}possiblyEvaluate(l,h,m,v){return!!l.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class y{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in l){const m=l[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new ap(m,void 0),b=this.defaultTransitionablePropertyValues[h]=new ph(m);this.defaultTransitioningPropertyValues[h]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}dn("DataDrivenProperty",On),dn("DataConstantProperty",Tn),dn("CrossFadedDataDrivenProperty",S),dn("CrossFadedProperty",c),dn("ColorRampProperty",f);const x="-transition";class M extends Vn{constructor(l,h){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),h.layout&&(this._unevaluatedLayout=new qd(h.layout)),h.paint)){this._transitionablePaint=new mh(h.paint);for(const m in l.paint)this.setPaintProperty(m,l.paint[m],{validate:!1});for(const m in l.layout)this.setLayoutProperty(m,l.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lp(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,h,m={}){h!=null&&this._validate(nv,`layers.${this.id}.layout.${l}`,l,h,m)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,h):this.visibility=h)}getPaintProperty(l){return l.endsWith(x)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,h,m={}){if(h!=null&&this._validate(tv,`layers.${this.id}.paint.${l}`,l,h,m))return!1;if(l.endsWith(x))return this._transitionablePaint.setTransition(l.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[l],b=v.property.specification["property-type"]==="cross-faded-data-driven",E=v.value.isDataDriven(),A=v.value;this._transitionablePaint.setValue(l,h),this._handleSpecialPaintPropertyUpdate(l);const k=this._transitionablePaint._values[l].value;return k.isDataDriven()||E||b||this._handleOverridablePaintPropertyUpdate(l,A,k)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,h,m){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,h){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,h)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Q(l,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(l,h,m,v,b={}){return(!b||b.validate!==!1)&&Yg(this,l.call(Wd,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:Te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const h=this.paint.get(l);if(h instanceof $a&&Wo(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const D={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class F{constructor(l,h){this._structArray=l,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class N{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,h){return l._trim(),h&&(l.isTransferred=!0,h.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const h=Object.create(this.prototype);return h.arrayBuffer=l.arrayBuffer,h.length=l.length,h.capacity=l.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function G(u,l=1){let h=0,m=0;return{members:u.map(v=>{const b=D[v.type].BYTES_PER_ELEMENT,E=h=q(h,Math.max(l,b)),A=v.components||1;return m=Math.max(m,b),h+=b*A,{name:v.name,type:v.type,components:A,offset:E}}),size:q(h,Math.max(m,l)),alignment:l}}function q(u,l){return Math.ceil(u/l)*l}class $ extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const v=2*l;return this.int16[v+0]=h,this.int16[v+1]=m,l}}$.prototype.bytesPerElement=4,dn("StructArrayLayout2i4",$);class re extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,m)}emplace(l,h,m,v){const b=3*l;return this.int16[b+0]=h,this.int16[b+1]=m,this.int16[b+2]=v,l}}re.prototype.bytesPerElement=6,dn("StructArrayLayout3i6",re);class ue extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,l,h,m,v)}emplace(l,h,m,v,b){const E=4*l;return this.int16[E+0]=h,this.int16[E+1]=m,this.int16[E+2]=v,this.int16[E+3]=b,l}}ue.prototype.bytesPerElement=8,dn("StructArrayLayout4i8",ue);class de extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,v,b,E)}emplace(l,h,m,v,b,E,A){const k=6*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.int16[k+2]=v,this.int16[k+3]=b,this.int16[k+4]=E,this.int16[k+5]=A,l}}de.prototype.bytesPerElement=12,dn("StructArrayLayout2i4i12",de);class we extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,v,b,E)}emplace(l,h,m,v,b,E,A){const k=4*l,B=8*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.uint8[B+4]=v,this.uint8[B+5]=b,this.uint8[B+6]=E,this.uint8[B+7]=A,l}}we.prototype.bytesPerElement=8,dn("StructArrayLayout2i4ub8",we);class ge extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const v=2*l;return this.float32[v+0]=h,this.float32[v+1]=m,l}}ge.prototype.bytesPerElement=8,dn("StructArrayLayout2f8",ge);class Ce extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E,A,k,B,V){const W=this.length;return this.resize(W+1),this.emplace(W,l,h,m,v,b,E,A,k,B,V)}emplace(l,h,m,v,b,E,A,k,B,V,W){const X=10*l;return this.uint16[X+0]=h,this.uint16[X+1]=m,this.uint16[X+2]=v,this.uint16[X+3]=b,this.uint16[X+4]=E,this.uint16[X+5]=A,this.uint16[X+6]=k,this.uint16[X+7]=B,this.uint16[X+8]=V,this.uint16[X+9]=W,l}}Ce.prototype.bytesPerElement=20,dn("StructArrayLayout10ui20",Ce);class Oe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E,A,k,B,V,W,X){const J=this.length;return this.resize(J+1),this.emplace(J,l,h,m,v,b,E,A,k,B,V,W,X)}emplace(l,h,m,v,b,E,A,k,B,V,W,X,J){const se=12*l;return this.int16[se+0]=h,this.int16[se+1]=m,this.int16[se+2]=v,this.int16[se+3]=b,this.uint16[se+4]=E,this.uint16[se+5]=A,this.uint16[se+6]=k,this.uint16[se+7]=B,this.int16[se+8]=V,this.int16[se+9]=W,this.int16[se+10]=X,this.int16[se+11]=J,l}}Oe.prototype.bytesPerElement=24,dn("StructArrayLayout4i4ui4i24",Oe);class ye extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,m)}emplace(l,h,m,v){const b=3*l;return this.float32[b+0]=h,this.float32[b+1]=m,this.float32[b+2]=v,l}}ye.prototype.bytesPerElement=12,dn("StructArrayLayout3f12",ye);class Ve extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint32[1*l+0]=h,l}}Ve.prototype.bytesPerElement=4,dn("StructArrayLayout1ul4",Ve);class Xe extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E,A,k,B){const V=this.length;return this.resize(V+1),this.emplace(V,l,h,m,v,b,E,A,k,B)}emplace(l,h,m,v,b,E,A,k,B,V){const W=10*l,X=5*l;return this.int16[W+0]=h,this.int16[W+1]=m,this.int16[W+2]=v,this.int16[W+3]=b,this.int16[W+4]=E,this.int16[W+5]=A,this.uint32[X+3]=k,this.uint16[W+8]=B,this.uint16[W+9]=V,l}}Xe.prototype.bytesPerElement=20,dn("StructArrayLayout6i1ul2ui20",Xe);class nt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,v,b,E)}emplace(l,h,m,v,b,E,A){const k=6*l;return this.int16[k+0]=h,this.int16[k+1]=m,this.int16[k+2]=v,this.int16[k+3]=b,this.int16[k+4]=E,this.int16[k+5]=A,l}}nt.prototype.bytesPerElement=12,dn("StructArrayLayout2i2i2i12",nt);class _t extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b){const E=this.length;return this.resize(E+1),this.emplace(E,l,h,m,v,b)}emplace(l,h,m,v,b,E){const A=4*l,k=8*l;return this.float32[A+0]=h,this.float32[A+1]=m,this.float32[A+2]=v,this.int16[k+6]=b,this.int16[k+7]=E,l}}_t.prototype.bytesPerElement=16,dn("StructArrayLayout2f1f2i16",_t);class Rt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E){const A=this.length;return this.resize(A+1),this.emplace(A,l,h,m,v,b,E)}emplace(l,h,m,v,b,E,A){const k=16*l,B=4*l,V=8*l;return this.uint8[k+0]=h,this.uint8[k+1]=m,this.float32[B+1]=v,this.float32[B+2]=b,this.int16[V+6]=E,this.int16[V+7]=A,l}}Rt.prototype.bytesPerElement=16,dn("StructArrayLayout2ub2f2i16",Rt);class sn extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,m)}emplace(l,h,m,v){const b=3*l;return this.uint16[b+0]=h,this.uint16[b+1]=m,this.uint16[b+2]=v,l}}sn.prototype.bytesPerElement=6,dn("StructArrayLayout3ui6",sn);class an extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be){const je=this.length;return this.resize(je+1),this.emplace(je,l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be)}emplace(l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be,je){const Pe=24*l,Ge=12*l,ct=48*l;return this.int16[Pe+0]=h,this.int16[Pe+1]=m,this.uint16[Pe+2]=v,this.uint16[Pe+3]=b,this.uint32[Ge+2]=E,this.uint32[Ge+3]=A,this.uint32[Ge+4]=k,this.uint16[Pe+10]=B,this.uint16[Pe+11]=V,this.uint16[Pe+12]=W,this.float32[Ge+7]=X,this.float32[Ge+8]=J,this.uint8[ct+36]=se,this.uint8[ct+37]=he,this.uint8[ct+38]=_e,this.uint32[Ge+10]=be,this.int16[Pe+22]=je,l}}an.prototype.bytesPerElement=48,dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",an);class Dt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be,je,Pe,Ge,ct,wt,Xt,Dn,Qt,qt,Mn,mn){const un=this.length;return this.resize(un+1),this.emplace(un,l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be,je,Pe,Ge,ct,wt,Xt,Dn,Qt,qt,Mn,mn)}emplace(l,h,m,v,b,E,A,k,B,V,W,X,J,se,he,_e,be,je,Pe,Ge,ct,wt,Xt,Dn,Qt,qt,Mn,mn,un){const pt=32*l,An=16*l;return this.int16[pt+0]=h,this.int16[pt+1]=m,this.int16[pt+2]=v,this.int16[pt+3]=b,this.int16[pt+4]=E,this.int16[pt+5]=A,this.int16[pt+6]=k,this.int16[pt+7]=B,this.uint16[pt+8]=V,this.uint16[pt+9]=W,this.uint16[pt+10]=X,this.uint16[pt+11]=J,this.uint16[pt+12]=se,this.uint16[pt+13]=he,this.uint16[pt+14]=_e,this.uint16[pt+15]=be,this.uint16[pt+16]=je,this.uint16[pt+17]=Pe,this.uint16[pt+18]=Ge,this.uint16[pt+19]=ct,this.uint16[pt+20]=wt,this.uint16[pt+21]=Xt,this.uint16[pt+22]=Dn,this.uint32[An+12]=Qt,this.float32[An+13]=qt,this.float32[An+14]=Mn,this.uint16[pt+30]=mn,this.uint16[pt+31]=un,l}}Dt.prototype.bytesPerElement=64,dn("StructArrayLayout8i15ui1ul2f2ui64",Dt);class Nt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.float32[1*l+0]=h,l}}Nt.prototype.bytesPerElement=4,dn("StructArrayLayout1f4",Nt);class yn extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,m)}emplace(l,h,m,v){const b=3*l;return this.uint16[6*l+0]=h,this.float32[b+1]=m,this.float32[b+2]=v,l}}yn.prototype.bytesPerElement=12,dn("StructArrayLayout1ui2f12",yn);class qn extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,l,h,m)}emplace(l,h,m,v){const b=4*l;return this.uint32[2*l+0]=h,this.uint16[b+2]=m,this.uint16[b+3]=v,l}}qn.prototype.bytesPerElement=8,dn("StructArrayLayout1ul2ui8",qn);class $t extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,h){const m=this.length;return this.resize(m+1),this.emplace(m,l,h)}emplace(l,h,m){const v=2*l;return this.uint16[v+0]=h,this.uint16[v+1]=m,l}}$t.prototype.bytesPerElement=4,dn("StructArrayLayout2ui4",$t);class Jt extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const h=this.length;return this.resize(h+1),this.emplace(h,l)}emplace(l,h){return this.uint16[1*l+0]=h,l}}Jt.prototype.bytesPerElement=2,dn("StructArrayLayout1ui2",Jt);class Gn extends N{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,h,m,v){const b=this.length;return this.resize(b+1),this.emplace(b,l,h,m,v)}emplace(l,h,m,v,b){const E=4*l;return this.float32[E+0]=h,this.float32[E+1]=m,this.float32[E+2]=v,this.float32[E+3]=b,l}}Gn.prototype.bytesPerElement=16,dn("StructArrayLayout4f16",Gn);class fr extends F{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}fr.prototype.size=20;class ri extends Xe{get(l){return new fr(this,l)}}dn("CollisionBoxArray",ri);class di extends F{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}di.prototype.size=48;class pr extends an{get(l){return new di(this,l)}}dn("PlacedSymbolArray",pr);class vs extends F{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}vs.prototype.size=64;class pa extends Dt{get(l){return new vs(this,l)}}dn("SymbolInstanceArray",pa);class mr extends Nt{getoffsetX(l){return this.float32[1*l+0]}}dn("GlyphOffsetArray",mr);class to extends re{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}dn("SymbolLineVertexArray",to);class Bs extends F{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Bs.prototype.size=12;class xs extends yn{get(l){return new Bs(this,l)}}dn("TextAnchorOffsetArray",xs);class ws extends F{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ws.prototype.size=8;class ma extends qn{get(l){return new ws(this,l)}}dn("FeatureIndexArray",ma);class su extends ${}class cp extends ${}class gh extends ${}class ou extends de{}class up extends we{}class t_ extends ge{}class hs extends Ce{}class ga extends Oe{}class hc extends ye{}class _h extends Ve{}class bs extends nt{}class Ss extends Rt{}class is extends sn{}class xr extends $t{}const yh=G([{name:"a_pos",components:2,type:"Int16"}],4),{members:n_}=yh;class Yr{constructor(l=[]){this.segments=l}prepareSegment(l,h,m,v){let b=this.segments[this.segments.length-1];return l>Yr.MAX_VERTEX_ARRAY_LENGTH&&Fe(`Max vertices per segment is ${Yr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!b||b.vertexLength+l>Yr.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==v)&&(b={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(b.sortKey=v),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const l of this.segments)for(const h in l.vaos)l.vaos[h].destroy()}static simpleSegment(l,h,m,v){return new Yr([{vertexOffset:l,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function cv(u,l){return 256*(u=Y(Math.floor(u),0,255))+Y(Math.floor(l),0,255)}Yr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn("SegmentVector",Yr);const hp=G([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var dp={exports:{}},dc={exports:{}};dc.exports=function(u,l){var h,m,v,b,E,A,k,B;for(m=u.length-(h=3&u.length),v=l,E=3432918353,A=461845907,B=0;B<m;)k=255&u.charCodeAt(B)|(255&u.charCodeAt(++B))<<8|(255&u.charCodeAt(++B))<<16|(255&u.charCodeAt(++B))<<24,++B,v=27492+(65535&(b=5*(65535&(v=(v^=k=(65535&(k=(k=(65535&k)*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(k=0,h){case 3:k^=(255&u.charCodeAt(B+2))<<16;case 2:k^=(255&u.charCodeAt(B+1))<<8;case 1:v^=k=(65535&(k=(k=(65535&(k^=255&u.charCodeAt(B)))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*A+(((k>>>16)*A&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var uv=dc.exports,i_={exports:{}};i_.exports=function(u,l){for(var h,m=u.length,v=l^m,b=0;m>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(b)|(255&u.charCodeAt(++b))<<8|(255&u.charCodeAt(++b))<<16|(255&u.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++b;switch(m){case 3:v^=(255&u.charCodeAt(b+2))<<16;case 2:v^=(255&u.charCodeAt(b+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(b)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var r_=uv,s_=i_.exports;dp.exports=r_,dp.exports.murmur3=r_,dp.exports.murmur2=s_;var fp=d(dp.exports);class vh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,h,m,v){this.ids.push(zI(l)),this.positions.push(h,m,v)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=zI(l);let m=0,v=this.ids.length-1;for(;m<v;){const E=m+v>>1;this.ids[E]>=h?v=E:m=E+1}const b=[];for(;this.ids[m]===h;)b.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return b}static serialize(l,h){const m=new Float64Array(l.ids),v=new Uint32Array(l.positions);return Vb(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(l){const h=new vh;return h.ids=l.ids,h.positions=l.positions,h.indexed=!0,h}}function zI(u){const l=+u;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:fp(String(u))}function Vb(u,l,h,m){for(;h<m;){const v=u[h+m>>1];let b=h-1,E=m+1;for(;;){do b++;while(u[b]<v);do E--;while(u[E]>v);if(b>=E)break;hv(u,b,E),hv(l,3*b,3*E),hv(l,3*b+1,3*E+1),hv(l,3*b+2,3*E+2)}E-h<m-E?(Vb(u,l,h,E),h=E+1):(Vb(u,l,E+1,m),m=E)}}function hv(u,l,h){const m=u[l];u[l]=u[h],u[h]=m}dn("FeaturePositionMap",vh);class Xd{constructor(l,h){this.gl=l.gl,this.location=h}}class dv extends Xd{constructor(l,h){super(l,h),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class BI extends Xd{constructor(l,h){super(l,h),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class UI extends Xd{constructor(l,h){super(l,h),this.current=Ft.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const m4=new Float32Array(16);function Gb(u){return[cv(255*u.r,255*u.g),cv(255*u.b,255*u.a)]}class o_{constructor(l,h,m){this.value=l,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(l,h,m){l.set(m.constantOr(this.value))}getBinding(l,h,m){return this.type==="color"?new UI(l,h):new dv(l,h)}}class pp{constructor(l,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=l.tlbr}setUniform(l,h,m,v){const b=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&l.set(b)}getBinding(l,h,m){return m.substr(0,9)==="u_pattern"?new BI(l,h):new dv(l,h)}}class au{constructor(l,h,m,v){this.expression=l,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(b=>({name:`a_${b}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(l,h,m,v,b){const E=this.paintVertexArray.length,A=this.expression.evaluate(new rr(0),h,{},v,[],b);this.paintVertexArray.resize(l),this._setPaintValue(E,l,A)}updatePaintArray(l,h,m,v){const b=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(l,h,b)}_setPaintValue(l,h,m){if(this.type==="color"){const v=Gb(m);for(let b=l;b<h;b++)this.paintVertexArray.emplace(b,v[0],v[1])}else{for(let v=l;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class yl{constructor(l,h,m,v,b,E){this.expression=l,this.uniformNames=h.map(A=>`u_${A}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=h.map(A=>({name:`a_${A}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new E}populatePaintArray(l,h,m,v,b){const E=this.expression.evaluate(new rr(this.zoom),h,{},v,[],b),A=this.expression.evaluate(new rr(this.zoom+1),h,{},v,[],b),k=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(k,l,E,A)}updatePaintArray(l,h,m,v){const b=this.expression.evaluate({zoom:this.zoom},m,v),E=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(l,h,b,E)}_setPaintValue(l,h,m,v){if(this.type==="color"){const b=Gb(m),E=Gb(v);for(let A=l;A<h;A++)this.paintVertexArray.emplace(A,b[0],b[1],E[0],E[1])}else{for(let b=l;b<h;b++)this.paintVertexArray.emplace(b,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=Y(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);l.set(v)}getBinding(l,h,m){return new dv(l,h)}}class xh{constructor(l,h,m,v,b,E){this.expression=l,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=E,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(l,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(v,l,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(l,h,m,v,b){this._setPaintValues(l,h,m.patterns&&m.patterns[this.layerId],b)}_setPaintValues(l,h,m,v){if(!v||!m)return;const{min:b,mid:E,max:A}=m,k=v[b],B=v[E],V=v[A];if(k&&B&&V)for(let W=l;W<h;W++)this.zoomInPaintVertexArray.emplace(W,B.tl[0],B.tl[1],B.br[0],B.br[1],k.tl[0],k.tl[1],k.br[0],k.br[1],B.pixelRatio,k.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,B.tl[0],B.tl[1],B.br[0],B.br[1],V.tl[0],V.tl[1],V.br[0],V.br[1],B.pixelRatio,V.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,hp.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,hp.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class VI{constructor(l,h,m){this.binders={},this._buffers=[];const v=[];for(const b in l.paint._values){if(!m(b))continue;const E=l.paint.get(b);if(!(E instanceof $a&&Wo(E.property.specification)))continue;const A=g4(b,l.type),k=E.value,B=E.property.specification.type,V=E.property.useIntegerZoom,W=E.property.specification["property-type"],X=W==="cross-faded"||W==="cross-faded-data-driven";if(k.kind==="constant")this.binders[b]=X?new pp(k.value,A):new o_(k.value,A,B),v.push(`/u_${b}`);else if(k.kind==="source"||X){const J=GI(b,B,"source");this.binders[b]=X?new xh(k,B,V,h,J,l.id):new au(k,A,B,J),v.push(`/a_${b}`)}else{const J=GI(b,B,"composite");this.binders[b]=new yl(k,A,B,V,h,J),v.push(`/z_${b}`)}}this.cacheKey=v.sort().join("")}getMaxValue(l){const h=this.binders[l];return h instanceof au||h instanceof yl?h.maxValue:0}populatePaintArrays(l,h,m,v,b){for(const E in this.binders){const A=this.binders[E];(A instanceof au||A instanceof yl||A instanceof xh)&&A.populatePaintArray(l,h,m,v,b)}}setConstantPatternPositions(l,h){for(const m in this.binders){const v=this.binders[m];v instanceof pp&&v.setConstantPatternPositions(l,h)}}updatePaintArrays(l,h,m,v,b){let E=!1;for(const A in l){const k=h.getPositions(A);for(const B of k){const V=m.feature(B.index);for(const W in this.binders){const X=this.binders[W];if((X instanceof au||X instanceof yl||X instanceof xh)&&X.expression.isStateDependent===!0){const J=v.paint.get(W);X.expression=J.value,X.updatePaintArray(B.start,B.end,V,l[A],b),E=!0}}}}return E}defines(){const l=[];for(const h in this.binders){const m=this.binders[h];(m instanceof o_||m instanceof pp)&&l.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return l}getBinderAttributes(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof au||m instanceof yl)for(let v=0;v<m.paintVertexAttributes.length;v++)l.push(m.paintVertexAttributes[v].name);else if(m instanceof xh)for(let v=0;v<hp.members.length;v++)l.push(hp.members[v].name)}return l}getBinderUniforms(){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof o_||m instanceof pp||m instanceof yl)for(const v of m.uniformNames)l.push(v)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,h){const m=[];for(const v in this.binders){const b=this.binders[v];if(b instanceof o_||b instanceof pp||b instanceof yl){for(const E of b.uniformNames)if(h[E]){const A=b.getBinding(l,h[E],E);m.push({name:E,property:v,binding:A})}}}return m}setUniforms(l,h,m,v){for(const{name:b,property:E,binding:A}of h)this.binders[E].setUniform(A,v,m.get(E),b)}updatePaintBuffers(l){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(l&&m instanceof xh){const v=l.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof au||m instanceof yl)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(l){for(const h in this.binders){const m=this.binders[h];(m instanceof au||m instanceof yl||m instanceof xh)&&m.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const h=this.binders[l];(h instanceof au||h instanceof yl||h instanceof xh)&&h.destroy()}}}class Zd{constructor(l,h,m=()=>!0){this.programConfigurations={};for(const v of l)this.programConfigurations[v.id]=new VI(v,h,m);this.needsUpload=!1,this._featureMap=new vh,this._bufferOffset=0}populatePaintArrays(l,h,m,v,b,E){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(l,h,v,b,E);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,h,m,v){for(const b of m)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(l,this._featureMap,h,b,v)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function g4(u,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${l}-`,"").replace(/-/g,"_")]}function GI(u,l,h){const m={color:{source:ge,composite:Gn},number:{source:Nt,composite:ge}},v=function(b){return{"line-pattern":{source:hs,composite:hs},"fill-pattern":{source:hs,composite:hs},"fill-extrusion-pattern":{source:hs,composite:hs}}[b]}(u);return v&&v[h]||m[l][h]}dn("ConstantBinder",o_),dn("CrossFadedConstantBinder",pp),dn("SourceExpressionBinder",au),dn("CrossFadedCompositeBinder",xh),dn("CompositeExpressionBinder",yl),dn("ProgramConfiguration",VI,{omit:["_buffers"]}),dn("ProgramConfigurationSet",Zd);const jr=8192,Hb=Math.pow(2,14)-1,HI=-Hb-1;function Yd(u){const l=jr/u.extent,h=u.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let b=0;b<v.length;b++){const E=v[b],A=Math.round(E.x*l),k=Math.round(E.y*l);E.x=Y(A,HI,Hb),E.y=Y(k,HI,Hb),(A<E.x||A>E.x+1||k<E.y||k>E.y+1)&&Fe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Kd(u,l){return{type:u.type,id:u.id,properties:u.properties,geometry:l?Yd(u):[]}}function fv(u,l,h,m,v){u.emplaceBack(2*l+(m+1)/2,2*h+(v+1)/2)}class Wb{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new cp,this.indexArray=new is,this.segments=new Yr,this.programConfigurations=new Zd(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){const v=this.layers[0],b=[];let E=null,A=!1;v.type==="circle"&&(E=v.layout.get("circle-sort-key"),A=!E.isConstant());for(const{feature:k,id:B,index:V,sourceLayerIndex:W}of l){const X=this.layers[0]._featureFilter.needGeometry,J=Kd(k,X);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),J,m))continue;const se=A?E.evaluate(J,{},m):void 0,he={id:B,properties:k.properties,type:k.type,sourceLayerIndex:W,index:V,geometry:X?J.geometry:Yd(k),patterns:{},sortKey:se};b.push(he)}A&&b.sort((k,B)=>k.sortKey-B.sortKey);for(const k of b){const{geometry:B,index:V,sourceLayerIndex:W}=k,X=l[V].feature;this.addFeature(k,B,V,m),h.featureIndex.insert(X,B,V,W,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,n_),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,h,m,v){for(const b of h)for(const E of b){const A=E.x,k=E.y;if(A<0||A>=jr||k<0||k>=jr)continue;const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),V=B.vertexLength;fv(this.layoutVertexArray,A,k,-1,-1),fv(this.layoutVertexArray,A,k,1,-1),fv(this.layoutVertexArray,A,k,1,1),fv(this.layoutVertexArray,A,k,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,{},v)}}function WI(u,l){for(let h=0;h<u.length;h++)if(mp(l,u[h]))return!0;for(let h=0;h<l.length;h++)if(mp(u,l[h]))return!0;return!!jb(u,l)}function _4(u,l,h){return!!mp(u,l)||!!$b(l,u,h)}function jI(u,l){if(u.length===1)return qI(l,u[0]);for(let h=0;h<l.length;h++){const m=l[h];for(let v=0;v<m.length;v++)if(mp(u,m[v]))return!0}for(let h=0;h<u.length;h++)if(qI(l,u[h]))return!0;for(let h=0;h<l.length;h++)if(jb(u,l[h]))return!0;return!1}function y4(u,l,h){if(u.length>1){if(jb(u,l))return!0;for(let m=0;m<l.length;m++)if($b(l[m],u,h))return!0}for(let m=0;m<u.length;m++)if($b(u[m],l,h))return!0;return!1}function jb(u,l){if(u.length===0||l.length===0)return!1;for(let h=0;h<u.length-1;h++){const m=u[h],v=u[h+1];for(let b=0;b<l.length-1;b++)if(v4(m,v,l[b],l[b+1]))return!0}return!1}function v4(u,l,h,m){return qe(u,h,m)!==qe(l,h,m)&&qe(u,l,h)!==qe(u,l,m)}function $b(u,l,h){const m=h*h;if(l.length===1)return u.distSqr(l[0])<m;for(let v=1;v<l.length;v++)if($I(u,l[v-1],l[v])<m)return!0;return!1}function $I(u,l,h){const m=l.distSqr(h);if(m===0)return u.distSqr(l);const v=((u.x-l.x)*(h.x-l.x)+(u.y-l.y)*(h.y-l.y))/m;return u.distSqr(v<0?l:v>1?h:h.sub(l)._mult(v)._add(l))}function qI(u,l){let h,m,v,b=!1;for(let E=0;E<u.length;E++){h=u[E];for(let A=0,k=h.length-1;A<h.length;k=A++)m=h[A],v=h[k],m.y>l.y!=v.y>l.y&&l.x<(v.x-m.x)*(l.y-m.y)/(v.y-m.y)+m.x&&(b=!b)}return b}function mp(u,l){let h=!1;for(let m=0,v=u.length-1;m<u.length;v=m++){const b=u[m],E=u[v];b.y>l.y!=E.y>l.y&&l.x<(E.x-b.x)*(l.y-b.y)/(E.y-b.y)+b.x&&(h=!h)}return h}function x4(u,l,h){const m=h[0],v=h[2];if(u.x<m.x&&l.x<m.x||u.x>v.x&&l.x>v.x||u.y<m.y&&l.y<m.y||u.y>v.y&&l.y>v.y)return!1;const b=qe(u,l,h[0]);return b!==qe(u,l,h[1])||b!==qe(u,l,h[2])||b!==qe(u,l,h[3])}function a_(u,l,h){const m=l.paint.get(u).value;return m.kind==="constant"?m.value:h.programConfigurations.get(l.id).getMaxValue(u)}function pv(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function mv(u,l,h,m,v){if(!l[0]&&!l[1])return u;const b=_.convert(l)._mult(v);h==="viewport"&&b._rotate(-m);const E=[];for(let A=0;A<u.length;A++)E.push(u[A].sub(b));return E}let XI,ZI;dn("CircleBucket",Wb,{omit:["layers"]});var w4={get paint(){return ZI=ZI||new y({"circle-radius":new On(Te.paint_circle["circle-radius"]),"circle-color":new On(Te.paint_circle["circle-color"]),"circle-blur":new On(Te.paint_circle["circle-blur"]),"circle-opacity":new On(Te.paint_circle["circle-opacity"]),"circle-translate":new Tn(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new Tn(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tn(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tn(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new On(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new On(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new On(Te.paint_circle["circle-stroke-opacity"])})},get layout(){return XI=XI||new y({"circle-sort-key":new On(Te.layout_circle["circle-sort-key"])})}},no=1e-6,gp=typeof Float32Array<"u"?Float32Array:Array;function qb(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function YI(u,l,h){var m=l[0],v=l[1],b=l[2],E=l[3],A=l[4],k=l[5],B=l[6],V=l[7],W=l[8],X=l[9],J=l[10],se=l[11],he=l[12],_e=l[13],be=l[14],je=l[15],Pe=h[0],Ge=h[1],ct=h[2],wt=h[3];return u[0]=Pe*m+Ge*A+ct*W+wt*he,u[1]=Pe*v+Ge*k+ct*X+wt*_e,u[2]=Pe*b+Ge*B+ct*J+wt*be,u[3]=Pe*E+Ge*V+ct*se+wt*je,u[4]=(Pe=h[4])*m+(Ge=h[5])*A+(ct=h[6])*W+(wt=h[7])*he,u[5]=Pe*v+Ge*k+ct*X+wt*_e,u[6]=Pe*b+Ge*B+ct*J+wt*be,u[7]=Pe*E+Ge*V+ct*se+wt*je,u[8]=(Pe=h[8])*m+(Ge=h[9])*A+(ct=h[10])*W+(wt=h[11])*he,u[9]=Pe*v+Ge*k+ct*X+wt*_e,u[10]=Pe*b+Ge*B+ct*J+wt*be,u[11]=Pe*E+Ge*V+ct*se+wt*je,u[12]=(Pe=h[12])*m+(Ge=h[13])*A+(ct=h[14])*W+(wt=h[15])*he,u[13]=Pe*v+Ge*k+ct*X+wt*_e,u[14]=Pe*b+Ge*B+ct*J+wt*be,u[15]=Pe*E+Ge*V+ct*se+wt*je,u}Math.hypot||(Math.hypot=function(){for(var u=0,l=arguments.length;l--;)u+=arguments[l]*arguments[l];return Math.sqrt(u)});var l_,b4=YI;function gv(u,l,h){var m=l[0],v=l[1],b=l[2],E=l[3];return u[0]=h[0]*m+h[4]*v+h[8]*b+h[12]*E,u[1]=h[1]*m+h[5]*v+h[9]*b+h[13]*E,u[2]=h[2]*m+h[6]*v+h[10]*b+h[14]*E,u[3]=h[3]*m+h[7]*v+h[11]*b+h[15]*E,u}l_=new gp(4),gp!=Float32Array&&(l_[0]=0,l_[1]=0,l_[2]=0,l_[3]=0);class S4 extends M{constructor(l){super(l,w4)}createBucket(l){return new Wb(l)}queryRadius(l){const h=l;return a_("circle-radius",this,h)+a_("circle-stroke-width",this,h)+pv(this.paint.get("circle-translate"))}queryIntersectsFeature(l,h,m,v,b,E,A,k){const B=mv(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),E.angle,A),V=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),W=this.paint.get("circle-pitch-alignment")==="map",X=W?B:function(se,he){return se.map(_e=>KI(_e,he))}(B,k),J=W?V*A:V;for(const se of v)for(const he of se){const _e=W?he:KI(he,k);let be=J;const je=gv([],[he.x,he.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?be*=je[3]/E.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(be*=E.cameraToCenterDistance/je[3]),_4(X,_e,be))return!0}return!1}}function KI(u,l){const h=gv([],[u.x,u.y,0,1],l);return new _(h[0]/h[3],h[1]/h[3])}class JI extends Wb{}let QI;dn("HeatmapBucket",JI,{omit:["layers"]});var M4={get paint(){return QI=QI||new y({"heatmap-radius":new On(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new On(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tn(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new f(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tn(Te.paint_heatmap["heatmap-opacity"])})}};function Xb(u,{width:l,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==l*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${l*h*m}`)}else v=new Uint8Array(l*h*m);return u.width=l,u.height=h,u.data=v,u}function eP(u,{width:l,height:h},m){if(l===u.width&&h===u.height)return;const v=Xb({},{width:l,height:h},m);Zb(u,v,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,l),height:Math.min(u.height,h)},m),u.width=l,u.height=h,u.data=v.data}function Zb(u,l,h,m,v,b){if(v.width===0||v.height===0)return l;if(v.width>u.width||v.height>u.height||h.x>u.width-v.width||h.y>u.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>l.width||v.height>l.height||m.x>l.width-v.width||m.y>l.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const E=u.data,A=l.data;if(E===A)throw new Error("srcData equals dstData, so image is already copied");for(let k=0;k<v.height;k++){const B=((h.y+k)*u.width+h.x)*b,V=((m.y+k)*l.width+m.x)*b;for(let W=0;W<v.width*b;W++)A[V+W]=E[B+W]}return l}class c_{constructor(l,h){Xb(this,l,1,h)}resize(l){eP(this,l,1)}clone(){return new c_({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,v,b){Zb(l,h,m,v,b,1)}}class _a{constructor(l,h){Xb(this,l,4,h)}resize(l){eP(this,l,4)}replace(l,h){h?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,h,m,v,b){Zb(l,h,m,v,b,4)}}function tP(u){const l={},h=u.resolution||256,m=u.clips?u.clips.length:1,v=u.image||new _a({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const b=(E,A,k)=>{l[u.evaluationKey]=k;const B=u.expression.evaluate(l);v.data[E+A+0]=Math.floor(255*B.r/B.a),v.data[E+A+1]=Math.floor(255*B.g/B.a),v.data[E+A+2]=Math.floor(255*B.b/B.a),v.data[E+A+3]=Math.floor(255*B.a)};if(u.clips)for(let E=0,A=0;E<m;++E,A+=4*h)for(let k=0,B=0;k<h;k++,B+=4){const V=k/(h-1),{start:W,end:X}=u.clips[E];b(A,B,W*(1-V)+X*V)}else for(let E=0,A=0;E<h;E++,A+=4)b(0,A,E/(h-1));return v}dn("AlphaImage",c_),dn("RGBAImage",_a);class E4 extends M{createBucket(l){return new JI(l)}constructor(l){super(l,M4),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=tP({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nP;var T4={get paint(){return nP=nP||new y({"hillshade-illumination-direction":new Tn(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tn(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tn(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tn(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tn(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tn(Te.paint_hillshade["hillshade-accent-color"])})}};class C4 extends M{constructor(l){super(l,T4)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const A4=G([{name:"a_pos",components:2,type:"Int16"}],4),{members:I4}=A4;var Yb={exports:{}};function _v(u,l,h){h=h||2;var m,v,b,E,A,k,B,V=l&&l.length,W=V?l[0]*h:u.length,X=iP(u,0,W,h,!0),J=[];if(!X||X.next===X.prev)return J;if(V&&(X=function(he,_e,be,je){var Pe,Ge,ct,wt=[];for(Pe=0,Ge=_e.length;Pe<Ge;Pe++)(ct=iP(he,_e[Pe]*je,Pe<Ge-1?_e[Pe+1]*je:he.length,je,!1))===ct.next&&(ct.steiner=!0),wt.push(N4(ct));for(wt.sort(k4),Pe=0;Pe<wt.length;Pe++)be=F4(wt[Pe],be);return be}(u,l,X,h)),u.length>80*h){m=b=u[0],v=E=u[1];for(var se=h;se<W;se+=h)(A=u[se])<m&&(m=A),(k=u[se+1])<v&&(v=k),A>b&&(b=A),k>E&&(E=k);B=(B=Math.max(b-m,E-v))!==0?32767/B:0}return u_(X,J,h,m,v,B,0),J}function iP(u,l,h,m,v){var b,E;if(v===Qb(u,l,h,m)>0)for(b=l;b<h;b+=m)E=oP(b,u[b],u[b+1],E);else for(b=h-m;b>=l;b-=m)E=oP(b,u[b],u[b+1],E);return E&&yv(E,E.next)&&(d_(E),E=E.next),E}function Jd(u,l){if(!u)return u;l||(l=u);var h,m=u;do if(h=!1,m.steiner||!yv(m,m.next)&&Br(m.prev,m,m.next)!==0)m=m.next;else{if(d_(m),(m=l=m.prev)===m.next)break;h=!0}while(h||m!==l);return l}function u_(u,l,h,m,v,b,E){if(u){!E&&b&&function(V,W,X,J){var se=V;do se.z===0&&(se.z=Kb(se.x,se.y,W,X,J)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==V);se.prevZ.nextZ=null,se.prevZ=null,function(he){var _e,be,je,Pe,Ge,ct,wt,Xt,Dn=1;do{for(be=he,he=null,Ge=null,ct=0;be;){for(ct++,je=be,wt=0,_e=0;_e<Dn&&(wt++,je=je.nextZ);_e++);for(Xt=Dn;wt>0||Xt>0&&je;)wt!==0&&(Xt===0||!je||be.z<=je.z)?(Pe=be,be=be.nextZ,wt--):(Pe=je,je=je.nextZ,Xt--),Ge?Ge.nextZ=Pe:he=Pe,Pe.prevZ=Ge,Ge=Pe;be=je}Ge.nextZ=null,Dn*=2}while(ct>1)}(se)}(u,m,v,b);for(var A,k,B=u;u.prev!==u.next;)if(A=u.prev,k=u.next,b?R4(u,m,v,b):P4(u))l.push(A.i/h|0),l.push(u.i/h|0),l.push(k.i/h|0),d_(u),u=k.next,B=k.next;else if((u=k)===B){E?E===1?u_(u=L4(Jd(u),l,h),l,h,m,v,b,2):E===2&&D4(u,l,h,m,v,b):u_(Jd(u),l,h,m,v,b,1);break}}}function P4(u){var l=u.prev,h=u,m=u.next;if(Br(l,h,m)>=0)return!1;for(var v=l.x,b=h.x,E=m.x,A=l.y,k=h.y,B=m.y,V=v<b?v<E?v:E:b<E?b:E,W=A<k?A<B?A:B:k<B?k:B,X=v>b?v>E?v:E:b>E?b:E,J=A>k?A>B?A:B:k>B?k:B,se=m.next;se!==l;){if(se.x>=V&&se.x<=X&&se.y>=W&&se.y<=J&&_p(v,A,b,k,E,B,se.x,se.y)&&Br(se.prev,se,se.next)>=0)return!1;se=se.next}return!0}function R4(u,l,h,m){var v=u.prev,b=u,E=u.next;if(Br(v,b,E)>=0)return!1;for(var A=v.x,k=b.x,B=E.x,V=v.y,W=b.y,X=E.y,J=A<k?A<B?A:B:k<B?k:B,se=V<W?V<X?V:X:W<X?W:X,he=A>k?A>B?A:B:k>B?k:B,_e=V>W?V>X?V:X:W>X?W:X,be=Kb(J,se,l,h,m),je=Kb(he,_e,l,h,m),Pe=u.prevZ,Ge=u.nextZ;Pe&&Pe.z>=be&&Ge&&Ge.z<=je;){if(Pe.x>=J&&Pe.x<=he&&Pe.y>=se&&Pe.y<=_e&&Pe!==v&&Pe!==E&&_p(A,V,k,W,B,X,Pe.x,Pe.y)&&Br(Pe.prev,Pe,Pe.next)>=0||(Pe=Pe.prevZ,Ge.x>=J&&Ge.x<=he&&Ge.y>=se&&Ge.y<=_e&&Ge!==v&&Ge!==E&&_p(A,V,k,W,B,X,Ge.x,Ge.y)&&Br(Ge.prev,Ge,Ge.next)>=0))return!1;Ge=Ge.nextZ}for(;Pe&&Pe.z>=be;){if(Pe.x>=J&&Pe.x<=he&&Pe.y>=se&&Pe.y<=_e&&Pe!==v&&Pe!==E&&_p(A,V,k,W,B,X,Pe.x,Pe.y)&&Br(Pe.prev,Pe,Pe.next)>=0)return!1;Pe=Pe.prevZ}for(;Ge&&Ge.z<=je;){if(Ge.x>=J&&Ge.x<=he&&Ge.y>=se&&Ge.y<=_e&&Ge!==v&&Ge!==E&&_p(A,V,k,W,B,X,Ge.x,Ge.y)&&Br(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.nextZ}return!0}function L4(u,l,h){var m=u;do{var v=m.prev,b=m.next.next;!yv(v,b)&&rP(v,m,m.next,b)&&h_(v,b)&&h_(b,v)&&(l.push(v.i/h|0),l.push(m.i/h|0),l.push(b.i/h|0),d_(m),d_(m.next),m=u=b),m=m.next}while(m!==u);return Jd(m)}function D4(u,l,h,m,v,b){var E=u;do{for(var A=E.next.next;A!==E.prev;){if(E.i!==A.i&&z4(E,A)){var k=sP(E,A);return E=Jd(E,E.next),k=Jd(k,k.next),u_(E,l,h,m,v,b,0),void u_(k,l,h,m,v,b,0)}A=A.next}E=E.next}while(E!==u)}function k4(u,l){return u.x-l.x}function F4(u,l){var h=function(v,b){var E,A=b,k=v.x,B=v.y,V=-1/0;do{if(B<=A.y&&B>=A.next.y&&A.next.y!==A.y){var W=A.x+(B-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(W<=k&&W>V&&(V=W,E=A.x<A.next.x?A:A.next,W===k))return E}A=A.next}while(A!==b);if(!E)return null;var X,J=E,se=E.x,he=E.y,_e=1/0;A=E;do k>=A.x&&A.x>=se&&k!==A.x&&_p(B<he?k:V,B,se,he,B<he?V:k,B,A.x,A.y)&&(X=Math.abs(B-A.y)/(k-A.x),h_(A,v)&&(X<_e||X===_e&&(A.x>E.x||A.x===E.x&&O4(E,A)))&&(E=A,_e=X)),A=A.next;while(A!==J);return E}(u,l);if(!h)return l;var m=sP(h,u);return Jd(m,m.next),Jd(h,h.next)}function O4(u,l){return Br(u.prev,u,l.prev)<0&&Br(l.next,u,u.next)<0}function Kb(u,l,h,m,v){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*v|0)|u<<8))|u<<4))|u<<2))|u<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-m)*v|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function N4(u){var l=u,h=u;do(l.x<h.x||l.x===h.x&&l.y<h.y)&&(h=l),l=l.next;while(l!==u);return h}function _p(u,l,h,m,v,b,E,A){return(v-E)*(l-A)>=(u-E)*(b-A)&&(u-E)*(m-A)>=(h-E)*(l-A)&&(h-E)*(b-A)>=(v-E)*(m-A)}function z4(u,l){return u.next.i!==l.i&&u.prev.i!==l.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&rP(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(u,l)&&(h_(u,l)&&h_(l,u)&&function(h,m){var v=h,b=!1,E=(h.x+m.x)/2,A=(h.y+m.y)/2;do v.y>A!=v.next.y>A&&v.next.y!==v.y&&E<(v.next.x-v.x)*(A-v.y)/(v.next.y-v.y)+v.x&&(b=!b),v=v.next;while(v!==h);return b}(u,l)&&(Br(u.prev,u,l.prev)||Br(u,l.prev,l))||yv(u,l)&&Br(u.prev,u,u.next)>0&&Br(l.prev,l,l.next)>0)}function Br(u,l,h){return(l.y-u.y)*(h.x-l.x)-(l.x-u.x)*(h.y-l.y)}function yv(u,l){return u.x===l.x&&u.y===l.y}function rP(u,l,h,m){var v=xv(Br(u,l,h)),b=xv(Br(u,l,m)),E=xv(Br(h,m,u)),A=xv(Br(h,m,l));return v!==b&&E!==A||!(v!==0||!vv(u,h,l))||!(b!==0||!vv(u,m,l))||!(E!==0||!vv(h,u,m))||!(A!==0||!vv(h,l,m))}function vv(u,l,h){return l.x<=Math.max(u.x,h.x)&&l.x>=Math.min(u.x,h.x)&&l.y<=Math.max(u.y,h.y)&&l.y>=Math.min(u.y,h.y)}function xv(u){return u>0?1:u<0?-1:0}function h_(u,l){return Br(u.prev,u,u.next)<0?Br(u,l,u.next)>=0&&Br(u,u.prev,l)>=0:Br(u,l,u.prev)<0||Br(u,u.next,l)<0}function sP(u,l){var h=new Jb(u.i,u.x,u.y),m=new Jb(l.i,l.x,l.y),v=u.next,b=l.prev;return u.next=l,l.prev=u,h.next=v,v.prev=h,m.next=h,h.prev=m,b.next=m,m.prev=b,m}function oP(u,l,h,m){var v=new Jb(u,l,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function d_(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function Jb(u,l,h){this.i=u,this.x=l,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Qb(u,l,h,m){for(var v=0,b=l,E=h-m;b<h;b+=m)v+=(u[E]-u[b])*(u[b+1]+u[E+1]),E=b;return v}Yb.exports=_v,Yb.exports.default=_v,_v.deviation=function(u,l,h,m){var v=l&&l.length,b=Math.abs(Qb(u,0,v?l[0]*h:u.length,h));if(v)for(var E=0,A=l.length;E<A;E++)b-=Math.abs(Qb(u,l[E]*h,E<A-1?l[E+1]*h:u.length,h));var k=0;for(E=0;E<m.length;E+=3){var B=m[E]*h,V=m[E+1]*h,W=m[E+2]*h;k+=Math.abs((u[B]-u[W])*(u[V+1]-u[B+1])-(u[B]-u[V])*(u[W+1]-u[B+1]))}return b===0&&k===0?0:Math.abs((k-b)/b)},_v.flatten=function(u){for(var l=u[0][0].length,h={vertices:[],holes:[],dimensions:l},m=0,v=0;v<u.length;v++){for(var b=0;b<u[v].length;b++)for(var E=0;E<l;E++)h.vertices.push(u[v][b][E]);v>0&&h.holes.push(m+=u[v-1].length)}return h};var aP=d(Yb.exports);function eS(u,l,h){const m=h.patternDependencies;let v=!1;for(const b of l){const E=b.paint.get(`${u}-pattern`);E.isConstant()||(v=!0);const A=E.constantOr(null);A&&(v=!0,m[A.to]=!0,m[A.from]=!0)}return v}function tS(u,l,h,m,v){const b=v.patternDependencies;for(const E of l){const A=E.paint.get(`${u}-pattern`).value;if(A.kind!=="constant"){let k=A.evaluate({zoom:m-1},h,{},v.availableImages),B=A.evaluate({zoom:m},h,{},v.availableImages),V=A.evaluate({zoom:m+1},h,{},v.availableImages);k=k&&k.name?k.name:k,B=B&&B.name?B.name:B,V=V&&V.name?V.name:V,b[k]=!0,b[B]=!0,b[V]=!0,h.patterns[E.id]={min:k,mid:B,max:V}}}return h}class nS{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new gh,this.indexArray=new is,this.indexArray2=new xr,this.programConfigurations=new Zd(l.layers,l.zoom),this.segments=new Yr,this.segments2=new Yr,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.hasPattern=eS("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),b=!v.isConstant(),E=[];for(const{feature:A,id:k,index:B,sourceLayerIndex:V}of l){const W=this.layers[0]._featureFilter.needGeometry,X=Kd(A,W);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),X,m))continue;const J=b?v.evaluate(X,{},m,h.availableImages):void 0,se={id:k,properties:A.properties,type:A.type,sourceLayerIndex:V,index:B,geometry:W?X.geometry:Yd(A),patterns:{},sortKey:J};E.push(se)}b&&E.sort((A,k)=>A.sortKey-k.sortKey);for(const A of E){const{geometry:k,index:B,sourceLayerIndex:V}=A;if(this.hasPattern){const W=tS("fill",this.layers,A,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(A,k,B,m,{});h.featureIndex.insert(l[B].feature,k,B,V,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}addFeatures(l,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,I4),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,h,m,v,b){for(const E of Zl(h,500)){let A=0;for(const J of E)A+=J.length;const k=this.segments.prepareSegment(A,this.layoutVertexArray,this.indexArray),B=k.vertexLength,V=[],W=[];for(const J of E){if(J.length===0)continue;J!==E[0]&&W.push(V.length/2);const se=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),he=se.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(he+J.length-1,he),V.push(J[0].x),V.push(J[0].y);for(let _e=1;_e<J.length;_e++)this.layoutVertexArray.emplaceBack(J[_e].x,J[_e].y),this.indexArray2.emplaceBack(he+_e-1,he+_e),V.push(J[_e].x),V.push(J[_e].y);se.vertexLength+=J.length,se.primitiveLength+=J.length}const X=aP(V,W);for(let J=0;J<X.length;J+=3)this.indexArray.emplaceBack(B+X[J],B+X[J+1],B+X[J+2]);k.vertexLength+=A,k.primitiveLength+=X.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,b,v)}}let lP,cP;dn("FillBucket",nS,{omit:["layers","patternFeatures"]});var B4={get paint(){return cP=cP||new y({"fill-antialias":new Tn(Te.paint_fill["fill-antialias"]),"fill-opacity":new On(Te.paint_fill["fill-opacity"]),"fill-color":new On(Te.paint_fill["fill-color"]),"fill-outline-color":new On(Te.paint_fill["fill-outline-color"]),"fill-translate":new Tn(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new Tn(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new S(Te.paint_fill["fill-pattern"])})},get layout(){return lP=lP||new y({"fill-sort-key":new On(Te.layout_fill["fill-sort-key"])})}};class U4 extends M{constructor(l){super(l,B4)}recalculate(l,h){super.recalculate(l,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new nS(l)}queryRadius(){return pv(this.paint.get("fill-translate"))}queryIntersectsFeature(l,h,m,v,b,E,A){return jI(mv(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),E.angle,A),v)}isTileClipped(){return!0}}const V4=G([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),G4=G([{name:"a_centroid",components:2,type:"Int16"}],4),{members:H4}=V4;var wh={},W4=p,uP=yp;function yp(u,l,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=m,this._values=v,u.readFields(j4,this,l)}function j4(u,l,h){u==1?l.id=h.readVarint():u==2?function(m,v){for(var b=m.readVarint()+m.pos;m.pos<b;){var E=v._keys[m.readVarint()],A=v._values[m.readVarint()];v.properties[E]=A}}(h,l):u==3?l.type=h.readVarint():u==4&&(l._geometry=h.pos)}function $4(u){for(var l,h,m=0,v=0,b=u.length,E=b-1;v<b;E=v++)m+=((h=u[E]).x-(l=u[v]).x)*(l.y+h.y);return m}yp.types=["Unknown","Point","LineString","Polygon"],yp.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var l,h=u.readVarint()+u.pos,m=1,v=0,b=0,E=0,A=[];u.pos<h;){if(v<=0){var k=u.readVarint();m=7&k,v=k>>3}if(v--,m===1||m===2)b+=u.readSVarint(),E+=u.readSVarint(),m===1&&(l&&A.push(l),l=[]),l.push(new W4(b,E));else{if(m!==7)throw new Error("unknown command "+m);l&&l.push(l[0].clone())}}return l&&A.push(l),A},yp.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var l=u.readVarint()+u.pos,h=1,m=0,v=0,b=0,E=1/0,A=-1/0,k=1/0,B=-1/0;u.pos<l;){if(m<=0){var V=u.readVarint();h=7&V,m=V>>3}if(m--,h===1||h===2)(v+=u.readSVarint())<E&&(E=v),v>A&&(A=v),(b+=u.readSVarint())<k&&(k=b),b>B&&(B=b);else if(h!==7)throw new Error("unknown command "+h)}return[E,k,A,B]},yp.prototype.toGeoJSON=function(u,l,h){var m,v,b=this.extent*Math.pow(2,h),E=this.extent*u,A=this.extent*l,k=this.loadGeometry(),B=yp.types[this.type];function V(J){for(var se=0;se<J.length;se++){var he=J[se];J[se]=[360*(he.x+E)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+A)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(m=0;m<k.length;m++)W[m]=k[m][0];V(k=W);break;case 2:for(m=0;m<k.length;m++)V(k[m]);break;case 3:for(k=function(J){var se=J.length;if(se<=1)return[J];for(var he,_e,be=[],je=0;je<se;je++){var Pe=$4(J[je]);Pe!==0&&(_e===void 0&&(_e=Pe<0),_e===Pe<0?(he&&be.push(he),he=[J[je]]):he.push(J[je]))}return he&&be.push(he),be}(k),m=0;m<k.length;m++)for(v=0;v<k[m].length;v++)V(k[m][v])}k.length===1?k=k[0]:B="Multi"+B;var X={type:"Feature",geometry:{type:B,coordinates:k},properties:this.properties};return"id"in this&&(X.id=this.id),X};var q4=uP,hP=dP;function dP(u,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(X4,this,l),this.length=this._features.length}function X4(u,l,h){u===15?l.version=h.readVarint():u===1?l.name=h.readString():u===5?l.extent=h.readVarint():u===2?l._features.push(h.pos):u===3?l._keys.push(h.readString()):u===4&&l._values.push(function(m){for(var v=null,b=m.readVarint()+m.pos;m.pos<b;){var E=m.readVarint()>>3;v=E===1?m.readString():E===2?m.readFloat():E===3?m.readDouble():E===4?m.readVarint64():E===5?m.readVarint():E===6?m.readSVarint():E===7?m.readBoolean():null}return v}(h))}dP.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var l=this._pbf.readVarint()+this._pbf.pos;return new q4(this._pbf,l,this.extent,this._keys,this._values)};var Z4=hP;function Y4(u,l,h){if(u===3){var m=new Z4(h,h.readVarint()+h.pos);m.length&&(l[m.name]=m)}}wh.VectorTile=function(u,l){this.layers=u.readFields(Y4,{},l)},wh.VectorTileFeature=uP,wh.VectorTileLayer=hP;const K4=wh.VectorTileFeature.types,iS=Math.pow(2,13);function f_(u,l,h,m,v,b,E,A){u.emplaceBack(l,h,2*Math.floor(m*iS)+E,v*iS*2,b*iS*2,Math.round(A))}class rS{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new ou,this.centroidVertexArray=new su,this.indexArray=new is,this.programConfigurations=new Zd(l.layers,l.zoom),this.segments=new Yr,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.features=[],this.hasPattern=eS("fill-extrusion",this.layers,h);for(const{feature:v,id:b,index:E,sourceLayerIndex:A}of l){const k=this.layers[0]._featureFilter.needGeometry,B=Kd(v,k);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),B,m))continue;const V={id:b,sourceLayerIndex:A,index:E,geometry:k?B.geometry:Yd(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(tS("fill-extrusion",this.layers,V,this.zoom,h)):this.addFeature(V,V.geometry,E,m,{}),h.featureIndex.insert(v,V.geometry,E,A,this.index,!0)}}addFeatures(l,h,m){for(const v of this.features){const{geometry:b}=v;this.addFeature(v,b,v.index,h,m)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,H4),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,G4.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,h,m,v,b){for(const E of Zl(h,500)){const A={x:0,y:0,vertexCount:0};let k=0;for(const se of E)k+=se.length;let B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const se of E){if(se.length===0||Q4(se))continue;let he=0;for(let _e=0;_e<se.length;_e++){const be=se[_e];if(_e>=1){const je=se[_e-1];if(!J4(be,je)){B.vertexLength+4>Yr.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Pe=be.sub(je)._perp()._unit(),Ge=je.dist(be);he+Ge>32768&&(he=0),f_(this.layoutVertexArray,be.x,be.y,Pe.x,Pe.y,0,0,he),f_(this.layoutVertexArray,be.x,be.y,Pe.x,Pe.y,0,1,he),A.x+=2*be.x,A.y+=2*be.y,A.vertexCount+=2,he+=Ge,f_(this.layoutVertexArray,je.x,je.y,Pe.x,Pe.y,0,0,he),f_(this.layoutVertexArray,je.x,je.y,Pe.x,Pe.y,0,1,he),A.x+=2*je.x,A.y+=2*je.y,A.vertexCount+=2;const ct=B.vertexLength;this.indexArray.emplaceBack(ct,ct+2,ct+1),this.indexArray.emplaceBack(ct+1,ct+2,ct+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+k>Yr.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),K4[l.type]!=="Polygon")continue;const V=[],W=[],X=B.vertexLength;for(const se of E)if(se.length!==0){se!==E[0]&&W.push(V.length/2);for(let he=0;he<se.length;he++){const _e=se[he];f_(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),A.x+=_e.x,A.y+=_e.y,A.vertexCount+=1,V.push(_e.x),V.push(_e.y)}}const J=aP(V,W);for(let se=0;se<J.length;se+=3)this.indexArray.emplaceBack(X+J[se],X+J[se+2],X+J[se+1]);B.primitiveLength+=J.length/3,B.vertexLength+=k;for(let se=0;se<A.vertexCount;se++){const he=Math.floor(A.x/A.vertexCount),_e=Math.floor(A.y/A.vertexCount);this.centroidVertexArray.emplaceBack(he,_e)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,b,v)}}function J4(u,l){return u.x===l.x&&(u.x<0||u.x>jr)||u.y===l.y&&(u.y<0||u.y>jr)}function Q4(u){return u.every(l=>l.x<0)||u.every(l=>l.x>jr)||u.every(l=>l.y<0)||u.every(l=>l.y>jr)}let fP;dn("FillExtrusionBucket",rS,{omit:["layers","features"]});var e6={get paint(){return fP=fP||new y({"fill-extrusion-opacity":new Tn(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new On(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tn(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tn(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new S(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new On(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new On(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Tn(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class t6 extends M{constructor(l){super(l,e6)}createBucket(l){return new rS(l)}queryRadius(){return pv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,h,m,v,b,E,A,k){const B=mv(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),E.angle,A),V=this.paint.get("fill-extrusion-height").evaluate(h,m),W=this.paint.get("fill-extrusion-base").evaluate(h,m),X=function(se,he,_e,be){const je=[];for(const Pe of se){const Ge=[Pe.x,Pe.y,0,1];gv(Ge,Ge,he),je.push(new _(Ge[0]/Ge[3],Ge[1]/Ge[3]))}return je}(B,k),J=function(se,he,_e,be){const je=[],Pe=[],Ge=be[8]*he,ct=be[9]*he,wt=be[10]*he,Xt=be[11]*he,Dn=be[8]*_e,Qt=be[9]*_e,qt=be[10]*_e,Mn=be[11]*_e;for(const mn of se){const un=[],pt=[];for(const An of mn){const Sn=An.x,Wn=An.y,Ki=be[0]*Sn+be[4]*Wn+be[12],ji=be[1]*Sn+be[5]*Wn+be[13],rs=be[2]*Sn+be[6]*Wn+be[14],qa=be[3]*Sn+be[7]*Wn+be[15],Es=rs+wt,Dr=qa+Xt,io=Ki+Dn,ro=ji+Qt,so=rs+qt,kr=qa+Mn,ss=new _((Ki+Ge)/Dr,(ji+ct)/Dr);ss.z=Es/Dr,un.push(ss);const Us=new _(io/kr,ro/kr);Us.z=so/kr,pt.push(Us)}je.push(un),Pe.push(pt)}return[je,Pe]}(v,W,V,k);return function(se,he,_e){let be=1/0;jI(_e,he)&&(be=pP(_e,he[0]));for(let je=0;je<he.length;je++){const Pe=he[je],Ge=se[je];for(let ct=0;ct<Pe.length-1;ct++){const wt=Pe[ct],Xt=[wt,Pe[ct+1],Ge[ct+1],Ge[ct],wt];WI(_e,Xt)&&(be=Math.min(be,pP(_e,Xt)))}}return be!==1/0&&be}(J[0],J[1],X)}}function p_(u,l){return u.x*l.x+u.y*l.y}function pP(u,l){if(u.length===1){let h=0;const m=l[h++];let v;for(;!v||m.equals(v);)if(v=l[h++],!v)return 1/0;for(;h<l.length;h++){const b=l[h],E=u[0],A=v.sub(m),k=b.sub(m),B=E.sub(m),V=p_(A,A),W=p_(A,k),X=p_(k,k),J=p_(B,A),se=p_(B,k),he=V*X-W*W,_e=(X*J-W*se)/he,be=(V*se-W*J)/he,je=m.z*(1-_e-be)+v.z*_e+b.z*be;if(isFinite(je))return je}return 1/0}{let h=1/0;for(const m of l)h=Math.min(h,m.z);return h}}const n6=G([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:i6}=n6,r6=G([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:s6}=r6,o6=wh.VectorTileFeature.types,a6=Math.cos(Math.PI/180*37.5),mP=Math.pow(2,14)/.5;class sS{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(h=>h.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new up,this.layoutVertexArray2=new t_,this.indexArray=new is,this.programConfigurations=new Zd(l.layers,l.zoom),this.segments=new Yr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(l,h,m){this.hasPattern=eS("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),b=!v.isConstant(),E=[];for(const{feature:A,id:k,index:B,sourceLayerIndex:V}of l){const W=this.layers[0]._featureFilter.needGeometry,X=Kd(A,W);if(!this.layers[0]._featureFilter.filter(new rr(this.zoom),X,m))continue;const J=b?v.evaluate(X,{},m):void 0,se={id:k,properties:A.properties,type:A.type,sourceLayerIndex:V,index:B,geometry:W?X.geometry:Yd(A),patterns:{},sortKey:J};E.push(se)}b&&E.sort((A,k)=>A.sortKey-k.sortKey);for(const A of E){const{geometry:k,index:B,sourceLayerIndex:V}=A;if(this.hasPattern){const W=tS("line",this.layers,A,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(A,k,B,m,{});h.featureIndex.insert(l[B].feature,k,B,V,this.index)}}update(l,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,h,this.stateDependentLayers,m)}addFeatures(l,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,s6)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,i6),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,h,m,v,b){const E=this.layers[0].layout,A=E.get("line-join").evaluate(l,{}),k=E.get("line-cap"),B=E.get("line-miter-limit"),V=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const W of h)this.addLine(W,l,A,k,B,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,m,b,v)}addLine(l,h,m,v,b,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let be=0;be<l.length-1;be++)this.totalDistance+=l[be].dist(l[be+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const A=o6[h.type]==="Polygon";let k=l.length;for(;k>=2&&l[k-1].equals(l[k-2]);)k--;let B=0;for(;B<k-1&&l[B].equals(l[B+1]);)B++;if(k<(A?3:2))return;m==="bevel"&&(b=1.05);const V=this.overscaling<=16?15*jr/(512*this.overscaling):0,W=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray);let X,J,se,he,_e;this.e1=this.e2=-1,A&&(X=l[k-2],_e=l[B].sub(X)._unit()._perp());for(let be=B;be<k;be++){if(se=be===k-1?A?l[B+1]:void 0:l[be+1],se&&l[be].equals(se))continue;_e&&(he=_e),X&&(J=X),X=l[be],_e=se?se.sub(X)._unit()._perp():he,he=he||_e;let je=he.add(_e);je.x===0&&je.y===0||je._unit();const Pe=he.x*_e.x+he.y*_e.y,Ge=je.x*_e.x+je.y*_e.y,ct=Ge!==0?1/Ge:1/0,wt=2*Math.sqrt(2-2*Ge),Xt=Ge<a6&&J&&se,Dn=he.x*_e.y-he.y*_e.x>0;if(Xt&&be>B){const Mn=X.dist(J);if(Mn>2*V){const mn=X.sub(X.sub(J)._mult(V/Mn)._round());this.updateDistance(J,mn),this.addCurrentVertex(mn,he,0,0,W),J=mn}}const Qt=J&&se;let qt=Qt?m:A?"butt":v;if(Qt&&qt==="round"&&(ct<E?qt="miter":ct<=2&&(qt="fakeround")),qt==="miter"&&ct>b&&(qt="bevel"),qt==="bevel"&&(ct>2&&(qt="flipbevel"),ct<b&&(qt="miter")),J&&this.updateDistance(J,X),qt==="miter")je._mult(ct),this.addCurrentVertex(X,je,0,0,W);else if(qt==="flipbevel"){if(ct>100)je=_e.mult(-1);else{const Mn=ct*he.add(_e).mag()/he.sub(_e).mag();je._perp()._mult(Mn*(Dn?-1:1))}this.addCurrentVertex(X,je,0,0,W),this.addCurrentVertex(X,je.mult(-1),0,0,W)}else if(qt==="bevel"||qt==="fakeround"){const Mn=-Math.sqrt(ct*ct-1),mn=Dn?Mn:0,un=Dn?0:Mn;if(J&&this.addCurrentVertex(X,he,mn,un,W),qt==="fakeround"){const pt=Math.round(180*wt/Math.PI/20);for(let An=1;An<pt;An++){let Sn=An/pt;if(Sn!==.5){const Ki=Sn-.5;Sn+=Sn*Ki*(Sn-1)*((1.0904+Pe*(Pe*(3.55645-1.43519*Pe)-3.2452))*Ki*Ki+(.848013+Pe*(.215638*Pe-1.06021)))}const Wn=_e.sub(he)._mult(Sn)._add(he)._unit()._mult(Dn?-1:1);this.addHalfVertex(X,Wn.x,Wn.y,!1,Dn,0,W)}}se&&this.addCurrentVertex(X,_e,-mn,-un,W)}else if(qt==="butt")this.addCurrentVertex(X,je,0,0,W);else if(qt==="square"){const Mn=J?1:-1;this.addCurrentVertex(X,je,Mn,Mn,W)}else qt==="round"&&(J&&(this.addCurrentVertex(X,he,0,0,W),this.addCurrentVertex(X,he,1,1,W,!0)),se&&(this.addCurrentVertex(X,_e,-1,-1,W,!0),this.addCurrentVertex(X,_e,0,0,W)));if(Xt&&be<k-1){const Mn=X.dist(se);if(Mn>2*V){const mn=X.add(se.sub(X)._mult(V/Mn)._round());this.updateDistance(X,mn),this.addCurrentVertex(mn,_e,0,0,W),X=mn}}}}addCurrentVertex(l,h,m,v,b,E=!1){const A=h.y*v-h.x,k=-h.y-h.x*v;this.addHalfVertex(l,h.x+h.y*m,h.y-h.x*m,E,!1,m,b),this.addHalfVertex(l,A,k,E,!0,-v,b),this.distance>mP/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,h,m,v,b,E))}addHalfVertex({x:l,y:h},m,v,b,E,A,k){const B=.5*(this.lineClips?this.scaledDistance*(mP-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(b?1:0),(h<<1)+(E?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(A===0?0:A<0?-1:1)|(63&B)<<2,B>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const V=k.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,V),k.primitiveLength++),E?this.e2=V:this.e1=V}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,h){this.distance+=l.dist(h),this.updateScaledDistance()}}let gP,_P;dn("LineBucket",sS,{omit:["layers","patternFeatures"]});var yP={get paint(){return _P=_P||new y({"line-opacity":new On(Te.paint_line["line-opacity"]),"line-color":new On(Te.paint_line["line-color"]),"line-translate":new Tn(Te.paint_line["line-translate"]),"line-translate-anchor":new Tn(Te.paint_line["line-translate-anchor"]),"line-width":new On(Te.paint_line["line-width"]),"line-gap-width":new On(Te.paint_line["line-gap-width"]),"line-offset":new On(Te.paint_line["line-offset"]),"line-blur":new On(Te.paint_line["line-blur"]),"line-dasharray":new c(Te.paint_line["line-dasharray"]),"line-pattern":new S(Te.paint_line["line-pattern"]),"line-gradient":new f(Te.paint_line["line-gradient"])})},get layout(){return gP=gP||new y({"line-cap":new Tn(Te.layout_line["line-cap"]),"line-join":new On(Te.layout_line["line-join"]),"line-miter-limit":new Tn(Te.layout_line["line-miter-limit"]),"line-round-limit":new Tn(Te.layout_line["line-round-limit"]),"line-sort-key":new On(Te.layout_line["line-sort-key"])})}};class l6 extends On{possiblyEvaluate(l,h){return h=new rr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(l,h)}evaluate(l,h,m,v){return h=te({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(l,h,m,v)}}let wv;class c6 extends M{constructor(l){super(l,yP),this.gradientVersion=0,wv||(wv=new l6(yP.paint.properties["line-width"].specification),wv.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Tt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,h){super.recalculate(l,h),this.paint._values["line-floorwidth"]=wv.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new sS(l)}queryRadius(l){const h=l,m=vP(a_("line-width",this,h),a_("line-gap-width",this,h)),v=a_("line-offset",this,h);return m/2+Math.abs(v)+pv(this.paint.get("line-translate"))}queryIntersectsFeature(l,h,m,v,b,E,A){const k=mv(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),E.angle,A),B=A/2*vP(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),V=this.paint.get("line-offset").evaluate(h,m);return V&&(v=function(W,X){const J=[];for(let se=0;se<W.length;se++){const he=W[se],_e=[];for(let be=0;be<he.length;be++){const je=he[be-1],Pe=he[be],Ge=he[be+1],ct=be===0?new _(0,0):Pe.sub(je)._unit()._perp(),wt=be===he.length-1?new _(0,0):Ge.sub(Pe)._unit()._perp(),Xt=ct._add(wt)._unit(),Dn=Xt.x*wt.x+Xt.y*wt.y;Dn!==0&&Xt._mult(1/Dn),_e.push(Xt._mult(X)._add(Pe))}J.push(_e)}return J}(v,V*A)),function(W,X,J){for(let se=0;se<X.length;se++){const he=X[se];if(W.length>=3){for(let _e=0;_e<he.length;_e++)if(mp(W,he[_e]))return!0}if(y4(W,he,J))return!0}return!1}(k,v,B)}isTileClipped(){return!0}}function vP(u,l){return l>0?l+2*u:u}const u6=G([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),h6=G([{name:"a_projected_pos",components:3,type:"Float32"}],4);G([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const d6=G([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);G([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const xP=G([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),f6=G([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function p6(u,l,h){return u.sections.forEach(m=>{m.text=function(v,b,E){const A=b.layout.get("text-transform").evaluate(E,{});return A==="uppercase"?v=v.toLocaleUpperCase():A==="lowercase"&&(v=v.toLocaleLowerCase()),uc.applyArabicShaping&&(v=uc.applyArabicShaping(v)),v}(m.text,l,h)}),u}G([{name:"triangle",components:3,type:"Uint16"}]),G([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),G([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),G([{type:"Float32",name:"offsetX"}]),G([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),G([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const m_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Kr=24,wP=Wi,bP=function(u,l,h,m,v){var b,E,A=8*v-m-1,k=(1<<A)-1,B=k>>1,V=-7,W=v-1,X=-1,J=u[l+W];for(W+=X,b=J&(1<<-V)-1,J>>=-V,V+=A;V>0;b=256*b+u[l+W],W+=X,V-=8);for(E=b&(1<<-V)-1,b>>=-V,V+=m;V>0;E=256*E+u[l+W],W+=X,V-=8);if(b===0)b=1-B;else{if(b===k)return E?NaN:1/0*(J?-1:1);E+=Math.pow(2,m),b-=B}return(J?-1:1)*E*Math.pow(2,b-m)},SP=function(u,l,h,m,v,b){var E,A,k,B=8*b-v-1,V=(1<<B)-1,W=V>>1,X=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=0,se=1,he=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(A=isNaN(l)?1:0,E=V):(E=Math.floor(Math.log(l)/Math.LN2),l*(k=Math.pow(2,-E))<1&&(E--,k*=2),(l+=E+W>=1?X/k:X*Math.pow(2,1-W))*k>=2&&(E++,k/=2),E+W>=V?(A=0,E=V):E+W>=1?(A=(l*k-1)*Math.pow(2,v),E+=W):(A=l*Math.pow(2,W-1)*Math.pow(2,v),E=0));v>=8;u[h+J]=255&A,J+=se,A/=256,v-=8);for(E=E<<v|A,B+=v;B>0;u[h+J]=255&E,J+=se,E/=256,B-=8);u[h+J-se]|=128*he};function Wi(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}Wi.Varint=0,Wi.Fixed64=1,Wi.Bytes=2,Wi.Fixed32=5;var oS=4294967296,MP=1/oS,EP=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function lu(u){return u.type===Wi.Bytes?u.readVarint()+u.pos:u.pos+1}function vp(u,l,h){return h?4294967296*l+(u>>>0):4294967296*(l>>>0)+(u>>>0)}function TP(u,l,h){var m=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=u;v--)h.buf[v+m]=h.buf[v]}function m6(u,l){for(var h=0;h<u.length;h++)l.writeVarint(u[h])}function g6(u,l){for(var h=0;h<u.length;h++)l.writeSVarint(u[h])}function _6(u,l){for(var h=0;h<u.length;h++)l.writeFloat(u[h])}function y6(u,l){for(var h=0;h<u.length;h++)l.writeDouble(u[h])}function v6(u,l){for(var h=0;h<u.length;h++)l.writeBoolean(u[h])}function x6(u,l){for(var h=0;h<u.length;h++)l.writeFixed32(u[h])}function w6(u,l){for(var h=0;h<u.length;h++)l.writeSFixed32(u[h])}function b6(u,l){for(var h=0;h<u.length;h++)l.writeFixed64(u[h])}function S6(u,l){for(var h=0;h<u.length;h++)l.writeSFixed64(u[h])}function bv(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+16777216*u[l+3]}function xp(u,l,h){u[h]=l,u[h+1]=l>>>8,u[h+2]=l>>>16,u[h+3]=l>>>24}function CP(u,l){return(u[l]|u[l+1]<<8|u[l+2]<<16)+(u[l+3]<<24)}Wi.prototype={destroy:function(){this.buf=null},readFields:function(u,l,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,b=this.pos;this.type=7&m,u(v,l,this),this.pos===b&&this.skip(m)}return l},readMessage:function(u,l){return this.readFields(u,l,this.readVarint()+this.pos)},readFixed32:function(){var u=bv(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=CP(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=bv(this.buf,this.pos)+bv(this.buf,this.pos+4)*oS;return this.pos+=8,u},readSFixed64:function(){var u=bv(this.buf,this.pos)+CP(this.buf,this.pos+4)*oS;return this.pos+=8,u},readFloat:function(){var u=bP(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=bP(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var l,h,m=this.buf;return l=127&(h=m[this.pos++]),h<128?l:(l|=(127&(h=m[this.pos++]))<<7,h<128?l:(l|=(127&(h=m[this.pos++]))<<14,h<128?l:(l|=(127&(h=m[this.pos++]))<<21,h<128?l:function(v,b,E){var A,k,B=E.buf;if(A=(112&(k=B[E.pos++]))>>4,k<128||(A|=(127&(k=B[E.pos++]))<<3,k<128)||(A|=(127&(k=B[E.pos++]))<<10,k<128)||(A|=(127&(k=B[E.pos++]))<<17,k<128)||(A|=(127&(k=B[E.pos++]))<<24,k<128)||(A|=(1&(k=B[E.pos++]))<<31,k<128))return vp(v,A,b);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(h=m[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,l=this.pos;return this.pos=u,u-l>=12&&EP?function(h,m,v){return EP.decode(h.subarray(m,v))}(this.buf,l,u):function(h,m,v){for(var b="",E=m;E<v;){var A,k,B,V=h[E],W=null,X=V>239?4:V>223?3:V>191?2:1;if(E+X>v)break;X===1?V<128&&(W=V):X===2?(192&(A=h[E+1]))==128&&(W=(31&V)<<6|63&A)<=127&&(W=null):X===3?(k=h[E+2],(192&(A=h[E+1]))==128&&(192&k)==128&&((W=(15&V)<<12|(63&A)<<6|63&k)<=2047||W>=55296&&W<=57343)&&(W=null)):X===4&&(k=h[E+2],B=h[E+3],(192&(A=h[E+1]))==128&&(192&k)==128&&(192&B)==128&&((W=(15&V)<<18|(63&A)<<12|(63&k)<<6|63&B)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,X=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),E+=X}return b}(this.buf,l,u)},readBytes:function(){var u=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,u);return this.pos=u,l},readPackedVarint:function(u,l){if(this.type!==Wi.Bytes)return u.push(this.readVarint(l));var h=lu(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(l));return u},readPackedSVarint:function(u){if(this.type!==Wi.Bytes)return u.push(this.readSVarint());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==Wi.Bytes)return u.push(this.readBoolean());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==Wi.Bytes)return u.push(this.readFloat());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==Wi.Bytes)return u.push(this.readDouble());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==Wi.Bytes)return u.push(this.readFixed32());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==Wi.Bytes)return u.push(this.readSFixed32());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==Wi.Bytes)return u.push(this.readFixed64());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==Wi.Bytes)return u.push(this.readSFixed64());var l=lu(this);for(u=u||[];this.pos<l;)u.push(this.readSFixed64());return u},skip:function(u){var l=7&u;if(l===Wi.Varint)for(;this.buf[this.pos++]>127;);else if(l===Wi.Bytes)this.pos=this.readVarint()+this.pos;else if(l===Wi.Fixed32)this.pos+=4;else{if(l!==Wi.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(u,l){this.writeVarint(u<<3|l)},realloc:function(u){for(var l=this.length||16;l<this.pos+u;)l*=2;if(l!==this.length){var h=new Uint8Array(l);h.set(this.buf),this.buf=h,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),xp(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),xp(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),xp(this.buf,-1&u,this.pos),xp(this.buf,Math.floor(u*MP),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),xp(this.buf,-1&u,this.pos),xp(this.buf,Math.floor(u*MP),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(l,h){var m,v;if(l>=0?(m=l%4294967296|0,v=l/4294967296|0):(v=~(-l/4294967296),4294967295^(m=~(-l%4294967296))?m=m+1|0:(m=0,v=v+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(b,E,A){A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,b>>>=7,A.buf[A.pos++]=127&b|128,A.buf[A.pos]=127&(b>>>=7)}(m,0,h),function(b,E){var A=(7&b)<<4;E.buf[E.pos++]|=A|((b>>>=3)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b|((b>>>=7)?128:0),b&&(E.buf[E.pos++]=127&b)))))}(v,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var l=this.pos;this.pos=function(m,v,b){for(var E,A,k=0;k<v.length;k++){if((E=v.charCodeAt(k))>55295&&E<57344){if(!A){E>56319||k+1===v.length?(m[b++]=239,m[b++]=191,m[b++]=189):A=E;continue}if(E<56320){m[b++]=239,m[b++]=191,m[b++]=189,A=E;continue}E=A-55296<<10|E-56320|65536,A=null}else A&&(m[b++]=239,m[b++]=191,m[b++]=189,A=null);E<128?m[b++]=E:(E<2048?m[b++]=E>>6|192:(E<65536?m[b++]=E>>12|224:(m[b++]=E>>18|240,m[b++]=E>>12&63|128),m[b++]=E>>6&63|128),m[b++]=63&E|128)}return b}(this.buf,u,this.pos);var h=this.pos-l;h>=128&&TP(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),SP(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),SP(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var l=u.length;this.writeVarint(l),this.realloc(l);for(var h=0;h<l;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,l){this.pos++;var h=this.pos;u(l,this);var m=this.pos-h;m>=128&&TP(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(u,l,h){this.writeTag(u,Wi.Bytes),this.writeRawMessage(l,h)},writePackedVarint:function(u,l){l.length&&this.writeMessage(u,m6,l)},writePackedSVarint:function(u,l){l.length&&this.writeMessage(u,g6,l)},writePackedBoolean:function(u,l){l.length&&this.writeMessage(u,v6,l)},writePackedFloat:function(u,l){l.length&&this.writeMessage(u,_6,l)},writePackedDouble:function(u,l){l.length&&this.writeMessage(u,y6,l)},writePackedFixed32:function(u,l){l.length&&this.writeMessage(u,x6,l)},writePackedSFixed32:function(u,l){l.length&&this.writeMessage(u,w6,l)},writePackedFixed64:function(u,l){l.length&&this.writeMessage(u,b6,l)},writePackedSFixed64:function(u,l){l.length&&this.writeMessage(u,S6,l)},writeBytesField:function(u,l){this.writeTag(u,Wi.Bytes),this.writeBytes(l)},writeFixed32Field:function(u,l){this.writeTag(u,Wi.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(u,l){this.writeTag(u,Wi.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(u,l){this.writeTag(u,Wi.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(u,l){this.writeTag(u,Wi.Fixed64),this.writeSFixed64(l)},writeVarintField:function(u,l){this.writeTag(u,Wi.Varint),this.writeVarint(l)},writeSVarintField:function(u,l){this.writeTag(u,Wi.Varint),this.writeSVarint(l)},writeStringField:function(u,l){this.writeTag(u,Wi.Bytes),this.writeString(l)},writeFloatField:function(u,l){this.writeTag(u,Wi.Fixed32),this.writeFloat(l)},writeDoubleField:function(u,l){this.writeTag(u,Wi.Fixed64),this.writeDouble(l)},writeBooleanField:function(u,l){this.writeVarintField(u,!!l)}};var aS=d(wP);const lS=3;function M6(u,l,h){u===1&&h.readMessage(E6,l)}function E6(u,l,h){if(u===3){const{id:m,bitmap:v,width:b,height:E,left:A,top:k,advance:B}=h.readMessage(T6,{});l.push({id:m,bitmap:new c_({width:b+2*lS,height:E+2*lS},v),metrics:{width:b,height:E,left:A,top:k,advance:B}})}}function T6(u,l,h){u===1?l.id=h.readVarint():u===2?l.bitmap=h.readBytes():u===3?l.width=h.readVarint():u===4?l.height=h.readVarint():u===5?l.left=h.readSVarint():u===6?l.top=h.readSVarint():u===7&&(l.advance=h.readVarint())}const AP=lS;function IP(u){let l=0,h=0;for(const E of u)l+=E.w*E.h,h=Math.max(h,E.w);u.sort((E,A)=>A.h-E.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),h),h:1/0}];let v=0,b=0;for(const E of u)for(let A=m.length-1;A>=0;A--){const k=m[A];if(!(E.w>k.w||E.h>k.h)){if(E.x=k.x,E.y=k.y,b=Math.max(b,E.y+E.h),v=Math.max(v,E.x+E.w),E.w===k.w&&E.h===k.h){const B=m.pop();A<m.length&&(m[A]=B)}else E.h===k.h?(k.x+=E.w,k.w-=E.w):E.w===k.w?(k.y+=E.h,k.h-=E.h):(m.push({x:k.x+E.w,y:k.y,w:k.w-E.w,h:E.h}),k.y+=E.h,k.h-=E.h);break}}return{w:v,h:b,fill:l/(v*b)||0}}const Io=1;class cS{constructor(l,{pixelRatio:h,version:m,stretchX:v,stretchY:b,content:E,textFitWidth:A,textFitHeight:k}){this.paddedRect=l,this.pixelRatio=h,this.stretchX=v,this.stretchY=b,this.content=E,this.version=m,this.textFitWidth=A,this.textFitHeight=k}get tl(){return[this.paddedRect.x+Io,this.paddedRect.y+Io]}get br(){return[this.paddedRect.x+this.paddedRect.w-Io,this.paddedRect.y+this.paddedRect.h-Io]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Io)/this.pixelRatio,(this.paddedRect.h-2*Io)/this.pixelRatio]}}class PP{constructor(l,h){const m={},v={};this.haveRenderCallbacks=[];const b=[];this.addImages(l,m,b),this.addImages(h,v,b);const{w:E,h:A}=IP(b),k=new _a({width:E||1,height:A||1});for(const B in l){const V=l[B],W=m[B].paddedRect;_a.copy(V.data,k,{x:0,y:0},{x:W.x+Io,y:W.y+Io},V.data)}for(const B in h){const V=h[B],W=v[B].paddedRect,X=W.x+Io,J=W.y+Io,se=V.data.width,he=V.data.height;_a.copy(V.data,k,{x:0,y:0},{x:X,y:J},V.data),_a.copy(V.data,k,{x:0,y:he-1},{x:X,y:J-1},{width:se,height:1}),_a.copy(V.data,k,{x:0,y:0},{x:X,y:J+he},{width:se,height:1}),_a.copy(V.data,k,{x:se-1,y:0},{x:X-1,y:J},{width:1,height:he}),_a.copy(V.data,k,{x:0,y:0},{x:X+se,y:J},{width:1,height:he})}this.image=k,this.iconPositions=m,this.patternPositions=v}addImages(l,h,m){for(const v in l){const b=l[v],E={x:0,y:0,w:b.data.width+2*Io,h:b.data.height+2*Io};m.push(E),h[v]=new cS(E,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(l,h){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in l.updatedImages)this.patchUpdatedImage(this.iconPositions[m],l.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],l.getImage(m),h)}patchUpdatedImage(l,h,m){if(!l||!h||l.version===h.version)return;l.version=h.version;const[v,b]=l.tl;m.update(h.data,void 0,{x:v,y:b})}}var bh;dn("ImagePosition",cS),dn("ImageAtlas",PP),a.ah=void 0,(bh=a.ah||(a.ah={}))[bh.none=0]="none",bh[bh.horizontal=1]="horizontal",bh[bh.vertical=2]="vertical",bh[bh.horizontalOnly=3]="horizontalOnly";const g_=-17;class __{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,h){const m=new __;return m.scale=l||1,m.fontStack=h,m}static forImage(l){const h=new __;return h.imageName=l,h}}class wp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,h){const m=new wp;for(let v=0;v<l.sections.length;v++){const b=l.sections[v];b.image?m.addImageSection(b):m.addTextSection(b,h)}return m}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let h="";for(let m=0;m<l.length;m++){const v=l.charCodeAt(m+1)||null,b=l.charCodeAt(m-1)||null;h+=v&&ov(v)&&!m_[l[m+1]]||b&&ov(b)&&!m_[l[m-1]]||!m_[l[m]]?l[m]:m_[l[m]]}return h}(this.text)}trim(){let l=0;for(let m=0;m<this.text.length&&Mv[this.text.charCodeAt(m)];m++)l++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=l&&Mv[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(l,h),this.sectionIndex=this.sectionIndex.slice(l,h)}substring(l,h){const m=new wp;return m.text=this.text.substring(l,h),m.sectionIndex=this.sectionIndex.slice(l,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,h)=>Math.max(l,this.sections[h].scale),0)}addTextSection(l,h){this.text+=l.text,this.sections.push(__.forText(l.scale,l.fontStack||h));const m=this.sections.length-1;for(let v=0;v<l.text.length;++v)this.sectionIndex.push(m)}addImageSection(l){const h=l.image?l.image.name:"";if(h.length===0)return void Fe("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(__.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Fe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sv(u,l,h,m,v,b,E,A,k,B,V,W,X,J,se){const he=wp.fromFeature(u,v);let _e;W===a.ah.vertical&&he.verticalizePunctuation();const{processBidirectionalText:be,processStyledBidirectionalText:je}=uc;if(be&&he.sections.length===1){_e=[];const ct=be(he.toString(),uS(he,B,b,l,m,J));for(const wt of ct){const Xt=new wp;Xt.text=wt,Xt.sections=he.sections;for(let Dn=0;Dn<wt.length;Dn++)Xt.sectionIndex.push(0);_e.push(Xt)}}else if(je){_e=[];const ct=je(he.text,he.sectionIndex,uS(he,B,b,l,m,J));for(const wt of ct){const Xt=new wp;Xt.text=wt[0],Xt.sectionIndex=wt[1],Xt.sections=he.sections,_e.push(Xt)}}else _e=function(ct,wt){const Xt=[],Dn=ct.text;let Qt=0;for(const qt of wt)Xt.push(ct.substring(Qt,qt)),Qt=qt;return Qt<Dn.length&&Xt.push(ct.substring(Qt,Dn.length)),Xt}(he,uS(he,B,b,l,m,J));const Pe=[],Ge={positionedLines:Pe,text:he.toString(),top:V[1],bottom:V[1],left:V[0],right:V[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(ct,wt,Xt,Dn,Qt,qt,Mn,mn,un,pt,An,Sn){let Wn=0,Ki=g_,ji=0,rs=0;const qa=mn==="right"?1:mn==="left"?0:.5;let Es=0;for(const kr of Qt){kr.trim();const ss=kr.getMaxScale(),Us=(ss-1)*Kr,Ts={positionedGlyphs:[],lineOffset:0};ct.positionedLines[Es]=Ts;const oo=Ts.positionedGlyphs;let Cs=0;if(!kr.length()){Ki+=qt,++Es;continue}for(let Po=0;Po<kr.length();Po++){const Ai=kr.getSection(Po),sr=kr.getSectionIndex(Po),gr=kr.getCharCode(Po);let Zo=0,Cr=null,Ep=null,pc=null,mc=Kr;const Xa=!(un===a.ah.horizontal||!An&&!Jg(gr)||An&&(Mv[gr]||(Dr=gr,en.Arabic(Dr)||en["Arabic Supplement"](Dr)||en["Arabic Extended-A"](Dr)||en["Arabic Presentation Forms-A"](Dr)||en["Arabic Presentation Forms-B"](Dr))));if(Ai.imageName){const xa=Dn[Ai.imageName];if(!xa)continue;pc=Ai.imageName,ct.iconsInText=ct.iconsInText||!0,Ep=xa.paddedRect;const ds=xa.displaySize;Ai.scale=Ai.scale*Kr/Sn,Cr={width:ds[0],height:ds[1],left:Io,top:-AP,advance:Xa?ds[1]:ds[0]},Zo=Us+(Kr-ds[1]*Ai.scale),mc=Cr.advance;const cu=Xa?ds[0]*Ai.scale-Kr*ss:ds[1]*Ai.scale-Kr*ss;cu>0&&cu>Cs&&(Cs=cu)}else{const xa=Xt[Ai.fontStack],ds=xa&&xa[gr];if(ds&&ds.rect)Ep=ds.rect,Cr=ds.metrics;else{const cu=wt[Ai.fontStack],b_=cu&&cu[gr];if(!b_)continue;Cr=b_.metrics}Zo=(ss-Ai.scale)*Kr}Xa?(ct.verticalizable=!0,oo.push({glyph:gr,imageName:pc,x:Wn,y:Ki+Zo,vertical:Xa,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:sr,metrics:Cr,rect:Ep}),Wn+=mc*Ai.scale+pt):(oo.push({glyph:gr,imageName:pc,x:Wn,y:Ki+Zo,vertical:Xa,scale:Ai.scale,fontStack:Ai.fontStack,sectionIndex:sr,metrics:Cr,rect:Ep}),Wn+=Cr.advance*Ai.scale+pt)}oo.length!==0&&(ji=Math.max(Wn-pt,ji),P6(oo,0,oo.length-1,qa,Cs)),Wn=0;const va=qt*ss+Cs;Ts.lineOffset=Math.max(Cs,Us),Ki+=va,rs=Math.max(va,rs),++Es}var Dr;const io=Ki-g_,{horizontalAlign:ro,verticalAlign:so}=hS(Mn);(function(kr,ss,Us,Ts,oo,Cs,va,Po,Ai){const sr=(ss-Us)*oo;let gr=0;gr=Cs!==va?-Po*Ts-g_:(-Ts*Ai+.5)*va;for(const Zo of kr)for(const Cr of Zo.positionedGlyphs)Cr.x+=sr,Cr.y+=gr})(ct.positionedLines,qa,ro,so,ji,rs,qt,io,Qt.length),ct.top+=-so*io,ct.bottom=ct.top+io,ct.left+=-ro*ji,ct.right=ct.left+ji}(Ge,l,h,m,_e,E,A,k,W,B,X,se),!function(ct){for(const wt of ct)if(wt.positionedGlyphs.length!==0)return!1;return!0}(Pe)&&Ge}const Mv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},C6={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},A6={40:!0};function RP(u,l,h,m,v,b){if(l.imageName){const E=m[l.imageName];return E?E.displaySize[0]*l.scale*Kr/b+v:0}{const E=h[l.fontStack],A=E&&E[u];return A?A.metrics.advance*l.scale+v:0}}function LP(u,l,h,m){const v=Math.pow(u-l,2);return m?u<l?v/2:2*v:v+Math.abs(h)*h}function I6(u,l,h){let m=0;return u===10&&(m-=1e4),h&&(m+=150),u!==40&&u!==65288||(m+=50),l!==41&&l!==65289||(m+=50),m}function DP(u,l,h,m,v,b){let E=null,A=LP(l,h,v,b);for(const k of m){const B=LP(l-k.x,h,v,b)+k.badness;B<=A&&(E=k,A=B)}return{index:u,x:l,priorBreak:E,badness:A}}function kP(u){return u?kP(u.priorBreak).concat(u.index):[]}function uS(u,l,h,m,v,b){if(!u)return[];const E=[],A=function(W,X,J,se,he,_e){let be=0;for(let je=0;je<W.length();je++){const Pe=W.getSection(je);be+=RP(W.getCharCode(je),Pe,se,he,X,_e)}return be/Math.max(1,Math.ceil(be/J))}(u,l,h,m,v,b),k=u.text.indexOf("")>=0;let B=0;for(let W=0;W<u.length();W++){const X=u.getSection(W),J=u.getCharCode(W);if(Mv[J]||(B+=RP(J,X,m,v,l,b)),W<u.length()-1){const se=!((V=J)<11904||!(en["Bopomofo Extended"](V)||en.Bopomofo(V)||en["CJK Compatibility Forms"](V)||en["CJK Compatibility Ideographs"](V)||en["CJK Compatibility"](V)||en["CJK Radicals Supplement"](V)||en["CJK Strokes"](V)||en["CJK Symbols and Punctuation"](V)||en["CJK Unified Ideographs Extension A"](V)||en["CJK Unified Ideographs"](V)||en["Enclosed CJK Letters and Months"](V)||en["Halfwidth and Fullwidth Forms"](V)||en.Hiragana(V)||en["Ideographic Description Characters"](V)||en["Kangxi Radicals"](V)||en["Katakana Phonetic Extensions"](V)||en.Katakana(V)||en["Vertical Forms"](V)||en["Yi Radicals"](V)||en["Yi Syllables"](V)));(C6[J]||se||X.imageName||W!==u.length()-2&&A6[u.getCharCode(W+1)])&&E.push(DP(W+1,B,A,E,I6(J,u.getCharCode(W+1),se&&k),!1))}}var V;return kP(DP(u.length(),B,A,E,0,!0))}function hS(u){let l=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:l,verticalAlign:h}}function P6(u,l,h,m,v){if(!m&&!v)return;const b=u[h],E=(u[h].x+b.metrics.advance*b.scale)*m;for(let A=l;A<=h;A++)u[A].x-=E,u[A].y+=v}function R6(u,l,h){const{horizontalAlign:m,verticalAlign:v}=hS(h),b=l[0]-u.displaySize[0]*m,E=l[1]-u.displaySize[1]*v;return{image:u,top:E,bottom:E+u.displaySize[1],left:b,right:b+u.displaySize[0]}}function FP(u){var l,h;let m=u.left,v=u.top,b=u.right-m,E=u.bottom-v;const A=(l=u.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",k=(h=u.image.textFitHeight)!==null&&h!==void 0?h:"stretchOrShrink",B=(u.image.content[2]-u.image.content[0])/(u.image.content[3]-u.image.content[1]);if(k==="proportional"){if(A==="stretchOnly"&&b/E<B||A==="proportional"){const V=Math.ceil(E*B);m*=V/b,b=V}}else if(A==="proportional"&&k==="stretchOnly"&&B!==0&&b/E>B){const V=Math.ceil(b/B);v*=V/E,E=V}return{x1:m,y1:v,x2:m+b,y2:v+E}}function OP(u,l,h,m,v,b){const E=u.image;let A;if(E.content){const _e=E.content,be=E.pixelRatio||1;A=[_e[0]/be,_e[1]/be,E.displaySize[0]-_e[2]/be,E.displaySize[1]-_e[3]/be]}const k=l.left*b,B=l.right*b;let V,W,X,J;h==="width"||h==="both"?(J=v[0]+k-m[3],W=v[0]+B+m[1]):(J=v[0]+(k+B-E.displaySize[0])/2,W=J+E.displaySize[0]);const se=l.top*b,he=l.bottom*b;return h==="height"||h==="both"?(V=v[1]+se-m[0],X=v[1]+he+m[2]):(V=v[1]+(se+he-E.displaySize[1])/2,X=V+E.displaySize[1]),{image:E,top:V,right:W,bottom:X,left:J,collisionPadding:A}}const y_=255,fc=128,Sh=y_*fc;function NP(u,l){const{expression:h}=l;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new rr(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let b=0;for(;b<m.length&&m[b]<=u;)b++;b=Math.max(0,b-1);let E=b;for(;E<m.length&&m[E]<u+1;)E++;E=Math.min(m.length-1,E);const A=m[b],k=m[E];return h.kind==="composite"?{kind:"composite",minZoom:A,maxZoom:k,interpolationType:v}:{kind:"camera",minZoom:A,maxZoom:k,minSize:h.evaluate(new rr(A)),maxSize:h.evaluate(new rr(k)),interpolationType:v}}}function dS(u,l,h){let m="never";const v=u.get(l);return v?m=v:u.get(h)&&(m="always"),m}const L6=wh.VectorTileFeature.types,D6=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ev(u,l,h,m,v,b,E,A,k,B,V,W,X){const J=A?Math.min(Sh,Math.round(A[0])):0,se=A?Math.min(Sh,Math.round(A[1])):0;u.emplaceBack(l,h,Math.round(32*m),Math.round(32*v),b,E,(J<<1)+(k?1:0),se,16*B,16*V,256*W,256*X)}function fS(u,l,h){u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h),u.emplaceBack(l.x,l.y,h)}function k6(u){for(const l of u.sections)if(Qg(l.text))return!0;return!1}class pS{constructor(l){this.layoutVertexArray=new ga,this.indexArray=new is,this.programConfigurations=l,this.segments=new Yr,this.dynamicLayoutVertexArray=new hc,this.opacityVertexArray=new _h,this.hasVisibleVertices=!1,this.placedSymbolArray=new pr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,u6.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,h6.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,D6,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dn("SymbolBuffers",pS);class mS{constructor(l,h,m){this.layoutVertexArray=new l,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Yr,this.collisionVertexArray=new Ss}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,d6.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dn("CollisionBuffers",mS);class bp{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(E=>E.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qb([]),this.placementViewportMatrix=qb([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=NP(this.zoom,h["text-size"]),this.iconSizeData=NP(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),b=m.get("symbol-z-order");this.canOverlap=dS(m,"text-overlap","text-allow-overlap")!=="never"||dS(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(E=>a.ah[E])),this.stateDependentLayerIds=this.layers.filter(E=>E.isStateDependent()).map(E=>E.id),this.sourceID=l.sourceID}createArrays(){this.text=new pS(new Zd(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new pS(new Zd(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new mr,this.lineVertexArray=new to,this.symbolInstances=new pa,this.textAnchorOffsets=new xs}calculateGlyphDependencies(l,h,m,v,b){for(let E=0;E<l.length;E++)if(h[l.charCodeAt(E)]=!0,(m||v)&&b){const A=m_[l.charAt(E)];A&&(h[A.charCodeAt(0)]=!0)}}populate(l,h,m){const v=this.layers[0],b=v.layout,E=b.get("text-font"),A=b.get("text-field"),k=b.get("icon-image"),B=(A.value.kind!=="constant"||A.value.value instanceof Zt&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),V=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,W=b.get("symbol-sort-key");if(this.features=[],!B&&!V)return;const X=h.iconDependencies,J=h.glyphDependencies,se=h.availableImages,he=new rr(this.zoom);for(const{feature:_e,id:be,index:je,sourceLayerIndex:Pe}of l){const Ge=v._featureFilter.needGeometry,ct=Kd(_e,Ge);if(!v._featureFilter.filter(he,ct,m))continue;let wt,Xt;if(Ge||(ct.geometry=Yd(_e)),B){const Qt=v.getValueAndResolveTokens("text-field",ct,m,se),qt=Zt.factory(Qt),Mn=this.hasRTLText=this.hasRTLText||k6(qt);(!Mn||uc.getRTLTextPluginStatus()==="unavailable"||Mn&&uc.isParsed())&&(wt=p6(qt,v,ct))}if(V){const Qt=v.getValueAndResolveTokens("icon-image",ct,m,se);Xt=Qt instanceof vi?Qt:vi.fromString(Qt)}if(!wt&&!Xt)continue;const Dn=this.sortFeaturesByKey?W.evaluate(ct,{},m):void 0;if(this.features.push({id:be,text:wt,icon:Xt,index:je,sourceLayerIndex:Pe,geometry:ct.geometry,properties:_e.properties,type:L6[_e.type],sortKey:Dn}),Xt&&(X[Xt.name]=!0),wt){const Qt=E.evaluate(ct,{},m).join(","),qt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(a.ah.vertical)>=0;for(const Mn of wt.sections)if(Mn.image)X[Mn.image.name]=!0;else{const mn=Kg(wt.toString()),un=Mn.fontStack||Qt,pt=J[un]=J[un]||{};this.calculateGlyphDependencies(Mn.text,pt,qt,this.allowVerticalPlacement,mn)}}}b.get("symbol-placement")==="line"&&(this.features=function(_e){const be={},je={},Pe=[];let Ge=0;function ct(Qt){Pe.push(_e[Qt]),Ge++}function wt(Qt,qt,Mn){const mn=je[Qt];return delete je[Qt],je[qt]=mn,Pe[mn].geometry[0].pop(),Pe[mn].geometry[0]=Pe[mn].geometry[0].concat(Mn[0]),mn}function Xt(Qt,qt,Mn){const mn=be[qt];return delete be[qt],be[Qt]=mn,Pe[mn].geometry[0].shift(),Pe[mn].geometry[0]=Mn[0].concat(Pe[mn].geometry[0]),mn}function Dn(Qt,qt,Mn){const mn=Mn?qt[0][qt[0].length-1]:qt[0][0];return`${Qt}:${mn.x}:${mn.y}`}for(let Qt=0;Qt<_e.length;Qt++){const qt=_e[Qt],Mn=qt.geometry,mn=qt.text?qt.text.toString():null;if(!mn){ct(Qt);continue}const un=Dn(mn,Mn),pt=Dn(mn,Mn,!0);if(un in je&&pt in be&&je[un]!==be[pt]){const An=Xt(un,pt,Mn),Sn=wt(un,pt,Pe[An].geometry);delete be[un],delete je[pt],je[Dn(mn,Pe[Sn].geometry,!0)]=Sn,Pe[An].geometry=null}else un in je?wt(un,pt,Mn):pt in be?Xt(un,pt,Mn):(ct(Qt),be[un]=Ge-1,je[pt]=Ge-1)}return Pe.filter(Qt=>Qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,be)=>_e.sortKey-be.sortKey)}update(l,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(l,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,h){const m=this.lineVertexArray.length;if(l.segment!==void 0){let v=l.dist(h[l.segment+1]),b=l.dist(h[l.segment]);const E={};for(let A=l.segment+1;A<h.length;A++)E[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:v},A<h.length-1&&(v+=h[A+1].dist(h[A]));for(let A=l.segment||0;A>=0;A--)E[A]={x:h[A].x,y:h[A].y,tileUnitDistanceFromAnchor:b},A>0&&(b+=h[A-1].dist(h[A]));for(let A=0;A<h.length;A++){const k=E[A];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(l,h,m,v,b,E,A,k,B,V,W,X){const J=l.indexArray,se=l.layoutVertexArray,he=l.segments.prepareSegment(4*h.length,se,J,this.canOverlap?E.sortKey:void 0),_e=this.glyphOffsetArray.length,be=he.vertexLength,je=this.allowVerticalPlacement&&A===a.ah.vertical?Math.PI/2:0,Pe=E.text&&E.text.sections;for(let Ge=0;Ge<h.length;Ge++){const{tl:ct,tr:wt,bl:Xt,br:Dn,tex:Qt,pixelOffsetTL:qt,pixelOffsetBR:Mn,minFontScaleX:mn,minFontScaleY:un,glyphOffset:pt,isSDF:An,sectionIndex:Sn}=h[Ge],Wn=he.vertexLength,Ki=pt[1];Ev(se,k.x,k.y,ct.x,Ki+ct.y,Qt.x,Qt.y,m,An,qt.x,qt.y,mn,un),Ev(se,k.x,k.y,wt.x,Ki+wt.y,Qt.x+Qt.w,Qt.y,m,An,Mn.x,qt.y,mn,un),Ev(se,k.x,k.y,Xt.x,Ki+Xt.y,Qt.x,Qt.y+Qt.h,m,An,qt.x,Mn.y,mn,un),Ev(se,k.x,k.y,Dn.x,Ki+Dn.y,Qt.x+Qt.w,Qt.y+Qt.h,m,An,Mn.x,Mn.y,mn,un),fS(l.dynamicLayoutVertexArray,k,je),J.emplaceBack(Wn,Wn+1,Wn+2),J.emplaceBack(Wn+1,Wn+2,Wn+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Ge!==h.length-1&&Sn===h[Ge+1].sectionIndex||l.programConfigurations.populatePaintArrays(se.length,E,E.index,{},X,Pe&&Pe[Sn])}l.placedSymbolArray.emplaceBack(k.x,k.y,_e,this.glyphOffsetArray.length-_e,be,B,V,k.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],A,0,!1,0,W)}_addCollisionDebugVertex(l,h,m,v,b,E){return h.emplaceBack(0,0),l.emplaceBack(m.x,m.y,v,b,Math.round(E.x),Math.round(E.y))}addCollisionDebugVertices(l,h,m,v,b,E,A){const k=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),B=k.vertexLength,V=b.layoutVertexArray,W=b.collisionVertexArray,X=A.anchorX,J=A.anchorY;this._addCollisionDebugVertex(V,W,E,X,J,new _(l,h)),this._addCollisionDebugVertex(V,W,E,X,J,new _(m,h)),this._addCollisionDebugVertex(V,W,E,X,J,new _(m,v)),this._addCollisionDebugVertex(V,W,E,X,J,new _(l,v)),k.vertexLength+=4;const se=b.indexArray;se.emplaceBack(B,B+1),se.emplaceBack(B+1,B+2),se.emplaceBack(B+2,B+3),se.emplaceBack(B+3,B),k.primitiveLength+=4}addDebugCollisionBoxes(l,h,m,v){for(let b=l;b<h;b++){const E=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,v?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mS(bs,xP.members,xr),this.iconCollisionBox=new mS(bs,xP.members,xr);for(let l=0;l<this.symbolInstances.length;l++){const h=this.symbolInstances.get(l);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(l,h,m,v,b,E,A,k,B){const V={};for(let W=h;W<m;W++){const X=l.get(W);V.textBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.textFeatureIndex=X.featureIndex;break}for(let W=v;W<b;W++){const X=l.get(W);V.verticalTextBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalTextFeatureIndex=X.featureIndex;break}for(let W=E;W<A;W++){const X=l.get(W);V.iconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.iconFeatureIndex=X.featureIndex;break}for(let W=k;W<B;W++){const X=l.get(W);V.verticalIconBox={x1:X.x1,y1:X.y1,x2:X.x2,y2:X.y2,anchorPointX:X.anchorPointX,anchorPointY:X.anchorPointY},V.verticalIconFeatureIndex=X.featureIndex;break}return V}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,h){const m=l.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let b=m.vertexStartIndex;b<v;b+=4)l.indexArray.emplaceBack(b,b+1,b+2),l.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(l),m=Math.cos(l),v=[],b=[],E=[];for(let A=0;A<this.symbolInstances.length;++A){E.push(A);const k=this.symbolInstances.get(A);v.push(0|Math.round(h*k.anchorX+m*k.anchorY)),b.push(k.featureIndex)}return E.sort((A,k)=>v[A]-v[k]||b[k]-b[A]),E}addToSortKeyRanges(l,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,b,E)=>{v>=0&&E.indexOf(v)===b&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let zP,BP;dn("SymbolBucket",bp,{omit:["layers","collisionBoxArray","features","compareText"]}),bp.MAX_GLYPHS=65535,bp.addDynamicAttributes=fS;var gS={get paint(){return BP=BP||new y({"icon-opacity":new On(Te.paint_symbol["icon-opacity"]),"icon-color":new On(Te.paint_symbol["icon-color"]),"icon-halo-color":new On(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new On(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new On(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new Tn(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tn(Te.paint_symbol["icon-translate-anchor"]),"text-opacity":new On(Te.paint_symbol["text-opacity"]),"text-color":new On(Te.paint_symbol["text-color"],{runtimeType:In,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new On(Te.paint_symbol["text-halo-color"]),"text-halo-width":new On(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new On(Te.paint_symbol["text-halo-blur"]),"text-translate":new Tn(Te.paint_symbol["text-translate"]),"text-translate-anchor":new Tn(Te.paint_symbol["text-translate-anchor"])})},get layout(){return zP=zP||new y({"symbol-placement":new Tn(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new Tn(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tn(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new On(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tn(Te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Tn(Te.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Tn(Te.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Tn(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tn(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tn(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new On(Te.layout_symbol["icon-size"]),"icon-text-fit":new Tn(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Tn(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new On(Te.layout_symbol["icon-image"]),"icon-rotate":new On(Te.layout_symbol["icon-rotate"]),"icon-padding":new On(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new Tn(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new On(Te.layout_symbol["icon-offset"]),"icon-anchor":new On(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tn(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tn(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tn(Te.layout_symbol["text-rotation-alignment"]),"text-field":new On(Te.layout_symbol["text-field"]),"text-font":new On(Te.layout_symbol["text-font"]),"text-size":new On(Te.layout_symbol["text-size"]),"text-max-width":new On(Te.layout_symbol["text-max-width"]),"text-line-height":new Tn(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new On(Te.layout_symbol["text-letter-spacing"]),"text-justify":new On(Te.layout_symbol["text-justify"]),"text-radial-offset":new On(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tn(Te.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new On(Te.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new On(Te.layout_symbol["text-anchor"]),"text-max-angle":new Tn(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new Tn(Te.layout_symbol["text-writing-mode"]),"text-rotate":new On(Te.layout_symbol["text-rotate"]),"text-padding":new Tn(Te.layout_symbol["text-padding"]),"text-keep-upright":new Tn(Te.layout_symbol["text-keep-upright"]),"text-transform":new On(Te.layout_symbol["text-transform"]),"text-offset":new On(Te.layout_symbol["text-offset"]),"text-allow-overlap":new Tn(Te.layout_symbol["text-allow-overlap"]),"text-overlap":new Tn(Te.layout_symbol["text-overlap"]),"text-ignore-placement":new Tn(Te.layout_symbol["text-ignore-placement"]),"text-optional":new Tn(Te.layout_symbol["text-optional"])})}};class UP{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:Zn,this.defaultValue=l}evaluate(l){if(l.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(l.formattedSection))return h.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dn("FormatSectionOverride",UP,{omit:["defaultValue"]});class Tv extends M{constructor(l){super(l,gS)}recalculate(l,h){if(super.recalculate(l,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const b of m)v.indexOf(b)<0&&v.push(b);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,h,m,v){const b=this.layout.get(l).evaluate(h,{},m,v),E=this._unevaluatedLayout._values[l];return E.isDataDriven()||zs(E.value)||!b?b:function(A,k){return k.replace(/{([^{}]+)}/g,(B,V)=>A&&V in A?String(A[V]):"")}(h.properties,b)}createBucket(l){return new bp(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of gS.paint.overridableProperties){if(!Tv.hasPaintOverride(this.layout,l))continue;const h=this.paint.get(l),m=new UP(h),v=new Er(m,h.property.specification);let b=null;b=h.value.kind==="constant"||h.value.kind==="source"?new Zr("source",v):new To("composite",v,h.value.zoomStops),this.paint._values[l]=new $a(h.property,b,h.parameters)}}_handleOverridablePaintPropertyUpdate(l,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Tv.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,h){const m=l.get("text-field"),v=gS.paint.properties[h];let b=!1;const E=A=>{for(const k of A)if(v.overrides&&v.overrides.hasOverride(k))return void(b=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Zt)E(m.value.value.sections);else if(m.value.kind==="source"){const A=B=>{b||(B instanceof Or&&ei(B.value)===gt?E(B.value.sections):B instanceof qc?E(B.sections):B.eachChild(A))},k=m.value;k._styleExpression&&A(k._styleExpression.expression)}return b}}let VP;var F6={get paint(){return VP=VP||new y({"background-color":new Tn(Te.paint_background["background-color"]),"background-pattern":new c(Te.paint_background["background-pattern"]),"background-opacity":new Tn(Te.paint_background["background-opacity"])})}};class O6 extends M{constructor(l){super(l,F6)}}let GP;var N6={get paint(){return GP=GP||new y({"raster-opacity":new Tn(Te.paint_raster["raster-opacity"]),"raster-hue-rotate":new Tn(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tn(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tn(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new Tn(Te.paint_raster["raster-saturation"]),"raster-contrast":new Tn(Te.paint_raster["raster-contrast"]),"raster-resampling":new Tn(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new Tn(Te.paint_raster["raster-fade-duration"])})}};class z6 extends M{constructor(l){super(l,N6)}}class B6 extends M{constructor(l){super(l,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class U6{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const _S=63710088e-1;class Mh{constructor(l,h){if(isNaN(l)||isNaN(h))throw new Error(`Invalid LngLat object: (${l}, ${h})`);if(this.lng=+l,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Mh(ee(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const h=Math.PI/180,m=this.lat*h,v=l.lat*h,b=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((l.lng-this.lng)*h);return _S*Math.acos(Math.min(b,1))}static convert(l){if(l instanceof Mh)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Mh(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Mh(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const HP=2*Math.PI*_S;function WP(u){return HP*Math.cos(u*Math.PI/180)}function jP(u){return(180+u)/360}function $P(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function qP(u,l){return u/WP(l)}function yS(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class Cv{constructor(l,h,m=0){this.x=+l,this.y=+h,this.z=+m}static fromLngLat(l,h=0){const m=Mh.convert(l);return new Cv(jP(m.lng),$P(m.lat),qP(h,m.lat))}toLngLat(){return new Mh(360*this.x-180,yS(this.y))}toAltitude(){return this.z*WP(yS(this.y))}meterInMercatorCoordinateUnits(){return 1/HP*(l=yS(this.y),1/Math.cos(l*Math.PI/180));var l}}function XP(u,l,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[u*m-2*Math.PI*6378137/2,l*m-2*Math.PI*6378137/2]}class vS{constructor(l,h,m){if(l<0||l>25||m<0||m>=Math.pow(2,l)||h<0||h>=Math.pow(2,l))throw new Error(`x=${h}, y=${m}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=h,this.y=m,this.key=v_(0,l,l,h,m)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,h,m){const v=(E=this.y,A=this.z,k=XP(256*(b=this.x),256*(E=Math.pow(2,A)-E-1),A),B=XP(256*(b+1),256*(E+1),A),k[0]+","+k[1]+","+B[0]+","+B[1]);var b,E,A,k,B;const V=function(W,X,J){let se,he="";for(let _e=W;_e>0;_e--)se=1<<_e-1,he+=(X&se?1:0)+(J&se?2:0);return he}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,V).replace(/{bbox-epsg-3857}/g,v)}isChildOf(l){const h=this.z-l.z;return h>0&&l.x===this.x>>h&&l.y===this.y>>h}getTilePoint(l){const h=Math.pow(2,this.z);return new _((l.x*h-this.x)*jr,(l.y*h-this.y)*jr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ZP{constructor(l,h){this.wrap=l,this.canonical=h,this.key=v_(l,h.z,h.z,h.x,h.y)}}class ya{constructor(l,h,m,v,b){if(l<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${m}`);this.overscaledZ=l,this.wrap=h,this.canonical=new vS(m,+v,+b),this.key=v_(h,l,m,v,b)}clone(){return new ya(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-l;return l>this.canonical.z?new ya(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ya(l,this.wrap,l,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(l,h){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-l;return l>this.canonical.z?v_(this.wrap*+h,l,this.canonical.z,this.canonical.x,this.canonical.y):v_(this.wrap*+h,l,l,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const h=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>h&&l.canonical.y===this.canonical.y>>h}children(l){if(this.overscaledZ>=l)return[new ya(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new ya(h,this.wrap,h,m,v),new ya(h,this.wrap,h,m+1,v),new ya(h,this.wrap,h,m,v+1),new ya(h,this.wrap,h,m+1,v+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new ya(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new ya(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ZP(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Cv(l.x-this.wrap,l.y))}}function v_(u,l,h,m,v){(u*=2)<0&&(u=-1*u-1);const b=1<<h;return(b*b*u+b*v+m).toString(36)+h.toString(36)+l.toString(36)}dn("CanonicalTileID",vS),dn("OverscaledTileID",ya,{omit:["posMatrix"]});class YP{constructor(l,h,m,v=1,b=1,E=1,A=0){if(this.uid=l,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Fe(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const k=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=b,this.blueFactor=E,this.baseShift=A;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let B=0;B<k;B++)this.data[this._idx(-1,B)]=this.data[this._idx(0,B)],this.data[this._idx(k,B)]=this.data[this._idx(k-1,B)],this.data[this._idx(B,-1)]=this.data[this._idx(B,0)],this.data[this._idx(B,k)]=this.data[this._idx(B,k-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(k,-1)]=this.data[this._idx(k-1,0)],this.data[this._idx(-1,k)]=this.data[this._idx(0,k-1)],this.data[this._idx(k,k)]=this.data[this._idx(k-1,k-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let B=0;B<k;B++)for(let V=0;V<k;V++){const W=this.get(B,V);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(l,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(l,h);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,h){if(l<-1||l>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(l+1)}unpack(l,h,m){return l*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new _a({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,h,m){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,b=h*this.dim+this.dim,E=m*this.dim,A=m*this.dim+this.dim;switch(h){case-1:v=b-1;break;case 1:b=v+1}switch(m){case-1:E=A-1;break;case 1:A=E+1}const k=-h*this.dim,B=-m*this.dim;for(let V=E;V<A;V++)for(let W=v;W<b;W++)this.data[this._idx(W,V)]=l.data[this._idx(W+k,V+B)]}}dn("DEMData",YP);class KP{constructor(l){this._stringToNumber={},this._numberToString=[];for(let h=0;h<l.length;h++){const m=l[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class JP{constructor(l,h,m,v,b){this.type="Feature",this._vectorTileFeature=l,l._z=h,l._x=m,l._y=v,this.properties=l.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(l[h]=this[h]);return l}}class QP{constructor(l,h){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new jd(jr,16,0),this.grid3D=new jd(jr,16,0),this.featureIndexArray=new ma,this.promoteId=h}insert(l,h,m,v,b,E){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,b);const k=E?this.grid3D:this.grid;for(let B=0;B<h.length;B++){const V=h[B],W=[1/0,1/0,-1/0,-1/0];for(let X=0;X<V.length;X++){const J=V[X];W[0]=Math.min(W[0],J.x),W[1]=Math.min(W[1],J.y),W[2]=Math.max(W[2],J.x),W[3]=Math.max(W[3],J.y)}W[0]<jr&&W[1]<jr&&W[2]>=0&&W[3]>=0&&k.insert(A,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new wh.VectorTile(new aS(this.rawTileData)).layers,this.sourceLayerCoder=new KP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,h,m,v){this.loadVTLayers();const b=l.params||{},E=jr/l.tileSize/l.scale,A=Hd(b.filter),k=l.queryGeometry,B=l.queryPadding*E,V=tR(k),W=this.grid.query(V.minX-B,V.minY-B,V.maxX+B,V.maxY+B),X=tR(l.cameraQueryGeometry),J=this.grid3D.query(X.minX-B,X.minY-B,X.maxX+B,X.maxY+B,(_e,be,je,Pe)=>function(Ge,ct,wt,Xt,Dn){for(const qt of Ge)if(ct<=qt.x&&wt<=qt.y&&Xt>=qt.x&&Dn>=qt.y)return!0;const Qt=[new _(ct,wt),new _(ct,Dn),new _(Xt,Dn),new _(Xt,wt)];if(Ge.length>2){for(const qt of Qt)if(mp(Ge,qt))return!0}for(let qt=0;qt<Ge.length-1;qt++)if(x4(Ge[qt],Ge[qt+1],Qt))return!0;return!1}(l.cameraQueryGeometry,_e-B,be-B,je+B,Pe+B));for(const _e of J)W.push(_e);W.sort(V6);const se={};let he;for(let _e=0;_e<W.length;_e++){const be=W[_e];if(be===he)continue;he=be;const je=this.featureIndexArray.get(be);let Pe=null;this.loadMatchingFeature(se,je.bucketIndex,je.sourceLayerIndex,je.featureIndex,A,b.layers,b.availableImages,h,m,v,(Ge,ct,wt)=>(Pe||(Pe=Yd(Ge)),ct.queryIntersectsFeature(k,Ge,wt,Pe,this.z,l.transform,E,l.pixelPosMatrix)))}return se}loadMatchingFeature(l,h,m,v,b,E,A,k,B,V,W){const X=this.bucketLayerIDs[h];if(E&&!function(_e,be){for(let je=0;je<_e.length;je++)if(be.indexOf(_e[je])>=0)return!0;return!1}(E,X))return;const J=this.sourceLayerCoder.decode(m),se=this.vtLayers[J].feature(v);if(b.needGeometry){const _e=Kd(se,!0);if(!b.filter(new rr(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!b.filter(new rr(this.tileID.overscaledZ),se))return;const he=this.getId(se,J);for(let _e=0;_e<X.length;_e++){const be=X[_e];if(E&&E.indexOf(be)<0)continue;const je=k[be];if(!je)continue;let Pe={};he&&V&&(Pe=V.getState(je.sourceLayer||"_geojsonTileLayer",he));const Ge=te({},B[be]);Ge.paint=eR(Ge.paint,je.paint,se,Pe,A),Ge.layout=eR(Ge.layout,je.layout,se,Pe,A);const ct=!W||W(se,je,Pe);if(!ct)continue;const wt=new JP(se,this.z,this.x,this.y,he);wt.layer=Ge;let Xt=l[be];Xt===void 0&&(Xt=l[be]=[]),Xt.push({featureIndex:v,feature:wt,intersectionZ:ct})}}lookupSymbolFeatures(l,h,m,v,b,E,A,k){const B={};this.loadVTLayers();const V=Hd(b);for(const W of l)this.loadMatchingFeature(B,m,v,W,V,E,A,k,h);return B}hasLayer(l){for(const h of this.bucketLayerIDs)for(const m of h)if(l===m)return!0;return!1}getId(l,h){let m=l.id;return this.promoteId&&(m=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function eR(u,l,h,m,v){return K(u,(b,E)=>{const A=l instanceof lp?l.get(E):null;return A&&A.evaluate?A.evaluate(h,m,v):A})}function tR(u){let l=1/0,h=1/0,m=-1/0,v=-1/0;for(const b of u)l=Math.min(l,b.x),h=Math.min(h,b.y),m=Math.max(m,b.x),v=Math.max(v,b.y);return{minX:l,minY:h,maxX:m,maxY:v}}function V6(u,l){return l-u}function nR(u,l,h,m,v){const b=[];for(let E=0;E<u.length;E++){const A=u[E];let k;for(let B=0;B<A.length-1;B++){let V=A[B],W=A[B+1];V.x<l&&W.x<l||(V.x<l?V=new _(l,V.y+(l-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x<l&&(W=new _(l,V.y+(l-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y<h&&W.y<h||(V.y<h?V=new _(V.x+(h-V.y)/(W.y-V.y)*(W.x-V.x),h)._round():W.y<h&&(W=new _(V.x+(h-V.y)/(W.y-V.y)*(W.x-V.x),h)._round()),V.x>=m&&W.x>=m||(V.x>=m?V=new _(m,V.y+(m-V.x)/(W.x-V.x)*(W.y-V.y))._round():W.x>=m&&(W=new _(m,V.y+(m-V.x)/(W.x-V.x)*(W.y-V.y))._round()),V.y>=v&&W.y>=v||(V.y>=v?V=new _(V.x+(v-V.y)/(W.y-V.y)*(W.x-V.x),v)._round():W.y>=v&&(W=new _(V.x+(v-V.y)/(W.y-V.y)*(W.x-V.x),v)._round()),k&&V.equals(k[k.length-1])||(k=[V],b.push(k)),k.push(W)))))}}return b}dn("FeatureIndex",QP,{omit:["rawTileData","sourceLayerCoder"]});class Eh extends _{constructor(l,h,m,v){super(l,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new Eh(this.x,this.y,this.angle,this.segment)}}function iR(u,l,h,m,v){if(l.segment===void 0||h===0)return!0;let b=l,E=l.segment+1,A=0;for(;A>-h/2;){if(E--,E<0)return!1;A-=u[E].dist(b),b=u[E]}A+=u[E].dist(u[E+1]),E++;const k=[];let B=0;for(;A<h/2;){const V=u[E],W=u[E+1];if(!W)return!1;let X=u[E-1].angleTo(V)-V.angleTo(W);for(X=Math.abs((X+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:A,angleDelta:X}),B+=X;A-k[0].distance>m;)B-=k.shift().angleDelta;if(B>v)return!1;E++,A+=V.dist(W)}return!0}function rR(u){let l=0;for(let h=0;h<u.length-1;h++)l+=u[h].dist(u[h+1]);return l}function sR(u,l,h){return u?.6*l*h:0}function oR(u,l){return Math.max(u?u.right-u.left:0,l?l.right-l.left:0)}function G6(u,l,h,m,v,b){const E=sR(h,v,b),A=oR(h,m)*b;let k=0;const B=rR(u)/2;for(let V=0;V<u.length-1;V++){const W=u[V],X=u[V+1],J=W.dist(X);if(k+J>B){const se=(B-k)/J,he=kn.number(W.x,X.x,se),_e=kn.number(W.y,X.y,se),be=new Eh(he,_e,X.angleTo(W),V);return be._round(),!E||iR(u,be,A,E,l)?be:void 0}k+=J}}function H6(u,l,h,m,v,b,E,A,k){const B=sR(m,b,E),V=oR(m,v),W=V*E,X=u[0].x===0||u[0].x===k||u[0].y===0||u[0].y===k;return l-W<l/4&&(l=W+l/4),aR(u,X?l/2*A%l:(V/2+2*b)*E*A%l,l,B,h,W,X,!1,k)}function aR(u,l,h,m,v,b,E,A,k){const B=b/2,V=rR(u);let W=0,X=l-h,J=[];for(let se=0;se<u.length-1;se++){const he=u[se],_e=u[se+1],be=he.dist(_e),je=_e.angleTo(he);for(;X+h<W+be;){X+=h;const Pe=(X-W)/be,Ge=kn.number(he.x,_e.x,Pe),ct=kn.number(he.y,_e.y,Pe);if(Ge>=0&&Ge<k&&ct>=0&&ct<k&&X-B>=0&&X+B<=V){const wt=new Eh(Ge,ct,je,se);wt._round(),m&&!iR(u,wt,b,m,v)||J.push(wt)}}W+=be}return A||J.length||E||(J=aR(u,W/2,h,m,v,b,E,!0,k)),J}dn("Anchor",Eh);const Sp=Io;function lR(u,l,h,m){const v=[],b=u.image,E=b.pixelRatio,A=b.paddedRect.w-2*Sp,k=b.paddedRect.h-2*Sp;let B={x1:u.left,y1:u.top,x2:u.right,y2:u.bottom};const V=b.stretchX||[[0,A]],W=b.stretchY||[[0,k]],X=(pt,An)=>pt+An[1]-An[0],J=V.reduce(X,0),se=W.reduce(X,0),he=A-J,_e=k-se;let be=0,je=J,Pe=0,Ge=se,ct=0,wt=he,Xt=0,Dn=_e;if(b.content&&m){const pt=b.content,An=pt[2]-pt[0],Sn=pt[3]-pt[1];(b.textFitWidth||b.textFitHeight)&&(B=FP(u)),be=Av(V,0,pt[0]),Pe=Av(W,0,pt[1]),je=Av(V,pt[0],pt[2]),Ge=Av(W,pt[1],pt[3]),ct=pt[0]-be,Xt=pt[1]-Pe,wt=An-je,Dn=Sn-Ge}const Qt=B.x1,qt=B.y1,Mn=B.x2-Qt,mn=B.y2-qt,un=(pt,An,Sn,Wn)=>{const Ki=Iv(pt.stretch-be,je,Mn,Qt),ji=Pv(pt.fixed-ct,wt,pt.stretch,J),rs=Iv(An.stretch-Pe,Ge,mn,qt),qa=Pv(An.fixed-Xt,Dn,An.stretch,se),Es=Iv(Sn.stretch-be,je,Mn,Qt),Dr=Pv(Sn.fixed-ct,wt,Sn.stretch,J),io=Iv(Wn.stretch-Pe,Ge,mn,qt),ro=Pv(Wn.fixed-Xt,Dn,Wn.stretch,se),so=new _(Ki,rs),kr=new _(Es,rs),ss=new _(Es,io),Us=new _(Ki,io),Ts=new _(ji/E,qa/E),oo=new _(Dr/E,ro/E),Cs=l*Math.PI/180;if(Cs){const Ai=Math.sin(Cs),sr=Math.cos(Cs),gr=[sr,-Ai,Ai,sr];so._matMult(gr),kr._matMult(gr),Us._matMult(gr),ss._matMult(gr)}const va=pt.stretch+pt.fixed,Po=An.stretch+An.fixed;return{tl:so,tr:kr,bl:Us,br:ss,tex:{x:b.paddedRect.x+Sp+va,y:b.paddedRect.y+Sp+Po,w:Sn.stretch+Sn.fixed-va,h:Wn.stretch+Wn.fixed-Po},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ts,pixelOffsetBR:oo,minFontScaleX:wt/E/Mn,minFontScaleY:Dn/E/mn,isSDF:h}};if(m&&(b.stretchX||b.stretchY)){const pt=cR(V,he,J),An=cR(W,_e,se);for(let Sn=0;Sn<pt.length-1;Sn++){const Wn=pt[Sn],Ki=pt[Sn+1];for(let ji=0;ji<An.length-1;ji++)v.push(un(Wn,An[ji],Ki,An[ji+1]))}}else v.push(un({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:A+1},{fixed:0,stretch:k+1}));return v}function Av(u,l,h){let m=0;for(const v of u)m+=Math.max(l,Math.min(h,v[1]))-Math.max(l,Math.min(h,v[0]));return m}function cR(u,l,h){const m=[{fixed:-Sp,stretch:0}];for(const[v,b]of u){const E=m[m.length-1];m.push({fixed:v-E.stretch,stretch:E.stretch}),m.push({fixed:v-E.stretch,stretch:E.stretch+(b-v)})}return m.push({fixed:l+Sp,stretch:h}),m}function Iv(u,l,h,m){return u/l*h+m}function Pv(u,l,h,m){return u-l*h/m}class Rv{constructor(l,h,m,v,b,E,A,k,B,V){var W;if(this.boxStartIndex=l.length,B){let X=E.top,J=E.bottom;const se=E.collisionPadding;se&&(X-=se[1],J+=se[3]);let he=J-X;he>0&&(he=Math.max(10,he),this.circleDiameter=he)}else{const X=!((W=E.image)===null||W===void 0)&&W.content&&(E.image.textFitWidth||E.image.textFitHeight)?FP(E):{x1:E.left,y1:E.top,x2:E.right,y2:E.bottom};X.y1=X.y1*A-k[0],X.y2=X.y2*A+k[2],X.x1=X.x1*A-k[3],X.x2=X.x2*A+k[1];const J=E.collisionPadding;if(J&&(X.x1-=J[0]*A,X.y1-=J[1]*A,X.x2+=J[2]*A,X.y2+=J[3]*A),V){const se=new _(X.x1,X.y1),he=new _(X.x2,X.y1),_e=new _(X.x1,X.y2),be=new _(X.x2,X.y2),je=V*Math.PI/180;se._rotate(je),he._rotate(je),_e._rotate(je),be._rotate(je),X.x1=Math.min(se.x,he.x,_e.x,be.x),X.x2=Math.max(se.x,he.x,_e.x,be.x),X.y1=Math.min(se.y,he.y,_e.y,be.y),X.y2=Math.max(se.y,he.y,_e.y,be.y)}l.emplaceBack(h.x,h.y,X.x1,X.y1,X.x2,X.y2,m,v,b)}this.boxEndIndex=l.length}}class W6{constructor(l=[],h=j6){if(this.data=l,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(l){this.data.push(l),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const l=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:h,compare:m}=this,v=h[l];for(;l>0;){const b=l-1>>1,E=h[b];if(m(v,E)>=0)break;h[l]=E,l=b}h[l]=v}_down(l){const{data:h,compare:m}=this,v=this.length>>1,b=h[l];for(;l<v;){let E=1+(l<<1),A=h[E];const k=E+1;if(k<this.length&&m(h[k],A)<0&&(E=k,A=h[k]),m(A,b)>=0)break;h[l]=A,l=E}h[l]=b}}function j6(u,l){return u<l?-1:u>l?1:0}function $6(u,l=1,h=!1){let m=1/0,v=1/0,b=-1/0,E=-1/0;const A=u[0];for(let J=0;J<A.length;J++){const se=A[J];(!J||se.x<m)&&(m=se.x),(!J||se.y<v)&&(v=se.y),(!J||se.x>b)&&(b=se.x),(!J||se.y>E)&&(E=se.y)}const k=Math.min(b-m,E-v);let B=k/2;const V=new W6([],q6);if(k===0)return new _(m,v);for(let J=m;J<b;J+=k)for(let se=v;se<E;se+=k)V.push(new Mp(J+B,se+B,B,u));let W=function(J){let se=0,he=0,_e=0;const be=J[0];for(let je=0,Pe=be.length,Ge=Pe-1;je<Pe;Ge=je++){const ct=be[je],wt=be[Ge],Xt=ct.x*wt.y-wt.x*ct.y;he+=(ct.x+wt.x)*Xt,_e+=(ct.y+wt.y)*Xt,se+=3*Xt}return new Mp(he/se,_e/se,0,J)}(u),X=V.length;for(;V.length;){const J=V.pop();(J.d>W.d||!W.d)&&(W=J,h&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,X)),J.max-W.d<=l||(B=J.h/2,V.push(new Mp(J.p.x-B,J.p.y-B,B,u)),V.push(new Mp(J.p.x+B,J.p.y-B,B,u)),V.push(new Mp(J.p.x-B,J.p.y+B,B,u)),V.push(new Mp(J.p.x+B,J.p.y+B,B,u)),X+=4)}return h&&(console.log(`num probes: ${X}`),console.log(`best distance: ${W.d}`)),W.p}function q6(u,l){return l.max-u.max}function Mp(u,l,h,m){this.p=new _(u,l),this.h=h,this.d=function(v,b){let E=!1,A=1/0;for(let k=0;k<b.length;k++){const B=b[k];for(let V=0,W=B.length,X=W-1;V<W;X=V++){const J=B[V],se=B[X];J.y>v.y!=se.y>v.y&&v.x<(se.x-J.x)*(v.y-J.y)/(se.y-J.y)+J.x&&(E=!E),A=Math.min(A,$I(v,J,se))}}return(E?1:-1)*Math.sqrt(A)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Ms;a.aq=void 0,(Ms=a.aq||(a.aq={}))[Ms.center=1]="center",Ms[Ms.left=2]="left",Ms[Ms.right=3]="right",Ms[Ms.top=4]="top",Ms[Ms.bottom=5]="bottom",Ms[Ms["top-left"]=6]="top-left",Ms[Ms["top-right"]=7]="top-right",Ms[Ms["bottom-left"]=8]="bottom-left",Ms[Ms["bottom-right"]=9]="bottom-right";const Th=7,xS=Number.POSITIVE_INFINITY;function uR(u,l){return l[1]!==xS?function(h,m,v){let b=0,E=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":E=v-Th;break;case"bottom-right":case"bottom-left":case"bottom":E=-v+Th}switch(h){case"top-right":case"bottom-right":case"right":b=-m;break;case"top-left":case"bottom-left":case"left":b=m}return[b,E]}(u,l[0],l[1]):function(h,m){let v=0,b=0;m<0&&(m=0);const E=m/Math.SQRT2;switch(h){case"top-right":case"top-left":b=E-Th;break;case"bottom-right":case"bottom-left":b=-E+Th;break;case"bottom":b=-m+Th;break;case"top":b=m-Th}switch(h){case"top-right":case"bottom-right":v=-E;break;case"top-left":case"bottom-left":v=E;break;case"left":v=m;break;case"right":v=-m}return[v,b]}(u,l[0])}function hR(u,l,h){var m;const v=u.layout,b=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(l,{},h);if(b){const A=b.values,k=[];for(let B=0;B<A.length;B+=2){const V=k[B]=A[B],W=A[B+1].map(X=>X*Kr);V.startsWith("top")?W[1]-=Th:V.startsWith("bottom")&&(W[1]+=Th),k[B+1]=W}return new Qn(k)}const E=v.get("text-variable-anchor");if(E){let A;A=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(l,{},h)*Kr,xS]:v.get("text-offset").evaluate(l,{},h).map(B=>B*Kr);const k=[];for(const B of E)k.push(B,uR(B,A));return new Qn(k)}return null}function wS(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function X6(u,l,h,m,v,b,E,A,k,B,V){let W=b.textMaxSize.evaluate(l,{});W===void 0&&(W=E);const X=u.layers[0].layout,J=X.get("icon-offset").evaluate(l,{},V),se=fR(h.horizontal),he=E/24,_e=u.tilePixelRatio*he,be=u.tilePixelRatio*W/24,je=u.tilePixelRatio*A,Pe=u.tilePixelRatio*X.get("symbol-spacing"),Ge=X.get("text-padding")*u.tilePixelRatio,ct=function(pt,An,Sn,Wn=1){const Ki=pt.get("icon-padding").evaluate(An,{},Sn),ji=Ki&&Ki.values;return[ji[0]*Wn,ji[1]*Wn,ji[2]*Wn,ji[3]*Wn]}(X,l,V,u.tilePixelRatio),wt=X.get("text-max-angle")/180*Math.PI,Xt=X.get("text-rotation-alignment")!=="viewport"&&X.get("symbol-placement")!=="point",Dn=X.get("icon-rotation-alignment")==="map"&&X.get("symbol-placement")!=="point",Qt=X.get("symbol-placement"),qt=Pe/2,Mn=X.get("icon-text-fit");let mn;m&&Mn!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(mn=OP(m,h.vertical,Mn,X.get("icon-text-fit-padding"),J,he)),se&&(m=OP(m,se,Mn,X.get("icon-text-fit-padding"),J,he)));const un=(pt,An)=>{An.x<0||An.x>=jr||An.y<0||An.y>=jr||function(Sn,Wn,Ki,ji,rs,qa,Es,Dr,io,ro,so,kr,ss,Us,Ts,oo,Cs,va,Po,Ai,sr,gr,Zo,Cr,Ep){const pc=Sn.addToLineVertexArray(Wn,Ki);let mc,Xa,xa,ds,cu=0,b_=0,_R=0,yR=0,IS=-1,PS=-1;const uu={};let vR=fp("");if(Sn.allowVerticalPlacement&&ji.vertical){const Vs=Dr.layout.get("text-rotate").evaluate(sr,{},Cr)+90;xa=new Rv(io,Wn,ro,so,kr,ji.vertical,ss,Us,Ts,Vs),Es&&(ds=new Rv(io,Wn,ro,so,kr,Es,Cs,va,Ts,Vs))}if(rs){const Vs=Dr.layout.get("icon-rotate").evaluate(sr,{}),wa=Dr.layout.get("icon-text-fit")!=="none",Qd=lR(rs,Vs,Zo,wa),xl=Es?lR(Es,Vs,Zo,wa):void 0;Xa=new Rv(io,Wn,ro,so,kr,rs,Cs,va,!1,Vs),cu=4*Qd.length;const ef=Sn.iconSizeData;let gc=null;ef.kind==="source"?(gc=[fc*Dr.layout.get("icon-size").evaluate(sr,{})],gc[0]>Sh&&Fe(`${Sn.layerIds[0]}: Value for "icon-size" is >= ${y_}. Reduce your "icon-size".`)):ef.kind==="composite"&&(gc=[fc*gr.compositeIconSizes[0].evaluate(sr,{},Cr),fc*gr.compositeIconSizes[1].evaluate(sr,{},Cr)],(gc[0]>Sh||gc[1]>Sh)&&Fe(`${Sn.layerIds[0]}: Value for "icon-size" is >= ${y_}. Reduce your "icon-size".`)),Sn.addSymbols(Sn.icon,Qd,gc,Ai,Po,sr,a.ah.none,Wn,pc.lineStartIndex,pc.lineLength,-1,Cr),IS=Sn.icon.placedSymbolArray.length-1,xl&&(b_=4*xl.length,Sn.addSymbols(Sn.icon,xl,gc,Ai,Po,sr,a.ah.vertical,Wn,pc.lineStartIndex,pc.lineLength,-1,Cr),PS=Sn.icon.placedSymbolArray.length-1)}const xR=Object.keys(ji.horizontal);for(const Vs of xR){const wa=ji.horizontal[Vs];if(!mc){vR=fp(wa.text);const xl=Dr.layout.get("text-rotate").evaluate(sr,{},Cr);mc=new Rv(io,Wn,ro,so,kr,wa,ss,Us,Ts,xl)}const Qd=wa.positionedLines.length===1;if(_R+=dR(Sn,Wn,wa,qa,Dr,Ts,sr,oo,pc,ji.vertical?a.ah.horizontal:a.ah.horizontalOnly,Qd?xR:[Vs],uu,IS,gr,Cr),Qd)break}ji.vertical&&(yR+=dR(Sn,Wn,ji.vertical,qa,Dr,Ts,sr,oo,pc,a.ah.vertical,["vertical"],uu,PS,gr,Cr));const K6=mc?mc.boxStartIndex:Sn.collisionBoxArray.length,J6=mc?mc.boxEndIndex:Sn.collisionBoxArray.length,Q6=xa?xa.boxStartIndex:Sn.collisionBoxArray.length,eV=xa?xa.boxEndIndex:Sn.collisionBoxArray.length,tV=Xa?Xa.boxStartIndex:Sn.collisionBoxArray.length,nV=Xa?Xa.boxEndIndex:Sn.collisionBoxArray.length,iV=ds?ds.boxStartIndex:Sn.collisionBoxArray.length,rV=ds?ds.boxEndIndex:Sn.collisionBoxArray.length;let vl=-1;const Dv=(Vs,wa)=>Vs&&Vs.circleDiameter?Math.max(Vs.circleDiameter,wa):wa;vl=Dv(mc,vl),vl=Dv(xa,vl),vl=Dv(Xa,vl),vl=Dv(ds,vl);const wR=vl>-1?1:0;wR&&(vl*=Ep/Kr),Sn.glyphOffsetArray.length>=bp.MAX_GLYPHS&&Fe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),sr.sortKey!==void 0&&Sn.addToSortKeyRanges(Sn.symbolInstances.length,sr.sortKey);const sV=hR(Dr,sr,Cr),[oV,aV]=function(Vs,wa){const Qd=Vs.length,xl=wa==null?void 0:wa.values;if((xl==null?void 0:xl.length)>0)for(let ef=0;ef<xl.length;ef+=2){const gc=xl[ef+1];Vs.emplaceBack(a.aq[xl[ef]],gc[0],gc[1])}return[Qd,Vs.length]}(Sn.textAnchorOffsets,sV);Sn.symbolInstances.emplaceBack(Wn.x,Wn.y,uu.right>=0?uu.right:-1,uu.center>=0?uu.center:-1,uu.left>=0?uu.left:-1,uu.vertical||-1,IS,PS,vR,K6,J6,Q6,eV,tV,nV,iV,rV,ro,_R,yR,cu,b_,wR,0,ss,vl,oV,aV)}(u,An,pt,h,m,v,mn,u.layers[0],u.collisionBoxArray,l.index,l.sourceLayerIndex,u.index,_e,[Ge,Ge,Ge,Ge],Xt,k,je,ct,Dn,J,l,b,B,V,E)};if(Qt==="line")for(const pt of nR(l.geometry,0,0,jr,jr)){const An=H6(pt,Pe,wt,h.vertical||se,m,24,be,u.overscaling,jr);for(const Sn of An)se&&Z6(u,se.text,qt,Sn)||un(pt,Sn)}else if(Qt==="line-center"){for(const pt of l.geometry)if(pt.length>1){const An=G6(pt,wt,h.vertical||se,m,24,be);An&&un(pt,An)}}else if(l.type==="Polygon")for(const pt of Zl(l.geometry,0)){const An=$6(pt,16);un(pt[0],new Eh(An.x,An.y,0))}else if(l.type==="LineString")for(const pt of l.geometry)un(pt,new Eh(pt[0].x,pt[0].y,0));else if(l.type==="Point")for(const pt of l.geometry)for(const An of pt)un([An],new Eh(An.x,An.y,0))}function dR(u,l,h,m,v,b,E,A,k,B,V,W,X,J,se){const he=function(je,Pe,Ge,ct,wt,Xt,Dn,Qt){const qt=ct.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,Mn=[];for(const mn of Pe.positionedLines)for(const un of mn.positionedGlyphs){if(!un.rect)continue;const pt=un.rect||{};let An=AP+1,Sn=!0,Wn=1,Ki=0;const ji=(wt||Qt)&&un.vertical,rs=un.metrics.advance*un.scale/2;if(Qt&&Pe.verticalizable&&(Ki=mn.lineOffset/2-(un.imageName?-(Kr-un.metrics.width*un.scale)/2:(un.scale-1)*Kr)),un.imageName){const Ai=Dn[un.imageName];Sn=Ai.sdf,Wn=Ai.pixelRatio,An=Io/Wn}const qa=wt?[un.x+rs,un.y]:[0,0];let Es=wt?[0,0]:[un.x+rs+Ge[0],un.y+Ge[1]-Ki],Dr=[0,0];ji&&(Dr=Es,Es=[0,0]);const io=un.metrics.isDoubleResolution?2:1,ro=(un.metrics.left-An)*un.scale-rs+Es[0],so=(-un.metrics.top-An)*un.scale+Es[1],kr=ro+pt.w/io*un.scale/Wn,ss=so+pt.h/io*un.scale/Wn,Us=new _(ro,so),Ts=new _(kr,so),oo=new _(ro,ss),Cs=new _(kr,ss);if(ji){const Ai=new _(-rs,rs-g_),sr=-Math.PI/2,gr=Kr/2-rs,Zo=new _(5-g_-gr,-(un.imageName?gr:0)),Cr=new _(...Dr);Us._rotateAround(sr,Ai)._add(Zo)._add(Cr),Ts._rotateAround(sr,Ai)._add(Zo)._add(Cr),oo._rotateAround(sr,Ai)._add(Zo)._add(Cr),Cs._rotateAround(sr,Ai)._add(Zo)._add(Cr)}if(qt){const Ai=Math.sin(qt),sr=Math.cos(qt),gr=[sr,-Ai,Ai,sr];Us._matMult(gr),Ts._matMult(gr),oo._matMult(gr),Cs._matMult(gr)}const va=new _(0,0),Po=new _(0,0);Mn.push({tl:Us,tr:Ts,bl:oo,br:Cs,tex:pt,writingMode:Pe.writingMode,glyphOffset:qa,sectionIndex:un.sectionIndex,isSDF:Sn,pixelOffsetTL:va,pixelOffsetBR:Po,minFontScaleX:0,minFontScaleY:0})}return Mn}(0,h,A,v,b,E,m,u.allowVerticalPlacement),_e=u.textSizeData;let be=null;_e.kind==="source"?(be=[fc*v.layout.get("text-size").evaluate(E,{})],be[0]>Sh&&Fe(`${u.layerIds[0]}: Value for "text-size" is >= ${y_}. Reduce your "text-size".`)):_e.kind==="composite"&&(be=[fc*J.compositeTextSizes[0].evaluate(E,{},se),fc*J.compositeTextSizes[1].evaluate(E,{},se)],(be[0]>Sh||be[1]>Sh)&&Fe(`${u.layerIds[0]}: Value for "text-size" is >= ${y_}. Reduce your "text-size".`)),u.addSymbols(u.text,he,be,A,b,E,B,l,k.lineStartIndex,k.lineLength,X,se);for(const je of V)W[je]=u.text.placedSymbolArray.length-1;return 4*he.length}function fR(u){for(const l in u)return u[l];return null}function Z6(u,l,h,m){const v=u.compareText;if(l in v){const b=v[l];for(let E=b.length-1;E>=0;E--)if(m.dist(b[E])<h)return!0}else v[l]=[];return v[l].push(m),!1}const pR=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class bS{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(l,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const b=pR[15&m];if(!b)throw new Error("Unrecognized array type.");const[E]=new Uint16Array(l,2,1),[A]=new Uint32Array(l,4,1);return new bS(A,E,b,l)}constructor(l,h=64,m=Float64Array,v){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const b=pR.indexOf(this.ArrayType),E=2*l*this.ArrayType.BYTES_PER_ELEMENT,A=l*this.IndexArrayType.BYTES_PER_ELEMENT,k=(8-A%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+A+k,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+E+A+k),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+A+k,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=l)}add(l,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=l,this.coords[this._pos++]=h,m}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return SS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,h,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:E,nodeSize:A}=this,k=[0,b.length-1,0],B=[];for(;k.length;){const V=k.pop()||0,W=k.pop()||0,X=k.pop()||0;if(W-X<=A){for(let _e=X;_e<=W;_e++){const be=E[2*_e],je=E[2*_e+1];be>=l&&be<=m&&je>=h&&je<=v&&B.push(b[_e])}continue}const J=X+W>>1,se=E[2*J],he=E[2*J+1];se>=l&&se<=m&&he>=h&&he<=v&&B.push(b[J]),(V===0?l<=se:h<=he)&&(k.push(X),k.push(J-1),k.push(1-V)),(V===0?m>=se:v>=he)&&(k.push(J+1),k.push(W),k.push(1-V))}return B}within(l,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:E}=this,A=[0,v.length-1,0],k=[],B=m*m;for(;A.length;){const V=A.pop()||0,W=A.pop()||0,X=A.pop()||0;if(W-X<=E){for(let _e=X;_e<=W;_e++)gR(b[2*_e],b[2*_e+1],l,h)<=B&&k.push(v[_e]);continue}const J=X+W>>1,se=b[2*J],he=b[2*J+1];gR(se,he,l,h)<=B&&k.push(v[J]),(V===0?l-m<=se:h-m<=he)&&(A.push(X),A.push(J-1),A.push(1-V)),(V===0?l+m>=se:h+m>=he)&&(A.push(J+1),A.push(W),A.push(1-V))}return k}}function SS(u,l,h,m,v,b){if(v-m<=h)return;const E=m+v>>1;mR(u,l,E,m,v,b),SS(u,l,h,m,E-1,1-b),SS(u,l,h,E+1,v,1-b)}function mR(u,l,h,m,v,b){for(;v>m;){if(v-m>600){const B=v-m+1,V=h-m+1,W=Math.log(B),X=.5*Math.exp(2*W/3),J=.5*Math.sqrt(W*X*(B-X)/B)*(V-B/2<0?-1:1);mR(u,l,h,Math.max(m,Math.floor(h-V*X/B+J)),Math.min(v,Math.floor(h+(B-V)*X/B+J)),b)}const E=l[2*h+b];let A=m,k=v;for(x_(u,l,m,h),l[2*v+b]>E&&x_(u,l,m,v);A<k;){for(x_(u,l,A,k),A++,k--;l[2*A+b]<E;)A++;for(;l[2*k+b]>E;)k--}l[2*m+b]===E?x_(u,l,m,k):(k++,x_(u,l,k,v)),k<=h&&(m=k+1),h<=k&&(v=k-1)}}function x_(u,l,h,m){MS(u,h,m),MS(l,2*h,2*m),MS(l,2*h+1,2*m+1)}function MS(u,l,h){const m=u[l];u[l]=u[h],u[h]=m}function gR(u,l,h,m){const v=u-h,b=l-m;return v*v+b*b}var ES;a.be=void 0,(ES=a.be||(a.be={})).create="create",ES.load="load",ES.fullLoad="fullLoad";let Lv=null,w_=[];const TS=1e3/60,CS="loadTime",AS="fullLoadTime",Y6={mark(u){performance.mark(u)},frame(u){const l=u;Lv!=null&&w_.push(l-Lv),Lv=l},clearMetrics(){Lv=null,w_=[],performance.clearMeasures(CS),performance.clearMeasures(AS);for(const u in a.be)performance.clearMarks(a.be[u])},getPerformanceMetrics(){performance.measure(CS,a.be.create,a.be.load),performance.measure(AS,a.be.create,a.be.fullLoad);const u=performance.getEntriesByName(CS)[0].duration,l=performance.getEntriesByName(AS)[0].duration,h=w_.length,m=1/(w_.reduce((b,E)=>b+E,0)/h/1e3),v=w_.filter(b=>b>TS).reduce((b,E)=>b+(E-TS)/TS,0);return{loadTime:u,fullLoadTime:l,fps:m,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};a.$=Yr,a.A=gp,a.B=function(u){if(Ne==null){const l=u.navigator?u.navigator.userAgent:null;Ne=!!u.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return Ne},a.C=class{constructor(u,l){this.target=u,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new U6(()=>this.process()),this.subscription=function(h,m,v,b){return h.addEventListener(m,v,!1),{unsubscribe:()=>{h.removeEventListener(m,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=et(self)?u:window}registerMessageHandler(u,l){this.messageHandlers[u]=l}sendAsync(u,l){return new Promise((h,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:m},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const A={id:v,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(A)},{once:!0});const b=[],E=Object.assign(Object.assign({},u),{id:v,sourceMapId:this.mapId,origin:location.origin,data:$d(u.data,b)});this.target.postMessage(E,{transfer:b})})}receive(u){const l=u.data,h=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(et(self)||l.mustQueue)return this.tasks[h]=l,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,l)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),l=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(u,l)}processTask(u,l){return o(this,void 0,void 0,function*(){if(l.type==="<response>"){const v=this.resolveRejects[u];return delete this.resolveRejects[u],v?void(l.error?v.reject(ja(l.error)):v.resolve(ja(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=ja(l.data),m=new AbortController;this.abortControllers[u]=m;try{const v=yield this.messageHandlers[l.type](l.sourceMapId,h,m);this.completeTask(u,null,v)}catch(v){this.completeTask(u,v)}})}completeTask(u,l,h){const m=[];delete this.abortControllers[u];const v={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?$d(l):null,data:$d(h,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},a.D=Tn,a.E=Vn,a.F=function(){var u=new gp(16);return gp!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},a.G=Et,a.H=function(u,l,h){var m,v,b,E,A,k,B,V,W,X,J,se,he=h[0],_e=h[1],be=h[2];return l===u?(u[12]=l[0]*he+l[4]*_e+l[8]*be+l[12],u[13]=l[1]*he+l[5]*_e+l[9]*be+l[13],u[14]=l[2]*he+l[6]*_e+l[10]*be+l[14],u[15]=l[3]*he+l[7]*_e+l[11]*be+l[15]):(v=l[1],b=l[2],E=l[3],A=l[4],k=l[5],B=l[6],V=l[7],W=l[8],X=l[9],J=l[10],se=l[11],u[0]=m=l[0],u[1]=v,u[2]=b,u[3]=E,u[4]=A,u[5]=k,u[6]=B,u[7]=V,u[8]=W,u[9]=X,u[10]=J,u[11]=se,u[12]=m*he+A*_e+W*be+l[12],u[13]=v*he+k*_e+X*be+l[13],u[14]=b*he+B*_e+J*be+l[14],u[15]=E*he+V*_e+se*be+l[15]),u},a.I=cS,a.J=function(u,l,h){var m=h[0],v=h[1],b=h[2];return u[0]=l[0]*m,u[1]=l[1]*m,u[2]=l[2]*m,u[3]=l[3]*m,u[4]=l[4]*v,u[5]=l[5]*v,u[6]=l[6]*v,u[7]=l[7]*v,u[8]=l[8]*b,u[9]=l[9]*b,u[10]=l[10]*b,u[11]=l[11]*b,u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.K=YI,a.L=function(u,l){const h={};for(let m=0;m<l.length;m++){const v=l[m];v in u&&(h[v]=u[v])}return h},a.M=Mh,a.N=jP,a.O=$P,a.P=_,a.Q=ya,a.R=_a,a.S=C,a.T=mh,a.U=O,a.V=ut,a.W=jr,a.X=G,a.Y=Cv,a.Z=class extends ue{},a._=o,a.a=Re,a.a$=function(u,l){return u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[4]=l[4],u[5]=l[5],u[6]=l[6],u[7]=l[7],u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15],u},a.a0=vS,a.a1=Je,a.a2=u=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(h=>{l.onloadstart=()=>{h(l)};for(const m of u){const v=window.document.createElement("source");at(m)||(l.crossOrigin="Anonymous"),v.src=m,l.appendChild(v)}})},a.a3=function(){return ce++},a.a4=ri,a.a5=bp,a.a6=Hd,a.a7=Kd,a.a8=rr,a.a9=JP,a.aA=function(u){if(u.type==="custom")return new B6(u);switch(u.type){case"background":return new O6(u);case"circle":return new S4(u);case"fill":return new U4(u);case"fill-extrusion":return new t6(u);case"heatmap":return new E4(u);case"hillshade":return new C4(u);case"line":return new c6(u);case"raster":return new z6(u);case"symbol":return new Tv(u)}},a.aB=pe,a.aC=function(u,l){if(!u)return[{command:"setStyle",args:[l]}];let h=[];try{if(!jt(u.version,l.version))return[{command:"setStyle",args:[l]}];jt(u.center,l.center)||h.push({command:"setCenter",args:[l.center]}),jt(u.zoom,l.zoom)||h.push({command:"setZoom",args:[l.zoom]}),jt(u.bearing,l.bearing)||h.push({command:"setBearing",args:[l.bearing]}),jt(u.pitch,l.pitch)||h.push({command:"setPitch",args:[l.pitch]}),jt(u.sprite,l.sprite)||h.push({command:"setSprite",args:[l.sprite]}),jt(u.glyphs,l.glyphs)||h.push({command:"setGlyphs",args:[l.glyphs]}),jt(u.transition,l.transition)||h.push({command:"setTransition",args:[l.transition]}),jt(u.light,l.light)||h.push({command:"setLight",args:[l.light]}),jt(u.terrain,l.terrain)||h.push({command:"setTerrain",args:[l.terrain]}),jt(u.sky,l.sky)||h.push({command:"setSky",args:[l.sky]}),jt(u.projection,l.projection)||h.push({command:"setProjection",args:[l.projection]});const m={},v=[];(function(E,A,k,B){let V;for(V in A=A||{},E=E||{})Object.prototype.hasOwnProperty.call(E,V)&&(Object.prototype.hasOwnProperty.call(A,V)||tt(V,k,B));for(V in A)Object.prototype.hasOwnProperty.call(A,V)&&(Object.prototype.hasOwnProperty.call(E,V)?jt(E[V],A[V])||(E[V].type==="geojson"&&A[V].type==="geojson"&&St(E,A,V)?me(k,{command:"setGeoJSONSourceData",args:[V,A[V].data]}):xt(V,A,k,B)):le(V,A,k))})(u.sources,l.sources,v,m);const b=[];u.layers&&u.layers.forEach(E=>{"source"in E&&m[E.source]?h.push({command:"removeLayer",args:[E.id]}):b.push(E)}),h=h.concat(v),function(E,A,k){A=A||[];const B=(E=E||[]).map(hn),V=A.map(hn),W=E.reduce(zt,{}),X=A.reduce(zt,{}),J=B.slice(),se=Object.create(null);let he,_e,be,je,Pe;for(let Ge=0,ct=0;Ge<B.length;Ge++)he=B[Ge],Object.prototype.hasOwnProperty.call(X,he)?ct++:(me(k,{command:"removeLayer",args:[he]}),J.splice(J.indexOf(he,ct),1));for(let Ge=0,ct=0;Ge<V.length;Ge++)he=V[V.length-1-Ge],J[J.length-1-Ge]!==he&&(Object.prototype.hasOwnProperty.call(W,he)?(me(k,{command:"removeLayer",args:[he]}),J.splice(J.lastIndexOf(he,J.length-ct),1)):ct++,je=J[J.length-Ge],me(k,{command:"addLayer",args:[X[he],je]}),J.splice(J.length-Ge,0,he),se[he]=!0);for(let Ge=0;Ge<V.length;Ge++)if(he=V[Ge],_e=W[he],be=X[he],!se[he]&&!jt(_e,be))if(jt(_e.source,be.source)&&jt(_e["source-layer"],be["source-layer"])&&jt(_e.type,be.type)){for(Pe in yt(_e.layout,be.layout,k,he,null,"setLayoutProperty"),yt(_e.paint,be.paint,k,he,null,"setPaintProperty"),jt(_e.filter,be.filter)||me(k,{command:"setFilter",args:[he,be.filter]}),jt(_e.minzoom,be.minzoom)&&jt(_e.maxzoom,be.maxzoom)||me(k,{command:"setLayerZoomRange",args:[he,be.minzoom,be.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?yt(_e[Pe],be[Pe],k,he,Pe.slice(6),"setPaintProperty"):jt(_e[Pe],be[Pe])||me(k,{command:"setLayerProperty",args:[he,Pe,be[Pe]]}));for(Pe in be)Object.prototype.hasOwnProperty.call(be,Pe)&&!Object.prototype.hasOwnProperty.call(_e,Pe)&&Pe!=="layout"&&Pe!=="paint"&&Pe!=="filter"&&Pe!=="metadata"&&Pe!=="minzoom"&&Pe!=="maxzoom"&&(Pe.indexOf("paint.")===0?yt(_e[Pe],be[Pe],k,he,Pe.slice(6),"setPaintProperty"):jt(_e[Pe],be[Pe])||me(k,{command:"setLayerProperty",args:[he,Pe,be[Pe]]}))}else me(k,{command:"removeLayer",args:[he]}),je=J[J.lastIndexOf(he)+1],me(k,{command:"addLayer",args:[be,je]})}(b,l.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[l]}]}return h},a.aD=function(u){const l=[],h=u.id;return h===void 0&&l.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&l.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&l.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),l},a.aE=function u(l,h){if(Array.isArray(l)){if(!Array.isArray(h)||l.length!==h.length)return!1;for(let m=0;m<l.length;m++)if(!u(l[m],h[m]))return!1;return!0}if(typeof l=="object"&&l!==null&&h!==null){if(typeof h!="object"||Object.keys(l).length!==Object.keys(h).length)return!1;for(const m in l)if(!u(l[m],h[m]))return!1;return!0}return l===h},a.aF=K,a.aG=Q,a.aH=class extends Xd{constructor(u,l){super(u,l),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},a.aI=dv,a.aJ=class extends Xd{constructor(u,l){super(u,l),this.current=m4}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let l=1;l<16;l++)if(u[l]!==this.current[l]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},a.aK=BI,a.aL=class extends Xd{constructor(u,l){super(u,l),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},a.aM=class extends Xd{constructor(u,l){super(u,l),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},a.aN=UI,a.aO=function(u,l,h,m,v,b,E){var A=1/(l-h),k=1/(m-v),B=1/(b-E);return u[0]=-2*A,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*k,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*B,u[11]=0,u[12]=(l+h)*A,u[13]=(v+m)*k,u[14]=(E+b)*B,u[15]=1,u},a.aP=Ft,a.aQ=b4,a.aR=class extends _t{},a.aS=f6,a.aT=class extends sn{},a.aU=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},a.aV=tP,a.aW=su,a.aX=class extends Jt{},a.aY=is,a.aZ=function(u,l){return u[0]===l[0]&&u[1]===l[1]&&u[2]===l[2]&&u[3]===l[3]&&u[4]===l[4]&&u[5]===l[5]&&u[6]===l[6]&&u[7]===l[7]&&u[8]===l[8]&&u[9]===l[9]&&u[10]===l[10]&&u[11]===l[11]&&u[12]===l[12]&&u[13]===l[13]&&u[14]===l[14]&&u[15]===l[15]},a.a_=function(u,l){var h=u[0],m=u[1],v=u[2],b=u[3],E=u[4],A=u[5],k=u[6],B=u[7],V=u[8],W=u[9],X=u[10],J=u[11],se=u[12],he=u[13],_e=u[14],be=u[15],je=l[0],Pe=l[1],Ge=l[2],ct=l[3],wt=l[4],Xt=l[5],Dn=l[6],Qt=l[7],qt=l[8],Mn=l[9],mn=l[10],un=l[11],pt=l[12],An=l[13],Sn=l[14],Wn=l[15];return Math.abs(h-je)<=no*Math.max(1,Math.abs(h),Math.abs(je))&&Math.abs(m-Pe)<=no*Math.max(1,Math.abs(m),Math.abs(Pe))&&Math.abs(v-Ge)<=no*Math.max(1,Math.abs(v),Math.abs(Ge))&&Math.abs(b-ct)<=no*Math.max(1,Math.abs(b),Math.abs(ct))&&Math.abs(E-wt)<=no*Math.max(1,Math.abs(E),Math.abs(wt))&&Math.abs(A-Xt)<=no*Math.max(1,Math.abs(A),Math.abs(Xt))&&Math.abs(k-Dn)<=no*Math.max(1,Math.abs(k),Math.abs(Dn))&&Math.abs(B-Qt)<=no*Math.max(1,Math.abs(B),Math.abs(Qt))&&Math.abs(V-qt)<=no*Math.max(1,Math.abs(V),Math.abs(qt))&&Math.abs(W-Mn)<=no*Math.max(1,Math.abs(W),Math.abs(Mn))&&Math.abs(X-mn)<=no*Math.max(1,Math.abs(X),Math.abs(mn))&&Math.abs(J-un)<=no*Math.max(1,Math.abs(J),Math.abs(un))&&Math.abs(se-pt)<=no*Math.max(1,Math.abs(se),Math.abs(pt))&&Math.abs(he-An)<=no*Math.max(1,Math.abs(he),Math.abs(An))&&Math.abs(_e-Sn)<=no*Math.max(1,Math.abs(_e),Math.abs(Sn))&&Math.abs(be-Wn)<=no*Math.max(1,Math.abs(be),Math.abs(Wn))},a.aa=function(u){const l={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,b)=>{const E=v||b;return l[m]=!E||E.toLowerCase(),""}),l["max-age"]){const h=parseInt(l["max-age"],10);isNaN(h)?delete l["max-age"]:l["max-age"]=h}return l},a.ab=function(u,l){const h=[];for(const m in u)m in l||h.push(m);return h},a.ac=Y,a.ad=function(u,l,h){var m=Math.sin(h),v=Math.cos(h),b=l[0],E=l[1],A=l[2],k=l[3],B=l[4],V=l[5],W=l[6],X=l[7];return l!==u&&(u[8]=l[8],u[9]=l[9],u[10]=l[10],u[11]=l[11],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[0]=b*v+B*m,u[1]=E*v+V*m,u[2]=A*v+W*m,u[3]=k*v+X*m,u[4]=B*v-b*m,u[5]=V*v-E*m,u[6]=W*v-A*m,u[7]=X*v-k*m,u},a.ae=function(u){var l=new gp(16);return l[0]=u[0],l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=u[6],l[7]=u[7],l[8]=u[8],l[9]=u[9],l[10]=u[10],l[11]=u[11],l[12]=u[12],l[13]=u[13],l[14]=u[14],l[15]=u[15],l},a.af=gv,a.ag=function(u,l){let h=0,m=0;if(u.kind==="constant")m=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:v,minZoom:b,maxZoom:E}=u,A=v?Y(Ei.interpolationFactor(v,l,b,E),0,1):0;u.kind==="camera"?m=kn.number(u.minSize,u.maxSize,A):h=A}return{uSizeT:h,uSize:m}},a.ai=function(u,{uSize:l,uSizeT:h},{lowerSize:m,upperSize:v}){return u.kind==="source"?m/fc:u.kind==="composite"?kn.number(m/fc,v/fc,h):l},a.aj=fS,a.ak=function(u,l,h,m){const v=l.y-u.y,b=l.x-u.x,E=m.y-h.y,A=m.x-h.x,k=E*b-A*v;if(k===0)return null;const B=(A*(u.y-h.y)-E*(u.x-h.x))/k;return new _(u.x+B*b,u.y+B*v)},a.al=nR,a.am=WI,a.an=qb,a.ao=function(u){let l=1/0,h=1/0,m=-1/0,v=-1/0;for(const b of u)l=Math.min(l,b.x),h=Math.min(h,b.y),m=Math.max(m,b.x),v=Math.max(v,b.y);return[l,h,m,v]},a.ap=Kr,a.ar=dS,a.as=function(u,l){var h=l[0],m=l[1],v=l[2],b=l[3],E=l[4],A=l[5],k=l[6],B=l[7],V=l[8],W=l[9],X=l[10],J=l[11],se=l[12],he=l[13],_e=l[14],be=l[15],je=h*A-m*E,Pe=h*k-v*E,Ge=h*B-b*E,ct=m*k-v*A,wt=m*B-b*A,Xt=v*B-b*k,Dn=V*he-W*se,Qt=V*_e-X*se,qt=V*be-J*se,Mn=W*_e-X*he,mn=W*be-J*he,un=X*be-J*_e,pt=je*un-Pe*mn+Ge*Mn+ct*qt-wt*Qt+Xt*Dn;return pt?(u[0]=(A*un-k*mn+B*Mn)*(pt=1/pt),u[1]=(v*mn-m*un-b*Mn)*pt,u[2]=(he*Xt-_e*wt+be*ct)*pt,u[3]=(X*wt-W*Xt-J*ct)*pt,u[4]=(k*qt-E*un-B*Qt)*pt,u[5]=(h*un-v*qt+b*Qt)*pt,u[6]=(_e*Ge-se*Xt-be*Pe)*pt,u[7]=(V*Xt-X*Ge+J*Pe)*pt,u[8]=(E*mn-A*qt+B*Dn)*pt,u[9]=(m*qt-h*mn-b*Dn)*pt,u[10]=(se*wt-he*Ge+be*je)*pt,u[11]=(W*Ge-V*wt-J*je)*pt,u[12]=(A*Qt-E*Mn-k*Dn)*pt,u[13]=(h*Mn-m*Qt+v*Dn)*pt,u[14]=(he*Pe-se*ct-_e*je)*pt,u[15]=(V*ct-W*Pe+X*je)*pt,u):null},a.at=wS,a.au=hS,a.av=bS,a.aw=function(){const u={},l=Te.$version;for(const h in Te.$root){const m=Te.$root[h];if(m.required){let v=null;v=h==="version"?l:m.type==="array"?[]:{},v!=null&&(u[h]=v)}}return u},a.ax=rv,a.ay=vn,a.az=function(u){u=u.slice();const l=Object.create(null);for(let h=0;h<u.length;h++)l[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=wn(u[h],l[u[h].ref]));return u},a.b=st,a.b0=function(u,l,h){return u[0]=l[0]*h[0],u[1]=l[1]*h[1],u[2]=l[2]*h[2],u[3]=l[3]*h[3],u},a.b1=function(u,l){return u[0]*l[0]+u[1]*l[1]+u[2]*l[2]+u[3]*l[3]},a.b2=ee,a.b3=ZP,a.b4=qP,a.b5=function(u,l,h,m,v){var b,E=1/Math.tan(l/2);return u[0]=E/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=E,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,v!=null&&v!==1/0?(u[10]=(v+m)*(b=1/(m-v)),u[14]=2*v*m*b):(u[10]=-1,u[14]=-2*m),u},a.b6=function(u,l,h){var m=Math.sin(h),v=Math.cos(h),b=l[4],E=l[5],A=l[6],k=l[7],B=l[8],V=l[9],W=l[10],X=l[11];return l!==u&&(u[0]=l[0],u[1]=l[1],u[2]=l[2],u[3]=l[3],u[12]=l[12],u[13]=l[13],u[14]=l[14],u[15]=l[15]),u[4]=b*v+B*m,u[5]=E*v+V*m,u[6]=A*v+W*m,u[7]=k*v+X*m,u[8]=B*v-b*m,u[9]=V*v-E*m,u[10]=W*v-A*m,u[11]=X*v-k*m,u},a.b7=z,a.b8=H,a.b9=function(u){return u*Math.PI/180},a.bA=Qs,a.bB=uc,a.ba=function(u,l){return u[0]=l[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=l[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=l[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},a.bb=class extends re{},a.bc=_S,a.bd=Y6,a.bf=It,a.bg=function(u,l){Re.REGISTERED_PROTOCOLS[u]=l},a.bh=function(u){delete Re.REGISTERED_PROTOCOLS[u]},a.bi=function(u,l){const h={};for(let v=0;v<u.length;v++){const b=l&&l[u[v].id]||Ha(u[v]);l&&(l[u[v].id]=b);let E=h[b];E||(E=h[b]=[]),E.push(u[v])}const m=[];for(const v in h)m.push(h[v]);return m},a.bj=dn,a.bk=KP,a.bl=QP,a.bm=PP,a.bn=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=jr/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const l=u.bucket.layers[0],h=l.layout,m=l._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new rr(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new rr(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new rr(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:B,maxZoom:V}=u.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new rr(B),u.canonical),m["text-size"].possiblyEvaluate(new rr(V),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:B,maxZoom:V}=u.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new rr(B),u.canonical),m["icon-size"].possiblyEvaluate(new rr(V),u.canonical)]}const b=h.get("text-line-height")*Kr,E=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",A=h.get("text-keep-upright"),k=h.get("text-size");for(const B of u.bucket.features){const V=h.get("text-font").evaluate(B,{},u.canonical).join(","),W=k.evaluate(B,{},u.canonical),X=v.layoutTextSize.evaluate(B,{},u.canonical),J=v.layoutIconSize.evaluate(B,{},u.canonical),se={horizontal:{},vertical:void 0},he=B.text;let _e,be=[0,0];if(he){const Ge=he.toString(),ct=h.get("text-letter-spacing").evaluate(B,{},u.canonical)*Kr,wt=Ub(Ge)?ct:0,Xt=h.get("text-anchor").evaluate(B,{},u.canonical),Dn=hR(l,B,u.canonical);if(!Dn){const mn=h.get("text-radial-offset").evaluate(B,{},u.canonical);be=mn?uR(Xt,[mn*Kr,xS]):h.get("text-offset").evaluate(B,{},u.canonical).map(un=>un*Kr)}let Qt=E?"center":h.get("text-justify").evaluate(B,{},u.canonical);const qt=h.get("symbol-placement")==="point"?h.get("text-max-width").evaluate(B,{},u.canonical)*Kr:1/0,Mn=()=>{u.bucket.allowVerticalPlacement&&Kg(Ge)&&(se.vertical=Sv(he,u.glyphMap,u.glyphPositions,u.imagePositions,V,qt,b,Xt,"left",wt,be,a.ah.vertical,!0,X,W))};if(!E&&Dn){const mn=new Set;if(Qt==="auto")for(let pt=0;pt<Dn.values.length;pt+=2)mn.add(wS(Dn.values[pt]));else mn.add(Qt);let un=!1;for(const pt of mn)if(!se.horizontal[pt])if(un)se.horizontal[pt]=se.horizontal[0];else{const An=Sv(he,u.glyphMap,u.glyphPositions,u.imagePositions,V,qt,b,"center",pt,wt,be,a.ah.horizontal,!1,X,W);An&&(se.horizontal[pt]=An,un=An.positionedLines.length===1)}Mn()}else{Qt==="auto"&&(Qt=wS(Xt));const mn=Sv(he,u.glyphMap,u.glyphPositions,u.imagePositions,V,qt,b,Xt,Qt,wt,be,a.ah.horizontal,!1,X,W);mn&&(se.horizontal[Qt]=mn),Mn(),Kg(Ge)&&E&&A&&(se.vertical=Sv(he,u.glyphMap,u.glyphPositions,u.imagePositions,V,qt,b,Xt,Qt,wt,be,a.ah.vertical,!1,X,W))}}let je=!1;if(B.icon&&B.icon.name){const Ge=u.imageMap[B.icon.name];Ge&&(_e=R6(u.imagePositions[B.icon.name],h.get("icon-offset").evaluate(B,{},u.canonical),h.get("icon-anchor").evaluate(B,{},u.canonical)),je=!!Ge.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=je:u.bucket.sdfIcons!==je&&Fe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ge.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const Pe=fR(se.horizontal)||se.vertical;u.bucket.iconsInText=!!Pe&&Pe.iconsInText,(Pe||_e)&&X6(u.bucket,B,se,_e,u.imageMap,v,X,J,be,je,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},a.bo=sS,a.bp=nS,a.bq=rS,a.br=wh,a.bs=aS,a.bt=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},a.bu=function(u,l,h,m,v){return o(this,void 0,void 0,function*(){if(O())try{return yield ut(u,l,h,m,v)}catch{}return function(b,E,A,k,B){const V=b.width,W=b.height;ot&&dt||(ot=new OffscreenCanvas(V,W),dt=ot.getContext("2d",{willReadFrequently:!0})),ot.width=V,ot.height=W,dt.drawImage(b,0,0,V,W);const X=dt.getImageData(E,A,k,B);return dt.clearRect(0,0,V,W),X.data}(u,l,h,m,v)})},a.bv=YP,a.bw=d,a.bx=p,a.by=wP,a.bz=function(u){return u.message===Ct},a.c=Vt,a.d=u=>o(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(l)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),a.e=te,a.f=u=>new Promise((l,h)=>{const m=new Image;m.onload=()=>{l(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Ee})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(v):Ee}),a.g=mt,a.h=(u,l)=>xn(te(u,{type:"json"}),l),a.i=et,a.j=on,a.k=Jn,a.l=(u,l)=>xn(te(u,{type:"arrayBuffer"}),l),a.m=xn,a.n=function(u){return new aS(u).readFields(M6,[])},a.o=c_,a.p=IP,a.q=y,a.r=Bb,a.s=at,a.t=Yg,a.u=en,a.v=Te,a.w=Fe,a.x=Wd,a.y=function([u,l,h]){return l+=90,l*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(l)*Math.sin(h),y:u*Math.sin(l)*Math.sin(h),z:u*Math.cos(h)}},a.z=kn}),r("worker",["./shared"],function(a){class o{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,Z){for(const fe of j){this._layerConfigs[fe.id]=fe;const xe=this._layers[fe.id]=a.aA(fe);xe._featureFilter=a.a6(xe.filter),this.keyCache[fe.id]&&delete this.keyCache[fe.id]}for(const fe of Z)delete this.keyCache[fe],delete this._layerConfigs[fe],delete this._layers[fe];this.familiesBySource={};const ne=a.bi(Object.values(this._layerConfigs),this.keyCache);for(const fe of ne){const xe=fe.map(Ze=>this._layers[Ze.id]),Ie=xe[0];if(Ie.visibility==="none")continue;const ke=Ie.source||"";let Se=this.familiesBySource[ke];Se||(Se=this.familiesBySource[ke]={});const Ue=Ie.sourceLayer||"_geojsonTileLayer";let ft=Se[Ue];ft||(ft=Se[Ue]=[]),ft.push(xe)}}}class d{constructor(j){const Z={},ne=[];for(const ke in j){const Se=j[ke],Ue=Z[ke]={};for(const ft in Se){const Ze=Se[+ft];if(!Ze||Ze.bitmap.width===0||Ze.bitmap.height===0)continue;const rt={x:0,y:0,w:Ze.bitmap.width+2,h:Ze.bitmap.height+2};ne.push(rt),Ue[ft]={rect:rt,metrics:Ze.metrics}}}const{w:fe,h:xe}=a.p(ne),Ie=new a.o({width:fe||1,height:xe||1});for(const ke in j){const Se=j[ke];for(const Ue in Se){const ft=Se[+Ue];if(!ft||ft.bitmap.width===0||ft.bitmap.height===0)continue;const Ze=Z[ke][Ue].rect;a.o.copy(ft.bitmap,Ie,{x:0,y:0},{x:Ze.x+1,y:Ze.y+1},ft.bitmap)}}this.image=Ie,this.positions=Z}}a.bj("GlyphAtlas",d);class p{constructor(j){this.tileID=new a.Q(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[]}parse(j,Z,ne,fe){return a._(this,void 0,void 0,function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new a.a4;const xe=new a.bk(Object.keys(j.layers).sort()),Ie=new a.bl(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const ke={},Se={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ne},Ue=Z.familiesBySource[this.source];for(const oe in Ue){const Be=j.layers[oe];if(!Be)continue;Be.version===1&&a.w(`Vector tile source "${this.source}" layer "${oe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Qe=xe.encode(oe),it=[];for(let $e=0;$e<Be.length;$e++){const Pt=Be.feature($e),rn=Ie.getId(Pt,oe);it.push({feature:Pt,id:rn,index:$e,sourceLayerIndex:Qe})}for(const $e of Ue[oe]){const Pt=$e[0];Pt.source!==this.source&&a.w(`layer.source = ${Pt.source} does not equal this.source = ${this.source}`),Pt.minzoom&&this.zoom<Math.floor(Pt.minzoom)||Pt.maxzoom&&this.zoom>=Pt.maxzoom||Pt.visibility!=="none"&&(g($e,this.zoom,ne),(ke[Pt.id]=Pt.createBucket({index:Ie.bucketLayerIDs.length,layers:$e,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Qe,sourceID:this.source})).populate(it,Se,this.tileID.canonical),Ie.bucketLayerIDs.push($e.map(rn=>rn.id)))}}const ft=a.aF(Se.glyphDependencies,oe=>Object.keys(oe).map(Number));this.inFlightDependencies.forEach(oe=>oe==null?void 0:oe.abort()),this.inFlightDependencies=[];let Ze=Promise.resolve({});if(Object.keys(ft).length){const oe=new AbortController;this.inFlightDependencies.push(oe),Ze=fe.sendAsync({type:"GG",data:{stacks:ft,source:this.source,tileID:this.tileID,type:"glyphs"}},oe)}const rt=Object.keys(Se.iconDependencies);let nn=Promise.resolve({});if(rt.length){const oe=new AbortController;this.inFlightDependencies.push(oe),nn=fe.sendAsync({type:"GI",data:{icons:rt,source:this.source,tileID:this.tileID,type:"icons"}},oe)}const fn=Object.keys(Se.patternDependencies);let Hn=Promise.resolve({});if(fn.length){const oe=new AbortController;this.inFlightDependencies.push(oe),Hn=fe.sendAsync({type:"GI",data:{icons:fn,source:this.source,tileID:this.tileID,type:"patterns"}},oe)}const[Fn,ni,wi]=yield Promise.all([Ze,nn,Hn]),Ui=new d(Fn),yr=new a.bm(ni,wi);for(const oe in ke){const Be=ke[oe];Be instanceof a.a5?(g(Be.layers,this.zoom,ne),a.bn({bucket:Be,glyphMap:Fn,glyphPositions:Ui.positions,imageMap:ni,imagePositions:yr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Be.hasPattern&&(Be instanceof a.bo||Be instanceof a.bp||Be instanceof a.bq)&&(g(Be.layers,this.zoom,ne),Be.addFeatures(Se,this.tileID.canonical,yr.patternPositions))}return this.status="done",{buckets:Object.values(ke).filter(oe=>!oe.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ui.image,imageAtlas:yr,glyphMap:this.returnDependencies?Fn:null,iconMap:this.returnDependencies?ni:null,glyphPositions:this.returnDependencies?Ui.positions:null}})}}function g(ae,j,Z){const ne=new a.a8(j);for(const fe of ae)fe.recalculate(ne,Z)}class _{constructor(j,Z,ne){this.actor=j,this.layerIndex=Z,this.availableImages=ne,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,Z){return a._(this,void 0,void 0,function*(){const ne=yield a.l(j.request,Z);try{return{vectorTile:new a.br.VectorTile(new a.bs(ne.data)),rawData:ne.data,cacheControl:ne.cacheControl,expires:ne.expires}}catch(fe){const xe=new Uint8Array(ne.data);let Ie=`Unable to parse the tile at ${j.request.url}, `;throw Ie+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${fe.message}`,new Error(Ie)}})}loadTile(j){return a._(this,void 0,void 0,function*(){const Z=j.uid,ne=!!(j&&j.request&&j.request.collectResourceTiming)&&new a.bt(j.request),fe=new p(j);this.loading[Z]=fe;const xe=new AbortController;fe.abort=xe;try{const Ie=yield this.loadVectorTile(j,xe);if(delete this.loading[Z],!Ie)return null;const ke=Ie.rawData,Se={};Ie.expires&&(Se.expires=Ie.expires),Ie.cacheControl&&(Se.cacheControl=Ie.cacheControl);const Ue={};if(ne){const Ze=ne.finish();Ze&&(Ue.resourceTiming=JSON.parse(JSON.stringify(Ze)))}fe.vectorTile=Ie.vectorTile;const ft=fe.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Z]=fe,this.fetching[Z]={rawTileData:ke,cacheControl:Se,resourceTiming:Ue};try{const Ze=yield ft;return a.e({rawTileData:ke.slice(0)},Ze,Se,Ue)}finally{delete this.fetching[Z]}}catch(Ie){throw delete this.loading[Z],fe.status="done",this.loaded[Z]=fe,Ie}})}reloadTile(j){return a._(this,void 0,void 0,function*(){const Z=j.uid;if(!this.loaded||!this.loaded[Z])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ne=this.loaded[Z];if(ne.showCollisionBoxes=j.showCollisionBoxes,ne.status==="parsing"){const fe=yield ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor);let xe;if(this.fetching[Z]){const{rawTileData:Ie,cacheControl:ke,resourceTiming:Se}=this.fetching[Z];delete this.fetching[Z],xe=a.e({rawTileData:Ie.slice(0)},fe,ke,Se)}else xe=fe;return xe}if(ne.status==="done"&&ne.vectorTile)return ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(j){return a._(this,void 0,void 0,function*(){const Z=this.loading,ne=j.uid;Z&&Z[ne]&&Z[ne].abort&&(Z[ne].abort.abort(),delete Z[ne])})}removeTile(j){return a._(this,void 0,void 0,function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]})}}class w{constructor(){this.loaded={}}loadTile(j){return a._(this,void 0,void 0,function*(){const{uid:Z,encoding:ne,rawImageData:fe,redFactor:xe,greenFactor:Ie,blueFactor:ke,baseShift:Se}=j,Ue=fe.width+2,ft=fe.height+2,Ze=a.b(fe)?new a.R({width:Ue,height:ft},yield a.bu(fe,-1,-1,Ue,ft)):fe,rt=new a.bv(Z,Ze,ne,xe,Ie,ke,Se);return this.loaded=this.loaded||{},this.loaded[Z]=rt,rt})}removeTile(j){const Z=this.loaded,ne=j.uid;Z&&Z[ne]&&delete Z[ne]}}function T(ae,j){if(ae.length!==0){I(ae[0],j);for(var Z=1;Z<ae.length;Z++)I(ae[Z],!j)}}function I(ae,j){for(var Z=0,ne=0,fe=0,xe=ae.length,Ie=xe-1;fe<xe;Ie=fe++){var ke=(ae[fe][0]-ae[Ie][0])*(ae[Ie][1]+ae[fe][1]),Se=Z+ke;ne+=Math.abs(Z)>=Math.abs(ke)?Z-Se+ke:ke-Se+Z,Z=Se}Z+ne>=0!=!!j&&ae.reverse()}var L=a.bw(function ae(j,Z){var ne,fe=j&&j.type;if(fe==="FeatureCollection")for(ne=0;ne<j.features.length;ne++)ae(j.features[ne],Z);else if(fe==="GeometryCollection")for(ne=0;ne<j.geometries.length;ne++)ae(j.geometries[ne],Z);else if(fe==="Feature")ae(j.geometry,Z);else if(fe==="Polygon")T(j.coordinates,Z);else if(fe==="MultiPolygon")for(ne=0;ne<j.coordinates.length;ne++)T(j.coordinates[ne],Z);return j});const P=a.br.VectorTileFeature.prototype.toGeoJSON;var C={exports:{}},O=a.bx,z=a.br.VectorTileFeature,H=Y;function Y(ae,j){this.options=j||{},this.features=ae,this.length=ae.length}function ee(ae,j){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=j||4096}Y.prototype.feature=function(ae){return new ee(this.features[ae],this.options.extent)},ee.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var j=0;j<ae.length;j++){for(var Z=ae[j],ne=[],fe=0;fe<Z.length;fe++)ne.push(new O(Z[fe][0],Z[fe][1]));this.geometry.push(ne)}return this.geometry},ee.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,j=1/0,Z=-1/0,ne=1/0,fe=-1/0,xe=0;xe<ae.length;xe++)for(var Ie=ae[xe],ke=0;ke<Ie.length;ke++){var Se=Ie[ke];j=Math.min(j,Se.x),Z=Math.max(Z,Se.x),ne=Math.min(ne,Se.y),fe=Math.max(fe,Se.y)}return[j,ne,Z,fe]},ee.prototype.toGeoJSON=z.prototype.toGeoJSON;var te=a.by,ce=H;function K(ae){var j=new te;return function(Z,ne){for(var fe in Z.layers)ne.writeMessage(3,Q,Z.layers[fe])}(ae,j),j.finish()}function Q(ae,j){var Z;j.writeVarintField(15,ae.version||1),j.writeStringField(1,ae.name||""),j.writeVarintField(5,ae.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<ae.length;Z++)ne.feature=ae.feature(Z),j.writeMessage(2,pe,ne);var fe=ne.keys;for(Z=0;Z<fe.length;Z++)j.writeStringField(3,fe[Z]);var xe=ne.values;for(Z=0;Z<xe.length;Z++)j.writeMessage(4,Ne,xe[Z])}function pe(ae,j){var Z=ae.feature;Z.id!==void 0&&j.writeVarintField(1,Z.id),j.writeMessage(2,ze,ae),j.writeVarintField(3,Z.type),j.writeMessage(4,et,Z)}function ze(ae,j){var Z=ae.feature,ne=ae.keys,fe=ae.values,xe=ae.keycache,Ie=ae.valuecache;for(var ke in Z.properties){var Se=Z.properties[ke],Ue=xe[ke];if(Se!==null){Ue===void 0&&(ne.push(ke),xe[ke]=Ue=ne.length-1),j.writeVarint(Ue);var ft=typeof Se;ft!=="string"&&ft!=="boolean"&&ft!=="number"&&(Se=JSON.stringify(Se));var Ze=ft+":"+Se,rt=Ie[Ze];rt===void 0&&(fe.push(Se),Ie[Ze]=rt=fe.length-1),j.writeVarint(rt)}}}function Fe(ae,j){return(j<<3)+(7&ae)}function qe(ae){return ae<<1^ae>>31}function et(ae,j){for(var Z=ae.loadGeometry(),ne=ae.type,fe=0,xe=0,Ie=Z.length,ke=0;ke<Ie;ke++){var Se=Z[ke],Ue=1;ne===1&&(Ue=Se.length),j.writeVarint(Fe(1,Ue));for(var ft=ne===3?Se.length-1:Se.length,Ze=0;Ze<ft;Ze++){Ze===1&&ne!==1&&j.writeVarint(Fe(2,ft-1));var rt=Se[Ze].x-fe,nn=Se[Ze].y-xe;j.writeVarint(qe(rt)),j.writeVarint(qe(nn)),fe+=rt,xe+=nn}ne===3&&j.writeVarint(Fe(7,1))}}function Ne(ae,j){var Z=typeof ae;Z==="string"?j.writeStringField(1,ae):Z==="boolean"?j.writeBooleanField(7,ae):Z==="number"&&(ae%1!=0?j.writeDoubleField(3,ae):ae<0?j.writeSVarintField(6,ae):j.writeVarintField(5,ae))}C.exports=K,C.exports.fromVectorTileJs=K,C.exports.fromGeojsonVt=function(ae,j){j=j||{};var Z={};for(var ne in ae)Z[ne]=new ce(ae[ne].features,j),Z[ne].name=ne,Z[ne].version=j.version,Z[ne].extent=j.extent;return K({layers:Z})},C.exports.GeoJSONWrapper=ce;var st=a.bw(C.exports);const Ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},ut=Math.fround||(ot=new Float32Array(1),ae=>(ot[0]=+ae,ot[0]));var ot;const dt=3,Ct=5,Vt=6;class Re{constructor(j){this.options=Object.assign(Object.create(Ee),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:Z,minZoom:ne,maxZoom:fe}=this.options;Z&&console.time("total time");const xe=`prepare ${j.length} points`;Z&&console.time(xe),this.points=j;const Ie=[];for(let Se=0;Se<j.length;Se++){const Ue=j[Se];if(!Ue.geometry)continue;const[ft,Ze]=Ue.geometry.coordinates,rt=ut(It(ft)),nn=ut(vn(Ze));Ie.push(rt,nn,1/0,Se,-1,1),this.options.reduce&&Ie.push(0)}let ke=this.trees[fe+1]=this._createTree(Ie);Z&&console.timeEnd(xe);for(let Se=fe;Se>=ne;Se--){const Ue=+Date.now();ke=this.trees[Se]=this._createTree(this._cluster(ke,Se)),Z&&console.log("z%d: %d clusters in %dms",Se,ke.numItems,+Date.now()-Ue)}return Z&&console.timeEnd("total time"),this}getClusters(j,Z){let ne=((j[0]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,j[1]));let xe=j[2]===180?180:((j[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)ne=-180,xe=180;else if(ne>xe){const Ze=this.getClusters([ne,fe,180,Ie],Z),rt=this.getClusters([-180,fe,xe,Ie],Z);return Ze.concat(rt)}const ke=this.trees[this._limitZoom(Z)],Se=ke.range(It(ne),vn(Ie),It(xe),vn(fe)),Ue=ke.data,ft=[];for(const Ze of Se){const rt=this.stride*Ze;ft.push(Ue[rt+Ct]>1?mt(Ue,rt,this.clusterProps):this.points[Ue[rt+dt]])}return ft}getChildren(j){const Z=this._getOriginId(j),ne=this._getOriginZoom(j),fe="No cluster with the specified id.",xe=this.trees[ne];if(!xe)throw new Error(fe);const Ie=xe.data;if(Z*this.stride>=Ie.length)throw new Error(fe);const ke=this.options.radius/(this.options.extent*Math.pow(2,ne-1)),Se=xe.within(Ie[Z*this.stride],Ie[Z*this.stride+1],ke),Ue=[];for(const ft of Se){const Ze=ft*this.stride;Ie[Ze+4]===j&&Ue.push(Ie[Ze+Ct]>1?mt(Ie,Ze,this.clusterProps):this.points[Ie[Ze+dt]])}if(Ue.length===0)throw new Error(fe);return Ue}getLeaves(j,Z,ne){const fe=[];return this._appendLeaves(fe,j,Z=Z||10,ne=ne||0,0),fe}getTile(j,Z,ne){const fe=this.trees[this._limitZoom(j)],xe=Math.pow(2,j),{extent:Ie,radius:ke}=this.options,Se=ke/Ie,Ue=(ne-Se)/xe,ft=(ne+1+Se)/xe,Ze={features:[]};return this._addTileFeatures(fe.range((Z-Se)/xe,Ue,(Z+1+Se)/xe,ft),fe.data,Z,ne,xe,Ze),Z===0&&this._addTileFeatures(fe.range(1-Se/xe,Ue,1,ft),fe.data,xe,ne,xe,Ze),Z===xe-1&&this._addTileFeatures(fe.range(0,Ue,Se/xe,ft),fe.data,-1,ne,xe,Ze),Ze.features.length?Ze:null}getClusterExpansionZoom(j){let Z=this._getOriginZoom(j)-1;for(;Z<=this.options.maxZoom;){const ne=this.getChildren(j);if(Z++,ne.length!==1)break;j=ne[0].properties.cluster_id}return Z}_appendLeaves(j,Z,ne,fe,xe){const Ie=this.getChildren(Z);for(const ke of Ie){const Se=ke.properties;if(Se&&Se.cluster?xe+Se.point_count<=fe?xe+=Se.point_count:xe=this._appendLeaves(j,Se.cluster_id,ne,fe,xe):xe<fe?xe++:j.push(ke),j.length===ne)break}return xe}_createTree(j){const Z=new a.av(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ne=0;ne<j.length;ne+=this.stride)Z.add(j[ne],j[ne+1]);return Z.finish(),Z.data=j,Z}_addTileFeatures(j,Z,ne,fe,xe,Ie){for(const ke of j){const Se=ke*this.stride,Ue=Z[Se+Ct]>1;let ft,Ze,rt;if(Ue)ft=Et(Z,Se,this.clusterProps),Ze=Z[Se],rt=Z[Se+1];else{const Hn=this.points[Z[Se+dt]];ft=Hn.properties;const[Fn,ni]=Hn.geometry.coordinates;Ze=It(Fn),rt=vn(ni)}const nn={type:1,geometry:[[Math.round(this.options.extent*(Ze*xe-ne)),Math.round(this.options.extent*(rt*xe-fe))]],tags:ft};let fn;fn=Ue||this.options.generateId?Z[Se+dt]:this.points[Z[Se+dt]].id,fn!==void 0&&(nn.id=fn),Ie.features.push(nn)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,Z){const{radius:ne,extent:fe,reduce:xe,minPoints:Ie}=this.options,ke=ne/(fe*Math.pow(2,Z)),Se=j.data,Ue=[],ft=this.stride;for(let Ze=0;Ze<Se.length;Ze+=ft){if(Se[Ze+2]<=Z)continue;Se[Ze+2]=Z;const rt=Se[Ze],nn=Se[Ze+1],fn=j.within(Se[Ze],Se[Ze+1],ke),Hn=Se[Ze+Ct];let Fn=Hn;for(const ni of fn){const wi=ni*ft;Se[wi+2]>Z&&(Fn+=Se[wi+Ct])}if(Fn>Hn&&Fn>=Ie){let ni,wi=rt*Hn,Ui=nn*Hn,yr=-1;const oe=((Ze/ft|0)<<5)+(Z+1)+this.points.length;for(const Be of fn){const Qe=Be*ft;if(Se[Qe+2]<=Z)continue;Se[Qe+2]=Z;const it=Se[Qe+Ct];wi+=Se[Qe]*it,Ui+=Se[Qe+1]*it,Se[Qe+4]=oe,xe&&(ni||(ni=this._map(Se,Ze,!0),yr=this.clusterProps.length,this.clusterProps.push(ni)),xe(ni,this._map(Se,Qe)))}Se[Ze+4]=oe,Ue.push(wi/Fn,Ui/Fn,1/0,oe,-1,Fn),xe&&Ue.push(yr)}else{for(let ni=0;ni<ft;ni++)Ue.push(Se[Ze+ni]);if(Fn>1)for(const ni of fn){const wi=ni*ft;if(!(Se[wi+2]<=Z)){Se[wi+2]=Z;for(let Ui=0;Ui<ft;Ui++)Ue.push(Se[wi+Ui])}}}}return Ue}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,Z,ne){if(j[Z+Ct]>1){const Ie=this.clusterProps[j[Z+Vt]];return ne?Object.assign({},Ie):Ie}const fe=this.points[j[Z+dt]].properties,xe=this.options.map(fe);return ne&&xe===fe?Object.assign({},xe):xe}}function mt(ae,j,Z){return{type:"Feature",id:ae[j+dt],properties:Et(ae,j,Z),geometry:{type:"Point",coordinates:[(ne=ae[j],360*(ne-.5)),xn(ae[j+1])]}};var ne}function Et(ae,j,Z){const ne=ae[j+Ct],fe=ne>=1e4?`${Math.round(ne/1e3)}k`:ne>=1e3?Math.round(ne/100)/10+"k":ne,xe=ae[j+Vt],Ie=xe===-1?{}:Object.assign({},Z[xe]);return Object.assign(Ie,{cluster:!0,cluster_id:ae[j+dt],point_count:ne,point_count_abbreviated:fe})}function It(ae){return ae/360+.5}function vn(ae){const j=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function xn(ae){const j=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function at(ae,j,Z,ne){for(var fe,xe=ne,Ie=Z-j>>1,ke=Z-j,Se=ae[j],Ue=ae[j+1],ft=ae[Z],Ze=ae[Z+1],rt=j+3;rt<Z;rt+=3){var nn=Rn(ae[rt],ae[rt+1],Se,Ue,ft,Ze);if(nn>xe)fe=rt,xe=nn;else if(nn===xe){var fn=Math.abs(rt-Ie);fn<ke&&(fe=rt,ke=fn)}}xe>ne&&(fe-j>3&&at(ae,j,fe,ne),ae[fe+2]=xe,Z-fe>3&&at(ae,fe,Z,ne))}function Rn(ae,j,Z,ne,fe,xe){var Ie=fe-Z,ke=xe-ne;if(Ie!==0||ke!==0){var Se=((ae-Z)*Ie+(j-ne)*ke)/(Ie*Ie+ke*ke);Se>1?(Z=fe,ne=xe):Se>0&&(Z+=Ie*Se,ne+=ke*Se)}return(Ie=ae-Z)*Ie+(ke=j-ne)*ke}function Me(ae,j,Z,ne){var fe={id:ae===void 0?null:ae,type:j,geometry:Z,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var Ie=xe.geometry,ke=xe.type;if(ke==="Point"||ke==="MultiPoint"||ke==="LineString")Jn(xe,Ie);else if(ke==="Polygon"||ke==="MultiLineString")for(var Se=0;Se<Ie.length;Se++)Jn(xe,Ie[Se]);else if(ke==="MultiPolygon")for(Se=0;Se<Ie.length;Se++)for(var Ue=0;Ue<Ie[Se].length;Ue++)Jn(xe,Ie[Se][Ue])}(fe),fe}function Jn(ae,j){for(var Z=0;Z<j.length;Z+=3)ae.minX=Math.min(ae.minX,j[Z]),ae.minY=Math.min(ae.minY,j[Z+1]),ae.maxX=Math.max(ae.maxX,j[Z]),ae.maxY=Math.max(ae.maxY,j[Z+1])}function on(ae,j,Z,ne){if(j.geometry){var fe=j.geometry.coordinates,xe=j.geometry.type,Ie=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),ke=[],Se=j.id;if(Z.promoteId?Se=j.properties[Z.promoteId]:Z.generateId&&(Se=ne||0),xe==="Point")Vn(fe,ke);else if(xe==="MultiPoint")for(var Ue=0;Ue<fe.length;Ue++)Vn(fe[Ue],ke);else if(xe==="LineString")Te(fe,ke,Ie,!1);else if(xe==="MultiLineString"){if(Z.lineMetrics){for(Ue=0;Ue<fe.length;Ue++)Te(fe[Ue],ke=[],Ie,!1),ae.push(Me(Se,"LineString",ke,j.properties));return}jn(fe,ke,Ie,!1)}else if(xe==="Polygon")jn(fe,ke,Ie,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(Ue=0;Ue<j.geometry.geometries.length;Ue++)on(ae,{id:Se,geometry:j.geometry.geometries[Ue],properties:j.properties},Z,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ue=0;Ue<fe.length;Ue++){var ft=[];jn(fe[Ue],ft,Ie,!0),ke.push(ft)}}ae.push(Me(Se,xe,ke,j.properties))}}function Vn(ae,j){j.push(wn(ae[0])),j.push(jt(ae[1])),j.push(0)}function Te(ae,j,Z,ne){for(var fe,xe,Ie=0,ke=0;ke<ae.length;ke++){var Se=wn(ae[ke][0]),Ue=jt(ae[ke][1]);j.push(Se),j.push(Ue),j.push(0),ke>0&&(Ie+=ne?(fe*Ue-Se*xe)/2:Math.sqrt(Math.pow(Se-fe,2)+Math.pow(Ue-xe,2))),fe=Se,xe=Ue}var ft=j.length-3;j[2]=1,at(j,0,ft,Z),j[ft+2]=1,j.size=Math.abs(Ie),j.start=0,j.end=j.size}function jn(ae,j,Z,ne){for(var fe=0;fe<ae.length;fe++){var xe=[];Te(ae[fe],xe,Z,ne),j.push(xe)}}function wn(ae){return ae/360+.5}function jt(ae){var j=Math.sin(ae*Math.PI/180),Z=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return Z<0?0:Z>1?1:Z}function me(ae,j,Z,ne,fe,xe,Ie,ke){if(ne/=j,xe>=(Z/=j)&&Ie<ne)return ae;if(Ie<Z||xe>=ne)return null;for(var Se=[],Ue=0;Ue<ae.length;Ue++){var ft=ae[Ue],Ze=ft.geometry,rt=ft.type,nn=fe===0?ft.minX:ft.minY,fn=fe===0?ft.maxX:ft.maxY;if(nn>=Z&&fn<ne)Se.push(ft);else if(!(fn<Z||nn>=ne)){var Hn=[];if(rt==="Point"||rt==="MultiPoint")le(Ze,Hn,Z,ne,fe);else if(rt==="LineString")tt(Ze,Hn,Z,ne,fe,!1,ke.lineMetrics);else if(rt==="MultiLineString")St(Ze,Hn,Z,ne,fe,!1);else if(rt==="Polygon")St(Ze,Hn,Z,ne,fe,!0);else if(rt==="MultiPolygon")for(var Fn=0;Fn<Ze.length;Fn++){var ni=[];St(Ze[Fn],ni,Z,ne,fe,!0),ni.length&&Hn.push(ni)}if(Hn.length){if(ke.lineMetrics&&rt==="LineString"){for(Fn=0;Fn<Hn.length;Fn++)Se.push(Me(ft.id,rt,Hn[Fn],ft.tags));continue}rt!=="LineString"&&rt!=="MultiLineString"||(Hn.length===1?(rt="LineString",Hn=Hn[0]):rt="MultiLineString"),rt!=="Point"&&rt!=="MultiPoint"||(rt=Hn.length===3?"Point":"MultiPoint"),Se.push(Me(ft.id,rt,Hn,ft.tags))}}}return Se.length?Se:null}function le(ae,j,Z,ne,fe){for(var xe=0;xe<ae.length;xe+=3){var Ie=ae[xe+fe];Ie>=Z&&Ie<=ne&&(j.push(ae[xe]),j.push(ae[xe+1]),j.push(ae[xe+2]))}}function tt(ae,j,Z,ne,fe,xe,Ie){for(var ke,Se,Ue=xt(ae),ft=fe===0?hn:zt,Ze=ae.start,rt=0;rt<ae.length-3;rt+=3){var nn=ae[rt],fn=ae[rt+1],Hn=ae[rt+2],Fn=ae[rt+3],ni=ae[rt+4],wi=fe===0?nn:fn,Ui=fe===0?Fn:ni,yr=!1;Ie&&(ke=Math.sqrt(Math.pow(nn-Fn,2)+Math.pow(fn-ni,2))),wi<Z?Ui>Z&&(Se=ft(Ue,nn,fn,Fn,ni,Z),Ie&&(Ue.start=Ze+ke*Se)):wi>ne?Ui<ne&&(Se=ft(Ue,nn,fn,Fn,ni,ne),Ie&&(Ue.start=Ze+ke*Se)):yt(Ue,nn,fn,Hn),Ui<Z&&wi>=Z&&(Se=ft(Ue,nn,fn,Fn,ni,Z),yr=!0),Ui>ne&&wi<=ne&&(Se=ft(Ue,nn,fn,Fn,ni,ne),yr=!0),!xe&&yr&&(Ie&&(Ue.end=Ze+ke*Se),j.push(Ue),Ue=xt(ae)),Ie&&(Ze+=ke)}var oe=ae.length-3;nn=ae[oe],fn=ae[oe+1],Hn=ae[oe+2],(wi=fe===0?nn:fn)>=Z&&wi<=ne&&yt(Ue,nn,fn,Hn),oe=Ue.length-3,xe&&oe>=3&&(Ue[oe]!==Ue[0]||Ue[oe+1]!==Ue[1])&&yt(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&j.push(Ue)}function xt(ae){var j=[];return j.size=ae.size,j.start=ae.start,j.end=ae.end,j}function St(ae,j,Z,ne,fe,xe){for(var Ie=0;Ie<ae.length;Ie++)tt(ae[Ie],j,Z,ne,fe,xe,!1)}function yt(ae,j,Z,ne){ae.push(j),ae.push(Z),ae.push(ne)}function hn(ae,j,Z,ne,fe,xe){var Ie=(xe-j)/(ne-j);return ae.push(xe),ae.push(Z+(fe-Z)*Ie),ae.push(1),Ie}function zt(ae,j,Z,ne,fe,xe){var Ie=(xe-Z)/(fe-Z);return ae.push(j+(ne-j)*Ie),ae.push(xe),ae.push(1),Ie}function Je(ae,j){for(var Z=[],ne=0;ne<ae.length;ne++){var fe,xe=ae[ne],Ie=xe.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")fe=cn(xe.geometry,j);else if(Ie==="MultiLineString"||Ie==="Polygon"){fe=[];for(var ke=0;ke<xe.geometry.length;ke++)fe.push(cn(xe.geometry[ke],j))}else if(Ie==="MultiPolygon")for(fe=[],ke=0;ke<xe.geometry.length;ke++){for(var Se=[],Ue=0;Ue<xe.geometry[ke].length;Ue++)Se.push(cn(xe.geometry[ke][Ue],j));fe.push(Se)}Z.push(Me(xe.id,Ie,fe,xe.tags))}return Z}function cn(ae,j){var Z=[];Z.size=ae.size,ae.start!==void 0&&(Z.start=ae.start,Z.end=ae.end);for(var ne=0;ne<ae.length;ne+=3)Z.push(ae[ne]+j,ae[ne+1],ae[ne+2]);return Z}function At(ae,j){if(ae.transformed)return ae;var Z,ne,fe,xe=1<<ae.z,Ie=ae.x,ke=ae.y;for(Z=0;Z<ae.features.length;Z++){var Se=ae.features[Z],Ue=Se.geometry,ft=Se.type;if(Se.geometry=[],ft===1)for(ne=0;ne<Ue.length;ne+=2)Se.geometry.push(tn(Ue[ne],Ue[ne+1],j,xe,Ie,ke));else for(ne=0;ne<Ue.length;ne++){var Ze=[];for(fe=0;fe<Ue[ne].length;fe+=2)Ze.push(tn(Ue[ne][fe],Ue[ne][fe+1],j,xe,Ie,ke));Se.geometry.push(Ze)}}return ae.transformed=!0,ae}function tn(ae,j,Z,ne,fe,xe){return[Math.round(Z*(ae*ne-fe)),Math.round(Z*(j*ne-xe))]}function Zn(ae,j,Z,ne,fe){for(var xe=j===fe.maxZoom?0:fe.tolerance/((1<<j)*fe.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:ne,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ke=0;ke<ae.length;ke++){Ie.numFeatures++,lt(Ie,ae[ke],xe,fe);var Se=ae[ke].minX,Ue=ae[ke].minY,ft=ae[ke].maxX,Ze=ae[ke].maxY;Se<Ie.minX&&(Ie.minX=Se),Ue<Ie.minY&&(Ie.minY=Ue),ft>Ie.maxX&&(Ie.maxX=ft),Ze>Ie.maxY&&(Ie.maxY=Ze)}return Ie}function lt(ae,j,Z,ne){var fe=j.geometry,xe=j.type,Ie=[];if(xe==="Point"||xe==="MultiPoint")for(var ke=0;ke<fe.length;ke+=3)Ie.push(fe[ke]),Ie.push(fe[ke+1]),ae.numPoints++,ae.numSimplified++;else if(xe==="LineString")Mt(Ie,fe,ae,Z,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(ke=0;ke<fe.length;ke++)Mt(Ie,fe[ke],ae,Z,xe==="Polygon",ke===0);else if(xe==="MultiPolygon")for(var Se=0;Se<fe.length;Se++){var Ue=fe[Se];for(ke=0;ke<Ue.length;ke++)Mt(Ie,Ue[ke],ae,Z,!0,ke===0)}if(Ie.length){var ft=j.tags||null;if(xe==="LineString"&&ne.lineMetrics){for(var Ze in ft={},j.tags)ft[Ze]=j.tags[Ze];ft.mapbox_clip_start=fe.start/fe.size,ft.mapbox_clip_end=fe.end/fe.size}var rt={geometry:Ie,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:ft};j.id!==null&&(rt.id=j.id),ae.features.push(rt)}}function Mt(ae,j,Z,ne,fe,xe){var Ie=ne*ne;if(ne>0&&j.size<(fe?Ie:ne))Z.numPoints+=j.length/3;else{for(var ke=[],Se=0;Se<j.length;Se+=3)(ne===0||j[Se+2]>Ie)&&(Z.numSimplified++,ke.push(j[Se]),ke.push(j[Se+1])),Z.numPoints++;fe&&function(Ue,ft){for(var Ze=0,rt=0,nn=Ue.length,fn=nn-2;rt<nn;fn=rt,rt+=2)Ze+=(Ue[rt]-Ue[fn])*(Ue[rt+1]+Ue[fn+1]);if(Ze>0===ft)for(rt=0,nn=Ue.length;rt<nn/2;rt+=2){var Hn=Ue[rt],Fn=Ue[rt+1];Ue[rt]=Ue[nn-2-rt],Ue[rt+1]=Ue[nn-1-rt],Ue[nn-2-rt]=Hn,Ue[nn-1-rt]=Fn}}(ke,xe),ae.push(ke)}}function kt(ae,j){var Z=(j=this.options=function(fe,xe){for(var Ie in xe)fe[Ie]=xe[Ie];return fe}(Object.create(this.options),j)).debug;if(Z&&console.time("preprocess data"),j.maxZoom<0||j.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(j.promoteId&&j.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne=function(fe,xe){var Ie=[];if(fe.type==="FeatureCollection")for(var ke=0;ke<fe.features.length;ke++)on(Ie,fe.features[ke],xe,ke);else on(Ie,fe.type==="Feature"?fe:{geometry:fe},xe);return Ie}(ae,j);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",j.indexMaxZoom,j.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ne=function(fe,xe){var Ie=xe.buffer/xe.extent,ke=fe,Se=me(fe,1,-1-Ie,Ie,0,-1,2,xe),Ue=me(fe,1,1-Ie,2+Ie,0,-1,2,xe);return(Se||Ue)&&(ke=me(fe,1,-Ie,1+Ie,0,-1,2,xe)||[],Se&&(ke=Je(Se,1).concat(ke)),Ue&&(ke=ke.concat(Je(Ue,-1)))),ke}(ne,j),ne.length&&this.splitTile(ne,0,0,0),Z&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function In(ae,j,Z){return 32*((1<<ae)*Z+j)+ae}function ii(ae,j){return j?ae.properties[j]:ae.id}function Ae(ae,j){if(ae==null)return!0;if(ae.type==="Feature")return ii(ae,j)!=null;if(ae.type==="FeatureCollection"){const Z=new Set;for(const ne of ae.features){const fe=ii(ne,j);if(fe==null||Z.has(fe))return!1;Z.add(fe)}return!0}return!1}function Lt(ae,j){const Z=new Map;if(ae!=null)if(ae.type==="Feature")Z.set(ii(ae,j),ae);else for(const ne of ae.features)Z.set(ii(ne,j),ne);return Z}kt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},kt.prototype.splitTile=function(ae,j,Z,ne,fe,xe,Ie){for(var ke=[ae,j,Z,ne],Se=this.options,Ue=Se.debug;ke.length;){ne=ke.pop(),Z=ke.pop(),j=ke.pop(),ae=ke.pop();var ft=1<<j,Ze=In(j,Z,ne),rt=this.tiles[Ze];if(!rt&&(Ue>1&&console.time("creation"),rt=this.tiles[Ze]=Zn(ae,j,Z,ne,Se),this.tileCoords.push({z:j,x:Z,y:ne}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",j,Z,ne,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));var nn="z"+j;this.stats[nn]=(this.stats[nn]||0)+1,this.total++}if(rt.source=ae,fe){if(j===Se.maxZoom||j===fe)continue;var fn=1<<fe-j;if(Z!==Math.floor(xe/fn)||ne!==Math.floor(Ie/fn))continue}else if(j===Se.indexMaxZoom||rt.numPoints<=Se.indexMaxPoints)continue;if(rt.source=null,ae.length!==0){Ue>1&&console.time("clipping");var Hn,Fn,ni,wi,Ui,yr,oe=.5*Se.buffer/Se.extent,Be=.5-oe,Qe=.5+oe,it=1+oe;Hn=Fn=ni=wi=null,Ui=me(ae,ft,Z-oe,Z+Qe,0,rt.minX,rt.maxX,Se),yr=me(ae,ft,Z+Be,Z+it,0,rt.minX,rt.maxX,Se),ae=null,Ui&&(Hn=me(Ui,ft,ne-oe,ne+Qe,1,rt.minY,rt.maxY,Se),Fn=me(Ui,ft,ne+Be,ne+it,1,rt.minY,rt.maxY,Se),Ui=null),yr&&(ni=me(yr,ft,ne-oe,ne+Qe,1,rt.minY,rt.maxY,Se),wi=me(yr,ft,ne+Be,ne+it,1,rt.minY,rt.maxY,Se),yr=null),Ue>1&&console.timeEnd("clipping"),ke.push(Hn||[],j+1,2*Z,2*ne),ke.push(Fn||[],j+1,2*Z,2*ne+1),ke.push(ni||[],j+1,2*Z+1,2*ne),ke.push(wi||[],j+1,2*Z+1,2*ne+1)}}},kt.prototype.getTile=function(ae,j,Z){var ne=this.options,fe=ne.extent,xe=ne.debug;if(ae<0||ae>24)return null;var Ie=1<<ae,ke=In(ae,j=(j%Ie+Ie)%Ie,Z);if(this.tiles[ke])return At(this.tiles[ke],fe);xe>1&&console.log("drilling down to z%d-%d-%d",ae,j,Z);for(var Se,Ue=ae,ft=j,Ze=Z;!Se&&Ue>0;)Ue--,ft=Math.floor(ft/2),Ze=Math.floor(Ze/2),Se=this.tiles[In(Ue,ft,Ze)];return Se&&Se.source?(xe>1&&console.log("found parent tile z%d-%d-%d",Ue,ft,Ze),xe>1&&console.time("drilling down"),this.splitTile(Se.source,Ue,ft,Ze,ae,j,Z),xe>1&&console.timeEnd("drilling down"),this.tiles[ke]?At(this.tiles[ke],fe):null):null};class gt extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,Z){return a._(this,void 0,void 0,function*(){const ne=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const fe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!fe)return null;const xe=new class{constructor(ke){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.W,this.length=ke.length,this._features=ke}feature(ke){return new class{constructor(Se){this._feature=Se,this.extent=a.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const Ue of this._feature.geometry)Se.push([new a.P(Ue[0],Ue[1])]);return Se}{const Se=[];for(const Ue of this._feature.geometry){const ft=[];for(const Ze of Ue)ft.push(new a.P(Ze[0],Ze[1]));Se.push(ft)}return Se}}toGeoJSON(Se,Ue,ft){return P.call(this,Se,Ue,ft)}}(this._features[ke])}}(fe.features);let Ie=st(xe);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:xe,rawData:Ie.buffer}})}loadData(j){return a._(this,void 0,void 0,function*(){var Z;(Z=this._pendingRequest)===null||Z===void 0||Z.abort();const ne=!!(j&&j.request&&j.request.collectResourceTiming)&&new a.bt(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest),this._geoJSONIndex=j.cluster?new Re(function({superclusterOptions:xe,clusterProperties:Ie}){if(!Ie||!xe)return xe;const ke={},Se={},Ue={accumulated:null,zoom:0},ft={properties:null},Ze=Object.keys(Ie);for(const rt of Ze){const[nn,fn]=Ie[rt],Hn=a.bA(fn),Fn=a.bA(typeof nn=="string"?[nn,["accumulated"],["get",rt]]:nn);ke[rt]=Hn.value,Se[rt]=Fn.value}return xe.map=rt=>{ft.properties=rt;const nn={};for(const fn of Ze)nn[fn]=ke[fn].evaluate(Ue,ft);return nn},xe.reduce=(rt,nn)=>{ft.properties=nn;for(const fn of Ze)Ue.accumulated=rt[fn],rt[fn]=Se[fn].evaluate(Ue,ft)},xe}(j)).load((yield this._pendingData).features):new kt(yield this._pendingData,j.geojsonVtOptions),this.loaded={};const fe={};if(ne){const xe=ne.finish();xe&&(fe.resourceTiming={},fe.resourceTiming[j.source]=JSON.parse(JSON.stringify(xe)))}return fe}catch(fe){if(delete this._pendingRequest,a.bz(fe))return{abandoned:!0};throw fe}})}getData(){return a._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(j){const Z=this.loaded;return Z&&Z[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,Z){return a._(this,void 0,void 0,function*(){let ne=yield this.loadGeoJSON(j,Z);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(L(ne,!0),j.filter){const fe=a.bA(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(fe.result==="error")throw new Error(fe.value.map(Ie=>`${Ie.key}: ${Ie.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(Ie=>fe.value.evaluate({zoom:0},Ie))}}return ne})}loadGeoJSON(j,Z){return a._(this,void 0,void 0,function*(){const{promoteId:ne}=j;if(j.request){const fe=yield a.h(j.request,Z);return this._dataUpdateable=Ae(fe.data,ne)?Lt(fe.data,ne):void 0,fe.data}if(typeof j.data=="string")try{const fe=JSON.parse(j.data);return this._dataUpdateable=Ae(fe,ne)?Lt(fe,ne):void 0,fe}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return function(fe,xe,Ie){var ke,Se,Ue,ft;if(xe.removeAll&&fe.clear(),xe.remove)for(const Ze of xe.remove)fe.delete(Ze);if(xe.add)for(const Ze of xe.add){const rt=ii(Ze,Ie);rt!=null&&fe.set(rt,Ze)}if(xe.update)for(const Ze of xe.update){let rt=fe.get(Ze.id);if(rt==null)continue;const nn=!Ze.removeAllProperties&&(((ke=Ze.removeProperties)===null||ke===void 0?void 0:ke.length)>0||((Se=Ze.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Ze.newGeometry||Ze.removeAllProperties||nn)&&(rt=Object.assign({},rt),fe.set(Ze.id,rt),nn&&(rt.properties=Object.assign({},rt.properties))),Ze.newGeometry&&(rt.geometry=Ze.newGeometry),Ze.removeAllProperties)rt.properties={};else if(((Ue=Ze.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const fn of Ze.removeProperties)Object.prototype.hasOwnProperty.call(rt.properties,fn)&&delete rt.properties[fn];if(((ft=Ze.addOrUpdateProperties)===null||ft===void 0?void 0:ft.length)>0)for(const{key:fn,value:Hn}of Ze.addOrUpdateProperties)rt.properties[fn]=Hn}}(this._dataUpdateable,j.dataDiff,ne),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(j){return a._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class ht{constructor(j){this.self=j,this.actor=new a.C(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Z,ne)=>{if(this.externalWorkerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.externalWorkerSourceTypes[Z]=ne},this.self.addProtocol=a.bg,this.self.removeProtocol=a.bh,this.self.registerRTLTextPlugin=Z=>{if(a.bB.isParsed())throw new Error("RTL text plugin already registered.");a.bB.setMethods(Z)},this.actor.registerMessageHandler("LDT",(Z,ne)=>this._getDEMWorkerSource(Z,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RDT",(Z,ne)=>a._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Z,ne.source).removeTile(ne)})),this.actor.registerMessageHandler("GCEZ",(Z,ne)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,ne.type,ne.source).getClusterExpansionZoom(ne)})),this.actor.registerMessageHandler("GCC",(Z,ne)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,ne.type,ne.source).getClusterChildren(ne)})),this.actor.registerMessageHandler("GCL",(Z,ne)=>a._(this,void 0,void 0,function*(){return this._getWorkerSource(Z,ne.type,ne.source).getClusterLeaves(ne)})),this.actor.registerMessageHandler("LD",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).loadData(ne)),this.actor.registerMessageHandler("GD",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).getData()),this.actor.registerMessageHandler("LT",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).loadTile(ne)),this.actor.registerMessageHandler("RT",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).reloadTile(ne)),this.actor.registerMessageHandler("AT",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).abortTile(ne)),this.actor.registerMessageHandler("RMT",(Z,ne)=>this._getWorkerSource(Z,ne.type,ne.source).removeTile(ne)),this.actor.registerMessageHandler("RS",(Z,ne)=>a._(this,void 0,void 0,function*(){if(!this.workerSources[Z]||!this.workerSources[Z][ne.type]||!this.workerSources[Z][ne.type][ne.source])return;const fe=this.workerSources[Z][ne.type][ne.source];delete this.workerSources[Z][ne.type][ne.source],fe.removeSource!==void 0&&fe.removeSource(ne)})),this.actor.registerMessageHandler("RM",Z=>a._(this,void 0,void 0,function*(){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z]})),this.actor.registerMessageHandler("SR",(Z,ne)=>a._(this,void 0,void 0,function*(){this.referrer=ne})),this.actor.registerMessageHandler("SRPS",(Z,ne)=>this._syncRTLPluginState(Z,ne)),this.actor.registerMessageHandler("IS",(Z,ne)=>a._(this,void 0,void 0,function*(){this.self.importScripts(ne)})),this.actor.registerMessageHandler("SI",(Z,ne)=>this._setImages(Z,ne)),this.actor.registerMessageHandler("UL",(Z,ne)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Z).update(ne.layers,ne.removedIds)})),this.actor.registerMessageHandler("SL",(Z,ne)=>a._(this,void 0,void 0,function*(){this._getLayerIndex(Z).replace(ne)}))}_setImages(j,Z){return a._(this,void 0,void 0,function*(){this.availableImages[j]=Z;for(const ne in this.workerSources[j]){const fe=this.workerSources[j][ne];for(const xe in fe)fe[xe].availableImages=Z}})}_syncRTLPluginState(j,Z){return a._(this,void 0,void 0,function*(){if(a.bB.isParsed())return a.bB.getState();if(Z.pluginStatus!=="loading")return a.bB.setState(Z),Z;const ne=Z.pluginURL;if(this.self.importScripts(ne),a.bB.isParsed()){const fe={pluginStatus:"loaded",pluginURL:ne};return a.bB.setState(fe),fe}throw a.bB.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ne}`)})}_getAvailableImages(j){let Z=this.availableImages[j];return Z||(Z=[]),Z}_getLayerIndex(j){let Z=this.layerIndexes[j];return Z||(Z=this.layerIndexes[j]=new o),Z}_getWorkerSource(j,Z,ne){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][Z]||(this.workerSources[j][Z]={}),!this.workerSources[j][Z][ne]){const fe={sendAsync:(xe,Ie)=>(xe.targetMapId=j,this.actor.sendAsync(xe,Ie))};switch(Z){case"vector":this.workerSources[j][Z][ne]=new _(fe,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][Z][ne]=new gt(fe,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][Z][ne]=new this.externalWorkerSourceTypes[Z](fe,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][Z][ne]}_getDEMWorkerSource(j,Z){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][Z]||(this.demWorkerSources[j][Z]=new w),this.demWorkerSources[j][Z]}}return a.i(self)&&(self.worker=new ht(self)),ht}),r("index",["exports","./shared"],function(a,o){var d="4.4.0";let p,g;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:S=>new Promise((c,f)=>{const y=requestAnimationFrame(c);S.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),f(o.c())})}),getImageData(S,c=0){return this.getImageCanvasContext(S).getImageData(-c,-c,S.width+2*c,S.height+2*c)},getImageCanvasContext(S){const c=window.document.createElement("canvas"),f=c.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return c.width=S.width,c.height=S.height,f.drawImage(S,0,0,S.width,S.height),f},resolveURL:S=>(p||(p=document.createElement("a")),p.href=S,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class w{static testProp(c){if(!w.docStyle)return c[0];for(let f=0;f<c.length;f++)if(c[f]in w.docStyle)return c[f];return c[0]}static create(c,f,y){const x=window.document.createElement(c);return f!==void 0&&(x.className=f),y&&y.appendChild(x),x}static createNS(c,f){return window.document.createElementNS(c,f)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(c,f){c.style[w.transformProp]=f}static addEventListener(c,f,y,x={}){c.addEventListener(f,y,"passive"in x?x:x.capture)}static removeEventListener(c,f,y,x={}){c.removeEventListener(f,y,"passive"in x?x:x.capture)}static suppressClickInternal(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static getScale(c){const f=c.getBoundingClientRect();return{x:f.width/c.offsetWidth||1,y:f.height/c.offsetHeight||1,boundingClientRect:f}}static getPoint(c,f,y){const x=f.boundingClientRect;return new o.P((y.clientX-x.left)/f.x-c.clientLeft,(y.clientY-x.top)/f.y-c.clientTop)}static mousePos(c,f){const y=w.getScale(c);return w.getPoint(c,y,f)}static touchPos(c,f){const y=[],x=w.getScale(c);for(let M=0;M<f.length;M++)y.push(w.getPoint(c,x,f[M]));return y}static mouseButton(c){return c.button}static remove(c){c.parentNode&&c.parentNode.removeChild(c)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(S){!P&&L&&(C?O(S):I=S)}};let I,L,P=!1,C=!1;function O(S){const c=S.createTexture();S.bindTexture(S.TEXTURE_2D,c);try{if(S.texImage2D(S.TEXTURE_2D,0,S.RGBA,S.RGBA,S.UNSIGNED_BYTE,L),S.isContextLost())return;T.supported=!0}catch{}S.deleteTexture(c),P=!0}var z;typeof document<"u"&&(L=document.createElement("img"),L.onload=()=>{I&&O(I),I=null,C=!0},L.onerror=()=>{P=!0,I=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(S){let c,f,y,x;S.resetRequestQueue=()=>{c=[],f=0,y=0,x={}},S.addThrottleControl=N=>{const G=y++;return x[G]=N,G},S.removeThrottleControl=N=>{delete x[N],D()},S.getImage=(N,G,q=!0)=>new Promise(($,re)=>{T.supported&&(N.headers||(N.headers={}),N.headers.accept="image/webp,*/*"),o.e(N,{type:"image"}),c.push({abortController:G,requestParameters:N,supportImageRefresh:q,state:"queued",onError:ue=>{re(ue)},onSuccess:ue=>{$(ue)}}),D()});const M=N=>o._(this,void 0,void 0,function*(){N.state="running";const{requestParameters:G,supportImageRefresh:q,onError:$,onSuccess:re,abortController:ue}=N,de=q===!1&&!o.i(self)&&!o.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce((Ce,Oe)=>Ce&&Oe==="accept",!0));f++;const we=de?F(G,ue):o.m(G,ue);try{const Ce=yield we;delete N.abortController,N.state="completed",Ce.data instanceof HTMLImageElement||o.b(Ce.data)?re(Ce):Ce.data&&re({data:yield(ge=Ce.data,typeof createImageBitmap=="function"?o.d(ge):o.f(ge)),cacheControl:Ce.cacheControl,expires:Ce.expires})}catch(Ce){delete N.abortController,$(Ce)}finally{f--,D()}var ge}),D=()=>{const N=(()=>{for(const G of Object.keys(x))if(x[G]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=f;G<N&&c.length>0;G++){const q=c.shift();q.abortController.signal.aborted?G--:M(q)}},F=(N,G)=>new Promise((q,$)=>{const re=new Image,ue=N.url,de=N.credentials;de&&de==="include"?re.crossOrigin="use-credentials":(de&&de==="same-origin"||!o.s(ue))&&(re.crossOrigin="anonymous"),G.signal.addEventListener("abort",()=>{re.src="",$(o.c())}),re.fetchPriority="high",re.onload=()=>{re.onerror=re.onload=null,q({data:re})},re.onerror=()=>{re.onerror=re.onload=null,G.signal.aborted||$(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},re.src=ue})}(z||(z={})),z.resetRequestQueue();class H{constructor(c){this._transformRequestFn=c}transformRequest(c,f){return this._transformRequestFn&&this._transformRequestFn(c,f)||{url:c}}setTransformRequest(c){this._transformRequestFn=c}}function Y(S){var c=new o.A(3);return c[0]=S[0],c[1]=S[1],c[2]=S[2],c}var ee,te=function(S,c,f){return S[0]=c[0]-f[0],S[1]=c[1]-f[1],S[2]=c[2]-f[2],S};ee=new o.A(3),o.A!=Float32Array&&(ee[0]=0,ee[1]=0,ee[2]=0);var ce=function(S){var c=S[0],f=S[1];return c*c+f*f};function K(S){const c=[];if(typeof S=="string")c.push({id:"default",url:S});else if(S&&S.length>0){const f=[];for(const{id:y,url:x}of S){const M=`${y}${x}`;f.indexOf(M)===-1&&(f.push(M),c.push({id:y,url:x}))}}return c}function Q(S,c,f){const y=S.split("?");return y[0]+=`${c}${f}`,y.join("?")}(function(){var S=new o.A(2);o.A!=Float32Array&&(S[0]=0,S[1]=0)})();class pe{constructor(c,f,y,x){this.context=c,this.format=y,this.texture=c.gl.createTexture(),this.update(f,x)}update(c,f,y){const{width:x,height:M}=c,D=!(this.size&&this.size[0]===x&&this.size[1]===M||y),{context:F}=this,{gl:N}=F;if(this.useMipmap=!!(f&&f.useMipmap),N.bindTexture(N.TEXTURE_2D,this.texture),F.pixelStoreUnpackFlipY.set(!1),F.pixelStoreUnpack.set(1),F.pixelStoreUnpackPremultiplyAlpha.set(this.format===N.RGBA&&(!f||f.premultiply!==!1)),D)this.size=[x,M],c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?N.texImage2D(N.TEXTURE_2D,0,this.format,this.format,N.UNSIGNED_BYTE,c):N.texImage2D(N.TEXTURE_2D,0,this.format,x,M,0,this.format,N.UNSIGNED_BYTE,c.data);else{const{x:G,y:q}=y||{x:0,y:0};c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement||c instanceof ImageData||o.b(c)?N.texSubImage2D(N.TEXTURE_2D,0,G,q,N.RGBA,N.UNSIGNED_BYTE,c):N.texSubImage2D(N.TEXTURE_2D,0,G,q,x,M,N.RGBA,N.UNSIGNED_BYTE,c.data)}this.useMipmap&&this.isSizePowerOfTwo()&&N.generateMipmap(N.TEXTURE_2D)}bind(c,f,y){const{context:x}=this,{gl:M}=x;M.bindTexture(M.TEXTURE_2D,this.texture),y!==M.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=M.LINEAR),c!==this.filter&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,c),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,y||c),this.filter=c),f!==this.wrap&&(M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_S,f),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}}function ze(S){const{userImage:c}=S;return!!(c&&c.render&&c.render())&&(S.data.replace(new Uint8Array(c.data.buffer)),!0)}class Fe extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(c){if(this.loaded!==c&&(this.loaded=c,c)){for(const{ids:f,promiseResolve:y}of this.requestors)y(this._getImagesForIds(f));this.requestors=[]}}getImage(c){const f=this.images[c];if(f&&!f.data&&f.spriteData){const y=f.spriteData;f.data=new o.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),f.spriteData=null}return f}addImage(c,f){if(this.images[c])throw new Error(`Image id ${c} already exist, use updateImage instead`);this._validate(c,f)&&(this.images[c]=f)}_validate(c,f){let y=!0;const x=f.data||f.spriteData;return this._validateStretch(f.stretchX,x&&x.width)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchX" value`))),y=!1),this._validateStretch(f.stretchY,x&&x.height)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "stretchY" value`))),y=!1),this._validateContent(f.content,f)||(this.fire(new o.j(new Error(`Image "${c}" has invalid "content" value`))),y=!1),y}_validateStretch(c,f){if(!c)return!0;let y=0;for(const x of c){if(x[0]<y||x[1]<x[0]||f<x[1])return!1;y=x[1]}return!0}_validateContent(c,f){if(!c)return!0;if(c.length!==4)return!1;const y=f.spriteData,x=y&&y.width||f.data.width,M=y&&y.height||f.data.height;return!(c[0]<0||x<c[0]||c[1]<0||M<c[1]||c[2]<0||x<c[2]||c[3]<0||M<c[3]||c[2]<c[0]||c[3]<c[1])}updateImage(c,f,y=!0){const x=this.getImage(c);if(y&&(x.data.width!==f.data.width||x.data.height!==f.data.height))throw new Error(`size mismatch between old image (${x.data.width}x${x.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=x.version+1,this.images[c]=f,this.updatedImages[c]=!0}removeImage(c){const f=this.images[c];delete this.images[c],delete this.patterns[c],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(c){return new Promise((f,y)=>{let x=!0;if(!this.isLoaded())for(const M of c)this.images[M]||(x=!1);this.isLoaded()||x?f(this._getImagesForIds(c)):this.requestors.push({ids:c,promiseResolve:f})})}_getImagesForIds(c){const f={};for(const y of c){let x=this.getImage(y);x||(this.fire(new o.k("styleimagemissing",{id:y})),x=this.getImage(y)),x?f[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,textFitWidth:x.textFitWidth,textFitHeight:x.textFitHeight,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:o.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:c,height:f}=this.atlasImage;return{width:c,height:f}}getPattern(c){const f=this.patterns[c],y=this.getImage(c);if(!y)return null;if(f&&f.position.version===y.version)return f.position;if(f)f.position.version=y.version;else{const x={w:y.data.width+2,h:y.data.height+2,x:0,y:0},M=new o.I(x,y);this.patterns[c]={bin:x,position:M}}return this._updatePatternAtlas(),this.patterns[c].position}bind(c){const f=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new pe(c,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const c=[];for(const M in this.patterns)c.push(this.patterns[M].bin);const{w:f,h:y}=o.p(c),x=this.atlasImage;x.resize({width:f||1,height:y||1});for(const M in this.patterns){const{bin:D}=this.patterns[M],F=D.x+1,N=D.y+1,G=this.getImage(M).data,q=G.width,$=G.height;o.R.copy(G,x,{x:0,y:0},{x:F,y:N},{width:q,height:$}),o.R.copy(G,x,{x:0,y:$-1},{x:F,y:N-1},{width:q,height:1}),o.R.copy(G,x,{x:0,y:0},{x:F,y:N+$},{width:q,height:1}),o.R.copy(G,x,{x:q-1,y:0},{x:F-1,y:N},{width:1,height:$}),o.R.copy(G,x,{x:0,y:0},{x:F+q,y:N},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(c){for(const f of c){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const y=this.getImage(f);y||o.w(`Image with ID: "${f}" was not found`),ze(y)&&this.updateImage(f,y)}}}const qe=1e20;function et(S,c,f,y,x,M,D,F,N){for(let G=c;G<c+y;G++)Ne(S,f*M+G,M,x,D,F,N);for(let G=f;G<f+x;G++)Ne(S,G*M+c,1,y,D,F,N)}function Ne(S,c,f,y,x,M,D){M[0]=0,D[0]=-qe,D[1]=qe,x[0]=S[c];for(let F=1,N=0,G=0;F<y;F++){x[F]=S[c+F*f];const q=F*F;do{const $=M[N];G=(x[F]-x[$]+q-$*$)/(F-$)/2}while(G<=D[N]&&--N>-1);N++,M[N]=F,D[N]=G,D[N+1]=qe}for(let F=0,N=0;F<y;F++){for(;D[N+1]<F;)N++;const G=M[N],q=F-G;S[c+F*f]=x[G]+q*q}}class st{constructor(c,f){this.requestManager=c,this.localIdeographFontFamily=f,this.entries={}}setURL(c){this.url=c}getGlyphs(c){return o._(this,void 0,void 0,function*(){const f=[];for(const M in c)for(const D of c[M])f.push(this._getAndCacheGlyphsPromise(M,D));const y=yield Promise.all(f),x={};for(const{stack:M,id:D,glyph:F}of y)x[M]||(x[M]={}),x[M][D]=F&&{id:F.id,bitmap:F.bitmap.clone(),metrics:F.metrics};return x})}_getAndCacheGlyphsPromise(c,f){return o._(this,void 0,void 0,function*(){let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{}});let x=y.glyphs[f];if(x!==void 0)return{stack:c,id:f,glyph:x};if(x=this._tinySDF(y,c,f),x)return y.glyphs[f]=x,{stack:c,id:f,glyph:x};const M=Math.floor(f/256);if(256*M>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[M])return{stack:c,id:f,glyph:x};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[M]){const F=st.loadGlyphRange(c,M,this.url,this.requestManager);y.requests[M]=F}const D=yield y.requests[M];for(const F in D)this._doesCharSupportLocalGlyph(+F)||(y.glyphs[+F]=D[+F]);return y.ranges[M]=!0,{stack:c,id:f,glyph:D[f]||null}})}_doesCharSupportLocalGlyph(c){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](c)||o.u["Hangul Syllables"](c)||o.u.Hiragana(c)||o.u.Katakana(c))}_tinySDF(c,f,y){const x=this.localIdeographFontFamily;if(!x||!this._doesCharSupportLocalGlyph(y))return;let M=c.tinySDF;if(!M){let F="400";/bold/i.test(f)?F="900":/medium/i.test(f)?F="500":/light/i.test(f)&&(F="200"),M=c.tinySDF=new st.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:x,fontWeight:F})}const D=M.draw(String.fromCharCode(y));return{id:y,bitmap:new o.o({width:D.width||60,height:D.height||60},D.data),metrics:{width:D.glyphWidth/2||24,height:D.glyphHeight/2||24,left:D.glyphLeft/2+.5||0,top:D.glyphTop/2-27.5||-8,advance:D.glyphAdvance/2||24,isDoubleResolution:!0}}}}st.loadGlyphRange=function(S,c,f,y){return o._(this,void 0,void 0,function*(){const x=256*c,M=x+255,D=y.transformRequest(f.replace("{fontstack}",S).replace("{range}",`${x}-${M}`),"Glyphs"),F=yield o.l(D,new AbortController);if(!F||!F.data)throw new Error(`Could not load glyph range. range: ${c}, ${x}-${M}`);const N={};for(const G of o.n(F.data))N[G.id]=G;return N})},st.TinySDF=class{constructor({fontSize:S=24,buffer:c=3,radius:f=8,cutoff:y=.25,fontFamily:x="sans-serif",fontWeight:M="normal",fontStyle:D="normal"}={}){this.buffer=c,this.cutoff=y,this.radius=f;const F=this.size=S+4*c,N=this._createCanvas(F),G=this.ctx=N.getContext("2d",{willReadFrequently:!0});G.font=`${D} ${M} ${S}px ${x}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(F*F),this.gridInner=new Float64Array(F*F),this.f=new Float64Array(F),this.z=new Float64Array(F+1),this.v=new Uint16Array(F)}_createCanvas(S){const c=document.createElement("canvas");return c.width=c.height=S,c}draw(S){const{width:c,actualBoundingBoxAscent:f,actualBoundingBoxDescent:y,actualBoundingBoxLeft:x,actualBoundingBoxRight:M}=this.ctx.measureText(S),D=Math.ceil(f),F=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(M-x))),N=Math.min(this.size-this.buffer,D+Math.ceil(y)),G=F+2*this.buffer,q=N+2*this.buffer,$=Math.max(G*q,0),re=new Uint8ClampedArray($),ue={data:re,width:G,height:q,glyphWidth:F,glyphHeight:N,glyphTop:D,glyphLeft:0,glyphAdvance:c};if(F===0||N===0)return ue;const{ctx:de,buffer:we,gridInner:ge,gridOuter:Ce}=this;de.clearRect(we,we,F,N),de.fillText(S,we,we+D);const Oe=de.getImageData(we,we,F,N);Ce.fill(qe,0,$),ge.fill(0,0,$);for(let ye=0;ye<N;ye++)for(let Ve=0;Ve<F;Ve++){const Xe=Oe.data[4*(ye*F+Ve)+3]/255;if(Xe===0)continue;const nt=(ye+we)*G+Ve+we;if(Xe===1)Ce[nt]=0,ge[nt]=qe;else{const _t=.5-Xe;Ce[nt]=_t>0?_t*_t:0,ge[nt]=_t<0?_t*_t:0}}et(Ce,0,0,G,q,G,this.f,this.v,this.z),et(ge,we,we,F,N,G,this.f,this.v,this.z);for(let ye=0;ye<$;ye++){const Ve=Math.sqrt(Ce[ye])-Math.sqrt(ge[ye]);re[ye]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return ue}};class Ee{constructor(){this.specification=o.v.light.position}possiblyEvaluate(c,f){return o.y(c.expression.evaluate(f))}interpolate(c,f,y){return{x:o.z.number(c.x,f.x,y),y:o.z.number(c.y,f.y,y),z:o.z.number(c.z,f.z,y)}}}let ut;class ot extends o.E{constructor(c){super(),ut=ut||new o.q({anchor:new o.D(o.v.light.anchor),position:new Ee,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(ut),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,f={}){if(!this._validate(o.r,c,f))for(const y in c){const x=c[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),x):this._transitionable.setValue(y,x)}}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,y){return(!y||y.validate!==!1)&&o.t(this,c.call(o.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}class dt{constructor(c,f){this.width=c,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(c,f){const y=c.join(",")+String(f);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(c,f)),this.dashEntry[y]}getDashRanges(c,f,y){const x=[];let M=c.length%2==1?-c[c.length-1]*y:0,D=c[0]*y,F=!0;x.push({left:M,right:D,isDash:F,zeroLength:c[0]===0});let N=c[0];for(let G=1;G<c.length;G++){F=!F;const q=c[G];M=N*y,N+=q,D=N*y,x.push({left:M,right:D,isDash:F,zeroLength:q===0})}return x}addRoundDash(c,f,y){const x=f/2;for(let M=-y;M<=y;M++){const D=this.width*(this.nextRow+y+M);let F=0,N=c[F];for(let G=0;G<this.width;G++){G/N.right>1&&(N=c[++F]);const q=Math.abs(G-N.left),$=Math.abs(G-N.right),re=Math.min(q,$);let ue;const de=M/y*(x+1);if(N.isDash){const we=x-Math.abs(de);ue=Math.sqrt(re*re+we*we)}else ue=x-Math.sqrt(re*re+de*de);this.data[D+G]=Math.max(0,Math.min(255,ue+128))}}}addRegularDash(c){for(let F=c.length-1;F>=0;--F){const N=c[F],G=c[F+1];N.zeroLength?c.splice(F,1):G&&G.isDash===N.isDash&&(G.left=N.left,c.splice(F,1))}const f=c[0],y=c[c.length-1];f.isDash===y.isDash&&(f.left=y.left-this.width,y.right=f.right+this.width);const x=this.width*this.nextRow;let M=0,D=c[M];for(let F=0;F<this.width;F++){F/D.right>1&&(D=c[++M]);const N=Math.abs(F-D.left),G=Math.abs(F-D.right),q=Math.min(N,G);this.data[x+F]=Math.max(0,Math.min(255,(D.isDash?q:-q)+128))}}addDash(c,f){const y=f?7:0,x=2*y+1;if(this.nextRow+x>this.height)return o.w("LineAtlas out of space"),null;let M=0;for(let F=0;F<c.length;F++)M+=c[F];if(M!==0){const F=this.width/M,N=this.getDashRanges(c,this.width,F);f?this.addRoundDash(N,F,y):this.addRegularDash(N)}const D={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:M};return this.nextRow+=x,this.dirty=!0,D}bind(c){const f=c.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const Ct="maplibre_preloaded_worker_pool";class Vt{constructor(){this.active={}}acquire(c){if(!this.workers)for(this.workers=[];this.workers.length<Vt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[c]=!0,this.workers.slice()}release(c){delete this.active[c],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}const Re=Math.floor(_.hardwareConcurrency/2);let mt,Et;function It(){return mt||(mt=new Vt),mt}Vt.workerCount=o.B(globalThis)?Math.max(Math.min(Re,3),1):1;class vn{constructor(c,f){this.workerPool=c,this.actors=[],this.currentActor=0,this.id=f;const y=this.workerPool.acquire(f);for(let x=0;x<y.length;x++){const M=new o.C(y[x],f);M.name=`Worker ${x}`,this.actors.push(M)}if(!this.actors.length)throw new Error("No actors found")}broadcast(c,f){const y=[];for(const x of this.actors)y.push(x.sendAsync({type:c,data:f}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(c=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],c&&this.workerPool.release(this.id)}registerMessageHandler(c,f){for(const y of this.actors)y.registerMessageHandler(c,f)}}function xn(){return Et||(Et=new vn(It(),o.G),Et.registerMessageHandler("GR",(S,c,f)=>o.m(c,f))),Et}function at(S,c){const f=o.F();return o.H(f,f,[1,1,0]),o.J(f,f,[.5*S.width,.5*S.height,1]),o.K(f,f,S.calculatePosMatrix(c.toUnwrapped()))}function Rn(S,c,f,y,x,M){const D=function($,re,ue){if($)for(const de of $){const we=re[de];if(we&&we.source===ue&&we.type==="fill-extrusion")return!0}else for(const de in re){const we=re[de];if(we.source===ue&&we.type==="fill-extrusion")return!0}return!1}(x&&x.layers,c,S.id),F=M.maxPitchScaleFactor(),N=S.tilesIn(y,F,D);N.sort(Me);const G=[];for(const $ of N)G.push({wrappedTileID:$.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(c,f,S._state,$.queryGeometry,$.cameraQueryGeometry,$.scale,x,M,F,at(S.transform,$.tileID))});const q=function($){const re={},ue={};for(const de of $){const we=de.queryResults,ge=de.wrappedTileID,Ce=ue[ge]=ue[ge]||{};for(const Oe in we){const ye=we[Oe],Ve=Ce[Oe]=Ce[Oe]||{},Xe=re[Oe]=re[Oe]||[];for(const nt of ye)Ve[nt.featureIndex]||(Ve[nt.featureIndex]=!0,Xe.push(nt))}}return re}(G);for(const $ in q)q[$].forEach(re=>{const ue=re.feature,de=S.getFeatureState(ue.layer["source-layer"],ue.id);ue.source=ue.layer.source,ue.layer["source-layer"]&&(ue.sourceLayer=ue.layer["source-layer"]),ue.state=de});return q}function Me(S,c){const f=S.tileID,y=c.tileID;return f.overscaledZ-y.overscaledZ||f.canonical.y-y.canonical.y||f.wrap-y.wrap||f.canonical.x-y.canonical.x}function Jn(S,c,f){return o._(this,void 0,void 0,function*(){let y=S;if(S.url?y=(yield o.h(c.transformRequest(S.url,"Source"),f)).data:yield _.frameAsync(f),!y)return null;const x=o.L(o.e(y,S),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(x.vectorLayerIds=y.vector_layers.map(M=>M.id)),x})}class on{constructor(c,f){c&&(f?this.setSouthWest(c).setNorthEast(f):Array.isArray(c)&&(c.length===4?this.setSouthWest([c[0],c[1]]).setNorthEast([c[2],c[3]]):this.setSouthWest(c[0]).setNorthEast(c[1])))}setNorthEast(c){return this._ne=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}setSouthWest(c){return this._sw=c instanceof o.M?new o.M(c.lng,c.lat):o.M.convert(c),this}extend(c){const f=this._sw,y=this._ne;let x,M;if(c instanceof o.M)x=c,M=c;else{if(!(c instanceof on))return Array.isArray(c)?c.length===4||c.every(Array.isArray)?this.extend(on.convert(c)):this.extend(o.M.convert(c)):c&&("lng"in c||"lon"in c)&&"lat"in c?this.extend(o.M.convert(c)):this;if(x=c._sw,M=c._ne,!x||!M)return this}return f||y?(f.lng=Math.min(x.lng,f.lng),f.lat=Math.min(x.lat,f.lat),y.lng=Math.max(M.lng,y.lng),y.lat=Math.max(M.lat,y.lat)):(this._sw=new o.M(x.lng,x.lat),this._ne=new o.M(M.lng,M.lat)),this}getCenter(){return new o.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.M(this.getWest(),this.getNorth())}getSouthEast(){return new o.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(c){const{lng:f,lat:y}=o.M.convert(c);let x=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&x}static convert(c){return c instanceof on?c:c&&new on(c)}static fromLngLat(c,f=0){const y=360*f/40075017,x=y/Math.cos(Math.PI/180*c.lat);return new on(new o.M(c.lng-x,c.lat-y),new o.M(c.lng+x,c.lat+y))}}class Vn{constructor(c,f,y){this.bounds=on.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=y||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const f=Math.pow(2,c.z),y=Math.floor(o.N(this.bounds.getWest())*f),x=Math.floor(o.O(this.bounds.getNorth())*f),M=Math.ceil(o.N(this.bounds.getEast())*f),D=Math.ceil(o.O(this.bounds.getSouth())*f);return c.x>=y&&c.x<M&&c.y>=x&&c.y<D}}class Te extends o.E{constructor(c,f,y,x){if(super(),this.id=c,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.L(f,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),c&&(o.e(this,c),c.bounds&&(this.tileBounds=new Vn(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}setSourceProperty(c){this._tileJSONRequest&&this._tileJSONRequest.abort(),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(c){return o._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(f,"Tile"),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let x="RT";if(c.actor&&c.state!=="expired"){if(c.state==="loading")return new Promise((M,D)=>{c.reloadPromise={resolve:M,reject:D}})}else c.actor=this.dispatcher.getActor(),x="LT";c.abortController=new AbortController;try{const M=yield c.actor.sendAsync({type:x,data:y},c.abortController);if(delete c.abortController,c.aborted)return;this._afterTileLoadWorkerResponse(c,M)}catch(M){if(delete c.abortController,c.aborted)return;if(M&&M.status!==404)throw M;this._afterTileLoadWorkerResponse(c,null)}})}_afterTileLoadWorkerResponse(c,f){if(f&&f.resourceTiming&&(c.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&c.setExpiryData(f),c.loadVectorData(f,this.map.painter),c.reloadPromise){const y=c.reloadPromise;c.reloadPromise=null,this.loadTile(c).then(y.resolve).catch(y.reject)}}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.actor&&(yield c.actor.sendAsync({type:"AT",data:{uid:c.uid,type:this.type,source:this.id}}))})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),c.actor&&(yield c.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class jn extends o.E{constructor(c,f,y,x){super(),this.id=c,this.dispatcher=y,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},f),o.e(this,o.L(f,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const c=yield Jn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,c&&(o.e(this,c),c.bounds&&(this.tileBounds=new Vn(c.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(c){this._tileJSONRequest=null,this.fire(new o.j(c))}})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(c){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),c(),this.load()}setTiles(c){return this.setSourceProperty(()=>{this._options.tiles=c}),this}setUrl(c){return this.setSourceProperty(()=>{this.url=c,this._options.url=c}),this}serialize(){return o.e({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c){return o._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);c.abortController=new AbortController;try{const y=yield z.getImage(this.map._requestManager.transformRequest(f,"Tile"),c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&c.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const x=this.map.painter.context,M=x.gl,D=y.data;c.texture=this.map.painter.getTileTexture(D.width),c.texture?c.texture.update(D,{useMipmap:!0}):(c.texture=new pe(x,D,M.RGBA,{useMipmap:!0}),c.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),x.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,x.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,x.extTextureFilterAnisotropicMax)),c.state="loaded"}}catch(y){if(delete c.abortController,c.aborted)c.state="unloaded";else if(y)throw c.state="errored",y}})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController)})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.texture&&this.map.painter.saveTileTexture(c.texture)})}hasTransition(){return!1}}class wn extends jn{constructor(c,f,y,x){super(c,f,y,x),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(c){return o._(this,void 0,void 0,function*(){const f=c.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(f,"Tile");c.neighboringTiles=this._getNeighboringTiles(c.tileID),c.abortController=new AbortController;try{const x=yield z.getImage(y,c.abortController,this.map._refreshExpiredTiles);if(delete c.abortController,c.aborted)return void(c.state="unloaded");if(x&&x.data){const M=x.data;this.map._refreshExpiredTiles&&x.cacheControl&&x.expires&&c.setExpiryData({cacheControl:x.cacheControl,expires:x.expires});const D=o.b(M)&&o.S()?M:yield this.readImageNow(M),F={type:this.type,uid:c.uid,source:this.id,rawImageData:D,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!c.actor||c.state==="expired"){c.actor=this.dispatcher.getActor();const N=yield c.actor.sendAsync({type:"LDT",data:F});c.dem=N,c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0,c.state="loaded"}}}catch(x){if(delete c.abortController,c.aborted)c.state="unloaded";else if(x)throw c.state="errored",x}})}readImageNow(c){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.U()){const f=c.width+2,y=c.height+2;try{return new o.R({width:f,height:y},yield o.V(c,-1,-1,f,y))}catch{}}return _.getImageData(c,1)})}_getNeighboringTiles(c){const f=c.canonical,y=Math.pow(2,f.z),x=(f.x-1+y)%y,M=f.x===0?c.wrap-1:c.wrap,D=(f.x+1+y)%y,F=f.x+1===y?c.wrap+1:c.wrap,N={};return N[new o.Q(c.overscaledZ,M,f.z,x,f.y).key]={backfilled:!1},N[new o.Q(c.overscaledZ,F,f.z,D,f.y).key]={backfilled:!1},f.y>0&&(N[new o.Q(c.overscaledZ,M,f.z,x,f.y-1).key]={backfilled:!1},N[new o.Q(c.overscaledZ,c.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},N[new o.Q(c.overscaledZ,F,f.z,D,f.y-1).key]={backfilled:!1}),f.y+1<y&&(N[new o.Q(c.overscaledZ,M,f.z,x,f.y+1).key]={backfilled:!1},N[new o.Q(c.overscaledZ,c.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},N[new o.Q(c.overscaledZ,F,f.z,D,f.y+1).key]={backfilled:!1}),N}unloadTile(c){return o._(this,void 0,void 0,function*(){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&(yield c.actor.sendAsync({type:"RDT",data:{type:this.type,uid:c.uid,source:this.id}}))})}}class jt extends o.E{constructor(c,f,y,x){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(x),this._data=f.data,this._options=o.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const M=o.W/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*M,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*M,extent:o.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:o.W,radius:(f.clusterRadius||50)*M,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(c){this.map=c,this.load()}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){return this._updateWorkerData(c),this}getData(){return o._(this,void 0,void 0,function*(){const c=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:c})})}setClusterOptions(c){return this.workerOptions.cluster=c.cluster,c&&(c.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=c.clusterRadius),c.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=c.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(c){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:c,source:this.id}})}getClusterChildren(c){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:c,source:this.id}})}getClusterLeaves(c,f,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:c,limit:f,offset:y}})}_updateWorkerData(c){return o._(this,void 0,void 0,function*(){const f=o.e({type:this.type},this.workerOptions);c?f.dataDiff=c:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let x=null;y.resourceTiming&&y.resourceTiming[this.id]&&(x=y.resourceTiming[this.id].slice(0));const M={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&o.e(M,{resourceTiming:x}),this.fire(new o.k("data",Object.assign(Object.assign({},M),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},M),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(c){return o._(this,void 0,void 0,function*(){const f=c.actor?"RT":"LT";c.actor=this.actor;const y={type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};c.abortController=new AbortController;const x=yield this.actor.sendAsync({type:f,data:y},c.abortController);delete c.abortController,c.unloadVectorData(),c.aborted||c.loadVectorData(x,this.map.painter,f==="RT")})}abortTile(c){return o._(this,void 0,void 0,function*(){c.abortController&&(c.abortController.abort(),delete c.abortController),c.aborted=!0})}unloadTile(c){return o._(this,void 0,void 0,function*(){c.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:c.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var me=o.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class le extends o.E{constructor(c,f,y,x){super(),this.id=c,this.dispatcher=y,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=f}load(c){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield z.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,c&&(this.coordinates=c),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new o.j(f))}})}loaded(){return this._loaded}updateImage(c){return c.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=c.url,this.load(c.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(c){this.map=c,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(c){this.coordinates=c;const f=c.map(o.Y.fromLngLat);this.tileID=function(x){let M=1/0,D=1/0,F=-1/0,N=-1/0;for(const re of x)M=Math.min(M,re.x),D=Math.min(D,re.y),F=Math.max(F,re.x),N=Math.max(N,re.y);const G=Math.max(F-M,N-D),q=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),$=Math.pow(2,q);return new o.a0(q,Math.floor((M+F)/2*$),Math.floor((D+N)/2*$))}(f),this.minzoom=this.maxzoom=this.tileID.z;const y=f.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new o.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,o.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,o.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,o.W,o.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const c=this.map.painter.context,f=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new pe(c,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const M=this.tiles[x];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(c){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={}):c.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class tt extends le{constructor(c,f,y,x){super(c,f,y,x),this.roundZoom=!0,this.type="video",this.options=f}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const c=this.options;this.urls=[];for(const f of c.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield o.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new o.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const f=this.video.seekable;c<f.start(0)||c>f.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,f=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new pe(c,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let y=!1;for(const x in this.tiles){const M=this.tiles[x];M.state!=="loaded"&&(M.state="loaded",M.texture=this.texture,y=!0)}y&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class xt extends le{constructor(c,f,y,x){super(c,f,y,x),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(M=>!Array.isArray(M)||M.length!==2||M.some(D=>typeof D!="number"))||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${c}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,y=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,me.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new pe(f,this.canvas,y.RGBA,{premultiply:!0});let x=!1;for(const M in this.tiles){const D=this.tiles[M];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture,x=!0)}x&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}}const St={},yt=S=>{switch(S){case"geojson":return jt;case"image":return le;case"raster":return jn;case"raster-dem":return wn;case"vector":return Te;case"video":return tt;case"canvas":return xt}return St[S]},hn="RTLPluginLoaded";class zt extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=xn()}_syncState(c){return this.status=c,this.dispatcher.broadcast("SRPS",{pluginStatus:c,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(c){return o._(this,arguments,void 0,function*(f,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(hn))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Je=null;function cn(){return Je||(Je=new zt),Je}class At{constructor(c,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=c,this.uid=o.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(c){const f=c+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(c){this.demTexture&&c.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(c,f,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",c){c.featureIndex&&(this.latestFeatureIndex=c.featureIndex,c.rawTileData?(this.latestRawTileData=c.rawTileData,this.latestFeatureIndex.rawTileData=c.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=c.collisionBoxArray,this.buckets=function(x,M){const D={};if(!M)return D;for(const F of x){const N=F.layerIds.map(G=>M.getLayer(G)).filter(Boolean);if(N.length!==0){F.layers=N,F.stateDependentLayerIds&&(F.stateDependentLayers=F.stateDependentLayerIds.map(G=>N.filter(q=>q.id===G)[0]));for(const G of N)D[G.id]=F}}return D}(c.buckets,f.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const M=this.buckets[x];if(M instanceof o.a5){if(this.hasSymbolBuckets=!0,!y)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const M=this.buckets[x];if(M instanceof o.a5&&M.hasRTLText){this.hasRTLText=!0,cn().lazyLoad();break}}this.queryPadding=0;for(const x in this.buckets){const M=this.buckets[x];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(x).queryRadius(M))}c.imageAtlas&&(this.imageAtlas=c.imageAtlas),c.glyphAtlasImage&&(this.glyphAtlasImage=c.glyphAtlasImage)}else this.collisionBoxArray=new o.a4}unloadVectorData(){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(c){return this.buckets[c.id]}upload(c){for(const y in this.buckets){const x=this.buckets[y];x.uploadPending()&&x.upload(c)}const f=c.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pe(c,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pe(c,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(c){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(c,this.imageAtlasTexture)}queryRenderedFeatures(c,f,y,x,M,D,F,N,G,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:x,cameraQueryGeometry:M,scale:D,tileSize:this.tileSize,pixelPosMatrix:q,transform:N,params:F,queryPadding:this.queryPadding*G},c,f,y):{}}querySourceFeatures(c,f){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const x=y.loadVTLayers(),M=f&&f.sourceLayer?f.sourceLayer:"",D=x._geojsonTileLayer||x[M];if(!D)return;const F=o.a6(f&&f.filter),{z:N,x:G,y:q}=this.tileID.canonical,$={z:N,x:G,y:q};for(let re=0;re<D.length;re++){const ue=D.feature(re);if(F.needGeometry){const ge=o.a7(ue,!0);if(!F.filter(new o.a8(this.tileID.overscaledZ),ge,this.tileID.canonical))continue}else if(!F.filter(new o.a8(this.tileID.overscaledZ),ue))continue;const de=y.getId(ue,M),we=new o.a9(ue,N,G,q,de);we.tile=$,c.push(we)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(c){const f=this.expirationTime;if(c.cacheControl){const y=o.aa(c.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else c.expires&&(this.expirationTime=new Date(c.expires).getTime());if(this.expirationTime){const y=Date.now();let x=!1;if(this.expirationTime>y)x=!1;else if(f)if(this.expirationTime<f)x=!0;else{const M=this.expirationTime-f;M?this.expirationTime=y+Math.max(M,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(c,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(c).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const x in this.buckets){if(!f.style.hasLayer(x))continue;const M=this.buckets[x],D=M.layers[0].sourceLayer||"_geojsonTileLayer",F=y[D],N=c[D];if(!F||!N||Object.keys(N).length===0)continue;M.update(N,F,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=f&&f.style&&f.style.getLayer(x);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(c){this.symbolFadeHoldUntil=_.now()+c}setDependencies(c,f){const y={};for(const x of f)y[x]=!0;this.dependencies[c]=y}hasDependency(c,f){for(const y of c){const x=this.dependencies[y];if(x){for(const M of f)if(x[M])return!0}}return!1}}class tn{constructor(c,f){this.max=c,this.onRemove=f,this.reset()}reset(){for(const c in this.data)for(const f of this.data[c])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(c,f,y){const x=c.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const M={value:f,timeout:void 0};if(y!==void 0&&(M.timeout=setTimeout(()=>{this.remove(c,M)},y)),this.data[x].push(M),this.order.push(x),this.order.length>this.max){const D=this._getAndRemoveByKey(this.order[0]);D&&this.onRemove(D)}return this}has(c){return c.wrapped().key in this.data}getAndRemove(c){return this.has(c)?this._getAndRemoveByKey(c.wrapped().key):null}_getAndRemoveByKey(c){const f=this.data[c].shift();return f.timeout&&clearTimeout(f.timeout),this.data[c].length===0&&delete this.data[c],this.order.splice(this.order.indexOf(c),1),f.value}getByKey(c){const f=this.data[c];return f?f[0].value:null}get(c){return this.has(c)?this.data[c.wrapped().key][0].value:null}remove(c,f){if(!this.has(c))return this;const y=c.wrapped().key,x=f===void 0?0:this.data[y].indexOf(f),M=this.data[y][x];return this.data[y].splice(x,1),M.timeout&&clearTimeout(M.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(M.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(c){for(this.max=c;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(c){const f=[];for(const y in this.data)for(const x of this.data[y])c(x.value)||f.push(x);for(const y of f)this.remove(y.value.tileID,y)}}class Zn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(c,f,y){const x=String(f);if(this.stateChanges[c]=this.stateChanges[c]||{},this.stateChanges[c][x]=this.stateChanges[c][x]||{},o.e(this.stateChanges[c][x],y),this.deletedStates[c]===null){this.deletedStates[c]={};for(const M in this.state[c])M!==x&&(this.deletedStates[c][M]=null)}else if(this.deletedStates[c]&&this.deletedStates[c][x]===null){this.deletedStates[c][x]={};for(const M in this.state[c][x])y[M]||(this.deletedStates[c][x][M]=null)}else for(const M in y)this.deletedStates[c]&&this.deletedStates[c][x]&&this.deletedStates[c][x][M]===null&&delete this.deletedStates[c][x][M]}removeFeatureState(c,f,y){if(this.deletedStates[c]===null)return;const x=String(f);if(this.deletedStates[c]=this.deletedStates[c]||{},y&&f!==void 0)this.deletedStates[c][x]!==null&&(this.deletedStates[c][x]=this.deletedStates[c][x]||{},this.deletedStates[c][x][y]=null);else if(f!==void 0)if(this.stateChanges[c]&&this.stateChanges[c][x])for(y in this.deletedStates[c][x]={},this.stateChanges[c][x])this.deletedStates[c][x][y]=null;else this.deletedStates[c][x]=null;else this.deletedStates[c]=null}getState(c,f){const y=String(f),x=o.e({},(this.state[c]||{})[y],(this.stateChanges[c]||{})[y]);if(this.deletedStates[c]===null)return{};if(this.deletedStates[c]){const M=this.deletedStates[c][f];if(M===null)return{};for(const D in M)delete x[D]}return x}initializeTileState(c,f){c.setFeatureState(this.state,f)}coalesceChanges(c,f){const y={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const M={};for(const D in this.stateChanges[x])this.state[x][D]||(this.state[x][D]={}),o.e(this.state[x][D],this.stateChanges[x][D]),M[D]=this.state[x][D];y[x]=M}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const M={};if(this.deletedStates[x]===null)for(const D in this.state[x])M[D]={},this.state[x][D]={};else for(const D in this.deletedStates[x]){if(this.deletedStates[x][D]===null)this.state[x][D]={};else for(const F of Object.keys(this.deletedStates[x][D]))delete this.state[x][D][F];M[D]=this.state[x][D]}y[x]=y[x]||{},o.e(y[x],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const x in c)c[x].setFeatureState(y,f)}}class lt extends o.E{constructor(c,f,y){super(),this.id=c,this.dispatcher=y,this.on("data",x=>this._dataHandler(x)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((x,M,D,F)=>{const N=new(yt(M.type))(x,M,D,F);if(N.id!==x)throw new Error(`Expected Source id to be ${x} instead of ${N.id}`);return N})(c,f,y,this),this._tiles={},this._cache=new tn(0,x=>this._unloadTile(x)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Zn,this._didEmitContent=!1,this._updated=!1}onAdd(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._maxTileCacheZoomLevels=c?c._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(c)}onRemove(c){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(c)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const c in this._tiles){const f=this._tiles[c];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(c,f,y){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(c),this._tileLoaded(c,f,y)}catch(x){c.state="errored",x.status!==404?this._source.fire(new o.j(x,{tile:c})):this.update(this.transform,this.terrain)}})}_unloadTile(c){this._source.unloadTile&&this._source.unloadTile(c)}_abortTile(c){this._source.abortTile&&this._source.abortTile(c),this._source.fire(new o.k("dataabort",{tile:c,coord:c.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(c){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const y=this._tiles[f];y.upload(c),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(c=>c.tileID).sort(Mt).map(c=>c.key)}getRenderableIds(c){const f=[];for(const y in this._tiles)this._isIdRenderable(y,c)&&f.push(this._tiles[y]);return c?f.sort((y,x)=>{const M=y.tileID,D=x.tileID,F=new o.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle),N=new o.P(D.canonical.x,D.canonical.y)._rotate(this.transform.angle);return M.overscaledZ-D.overscaledZ||N.y-F.y||N.x-F.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(Mt).map(y=>y.key)}hasRenderableParent(c){const f=this.findLoadedParent(c,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(c,f){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(f||!this._tiles[c].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const c in this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")}}_reloadTile(c,f){return o._(this,void 0,void 0,function*(){const y=this._tiles[c];y&&(y.state!=="loading"&&(y.state=f),yield this._loadTile(y,c,f))})}_tileLoaded(c,f,y){c.timeAdded=_.now(),y==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(f,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),c.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:c,coord:c.tileID}))}_backfillDEM(c){const f=this.getRenderableIds();for(let x=0;x<f.length;x++){const M=f[x];if(c.neighboringTiles&&c.neighboringTiles[M]){const D=this.getTileByID(M);y(c,D),y(D,c)}}function y(x,M){x.needsHillshadePrepare=!0,x.needsTerrainPrepare=!0;let D=M.tileID.canonical.x-x.tileID.canonical.x;const F=M.tileID.canonical.y-x.tileID.canonical.y,N=Math.pow(2,x.tileID.canonical.z),G=M.tileID.key;D===0&&F===0||Math.abs(F)>1||(Math.abs(D)>1&&(Math.abs(D+N)===1?D+=N:Math.abs(D-N)===1&&(D-=N)),M.dem&&x.dem&&(x.dem.backfillBorder(M.dem,D,F),x.neighboringTiles&&x.neighboringTiles[G]&&(x.neighboringTiles[G].backfilled=!0)))}}getTile(c){return this.getTileByID(c.key)}getTileByID(c){return this._tiles[c]}_retainLoadedChildren(c,f,y,x){for(const M in this._tiles){let D=this._tiles[M];if(x[M]||!D.hasData()||D.tileID.overscaledZ<=f||D.tileID.overscaledZ>y)continue;let F=D.tileID;for(;D&&D.tileID.overscaledZ>f+1;){const G=D.tileID.scaledTo(D.tileID.overscaledZ-1);D=this._tiles[G.key],D&&D.hasData()&&(F=G)}let N=F;for(;N.overscaledZ>f;)if(N=N.scaledTo(N.overscaledZ-1),c[N.key]){x[F.key]=F;break}}}findLoadedParent(c,f){if(c.key in this._loadedParentTiles){const y=this._loadedParentTiles[c.key];return y&&y.tileID.overscaledZ>=f?y:null}for(let y=c.overscaledZ-1;y>=f;y--){const x=c.scaledTo(y),M=this._getLoadedTile(x);if(M)return M}}findLoadedSibling(c){return this._getLoadedTile(c)}_getLoadedTile(c){const f=this._tiles[c.key];return f&&f.hasData()?f:this._cache.getByKey(c.wrapped().key)}updateCacheSize(c){const f=Math.ceil(c.width/this._source.tileSize)+1,y=Math.ceil(c.height/this._source.tileSize)+1,x=Math.floor(f*y*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(M)}handleWrapJump(c){const f=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,f){const y={};for(const x in this._tiles){const M=this._tiles[x];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+f),y[M.tileID.key]=M}this._tiles=y;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(x,this._tiles[x])}}_updateCoveredAndRetainedTiles(c,f,y,x,M,D){const F={},N={},G=Object.keys(c),q=_.now();for(const $ of G){const re=c[$],ue=this._tiles[$];if(!ue||ue.fadeEndTime!==0&&ue.fadeEndTime<=q)continue;const de=this.findLoadedParent(re,f),we=this.findLoadedSibling(re),ge=de||we||null;ge&&(this._addTile(ge.tileID),F[ge.tileID.key]=ge.tileID),N[$]=re}this._retainLoadedChildren(N,x,y,c);for(const $ in F)c[$]||(this._coveredTiles[$]=!0,c[$]=F[$]);if(D){const $={},re={};for(const ue of M)this._tiles[ue.key].hasData()?$[ue.key]=ue:re[ue.key]=ue;for(const ue in re){const de=re[ue].children(this._source.maxzoom);this._tiles[de[0].key]&&this._tiles[de[1].key]&&this._tiles[de[2].key]&&this._tiles[de[3].key]&&($[de[0].key]=c[de[0].key]=de[0],$[de[1].key]=c[de[1].key]=de[1],$[de[2].key]=c[de[2].key]=de[2],$[de[3].key]=c[de[3].key]=de[3],delete re[ue])}for(const ue in re){const de=re[ue],we=this.findLoadedParent(de,this._source.minzoom),ge=this.findLoadedSibling(de),Ce=we||ge||null;if(Ce){$[Ce.tileID.key]=c[Ce.tileID.key]=Ce.tileID;for(const Oe in $)$[Oe].isChildOf(Ce.tileID)&&delete $[Oe]}}for(const ue in this._tiles)$[ue]||(this._coveredTiles[ue]=!0)}}update(c,f){if(!this._sourceLoaded||this._paused)return;let y;this.transform=c,this.terrain=f,this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new o.Q(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(y=c.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(y=y.filter(q=>this._source.hasTile(q)))):y=[];const x=c.coveringZoomLevel(this._source),M=Math.max(x-lt.maxOverzooming,this._source.minzoom),D=Math.max(x+lt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const $ of y)if($.canonical.z>this._source.minzoom){const re=$.scaledTo($.canonical.z-1);q[re.key]=re;const ue=$.scaledTo(Math.max(this._source.minzoom,Math.min($.canonical.z,5)));q[ue.key]=ue}y=y.concat(Object.values(q))}const F=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,F&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const N=this._updateRetainedTiles(y,x);kt(this._source.type)&&this._updateCoveredAndRetainedTiles(N,M,D,x,y,f);for(const q in N)this._tiles[q].clearFadeHold();const G=o.ab(this._tiles,N);for(const q of G){const $=this._tiles[q];$.hasSymbolBuckets&&!$.holdingForFade()?$.setHoldDuration(this.map._fadeDuration):$.hasSymbolBuckets&&!$.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)}_updateRetainedTiles(c,f){var y;const x={},M={},D=Math.max(f-lt.maxOverzooming,this._source.minzoom),F=Math.max(f+lt.maxUnderzooming,this._source.minzoom),N={};for(const G of c){const q=this._addTile(G);x[G.key]=G,q.hasData()||f<this._source.maxzoom&&(N[G.key]=G)}this._retainLoadedChildren(N,f,F,x);for(const G of c){let q=this._tiles[G.key];if(q.hasData())continue;if(f+1>this._source.maxzoom){const re=G.children(this._source.maxzoom)[0],ue=this.getTile(re);if(ue&&ue.hasData()){x[re.key]=re;continue}}else{const re=G.children(this._source.maxzoom);if(x[re[0].key]&&x[re[1].key]&&x[re[2].key]&&x[re[3].key])continue}let $=q.wasRequested();for(let re=G.overscaledZ-1;re>=D;--re){const ue=G.scaledTo(re);if(M[ue.key])break;if(M[ue.key]=!0,q=this.getTile(ue),!q&&$&&(q=this._addTile(ue)),q){const de=q.hasData();if((de||!(!((y=this.map)===null||y===void 0)&&y.cancelPendingTileRequestsWhileZooming)||$)&&(x[ue.key]=ue),$=q.wasRequested(),de)break}}}return x}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const c in this._tiles){const f=[];let y,x=this._tiles[c].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){y=this._loadedParentTiles[x.key];break}f.push(x.key);const M=x.scaledTo(x.overscaledZ-1);if(y=this._getLoadedTile(M),y)break;x=M}for(const M of f)this._loadedParentTiles[M]=y}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const c in this._tiles){const f=this._tiles[c].tileID,y=this._getLoadedTile(f);this._loadedSiblingTiles[f.key]=y}}_addTile(c){let f=this._tiles[c.key];if(f)return f;f=this._cache.getAndRemove(c),f&&(this._setTileReloadTimer(c.key,f),f.tileID=c,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,f)));const y=f;return f||(f=new At(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(f,c.key,f.state)),f.uses++,this._tiles[c.key]=f,y||this._source.fire(new o.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(c,f){c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);const y=f.getExpiryTimeout();y&&(this._timers[c]=setTimeout(()=>{this._reloadTile(c,"expired"),delete this._timers[c]},y))}_removeTile(c){const f=this._tiles[c];f&&(f.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(c){const f=c.sourceDataType;c.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const c in this._tiles)this._removeTile(c);this._cache.reset()}tilesIn(c,f,y){const x=[],M=this.transform;if(!M)return x;const D=y?M.getCameraQueryGeometry(c):c,F=c.map(de=>M.pointCoordinate(de,this.terrain)),N=D.map(de=>M.pointCoordinate(de,this.terrain)),G=this.getIds();let q=1/0,$=1/0,re=-1/0,ue=-1/0;for(const de of N)q=Math.min(q,de.x),$=Math.min($,de.y),re=Math.max(re,de.x),ue=Math.max(ue,de.y);for(let de=0;de<G.length;de++){const we=this._tiles[G[de]];if(we.holdingForFade())continue;const ge=we.tileID,Ce=Math.pow(2,M.zoom-we.tileID.overscaledZ),Oe=f*we.queryPadding*o.W/we.tileSize/Ce,ye=[ge.getTilePoint(new o.Y(q,$)),ge.getTilePoint(new o.Y(re,ue))];if(ye[0].x-Oe<o.W&&ye[0].y-Oe<o.W&&ye[1].x+Oe>=0&&ye[1].y+Oe>=0){const Ve=F.map(nt=>ge.getTilePoint(nt)),Xe=N.map(nt=>ge.getTilePoint(nt));x.push({tile:we,tileID:ge,queryGeometry:Ve,cameraQueryGeometry:Xe,scale:Ce})}}return x}getVisibleCoordinates(c){const f=this.getRenderableIds(c).map(y=>this._tiles[y].tileID);for(const y of f)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(kt(this._source.type)){const c=_.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=c)return!0}return!1}setFeatureState(c,f,y){this._state.updateState(c=c||"_geojsonTileLayer",f,y)}removeFeatureState(c,f,y){this._state.removeFeatureState(c=c||"_geojsonTileLayer",f,y)}getFeatureState(c,f){return this._state.getState(c=c||"_geojsonTileLayer",f)}setDependencies(c,f,y){const x=this._tiles[c];x&&x.setDependencies(f,y)}reloadTilesForDependencies(c,f){for(const y in this._tiles)this._tiles[y].hasDependency(c,f)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(c,f))}}function Mt(S,c){const f=Math.abs(2*S.wrap)-+(S.wrap<0),y=Math.abs(2*c.wrap)-+(c.wrap<0);return S.overscaledZ-c.overscaledZ||y-f||c.canonical.y-S.canonical.y||c.canonical.x-S.canonical.x}function kt(S){return S==="raster"||S==="image"||S==="video"}lt.maxOverzooming=10,lt.maxUnderzooming=3;class In{constructor(c,f){this.reset(c,f)}reset(c,f){this.points=c||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=o.ac(c,0,1);let f=1,y=this._distances[f];const x=c*this.paddedLength+this.padding;for(;y<x&&f<this._distances.length;)y=this._distances[++f];const M=f-1,D=this._distances[M],F=y-D,N=F>0?(x-D)/F:0;return this.points[M].mult(1-N).add(this.points[f].mult(N))}}function ii(S,c){let f=!0;return S==="always"||S!=="never"&&c!=="never"||(f=!1),f}class Ae{constructor(c,f,y){const x=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(c/y),this.yCellCount=Math.ceil(f/y);for(let D=0;D<this.xCellCount*this.yCellCount;D++)x.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,f,y,x,M){this._forEachCell(f,y,x,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(x),this.bboxes.push(M)}insertCircle(c,f,y,x){this._forEachCell(f-x,y-x,f+x,y+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(y),this.circles.push(x)}_insertBoxCell(c,f,y,x,M,D){this.boxCells[M].push(D)}_insertCircleCell(c,f,y,x,M,D){this.circleCells[M].push(D)}_query(c,f,y,x,M,D,F){if(y<0||c>this.width||x<0||f>this.height)return[];const N=[];if(c<=0&&f<=0&&this.width<=y&&this.height<=x){if(M)return[{key:null,x1:c,y1:f,x2:y,y2:x}];for(let G=0;G<this.boxKeys.length;G++)N.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const q=this.circles[3*G],$=this.circles[3*G+1],re=this.circles[3*G+2];N.push({key:this.circleKeys[G],x1:q-re,y1:$-re,x2:q+re,y2:$+re})}}else this._forEachCell(c,f,y,x,this._queryCell,N,{hitTest:M,overlapMode:D,seenUids:{box:{},circle:{}}},F);return N}query(c,f,y,x){return this._query(c,f,y,x,!1,null)}hitTest(c,f,y,x,M,D){return this._query(c,f,y,x,!0,M,D).length>0}hitTestCircle(c,f,y,x,M){const D=c-y,F=c+y,N=f-y,G=f+y;if(F<0||D>this.width||G<0||N>this.height)return!1;const q=[];return this._forEachCell(D,N,F,G,this._queryCellCircle,q,{hitTest:!0,overlapMode:x,circle:{x:c,y:f,radius:y},seenUids:{box:{},circle:{}}},M),q.length>0}_queryCell(c,f,y,x,M,D,F,N){const{seenUids:G,hitTest:q,overlapMode:$}=F,re=this.boxCells[M];if(re!==null){const de=this.bboxes;for(const we of re)if(!G.box[we]){G.box[we]=!0;const ge=4*we,Ce=this.boxKeys[we];if(c<=de[ge+2]&&f<=de[ge+3]&&y>=de[ge+0]&&x>=de[ge+1]&&(!N||N(Ce))&&(!q||!ii($,Ce.overlapMode))&&(D.push({key:Ce,x1:de[ge],y1:de[ge+1],x2:de[ge+2],y2:de[ge+3]}),q))return!0}}const ue=this.circleCells[M];if(ue!==null){const de=this.circles;for(const we of ue)if(!G.circle[we]){G.circle[we]=!0;const ge=3*we,Ce=this.circleKeys[we];if(this._circleAndRectCollide(de[ge],de[ge+1],de[ge+2],c,f,y,x)&&(!N||N(Ce))&&(!q||!ii($,Ce.overlapMode))){const Oe=de[ge],ye=de[ge+1],Ve=de[ge+2];if(D.push({key:Ce,x1:Oe-Ve,y1:ye-Ve,x2:Oe+Ve,y2:ye+Ve}),q)return!0}}}return!1}_queryCellCircle(c,f,y,x,M,D,F,N){const{circle:G,seenUids:q,overlapMode:$}=F,re=this.boxCells[M];if(re!==null){const de=this.bboxes;for(const we of re)if(!q.box[we]){q.box[we]=!0;const ge=4*we,Ce=this.boxKeys[we];if(this._circleAndRectCollide(G.x,G.y,G.radius,de[ge+0],de[ge+1],de[ge+2],de[ge+3])&&(!N||N(Ce))&&!ii($,Ce.overlapMode))return D.push(!0),!0}}const ue=this.circleCells[M];if(ue!==null){const de=this.circles;for(const we of ue)if(!q.circle[we]){q.circle[we]=!0;const ge=3*we,Ce=this.circleKeys[we];if(this._circlesCollide(de[ge],de[ge+1],de[ge+2],G.x,G.y,G.radius)&&(!N||N(Ce))&&!ii($,Ce.overlapMode))return D.push(!0),!0}}}_forEachCell(c,f,y,x,M,D,F,N){const G=this._convertToXCellCoord(c),q=this._convertToYCellCoord(f),$=this._convertToXCellCoord(y),re=this._convertToYCellCoord(x);for(let ue=G;ue<=$;ue++)for(let de=q;de<=re;de++)if(M.call(this,c,f,y,x,this.xCellCount*de+ue,D,F,N))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,f,y,x,M,D){const F=x-c,N=M-f,G=y+D;return G*G>F*F+N*N}_circleAndRectCollide(c,f,y,x,M,D,F){const N=(D-x)/2,G=Math.abs(c-(x+N));if(G>N+y)return!1;const q=(F-M)/2,$=Math.abs(f-(M+q));if($>q+y)return!1;if(G<=N||$<=q)return!0;const re=G-N,ue=$-q;return re*re+ue*ue<=y*y}}function Lt(S,c,f,y,x){const M=o.F();return c?(o.J(M,M,[1/x,1/x,1]),f||o.ad(M,M,y.angle)):o.K(M,y.labelPlaneMatrix,S),M}function gt(S,c,f,y,x){if(c){const M=o.ae(S);return o.J(M,M,[x,x,1]),f||o.ad(M,M,-y.angle),M}return y.glCoordMatrix}function ht(S,c,f){let y;f?(y=[S.x,S.y,f(S.x,S.y),1],o.af(y,y,c)):(y=[S.x,S.y,0,1],function(M,D,F){const N=D[0],G=D[1];M[0]=F[0]*N+F[4]*G+F[12],M[1]=F[1]*N+F[5]*G+F[13],M[3]=F[3]*N+F[7]*G+F[15]}(y,y,c));const x=y[3];return{point:new o.P(y[0]/x,y[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}function ae(S,c){return .5+S/c*.5}function j(S,c){return S.x>=-c[0]&&S.x<=c[0]&&S.y>=-c[1]&&S.y<=c[1]}function Z(S,c,f,y,x,M,D,F,N,G,q,$,re,ue,de){const we=y?S.textSizeData:S.iconSizeData,ge=o.ag(we,f.transform.zoom),Ce=[256/f.width*2+1,256/f.height*2+1],Oe=y?S.text.dynamicLayoutVertexArray:S.icon.dynamicLayoutVertexArray;Oe.clear();const ye=S.lineVertexArray,Ve=y?S.text.placedSymbolArray:S.icon.placedSymbolArray,Xe=f.transform.width/f.transform.height;let nt=!1;for(let _t=0;_t<Ve.length;_t++){const Rt=Ve.get(_t);if(Rt.hidden||Rt.writingMode===o.ah.vertical&&!nt){nn(Rt.numGlyphs,Oe);continue}nt=!1;const sn=ht(new o.P(Rt.anchorX,Rt.anchorY),c,de);if(!j(sn.point,Ce)){nn(Rt.numGlyphs,Oe);continue}const an=ae(f.transform.cameraToCenterDistance,sn.signedDistanceFromCamera),Dt=o.ai(we,ge,Rt),Nt=D?Dt/an:Dt*an,yn={getElevation:de,labelPlaneMatrix:x,lineVertexArray:ye,pitchWithMap:D,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:G,tileAnchorPoint:new o.P(Rt.anchorX,Rt.anchorY),unwrappedTileID:q,width:$,height:re,translation:ue},qn=xe(yn,Rt,Nt,!1,F,c,M,S.glyphOffsetArray,Oe,Xe,N);nt=qn.useVertical,(qn.notEnoughRoom||nt||qn.needsFlipping&&xe(yn,Rt,Nt,!0,F,c,M,S.glyphOffsetArray,Oe,Xe,N).notEnoughRoom)&&nn(Rt.numGlyphs,Oe)}y?S.text.dynamicLayoutVertexBuffer.updateData(Oe):S.icon.dynamicLayoutVertexBuffer.updateData(Oe)}function ne(S,c,f,y,x,M,D,F){const N=M.glyphStartIndex+M.numGlyphs,G=M.lineStartIndex,q=M.lineStartIndex+M.lineLength,$=c.getoffsetX(M.glyphStartIndex),re=c.getoffsetX(N-1),ue=Ze(S*$,f,y,x,M.segment,G,q,F,D);if(!ue)return null;const de=Ze(S*re,f,y,x,M.segment,G,q,F,D);return de?F.projectionCache.anyProjectionOccluded?null:{first:ue,last:de}:null}function fe(S,c,f,y){return S===o.ah.horizontal&&Math.abs(f.y-c.y)>Math.abs(f.x-c.x)*y?{useVertical:!0}:(S===o.ah.vertical?c.y<f.y:c.x>f.x)?{needsFlipping:!0}:null}function xe(S,c,f,y,x,M,D,F,N,G,q){const $=f/24,re=c.lineOffsetX*$,ue=c.lineOffsetY*$;let de;if(c.numGlyphs>1){const we=c.glyphStartIndex+c.numGlyphs,ge=c.lineStartIndex,Ce=c.lineStartIndex+c.lineLength,Oe=ne($,F,re,ue,y,c,q,S);if(!Oe)return{notEnoughRoom:!0};const ye=ht(Oe.first.point,D,S.getElevation).point,Ve=ht(Oe.last.point,D,S.getElevation).point;if(x&&!y){const Xe=fe(c.writingMode,ye,Ve,G);if(Xe)return Xe}de=[Oe.first];for(let Xe=c.glyphStartIndex+1;Xe<we-1;Xe++)de.push(Ze($*F.getoffsetX(Xe),re,ue,y,c.segment,ge,Ce,S,q));de.push(Oe.last)}else{if(x&&!y){const ge=ht(S.tileAnchorPoint,M,S.getElevation).point,Ce=c.lineStartIndex+c.segment+1,Oe=new o.P(S.lineVertexArray.getx(Ce),S.lineVertexArray.gety(Ce)),ye=ht(Oe,M,S.getElevation),Ve=ye.signedDistanceFromCamera>0?ye.point:function(nt,_t,Rt,sn,an,Dt){return Ie(nt,_t,Rt,1,an,Dt)}(S.tileAnchorPoint,Oe,ge,0,M,S),Xe=fe(c.writingMode,ge,Ve,G);if(Xe)return Xe}const we=Ze($*F.getoffsetX(c.glyphStartIndex),re,ue,y,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,S,q);if(!we||S.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};de=[we]}for(const we of de)o.aj(N,we.point,we.angle);return{}}function Ie(S,c,f,y,x,M){const D=S.add(S.sub(c)._unit()),F=x!==void 0?ht(D,x,M.getElevation).point:Se(D.x,D.y,M).point,N=f.sub(F);return f.add(N._mult(y/N.mag()))}function ke(S,c,f){const y=c.projectionCache;if(y.projections[S])return y.projections[S];const x=new o.P(c.lineVertexArray.getx(S),c.lineVertexArray.gety(S)),M=Se(x.x,x.y,c);if(M.signedDistanceFromCamera>0)return y.projections[S]=M.point,y.anyProjectionOccluded=y.anyProjectionOccluded||M.isOccluded,M.point;const D=S-f.direction;return function(F,N,G,q,$){return Ie(F,N,G,q,void 0,$)}(f.distanceFromAnchor===0?c.tileAnchorPoint:new o.P(c.lineVertexArray.getx(D),c.lineVertexArray.gety(D)),x,f.previousVertex,f.absOffsetX-f.distanceFromAnchor+1,c)}function Se(S,c,f){const y=S+f.translation[0],x=c+f.translation[1];let M;return!f.pitchWithMap&&f.projection.useSpecialProjectionForSymbols?(M=f.projection.projectTileCoordinates(y,x,f.unwrappedTileID,f.getElevation),M.point.x=(.5*M.point.x+.5)*f.width,M.point.y=(.5*-M.point.y+.5)*f.height):(M=ht(new o.P(y,x),f.labelPlaneMatrix,f.getElevation),M.isOccluded=!1),M}function Ue(S,c,f){return S._unit()._perp()._mult(c*f)}function ft(S,c,f,y,x,M,D,F,N){if(F.projectionCache.offsets[S])return F.projectionCache.offsets[S];const G=f.add(c);if(S+N.direction<y||S+N.direction>=x)return F.projectionCache.offsets[S]=G,G;const q=ke(S+N.direction,F,N),$=Ue(q.sub(f),D,N.direction),re=f.add($),ue=q.add($);return F.projectionCache.offsets[S]=o.ak(M,G,re,ue)||G,F.projectionCache.offsets[S]}function Ze(S,c,f,y,x,M,D,F,N){const G=y?S-c:S+c;let q=G>0?1:-1,$=0;y&&(q*=-1,$=Math.PI),q<0&&($+=Math.PI);let re,ue=q>0?M+x:M+x+1;F.projectionCache.cachedAnchorPoint?re=F.projectionCache.cachedAnchorPoint:(re=Se(F.tileAnchorPoint.x,F.tileAnchorPoint.y,F).point,F.projectionCache.cachedAnchorPoint=re);let de,we,ge=re,Ce=re,Oe=0,ye=0;const Ve=Math.abs(G),Xe=[];let nt;for(;Oe+ye<=Ve;){if(ue+=q,ue<M||ue>=D)return null;Oe+=ye,Ce=ge,we=de;const sn={absOffsetX:Ve,direction:q,distanceFromAnchor:Oe,previousVertex:Ce};if(ge=ke(ue,F,sn),f===0)Xe.push(Ce),nt=ge.sub(Ce);else{let an;const Dt=ge.sub(Ce);an=Dt.mag()===0?Ue(ke(ue+q,F,sn).sub(ge),f,q):Ue(Dt,f,q),we||(we=Ce.add(an)),de=ft(ue,an,ge,M,D,we,f,F,sn),Xe.push(we),nt=de.sub(we)}ye=nt.mag()}const _t=nt._mult((Ve-Oe)/ye)._add(we||Ce),Rt=$+Math.atan2(ge.y-Ce.y,ge.x-Ce.x);return Xe.push(_t),{point:_t,angle:N?Rt:0,path:Xe}}const rt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nn(S,c){for(let f=0;f<S;f++){const y=c.length;c.resize(y+4),c.float32.set(rt,3*y)}}const fn=100;class Hn{constructor(c,f,y=new Ae(c.width+200,c.height+200,25),x=new Ae(c.width+200,c.height+200,25)){this.transform=c,this.mapProjection=f,this.grid=y,this.ignoredGrid=x,this.pitchFactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+fn,this.screenBottomBoundary=c.height+fn,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(c,f,y,x,M,D,F,N,G,q,$){const re=c.anchorPointX+N[0],ue=c.anchorPointY+N[1],de=this.projectAndGetPerspectiveRatio(x,re,ue,M,q),we=this._projectCollisionBox(c,y,x,M,D,F,N,de,q,$),[ge,Ce,Oe,ye]=we.box;return this.mapProjection.useSpecialProjectionForSymbols&&(D?we.allPointsOccluded:this.mapProjection.isOccluded(re,ue,M))||de.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ge,Ce,Oe,ye)||f!=="always"&&this.grid.hitTest(ge,Ce,Oe,ye,f,G)?{box:[ge,Ce,Oe,ye],placeable:!1,offscreen:!1}:{box:[ge,Ce,Oe,ye],placeable:!0,offscreen:this.isOffscreen(ge,Ce,Oe,ye)}}placeCollisionCircles(c,f,y,x,M,D,F,N,G,q,$,re,ue,de,we,ge){const Ce=[],Oe=new o.P(f.anchorX,f.anchorY),ye=this.getPerspectiveRatio(D,Oe.x,Oe.y,F,ge),Ve=($?M/ye:M*ye)/o.ap,Xe={getElevation:ge,labelPlaneMatrix:N,lineVertexArray:y,pitchWithMap:$,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Oe,unwrappedTileID:F,width:this.transform.width,height:this.transform.height,translation:we},nt=ne(Ve,x,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,f,!1,Xe);let _t=!1,Rt=!1,sn=!0;if(nt){const an=.5*ue*ye+de,Dt=new o.P(-100,-100),Nt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),yn=new In,qn=nt.first,$t=nt.last;let Jt=[];for(let ri=qn.path.length-1;ri>=1;ri--)Jt.push(qn.path[ri]);for(let ri=1;ri<$t.path.length;ri++)Jt.push($t.path[ri]);const Gn=2.5*an;if(G){const ri=this.projectPathToScreenSpace(Jt,Xe,G);Jt=ri.some(di=>di.signedDistanceFromCamera<=0)?[]:ri.map(di=>di.point)}let fr=[];if(Jt.length>0){const ri=Jt[0].clone(),di=Jt[0].clone();for(let pr=1;pr<Jt.length;pr++)ri.x=Math.min(ri.x,Jt[pr].x),ri.y=Math.min(ri.y,Jt[pr].y),di.x=Math.max(di.x,Jt[pr].x),di.y=Math.max(di.y,Jt[pr].y);fr=ri.x>=Dt.x&&di.x<=Nt.x&&ri.y>=Dt.y&&di.y<=Nt.y?[Jt]:di.x<Dt.x||ri.x>Nt.x||di.y<Dt.y||ri.y>Nt.y?[]:o.al([Jt],Dt.x,Dt.y,Nt.x,Nt.y)}for(const ri of fr){yn.reset(ri,.25*an);let di=0;di=yn.length<=.5*an?1:Math.ceil(yn.paddedLength/Gn)+1;for(let pr=0;pr<di;pr++){const vs=pr/Math.max(di-1,1),pa=yn.lerp(vs),mr=pa.x+fn,to=pa.y+fn;Ce.push(mr,to,an,0);const Bs=mr-an,xs=to-an,ws=mr+an,ma=to+an;if(sn=sn&&this.isOffscreen(Bs,xs,ws,ma),Rt=Rt||this.isInsideGrid(Bs,xs,ws,ma),c!=="always"&&this.grid.hitTestCircle(mr,to,an,c,re)&&(_t=!0,!q))return{circles:[],offscreen:!1,collisionDetected:_t}}}}return{circles:!q&&_t||!Rt||ye<this.perspectiveRatioCutoff?[]:Ce,offscreen:sn,collisionDetected:_t}}projectPathToScreenSpace(c,f,y){return c.map(x=>ht(x,y,f.getElevation))}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let y=1/0,x=1/0,M=-1/0,D=-1/0;for(const q of c){const $=new o.P(q.x+fn,q.y+fn);y=Math.min(y,$.x),x=Math.min(x,$.y),M=Math.max(M,$.x),D=Math.max(D,$.y),f.push($)}const F=this.grid.query(y,x,M,D).concat(this.ignoredGrid.query(y,x,M,D)),N={},G={};for(const q of F){const $=q.key;if(N[$.bucketInstanceId]===void 0&&(N[$.bucketInstanceId]={}),N[$.bucketInstanceId][$.featureIndex])continue;const re=[new o.P(q.x1,q.y1),new o.P(q.x2,q.y1),new o.P(q.x2,q.y2),new o.P(q.x1,q.y2)];o.am(f,re)&&(N[$.bucketInstanceId][$.featureIndex]=!0,G[$.bucketInstanceId]===void 0&&(G[$.bucketInstanceId]=[]),G[$.bucketInstanceId].push($.featureIndex))}return G}insertCollisionBox(c,f,y,x,M,D){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:x,featureIndex:M,collisionGroupID:D,overlapMode:f},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,f,y,x,M,D){const F=y?this.ignoredGrid:this.grid,N={bucketInstanceId:x,featureIndex:M,collisionGroupID:D,overlapMode:f};for(let G=0;G<c.length;G+=4)F.insertCircle(N,c[G],c[G+1],c[G+2])}projectAndGetPerspectiveRatio(c,f,y,x,M){const D=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,y,x,M):ht(new o.P(f,y),c,M);return{point:new o.P((D.point.x+1)/2*this.transform.width+fn,(1-D.point.y)/2*this.transform.height+fn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/D.signedDistanceFromCamera*.5,isOccluded:D.isOccluded,signedDistanceFromCamera:D.signedDistanceFromCamera}}getPerspectiveRatio(c,f,y,x,M){const D=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(f,y,x,M):ht(new o.P(f,y),c,M);return .5+this.transform.cameraToCenterDistance/D.signedDistanceFromCamera*.5}isOffscreen(c,f,y,x){return y<fn||c>=this.screenRightBoundary||x<fn||f>this.screenBottomBoundary}isInsideGrid(c,f,y,x){return y>=0&&c<this.gridRightBoundary&&x>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const c=o.an([]);return o.H(c,c,[-100,-100,0]),c}_projectCollisionBox(c,f,y,x,M,D,F,N,G,q){const $=f*N.perspectiveRatio;let re=new o.P(1,0),ue=new o.P(0,1);const de=new o.P(c.anchorPointX+F[0],c.anchorPointY+F[1]);if(D&&!M){const an=this.projectAndGetPerspectiveRatio(y,de.x+1,de.y,x,G).point.sub(N.point).unit(),Dt=Math.atan(an.y/an.x)+(an.x<0?Math.PI:0),Nt=Math.sin(Dt),yn=Math.cos(Dt);re=new o.P(yn,Nt),ue=new o.P(-Nt,yn)}else if(!D&&M){const an=-this.transform.angle,Dt=Math.sin(an),Nt=Math.cos(an);re=new o.P(Nt,Dt),ue=new o.P(-Dt,Nt)}let we=N.point,ge=$;if(M){we=de;const an=this.transform.zoom-Math.floor(this.transform.zoom);ge=Math.pow(2,-an),ge*=this.mapProjection.getPitchedTextCorrection(this.transform,de,x),q||(ge*=o.ac(.5+N.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}q&&(we=we.add(re.mult(q.x*ge)).add(ue.mult(q.y*ge)));const Ce=c.x1*ge,Oe=c.x2*ge,ye=(Ce+Oe)/2,Ve=c.y1*ge,Xe=c.y2*ge,nt=(Ve+Xe)/2,_t=[{offsetX:Ce,offsetY:Ve},{offsetX:ye,offsetY:Ve},{offsetX:Oe,offsetY:Ve},{offsetX:Oe,offsetY:nt},{offsetX:Oe,offsetY:Xe},{offsetX:ye,offsetY:Xe},{offsetX:Ce,offsetY:Xe},{offsetX:Ce,offsetY:nt}];let Rt=[];for(const{offsetX:an,offsetY:Dt}of _t)Rt.push(new o.P(we.x+re.x*an+ue.x*Dt,we.y+re.y*an+ue.y*Dt));let sn=!1;if(M){const an=Rt.map(Dt=>this.projectAndGetPerspectiveRatio(y,Dt.x,Dt.y,x,G));sn=an.some(Dt=>!Dt.isOccluded),Rt=an.map(Dt=>Dt.point)}else sn=!0;return{box:o.ao(Rt),allPointsOccluded:!sn}}}function Fn(S,c,f){return c*(o.W/(S.tileSize*Math.pow(2,f-S.tileID.overscaledZ)))}class ni{constructor(c,f,y,x){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):x&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class wi{constructor(c,f,y,x,M){this.text=new ni(c?c.text:null,f,y,M),this.icon=new ni(c?c.icon:null,f,x,M)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ui{constructor(c,f,y){this.text=c,this.icon=f,this.skipFade=y}}class yr{constructor(){this.invProjMatrix=o.F(),this.viewportMatrix=o.F(),this.circles=[]}}class oe{constructor(c,f,y,x,M){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=y,this.bucketIndex=x,this.tileID=M}}class Be{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:y=>y.collisionGroupID===f}}return this.collisionGroups[c]}}function Qe(S,c,f,y,x){const{horizontalAlign:M,verticalAlign:D}=o.au(S);return new o.P(-(M-.5)*c+y[0]*x,-(D-.5)*f+y[1]*x)}class it{constructor(c,f,y,x,M,D){this.transform=c.clone(),this.terrain=y,this.collisionIndex=new Hn(this.transform,f),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=x,this.retainedQueryData={},this.collisionGroups=new Be(M),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=D,D&&(D.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(c){const f=this.terrain;return f?(y,x)=>f.getElevation(c,y,x):null}getBucketParts(c,f,y,x){const M=y.getBucket(f),D=y.latestFeatureIndex;if(!M||!D||f.id!==M.layerIds[0])return;const F=y.collisionBoxArray,N=M.layers[0].layout,G=M.layers[0].paint,q=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),$=y.tileSize/o.W,re=y.tileID.toUnwrapped(),ue=this.transform.calculatePosMatrix(re),de=N.get("text-pitch-alignment")==="map",we=N.get("text-rotation-alignment")==="map",ge=Fn(y,1,this.transform.zoom),Ce=this.collisionIndex.mapProjection.translatePosition(this.transform,y,G.get("text-translate"),G.get("text-translate-anchor")),Oe=this.collisionIndex.mapProjection.translatePosition(this.transform,y,G.get("icon-translate"),G.get("icon-translate-anchor")),ye=Lt(ue,de,we,this.transform,ge);let Ve=null;if(de){const nt=gt(ue,de,we,this.transform,ge);Ve=o.K([],this.transform.labelPlaneMatrix,nt)}this.retainedQueryData[M.bucketInstanceId]=new oe(M.bucketInstanceId,D,M.sourceLayerIndex,M.index,y.tileID);const Xe={bucket:M,layout:N,translationText:Ce,translationIcon:Oe,posMatrix:ue,unwrappedTileID:re,textLabelPlaneMatrix:ye,labelToScreenMatrix:Ve,scale:q,textPixelRatio:$,holdingForFade:y.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:o.ag(M.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(x)for(const nt of M.sortKeyRanges){const{sortKey:_t,symbolInstanceStart:Rt,symbolInstanceEnd:sn}=nt;c.push({sortKey:_t,symbolInstanceStart:Rt,symbolInstanceEnd:sn,parameters:Xe})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:Xe})}attemptAnchorPlacement(c,f,y,x,M,D,F,N,G,q,$,re,ue,de,we,ge,Ce,Oe,ye){const Ve=o.aq[c.textAnchor],Xe=[c.textOffset0,c.textOffset1],nt=Qe(Ve,y,x,Xe,M),_t=this.collisionIndex.placeCollisionBox(f,re,N,G,q,F,D,ge,$.predicate,ye,nt);if((!Oe||this.collisionIndex.placeCollisionBox(Oe,re,N,G,q,F,D,Ce,$.predicate,ye,nt).placeable)&&_t.placeable){let Rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID]&&this.prevPlacement.placements[ue.crossTileID].text&&(Rt=this.prevPlacement.variableOffsets[ue.crossTileID].anchor),ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ue.crossTileID]={textOffset:Xe,width:y,height:x,anchor:Ve,textBoxScale:M,prevAnchor:Rt},this.markUsedJustification(de,Ve,ue,we),de.allowVerticalPlacement&&(this.markUsedOrientation(de,we,ue),this.placedOrientations[ue.crossTileID]=we),{shift:nt,placedGlyphBoxes:_t}}}placeLayerBucketPart(c,f,y){const{bucket:x,layout:M,translationText:D,translationIcon:F,posMatrix:N,unwrappedTileID:G,textLabelPlaneMatrix:q,labelToScreenMatrix:$,textPixelRatio:re,holdingForFade:ue,collisionBoxArray:de,partiallyEvaluatedTextSize:we,collisionGroup:ge}=c.parameters,Ce=M.get("text-optional"),Oe=M.get("icon-optional"),ye=o.ar(M,"text-overlap","text-allow-overlap"),Ve=ye==="always",Xe=o.ar(M,"icon-overlap","icon-allow-overlap"),nt=Xe==="always",_t=M.get("text-rotation-alignment")==="map",Rt=M.get("text-pitch-alignment")==="map",sn=M.get("icon-text-fit")!=="none",an=M.get("symbol-z-order")==="viewport-y",Dt=Ve&&(nt||!x.hasIconData()||Oe),Nt=nt&&(Ve||!x.hasTextData()||Ce);!x.collisionArrays&&de&&x.deserializeCollisionBoxes(de);const yn=this._getTerrainElevationFunc(this.retainedQueryData[x.bucketInstanceId].tileID),qn=($t,Jt,Gn)=>{var fr,ri;if(f[$t.crossTileID])return;if(ue)return void(this.placements[$t.crossTileID]=new Ui(!1,!1,!1));let di=!1,pr=!1,vs=!0,pa=null,mr={box:null,placeable:!1,offscreen:null},to={box:null,placeable:!1,offscreen:null},Bs=null,xs=null,ws=null,ma=0,su=0,cp=0;Jt.textFeatureIndex?ma=Jt.textFeatureIndex:$t.useRuntimeCollisionCircles&&(ma=$t.featureIndex),Jt.verticalTextFeatureIndex&&(su=Jt.verticalTextFeatureIndex);const gh=Jt.textBox;if(gh){const hs=bs=>{let Ss=o.ah.horizontal;if(x.allowVerticalPlacement&&!bs&&this.prevPlacement){const is=this.prevPlacement.placedOrientations[$t.crossTileID];is&&(this.placedOrientations[$t.crossTileID]=is,Ss=is,this.markUsedOrientation(x,Ss,$t))}return Ss},ga=(bs,Ss)=>{if(x.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Jt.verticalTextBox){for(const is of x.writingModes)if(is===o.ah.vertical?(mr=Ss(),to=mr):mr=bs(),mr&&mr.placeable)break}else mr=bs()},hc=$t.textAnchorOffsetStartIndex,_h=$t.textAnchorOffsetEndIndex;if(_h===hc){const bs=(Ss,is)=>{const xr=this.collisionIndex.placeCollisionBox(Ss,ye,re,N,G,Rt,_t,D,ge.predicate,yn);return xr&&xr.placeable&&(this.markUsedOrientation(x,is,$t),this.placedOrientations[$t.crossTileID]=is),xr};ga(()=>bs(gh,o.ah.horizontal),()=>{const Ss=Jt.verticalTextBox;return x.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Ss?bs(Ss,o.ah.vertical):{box:null,offscreen:null}}),hs(mr&&mr.placeable)}else{let bs=o.aq[(ri=(fr=this.prevPlacement)===null||fr===void 0?void 0:fr.variableOffsets[$t.crossTileID])===null||ri===void 0?void 0:ri.anchor];const Ss=(xr,yh,n_)=>{const Yr=xr.x2-xr.x1,cv=xr.y2-xr.y1,hp=$t.textBoxScale,dp=sn&&Xe==="never"?yh:null;let dc=null,uv=ye==="never"?1:2,i_="never";bs&&uv++;for(let r_=0;r_<uv;r_++){for(let s_=hc;s_<_h;s_++){const fp=x.textAnchorOffsets.get(s_);if(bs&&fp.textAnchor!==bs)continue;const vh=this.attemptAnchorPlacement(fp,xr,Yr,cv,hp,_t,Rt,re,N,G,ge,i_,$t,x,n_,D,F,dp,yn);if(vh&&(dc=vh.placedGlyphBoxes,dc&&dc.placeable))return di=!0,pa=vh.shift,dc}bs?bs=null:i_=ye}return y&&!dc&&(dc={box:this.collisionIndex.placeCollisionBox(gh,"always",re,N,G,Rt,_t,D,ge.predicate,yn,new o.P(0,0)).box,offscreen:!1,placeable:!1}),dc};ga(()=>Ss(gh,Jt.iconBox,o.ah.horizontal),()=>{const xr=Jt.verticalTextBox;return x.allowVerticalPlacement&&(!mr||!mr.placeable)&&$t.numVerticalGlyphVertices>0&&xr?Ss(xr,Jt.verticalIconBox,o.ah.vertical):{box:null,occluded:!0,offscreen:null}}),mr&&(di=mr.placeable,vs=mr.offscreen);const is=hs(mr&&mr.placeable);if(!di&&this.prevPlacement){const xr=this.prevPlacement.variableOffsets[$t.crossTileID];xr&&(this.variableOffsets[$t.crossTileID]=xr,this.markUsedJustification(x,xr.anchor,$t,is))}}}if(Bs=mr,di=Bs&&Bs.placeable,vs=Bs&&Bs.offscreen,$t.useRuntimeCollisionCircles){const hs=x.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),ga=o.ai(x.textSizeData,we,hs),hc=M.get("text-padding");xs=this.collisionIndex.placeCollisionCircles(ye,hs,x.lineVertexArray,x.glyphOffsetArray,ga,N,G,q,$,y,Rt,ge.predicate,$t.collisionCircleDiameter,hc,D,yn),xs.circles.length&&xs.collisionDetected&&!y&&o.w("Collisions detected, but collision boxes are not shown"),di=Ve||xs.circles.length>0&&!xs.collisionDetected,vs=vs&&xs.offscreen}if(Jt.iconFeatureIndex&&(cp=Jt.iconFeatureIndex),Jt.iconBox){const hs=ga=>this.collisionIndex.placeCollisionBox(ga,Xe,re,N,G,Rt,_t,F,ge.predicate,yn,sn&&pa?pa:void 0);to&&to.placeable&&Jt.verticalIconBox?(ws=hs(Jt.verticalIconBox),pr=ws.placeable):(ws=hs(Jt.iconBox),pr=ws.placeable),vs=vs&&ws.offscreen}const ou=Ce||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,up=Oe||$t.numIconVertices===0;ou||up?up?ou||(pr=pr&&di):di=pr&&di:pr=di=pr&&di;const t_=pr&&ws.placeable;if(di&&Bs.placeable&&this.collisionIndex.insertCollisionBox(Bs.box,ye,M.get("text-ignore-placement"),x.bucketInstanceId,to&&to.placeable&&su?su:ma,ge.ID),t_&&this.collisionIndex.insertCollisionBox(ws.box,Xe,M.get("icon-ignore-placement"),x.bucketInstanceId,cp,ge.ID),xs&&di&&this.collisionIndex.insertCollisionCircles(xs.circles,ye,M.get("text-ignore-placement"),x.bucketInstanceId,ma,ge.ID),y&&this.storeCollisionData(x.bucketInstanceId,Gn,Jt,Bs,ws,xs),$t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(x.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Ui(di||Dt,pr||Nt,vs||x.justReloaded),f[$t.crossTileID]=!0};if(an){if(c.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=x.getSortedSymbolIndexes(this.transform.angle);for(let Jt=$t.length-1;Jt>=0;--Jt){const Gn=$t[Jt];qn(x.symbolInstances.get(Gn),x.collisionArrays[Gn],Gn)}}else for(let $t=c.symbolInstanceStart;$t<c.symbolInstanceEnd;$t++)qn(x.symbolInstances.get($t),x.collisionArrays[$t],$t);if(y&&x.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[x.bucketInstanceId];o.as($t.invProjMatrix,N),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}storeCollisionData(c,f,y,x,M,D){if(y.textBox||y.iconBox){let F,N;this.collisionBoxArrays.has(c)?F=this.collisionBoxArrays.get(c):(F=new Map,this.collisionBoxArrays.set(c,F)),F.has(f)?N=F.get(f):(N={text:null,icon:null},F.set(f,N)),y.textBox&&(N.text=x.box),y.iconBox&&(N.icon=M.box)}if(D){let F=this.collisionCircleArrays[c];F===void 0&&(F=this.collisionCircleArrays[c]=new yr);for(let N=0;N<D.circles.length;N+=4)F.circles.push(D.circles[N+0]),F.circles.push(D.circles[N+1]),F.circles.push(D.circles[N+2]),F.circles.push(D.collisionDetected?1:0)}}markUsedJustification(c,f,y,x){let M;M=x===o.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[o.at(f)];const D=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const F of D)F>=0&&(c.text.placedSymbolArray.get(F).crossTileID=M>=0&&F!==M?0:y.crossTileID)}markUsedOrientation(c,f,y){const x=f===o.ah.horizontal||f===o.ah.horizontalOnly?f:0,M=f===o.ah.vertical?f:0,D=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const F of D)c.text.placedSymbolArray.get(F).placedOrientation=x;y.verticalPlacedTextSymbolIndex&&(c.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=M)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let y=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const x=f?f.symbolFadeChange(c):1,M=f?f.opacities:{},D=f?f.variableOffsets:{},F=f?f.placedOrientations:{};for(const N in this.placements){const G=this.placements[N],q=M[N];q?(this.opacities[N]=new wi(q,x,G.text,G.icon),y=y||G.text!==q.text.placed||G.icon!==q.icon.placed):(this.opacities[N]=new wi(null,x,G.text,G.icon,G.skipFade),y=y||G.text||G.icon)}for(const N in M){const G=M[N];if(!this.opacities[N]){const q=new wi(G,x,!1,!1);q.isHidden()||(this.opacities[N]=q,y=y||G.text.placed||G.icon.placed)}}for(const N in D)this.variableOffsets[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.variableOffsets[N]=D[N]);for(const N in F)this.placedOrientations[N]||!this.opacities[N]||this.opacities[N].isHidden()||(this.placedOrientations[N]=F[N]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)}updateLayerOpacities(c,f){const y={};for(const x of f){const M=x.getBucket(c);M&&x.latestFeatureIndex&&c.id===M.layerIds[0]&&this.updateBucketOpacities(M,x.tileID,y,x.collisionBoxArray)}}updateBucketOpacities(c,f,y,x){c.hasTextData()&&(c.text.opacityVertexArray.clear(),c.text.hasVisibleVertices=!1),c.hasIconData()&&(c.icon.opacityVertexArray.clear(),c.icon.hasVisibleVertices=!1),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const M=c.layers[0],D=M.layout,F=new wi(null,0,!1,!1,!0),N=D.get("text-allow-overlap"),G=D.get("icon-allow-overlap"),q=M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=D.get("text-rotation-alignment")==="map",re=D.get("text-pitch-alignment")==="map",ue=D.get("icon-text-fit")!=="none",de=new wi(null,0,N&&(G||!c.hasIconData()||D.get("icon-optional")),G&&(N||!c.hasTextData()||D.get("text-optional")),!0);!c.collisionArrays&&x&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(x);const we=(Ce,Oe,ye)=>{for(let Ve=0;Ve<Oe/4;Ve++)Ce.opacityVertexArray.emplaceBack(ye);Ce.hasVisibleVertices=Ce.hasVisibleVertices||ye!==ki},ge=this.collisionBoxArrays.get(c.bucketInstanceId);for(let Ce=0;Ce<c.symbolInstances.length;Ce++){const Oe=c.symbolInstances.get(Ce),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:Ve,crossTileID:Xe}=Oe;let nt=this.opacities[Xe];y[Xe]?nt=F:nt||(nt=de,this.opacities[Xe]=nt),y[Xe]=!0;const _t=Oe.numIconVertices>0,Rt=this.placedOrientations[Oe.crossTileID],sn=Rt===o.ah.vertical,an=Rt===o.ah.horizontal||Rt===o.ah.horizontalOnly;if(ye>0||Ve>0){const Nt=Kn(nt.text);we(c.text,ye,sn?ki:Nt),we(c.text,Ve,an?ki:Nt);const yn=nt.text.isHidden();[Oe.rightJustifiedTextSymbolIndex,Oe.centerJustifiedTextSymbolIndex,Oe.leftJustifiedTextSymbolIndex].forEach(Jt=>{Jt>=0&&(c.text.placedSymbolArray.get(Jt).hidden=yn||sn?1:0)}),Oe.verticalPlacedTextSymbolIndex>=0&&(c.text.placedSymbolArray.get(Oe.verticalPlacedTextSymbolIndex).hidden=yn||an?1:0);const qn=this.variableOffsets[Oe.crossTileID];qn&&this.markUsedJustification(c,qn.anchor,Oe,Rt);const $t=this.placedOrientations[Oe.crossTileID];$t&&(this.markUsedJustification(c,"left",Oe,$t),this.markUsedOrientation(c,$t,Oe))}if(_t){const Nt=Kn(nt.icon),yn=!(ue&&Oe.verticalPlacedIconSymbolIndex&&sn);Oe.placedIconSymbolIndex>=0&&(we(c.icon,Oe.numIconVertices,yn?Nt:ki),c.icon.placedSymbolArray.get(Oe.placedIconSymbolIndex).hidden=nt.icon.isHidden()),Oe.verticalPlacedIconSymbolIndex>=0&&(we(c.icon,Oe.numVerticalIconVertices,yn?ki:Nt),c.icon.placedSymbolArray.get(Oe.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}const Dt=ge&&ge.has(Ce)?ge.get(Ce):{text:null,icon:null};if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const Nt=c.collisionArrays[Ce];if(Nt){let yn=new o.P(0,0);if(Nt.textBox||Nt.verticalTextBox){let qn=!0;if(q){const $t=this.variableOffsets[Xe];$t?(yn=Qe($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),$&&yn._rotate(re?this.transform.angle:-this.transform.angle)):qn=!1}if(Nt.textBox||Nt.verticalTextBox){let $t;Nt.textBox&&($t=sn),Nt.verticalTextBox&&($t=an),$e(c.textCollisionBox.collisionVertexArray,nt.text.placed,!qn||$t,Dt.text,yn.x,yn.y)}}if(Nt.iconBox||Nt.verticalIconBox){const qn=!!(!an&&Nt.verticalIconBox);let $t;Nt.iconBox&&($t=qn),Nt.verticalIconBox&&($t=!qn),$e(c.iconCollisionBox.collisionVertexArray,nt.icon.placed,$t,Dt.icon,ue?yn.x:0,ue?yn.y:0)}}}}if(c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.text.opacityVertexArray.length!==c.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${c.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${c.text.layoutVertexArray.length}) / 4`);if(c.icon.opacityVertexArray.length!==c.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${c.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${c.icon.layoutVertexArray.length}) / 4`);if(c.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=Ce.invProjMatrix,c.placementViewportMatrix=Ce.viewportMatrix,c.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,f){const y=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*y>c}setStale(){this.stale=!0}}function $e(S,c,f,y,x,M){y&&y.length!==0||(y=[0,0,0,0]);const D=y[0]-fn,F=y[1]-fn,N=y[2]-fn,G=y[3]-fn;S.emplaceBack(c?1:0,f?1:0,x||0,M||0,D,F),S.emplaceBack(c?1:0,f?1:0,x||0,M||0,N,F),S.emplaceBack(c?1:0,f?1:0,x||0,M||0,N,G),S.emplaceBack(c?1:0,f?1:0,x||0,M||0,D,G)}const Pt=Math.pow(2,25),rn=Math.pow(2,24),Cn=Math.pow(2,17),Ft=Math.pow(2,16),zn=Math.pow(2,9),Un=Math.pow(2,8),Zt=Math.pow(2,1);function Kn(S){if(S.opacity===0&&!S.placed)return 0;if(S.opacity===1&&S.placed)return 4294967295;const c=S.placed?1:0,f=Math.floor(127*S.opacity);return f*Pt+c*rn+f*Cn+c*Ft+f*zn+c*Un+f*Zt+c}const ki=0;function Qn(){return{isOccluded:(S,c,f)=>!1,getPitchedTextCorrection:(S,c,f)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(S,c,f,y){throw new Error("Not implemented.")},translatePosition:(S,c,f,y)=>function(x,M,D,F,N=!1){if(!D[0]&&!D[1])return[0,0];const G=N?F==="map"?x.angle:0:F==="viewport"?-x.angle:0;if(G){const q=Math.sin(G),$=Math.cos(G);D=[D[0]*$-D[1]*q,D[0]*q+D[1]*$]}return[N?D[0]:Fn(M,D[0],x.zoom),N?D[1]:Fn(M,D[1],x.zoom)]}(S,c,f,y),getCircleRadiusCorrection:S=>1}}class vi{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&!c.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(c,f,y,x,M){const D=this._bucketParts;for(;this._currentTileIndex<c.length;)if(f.getBucketParts(D,x,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,D.sort((F,N)=>F.sortKey-N.sortKey));this._currentPartIndex<D.length;)if(f.placeLayerBucketPart(D[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,M())return!0;return!1}}class pi{constructor(c,f,y,x,M,D,F,N){this.placement=new it(c,Qn(),f,D,F,N),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=x,this._showCollisionBoxes=M,this._done=!1}isDone(){return this._done}continuePlacement(c,f,y){const x=_.now(),M=()=>!this._forceFullPlacement&&_.now()-x>2;for(;this._currentPlacementIndex>=0;){const D=f[c[this._currentPlacementIndex]],F=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&(!D.minzoom||D.minzoom<=F)&&(!D.maxzoom||D.maxzoom>F)){if(this._inProgressLayer||(this._inProgressLayer=new vi(D)),this._inProgressLayer.continuePlacement(y[D.source],this.placement,this._showCollisionBoxes,D,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const pn=512/o.W/2;class ei{constructor(c,f,y){this.tileID=c,this.bucketInstanceId=y,this._symbolsByKey={};const x=new Map;for(let M=0;M<f.length;M++){const D=f.get(M),F=D.key,N=x.get(F);N?N.push(D):x.set(F,[D])}for(const[M,D]of x){const F={positions:D.map(N=>({x:Math.floor(N.anchorX*pn),y:Math.floor(N.anchorY*pn)})),crossTileIDs:D.map(N=>N.crossTileID)};if(F.positions.length>128){const N=new o.av(F.positions.length,16,Uint16Array);for(const{x:G,y:q}of F.positions)N.add(G,q);N.finish(),delete F.positions,F.index=N}this._symbolsByKey[M]=F}}getScaledCoordinates(c,f){const{x:y,y:x,z:M}=this.tileID.canonical,{x:D,y:F,z:N}=f.canonical,G=pn/Math.pow(2,N-M),q=(F*o.W+c.anchorY)*G,$=x*o.W*pn;return{x:Math.floor((D*o.W+c.anchorX)*G-y*o.W*pn),y:Math.floor(q-$)}}findMatches(c,f,y){const x=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let M=0;M<c.length;M++){const D=c.get(M);if(D.crossTileID)continue;const F=this._symbolsByKey[D.key];if(!F)continue;const N=this.getScaledCoordinates(D,f);if(F.index){const G=F.index.range(N.x-x,N.y-x,N.x+x,N.y+x).sort();for(const q of G){const $=F.crossTileIDs[q];if(!y[$]){y[$]=!0,D.crossTileID=$;break}}}else if(F.positions)for(let G=0;G<F.positions.length;G++){const q=F.positions[G],$=F.crossTileIDs[G];if(Math.abs(q.x-N.x)<=x&&Math.abs(q.y-N.y)<=x&&!y[$]){y[$]=!0,D.crossTileID=$;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:c})=>c)}}class hi{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Or{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const f=Math.round((c-this.lng)/360);if(f!==0)for(const y in this.indexes){const x=this.indexes[y],M={};for(const D in x){const F=x[D];F.tileID=F.tileID.unwrapTo(F.tileID.wrap+f),M[F.tileID.key]=F}this.indexes[y]=M}this.lng=c}addBucket(c,f,y){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let M=0;M<f.symbolInstances.length;M++)f.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]={});const x=this.usedCrossTileIDs[c.overscaledZ];for(const M in this.indexes){const D=this.indexes[M];if(Number(M)>c.overscaledZ)for(const F in D){const N=D[F];N.tileID.isChildOf(c)&&N.findMatches(f.symbolInstances,c,x)}else{const F=D[c.scaledTo(Number(M)).key];F&&F.findMatches(f.symbolInstances,c,x)}}for(let M=0;M<f.symbolInstances.length;M++){const D=f.symbolInstances.get(M);D.crossTileID||(D.crossTileID=y.generate(),x[D.crossTileID]=!0)}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new ei(c,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(c,f){for(const y of f.getCrossTileIDsLists())for(const x of y)delete this.usedCrossTileIDs[c][x]}removeStaleBuckets(c){let f=!1;for(const y in this.indexes){const x=this.indexes[y];for(const M in x)c[x[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,x[M]),delete x[M],f=!0)}return f}}class Fi{constructor(){this.layerIndexes={},this.crossTileIDs=new hi,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,f,y){let x=this.layerIndexes[c.id];x===void 0&&(x=this.layerIndexes[c.id]=new Or);let M=!1;const D={};x.handleWrapJump(y);for(const F of f){const N=F.getBucket(c);N&&c.id===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(F.tileID,N,this.crossTileIDs)&&(M=!0),D[N.bucketInstanceId]=!0)}return x.removeStaleBuckets(D)&&(M=!0),M}pruneUnusedLayers(c){const f={};c.forEach(y=>{f[y]=!0});for(const y in this.layerIndexes)f[y]||delete this.layerIndexes[y]}}const br=(S,c)=>o.t(S,c&&c.filter(f=>f.identifier!=="source.canvas")),ns=o.aw();class Hi extends o.E{constructor(c,f={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const x=this.sourceCaches[y].getSource().type;x!=="vector"&&x!=="geojson"||this.sourceCaches[y].reload()}},this.map=c,this.dispatcher=new vn(It(),c._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,x)=>this.getGlyphs(y,x)),this.dispatcher.registerMessageHandler("GI",(y,x)=>this.getImages(y,x)),this.imageManager=new Fe,this.imageManager.setEventedParent(this),this.glyphManager=new st(c._requestManager,f.localIdeographFontFamily),this.lineAtlas=new dt(256,512),this.crossTileSymbolIndex=new Fi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",o.ay()),cn().on(hn,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.sourceCaches[y.sourceId];if(!x)return;const M=x.getSource();if(M&&M.vectorLayerIds)for(const D in this._layers){const F=this._layers[D];F.source===M.id&&this._validateLayer(F)}})}loadURL(c,f={},y){this.fire(new o.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const x=this.map._requestManager.transformRequest(c,"Style");this._loadStyleRequest=new AbortController,o.h(x,this._loadStyleRequest).then(M=>{this._loadStyleRequest=null,this._load(M.data,f,y)}).catch(M=>{this._loadStyleRequest=null,M&&this.fire(new o.j(M))})}loadJSON(c,f={},y){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(c,f,y)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(ns,{validate:!1})}_load(c,f,y){var x;const M=f.transformStyle?f.transformStyle(y,c):c;if(!f.validate||!br(this,o.x(M))){this._loaded=!0,this.stylesheet=M;for(const D in M.sources)this.addSource(D,M.sources[D],{validate:!1});M.sprite?this._loadSprite(M.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(M.glyphs),this._createLayers(),this.light=new ot(this.stylesheet.light),this.map.setTerrain((x=this.stylesheet.terrain)!==null&&x!==void 0?x:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const c=o.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",c),this._order=c.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of c){const y=o.aA(f);y.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=y}}_loadSprite(c,f=!1,y=void 0){let x;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(M,D,F,N){return o._(this,void 0,void 0,function*(){const G=K(M),q=F>1?"@2x":"",$={},re={};for(const{id:ue,url:de}of G){const we=D.transformRequest(Q(de,q,".json"),"SpriteJSON");$[ue]=o.h(we,N);const ge=D.transformRequest(Q(de,q,".png"),"SpriteImage");re[ue]=z.getImage(ge,N)}return yield Promise.all([...Object.values($),...Object.values(re)]),function(ue,de){return o._(this,void 0,void 0,function*(){const we={};for(const ge in ue){we[ge]={};const Ce=_.getImageCanvasContext((yield de[ge]).data),Oe=(yield ue[ge]).data;for(const ye in Oe){const{width:Ve,height:Xe,x:nt,y:_t,sdf:Rt,pixelRatio:sn,stretchX:an,stretchY:Dt,content:Nt,textFitWidth:yn,textFitHeight:qn}=Oe[ye];we[ge][ye]={data:null,pixelRatio:sn,sdf:Rt,stretchX:an,stretchY:Dt,content:Nt,textFitWidth:yn,textFitHeight:qn,spriteData:{width:Ve,height:Xe,x:nt,y:_t,context:Ce}}}}return we})}($,re)})}(c,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(M=>{if(this._spriteRequest=null,M)for(const D in M){this._spritesImagesIds[D]=[];const F=this._spritesImagesIds[D]?this._spritesImagesIds[D].filter(N=>!(N in M)):[];for(const N of F)this.imageManager.removeImage(N),this._changedImages[N]=!0;for(const N in M[D]){const G=D==="default"?N:`${D}:${N}`;this._spritesImagesIds[D].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,M[D][N],!1):this.imageManager.addImage(G,M[D][N]),f&&(this._changedImages[G]=!0)}}}).catch(M=>{this._spriteRequest=null,x=M,this.fire(new o.j(x))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),y&&y(x)})}_unloadSprite(){for(const c of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(c),this._changedImages[c]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(c){const f=this.sourceCaches[c.source];if(!f)return;const y=c.sourceLayer;if(!y)return;const x=f.getSource();(x.type==="geojson"||x.vectorLayerIds&&x.vectorLayerIds.indexOf(y)===-1)&&this.fire(new o.j(new Error(`Source layer "${y}" does not exist on source "${x.id}" as specified by style layer "${c.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(c){const f=this._serializedAllLayers();if(!c||c.length===0)return Object.values(f);const y=[];for(const x of c)f[x]&&y.push(f[x]);return y}_serializedAllLayers(){let c=this._serializedLayers;if(c)return c;c=this._serializedLayers={};const f=Object.keys(this._layers);for(const y of f){const x=this._layers[y];x.type!=="custom"&&(c[y]=x.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(c){if(!this._loaded)return;const f=this._changed;if(f){const x=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(x.length||M.length)&&this._updateWorkerLayers(x,M);for(const D in this._updatedSources){const F=this._updatedSources[D];if(F==="reload")this._reloadSource(D);else{if(F!=="clear")throw new Error(`Invalid action ${F}`);this._clearSource(D)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const D in this._updatedPaintProps)this._layers[D].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}const y={};for(const x in this.sourceCaches){const M=this.sourceCaches[x];y[x]=M.used,M.used=!1}for(const x of this._order){const M=this._layers[x];M.recalculate(c,this._availableImages),!M.isHidden(c.zoom)&&M.source&&(this.sourceCaches[M.source].used=!0)}for(const x in y){const M=this.sourceCaches[x];!!y[x]!=!!M.used&&M.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:x}))}this.light.recalculate(c),this.z=c.zoom,f&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=Object.keys(this._changedImages);if(c.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(c,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(c),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(c,f={}){var y;this._checkLoaded();const x=this.serialize();if(c=f.transformStyle?f.transformStyle(x,c):c,((y=f.validate)===null||y===void 0||y)&&br(this,o.x(c)))return!1;(c=o.aB(c)).layers=o.az(c.layers);const M=o.aC(x,c),D=this._getOperationsToPerform(M);if(D.unimplemented.length>0)throw new Error(`Unimplemented: ${D.unimplemented.join(", ")}.`);if(D.operations.length===0)return!1;for(const F of D.operations)F();return this.stylesheet=c,this._serializedLayers=null,!0}_getOperationsToPerform(c){const f=[],y=[];for(const x of c)switch(x.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,x.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,x.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,x.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,x.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,x.args));break;case"addSource":f.push(()=>this.addSource.apply(this,x.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,x.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,x.args));break;case"setLight":f.push(()=>this.setLight.apply(this,x.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,x.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,x.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,x.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,x.args));break;case"setTransition":f.push(()=>{});break;default:y.push(x.command)}return{operations:f,unimplemented:y}}addImage(c,f){if(this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" already exists.`)));this.imageManager.addImage(c,f),this._afterImageUpdated(c)}updateImage(c,f){this.imageManager.updateImage(c,f)}getImage(c){return this.imageManager.getImage(c)}removeImage(c){if(!this.getImage(c))return this.fire(new o.j(new Error(`An image named "${c}" does not exist.`)));this.imageManager.removeImage(c),this._afterImageUpdated(c)}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(c,f,y={}){if(this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error(`Source "${c}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(o.x.source,`sources.${c}`,f,null,y))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const x=this.sourceCaches[c]=new lt(c,f,this.dispatcher);x.style=this,x.setEventedParent(this,()=>({isSourceLoaded:x.loaded(),source:x.serialize(),sourceId:c})),x.onAdd(this.map),this._changed=!0}removeSource(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===c)return this.fire(new o.j(new Error(`Source "${c}" cannot be removed while layer "${y}" is using it.`)));const f=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],f.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(c,f){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error(`There is no source with this ID=${c}`);const y=this.sourceCaches[c].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(f),this._changed=!0}getSource(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()}addLayer(c,f,y={}){this._checkLoaded();const x=c.id;if(this.getLayer(x))return void this.fire(new o.j(new Error(`Layer "${x}" already exists on this map.`)));let M;if(c.type==="custom"){if(br(this,o.aD(c)))return;M=o.aA(c)}else{if("source"in c&&typeof c.source=="object"&&(this.addSource(x,c.source),c=o.aB(c),c=o.e(c,{source:x})),this._validate(o.x.layer,`layers.${x}`,c,{arrayIndex:-1},y))return;M=o.aA(c),this._validateLayer(M),M.setEventedParent(this,{layer:{id:x}})}const D=f?this._order.indexOf(f):this._order.length;if(f&&D===-1)this.fire(new o.j(new Error(`Cannot add layer "${x}" before non-existing layer "${f}".`)));else{if(this._order.splice(D,0,x),this._layerOrderChanged=!0,this._layers[x]=M,this._removedLayers[x]&&M.source&&M.type!=="custom"){const F=this._removedLayers[x];delete this._removedLayers[x],F.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",this.sourceCaches[M.source].pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map)}}moveLayer(c,f){if(this._checkLoaded(),this._changed=!0,!this._layers[c])return void this.fire(new o.j(new Error(`The layer '${c}' does not exist in the map's style and cannot be moved.`)));if(c===f)return;const y=this._order.indexOf(c);this._order.splice(y,1);const x=f?this._order.indexOf(f):this._order.length;f&&x===-1?this.fire(new o.j(new Error(`Cannot move layer "${c}" before non-existing layer "${f}".`))):(this._order.splice(x,0,c),this._layerOrderChanged=!0)}removeLayer(c){this._checkLoaded();const f=this._layers[c];if(!f)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${c}".`)));f.setEventedParent(null);const y=this._order.indexOf(c);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=f,delete this._layers[c],this._serializedLayers&&delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],f.onRemove&&f.onRemove(this.map)}getLayer(c){return this._layers[c]}getLayersOrder(){return[...this._order]}hasLayer(c){return c in this._layers}setLayerZoomRange(c,f,y){this._checkLoaded();const x=this.getLayer(c);x?x.minzoom===f&&x.maxzoom===y||(f!=null&&(x.minzoom=f),y!=null&&(x.maxzoom=y),this._updateLayer(x)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${c}".`)))}setFilter(c,f,y={}){this._checkLoaded();const x=this.getLayer(c);if(x){if(!o.aE(x.filter,f))return f==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(o.x.filter,`layers.${x.id}.filter`,f,null,y)||(x.filter=o.aB(f),this._updateLayer(x)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${c}".`)))}getFilter(c){return o.aB(this.getLayer(c).filter)}setLayoutProperty(c,f,y,x={}){this._checkLoaded();const M=this.getLayer(c);M?o.aE(M.getLayoutProperty(f),y)||(M.setLayoutProperty(f,y,x),this._updateLayer(M)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getLayoutProperty(c,f){const y=this.getLayer(c);if(y)return y.getLayoutProperty(f);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${c}".`)))}setPaintProperty(c,f,y,x={}){this._checkLoaded();const M=this.getLayer(c);M?o.aE(M.getPaintProperty(f),y)||(M.setPaintProperty(f,y,x)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[c]=!0,this._serializedLayers=null):this.fire(new o.j(new Error(`Cannot style non-existing layer "${c}".`)))}getPaintProperty(c,f){return this.getLayer(c).getPaintProperty(f)}setFeatureState(c,f){this._checkLoaded();const y=c.source,x=c.sourceLayer,M=this.sourceCaches[y];if(M===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const D=M.getSource().type;D==="geojson"&&x?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||x?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),M.setFeatureState(x,c.id,f)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(c,f){this._checkLoaded();const y=c.source,x=this.sourceCaches[y];if(x===void 0)return void this.fire(new o.j(new Error(`The source '${y}' does not exist in the map's style.`)));const M=x.getSource().type,D=M==="vector"?c.sourceLayer:void 0;M!=="vector"||D?f&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):x.removeFeatureState(D,c.id,f):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(c){this._checkLoaded();const f=c.source,y=c.sourceLayer,x=this.sourceCaches[f];if(x!==void 0)return x.getSource().type!=="vector"||y?(c.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),x.getFeatureState(y,c.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const c=o.aF(this.sourceCaches,M=>M.serialize()),f=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,x=this.stylesheet;return o.aG({version:x.version,name:x.name,metadata:x.metadata,light:x.light,center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch,sprite:x.sprite,glyphs:x.glyphs,transition:x.transition,sources:c,layers:f,terrain:y},M=>M!==void 0)}_updateLayer(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(c){const f=D=>this._layers[D].type==="fill-extrusion",y={},x=[];for(let D=this._order.length-1;D>=0;D--){const F=this._order[D];if(f(F)){y[F]=D;for(const N of c){const G=N[F];if(G)for(const q of G)x.push(q)}}}x.sort((D,F)=>F.intersectionZ-D.intersectionZ);const M=[];for(let D=this._order.length-1;D>=0;D--){const F=this._order[D];if(f(F))for(let N=x.length-1;N>=0;N--){const G=x[N].feature;if(y[G.layer.id]<D)break;M.push(G),x.pop()}else for(const N of c){const G=N[F];if(G)for(const q of G)M.push(q.feature)}}return M}queryRenderedFeatures(c,f,y){f&&f.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const x={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const F of f.layers){const N=this._layers[F];if(!N)return this.fire(new o.j(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];x[N.source]=!0}}const M=[];f.availableImages=this._availableImages;const D=this._serializedAllLayers();for(const F in this.sourceCaches)f.layers&&!x[F]||M.push(Rn(this.sourceCaches[F],this._layers,D,c,f,y));return this.placement&&M.push(function(F,N,G,q,$,re,ue){const de={},we=re.queryRenderedSymbols(q),ge=[];for(const Ce of Object.keys(we).map(Number))ge.push(ue[Ce]);ge.sort(Me);for(const Ce of ge){const Oe=Ce.featureIndex.lookupSymbolFeatures(we[Ce.bucketInstanceId],N,Ce.bucketIndex,Ce.sourceLayerIndex,$.filter,$.layers,$.availableImages,F);for(const ye in Oe){const Ve=de[ye]=de[ye]||[],Xe=Oe[ye];Xe.sort((nt,_t)=>{const Rt=Ce.featureSortOrder;if(Rt){const sn=Rt.indexOf(nt.featureIndex);return Rt.indexOf(_t.featureIndex)-sn}return _t.featureIndex-nt.featureIndex});for(const nt of Xe)Ve.push(nt)}}for(const Ce in de)de[Ce].forEach(Oe=>{const ye=Oe.feature,Ve=G[F[Ce].source].getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=Ve});return de}(this._layers,D,this.sourceCaches,c,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(c,f){f&&f.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",f.filter,null,f);const y=this.sourceCaches[c];return y?function(x,M){const D=x.getRenderableIds().map(G=>x.getTileByID(G)),F=[],N={};for(let G=0;G<D.length;G++){const q=D[G],$=q.tileID.canonical.key;N[$]||(N[$]=!0,q.querySourceFeatures(F,M))}return F}(y,f):[]}getLight(){return this.light.getLight()}setLight(c,f={}){this._checkLoaded();const y=this.light.getLight();let x=!1;for(const D in c)if(!o.aE(c[D],y[D])){x=!0;break}if(!x)return;const M={now:_.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,f),this.light.updateTransitions(M)}_validate(c,f,y,x,M={}){return(!M||M.validate!==!1)&&br(this,c.call(o.x,o.e({key:f,style:this.serialize(),value:y,styleSpec:o.v},x)))}_remove(c=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),cn().off(hn,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const y=this.sourceCaches[f];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),c&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(c)}_clearSource(c){this.sourceCaches[c].clearTiles()}_reloadSource(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()}_updateSources(c){for(const f in this.sourceCaches)this.sourceCaches[f].update(c,this.map.terrain)}_generateCollisionBoxes(){for(const c in this.sourceCaches)this._reloadSource(c)}_updatePlacement(c,f,y,x,M=!1){let D=!1,F=!1;const N={};for(const G of this._order){const q=this._layers[G];if(q.type!=="symbol")continue;if(!N[q.source]){const re=this.sourceCaches[q.source];N[q.source]=re.getRenderableIds(!0).map(ue=>re.getTileByID(ue)).sort((ue,de)=>de.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(de.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(q,N[q.source],c.center.lng);D=D||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((M=M||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),c.zoom))&&(this.pauseablePlacement=new pi(c,this.map.terrain,this._order,M,f,y,x,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,N),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),F=!0),D&&this.pauseablePlacement.placement.setStale()),F||D)for(const G of this._order){const q=this._layers[G];q.type==="symbol"&&this.placement.updateLayerOpacities(q,N[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()}getImages(c,f){return o._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const x=this.sourceCaches[f.source];return x&&x.setDependencies(f.tileID.key,f.type,f.icons),y})}getGlyphs(c,f){return o._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(f.stacks),x=this.sourceCaches[f.source];return x&&x.setDependencies(f.tileID.key,f.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(c,f={}){this._checkLoaded(),c&&this._validate(o.x.glyphs,"glyphs",c,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=c,this.glyphManager.entries={},this.glyphManager.setURL(c))}addSprite(c,f,y={},x){this._checkLoaded();const M=[{id:c,url:f}],D=[...K(this.stylesheet.sprite),...M];this._validate(o.x.sprite,"sprite",D,null,y)||(this.stylesheet.sprite=D,this._loadSprite(M,!0,x))}removeSprite(c){this._checkLoaded();const f=K(this.stylesheet.sprite);if(f.find(y=>y.id===c)){if(this._spritesImagesIds[c])for(const y of this._spritesImagesIds[c])this.imageManager.removeImage(y),this._changedImages[y]=!0;f.splice(f.findIndex(y=>y.id===c),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[c],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${c}" doesn't exists on this map.`)))}getSprite(){return K(this.stylesheet.sprite)}setSprite(c,f={},y){this._checkLoaded(),c&&this._validate(o.x.sprite,"sprite",c,null,f)||(this.stylesheet.sprite=c,c?this._loadSprite(c,!0,y):(this._unloadSprite(),y&&y(null)))}}var Rr=o.X([{name:"a_pos",type:"Int16",components:2}]),za="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Nr={prelude:mi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:mi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:mi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mi(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:mi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:mi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:mi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:mi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:mi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mi(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:mi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:mi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mi("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",za),terrainDepth:mi("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",za),terrainCoords:mi("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",za)};function mi(S,c){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=c.match(/attribute ([\w]+) ([\w]+)/g),x=S.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),M=c.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),D=M?M.concat(x):x,F={};return{fragmentSource:S=S.replace(f,(N,G,q,$,re)=>(F[re]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${re}
varying ${q} ${$} ${re};
#else
uniform ${q} ${$} u_${re};
#endif
`:`
#ifdef HAS_UNIFORM_u_${re}
    ${q} ${$} ${re} = u_${re};
#endif
`)),vertexSource:c=c.replace(f,(N,G,q,$,re)=>{const ue=$==="float"?"vec2":"vec4",de=re.match(/color/)?"color":ue;return F[re]?G==="define"?`
#ifndef HAS_UNIFORM_u_${re}
uniform lowp float u_${re}_t;
attribute ${q} ${ue} a_${re};
varying ${q} ${$} ${re};
#else
uniform ${q} ${$} u_${re};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${re}
    ${re} = a_${re};
#else
    ${q} ${$} ${re} = u_${re};
#endif
`:`
#ifndef HAS_UNIFORM_u_${re}
    ${re} = unpack_mix_${de}(a_${re}, u_${re}_t);
#else
    ${q} ${$} ${re} = u_${re};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${re}
uniform lowp float u_${re}_t;
attribute ${q} ${ue} a_${re};
#else
uniform ${q} ${$} u_${re};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${re}
    ${q} ${$} ${re} = a_${re};
#else
    ${q} ${$} ${re} = u_${re};
#endif
`:`
#ifndef HAS_UNIFORM_u_${re}
    ${q} ${$} ${re} = unpack_mix_${de}(a_${re}, u_${re}_t);
#else
    ${q} ${$} ${re} = u_${re};
#endif
`}),staticAttributes:y,staticUniforms:D}}class jl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(c,f,y,x,M,D,F,N,G){this.context=c;let q=this.boundPaintVertexBuffers.length!==x.length;for(let $=0;!q&&$<x.length;$++)this.boundPaintVertexBuffers[$]!==x[$]&&(q=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==y||q||this.boundIndexBuffer!==M||this.boundVertexOffset!==D||this.boundDynamicVertexBuffer!==F||this.boundDynamicVertexBuffer2!==N||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,y,x,M,D,F,N,G):(c.bindVertexArray.set(this.vao),F&&F.bind(),M&&M.dynamicDraw&&M.bind(),N&&N.bind(),G&&G.bind())}freshBind(c,f,y,x,M,D,F,N){const G=c.numAttributes,q=this.context,$=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=x,this.boundVertexOffset=M,this.boundDynamicVertexBuffer=D,this.boundDynamicVertexBuffer2=F,this.boundDynamicVertexBuffer3=N,f.enableAttributes($,c);for(const re of y)re.enableAttributes($,c);D&&D.enableAttributes($,c),F&&F.enableAttributes($,c),N&&N.enableAttributes($,c),f.bind(),f.setVertexAttribPointers($,c,M);for(const re of y)re.bind(),re.setVertexAttribPointers($,c,M);D&&(D.bind(),D.setVertexAttribPointers($,c,M)),x&&x.bind(),F&&(F.bind(),F.setVertexAttribPointers($,c,M)),N&&(N.bind(),N.setVertexAttribPointers($,c,M)),q.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Js(S){const c=[];for(let f=0;f<S.length;f++){if(S[f]===null)continue;const y=S[f].split(" ");c.push(y.pop())}return c}class R{constructor(c,f,y,x,M,D){const F=c.gl;this.program=F.createProgram();const N=Js(f.staticAttributes),G=y?y.getBinderAttributes():[],q=N.concat(G),$=Nr.prelude.staticUniforms?Js(Nr.prelude.staticUniforms):[],re=f.staticUniforms?Js(f.staticUniforms):[],ue=y?y.getBinderUniforms():[],de=$.concat(re).concat(ue),we=[];for(const nt of de)we.indexOf(nt)<0&&we.push(nt);const ge=y?y.defines():[];M&&ge.push("#define OVERDRAW_INSPECTOR;"),D&&ge.push("#define TERRAIN3D;");const Ce=ge.concat(Nr.prelude.fragmentSource,f.fragmentSource).join(`
`),Oe=ge.concat(Nr.prelude.vertexSource,f.vertexSource).join(`
`),ye=F.createShader(F.FRAGMENT_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(ye,Ce),F.compileShader(ye),!F.getShaderParameter(ye,F.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${F.getShaderInfoLog(ye)}`);F.attachShader(this.program,ye);const Ve=F.createShader(F.VERTEX_SHADER);if(F.isContextLost())return void(this.failedToCreate=!0);if(F.shaderSource(Ve,Oe),F.compileShader(Ve),!F.getShaderParameter(Ve,F.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${F.getShaderInfoLog(Ve)}`);F.attachShader(this.program,Ve),this.attributes={};const Xe={};this.numAttributes=q.length;for(let nt=0;nt<this.numAttributes;nt++)q[nt]&&(F.bindAttribLocation(this.program,nt,q[nt]),this.attributes[q[nt]]=nt);if(F.linkProgram(this.program),!F.getProgramParameter(this.program,F.LINK_STATUS))throw new Error(`Program failed to link: ${F.getProgramInfoLog(this.program)}`);F.deleteShader(Ve),F.deleteShader(ye);for(let nt=0;nt<we.length;nt++){const _t=we[nt];if(_t&&!Xe[_t]){const Rt=F.getUniformLocation(this.program,_t);Rt&&(Xe[_t]=Rt)}}this.fixedUniforms=x(c,Xe),this.terrainUniforms=((nt,_t)=>({u_depth:new o.aH(nt,_t.u_depth),u_terrain:new o.aH(nt,_t.u_terrain),u_terrain_dim:new o.aI(nt,_t.u_terrain_dim),u_terrain_matrix:new o.aJ(nt,_t.u_terrain_matrix),u_terrain_unpack:new o.aK(nt,_t.u_terrain_unpack),u_terrain_exaggeration:new o.aI(nt,_t.u_terrain_exaggeration)}))(c,Xe),this.binderUniforms=y?y.getUniforms(c,Xe):[]}draw(c,f,y,x,M,D,F,N,G,q,$,re,ue,de,we,ge,Ce,Oe){const ye=c.gl;if(this.failedToCreate)return;if(c.program.set(this.program),c.setDepthMode(y),c.setStencilMode(x),c.setColorMode(M),c.setCullFace(D),N){c.activeTexture.set(ye.TEXTURE2),ye.bindTexture(ye.TEXTURE_2D,N.depthTexture),c.activeTexture.set(ye.TEXTURE3),ye.bindTexture(ye.TEXTURE_2D,N.texture);for(const Xe in this.terrainUniforms)this.terrainUniforms[Xe].set(N[Xe])}for(const Xe in this.fixedUniforms)this.fixedUniforms[Xe].set(F[Xe]);we&&we.setUniforms(c,this.binderUniforms,ue,{zoom:de});let Ve=0;switch(f){case ye.LINES:Ve=2;break;case ye.TRIANGLES:Ve=3;break;case ye.LINE_STRIP:Ve=1}for(const Xe of re.get()){const nt=Xe.vaos||(Xe.vaos={});(nt[G]||(nt[G]=new jl)).bind(c,this,q,we?we.getPaintVertexBuffers():[],$,Xe.vertexOffset,ge,Ce,Oe),ye.drawElements(f,Xe.primitiveLength*Ve,ye.UNSIGNED_SHORT,Xe.primitiveOffset*Ve*2)}}}function U(S,c,f){const y=1/Fn(f,1,c.transform.tileZoom),x=Math.pow(2,f.tileID.overscaledZ),M=f.tileSize*Math.pow(2,c.transform.tileZoom)/x,D=M*(f.tileID.canonical.x+f.tileID.wrap*x),F=M*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[y,S.fromScale,S.toScale],u_fade:S.t,u_pixel_coord_upper:[D>>16,F>>16],u_pixel_coord_lower:[65535&D,65535&F]}}const ie=(S,c,f,y)=>{const x=c.style.light,M=x.properties.get("position"),D=[M.x,M.y,M.z],F=function(){var G=new o.A(9);return o.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();x.properties.get("anchor")==="viewport"&&function(G,q){var $=Math.sin(q),re=Math.cos(q);G[0]=re,G[1]=$,G[2]=0,G[3]=-$,G[4]=re,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(F,-c.transform.angle),function(G,q,$){var re=q[0],ue=q[1],de=q[2];G[0]=re*$[0]+ue*$[3]+de*$[6],G[1]=re*$[1]+ue*$[4]+de*$[7],G[2]=re*$[2]+ue*$[5]+de*$[8]}(D,D,F);const N=x.properties.get("color");return{u_matrix:S,u_lightpos:D,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[N.r,N.g,N.b],u_vertical_gradient:+f,u_opacity:y}},ve=(S,c,f,y,x,M,D)=>o.e(ie(S,c,f,y),U(M,c,D),{u_height_factor:-Math.pow(2,x.overscaledZ)/D.tileSize/8}),Le=S=>({u_matrix:S}),De=(S,c,f,y)=>o.e(Le(S),U(f,c,y)),He=(S,c)=>({u_matrix:S,u_world:c}),Tt=(S,c,f,y,x)=>o.e(De(S,c,f,y),{u_world:x}),Ot=(S,c,f,y)=>{const x=S.transform;let M,D;if(y.paint.get("circle-pitch-alignment")==="map"){const F=Fn(f,1,x.zoom);M=!0,D=[F,F]}else M=!1,D=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:S.translatePosMatrix(c.posMatrix,f,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+M,u_device_pixel_ratio:S.pixelRatio,u_extrude_scale:D}},Kt=(S,c,f)=>({u_matrix:S,u_inv_matrix:c,u_camera_to_center_distance:f.cameraToCenterDistance,u_viewport_size:[f.width,f.height]}),Yt=(S,c,f=1)=>({u_matrix:S,u_color:c,u_overlay:0,u_overlay_scale:f}),Gt=S=>({u_matrix:S}),Nn=(S,c,f,y)=>({u_matrix:S,u_extrude_scale:Fn(c,1,f),u_intensity:y});function Xi(S,c){const f=Math.pow(2,c.canonical.z),y=c.canonical.y;return[new o.Y(0,y/f).toLngLat().lat,new o.Y(0,(y+1)/f).toLngLat().lat]}const kn=(S,c,f,y)=>{const x=S.transform;return{u_matrix:Lr(S,c,f,y),u_ratio:1/Fn(c,1,x.zoom),u_device_pixel_ratio:S.pixelRatio,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ei=(S,c,f,y,x)=>o.e(kn(S,c,f,x),{u_image:0,u_image_height:y}),vt=(S,c,f,y,x)=>{const M=S.transform,D=Ri(c,M);return{u_matrix:Lr(S,c,f,x),u_texsize:c.imageAtlasTexture.size,u_ratio:1/Fn(c,1,M.zoom),u_device_pixel_ratio:S.pixelRatio,u_image:0,u_scale:[D,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]]}},bn=(S,c,f,y,x,M)=>{const D=S.lineAtlas,F=Ri(c,S.transform),N=f.layout.get("line-cap")==="round",G=D.getDash(y.from,N),q=D.getDash(y.to,N),$=G.width*x.fromScale,re=q.width*x.toScale;return o.e(kn(S,c,f,M),{u_patternscale_a:[F/$,-G.height/2],u_patternscale_b:[F/re,-q.height/2],u_sdfgamma:D.width/(256*Math.min($,re)*S.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:q.y,u_mix:x.t})};function Ri(S,c){return 1/Fn(S,1,c.tileZoom)}function Lr(S,c,f,y){return S.translatePosMatrix(y?y.posMatrix:c.tileID.posMatrix,c,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const nr=(S,c,f,y,x)=>{return{u_matrix:S,u_tl_parent:c,u_scale_parent:f,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(D=x.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(M=x.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:Dd(x.paint.get("raster-hue-rotate"))};var M,D};function Dd(S){S*=Math.PI/180;const c=Math.sin(S),f=Math.cos(S);return[(2*f+1)/3,(-Math.sqrt(3)*c-f+1)/3,(Math.sqrt(3)*c-f+1)/3]}const Yf=(S,c,f,y,x,M,D,F,N,G,q,$,re,ue)=>{const de=D.transform;return{u_is_size_zoom_constant:+(S==="constant"||S==="source"),u_is_size_feature_constant:+(S==="constant"||S==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:de.cameraToCenterDistance,u_pitch:de.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:de.width/de.height,u_fade_change:D.options.fadeDuration?D.symbolFadeChange:1,u_matrix:F,u_label_plane_matrix:N,u_coord_matrix:G,u_is_text:+$,u_pitch_with_map:+y,u_is_along_line:x,u_is_variable_anchor:M,u_texsize:re,u_texture:0,u_translation:q,u_pitched_scale:ue}},Zi=(S,c,f,y,x,M,D,F,N,G,q,$,re,ue,de)=>{const we=D.transform;return o.e(Yf(S,c,f,y,x,M,D,F,N,G,q,$,re,de),{u_gamma_scale:y?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:D.pixelRatio,u_is_halo:+ue})},Kf=(S,c,f,y,x,M,D,F,N,G,q,$,re,ue)=>o.e(Zi(S,c,f,y,x,M,D,F,N,G,q,!0,$,!0,ue),{u_texsize_icon:re,u_texture_icon:1}),Bg=(S,c,f)=>({u_matrix:S,u_opacity:c,u_color:f}),ua=(S,c,f,y,x,M)=>o.e(function(D,F,N,G){const q=N.imageManager.getPattern(D.from.toString()),$=N.imageManager.getPattern(D.to.toString()),{width:re,height:ue}=N.imageManager.getPixelSize(),de=Math.pow(2,G.tileID.overscaledZ),we=G.tileSize*Math.pow(2,N.transform.tileZoom)/de,ge=we*(G.tileID.canonical.x+G.tileID.wrap*de),Ce=we*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[re,ue],u_mix:F.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:F.fromScale,u_scale_b:F.toScale,u_tile_units_to_pixels:1/Fn(G,1,N.transform.tileZoom),u_pixel_coord_upper:[ge>>16,Ce>>16],u_pixel_coord_lower:[65535&ge,65535&Ce]}}(y,M,f,x),{u_matrix:S,u_opacity:c}),$c={fillExtrusion:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_lightpos:new o.aL(S,c.u_lightpos),u_lightintensity:new o.aI(S,c.u_lightintensity),u_lightcolor:new o.aL(S,c.u_lightcolor),u_vertical_gradient:new o.aI(S,c.u_vertical_gradient),u_opacity:new o.aI(S,c.u_opacity)}),fillExtrusionPattern:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_lightpos:new o.aL(S,c.u_lightpos),u_lightintensity:new o.aI(S,c.u_lightintensity),u_lightcolor:new o.aL(S,c.u_lightcolor),u_vertical_gradient:new o.aI(S,c.u_vertical_gradient),u_height_factor:new o.aI(S,c.u_height_factor),u_image:new o.aH(S,c.u_image),u_texsize:new o.aM(S,c.u_texsize),u_pixel_coord_upper:new o.aM(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(S,c.u_pixel_coord_lower),u_scale:new o.aL(S,c.u_scale),u_fade:new o.aI(S,c.u_fade),u_opacity:new o.aI(S,c.u_opacity)}),fill:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix)}),fillPattern:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_image:new o.aH(S,c.u_image),u_texsize:new o.aM(S,c.u_texsize),u_pixel_coord_upper:new o.aM(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(S,c.u_pixel_coord_lower),u_scale:new o.aL(S,c.u_scale),u_fade:new o.aI(S,c.u_fade)}),fillOutline:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_world:new o.aM(S,c.u_world)}),fillOutlinePattern:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_world:new o.aM(S,c.u_world),u_image:new o.aH(S,c.u_image),u_texsize:new o.aM(S,c.u_texsize),u_pixel_coord_upper:new o.aM(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(S,c.u_pixel_coord_lower),u_scale:new o.aL(S,c.u_scale),u_fade:new o.aI(S,c.u_fade)}),circle:(S,c)=>({u_camera_to_center_distance:new o.aI(S,c.u_camera_to_center_distance),u_scale_with_map:new o.aH(S,c.u_scale_with_map),u_pitch_with_map:new o.aH(S,c.u_pitch_with_map),u_extrude_scale:new o.aM(S,c.u_extrude_scale),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_matrix:new o.aJ(S,c.u_matrix)}),collisionBox:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_pixel_extrude_scale:new o.aM(S,c.u_pixel_extrude_scale)}),collisionCircle:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_inv_matrix:new o.aJ(S,c.u_inv_matrix),u_camera_to_center_distance:new o.aI(S,c.u_camera_to_center_distance),u_viewport_size:new o.aM(S,c.u_viewport_size)}),debug:(S,c)=>({u_color:new o.aN(S,c.u_color),u_matrix:new o.aJ(S,c.u_matrix),u_overlay:new o.aH(S,c.u_overlay),u_overlay_scale:new o.aI(S,c.u_overlay_scale)}),clippingMask:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix)}),heatmap:(S,c)=>({u_extrude_scale:new o.aI(S,c.u_extrude_scale),u_intensity:new o.aI(S,c.u_intensity),u_matrix:new o.aJ(S,c.u_matrix)}),heatmapTexture:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_world:new o.aM(S,c.u_world),u_image:new o.aH(S,c.u_image),u_color_ramp:new o.aH(S,c.u_color_ramp),u_opacity:new o.aI(S,c.u_opacity)}),hillshade:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_image:new o.aH(S,c.u_image),u_latrange:new o.aM(S,c.u_latrange),u_light:new o.aM(S,c.u_light),u_shadow:new o.aN(S,c.u_shadow),u_highlight:new o.aN(S,c.u_highlight),u_accent:new o.aN(S,c.u_accent)}),hillshadePrepare:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_image:new o.aH(S,c.u_image),u_dimension:new o.aM(S,c.u_dimension),u_zoom:new o.aI(S,c.u_zoom),u_unpack:new o.aK(S,c.u_unpack)}),line:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_ratio:new o.aI(S,c.u_ratio),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(S,c.u_units_to_pixels)}),lineGradient:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_ratio:new o.aI(S,c.u_ratio),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(S,c.u_units_to_pixels),u_image:new o.aH(S,c.u_image),u_image_height:new o.aI(S,c.u_image_height)}),linePattern:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_texsize:new o.aM(S,c.u_texsize),u_ratio:new o.aI(S,c.u_ratio),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_image:new o.aH(S,c.u_image),u_units_to_pixels:new o.aM(S,c.u_units_to_pixels),u_scale:new o.aL(S,c.u_scale),u_fade:new o.aI(S,c.u_fade)}),lineSDF:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_ratio:new o.aI(S,c.u_ratio),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_units_to_pixels:new o.aM(S,c.u_units_to_pixels),u_patternscale_a:new o.aM(S,c.u_patternscale_a),u_patternscale_b:new o.aM(S,c.u_patternscale_b),u_sdfgamma:new o.aI(S,c.u_sdfgamma),u_image:new o.aH(S,c.u_image),u_tex_y_a:new o.aI(S,c.u_tex_y_a),u_tex_y_b:new o.aI(S,c.u_tex_y_b),u_mix:new o.aI(S,c.u_mix)}),raster:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_tl_parent:new o.aM(S,c.u_tl_parent),u_scale_parent:new o.aI(S,c.u_scale_parent),u_buffer_scale:new o.aI(S,c.u_buffer_scale),u_fade_t:new o.aI(S,c.u_fade_t),u_opacity:new o.aI(S,c.u_opacity),u_image0:new o.aH(S,c.u_image0),u_image1:new o.aH(S,c.u_image1),u_brightness_low:new o.aI(S,c.u_brightness_low),u_brightness_high:new o.aI(S,c.u_brightness_high),u_saturation_factor:new o.aI(S,c.u_saturation_factor),u_contrast_factor:new o.aI(S,c.u_contrast_factor),u_spin_weights:new o.aL(S,c.u_spin_weights)}),symbolIcon:(S,c)=>({u_is_size_zoom_constant:new o.aH(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(S,c.u_is_size_feature_constant),u_size_t:new o.aI(S,c.u_size_t),u_size:new o.aI(S,c.u_size),u_camera_to_center_distance:new o.aI(S,c.u_camera_to_center_distance),u_pitch:new o.aI(S,c.u_pitch),u_rotate_symbol:new o.aH(S,c.u_rotate_symbol),u_aspect_ratio:new o.aI(S,c.u_aspect_ratio),u_fade_change:new o.aI(S,c.u_fade_change),u_matrix:new o.aJ(S,c.u_matrix),u_label_plane_matrix:new o.aJ(S,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(S,c.u_coord_matrix),u_is_text:new o.aH(S,c.u_is_text),u_pitch_with_map:new o.aH(S,c.u_pitch_with_map),u_is_along_line:new o.aH(S,c.u_is_along_line),u_is_variable_anchor:new o.aH(S,c.u_is_variable_anchor),u_texsize:new o.aM(S,c.u_texsize),u_texture:new o.aH(S,c.u_texture),u_translation:new o.aM(S,c.u_translation),u_pitched_scale:new o.aI(S,c.u_pitched_scale)}),symbolSDF:(S,c)=>({u_is_size_zoom_constant:new o.aH(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(S,c.u_is_size_feature_constant),u_size_t:new o.aI(S,c.u_size_t),u_size:new o.aI(S,c.u_size),u_camera_to_center_distance:new o.aI(S,c.u_camera_to_center_distance),u_pitch:new o.aI(S,c.u_pitch),u_rotate_symbol:new o.aH(S,c.u_rotate_symbol),u_aspect_ratio:new o.aI(S,c.u_aspect_ratio),u_fade_change:new o.aI(S,c.u_fade_change),u_matrix:new o.aJ(S,c.u_matrix),u_label_plane_matrix:new o.aJ(S,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(S,c.u_coord_matrix),u_is_text:new o.aH(S,c.u_is_text),u_pitch_with_map:new o.aH(S,c.u_pitch_with_map),u_is_along_line:new o.aH(S,c.u_is_along_line),u_is_variable_anchor:new o.aH(S,c.u_is_variable_anchor),u_texsize:new o.aM(S,c.u_texsize),u_texture:new o.aH(S,c.u_texture),u_gamma_scale:new o.aI(S,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_is_halo:new o.aH(S,c.u_is_halo),u_translation:new o.aM(S,c.u_translation),u_pitched_scale:new o.aI(S,c.u_pitched_scale)}),symbolTextAndIcon:(S,c)=>({u_is_size_zoom_constant:new o.aH(S,c.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aH(S,c.u_is_size_feature_constant),u_size_t:new o.aI(S,c.u_size_t),u_size:new o.aI(S,c.u_size),u_camera_to_center_distance:new o.aI(S,c.u_camera_to_center_distance),u_pitch:new o.aI(S,c.u_pitch),u_rotate_symbol:new o.aH(S,c.u_rotate_symbol),u_aspect_ratio:new o.aI(S,c.u_aspect_ratio),u_fade_change:new o.aI(S,c.u_fade_change),u_matrix:new o.aJ(S,c.u_matrix),u_label_plane_matrix:new o.aJ(S,c.u_label_plane_matrix),u_coord_matrix:new o.aJ(S,c.u_coord_matrix),u_is_text:new o.aH(S,c.u_is_text),u_pitch_with_map:new o.aH(S,c.u_pitch_with_map),u_is_along_line:new o.aH(S,c.u_is_along_line),u_is_variable_anchor:new o.aH(S,c.u_is_variable_anchor),u_texsize:new o.aM(S,c.u_texsize),u_texsize_icon:new o.aM(S,c.u_texsize_icon),u_texture:new o.aH(S,c.u_texture),u_texture_icon:new o.aH(S,c.u_texture_icon),u_gamma_scale:new o.aI(S,c.u_gamma_scale),u_device_pixel_ratio:new o.aI(S,c.u_device_pixel_ratio),u_is_halo:new o.aH(S,c.u_is_halo),u_translation:new o.aM(S,c.u_translation),u_pitched_scale:new o.aI(S,c.u_pitched_scale)}),background:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_opacity:new o.aI(S,c.u_opacity),u_color:new o.aN(S,c.u_color)}),backgroundPattern:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_opacity:new o.aI(S,c.u_opacity),u_image:new o.aH(S,c.u_image),u_pattern_tl_a:new o.aM(S,c.u_pattern_tl_a),u_pattern_br_a:new o.aM(S,c.u_pattern_br_a),u_pattern_tl_b:new o.aM(S,c.u_pattern_tl_b),u_pattern_br_b:new o.aM(S,c.u_pattern_br_b),u_texsize:new o.aM(S,c.u_texsize),u_mix:new o.aI(S,c.u_mix),u_pattern_size_a:new o.aM(S,c.u_pattern_size_a),u_pattern_size_b:new o.aM(S,c.u_pattern_size_b),u_scale_a:new o.aI(S,c.u_scale_a),u_scale_b:new o.aI(S,c.u_scale_b),u_pixel_coord_upper:new o.aM(S,c.u_pixel_coord_upper),u_pixel_coord_lower:new o.aM(S,c.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aI(S,c.u_tile_units_to_pixels)}),terrain:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_texture:new o.aH(S,c.u_texture),u_ele_delta:new o.aI(S,c.u_ele_delta)}),terrainDepth:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_ele_delta:new o.aI(S,c.u_ele_delta)}),terrainCoords:(S,c)=>({u_matrix:new o.aJ(S,c.u_matrix),u_texture:new o.aH(S,c.u_texture),u_terrain_coords_id:new o.aI(S,c.u_terrain_coords_id),u_ele_delta:new o.aI(S,c.u_ele_delta)})};class nh{constructor(c,f,y){this.context=c;const x=c.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),c.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,c.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xc{constructor(c,f,y,x){this.length=f.length,this.attributes=y,this.itemSize=f.bytesPerElement,this.dynamicDraw=x,this.context=c;const M=c.gl;this.buffer=M.createBuffer(),c.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){if(c.length!==this.length)throw new Error(`Length of new data is ${c.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,f){for(let y=0;y<this.attributes.length;y++){const x=f.attributes[this.attributes[y].name];x!==void 0&&c.enableVertexAttribArray(x)}}setVertexAttribPointers(c,f,y){for(let x=0;x<this.attributes.length;x++){const M=this.attributes[x],D=f.attributes[M.name];D!==void 0&&c.vertexAttribPointer(D,M.components,c[qc[M.type]],!1,this.itemSize,M.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $l=new WeakMap;function _s(S){var c;if($l.has(S))return $l.get(S);{const f=(c=S.getParameter(S.VERSION))===null||c===void 0?void 0:c.startsWith("WebGL 2.0");return $l.set(S,f),f}}class Ti{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kd extends Ti{getDefault(){return o.aP.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Zc extends Ti{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class ql extends Ti{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Jf extends Ti{getDefault(){return[!0,!0,!0,!0]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Yc extends Ti{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class Ug extends Ti{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Xl extends Ti{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const f=this.current;(c.func!==f.func||c.ref!==f.ref||c.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class ih extends Ti{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class rh extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=c,this.dirty=!1}}class Qf extends Ti{getDefault(){return[0,1]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class So extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=c,this.dirty=!1}}class sh extends Ti{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class Fd extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.BLEND):f.disable(f.BLEND),this.current=c,this.dirty=!1}}class ep extends Ti{getDefault(){const c=this.gl;return[c.ONE,c.ZERO]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)}}class Od extends Ti{getDefault(){return o.aP.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Kc extends Ti{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)}}class Ba extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=c,this.dirty=!1}}class Nd extends Ti{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class Vg extends Ti{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}class dl extends Ti{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}}class zd extends Ti{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Jc extends Ti{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class Gg extends Ti{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class Zl extends Ti{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class Qc extends Ti{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class Bd extends Ti{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class oh extends Ti{getDefault(){return null}set(c){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ah extends Ti{getDefault(){return null}set(c){var f;if(c===this.current&&!this.dirty)return;const y=this.gl;_s(y)?y.bindVertexArray(c):(f=y.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(c),this.current=c,this.dirty=!1}}class Yl extends Ti{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class Ud extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class tp extends Ti{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class Kl extends Ti{constructor(c,f){super(c),this.context=c,this.parent=f}getDefault(){return null}}class ha extends Kl{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Vd extends Kl{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class lh extends Kl{set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class eu{constructor(c,f,y,x,M){this.context=c,this.width=f,this.height=y;const D=c.gl,F=this.framebuffer=D.createFramebuffer();if(this.colorAttachment=new ha(c,F),x)this.depthAttachment=M?new lh(c,F):new Vd(c,F);else if(M)throw new Error("Stencil cannot be set without depth");if(D.checkFramebufferStatus(D.FRAMEBUFFER)!==D.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const c=this.context.gl,f=this.colorAttachment.get();if(f&&c.deleteTexture(f),this.depthAttachment){const y=this.depthAttachment.get();y&&c.deleteRenderbuffer(y)}c.deleteFramebuffer(this.framebuffer)}}class Vi{constructor(c,f,y){this.blendFunction=c,this.blendColor=f,this.mask=y}}Vi.Replace=[1,0],Vi.disabled=new Vi(Vi.Replace,o.aP.transparent,[!1,!1,!1,!1]),Vi.unblended=new Vi(Vi.Replace,o.aP.transparent,[!0,!0,!0,!0]),Vi.alphaBlended=new Vi([1,771],o.aP.transparent,[!0,!0,!0,!0]);class Mo{constructor(c){var f,y;if(this.gl=c,this.clearColor=new kd(this),this.clearDepth=new Zc(this),this.clearStencil=new ql(this),this.colorMask=new Jf(this),this.depthMask=new Yc(this),this.stencilMask=new Ug(this),this.stencilFunc=new Xl(this),this.stencilOp=new ih(this),this.stencilTest=new rh(this),this.depthRange=new Qf(this),this.depthTest=new So(this),this.depthFunc=new sh(this),this.blend=new Fd(this),this.blendFunc=new ep(this),this.blendColor=new Od(this),this.blendEquation=new Kc(this),this.cullFace=new Ba(this),this.cullFaceSide=new Nd(this),this.frontFace=new Vg(this),this.program=new dl(this),this.activeTexture=new zd(this),this.viewport=new Jc(this),this.bindFramebuffer=new Gg(this),this.bindRenderbuffer=new Zl(this),this.bindTexture=new Qc(this),this.bindVertexBuffer=new Bd(this),this.bindElementBuffer=new oh(this),this.bindVertexArray=new ah(this),this.pixelStoreUnpack=new Yl(this),this.pixelStoreUnpackPremultiplyAlpha=new Ud(this),this.pixelStoreUnpackFlipY=new tp(this),this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE),_s(c)){this.HALF_FLOAT=c.HALF_FLOAT;const x=c.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=c.RGBA16F)!==null&&f!==void 0?f:x==null?void 0:x.RGBA16F_EXT,this.RGB16F=(y=c.RGB16F)!==null&&y!==void 0?y:x==null?void 0:x.RGB16F_EXT,c.getExtension("EXT_color_buffer_float")}else{c.getExtension("EXT_color_buffer_half_float"),c.getExtension("OES_texture_half_float_linear");const x=c.getExtension("OES_texture_half_float");this.HALF_FLOAT=x==null?void 0:x.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,f){return new nh(this,c,f)}createVertexBuffer(c,f,y){return new Xc(this,c,f,y)}createRenderbuffer(c,f,y){const x=this.gl,M=x.createRenderbuffer();return this.bindRenderbuffer.set(M),x.renderbufferStorage(x.RENDERBUFFER,c,f,y),this.bindRenderbuffer.set(null),M}createFramebuffer(c,f,y,x){return new eu(this,c,f,y,x)}clear({color:c,depth:f,stencil:y}){const x=this.gl;let M=0;c&&(M|=x.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(M|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),y!==void 0&&(M|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),x.clear(M)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){o.aE(c.blendFunction,Vi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor)),this.colorMask.set(c.mask)}createVertexArray(){var c;return _s(this.gl)?this.gl.createVertexArray():(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.createVertexArrayOES()}deleteVertexArray(c){var f;return _s(this.gl)?this.gl.deleteVertexArray(c):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(c)}unbindVAO(){this.bindVertexArray.set(null)}}class $n{constructor(c,f,y){this.func=c,this.mask=f,this.range=y}}$n.ReadOnly=!1,$n.ReadWrite=!0,$n.disabled=new $n(519,$n.ReadOnly,[0,1]);const Ua=7680;class Li{constructor(c,f,y,x,M,D){this.test=c,this.ref=f,this.mask=y,this.fail=x,this.depthFail=M,this.pass=D}}Li.disabled=new Li({func:519,mask:0},0,0,Ua,Ua,Ua);class ir{constructor(c,f,y){this.enable=c,this.mode=f,this.frontFace=y}}let fl;function Jl(S,c,f,y,x){const M=S.context,D=M.gl,F=S.useProgram("collisionBox"),N=[];let G=0,q=0;for(let Ce=0;Ce<y.length;Ce++){const Oe=y[Ce],ye=c.getTile(Oe).getBucket(f);if(!ye)continue;const Ve=x?ye.textCollisionBox:ye.iconCollisionBox,Xe=ye.collisionCircleArray;if(Xe.length>0){const nt=o.F();o.aQ(nt,ye.placementInvProjMatrix,S.transform.glCoordMatrix),o.aQ(nt,nt,ye.placementViewportMatrix),N.push({circleArray:Xe,circleOffset:q,transform:Oe.posMatrix,invTransform:nt,coord:Oe}),G+=Xe.length/4,q=G}Ve&&F.draw(M,D.LINES,$n.disabled,Li.disabled,S.colorModeForRenderPass(),ir.disabled,{u_matrix:Oe.posMatrix,u_pixel_extrude_scale:[1/($=S.transform).width,1/$.height]},S.style.map.terrain&&S.style.map.terrain.getTerrainData(Oe),f.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,null,S.transform.zoom,null,null,Ve.collisionVertexBuffer)}var $;if(!x||!N.length)return;const re=S.useProgram("collisionCircle"),ue=new o.aR;ue.resize(4*G),ue._trim();let de=0;for(const Ce of N)for(let Oe=0;Oe<Ce.circleArray.length/4;Oe++){const ye=4*Oe,Ve=Ce.circleArray[ye+0],Xe=Ce.circleArray[ye+1],nt=Ce.circleArray[ye+2],_t=Ce.circleArray[ye+3];ue.emplace(de++,Ve,Xe,nt,_t,0),ue.emplace(de++,Ve,Xe,nt,_t,1),ue.emplace(de++,Ve,Xe,nt,_t,2),ue.emplace(de++,Ve,Xe,nt,_t,3)}(!fl||fl.length<2*G)&&(fl=function(Ce){const Oe=2*Ce,ye=new o.aT;ye.resize(Oe),ye._trim();for(let Ve=0;Ve<Oe;Ve++){const Xe=6*Ve;ye.uint16[Xe+0]=4*Ve+0,ye.uint16[Xe+1]=4*Ve+1,ye.uint16[Xe+2]=4*Ve+2,ye.uint16[Xe+3]=4*Ve+2,ye.uint16[Xe+4]=4*Ve+3,ye.uint16[Xe+5]=4*Ve+0}return ye}(G));const we=M.createIndexBuffer(fl,!0),ge=M.createVertexBuffer(ue,o.aS.members,!0);for(const Ce of N){const Oe=Kt(Ce.transform,Ce.invTransform,S.transform);re.draw(M,D.TRIANGLES,$n.disabled,Li.disabled,S.colorModeForRenderPass(),ir.disabled,Oe,S.style.map.terrain&&S.style.map.terrain.getTerrainData(Ce.coord),f.id,ge,we,o.$.simpleSegment(0,2*Ce.circleOffset,Ce.circleArray.length,Ce.circleArray.length/2),null,S.transform.zoom,null,null,null)}ge.destroy(),we.destroy()}ir.disabled=new ir(!1,1029,2305),ir.backCCW=new ir(!0,1029,2305);const ch=o.an(new Float32Array(16));function np(S,c,f,y,x,M){const{horizontalAlign:D,verticalAlign:F}=o.au(S);return new o.P((-(D-.5)*c/x+y[0])*M,(-(F-.5)*f/x+y[1])*M)}function ip(S,c,f,y,x,M){const D=c.tileAnchorPoint.add(new o.P(c.translation[0],c.translation[1]));if(c.pitchWithMap){let F=y.mult(M);return f||(F=F.rotate(-x)),ht(D.add(F),c.labelPlaneMatrix,c.getElevation).point}if(f){const F=Se(c.tileAnchorPoint.x+1,c.tileAnchorPoint.y,c).point.sub(S),N=Math.atan(F.y/F.x)+(F.x<0?Math.PI:0);return S.add(y.rotate(N))}return S.add(y)}function uh(S,c,f,y,x,M,D,F,N,G,q,$,re,ue){const de=S.text.placedSymbolArray,we=S.text.dynamicLayoutVertexArray,ge=S.icon.dynamicLayoutVertexArray,Ce={};we.clear();for(let Oe=0;Oe<de.length;Oe++){const ye=de.get(Oe),Ve=ye.hidden||!ye.crossTileID||S.allowVerticalPlacement&&!ye.placedOrientation?null:y[ye.crossTileID];if(Ve){const Xe=new o.P(ye.anchorX,ye.anchorY),nt={getElevation:ue,width:x.width,height:x.height,labelPlaneMatrix:M,lineVertexArray:null,pitchWithMap:f,projection:q,projectionCache:null,tileAnchorPoint:Xe,translation:$,unwrappedTileID:re},_t=f?ht(Xe,D,ue):Se(Xe.x,Xe.y,nt),Rt=ae(x.cameraToCenterDistance,_t.signedDistanceFromCamera);let sn=o.ai(S.textSizeData,N,ye)*Rt/o.ap;f&&(sn*=S.tilePixelRatio/F);const{width:an,height:Dt,anchor:Nt,textOffset:yn,textBoxScale:qn}=Ve,$t=np(Nt,an,Dt,yn,qn,sn),Jt=q.getPitchedTextCorrection(x,Xe.add(new o.P($[0],$[1])),re),Gn=ip(_t.point,nt,c,$t,x.angle,Jt),fr=S.allowVerticalPlacement&&ye.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let ri=0;ri<ye.numGlyphs;ri++)o.aj(we,Gn,fr);G&&ye.associatedIconIndex>=0&&(Ce[ye.associatedIconIndex]={shiftedAnchor:Gn,angle:fr})}else nn(ye.numGlyphs,we)}if(G){ge.clear();const Oe=S.icon.placedSymbolArray;for(let ye=0;ye<Oe.length;ye++){const Ve=Oe.get(ye);if(Ve.hidden)nn(Ve.numGlyphs,ge);else{const Xe=Ce[ye];if(Xe)for(let nt=0;nt<Ve.numGlyphs;nt++)o.aj(ge,Xe.shiftedAnchor,Xe.angle);else nn(Ve.numGlyphs,ge)}}S.icon.dynamicLayoutVertexBuffer.updateData(ge)}S.text.dynamicLayoutVertexBuffer.updateData(we)}function tu(S,c,f){return f.iconsInText&&c?"symbolTextAndIcon":S?"symbolSDF":"symbolIcon"}function Ql(S,c,f,y,x,M,D,F,N,G,q,$){const re=S.context,ue=re.gl,de=S.transform,we=Qn(),ge=F==="map",Ce=N==="map",Oe=F!=="viewport"&&f.layout.get("symbol-placement")!=="point",ye=ge&&!Ce&&!Oe,Ve=!Ce&&Oe,Xe=!f.layout.get("symbol-sort-key").isConstant();let nt=!1;const _t=S.depthModeForSublayer(0,$n.ReadOnly),Rt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),sn=[],an=we.getCircleRadiusCorrection(de);for(const Dt of y){const Nt=c.getTile(Dt),yn=Nt.getBucket(f);if(!yn)continue;const qn=x?yn.text:yn.icon;if(!qn||!qn.segments.get().length||!qn.hasVisibleVertices)continue;const $t=qn.programConfigurations.get(f.id),Jt=x||yn.sdfIcons,Gn=x?yn.textSizeData:yn.iconSizeData,fr=Ce||de.pitch!==0,ri=S.useProgram(tu(Jt,x,yn),$t),di=o.ag(Gn,de.zoom),pr=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Dt);let vs,pa,mr,to,Bs=[0,0],xs=null;if(x)pa=Nt.glyphAtlasTexture,mr=ue.LINEAR,vs=Nt.glyphAtlasTexture.size,yn.iconsInText&&(Bs=Nt.imageAtlasTexture.size,xs=Nt.imageAtlasTexture,to=fr||S.options.rotating||S.options.zooming||Gn.kind==="composite"||Gn.kind==="camera"?ue.LINEAR:ue.NEAREST);else{const xr=f.layout.get("icon-size").constantOr(0)!==1||yn.iconsNeedLinear;pa=Nt.imageAtlasTexture,mr=Jt||S.options.rotating||S.options.zooming||xr||fr?ue.LINEAR:ue.NEAREST,vs=Nt.imageAtlasTexture.size}const ws=Fn(Nt,1,S.transform.zoom),ma=Ve?Dt.posMatrix:ch,su=Lt(ma,Ce,ge,S.transform,ws),cp=gt(ma,Ce,ge,S.transform,ws),gh=gt(Dt.posMatrix,Ce,ge,S.transform,ws),ou=we.translatePosition(S.transform,Nt,M,D),up=Rt&&yn.hasTextData(),t_=f.layout.get("icon-text-fit")!=="none"&&up&&yn.hasIconData();if(Oe){const xr=S.style.map.terrain?(n_,Yr)=>S.style.map.terrain.getElevation(Dt,n_,Yr):null,yh=f.layout.get("text-rotation-alignment")==="map";Z(yn,Dt.posMatrix,S,x,su,gh,Ce,G,yh,we,Dt.toUnwrapped(),de.width,de.height,ou,xr)}const hs=Dt.posMatrix,ga=x&&Rt||t_,hc=Oe||ga?ch:su,_h=cp,bs=Jt&&f.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ss;Ss=Jt?yn.iconsInText?Kf(Gn.kind,di,ye,Ce,Oe,ga,S,hs,hc,_h,ou,vs,Bs,an):Zi(Gn.kind,di,ye,Ce,Oe,ga,S,hs,hc,_h,ou,x,vs,!0,an):Yf(Gn.kind,di,ye,Ce,Oe,ga,S,hs,hc,_h,ou,x,vs,an);const is={program:ri,buffers:qn,uniformValues:Ss,atlasTexture:pa,atlasTextureIcon:xs,atlasInterpolation:mr,atlasInterpolationIcon:to,isSDF:Jt,hasHalo:bs};if(Xe&&yn.canOverlap){nt=!0;const xr=qn.segments.get();for(const yh of xr)sn.push({segments:new o.$([yh]),sortKey:yh.sortKey,state:is,terrainData:pr})}else sn.push({segments:qn.segments,sortKey:0,state:is,terrainData:pr})}nt&&sn.sort((Dt,Nt)=>Dt.sortKey-Nt.sortKey);for(const Dt of sn){const Nt=Dt.state;if(re.activeTexture.set(ue.TEXTURE0),Nt.atlasTexture.bind(Nt.atlasInterpolation,ue.CLAMP_TO_EDGE),Nt.atlasTextureIcon&&(re.activeTexture.set(ue.TEXTURE1),Nt.atlasTextureIcon&&Nt.atlasTextureIcon.bind(Nt.atlasInterpolationIcon,ue.CLAMP_TO_EDGE)),Nt.isSDF){const yn=Nt.uniformValues;Nt.hasHalo&&(yn.u_is_halo=1,pl(Nt.buffers,Dt.segments,f,S,Nt.program,_t,q,$,yn,Dt.terrainData)),yn.u_is_halo=0}pl(Nt.buffers,Dt.segments,f,S,Nt.program,_t,q,$,Nt.uniformValues,Dt.terrainData)}}function pl(S,c,f,y,x,M,D,F,N,G){const q=y.context;x.draw(q,q.gl.TRIANGLES,M,D,F,ir.disabled,N,G,f.id,S.layoutVertexBuffer,S.indexBuffer,c,f.paint,y.transform.zoom,S.programConfigurations.get(f.id),S.dynamicLayoutVertexBuffer,S.opacityVertexBuffer)}function Os(S,c,f,y,x){if(!f||!y||!y.imageAtlas)return;const M=y.imageAtlas.patternPositions;let D=M[f.to.toString()],F=M[f.from.toString()];if(!D&&F&&(D=F),!F&&D&&(F=D),!D||!F){const N=x.getPaintProperty(c);D=M[N],F=M[N]}D&&F&&S.setConstantPatternPositions(D,F)}function ml(S,c,f,y,x,M,D){const F=S.context.gl,N="fill-pattern",G=f.paint.get(N),q=G&&G.constantOr(1),$=f.getCrossfadeParameters();let re,ue,de,we,ge;D?(ue=q&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",re=F.LINES):(ue=q?"fillPattern":"fill",re=F.TRIANGLES);const Ce=G.constantOr(null);for(const Oe of y){const ye=c.getTile(Oe);if(q&&!ye.patternsLoaded())continue;const Ve=ye.getBucket(f);if(!Ve)continue;const Xe=Ve.programConfigurations.get(f.id),nt=S.useProgram(ue,Xe),_t=S.style.map.terrain&&S.style.map.terrain.getTerrainData(Oe);q&&(S.context.activeTexture.set(F.TEXTURE0),ye.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Xe.updatePaintBuffers($)),Os(Xe,N,Ce,ye,f);const Rt=_t?Oe:null,sn=S.translatePosMatrix(Rt?Rt.posMatrix:Oe.posMatrix,ye,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(D){we=Ve.indexBuffer2,ge=Ve.segments2;const an=[F.drawingBufferWidth,F.drawingBufferHeight];de=ue==="fillOutlinePattern"&&q?Tt(sn,S,$,ye,an):He(sn,an)}else we=Ve.indexBuffer,ge=Ve.segments,de=q?De(sn,S,$,ye):Le(sn);nt.draw(S.context,re,x,S.stencilModeForClipping(Oe),M,ir.disabled,de,_t,f.id,Ve.layoutVertexBuffer,we,ge,f.paint,S.transform.zoom,Xe)}}function Sr(S,c,f,y,x,M,D){const F=S.context,N=F.gl,G="fill-extrusion-pattern",q=f.paint.get(G),$=q.constantOr(1),re=f.getCrossfadeParameters(),ue=f.paint.get("fill-extrusion-opacity"),de=q.constantOr(null);for(const we of y){const ge=c.getTile(we),Ce=ge.getBucket(f);if(!Ce)continue;const Oe=S.style.map.terrain&&S.style.map.terrain.getTerrainData(we),ye=Ce.programConfigurations.get(f.id),Ve=S.useProgram($?"fillExtrusionPattern":"fillExtrusion",ye);$&&(S.context.activeTexture.set(N.TEXTURE0),ge.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),ye.updatePaintBuffers(re)),Os(ye,G,de,ge,f);const Xe=S.translatePosMatrix(we.posMatrix,ge,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),nt=f.paint.get("fill-extrusion-vertical-gradient"),_t=$?ve(Xe,S,nt,ue,we,re,ge):ie(Xe,S,nt,ue);Ve.draw(F,F.gl.TRIANGLES,x,M,D,ir.backCCW,_t,Oe,f.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,f.paint,S.transform.zoom,ye,S.style.map.terrain&&Ce.centroidVertexBuffer)}}function rp(S,c,f,y,x,M,D){const F=S.context,N=F.gl,G=f.fbo;if(!G)return;const q=S.useProgram("hillshade"),$=S.style.map.terrain&&S.style.map.terrain.getTerrainData(c);F.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,G.colorAttachment.get()),q.draw(F,N.TRIANGLES,x,M,D,ir.disabled,((re,ue,de,we)=>{const ge=de.paint.get("hillshade-shadow-color"),Ce=de.paint.get("hillshade-highlight-color"),Oe=de.paint.get("hillshade-accent-color");let ye=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=re.transform.angle);const Ve=!re.options.moving;return{u_matrix:we?we.posMatrix:re.transform.calculatePosMatrix(ue.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:Xi(0,ue.tileID),u_light:[de.paint.get("hillshade-exaggeration"),ye],u_shadow:ge,u_highlight:Ce,u_accent:Oe}})(S,f,y,$?c:null),$,y.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments)}function Va(S,c,f,y,x,M){const D=S.context,F=D.gl,N=c.dem;if(N&&N.data){const G=N.dim,q=N.stride,$=N.getPixels();if(D.activeTexture.set(F.TEXTURE1),D.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||S.getTileTexture(q),c.demTexture){const ue=c.demTexture;ue.update($,{premultiply:!1}),ue.bind(F.NEAREST,F.CLAMP_TO_EDGE)}else c.demTexture=new pe(D,$,F.RGBA,{premultiply:!1}),c.demTexture.bind(F.NEAREST,F.CLAMP_TO_EDGE);D.activeTexture.set(F.TEXTURE0);let re=c.fbo;if(!re){const ue=new pe(D,{width:G,height:G,data:null},F.RGBA);ue.bind(F.LINEAR,F.CLAMP_TO_EDGE),re=c.fbo=D.createFramebuffer(G,G,!0,!1),re.colorAttachment.set(ue.texture)}D.bindFramebuffer.set(re.framebuffer),D.viewport.set([0,0,G,G]),S.useProgram("hillshadePrepare").draw(D,F.TRIANGLES,y,x,M,ir.disabled,((ue,de)=>{const we=de.stride,ge=o.F();return o.aO(ge,0,o.W,-o.W,0,0,1),o.H(ge,ge,[0,-o.W,0]),{u_matrix:ge,u_image:1,u_dimension:[we,we],u_zoom:ue.overscaledZ,u_unpack:de.getUnpackVector()}})(c.tileID,N),null,f.id,S.rasterBoundsBuffer,S.quadTriangleIndexBuffer,S.rasterBoundsSegments),c.needsHillshadePrepare=!1}}function hh(S,c,f,y,x,M){const D=y.paint.get("raster-fade-duration");if(!M&&D>0){const F=_.now(),N=(F-S.timeAdded)/D,G=c?(F-c.timeAdded)/D:-1,q=f.getSource(),$=x.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),re=!c||Math.abs(c.tileID.overscaledZ-$)>Math.abs(S.tileID.overscaledZ-$),ue=re&&S.refreshedUponExpiration?1:o.ac(re?N:1-G,0,1);return S.refreshedUponExpiration&&N>=1&&(S.refreshedUponExpiration=!1),c?{opacity:1,mix:1-ue}:{opacity:ue,mix:0}}return{opacity:1,mix:0}}const gl=new o.aP(1,0,0,1),_l=new o.aP(0,1,0,1),ec=new o.aP(0,0,1,1),tc=new o.aP(1,0,1,1),nu=new o.aP(0,1,1,1);function dh(S,c,f,y){Wo(S,0,c+f/2,S.transform.width,f,y)}function Eo(S,c,f,y){Wo(S,c-f/2,0,f,S.transform.height,y)}function Wo(S,c,f,y,x,M){const D=S.context,F=D.gl;F.enable(F.SCISSOR_TEST),F.scissor(c*S.pixelRatio,f*S.pixelRatio,y*S.pixelRatio,x*S.pixelRatio),D.clear({color:M}),F.disable(F.SCISSOR_TEST)}function sp(S,c,f){const y=S.context,x=y.gl,M=f.posMatrix,D=S.useProgram("debug"),F=$n.disabled,N=Li.disabled,G=S.colorModeForRenderPass(),q="$debug",$=S.style.map.terrain&&S.style.map.terrain.getTerrainData(f);y.activeTexture.set(x.TEXTURE0);const re=c.getTileByID(f.key).latestRawTileData,ue=Math.floor((re&&re.byteLength||0)/1024),de=c.getTile(f).tileSize,we=512/Math.min(de,512)*(f.overscaledZ/S.transform.zoom)*.5;let ge=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ge+=` => ${f.overscaledZ}`),function(Ce,Oe){Ce.initDebugOverlayCanvas();const ye=Ce.debugOverlayCanvas,Ve=Ce.context.gl,Xe=Ce.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,ye.width,ye.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(Oe,5,5),Xe.strokeText(Oe,5,5),Ce.debugOverlayTexture.update(ye),Ce.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(S,`${ge} ${ue}kB`),D.draw(y,x.TRIANGLES,F,N,Vi.alphaBlended,ir.disabled,Yt(M,o.aP.transparent,we),null,q,S.debugBuffer,S.quadTriangleIndexBuffer,S.debugSegments),D.draw(y,x.LINE_STRIP,F,N,G,ir.disabled,Yt(M,o.aP.red),$,q,S.debugBuffer,S.tileBorderIndexBuffer,S.debugSegments)}function We(S,c,f){const y=S.context,x=y.gl,M=S.colorModeForRenderPass(),D=new $n(x.LEQUAL,$n.ReadWrite,S.depthRangeFor3D),F=S.useProgram("terrain"),N=c.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,S.width,S.height]);for(const G of f){const q=S.renderToTexture.getTexture(G),$=c.getTerrainData(G.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,q.texture);const re={u_matrix:S.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:c.getMeshFrameDelta(S.transform.zoom)};F.draw(y,x.TRIANGLES,D,Li.disabled,M,ir.backCCW,re,$,"terrain",N.vertexBuffer,N.indexBuffer,N.segments)}}class Ke{constructor(c,f){this.context=new Mo(c),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=lt.maxUnderzooming+lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Fi}resize(c,f,y){if(this.width=Math.floor(c*y),this.height=Math.floor(f*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const x of this.style._order)this.style._layers[x].resize()}setup(){const c=this.context,f=new o.aW;f.emplaceBack(0,0),f.emplaceBack(o.W,0),f.emplaceBack(0,o.W),f.emplaceBack(o.W,o.W),this.tileExtentBuffer=c.createVertexBuffer(f,Rr.members),this.tileExtentSegments=o.$.simpleSegment(0,0,4,2);const y=new o.aW;y.emplaceBack(0,0),y.emplaceBack(o.W,0),y.emplaceBack(0,o.W),y.emplaceBack(o.W,o.W),this.debugBuffer=c.createVertexBuffer(y,Rr.members),this.debugSegments=o.$.simpleSegment(0,0,4,5);const x=new o.Z;x.emplaceBack(0,0,0,0),x.emplaceBack(o.W,0,o.W,0),x.emplaceBack(0,o.W,0,o.W),x.emplaceBack(o.W,o.W,o.W,o.W),this.rasterBoundsBuffer=c.createVertexBuffer(x,me.members),this.rasterBoundsSegments=o.$.simpleSegment(0,0,4,2);const M=new o.aW;M.emplaceBack(0,0),M.emplaceBack(1,0),M.emplaceBack(0,1),M.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(M,Rr.members),this.viewportSegments=o.$.simpleSegment(0,0,4,2);const D=new o.aX;D.emplaceBack(0),D.emplaceBack(1),D.emplaceBack(3),D.emplaceBack(2),D.emplaceBack(0),this.tileBorderIndexBuffer=c.createIndexBuffer(D);const F=new o.aY;F.emplaceBack(0,1,2),F.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(F);const N=this.context.gl;this.stencilClearMode=new Li({func:N.ALWAYS,mask:0},0,255,N.ZERO,N.ZERO,N.ZERO)}clearStencil(){const c=this.context,f=c.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=o.F();o.aO(y,0,this.width,this.height,0,0,1),o.J(y,y,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(c,f.TRIANGLES,$n.disabled,this.stencilClearMode,Vi.disabled,ir.disabled,Gt(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(c,f){if(this.currentStencilSource===c.source||!c.isTileClipped()||!f||!f.length)return;this.currentStencilSource=c.source;const y=this.context,x=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(Vi.disabled),y.setDepthMode($n.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of f){const F=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,N=this.style.map.terrain&&this.style.map.terrain.getTerrainData(D);M.draw(y,x.TRIANGLES,$n.disabled,new Li({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),Vi.disabled,ir.disabled,Gt(D.posMatrix),N,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,f=this.context.gl;return new Li({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(c){const f=this.context.gl;return new Li({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(c){const f=this.context.gl,y=c.sort((D,F)=>F.overscaledZ-D.overscaledZ),x=y[y.length-1].overscaledZ,M=y[0].overscaledZ-x+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const D={};for(let F=0;F<M;F++)D[F+x]=new Li({func:f.GEQUAL,mask:255},F+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=M,[D,y]}return[{[x]:Li.disabled},y]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new Vi([c.CONSTANT_COLOR,c.ONE],new o.aP(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vi.unblended:Vi.alphaBlended}depthModeForSublayer(c,f,y){if(!this.opaquePassEnabledForLayer())return $n.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new $n(y||this.context.gl.LEQUAL,f,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,f){this.style=c,this.options=f,this.lineAtlas=c.lineAtlas,this.imageManager=c.imageManager,this.glyphManager=c.glyphManager,this.symbolFadeChange=c.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,x=this.style.sourceCaches,M={},D={},F={};for(const N in x){const G=x[N];G.used&&G.prepare(this.context),M[N]=G.getVisibleCoordinates(),D[N]=M[N].slice().reverse(),F[N]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let N=0;N<y.length;N++)if(this.style._layers[y[N]].is3D()){this.opaquePassCutoff=N;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const N of y){const G=this.style._layers[N];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const q=D[G.source];(G.type==="custom"||q.length)&&this.renderLayer(this,x[G.source],G,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?o.aP.black:o.aP.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(c._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const N=this.style._layers[y[this.currentLayer]],G=x[N.source],q=M[N.source];this._renderTileClippingMasks(N,q),this.renderLayer(this,G,N,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const N=this.style._layers[y[this.currentLayer]],G=x[N.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(N))continue;const q=(N.type==="symbol"?F:D)[N.source];this._renderTileClippingMasks(N,M[N.source]),this.renderLayer(this,G,N,q)}if(this.options.showTileBoundaries){const N=function(G,q){let $=null;const re=Object.values(G._layers).flatMap(ge=>ge.source&&!ge.isHidden(q)?[G.sourceCaches[ge.source]]:[]),ue=re.filter(ge=>ge.getSource().type==="vector"),de=re.filter(ge=>ge.getSource().type!=="vector"),we=ge=>{(!$||$.getSource().maxzoom<ge.getSource().maxzoom)&&($=ge)};return ue.forEach(ge=>we(ge)),$||de.forEach(ge=>we(ge)),$}(this.style,this.transform.zoom);N&&function(G,q,$){for(let re=0;re<$.length;re++)sp(G,q,$[re])}(this,N,N.getVisibleCoordinates())}this.options.showPadding&&function(N){const G=N.transform.padding;dh(N,N.transform.height-(G.top||0),3,gl),dh(N,G.bottom||0,3,_l),Eo(N,G.left||0,3,ec),Eo(N,N.transform.width-(G.right||0),3,tc);const q=N.transform.centerPoint;(function($,re,ue,de){Wo($,re-1,ue-10,2,20,de),Wo($,re-10,ue-1,20,2,de)})(N,q.x,N.transform.height-q.y,nu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(c){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,y=this.transform.modelViewProjectionMatrix;let x=this.terrainFacilitator.dirty;x||(x=c?!o.aZ(f,y):!o.a_(f,y)),x||(x=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),x&&(o.a$(f,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(M,D){const F=M.context,N=F.gl,G=Vi.unblended,q=new $n(N.LEQUAL,$n.ReadWrite,[0,1]),$=D.getTerrainMesh(),re=D.sourceCache.getRenderableTiles(),ue=M.useProgram("terrainDepth");F.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),F.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),F.clear({color:o.aP.transparent,depth:1});for(const de of re){const we=D.getTerrainData(de.tileID),ge={u_matrix:M.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:D.getMeshFrameDelta(M.transform.zoom)};ue.draw(F,N.TRIANGLES,q,Li.disabled,G,ir.backCCW,ge,we,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}F.bindFramebuffer.set(null),F.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain),function(M,D){const F=M.context,N=F.gl,G=Vi.unblended,q=new $n(N.LEQUAL,$n.ReadWrite,[0,1]),$=D.getTerrainMesh(),re=D.getCoordsTexture(),ue=D.sourceCache.getRenderableTiles(),de=M.useProgram("terrainCoords");F.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),F.viewport.set([0,0,M.width/devicePixelRatio,M.height/devicePixelRatio]),F.clear({color:o.aP.transparent,depth:1}),D.coordsIndex=[];for(const we of ue){const ge=D.getTerrainData(we.tileID);F.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,re.texture);const Ce={u_matrix:M.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0,u_ele_delta:D.getMeshFrameDelta(M.transform.zoom)};de.draw(F,N.TRIANGLES,q,Li.disabled,G,ir.backCCW,Ce,ge,"terrain",$.vertexBuffer,$.indexBuffer,$.segments),D.coordsIndex.push(we.tileID.key)}F.bindFramebuffer.set(null),F.viewport.set([0,0,M.width,M.height])}(this,this.style.map.terrain))}renderLayer(c,f,y,x){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(x||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(M,D,F,N,G){if(M.renderPass!=="translucent")return;const q=Li.disabled,$=M.colorModeForRenderPass();(F._unevaluatedLayout.hasValue("text-variable-anchor")||F._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(re,ue,de,we,ge,Ce,Oe,ye,Ve){const Xe=ue.transform,nt=Qn(),_t=ge==="map",Rt=Ce==="map";for(const sn of re){const an=we.getTile(sn),Dt=an.getBucket(de);if(!Dt||!Dt.text||!Dt.text.segments.get().length)continue;const Nt=o.ag(Dt.textSizeData,Xe.zoom),yn=Fn(an,1,ue.transform.zoom),qn=Lt(sn.posMatrix,Rt,_t,ue.transform,yn),$t=de.layout.get("icon-text-fit")!=="none"&&Dt.hasIconData();if(Nt){const Jt=Math.pow(2,Xe.zoom-an.tileID.overscaledZ),Gn=ue.style.map.terrain?(ri,di)=>ue.style.map.terrain.getElevation(sn,ri,di):null,fr=nt.translatePosition(Xe,an,Oe,ye);uh(Dt,_t,Rt,Ve,Xe,qn,sn.posMatrix,Jt,Nt,$t,nt,fr,sn.toUnwrapped(),Gn)}}}(N,M,F,D,F.layout.get("text-rotation-alignment"),F.layout.get("text-pitch-alignment"),F.paint.get("text-translate"),F.paint.get("text-translate-anchor"),G),F.paint.get("icon-opacity").constantOr(1)!==0&&Ql(M,D,F,N,!1,F.paint.get("icon-translate"),F.paint.get("icon-translate-anchor"),F.layout.get("icon-rotation-alignment"),F.layout.get("icon-pitch-alignment"),F.layout.get("icon-keep-upright"),q,$),F.paint.get("text-opacity").constantOr(1)!==0&&Ql(M,D,F,N,!0,F.paint.get("text-translate"),F.paint.get("text-translate-anchor"),F.layout.get("text-rotation-alignment"),F.layout.get("text-pitch-alignment"),F.layout.get("text-keep-upright"),q,$),D.map.showCollisionBoxes&&(Jl(M,D,F,N,!0),Jl(M,D,F,N,!1))})(c,f,y,x,this.style.placement.variableOffsets);break;case"circle":(function(M,D,F,N){if(M.renderPass!=="translucent")return;const G=F.paint.get("circle-opacity"),q=F.paint.get("circle-stroke-width"),$=F.paint.get("circle-stroke-opacity"),re=!F.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(q.constantOr(1)===0||$.constantOr(1)===0))return;const ue=M.context,de=ue.gl,we=M.depthModeForSublayer(0,$n.ReadOnly),ge=Li.disabled,Ce=M.colorModeForRenderPass(),Oe=[];for(let ye=0;ye<N.length;ye++){const Ve=N[ye],Xe=D.getTile(Ve),nt=Xe.getBucket(F);if(!nt)continue;const _t=nt.programConfigurations.get(F.id),Rt=M.useProgram("circle",_t),sn=nt.layoutVertexBuffer,an=nt.indexBuffer,Dt=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Ve),Nt={programConfiguration:_t,program:Rt,layoutVertexBuffer:sn,indexBuffer:an,uniformValues:Ot(M,Ve,Xe,F),terrainData:Dt};if(re){const yn=nt.segments.get();for(const qn of yn)Oe.push({segments:new o.$([qn]),sortKey:qn.sortKey,state:Nt})}else Oe.push({segments:nt.segments,sortKey:0,state:Nt})}re&&Oe.sort((ye,Ve)=>ye.sortKey-Ve.sortKey);for(const ye of Oe){const{programConfiguration:Ve,program:Xe,layoutVertexBuffer:nt,indexBuffer:_t,uniformValues:Rt,terrainData:sn}=ye.state;Xe.draw(ue,de.TRIANGLES,we,ge,Ce,ir.disabled,Rt,sn,F.id,nt,_t,ye.segments,F.paint,M.transform.zoom,Ve)}})(c,f,y,x);break;case"heatmap":(function(M,D,F,N){if(F.paint.get("heatmap-opacity")!==0)if(M.renderPass==="offscreen"){const G=M.context,q=G.gl,$=Li.disabled,re=new Vi([q.ONE,q.ONE],o.aP.transparent,[!0,!0,!0,!0]);(function(ue,de,we){const ge=ue.gl;ue.activeTexture.set(ge.TEXTURE1),ue.viewport.set([0,0,de.width/4,de.height/4]);let Ce=we.heatmapFbo;if(Ce)ge.bindTexture(ge.TEXTURE_2D,Ce.colorAttachment.get()),ue.bindFramebuffer.set(Ce.framebuffer);else{const Oe=ge.createTexture();ge.bindTexture(ge.TEXTURE_2D,Oe),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_S,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_WRAP_T,ge.CLAMP_TO_EDGE),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MIN_FILTER,ge.LINEAR),ge.texParameteri(ge.TEXTURE_2D,ge.TEXTURE_MAG_FILTER,ge.LINEAR),Ce=we.heatmapFbo=ue.createFramebuffer(de.width/4,de.height/4,!1,!1),function(ye,Ve,Xe,nt){var _t,Rt;const sn=ye.gl,an=(_t=ye.HALF_FLOAT)!==null&&_t!==void 0?_t:sn.UNSIGNED_BYTE,Dt=(Rt=ye.RGBA16F)!==null&&Rt!==void 0?Rt:sn.RGBA;sn.texImage2D(sn.TEXTURE_2D,0,Dt,Ve.width/4,Ve.height/4,0,sn.RGBA,an,null),nt.colorAttachment.set(Xe)}(ue,de,Oe,Ce)}})(G,M,F),G.clear({color:o.aP.transparent});for(let ue=0;ue<N.length;ue++){const de=N[ue];if(D.hasRenderableParent(de))continue;const we=D.getTile(de),ge=we.getBucket(F);if(!ge)continue;const Ce=ge.programConfigurations.get(F.id),Oe=M.useProgram("heatmap",Ce),{zoom:ye}=M.transform;Oe.draw(G,q.TRIANGLES,$n.disabled,$,re,ir.disabled,Nn(de.posMatrix,we,ye,F.paint.get("heatmap-intensity")),null,F.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,F.paint,M.transform.zoom,Ce)}G.viewport.set([0,0,M.width,M.height])}else M.renderPass==="translucent"&&(M.context.setColorMode(M.colorModeForRenderPass()),function(G,q){const $=G.context,re=$.gl,ue=q.heatmapFbo;if(!ue)return;$.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,ue.colorAttachment.get()),$.activeTexture.set(re.TEXTURE1);let de=q.colorRampTexture;de||(de=q.colorRampTexture=new pe($,q.colorRamp,re.RGBA)),de.bind(re.LINEAR,re.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw($,re.TRIANGLES,$n.disabled,Li.disabled,G.colorModeForRenderPass(),ir.disabled,((we,ge,Ce,Oe)=>{const ye=o.F();o.aO(ye,0,we.width,we.height,0,0,1);const Ve=we.context.gl;return{u_matrix:ye,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ge.paint.get("heatmap-opacity")}})(G,q),null,q.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,q.paint,G.transform.zoom)}(M,F))})(c,f,y,x);break;case"line":(function(M,D,F,N){if(M.renderPass!=="translucent")return;const G=F.paint.get("line-opacity"),q=F.paint.get("line-width");if(G.constantOr(1)===0||q.constantOr(1)===0)return;const $=M.depthModeForSublayer(0,$n.ReadOnly),re=M.colorModeForRenderPass(),ue=F.paint.get("line-dasharray"),de=F.paint.get("line-pattern"),we=de.constantOr(1),ge=F.paint.get("line-gradient"),Ce=F.getCrossfadeParameters(),Oe=we?"linePattern":ue?"lineSDF":ge?"lineGradient":"line",ye=M.context,Ve=ye.gl;let Xe=!0;for(const nt of N){const _t=D.getTile(nt);if(we&&!_t.patternsLoaded())continue;const Rt=_t.getBucket(F);if(!Rt)continue;const sn=Rt.programConfigurations.get(F.id),an=M.context.program.get(),Dt=M.useProgram(Oe,sn),Nt=Xe||Dt.program!==an,yn=M.style.map.terrain&&M.style.map.terrain.getTerrainData(nt),qn=de.constantOr(null);if(qn&&_t.imageAtlas){const Gn=_t.imageAtlas,fr=Gn.patternPositions[qn.to.toString()],ri=Gn.patternPositions[qn.from.toString()];fr&&ri&&sn.setConstantPatternPositions(fr,ri)}const $t=yn?nt:null,Jt=we?vt(M,_t,F,Ce,$t):ue?bn(M,_t,F,ue,Ce,$t):ge?Ei(M,_t,F,Rt.lineClipsArray.length,$t):kn(M,_t,F,$t);if(we)ye.activeTexture.set(Ve.TEXTURE0),_t.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),sn.updatePaintBuffers(Ce);else if(ue&&(Nt||M.lineAtlas.dirty))ye.activeTexture.set(Ve.TEXTURE0),M.lineAtlas.bind(ye);else if(ge){const Gn=Rt.gradients[F.id];let fr=Gn.texture;if(F.gradientVersion!==Gn.version){let ri=256;if(F.stepInterpolant){const di=D.getSource().maxzoom,pr=nt.canonical.z===di?Math.ceil(1<<M.transform.maxZoom-nt.canonical.z):1;ri=o.ac(o.aU(Rt.maxLineLength/o.W*1024*pr),256,ye.maxTextureSize)}Gn.gradient=o.aV({expression:F.gradientExpression(),evaluationKey:"lineProgress",resolution:ri,image:Gn.gradient||void 0,clips:Rt.lineClipsArray}),Gn.texture?Gn.texture.update(Gn.gradient):Gn.texture=new pe(ye,Gn.gradient,Ve.RGBA),Gn.version=F.gradientVersion,fr=Gn.texture}ye.activeTexture.set(Ve.TEXTURE0),fr.bind(F.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}Dt.draw(ye,Ve.TRIANGLES,$,M.stencilModeForClipping(nt),re,ir.disabled,Jt,yn,F.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,F.paint,M.transform.zoom,sn,Rt.layoutVertexBuffer2),Xe=!1}})(c,f,y,x);break;case"fill":(function(M,D,F,N){const G=F.paint.get("fill-color"),q=F.paint.get("fill-opacity");if(q.constantOr(1)===0)return;const $=M.colorModeForRenderPass(),re=F.paint.get("fill-pattern"),ue=M.opaquePassEnabledForLayer()&&!re.constantOr(1)&&G.constantOr(o.aP.transparent).a===1&&q.constantOr(0)===1?"opaque":"translucent";if(M.renderPass===ue){const de=M.depthModeForSublayer(1,M.renderPass==="opaque"?$n.ReadWrite:$n.ReadOnly);ml(M,D,F,N,de,$,!1)}if(M.renderPass==="translucent"&&F.paint.get("fill-antialias")){const de=M.depthModeForSublayer(F.getPaintProperty("fill-outline-color")?2:0,$n.ReadOnly);ml(M,D,F,N,de,$,!0)}})(c,f,y,x);break;case"fill-extrusion":(function(M,D,F,N){const G=F.paint.get("fill-extrusion-opacity");if(G!==0&&M.renderPass==="translucent"){const q=new $n(M.context.gl.LEQUAL,$n.ReadWrite,M.depthRangeFor3D);if(G!==1||F.paint.get("fill-extrusion-pattern").constantOr(1))Sr(M,D,F,N,q,Li.disabled,Vi.disabled),Sr(M,D,F,N,q,M.stencilModeFor3D(),M.colorModeForRenderPass());else{const $=M.colorModeForRenderPass();Sr(M,D,F,N,q,Li.disabled,$)}}})(c,f,y,x);break;case"hillshade":(function(M,D,F,N){if(M.renderPass!=="offscreen"&&M.renderPass!=="translucent")return;const G=M.context,q=M.depthModeForSublayer(0,$n.ReadOnly),$=M.colorModeForRenderPass(),[re,ue]=M.renderPass==="translucent"?M.stencilConfigForOverlap(N):[{},N];for(const de of ue){const we=D.getTile(de);we.needsHillshadePrepare!==void 0&&we.needsHillshadePrepare&&M.renderPass==="offscreen"?Va(M,we,F,q,Li.disabled,$):M.renderPass==="translucent"&&rp(M,de,we,F,q,re[de.overscaledZ],$)}G.viewport.set([0,0,M.width,M.height])})(c,f,y,x);break;case"raster":(function(M,D,F,N){if(M.renderPass!=="translucent"||F.paint.get("raster-opacity")===0||!N.length)return;const G=M.context,q=G.gl,$=D.getSource(),re=M.useProgram("raster"),ue=M.colorModeForRenderPass(),[de,we]=$ instanceof le?[{},N]:M.stencilConfigForOverlap(N),ge=we[we.length-1].overscaledZ,Ce=!M.options.moving;for(const Oe of we){const ye=M.depthModeForSublayer(Oe.overscaledZ-ge,F.paint.get("raster-opacity")===1?$n.ReadWrite:$n.ReadOnly,q.LESS),Ve=D.getTile(Oe);Ve.registerFadeDuration(F.paint.get("raster-fade-duration"));const Xe=D.findLoadedParent(Oe,0),nt=D.findLoadedSibling(Oe),_t=hh(Ve,Xe||nt||null,D,F,M.transform,M.style.map.terrain);let Rt,sn;const an=F.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;G.activeTexture.set(q.TEXTURE0),Ve.texture.bind(an,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(q.TEXTURE1),Xe?(Xe.texture.bind(an,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),Rt=Math.pow(2,Xe.tileID.overscaledZ-Ve.tileID.overscaledZ),sn=[Ve.tileID.canonical.x*Rt%1,Ve.tileID.canonical.y*Rt%1]):Ve.texture.bind(an,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const Dt=M.style.map.terrain&&M.style.map.terrain.getTerrainData(Oe),Nt=Dt?Oe:null,yn=Nt?Nt.posMatrix:M.transform.calculatePosMatrix(Oe.toUnwrapped(),Ce),qn=nr(yn,sn||[0,0],Rt||1,_t,F);$ instanceof le?re.draw(G,q.TRIANGLES,ye,Li.disabled,ue,ir.disabled,qn,Dt,F.id,$.boundsBuffer,M.quadTriangleIndexBuffer,$.boundsSegments):re.draw(G,q.TRIANGLES,ye,de[Oe.overscaledZ],ue,ir.disabled,qn,Dt,F.id,M.rasterBoundsBuffer,M.quadTriangleIndexBuffer,M.rasterBoundsSegments)}})(c,f,y,x);break;case"background":(function(M,D,F,N){const G=F.paint.get("background-color"),q=F.paint.get("background-opacity");if(q===0)return;const $=M.context,re=$.gl,ue=M.transform,de=ue.tileSize,we=F.paint.get("background-pattern");if(M.isPatternMissing(we))return;const ge=!we&&G.a===1&&q===1&&M.opaquePassEnabledForLayer()?"opaque":"translucent";if(M.renderPass!==ge)return;const Ce=Li.disabled,Oe=M.depthModeForSublayer(0,ge==="opaque"?$n.ReadWrite:$n.ReadOnly),ye=M.colorModeForRenderPass(),Ve=M.useProgram(we?"backgroundPattern":"background"),Xe=N||ue.coveringTiles({tileSize:de,terrain:M.style.map.terrain});we&&($.activeTexture.set(re.TEXTURE0),M.imageManager.bind(M.context));const nt=F.getCrossfadeParameters();for(const _t of Xe){const Rt=N?_t.posMatrix:M.transform.calculatePosMatrix(_t.toUnwrapped()),sn=we?ua(Rt,q,M,we,{tileID:_t,tileSize:de},nt):Bg(Rt,q,G),an=M.style.map.terrain&&M.style.map.terrain.getTerrainData(_t);Ve.draw($,re.TRIANGLES,Oe,Ce,ye,ir.disabled,sn,an,F.id,M.tileExtentBuffer,M.quadTriangleIndexBuffer,M.tileExtentSegments)}})(c,0,y,x);break;case"custom":(function(M,D,F){const N=M.context,G=F.implementation;if(M.renderPass==="offscreen"){const q=G.prerender;q&&(M.setCustomLayerDefaults(),N.setColorMode(M.colorModeForRenderPass()),q.call(G,N.gl,M.transform.customLayerMatrix()),N.setDirty(),M.setBaseState())}else if(M.renderPass==="translucent"){M.setCustomLayerDefaults(),N.setColorMode(M.colorModeForRenderPass()),N.setStencilMode(Li.disabled);const q=G.renderingMode==="3d"?new $n(M.context.gl.LEQUAL,$n.ReadWrite,M.depthRangeFor3D):M.depthModeForSublayer(0,$n.ReadOnly);N.setDepthMode(q),G.render(N.gl,M.transform.customLayerMatrix()),N.setDirty(),M.setBaseState(),N.bindFramebuffer.set(null)}})(c,0,y)}}translatePosMatrix(c,f,y,x,M){if(!y[0]&&!y[1])return c;const D=M?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(D){const G=Math.sin(D),q=Math.cos(D);y=[y[0]*q-y[1]*G,y[0]*G+y[1]*q]}const F=[M?y[0]:Fn(f,y[0],this.transform.zoom),M?y[1]:Fn(f,y[1],this.transform.zoom),0],N=new Float32Array(16);return o.H(N,c,F),N}saveTileTexture(c){const f=this._tileTextures[c.size[0]];f?f.push(c):this._tileTextures[c.size[0]]=[c]}getTileTexture(c){const f=this._tileTextures[c];return f&&f.length>0?f.pop():null}isPatternMissing(c){if(!c)return!1;if(!c.from||!c.to)return!0;const f=this.imageManager.getPattern(c.from.toString()),y=this.imageManager.getPattern(c.to.toString());return!f||!y}useProgram(c,f){this.cache=this.cache||{};const y=c+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new R(this.context,Nr[c],f,$c[c],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new pe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:c,drawingBufferHeight:f}=this.context.gl;return this.width!==c||this.height!==f}}class Wt{constructor(c,f){this.points=c,this.planes=f}static fromInvProjectionMatrix(c,f,y){const x=Math.pow(2,y),M=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(F=>{const N=1/(F=o.af([],F,c))[3]/f*x;return o.b0(F,F,[N,N,1/F[3],N])}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(F=>{const N=function(re,ue){var de=ue[0],we=ue[1],ge=ue[2],Ce=de*de+we*we+ge*ge;return Ce>0&&(Ce=1/Math.sqrt(Ce)),re[0]=ue[0]*Ce,re[1]=ue[1]*Ce,re[2]=ue[2]*Ce,re}([],function(re,ue,de){var we=ue[0],ge=ue[1],Ce=ue[2],Oe=de[0],ye=de[1],Ve=de[2];return re[0]=ge*Ve-Ce*ye,re[1]=Ce*Oe-we*Ve,re[2]=we*ye-ge*Oe,re}([],te([],M[F[0]],M[F[1]]),te([],M[F[2]],M[F[1]]))),G=-((q=N)[0]*($=M[F[1]])[0]+q[1]*$[1]+q[2]*$[2]);var q,$;return N.concat(G)});return new Wt(M,D)}}class Ln{constructor(c,f){this.min=c,this.max=f,this.center=function(y,x,M){return y[0]=.5*x[0],y[1]=.5*x[1],y[2]=.5*x[2],y}([],function(y,x,M){return y[0]=x[0]+M[0],y[1]=x[1]+M[1],y[2]=x[2]+M[2],y}([],this.min,this.max))}quadrant(c){const f=[c%2==0,c<2],y=Y(this.min),x=Y(this.max);for(let M=0;M<f.length;M++)y[M]=f[M]?this.min[M]:this.center[M],x[M]=f[M]?this.center[M]:this.max[M];return x[2]=this.max[2],new Ln(y,x)}distanceX(c){return Math.max(Math.min(this.max[0],c[0]),this.min[0])-c[0]}distanceY(c){return Math.max(Math.min(this.max[1],c[1]),this.min[1])-c[1]}intersects(c){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let x=0;x<c.planes.length;x++){const M=c.planes[x];let D=0;for(let F=0;F<f.length;F++)o.b1(M,f[F])>=0&&D++;if(D===0)return 0;D!==f.length&&(y=!1)}if(y)return 2;for(let x=0;x<3;x++){let M=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(let F=0;F<c.points.length;F++){const N=c.points[F][x]-this.min[x];M=Math.min(M,N),D=Math.max(D,N)}if(D<0||M>this.max[x]-this.min[x])return 0}return 1}}class Oi{constructor(c=0,f=0,y=0,x=0){if(isNaN(c)||c<0||isNaN(f)||f<0||isNaN(y)||y<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=y,this.right=x}interpolate(c,f,y){return f.top!=null&&c.top!=null&&(this.top=o.z.number(c.top,f.top,y)),f.bottom!=null&&c.bottom!=null&&(this.bottom=o.z.number(c.bottom,f.bottom,y)),f.left!=null&&c.left!=null&&(this.left=o.z.number(c.left,f.left,y)),f.right!=null&&c.right!=null&&(this.right=o.z.number(c.right,f.right,y)),this}getCenter(c,f){const y=o.ac((this.left+c-this.right)/2,0,c),x=o.ac((this.top+f-this.bottom)/2,0,f);return new o.P(y,x)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new Oi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const si=85.051129;class dr{constructor(c,f,y,x,M){this.tileSize=512,this._renderWorldCopies=M===void 0||!!M,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=y??0,this._maxPitch=x??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Oi,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const c=new dr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return c.apply(this),c}apply(c){this.tileSize=c.tileSize,this.latRange=c.latRange,this.width=c.width,this.height=c.height,this._center=c._center,this._elevation=c._elevation,this.minElevationForCurrentTile=c.minElevationForCurrentTile,this.zoom=c.zoom,this.angle=c.angle,this._fov=c._fov,this._pitch=c._pitch,this._unmodified=c._unmodified,this._edgeInsets=c._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(c){const f=-o.b2(c,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var y=new o.A(4);return o.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,x,M){var D=x[0],F=x[1],N=x[2],G=x[3],q=Math.sin(M),$=Math.cos(M);y[0]=D*$+N*q,y[1]=F*$+G*q,y[2]=D*-q+N*$,y[3]=F*-q+G*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const f=o.ac(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=c/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(c){const f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(c){c!==this._elevation&&(this._elevation=c,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,f,y){this._unmodified=!1,this._edgeInsets.interpolate(c,f,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(c){const f=[new o.b3(0,c)];if(this._renderWorldCopies){const y=this.pointCoordinate(new o.P(0,0)),x=this.pointCoordinate(new o.P(this.width,0)),M=this.pointCoordinate(new o.P(this.width,this.height)),D=this.pointCoordinate(new o.P(0,this.height)),F=Math.floor(Math.min(y.x,x.x,M.x,D.x)),N=Math.floor(Math.max(y.x,x.x,M.x,D.x)),G=1;for(let q=F-G;q<=N+G;q++)q!==0&&f.push(new o.b3(q,c))}return f}coveringTiles(c){var f,y;let x=this.coveringZoomLevel(c);const M=x;if(c.minzoom!==void 0&&x<c.minzoom)return[];c.maxzoom!==void 0&&x>c.maxzoom&&(x=c.maxzoom);const D=this.pointCoordinate(this.getCameraPoint()),F=o.Y.fromLngLat(this.center),N=Math.pow(2,x),G=[N*D.x,N*D.y,0],q=[N*F.x,N*F.y,0],$=Wt.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,x);let re=c.minzoom||0;!c.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(re=x);const ue=c.terrain?2/Math.min(this.tileSize,c.tileSize)*this.tileSize:3,de=ye=>({aabb:new Ln([ye*N,0,0],[(ye+1)*N,N,0]),zoom:0,x:0,y:0,wrap:ye,fullyVisible:!1}),we=[],ge=[],Ce=x,Oe=c.reparseOverscaled?M:x;if(this._renderWorldCopies)for(let ye=1;ye<=3;ye++)we.push(de(-ye)),we.push(de(ye));for(we.push(de(0));we.length>0;){const ye=we.pop(),Ve=ye.x,Xe=ye.y;let nt=ye.fullyVisible;if(!nt){const Dt=ye.aabb.intersects($);if(Dt===0)continue;nt=Dt===2}const _t=c.terrain?G:q,Rt=ye.aabb.distanceX(_t),sn=ye.aabb.distanceY(_t),an=Math.max(Math.abs(Rt),Math.abs(sn));if(ye.zoom===Ce||an>ue+(1<<Ce-ye.zoom)-2&&ye.zoom>=re){const Dt=Ce-ye.zoom,Nt=G[0]-.5-(Ve<<Dt),yn=G[1]-.5-(Xe<<Dt);ge.push({tileID:new o.Q(ye.zoom===Ce?Oe:ye.zoom,ye.wrap,ye.zoom,Ve,Xe),distanceSq:ce([q[0]-.5-Ve,q[1]-.5-Xe]),tileDistanceToCamera:Math.sqrt(Nt*Nt+yn*yn)})}else for(let Dt=0;Dt<4;Dt++){const Nt=(Ve<<1)+Dt%2,yn=(Xe<<1)+(Dt>>1),qn=ye.zoom+1;let $t=ye.aabb.quadrant(Dt);if(c.terrain){const Jt=new o.Q(qn,ye.wrap,qn,Nt,yn),Gn=c.terrain.getMinMaxElevation(Jt),fr=(f=Gn.minElevation)!==null&&f!==void 0?f:this.elevation,ri=(y=Gn.maxElevation)!==null&&y!==void 0?y:this.elevation;$t=new Ln([$t.min[0],$t.min[1],fr],[$t.max[0],$t.max[1],ri])}we.push({aabb:$t,zoom:qn,x:Nt,y:yn,wrap:ye.wrap,fullyVisible:nt})}}return ge.sort((ye,Ve)=>ye.distanceSq-Ve.distanceSq).map(ye=>ye.tileID)}resize(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const f=o.ac(c.lat,-85.051129,si);return new o.P(o.N(c.lng)*this.worldSize,o.O(f)*this.worldSize)}unproject(c){return new o.Y(c.x/this.worldSize,c.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(c){const f=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,x=this.pointLocation(this.centerPoint,c),M=c.getElevationForLngLatZoom(x,this.tileZoom);if(!(this.elevation-M))return;const D=y+f-M,F=Math.cos(this._pitch)*this.cameraToCenterDistance/D/o.b4(1,x.lat),N=this.scaleZoom(F/this.tileSize);this._elevation=M,this._center=x,this.zoom=N}setLocationAtPoint(c,f){const y=this.pointCoordinate(f),x=this.pointCoordinate(this.centerPoint),M=this.locationCoordinate(c),D=new o.Y(M.x-(y.x-x.x),M.y-(y.y-x.y));this.center=this.coordinateLocation(D),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(c,f){return f?this.coordinatePoint(this.locationCoordinate(c),f.getElevationForLngLatZoom(c,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(c))}pointLocation(c,f){return this.coordinateLocation(this.pointCoordinate(c,f))}locationCoordinate(c){return o.Y.fromLngLat(c)}coordinateLocation(c){return c&&c.toLngLat()}pointCoordinate(c,f){if(f){const re=f.pointCoordinate(c);if(re!=null)return re}const y=[c.x,c.y,0,1],x=[c.x,c.y,1,1];o.af(y,y,this.pixelMatrixInverse),o.af(x,x,this.pixelMatrixInverse);const M=y[3],D=x[3],F=y[1]/M,N=x[1]/D,G=y[2]/M,q=x[2]/D,$=G===q?0:(0-G)/(q-G);return new o.Y(o.z.number(y[0]/M,x[0]/D,$)/this.worldSize,o.z.number(F,N,$)/this.worldSize)}coordinatePoint(c,f=0,y=this.pixelMatrix){const x=[c.x*this.worldSize,c.y*this.worldSize,f,1];return o.af(x,x,y),new o.P(x[0]/x[3],x[1]/x[3])}getBounds(){const c=Math.max(0,this.height/2-this.getHorizon());return new on().extend(this.pointLocation(new o.P(0,c))).extend(this.pointLocation(new o.P(this.width,c))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new on([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(c){c?(this.lngRange=[c.getWest(),c.getEast()],this.latRange=[c.getSouth(),c.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,si])}calculatePosMatrix(c,f=!1){const y=c.key,x=f?this._alignedPosMatrixCache:this._posMatrixCache;if(x[y])return x[y];const M=c.canonical,D=this.worldSize/this.zoomScale(M.z),F=M.x+Math.pow(2,M.z)*c.wrap,N=o.an(new Float64Array(16));return o.H(N,N,[F*D,M.y*D,0]),o.J(N,N,[D/o.W,D/o.W,1]),o.K(N,f?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,N),x[y]=new Float32Array(N),x[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(c,f){f=o.ac(+f,this.minZoom,this.maxZoom);const y={center:new o.M(c.lng,c.lat),zoom:f};let x=this.lngRange;if(!this._renderWorldCopies&&x===null){const ye=179.9999999999;x=[-ye,ye]}const M=this.tileSize*this.zoomScale(y.zoom);let D=0,F=M,N=0,G=M,q=0,$=0;const{x:re,y:ue}=this.size;if(this.latRange){const ye=this.latRange;D=o.O(ye[1])*M,F=o.O(ye[0])*M,F-D<ue&&(q=ue/(F-D))}x&&(N=o.b2(o.N(x[0])*M,0,M),G=o.b2(o.N(x[1])*M,0,M),G<N&&(G+=M),G-N<re&&($=re/(G-N)));const{x:de,y:we}=this.project.call({worldSize:M},c);let ge,Ce;const Oe=Math.max($||0,q||0);if(Oe){const ye=new o.P($?(G+N)/2:de,q?(F+D)/2:we);return y.center=this.unproject.call({worldSize:M},ye).wrap(),y.zoom+=this.scaleZoom(Oe),y}if(this.latRange){const ye=ue/2;we-ye<D&&(Ce=D+ye),we+ye>F&&(Ce=F-ye)}if(x){const ye=(N+G)/2;let Ve=de;this._renderWorldCopies&&(Ve=o.b2(de,ye-M/2,ye+M/2));const Xe=re/2;Ve-Xe<N&&(ge=N+Xe),Ve+Xe>G&&(ge=G-Xe)}if(ge!==void 0||Ce!==void 0){const ye=new o.P(ge??de,Ce??we);y.center=this.unproject.call({worldSize:M},ye).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this._unmodified,{center:f,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=y,this._unmodified=c,this._constraining=!1}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,f=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b4(1,this.center.lat)*this.worldSize;let x=o.an(new Float64Array(16));o.J(x,x,[this.width/2,-this.height/2,1]),o.H(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=o.an(new Float64Array(16)),o.J(x,x,[1,-1,1]),o.H(x,x,[-1,-1,0]),o.J(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x;const M=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),D=Math.min(this.elevation,this.minElevationForCurrentTile),F=M-D*this._pixelPerMeter/Math.cos(this._pitch),N=D<0?F:M,G=Math.PI/2+this._pitch,q=this._fov*(.5+c.y/this.height),$=Math.sin(q)*N/Math.sin(o.ac(Math.PI-G-q,.01,Math.PI-.01)),re=this.getHorizon(),ue=2*Math.atan(re/this.cameraToCenterDistance)*(.5+c.y/(2*re)),de=Math.sin(ue)*N/Math.sin(o.ac(Math.PI-G-ue,.01,Math.PI-.01)),we=Math.min($,de),ge=1.01*(Math.cos(Math.PI/2-this._pitch)*we+N),Ce=this.height/50;x=new Float64Array(16),o.b5(x,this._fov,this.width/this.height,Ce,ge),x[8]=2*-c.x/this.width,x[9]=2*c.y/this.height,o.J(x,x,[1,-1,1]),o.H(x,x,[0,0,-this.cameraToCenterDistance]),o.b6(x,x,this._pitch),o.ad(x,x,this.angle),o.H(x,x,[-f,-y,0]),this.mercatorMatrix=o.J([],x,[this.worldSize,this.worldSize,this.worldSize]),o.J(x,x,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.K(new Float64Array(16),this.labelPlaneMatrix,x),o.H(x,x,[0,0,-this.elevation]),this.modelViewProjectionMatrix=x,this.invModelViewProjectionMatrix=o.as([],x),this.pixelMatrix3D=o.K(new Float64Array(16),this.labelPlaneMatrix,x);const Oe=this.width%2/2,ye=this.height%2/2,Ve=Math.cos(this.angle),Xe=Math.sin(this.angle),nt=f-Math.round(f)+Ve*Oe+Xe*ye,_t=y-Math.round(y)+Ve*ye+Xe*Oe,Rt=new Float64Array(x);if(o.H(Rt,Rt,[nt>.5?nt-1:nt,_t>.5?_t-1:_t,0]),this.alignedModelViewProjectionMatrix=Rt,x=o.as(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");this.pixelMatrixInverse=x,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const c=this.pointCoordinate(new o.P(0,0)),f=[c.x*this.worldSize,c.y*this.worldSize,0,1];return o.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,c))}getCameraQueryGeometry(c){const f=this.getCameraPoint();if(c.length===1)return[c[0],f];{let y=f.x,x=f.y,M=f.x,D=f.y;for(const F of c)y=Math.min(y,F.x),x=Math.min(x,F.y),M=Math.max(M,F.x),D=Math.max(D,F.y);return[new o.P(y,x),new o.P(M,x),new o.P(M,D),new o.P(y,D),new o.P(y,x)]}}lngLatToCameraDepth(c,f){const y=this.locationCoordinate(c),x=[y.x*this.worldSize,y.y*this.worldSize,f,1];return o.af(x,x,this.modelViewProjectionMatrix),x[2]/x[3]}}function Mr(S,c){let f,y=!1,x=null,M=null;const D=()=>{x=null,y&&(S.apply(M,f),x=setTimeout(D,c),y=!1)};return(...F)=>(y=!0,M=this,f=F,x||D(),x)}class Ns{constructor(c){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let y;return f.split("&").map(x=>x.split("=")).forEach(x=>{x[0]===this._hashName&&(y=x)}),(y&&y[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:y,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=Mr(this._updateHashUnthrottled,300),this._hashName=c&&encodeURIComponent(c)}addTo(c){return this._map=c,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(c){const f=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,x=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,x),D=Math.round(f.lng*M)/M,F=Math.round(f.lat*M)/M,N=this._map.getBearing(),G=this._map.getPitch();let q="";if(q+=c?`/${D}/${F}/${y}`:`${y}/${F}/${D}`,(N||G)&&(q+="/"+Math.round(10*N)/10),G&&(q+=`/${Math.round(G)}`),this._hashName){const $=this._hashName;let re=!1;const ue=window.location.hash.slice(1).split("&").map(de=>{const we=de.split("=")[0];return we===$?(re=!0,`${we}=${q}`):de}).filter(de=>de);return re||ue.push(`${$}=${q}`),`#${ue.join("&")}`}return`#${q}`}}const vr={linearity:.3,easing:o.b7(0,0,.3,1)},Er=o.e({deceleration:2500,maxSpeed:1400},vr),zs=o.e({deceleration:20,maxSpeed:1400},vr),Qs=o.e({deceleration:1e3,maxSpeed:360},vr),Zr=o.e({deceleration:1e3,maxSpeed:90},vr);class To{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,f=_.now();for(;c.length>0&&f-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)f.zoom+=M.zoomDelta||0,f.bearing+=M.bearingDelta||0,f.pitch+=M.pitchDelta||0,M.panDelta&&f.pan._add(M.panDelta),M.around&&(f.around=M.around),M.pinchAround&&(f.pinchAround=M.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(f.pan.mag()){const M=$o(f.pan.mag(),y,o.e({},Er,c||{}));x.offset=f.pan.mult(M.amount/f.pan.mag()),x.center=this._map.transform.center,jo(x,M)}if(f.zoom){const M=$o(f.zoom,y,zs);x.zoom=this._map.transform.zoom+M.amount,jo(x,M)}if(f.bearing){const M=$o(f.bearing,y,Qs);x.bearing=this._map.transform.bearing+o.ac(M.amount,-179,179),jo(x,M)}if(f.pitch){const M=$o(f.pitch,y,Zr);x.pitch=this._map.transform.pitch+M.amount,jo(x,M)}if(x.zoom||x.bearing){const M=f.pinchAround===void 0?f.around:f.pinchAround;x.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),o.e(x,{noMoveStart:!0})}}function jo(S,c){(!S.duration||S.duration<c.duration)&&(S.duration=c.duration,S.easing=c.easing)}function $o(S,c,f){const{maxSpeed:y,linearity:x,deceleration:M}=f,D=o.ac(S*x/(c/1e3),-y,y),F=Math.abs(D)/(M*x);return{easing:f.easing,duration:1e3*F,amount:D*(F/2)}}class Tr extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,y,x={}){const M=w.mousePos(f.getCanvas(),y),D=f.unproject(M);super(c,o.e({point:M,lngLat:D,originalEvent:y},x)),this._defaultPrevented=!1,this.target=f}}class Co extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,y){const x=c==="touchend"?y.changedTouches:y.touches,M=w.touchPos(f.getCanvasContainer(),x),D=M.map(N=>f.unproject(N)),F=M.reduce((N,G,q,$)=>N.add(G.div($.length)),new o.P(0,0));super(c,{points:M,point:F,lngLats:D,lngLat:f.unproject(F),originalEvent:y}),this._defaultPrevented=!1}}class Gd extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,y){super(c,{originalEvent:y}),this._defaultPrevented=!1}}class Hd{constructor(c,f){this._map=c,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(c){return this._firePreventable(new Gd(c.type,this._map,c))}mousedown(c,f){return this._mousedownPos=f,this._firePreventable(new Tr(c.type,this._map,c))}mouseup(c){this._map.fire(new Tr(c.type,this._map,c))}click(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Tr(c.type,this._map,c))}dblclick(c){return this._firePreventable(new Tr(c.type,this._map,c))}mouseover(c){this._map.fire(new Tr(c.type,this._map,c))}mouseout(c){this._map.fire(new Tr(c.type,this._map,c))}touchstart(c){return this._firePreventable(new Co(c.type,this._map,c))}touchmove(c){this._map.fire(new Co(c.type,this._map,c))}touchend(c){this._map.fire(new Co(c.type,this._map,c))}touchcancel(c){this._map.fire(new Co(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hg{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(c){this._map.fire(new Tr(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._ignoreContextMenu||this._map.fire(new Tr(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ci{constructor(c){this._map=c}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(c){return this.transform.pointLocation(o.P.convert(c),this._map.terrain)}}class bi{constructor(c,f){this._map=c,this._tr=new Ci(c),this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,f){this.isEnabled()&&c.shiftKey&&c.button===0&&(w.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(c,f){if(!this._active)return;const y=f;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=y,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(x.x,y.x),D=Math.max(x.x,y.x),F=Math.min(x.y,y.y),N=Math.max(x.y,y.y);w.setTransform(this._box,`translate(${M}px,${F}px)`),this._box.style.width=D-M+"px",this._box.style.height=N-F+"px"}mouseupWindow(c,f){if(!this._active||c.button!==0)return;const y=this._startPos,x=f;if(this.reset(),w.suppressClick(),y.x!==x.x||y.y!==x.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:c})),{cameraAnimation:M=>M.fitScreenCoordinates(y,x,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",c)}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(c,f){return this._map.fire(new o.k(c,{originalEvent:f}))}}function Ga(S,c){if(S.length!==c.length)throw new Error(`The number of touches and points are not equal - touches ${S.length}, points ${c.length}`);const f={};for(let y=0;y<S.length;y++)f[S[y].identifier]=c[y];return f}class da{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(c,f,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=c.timeStamp),y.length===this.numTouches&&(this.centroid=function(x){const M=new o.P(0,0);for(const D of x)M._add(D);return M.div(x.length)}(f),this.touches=Ga(y,f)))}touchmove(c,f,y){if(this.aborted||!this.centroid)return;const x=Ga(y,f);for(const M in this.touches){const D=x[M];(!D||D.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(c,f,y){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class nc{constructor(c){this.singleTap=new da(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(c,f,y){this.singleTap.touchstart(c,f,y)}touchmove(c,f,y){this.singleTap.touchmove(c,f,y)}touchend(c,f,y){const x=this.singleTap.touchend(c,f,y);if(x){const M=c.timeStamp-this.lastTime<500,D=!this.lastTap||this.lastTap.dist(x)<30;if(M&&D||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class cs{constructor(c){this._tr=new Ci(c),this._zoomIn=new nc({numTouches:1,numTaps:2}),this._zoomOut=new nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,f,y){this._zoomIn.touchstart(c,f,y),this._zoomOut.touchstart(c,f,y)}touchmove(c,f,y){this._zoomIn.touchmove(c,f,y),this._zoomOut.touchmove(c,f,y)}touchend(c,f,y){const x=this._zoomIn.touchend(c,f,y),M=this._zoomOut.touchend(c,f,y),D=this._tr;return x?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:D.zoom+1,around:D.unproject(x)},{originalEvent:c})}):M?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:F=>F.easeTo({duration:300,zoom:D.zoom-1,around:D.unproject(M)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class us{constructor(c){this._enabled=!!c.enable,this._moveStateManager=c.moveStateManager,this._clickTolerance=c.clickTolerance||1,this._moveFunction=c.move,this._activateOnStart=!!c.activateOnStart,c.assignEvents(this),this.reset()}reset(c){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(c)}_move(...c){const f=this._moveFunction(...c);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(c,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(c)&&(this._moveStateManager.startMove(c),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(c,f){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(c.preventDefault(),!this._moveStateManager.isValidMoveEvent(c))return void this.reset(c);const x=f.length?f[0]:f;return!this._moved&&x.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=x,this._move(y,x))}dragEnd(c){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(c)&&(this._moved&&w.suppressClick(),this.reset(c))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ha={0:1,2:2};class Wa{constructor(c){this._correctEvent=c.checkCorrectEvent}startMove(c){const f=w.mouseButton(c);this._eventButton=f}endMove(c){delete this._eventButton}isValidStartEvent(c){return this._correctEvent(c)}isValidMoveEvent(c){return!function(f,y){const x=Ha[y];return f.buttons===void 0||(f.buttons&x)!==x}(c,this._eventButton)}isValidEndEvent(c){return w.mouseButton(c)===this._eventButton}}class Yi{constructor(){this._firstTouch=void 0}_isOneFingerTouch(c){return c.targetTouches.length===1}_isSameTouchEvent(c){return c.targetTouches[0].identifier===this._firstTouch}startMove(c){this._firstTouch=c.targetTouches[0].identifier}endMove(c){delete this._firstTouch}isValidStartEvent(c){return this._isOneFingerTouch(c)}isValidMoveEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}isValidEndEvent(c){return this._isOneFingerTouch(c)&&this._isSameTouchEvent(c)}}const ys=S=>{S.mousedown=S.dragStart,S.mousemoveWindow=S.dragMove,S.mouseup=S.dragEnd,S.contextmenu=c=>{c.preventDefault()}},zr=({enable:S,clickTolerance:c,bearingDegreesPerPixelMoved:f=.8})=>{const y=new Wa({checkCorrectEvent:x=>w.mouseButton(x)===0&&x.ctrlKey||w.mouseButton(x)===2});return new us({clickTolerance:c,move:(x,M)=>({bearingDelta:(M.x-x.x)*f}),moveStateManager:y,enable:S,assignEvents:ys})},iu=({enable:S,clickTolerance:c,pitchDegreesPerPixelMoved:f=-.5})=>{const y=new Wa({checkCorrectEvent:x=>w.mouseButton(x)===0&&x.ctrlKey||w.mouseButton(x)===2});return new us({clickTolerance:c,move:(x,M)=>({pitchDelta:(M.y-x.y)*f}),moveStateManager:y,enable:S,assignEvents:ys})};class ic{constructor(c,f){this._clickTolerance=c.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(c,f,y){return this._calculateTransform(c,f,y)}touchmove(c,f,y){if(this._active&&!(y.length<this.minTouchs()))return c.preventDefault(),this._calculateTransform(c,f,y)}touchend(c,f,y){this._calculateTransform(c,f,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,f,y){y.length>0&&(this._active=!0);const x=Ga(y,f),M=new o.P(0,0),D=new o.P(0,0);let F=0;for(const G in x){const q=x[G],$=this._touches[G];$&&(M._add(q),D._add(q.sub($)),F++,x[G]=q)}if(this._touches=x,F<this.minTouchs()||!D.mag())return;const N=D.div(F);return this._sum._add(N),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(F),panDelta:N}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(c,f,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([f[0],f[1]]))}touchmove(c,f,y){if(!this._firstTwoTouches)return;c.preventDefault();const[x,M]=this._firstTwoTouches,D=eo(y,f,x),F=eo(y,f,M);if(!D||!F)return;const N=this._aroundCenter?null:D.add(F).div(2);return this._move([D,F],N,c)}touchend(c,f,y){if(!this._firstTwoTouches)return;const[x,M]=this._firstTwoTouches,D=eo(y,f,x),F=eo(y,f,M);D&&F||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function eo(S,c,f){for(let y=0;y<S.length;y++)if(S[y].identifier===f)return c[y]}function fa(S,c){return Math.log(S/c)/Math.LN2}class ru extends rc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,f){const y=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(fa(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:fa(this._distance,y),pinchAround:f}}}function sc(S,c){return 180*S.angleWith(c)/Math.PI}class oc extends rc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,f,y){const x=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:sc(this._vector,x),pinchAround:f}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const f=25/(Math.PI*this._minDiameter)*360,y=sc(c,this._startVector);return Math.abs(y)<f}}function op(S){return Math.abs(S.y)>Math.abs(S.x)}class Wg extends rc{constructor(c){super(),this._currentTouchCount=0,this._map=c}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(c,f,y){super.touchstart(c,f,y),this._currentTouchCount=y.length}_start(c){this._lastPoints=c,op(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,f,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const x=c[0].sub(this._lastPoints[0]),M=c[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(x,M,y.timeStamp),this._valid?(this._lastPoints=c,this._active=!0,{pitchDelta:(x.y+M.y)/2*-.5}):void 0}gestureBeginsVertically(c,f,y){if(this._valid!==void 0)return this._valid;const x=c.mag()>=2,M=f.mag()>=2;if(!x&&!M)return;if(!x||!M)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const D=c.y>0==f.y>0;return op(c)&&op(f)&&D}}const Y0={panStep:100,bearingStep:15,pitchStep:10};class ac{constructor(c){this._tr=new Ci(c);const f=Y0;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let f=0,y=0,x=0,M=0,D=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?y=-1:(c.preventDefault(),M=-1);break;case 39:c.shiftKey?y=1:(c.preventDefault(),M=1);break;case 38:c.shiftKey?x=1:(c.preventDefault(),D=-1);break;case 40:c.shiftKey?x=-1:(c.preventDefault(),D=1);break;default:return}return this._rotationDisabled&&(y=0,x=0),{cameraAnimation:F=>{const N=this._tr;F.easeTo({duration:300,easeId:"keyboardHandler",easing:K0,zoom:f?Math.round(N.zoom)+f*(c.shiftKey?2:1):N.zoom,bearing:N.bearing+y*this._bearingStep,pitch:N.pitch+x*this._pitchStep,offset:[-M*this._panStep,-D*this._panStep],center:N.center},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function K0(S){return S*(2-S)}const jg=4.000244140625;class $g{constructor(c,f){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=c,this._tr=new Ci(c),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(c){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!c[this._map.cooperativeGestures._bypassKey])return;let f=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const y=_.now(),x=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,f!==0&&f%jg==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(x*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=w.mousePos(this._map.getCanvas(),c),y=this._tr;this._around=f.y>y.transform.height/2-y.transform.getHorizon()?o.M.convert(this._aroundCenter?y.center:y.unproject(f)):o.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._tr.transform;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>jg?this._wheelZoomRate:this._defaultZoomRate;let N=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&N!==0&&(N=1/N);const G=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):c.scale;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(G*N))),this._type==="wheel"&&(this._startZoom=c.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c.zoom,y=this._startZoom,x=this._easing;let M,D=!1;if(this._type==="wheel"&&y&&x){const F=Math.min((_.now()-this._lastWheelEventTime)/200,1),N=x(F);M=o.z.number(y,f,N),F<1?this._frameId||(this._frameId=!0):D=!0}else M=f,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:M-c.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let f=o.b8;if(this._prevEase){const y=this._prevEase,x=(_.now()-y.start)/y.duration,M=y.easing(x+.01)-y.easing(x),D=.27/Math.sqrt(M*M+1e-4)*.01,F=Math.sqrt(.0729-D*D);f=o.b7(D,F,.25,1)}return this._prevEase={start:_.now(),duration:c,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class qg{constructor(c,f){this._clickZoom=c,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class J0{constructor(c){this._tr=new Ci(c),this.reset()}reset(){this._active=!1}dblclick(c,f){return c.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(c.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Q0{constructor(){this._tap=new nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(c,f,y){if(!this._swipePoint)if(this._tapTime){const x=f[0],M=c.timeStamp-this._tapTime<500,D=this._tapPoint.dist(x)<30;M&&D?y.length>0&&(this._swipePoint=x,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(c,f,y)}touchmove(c,f,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const x=f[0],M=x.y-this._swipePoint.y;return this._swipePoint=x,c.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(c,f,y)}touchend(c,f,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const x=this._tap.touchend(c,f,y);x&&(this._tapTime=c.timeStamp,this._tapPoint=x)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xg{constructor(c,f,y){this._el=c,this._mousePan=f,this._touchPan=y}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fh{constructor(c,f,y){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Zg{constructor(c,f,y,x){this._el=c,this._touchZoom=f,this._touchRotate=y,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qo{constructor(c,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=c,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const c=this._map.getCanvasContainer();c.classList.add("maplibregl-cooperative-gestures"),this._container=w.create("div","maplibregl-cooperative-gesture-screen",c);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),x=document.createElement("div");x.className="maplibregl-desktop-message",x.textContent=f,this._container.appendChild(x);const M=document.createElement("div");M.className="maplibregl-mobile-message",M.textContent=y,this._container.appendChild(M),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(w.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(c){this._onCooperativeGesture(c.touches.length===1)}wheel(c){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!c[this._bypassKey])}_onCooperativeGesture(c){this._enabled&&c&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ao=S=>S.zoom||S.drag||S.pitch||S.rotate;class ev extends o.k{}function Xo(S){return S.panDelta&&S.panDelta.mag()||S.zoomDelta||S.bearingDelta||S.pitchDelta}class Wd{constructor(c,f){this.handleWindowEvent=x=>{this.handleEvent(x,`${x.type}Window`)},this.handleEvent=(x,M)=>{if(x.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const D=x.type==="renderFrame"?void 0:x,F={needsRenderFrame:!1},N={},G={},q=x.touches,$=q?this._getMapTouches(q):void 0,re=$?w.touchPos(this._map.getCanvas(),$):w.mousePos(this._map.getCanvas(),x);for(const{handlerName:we,handler:ge,allowed:Ce}of this._handlers){if(!ge.isEnabled())continue;let Oe;this._blockedByActive(G,Ce,we)?ge.reset():ge[M||x.type]&&(Oe=ge[M||x.type](x,re,$),this.mergeHandlerResult(F,N,Oe,we,D),Oe&&Oe.needsRenderFrame&&this._triggerRenderFrame()),(Oe||ge.isActive())&&(G[we]=ge)}const ue={};for(const we in this._previousActiveHandlers)G[we]||(ue[we]=D);this._previousActiveHandlers=G,(Object.keys(ue).length||Xo(F))&&(this._changes.push([F,N,ue]),this._triggerRenderFrame()),(Object.keys(G).length||Xo(F))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=F;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new To(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,M,D]of this._listeners)w.addEventListener(x,M,x===document?this.handleWindowEvent:this.handleEvent,D)}destroy(){for(const[c,f,y]of this._listeners)w.removeEventListener(c,f,c===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(c){const f=this._map,y=f.getCanvasContainer();this._add("mapEvent",new Hd(f,c));const x=f.boxZoom=new bi(f,c);this._add("boxZoom",x),c.interactive&&c.boxZoom&&x.enable();const M=f.cooperativeGestures=new qo(f,c.cooperativeGestures);this._add("cooperativeGestures",M),c.cooperativeGestures&&M.enable();const D=new cs(f),F=new J0(f);f.doubleClickZoom=new qg(F,D),this._add("tapZoom",D),this._add("clickZoom",F),c.interactive&&c.doubleClickZoom&&f.doubleClickZoom.enable();const N=new Q0;this._add("tapDragZoom",N);const G=f.touchPitch=new Wg(f);this._add("touchPitch",G),c.interactive&&c.touchPitch&&f.touchPitch.enable(c.touchPitch);const q=zr(c),$=iu(c);f.dragRotate=new fh(c,q,$),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]),c.interactive&&c.dragRotate&&f.dragRotate.enable();const re=(({enable:Oe,clickTolerance:ye})=>{const Ve=new Wa({checkCorrectEvent:Xe=>w.mouseButton(Xe)===0&&!Xe.ctrlKey});return new us({clickTolerance:ye,move:(Xe,nt)=>({around:nt,panDelta:nt.sub(Xe)}),activateOnStart:!0,moveStateManager:Ve,enable:Oe,assignEvents:ys})})(c),ue=new ic(c,f);f.dragPan=new Xg(y,re,ue),this._add("mousePan",re),this._add("touchPan",ue,["touchZoom","touchRotate"]),c.interactive&&c.dragPan&&f.dragPan.enable(c.dragPan);const de=new oc,we=new ru;f.touchZoomRotate=new Zg(y,we,de,N),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),c.interactive&&c.touchZoomRotate&&f.touchZoomRotate.enable(c.touchZoomRotate);const ge=f.scrollZoom=new $g(f,()=>this._triggerRenderFrame());this._add("scrollZoom",ge,["mousePan"]),c.interactive&&c.scrollZoom&&f.scrollZoom.enable(c.scrollZoom);const Ce=f.keyboard=new ac(f);this._add("keyboard",Ce),c.interactive&&c.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Hg(f))}_add(c,f,y){this._handlers.push({handlerName:c,handler:f,allowed:y}),this._handlersById[c]=f}stop(c){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[]}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ao(this._eventsInProgress)||this.isZooming()}_blockedByActive(c,f,y){for(const x in c)if(x!==y&&(!f||f.indexOf(x)<0))return!0;return!1}_getMapTouches(c){const f=[];for(const y of c)this._el.contains(y.target)&&f.push(y);return f}mergeHandlerResult(c,f,y,x,M){if(!y)return;o.e(c,y);const D={handlerName:x,originalEvent:y.originalEvent||M};y.zoomDelta!==void 0&&(f.zoom=D),y.panDelta!==void 0&&(f.drag=D),y.pitchDelta!==void 0&&(f.pitch=D),y.bearingDelta!==void 0&&(f.rotate=D)}_applyChanges(){const c={},f={},y={};for(const[x,M,D]of this._changes)x.panDelta&&(c.panDelta=(c.panDelta||new o.P(0,0))._add(x.panDelta)),x.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(c.around=x.around),x.pinchAround!==void 0&&(c.pinchAround=x.pinchAround),x.noInertia&&(c.noInertia=x.noInertia),o.e(f,M),o.e(y,D);this._updateMapTransform(c,f,y),this._changes=[]}_updateMapTransform(c,f,y){const x=this._map,M=x._getTransformForUpdate(),D=x.terrain;if(!(Xo(c)||D&&this._terrainMovement))return this._fireEvents(f,y,!0);let{panDelta:F,zoomDelta:N,bearingDelta:G,pitchDelta:q,around:$,pinchAround:re}=c;re!==void 0&&($=re),x._stop(!0),$=$||x.transform.centerPoint;const ue=M.pointLocation(F?$.sub(F):$);G&&(M.bearing+=G),q&&(M.pitch+=q),N&&(M.zoom+=N),D?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?M.center=M.pointLocation(M.centerPoint.sub(F)):M.setLocationAtPoint(ue,$):(this._terrainMovement=!0,this._map._elevationFreeze=!0,M.setLocationAtPoint(ue,$)):M.setLocationAtPoint(ue,$),x._applyUpdatedTransform(M),this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,y,!0)}_fireEvents(c,f,y){const x=Ao(this._eventsInProgress),M=Ao(c),D={};for(const $ in c){const{originalEvent:re}=c[$];this._eventsInProgress[$]||(D[`${$}start`]=re),this._eventsInProgress[$]=c[$]}!x&&M&&this._fireEvent("movestart",M.originalEvent);for(const $ in D)this._fireEvent($,D[$]);M&&this._fireEvent("move",M.originalEvent);for(const $ in c){const{originalEvent:re}=c[$];this._fireEvent($,re)}const F={};let N;for(const $ in this._eventsInProgress){const{handlerName:re,originalEvent:ue}=this._eventsInProgress[$];this._handlersById[re].isActive()||(delete this._eventsInProgress[$],N=f[re]||ue,F[`${$}end`]=N)}for(const $ in F)this._fireEvent($,F[$]);const G=Ao(this._eventsInProgress),q=(x||M)&&!G;if(q&&this._terrainMovement&&(this._map._elevationFreeze=!1,this._terrainMovement=!1,this._map.transform.recalculateZoom(this._map.terrain)),y&&q){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),re=ue=>ue!==0&&-this._bearingSnap<ue&&ue<this._bearingSnap;!$||!$.essential&&_.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:N})),re(this._map.getBearing())&&this._map.resetNorth()):(re($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:N})),this._updatingCamera=!1}}_fireEvent(c,f){this._map.fire(new o.k(c,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{delete this._frameId,this.handleEvent(new ev("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bb extends o.E{constructor(c,f){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.M(this.transform.center.lng,this.transform.center.lat)}setCenter(c,f){return this.jumpTo({center:c},f)}panBy(c,f,y){return c=o.P.convert(c).mult(-1),this.panTo(this.transform.center,o.e({offset:c},f),y)}panTo(c,f,y){return this.easeTo(o.e({center:c},f),y)}getZoom(){return this.transform.zoom}setZoom(c,f){return this.jumpTo({zoom:c},f),this}zoomTo(c,f,y){return this.easeTo(o.e({zoom:c},f),y)}zoomIn(c,f){return this.zoomTo(this.getZoom()+1,c,f),this}zoomOut(c,f){return this.zoomTo(this.getZoom()-1,c,f),this}getBearing(){return this.transform.bearing}setBearing(c,f){return this.jumpTo({bearing:c},f),this}getPadding(){return this.transform.padding}setPadding(c,f){return this.jumpTo({padding:c},f),this}rotateTo(c,f,y){return this.easeTo(o.e({bearing:c},f),y)}resetNorth(c,f){return this.rotateTo(0,o.e({duration:1e3},c),f),this}resetNorthPitch(c,f){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},c),f),this}snapToNorth(c,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,f):this}getPitch(){return this.transform.pitch}setPitch(c,f){return this.jumpTo({pitch:c},f),this}cameraForBounds(c,f){c=on.convert(c);const y=f&&f.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),y,f)}_cameraForBoxAndBearing(c,f,y,x){const M={top:0,bottom:0,right:0,left:0};if(typeof(x=o.e({padding:M,offset:[0,0],maxZoom:this.transform.maxZoom},x)).padding=="number"){const Dt=x.padding;x.padding={top:Dt,bottom:Dt,right:Dt,left:Dt}}x.padding=o.e(M,x.padding);const D=this.transform,F=D.padding,N=new on(c,f),G=D.project(N.getNorthWest()),q=D.project(N.getNorthEast()),$=D.project(N.getSouthEast()),re=D.project(N.getSouthWest()),ue=o.b9(-y),de=G.rotate(ue),we=q.rotate(ue),ge=$.rotate(ue),Ce=re.rotate(ue),Oe=new o.P(Math.max(de.x,we.x,Ce.x,ge.x),Math.max(de.y,we.y,Ce.y,ge.y)),ye=new o.P(Math.min(de.x,we.x,Ce.x,ge.x),Math.min(de.y,we.y,Ce.y,ge.y)),Ve=Oe.sub(ye),Xe=(D.width-(F.left+F.right+x.padding.left+x.padding.right))/Ve.x,nt=(D.height-(F.top+F.bottom+x.padding.top+x.padding.bottom))/Ve.y;if(nt<0||Xe<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const _t=Math.min(D.scaleZoom(D.scale*Math.min(Xe,nt)),x.maxZoom),Rt=o.P.convert(x.offset),sn=new o.P((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(o.b9(y)),an=Rt.add(sn).mult(D.scale/D.zoomScale(_t));return{center:D.unproject(G.add($).div(2).sub(an)),zoom:_t,bearing:y}}fitBounds(c,f,y){return this._fitInternal(this.cameraForBounds(c,f),f,y)}fitScreenCoordinates(c,f,y,x,M){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(c)),this.transform.pointLocation(o.P.convert(f)),y,x),x,M)}_fitInternal(c,f,y){return c?(delete(f=o.e(c,f)).padding,f.linear?this.easeTo(f,y):this.flyTo(f,y)):this}jumpTo(c,f){this.stop();const y=this._getTransformForUpdate();let x=!1,M=!1,D=!1;return"zoom"in c&&y.zoom!==+c.zoom&&(x=!0,y.zoom=+c.zoom),c.center!==void 0&&(y.center=o.M.convert(c.center)),"bearing"in c&&y.bearing!==+c.bearing&&(M=!0,y.bearing=+c.bearing),"pitch"in c&&y.pitch!==+c.pitch&&(D=!0,y.pitch=+c.pitch),c.padding==null||y.isPaddingEqual(c.padding)||(y.padding=c.padding),this._applyUpdatedTransform(y),this.fire(new o.k("movestart",f)).fire(new o.k("move",f)),x&&this.fire(new o.k("zoomstart",f)).fire(new o.k("zoom",f)).fire(new o.k("zoomend",f)),M&&this.fire(new o.k("rotatestart",f)).fire(new o.k("rotate",f)).fire(new o.k("rotateend",f)),D&&this.fire(new o.k("pitchstart",f)).fire(new o.k("pitch",f)).fire(new o.k("pitchend",f)),this.fire(new o.k("moveend",f))}calculateCameraOptionsFromTo(c,f,y,x=0){const M=o.Y.fromLngLat(c,f),D=o.Y.fromLngLat(y,x),F=D.x-M.x,N=D.y-M.y,G=D.z-M.z,q=Math.hypot(F,N,G);if(q===0)throw new Error("Can't calculate camera options with same From and To");const $=Math.hypot(F,N),re=this.transform.scaleZoom(this.transform.cameraToCenterDistance/q/this.transform.tileSize),ue=180*Math.atan2(F,-N)/Math.PI;let de=180*Math.acos($/q)/Math.PI;return de=G<0?90-de:90+de,{center:D.toLngLat(),zoom:re,pitch:de,bearing:ue}}easeTo(c,f){var y;this._stop(!1,c.easeId),((c=o.e({offset:[0,0],duration:500,easing:o.b8},c)).animate===!1||!c.essential&&_.prefersReducedMotion)&&(c.duration=0);const x=this._getTransformForUpdate(),M=this.getZoom(),D=this.getBearing(),F=this.getPitch(),N=this.getPadding(),G="bearing"in c?this._normalizeBearing(c.bearing,D):D,q="pitch"in c?+c.pitch:F,$="padding"in c?c.padding:x.padding,re=o.P.convert(c.offset);let ue=x.centerPoint.add(re);const de=x.pointLocation(ue),{center:we,zoom:ge}=x.getConstrained(o.M.convert(c.center||de),(y=c.zoom)!==null&&y!==void 0?y:M);this._normalizeCenter(we);const Ce=x.project(de),Oe=x.project(we).sub(Ce),ye=x.zoomScale(ge-M);let Ve,Xe;c.around&&(Ve=o.M.convert(c.around),Xe=x.locationPoint(Ve));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ge!==M,this._rotating=this._rotating||D!==G,this._pitching=this._pitching||q!==F,this._padding=!x.isPaddingEqual($),this._easeId=c.easeId,this._prepareEase(f,c.noMoveStart,nt),this.terrain&&this._prepareElevation(we),this._ease(_t=>{if(this._zooming&&(x.zoom=o.z.number(M,ge,_t)),this._rotating&&(x.bearing=o.z.number(D,G,_t)),this._pitching&&(x.pitch=o.z.number(F,q,_t)),this._padding&&(x.interpolatePadding(N,$,_t),ue=x.centerPoint.add(re)),this.terrain&&!c.freezeElevation&&this._updateElevation(_t),Ve)x.setLocationAtPoint(Ve,Xe);else{const Rt=x.zoomScale(x.zoom-M),sn=ge>M?Math.min(2,ye):Math.max(.5,ye),an=Math.pow(sn,1-_t),Dt=x.unproject(Ce.add(Oe.mult(_t*an)).mult(Rt));x.setLocationAtPoint(x.renderWorldCopies?Dt.wrap():Dt,ue)}this._applyUpdatedTransform(x),this._fireMoveEvents(f)},_t=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(f,_t)},c),this}_prepareEase(c,f,y={}){this._moving=!0,f||y.moving||this.fire(new o.k("movestart",c)),this._zooming&&!y.zooming&&this.fire(new o.k("zoomstart",c)),this._rotating&&!y.rotating&&this.fire(new o.k("rotatestart",c)),this._pitching&&!y.pitching&&this.fire(new o.k("pitchstart",c))}_prepareElevation(c){this._elevationCenter=c,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(c,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(c){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(c<1&&f!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=c*(y-(f-(y*c+this._elevationStart))/(1-c)),this._elevationTarget=f}this.transform.elevation=o.z.number(this._elevationStart,this._elevationTarget,c)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(c){if(!this.transformCameraUpdate)return;const f=c.clone(),{center:y,zoom:x,pitch:M,bearing:D,elevation:F}=this.transformCameraUpdate(f);y&&(f.center=y),x!==void 0&&(f.zoom=x),M!==void 0&&(f.pitch=M),D!==void 0&&(f.bearing=D),F!==void 0&&(f.elevation=F),this.transform.apply(f)}_fireMoveEvents(c){this.fire(new o.k("move",c)),this._zooming&&this.fire(new o.k("zoom",c)),this._rotating&&this.fire(new o.k("rotate",c)),this._pitching&&this.fire(new o.k("pitch",c))}_afterEase(c,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const y=this._zooming,x=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new o.k("zoomend",c)),x&&this.fire(new o.k("rotateend",c)),M&&this.fire(new o.k("pitchend",c)),this.fire(new o.k("moveend",c))}flyTo(c,f){var y;if(!c.essential&&_.prefersReducedMotion){const Jt=o.L(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Jt,f)}this.stop(),c=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b8},c);const x=this._getTransformForUpdate(),M=this.getZoom(),D=this.getBearing(),F=this.getPitch(),N=this.getPadding(),G="bearing"in c?this._normalizeBearing(c.bearing,D):D,q="pitch"in c?+c.pitch:F,$="padding"in c?c.padding:x.padding,re=o.P.convert(c.offset);let ue=x.centerPoint.add(re);const de=x.pointLocation(ue),{center:we,zoom:ge}=x.getConstrained(o.M.convert(c.center||de),(y=c.zoom)!==null&&y!==void 0?y:M);this._normalizeCenter(we);const Ce=x.zoomScale(ge-M),Oe=x.project(de),ye=x.project(we).sub(Oe);let Ve=c.curve;const Xe=Math.max(x.width,x.height),nt=Xe/Ce,_t=ye.mag();if("minZoom"in c){const Jt=o.ac(Math.min(c.minZoom,M,ge),x.minZoom,x.maxZoom),Gn=Xe/x.zoomScale(Jt-M);Ve=Math.sqrt(Gn/_t*2)}const Rt=Ve*Ve;function sn(Jt){const Gn=(nt*nt-Xe*Xe+(Jt?-1:1)*Rt*Rt*_t*_t)/(2*(Jt?nt:Xe)*Rt*_t);return Math.log(Math.sqrt(Gn*Gn+1)-Gn)}function an(Jt){return(Math.exp(Jt)-Math.exp(-Jt))/2}function Dt(Jt){return(Math.exp(Jt)+Math.exp(-Jt))/2}const Nt=sn(!1);let yn=function(Jt){return Dt(Nt)/Dt(Nt+Ve*Jt)},qn=function(Jt){return Xe*((Dt(Nt)*(an(Gn=Nt+Ve*Jt)/Dt(Gn))-an(Nt))/Rt)/_t;var Gn},$t=(sn(!0)-Nt)/Ve;if(Math.abs(_t)<1e-6||!isFinite($t)){if(Math.abs(Xe-nt)<1e-6)return this.easeTo(c,f);const Jt=nt<Xe?-1:1;$t=Math.abs(Math.log(nt/Xe))/Ve,qn=()=>0,yn=Gn=>Math.exp(Jt*Ve*Gn)}return c.duration="duration"in c?+c.duration:1e3*$t/("screenSpeed"in c?+c.screenSpeed/Ve:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=D!==G,this._pitching=q!==F,this._padding=!x.isPaddingEqual($),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(we),this._ease(Jt=>{const Gn=Jt*$t,fr=1/yn(Gn);x.zoom=Jt===1?ge:M+x.scaleZoom(fr),this._rotating&&(x.bearing=o.z.number(D,G,Jt)),this._pitching&&(x.pitch=o.z.number(F,q,Jt)),this._padding&&(x.interpolatePadding(N,$,Jt),ue=x.centerPoint.add(re)),this.terrain&&!c.freezeElevation&&this._updateElevation(Jt);const ri=Jt===1?we:x.unproject(Oe.add(ye.mult(qn(Gn))).mult(fr));x.setLocationAtPoint(x.renderWorldCopies?ri.wrap():ri,ue),this._applyUpdatedTransform(x),this._fireMoveEvents(f)},()=>{this.terrain&&c.freezeElevation&&this._finalizeElevation(),this._afterEase(f)},c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,f){var y;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,f)}return c||(y=this.handlers)===null||y===void 0||y.stop(!1),this}_ease(c,f,y){y.animate===!1||y.duration===0?(c(1),f()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=c,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(c,f){c=o.b2(c,-180,180);const y=Math.abs(c-f);return Math.abs(c-360-f)<y&&(c-=360),Math.abs(c+360-f)<y&&(c+=360),c}_normalizeCenter(c){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const y=c.lng-f.center.lng;c.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(c){return this.terrain?this.terrain.getElevationForLngLatZoom(o.M.convert(c),this.transform.tileZoom)-this.transform.elevation:null}}const tv={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class nv{constructor(c=tv){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=c}getDefaultPosition(){return"bottom-right"}onAdd(c){return this._map=c,this._compact=this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(c,f){const y=this._map._getUIString(`AttributionControl.${f}`);c.title=y,c.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let c=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=c.concat(this.options.customAttribution.map(x=>typeof x!="string"?"":x)):typeof this.options.customAttribution=="string"&&c.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const f=this._map.style.sourceCaches;for(const x in f){const M=f[x];if(M.used||M.usedForTerrain){const D=M.getSource();D.attribution&&c.indexOf(D.attribution)<0&&c.push(D.attribution)}}c=c.filter(x=>String(x).trim()),c.sort((x,M)=>x.length-M.length),c=c.filter((x,M)=>{for(let D=M+1;D<c.length;D++)if(c[D].indexOf(x)>=0)return!1;return!0});const y=c.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,c.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Yg{constructor(c={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const y=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=c}getDefaultPosition(){return"bottom-left"}onAdd(c){this._map=c,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const f=w.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class jd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f}remove(c){const f=this._currentlyRunning,y=f?this._queue.concat(f):this._queue;for(const x of y)if(x.id===c)return void(x.cancelled=!0)}run(c=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const y of f)if(!y.cancelled&&(y.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var lc=o.X([{name:"a_pos3d",type:"Int16",components:3}]);class dn extends o.E{constructor(c){super(),this.sourceCache=c,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,c.usedForTerrain=!0,c.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(c,f){this.sourceCache.update(c,f),this._renderableTilesKeys=[];const y={};for(const x of c.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))y[x.key]=!0,this._renderableTilesKeys.push(x.key),this._tiles[x.key]||(x.posMatrix=new Float64Array(16),o.aO(x.posMatrix,0,o.W,0,o.W,0,1),this._tiles[x.key]=new At(x,this.tileSize));for(const x in this._tiles)y[x]||delete this._tiles[x]}freeRtt(c){for(const f in this._tiles){const y=this._tiles[f];(!c||y.tileID.equals(c)||y.tileID.isChildOf(c)||c.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(c=>this.getTileByID(c))}getTileByID(c){return this._tiles[c]}getTerrainCoords(c){const f={};for(const y of this._renderableTilesKeys){const x=this._tiles[y].tileID;if(x.canonical.equals(c.canonical)){const M=c.clone();M.posMatrix=new Float64Array(16),o.aO(M.posMatrix,0,o.W,0,o.W,0,1),f[y]=M}else if(x.canonical.isChildOf(c.canonical)){const M=c.clone();M.posMatrix=new Float64Array(16);const D=x.canonical.z-c.canonical.z,F=x.canonical.x-(x.canonical.x>>D<<D),N=x.canonical.y-(x.canonical.y>>D<<D),G=o.W>>D;o.aO(M.posMatrix,0,G,0,G,0,1),o.H(M.posMatrix,M.posMatrix,[-F*G,-N*G,0]),f[y]=M}else if(c.canonical.isChildOf(x.canonical)){const M=c.clone();M.posMatrix=new Float64Array(16);const D=c.canonical.z-x.canonical.z,F=c.canonical.x-(c.canonical.x>>D<<D),N=c.canonical.y-(c.canonical.y>>D<<D),G=o.W>>D;o.aO(M.posMatrix,0,o.W,0,o.W,0,1),o.H(M.posMatrix,M.posMatrix,[F*G,N*G,0]),o.J(M.posMatrix,M.posMatrix,[1/2**D,1/2**D,0]),f[y]=M}}return f}getSourceTile(c,f){const y=this.sourceCache._source;let x=c.overscaledZ-this.deltaZoom;if(x>y.maxzoom&&(x=y.maxzoom),x<y.minzoom)return null;this._sourceTileCache[c.key]||(this._sourceTileCache[c.key]=c.scaledTo(x).key);let M=this.sourceCache.getTileByID(this._sourceTileCache[c.key]);if((!M||!M.dem)&&f)for(;x>=y.minzoom&&(!M||!M.dem);)M=this.sourceCache.getTileByID(c.scaledTo(x--).key);return M}tilesAfterTime(c=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=c)}}class iv{constructor(c,f,y){this.painter=c,this.sourceCache=new dn(f),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(c,f,y,x=o.W){var M;if(!(f>=0&&f<x&&y>=0&&y<x))return 0;const D=this.getTerrainData(c),F=(M=D.tile)===null||M===void 0?void 0:M.dem;if(!F)return 0;const N=function(de,we,ge){var Ce=we[0],Oe=we[1];return de[0]=ge[0]*Ce+ge[4]*Oe+ge[12],de[1]=ge[1]*Ce+ge[5]*Oe+ge[13],de}([],[f/x*o.W,y/x*o.W],D.u_terrain_matrix),G=[N[0]*F.dim,N[1]*F.dim],q=Math.floor(G[0]),$=Math.floor(G[1]),re=G[0]-q,ue=G[1]-$;return F.get(q,$)*(1-re)*(1-ue)+F.get(q+1,$)*re*(1-ue)+F.get(q,$+1)*(1-re)*ue+F.get(q+1,$+1)*re*ue}getElevationForLngLatZoom(c,f){const{tileID:y,mercatorX:x,mercatorY:M}=this._getOverscaledTileIDFromLngLatZoom(c,f);return this.getElevation(y,x%o.W,M%o.W,o.W)}getElevation(c,f,y,x=o.W){return this.getDEMElevation(c,f,y,x)*this.exaggeration}getTerrainData(c){if(!this._emptyDemTexture){const x=this.painter.context,M=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new pe(x,M,x.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new pe(x,new o.R({width:1,height:1}),x.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const f=this.sourceCache.getSourceTile(c,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const x=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new pe(x,f.dem.getPixels(),x.gl.RGBA,{premultiply:!1}),f.demTexture.bind(x.gl.NEAREST,x.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const y=f&&f+f.tileID.key+c.key;if(y&&!this._demMatrixCache[y]){const x=this.sourceCache.sourceCache._source.maxzoom;let M=c.canonical.z-f.tileID.canonical.z;c.overscaledZ>c.canonical.z&&(c.canonical.z>=x?M=c.canonical.z-x:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const D=c.canonical.x-(c.canonical.x>>M<<M),F=c.canonical.y-(c.canonical.y>>M<<M),N=o.ba(new Float64Array(16),[1/(o.W<<M),1/(o.W<<M),0]);o.H(N,N,[D*o.W,F*o.W,0]),this._demMatrixCache[c.key]={matrix:N,coord:c}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[c.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(c){const f=this.painter,y=f.width/devicePixelRatio,x=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===x||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new pe(f.context,{width:y,height:x,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new pe(f.context,{width:y,height:x,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(y,x,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,y,x))),this._fbo.colorAttachment.set(c==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const c=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let M=0,D=0;M<this._coordsTextureSize;M++)for(let F=0;F<this._coordsTextureSize;F++,D+=4)f[D+0]=255&F,f[D+1]=255&M,f[D+2]=F>>8<<4|M>>8,f[D+3]=0;const y=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),x=new pe(c,y,c.gl.RGBA,{premultiply:!1});return x.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._coordsTexture=x,x}pointCoordinate(c){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),y=this.painter.context,x=y.gl,M=Math.round(c.x*this.painter.pixelRatio/devicePixelRatio),D=Math.round(c.y*this.painter.pixelRatio/devicePixelRatio),F=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),x.readPixels(M,F-D-1,1,1,x.RGBA,x.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null);const N=f[0]+(f[2]>>4<<8),G=f[1]+((15&f[2])<<8),q=this.coordsIndex[255-f[3]],$=q&&this.sourceCache.getTileByID(q);if(!$)return null;const re=this._coordsTextureSize,ue=(1<<$.tileID.canonical.z)*re;return new o.Y(($.tileID.canonical.x*re+N)/ue+$.tileID.wrap,($.tileID.canonical.y*re+G)/ue,this.getElevation($.tileID,N,G,re))}depthAtPoint(c){const f=new Uint8Array(4),y=this.painter.context,x=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),x.readPixels(c.x,this.painter.height/devicePixelRatio-c.y-1,1,1,x.RGBA,x.UNSIGNED_BYTE,f),y.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const c=this.painter.context,f=new o.bb,y=new o.aY,x=this.meshSize,M=o.W/x,D=x*x;for(let $=0;$<=x;$++)for(let re=0;re<=x;re++)f.emplaceBack(re*M,$*M,0);for(let $=0;$<D;$+=x+1)for(let re=0;re<x;re++)y.emplaceBack(re+$,x+re+$+1,x+re+$+2),y.emplaceBack(re+$,x+re+$+2,re+$+1);const F=f.length,N=F+2*(x+1);for(const $ of[0,1])for(let re=0;re<=x;re++)for(const ue of[0,1])f.emplaceBack(re*M,$*o.W,ue);for(let $=0;$<2*x;$+=2)y.emplaceBack(N+$,N+$+1,N+$+3),y.emplaceBack(N+$,N+$+3,N+$+2),y.emplaceBack(F+$,F+$+3,F+$+1),y.emplaceBack(F+$,F+$+2,F+$+3);const G=f.length,q=G+2*(x+1);for(const $ of[0,1])for(let re=0;re<=x;re++)for(const ue of[0,1])f.emplaceBack($*o.W,re*M,ue);for(let $=0;$<2*x;$+=2)y.emplaceBack(G+$,G+$+1,G+$+3),y.emplaceBack(G+$,G+$+3,G+$+2),y.emplaceBack(q+$,q+$+3,q+$+1),y.emplaceBack(q+$,q+$+2,q+$+3);return this._mesh={indexBuffer:c.createIndexBuffer(y),vertexBuffer:c.createVertexBuffer(f,lc.members),segments:o.$.simpleSegment(0,0,f.length,y.length)},this._mesh}getMeshFrameDelta(c){return 2*Math.PI*o.bc/Math.pow(2,c)/5}getMinTileElevationForLngLatZoom(c,f){var y;const{tileID:x}=this._getOverscaledTileIDFromLngLatZoom(c,f);return(y=this.getMinMaxElevation(x).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(c){const f=this.getTerrainData(c).tile,y={minElevation:null,maxElevation:null};return f&&f.dem&&(y.minElevation=f.dem.min*this.exaggeration,y.maxElevation=f.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(c,f){const y=o.Y.fromLngLat(c.wrap()),x=(1<<f)*o.W,M=y.x*x,D=y.y*x,F=Math.floor(M/o.W),N=Math.floor(D/o.W);return{tileID:new o.Q(f,0,f,F,N),mercatorX:M,mercatorY:D}}}class $d{constructor(c,f,y){this._context=c,this._size=f,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const c of this._objects)c.texture.destroy(),c.fbo.destroy()}_createObject(c){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new pe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(y.texture),{id:c,fbo:f,texture:y,stamp:-1,inUse:!1}}getObjectForId(c){return this._objects[c]}useObject(c){c.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>c.id!==f),this._recentlyUsed.push(c.id)}stampObject(c){c.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const c=this._createObject(this._objects.length);return this._objects.push(c),c}freeObject(c){c.inUse=!1}freeAllObjects(){for(const c of this._objects)this.freeObject(c)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(c=>!c.inUse)===!1}}const ja={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class rv{constructor(c,f){this.painter=c,this.terrain=f,this.pool=new $d(c.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(c){return this.pool.getObjectForId(c.rtt[this._stacks.length-1].id).texture}prepareForRender(c,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=c._order.filter(y=>!c._layers[y].isHidden(f)),this._coordsDescendingInv={};for(const y in c.sourceCaches){this._coordsDescendingInv[y]={};const x=c.sourceCaches[y].getVisibleCoordinates();for(const M of x){const D=this.terrain.sourceCache.getTerrainCoords(M);for(const F in D)this._coordsDescendingInv[y][F]||(this._coordsDescendingInv[y][F]=[]),this._coordsDescendingInv[y][F].push(D[F])}}this._coordsDescendingInvStr={};for(const y of c._order){const x=c._layers[y],M=x.source;if(ja[x.type]&&!this._coordsDescendingInvStr[M]){this._coordsDescendingInvStr[M]={};for(const D in this._coordsDescendingInv[M])this._coordsDescendingInvStr[M][D]=this._coordsDescendingInv[M][D].map(F=>F.key).sort().join()}}for(const y of this._renderableTiles)for(const x in this._coordsDescendingInvStr){const M=this._coordsDescendingInvStr[x][y.tileID.key];M&&M!==y.rttCoords[x]&&(y.rtt=[])}}renderLayer(c){if(c.isHidden(this.painter.transform.zoom))return!1;const f=c.type,y=this.painter,x=this._renderableLayerIds[this._renderableLayerIds.length-1]===c.id;if(ja[f]&&(this._prevType&&ja[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(c.id),!x))return!0;if(ja[this._prevType]||ja[f]&&x){this._prevType=f;const M=this._stacks.length-1,D=this._stacks[M]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(We(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[M]){const G=this.pool.getObjectForId(F.rtt[M].id);if(G.stamp===F.rtt[M].stamp){this.pool.useObject(G);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),F.rtt[M]={id:N.id,stamp:N.stamp},y.context.bindFramebuffer.set(N.fbo.framebuffer),y.context.clear({color:o.aP.transparent,stencil:0}),y.currentStencilSource=void 0;for(let G=0;G<D.length;G++){const q=y.style._layers[D[G]],$=q.source?this._coordsDescendingInv[q.source][F.tileID.key]:[F.tileID];y.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),y._renderTileClippingMasks(q,$),y.renderLayer(y,y.style.sourceCaches[q.source],q,$),q.source&&(F.rttCoords[q.source]=this._coordsDescendingInvStr[q.source][F.tileID.key])}}return We(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ja[f]}return!1}}const en={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Kg=d,Ub={hash:!1,interactive:!0,bearingSnap:7,attributionControl:tv,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},sv=S=>{S.touchstart=S.dragStart,S.touchmoveWindow=S.dragMove,S.touchend=S.dragEnd},Jg={showCompass:!0,showZoom:!0,visualizePitch:!1};class ov{constructor(c,f,y=!1){this.mousedown=D=>{this.startMouse(o.e({},D,{ctrlKey:!0,preventDefault:()=>D.preventDefault()}),w.mousePos(this.element,D)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=D=>{this.moveMouse(D,w.mousePos(this.element,D))},this.mouseup=D=>{this.mouseRotate.dragEnd(D),this.mousePitch&&this.mousePitch.dragEnd(D),this.offTemp()},this.touchstart=D=>{D.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,D.targetTouches)[0],this.startTouch(D,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=D=>{D.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,D.targetTouches)[0],this.moveTouch(D,this._lastPos))},this.touchend=D=>{D.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const x=c.dragRotate._mouseRotate.getClickTolerance(),M=c.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=zr({clickTolerance:x,enable:!0}),this.touchRotate=(({enable:D,clickTolerance:F,bearingDegreesPerPixelMoved:N=.8})=>{const G=new Yi;return new us({clickTolerance:F,move:(q,$)=>({bearingDelta:($.x-q.x)*N}),moveStateManager:G,enable:D,assignEvents:sv})})({clickTolerance:x,enable:!0}),this.map=c,y&&(this.mousePitch=iu({clickTolerance:M,enable:!0}),this.touchPitch=(({enable:D,clickTolerance:F,pitchDegreesPerPixelMoved:N=-.5})=>{const G=new Yi;return new us({clickTolerance:F,move:(q,$)=>({pitchDelta:($.y-q.y)*N}),moveStateManager:G,enable:D,assignEvents:sv})})({clickTolerance:M,enable:!0})),w.addEventListener(f,"mousedown",this.mousedown),w.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(f,"touchcancel",this.reset)}startMouse(c,f){this.mouseRotate.dragStart(c,f),this.mousePitch&&this.mousePitch.dragStart(c,f),w.disableDrag()}startTouch(c,f){this.touchRotate.dragStart(c,f),this.touchPitch&&this.touchPitch.dragStart(c,f),w.disableDrag()}moveMouse(c,f){const y=this.map,{bearingDelta:x}=this.mouseRotate.dragMove(c,f)||{};if(x&&y.setBearing(y.getBearing()+x),this.mousePitch){const{pitchDelta:M}=this.mousePitch.dragMove(c,f)||{};M&&y.setPitch(y.getPitch()+M)}}moveTouch(c,f){const y=this.map,{bearingDelta:x}=this.touchRotate.dragMove(c,f)||{};if(x&&y.setBearing(y.getBearing()+x),this.touchPitch){const{pitchDelta:M}=this.touchPitch.dragMove(c,f)||{};M&&y.setPitch(y.getPitch()+M)}}off(){const c=this.element;w.removeEventListener(c,"mousedown",this.mousedown),w.removeEventListener(c,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(c,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let cc;function av(S,c,f){const y=new o.M(S.lng,S.lat);if(S=new o.M(S.lng,S.lat),c){const x=new o.M(S.lng-360,S.lat),M=new o.M(S.lng+360,S.lat),D=f.locationPoint(S).distSqr(c);f.locationPoint(x).distSqr(c)<D?S=x:f.locationPoint(M).distSqr(c)<D&&(S=M)}for(;Math.abs(S.lng-f.center.lng)>180;){const x=f.locationPoint(S);if(x.x>=0&&x.y>=0&&x.x<=f.width&&x.y<=f.height)break;S.lng>f.center.lng?S.lng-=360:S.lng+=360}return S.lng!==y.lng&&f.locationPoint(S).y>f.height/2-f.getHorizon()?S:y}const Qg={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function uc(S,c,f){const y=S.classList;for(const x in Qg)y.remove(`maplibregl-${f}-anchor-${x}`);y.add(`maplibregl-${f}-anchor-${c}`)}class rr extends o.E{constructor(c){if(super(),this._onKeyPress=f=>{const y=f.code,x=f.charCode||f.keyCode;y!=="Space"&&y!=="Enter"&&x!==32&&x!==13||this.togglePopup()},this._onMapClick=f=>{const y=f.originalEvent.target,x=this._element;this._popup&&(y===x||x.contains(y))&&this.togglePopup()},this._update=f=>{var y;if(!this._map)return;const x=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!x)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?av(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let M="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?M=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(M=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let D="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?D="rotateX(0deg)":this._pitchAlignment==="map"&&(D=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${Qg[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${D} ${M}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(c==null?void 0:c.opacity,c==null?void 0:c.opacityWhenCovered),c&&c.element)this._element=c.element,this._offset=o.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div");const f=w.createNS("http://www.w3.org/2000/svg","svg"),y=41,x=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${y}px`),f.setAttributeNS(null,"width",`${x}px`),f.setAttributeNS(null,"viewBox",`0 0 ${x} ${y}`);const M=w.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"stroke","none"),M.setAttributeNS(null,"stroke-width","1"),M.setAttributeNS(null,"fill","none"),M.setAttributeNS(null,"fill-rule","evenodd");const D=w.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill-rule","nonzero");const F=w.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"transform","translate(3.0, 29.0)"),F.setAttributeNS(null,"fill","#000000");const N=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of N){const Oe=w.createNS("http://www.w3.org/2000/svg","ellipse");Oe.setAttributeNS(null,"opacity","0.04"),Oe.setAttributeNS(null,"cx","10.5"),Oe.setAttributeNS(null,"cy","5.80029008"),Oe.setAttributeNS(null,"rx",Ce.rx),Oe.setAttributeNS(null,"ry",Ce.ry),F.appendChild(Oe)}const G=w.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const q=w.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(q);const $=w.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"opacity","0.25"),$.setAttributeNS(null,"fill","#000000");const re=w.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),$.appendChild(re);const ue=w.createNS("http://www.w3.org/2000/svg","g");ue.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ue.setAttributeNS(null,"fill","#FFFFFF");const de=w.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const we=w.createNS("http://www.w3.org/2000/svg","circle");we.setAttributeNS(null,"fill","#000000"),we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"cx","5.5"),we.setAttributeNS(null,"cy","5.5"),we.setAttributeNS(null,"r","5.4999962");const ge=w.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#FFFFFF"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962"),de.appendChild(we),de.appendChild(ge),D.appendChild(F),D.appendChild(G),D.appendChild($),D.appendChild(ue),D.appendChild(de),f.appendChild(D),f.setAttributeNS(null,"height",y*this._scale+"px"),f.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(f),this._offset=o.P.convert(c&&c.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),uc(this._element,this._anchor,"marker"),c&&c.className)for(const f of c.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(c){return this.remove(),this._map=c,this._element.setAttribute("aria-label",c._getUIString("Marker.Title")),c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),c.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=o.M.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const x=Math.abs(13.5)/Math.SQRT2;c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const c=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:c?(c.isOpen()?c.remove():(c.setLngLat(this._lngLat),c.addTo(this._map)),this):this}_updateOpacity(c=!1){var f,y;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(c)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const x=this._map,M=x.terrain.depthAtPoint(this._pos),D=x.terrain.getElevationForLngLatZoom(this._lngLat,x.transform.tileZoom);if(x.transform.lngLatToCameraDepth(this._lngLat,D)-M<.006)return void(this._element.style.opacity=this._opacity);const F=-this._offset.y/x.transform._pixelPerMeter,N=Math.sin(x.getPitch()*Math.PI/180)*F,G=x.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),q=x.transform.lngLatToCameraDepth(this._lngLat,D+N)-G>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(c){return this._offset=o.P.convert(c),this._update(),this}addClassName(c){this._element.classList.add(c)}removeClassName(c){this._element.classList.remove(c)}toggleClassName(c){return this._element.classList.toggle(c)}setDraggable(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(c,f){return c===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),c!==void 0&&(this._opacity=c),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const ap={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ph=0,mh=!1;const lv={maxWidth:100,unit:"metric"};function e_(S,c,f){const y=f&&f.maxWidth||100,x=S._container.clientHeight/2,M=S.unproject([0,x]),D=S.unproject([y,x]),F=M.distanceTo(D);if(f&&f.unit==="imperial"){const N=3.2808*F;N>5280?qd(c,y,N/5280,S._getUIString("ScaleControl.Miles")):qd(c,y,N,S._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?qd(c,y,F/1852,S._getUIString("ScaleControl.NauticalMiles")):F>=1e3?qd(c,y,F/1e3,S._getUIString("ScaleControl.Kilometers")):qd(c,y,F,S._getUIString("ScaleControl.Meters"))}function qd(S,c,f,y){const x=function(M){const D=Math.pow(10,`${Math.floor(M)}`.length-1);let F=M/D;return F=F>=10?10:F>=5?5:F>=3?3:F>=2?2:F>=1?1:function(N){const G=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*G)/G}(F),D*F}(f);S.style.width=c*(x/f)+"px",S.innerHTML=`${x}&nbsp;${y}`}const $a={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},lp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tn(S){if(S){if(typeof S=="number"){const c=Math.round(Math.abs(S)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,S),"top-left":new o.P(c,c),"top-right":new o.P(-c,c),bottom:new o.P(0,-S),"bottom-left":new o.P(c,-c),"bottom-right":new o.P(-c,-c),left:new o.P(S,0),right:new o.P(-S,0)}}if(S instanceof o.P||Array.isArray(S)){const c=o.P.convert(S);return{center:c,top:c,"top-left":c,"top-right":c,bottom:c,"bottom-left":c,"bottom-right":c,left:c,right:c}}return{center:o.P.convert(S.center||[0,0]),top:o.P.convert(S.top||[0,0]),"top-left":o.P.convert(S["top-left"]||[0,0]),"top-right":o.P.convert(S["top-right"]||[0,0]),bottom:o.P.convert(S.bottom||[0,0]),"bottom-left":o.P.convert(S["bottom-left"]||[0,0]),"bottom-right":o.P.convert(S["bottom-right"]||[0,0]),left:o.P.convert(S.left||[0,0]),right:o.P.convert(S.right||[0,0])}}return Tn(new o.P(0,0))}const On=d;a.AJAXError=o.bf,a.Evented=o.E,a.LngLat=o.M,a.MercatorCoordinate=o.Y,a.Point=o.P,a.addProtocol=o.bg,a.config=o.a,a.removeProtocol=o.bh,a.AttributionControl=nv,a.BoxZoomHandler=bi,a.CanvasSource=xt,a.CooperativeGesturesHandler=qo,a.DoubleClickZoomHandler=qg,a.DragPanHandler=Xg,a.DragRotateHandler=fh,a.EdgeInsets=Oi,a.FullscreenControl=class extends o.E{constructor(S={}){super(),this._onFullscreenChange=()=>{var c;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((c=f==null?void 0:f.shadowRoot)===null||c===void 0)&&c.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,S&&S.container&&(S.container instanceof HTMLElement?this._container=S.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(S){return this._map=S,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const S=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",S).setAttribute("aria-hidden","true"),S.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const S=this._getTitle();this._fullscreenButton.setAttribute("aria-label",S),this._fullscreenButton.title=S}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},a.GeoJSONSource=jt,a.GeolocateControl=class extends o.E{constructor(S){super(),this._onSuccess=c=>{if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",c)),this._finish()}},this._updateCamera=c=>{const f=new o.M(c.coords.longitude,c.coords.latitude),y=c.coords.accuracy,x=this._map.getBearing(),M=o.e({bearing:x},this.options.fitBoundsOptions),D=on.fromLngLat(f,y);this._map.fitBounds(D,M,{geolocateSource:!0})},this._updateMarker=c=>{if(c){const f=new o.M(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=c=>{if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&mh)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",c)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=c=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new rr({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new rr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")),this.fire(new o.k("userlocationlostfocus")))})}},this.options=o.e({},ap,S)}onAdd(S){return this._map=S,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return o._(this,arguments,void 0,function*(c=!1){if(cc!==void 0&&!c)return cc;if(window.navigator.permissions===void 0)return cc=!!window.navigator.geolocation,cc;try{cc=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{cc=!!window.navigator.geolocation}return cc})}().then(c=>this._setupUI(c)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ph=0,mh=!1}_isOutOfMapMaxBounds(S){const c=this._map.getMaxBounds(),f=S.coords;return c&&(f.longitude<c.getWest()||f.longitude>c.getEast()||f.latitude<c.getSouth()||f.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const S=this._map.getBounds(),c=S.getSouthEast(),f=S.getNorthEast(),y=c.distanceTo(f),x=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ph--,mh=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart")),this.fire(new o.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let S;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ph++,ph>1?(S={maximumAge:6e5,timeout:0},mh=!0):(S=this.options.positionOptions,mh=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,S)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},a.Hash=Ns,a.ImageSource=le,a.KeyboardHandler=ac,a.LngLatBounds=on,a.LogoControl=Yg,a.Map=class extends Bb{constructor(S){o.bd.mark(o.be.create);const c=Object.assign(Object.assign({},Ub),S);if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new dr(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies),{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new jd,this._controls=[],this._mapId=o.a3(),this._contextLost=f=>{f.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:f}))},this._contextRestored=f=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:f}))},this._onMapScroll=f=>{if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=c.preserveDrawingBuffer===!0,this._antialias=c.antialias===!0,this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},en),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this.transformCameraUpdate=c.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=z.addThrottleControl(()=>this.isMoving()),this._requestManager=new H(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let f=!1;const y=Mr(x=>{this._trackResize&&!this._removed&&this.resize(x)._update()},50);this._resizeObserver=new ResizeObserver(x=>{f?y(x):f=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wd(this,c),this._hash=c.hash&&new Ns(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,o.e({},c.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new nv(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new Yg,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new o.k(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new o.k(`${f.dataType}dataloading`,f))}),this.on("dataabort",f=>{this.fire(new o.k("sourcedataabort",f))})}_getMapId(){return this._mapId}addControl(S,c){if(c===void 0&&(c=S.getDefaultPosition?S.getDefaultPosition():"top-right"),!S||!S.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=S.onAdd(this);this._controls.push(S);const y=this._controlPositions[c];return c.indexOf("bottom")!==-1?y.insertBefore(f,y.firstChild):y.appendChild(f),this}removeControl(S){if(!S||!S.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(S);return c>-1&&this._controls.splice(c,1),S.onRemove(this),this}hasControl(S){return this._controls.indexOf(S)>-1}calculateCameraOptionsFromTo(S,c,f,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(S,c,f,y)}resize(S){var c;const f=this._containerDimensions(),y=f[0],x=f[1],M=this._getClampedPixelRatio(y,x);if(this._resizeCanvas(y,x,M),this.painter.resize(y,x,M),this.painter.overLimit()){const F=this.painter.context.gl;this._maxCanvasSize=[F.drawingBufferWidth,F.drawingBufferHeight];const N=this._getClampedPixelRatio(y,x);this._resizeCanvas(y,x,N),this.painter.resize(y,x,N)}this.transform.resize(y,x),(c=this._requestedCameraState)===null||c===void 0||c.resize(y,x);const D=!this._moving;return D&&(this.stop(),this.fire(new o.k("movestart",S)).fire(new o.k("move",S))),this.fire(new o.k("resize",S)),D&&this.fire(new o.k("moveend",S)),this}_getClampedPixelRatio(S,c){const{0:f,1:y}=this._maxCanvasSize,x=this.getPixelRatio(),M=S*x,D=c*x;return Math.min(M>f?f/M:1,D>y?y/D:1)*x}getPixelRatio(){var S;return(S=this._overridePixelRatio)!==null&&S!==void 0?S:devicePixelRatio}setPixelRatio(S){this._overridePixelRatio=S,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(S){return this.transform.setMaxBounds(on.convert(S)),this._update()}setMinZoom(S){if((S=S??-2)>=-2&&S<=this.transform.maxZoom)return this.transform.minZoom=S,this._update(),this.getZoom()<S&&this.setZoom(S),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(S){if((S=S??22)>=this.transform.minZoom)return this.transform.maxZoom=S,this._update(),this.getZoom()>S&&this.setZoom(S),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(S){if((S=S??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(S>=0&&S<=this.transform.maxPitch)return this.transform.minPitch=S,this._update(),this.getPitch()<S&&this.setPitch(S),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(S){if((S=S??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(S>=this.transform.minPitch)return this.transform.maxPitch=S,this._update(),this.getPitch()>S&&this.setPitch(S),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(S){return this.transform.renderWorldCopies=S,this._update()}project(S){return this.transform.locationPoint(o.M.convert(S),this.style&&this.terrain)}unproject(S){return this.transform.pointLocation(o.P.convert(S),this.terrain)}isMoving(){var S;return this._moving||((S=this.handlers)===null||S===void 0?void 0:S.isMoving())}isZooming(){var S;return this._zooming||((S=this.handlers)===null||S===void 0?void 0:S.isZooming())}isRotating(){var S;return this._rotating||((S=this.handlers)===null||S===void 0?void 0:S.isRotating())}_createDelegatedListener(S,c,f){if(S==="mouseenter"||S==="mouseover"){let y=!1;return{layer:c,listener:f,delegates:{mousemove:M=>{const D=this.getLayer(c)?this.queryRenderedFeatures(M.point,{layers:[c]}):[];D.length?y||(y=!0,f.call(this,new Tr(S,this,M.originalEvent,{features:D}))):y=!1},mouseout:()=>{y=!1}}}}if(S==="mouseleave"||S==="mouseout"){let y=!1;return{layer:c,listener:f,delegates:{mousemove:D=>{(this.getLayer(c)?this.queryRenderedFeatures(D.point,{layers:[c]}):[]).length?y=!0:y&&(y=!1,f.call(this,new Tr(S,this,D.originalEvent)))},mouseout:D=>{y&&(y=!1,f.call(this,new Tr(S,this,D.originalEvent)))}}}}{const y=x=>{const M=this.getLayer(c)?this.queryRenderedFeatures(x.point,{layers:[c]}):[];M.length&&(x.features=M,f.call(this,x),delete x.features)};return{layer:c,listener:f,delegates:{[S]:y}}}}on(S,c,f){if(f===void 0)return super.on(S,c);const y=this._createDelegatedListener(S,c,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[S]=this._delegatedListeners[S]||[],this._delegatedListeners[S].push(y);for(const x in y.delegates)this.on(x,y.delegates[x]);return this}once(S,c,f){if(f===void 0)return super.once(S,c);const y=this._createDelegatedListener(S,c,f);for(const x in y.delegates)this.once(x,y.delegates[x]);return this}off(S,c,f){return f===void 0?super.off(S,c):(this._delegatedListeners&&this._delegatedListeners[S]&&(y=>{const x=this._delegatedListeners[S];for(let M=0;M<x.length;M++){const D=x[M];if(D.layer===c&&D.listener===f){for(const F in D.delegates)this.off(F,D.delegates[F]);return x.splice(M,1),this}}})(),this)}queryRenderedFeatures(S,c){if(!this.style)return[];let f;const y=S instanceof o.P||Array.isArray(S),x=y?S:[[0,0],[this.transform.width,this.transform.height]];if(c=c||(y?{}:S)||{},x instanceof o.P||typeof x[0]=="number")f=[o.P.convert(x)];else{const M=o.P.convert(x[0]),D=o.P.convert(x[1]);f=[M,new o.P(D.x,M.y),D,new o.P(M.x,D.y),M]}return this.style.queryRenderedFeatures(f,c,this.transform)}querySourceFeatures(S,c){return this.style.querySourceFeatures(S,c)}setStyle(S,c){return(c=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&S?(this._diffStyle(S,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._updateStyle(S,c))}setTransformRequest(S){return this._requestManager.setTransformRequest(S),this}_getUIString(S){const c=this._locale[S];if(c==null)throw new Error(`Missing UI string '${S}'`);return c}_updateStyle(S,c){if(c.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(S,c));const f=this.style&&c.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!S)),S?(this.style=new Hi(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof S=="string"?this.style.loadURL(S,c,f):this.style.loadJSON(S,c,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Hi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(S,c){if(typeof S=="string"){const f=this._requestManager.transformRequest(S,"Style");o.h(f,new AbortController).then(y=>{this._updateDiff(y.data,c)}).catch(y=>{y&&this.fire(new o.j(y))})}else typeof S=="object"&&this._updateDiff(S,c)}_updateDiff(S,c){try{this.style.setState(S,c)&&this._update(!0)}catch(f){o.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(S,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(S,c){return this._lazyInitEmptyStyle(),this.style.addSource(S,c),this._update(!0)}isSourceLoaded(S){const c=this.style&&this.style.sourceCaches[S];if(c!==void 0)return c.loaded();this.fire(new o.j(new Error(`There is no source with ID '${S}'`)))}setTerrain(S){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),S){const c=this.style.sourceCaches[S.source];if(!c)throw new Error(`cannot load terrain, because there exists no source with ID: ${S.source}`);this.terrain===null&&c.reload();for(const f in this.style._layers){const y=this.style._layers[f];y.type==="hillshade"&&y.source===S.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new iv(this.painter,c,S),this.painter.renderToTexture=new rv(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==S.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:S})),this}getTerrain(){var S,c;return(c=(S=this.terrain)===null||S===void 0?void 0:S.options)!==null&&c!==void 0?c:null}areTilesLoaded(){const S=this.style&&this.style.sourceCaches;for(const c in S){const f=S[c]._tiles;for(const y in f){const x=f[y];if(x.state!=="loaded"&&x.state!=="errored")return!1}}return!0}removeSource(S){return this.style.removeSource(S),this._update(!0)}getSource(S){return this.style.getSource(S)}addImage(S,c,f={}){const{pixelRatio:y=1,sdf:x=!1,stretchX:M,stretchY:D,content:F,textFitWidth:N,textFitHeight:G}=f;if(this._lazyInitEmptyStyle(),!(c instanceof HTMLImageElement||o.b(c))){if(c.width===void 0||c.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:q,height:$,data:re}=c,ue=c;return this.style.addImage(S,{data:new o.R({width:q,height:$},new Uint8Array(re)),pixelRatio:y,stretchX:M,stretchY:D,content:F,textFitWidth:N,textFitHeight:G,sdf:x,version:0,userImage:ue}),ue.onAdd&&ue.onAdd(this,S),this}}{const{width:q,height:$,data:re}=_.getImageData(c);this.style.addImage(S,{data:new o.R({width:q,height:$},re),pixelRatio:y,stretchX:M,stretchY:D,content:F,textFitWidth:N,textFitHeight:G,sdf:x,version:0})}}updateImage(S,c){const f=this.style.getImage(S);if(!f)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=c instanceof HTMLImageElement||o.b(c)?_.getImageData(c):c,{width:x,height:M,data:D}=y;if(x===void 0||M===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(x!==f.data.width||M!==f.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const F=!(c instanceof HTMLImageElement||o.b(c));return f.data.replace(D,F),this.style.updateImage(S,f),this}getImage(S){return this.style.getImage(S)}hasImage(S){return S?!!this.style.getImage(S):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(S){this.style.removeImage(S)}loadImage(S){return z.getImage(this._requestManager.transformRequest(S,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(S,c){return this._lazyInitEmptyStyle(),this.style.addLayer(S,c),this._update(!0)}moveLayer(S,c){return this.style.moveLayer(S,c),this._update(!0)}removeLayer(S){return this.style.removeLayer(S),this._update(!0)}getLayer(S){return this.style.getLayer(S)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(S,c,f){return this.style.setLayerZoomRange(S,c,f),this._update(!0)}setFilter(S,c,f={}){return this.style.setFilter(S,c,f),this._update(!0)}getFilter(S){return this.style.getFilter(S)}setPaintProperty(S,c,f,y={}){return this.style.setPaintProperty(S,c,f,y),this._update(!0)}getPaintProperty(S,c){return this.style.getPaintProperty(S,c)}setLayoutProperty(S,c,f,y={}){return this.style.setLayoutProperty(S,c,f,y),this._update(!0)}getLayoutProperty(S,c){return this.style.getLayoutProperty(S,c)}setGlyphs(S,c={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(S,c),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(S,c,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(S,c,f,y=>{y||this._update(!0)}),this}removeSprite(S){return this._lazyInitEmptyStyle(),this.style.removeSprite(S),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(S,c={}){return this._lazyInitEmptyStyle(),this.style.setSprite(S,c,f=>{f||this._update(!0)}),this}setLight(S,c={}){return this._lazyInitEmptyStyle(),this.style.setLight(S,c),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(S,c){return this.style.setFeatureState(S,c),this._update()}removeFeatureState(S,c){return this.style.removeFeatureState(S,c),this._update()}getFeatureState(S){return this.style.getFeatureState(S)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let S=0,c=0;return this._container&&(S=this._container.clientWidth||400,c=this._container.clientHeight||300),[S,c]}_setupContainer(){const S=this._container;S.classList.add("maplibregl-map");const c=this._canvasContainer=w.create("div","maplibregl-canvas-container",S);this._interactive&&c.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",c),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),y=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],y);const x=this._controlContainer=w.create("div","maplibregl-control-container",S),M=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(D=>{M[D]=w.create("div",`maplibregl-ctrl-${D} `,x)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(S,c,f){this._canvas.width=Math.floor(f*S),this._canvas.height=Math.floor(f*c),this._canvas.style.width=`${S}px`,this._canvas.style.height=`${c}px`}_setupPainter(){const S={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let c=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{c={requestedAttributes:S},y&&(c.statusMessage=y.statusMessage,c.type=y.type)},{once:!0});const f=this._canvas.getContext("webgl2",S)||this._canvas.getContext("webgl",S);if(!f){const y="Failed to initialize WebGL";throw c?(c.message=y,new Error(JSON.stringify(c))):new Error(y)}this.painter=new Ke(f,this.transform),T.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(S){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||S,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(S){return this._update(),this._renderTaskQueue.add(S)}_cancelRenderFrame(S){this._renderTaskQueue.remove(S)}_render(S){const c=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(S),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,M=_.now();this.style.zoomHistory.update(x,M);const D=new o.a8(x,{now:M,fadeDuration:c,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),F=D.crossFadingFactor();F===1&&F===this._crossFadingFactor||(f=!0,this._crossFadingFactor=F),this.style.update(D)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,c,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:c,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bd.mark(o.be.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,o.bd.mark(o.be.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var S;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),z.removeThrottleControl(this._imageQueueHandle),(S=this._resizeObserver)===null||S===void 0||S.disconnect();const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c!=null&&c.loseContext&&c.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bd.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(S=>{o.bd.frame(S),this._frameRequest=null,this._render(S)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(S){this._showTileBoundaries!==S&&(this._showTileBoundaries=S,this._update())}get showPadding(){return!!this._showPadding}set showPadding(S){this._showPadding!==S&&(this._showPadding=S,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(S){this._showCollisionBoxes!==S&&(this._showCollisionBoxes=S,S?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(S){this._showOverdrawInspector!==S&&(this._showOverdrawInspector=S,this._update())}get repaint(){return!!this._repaint}set repaint(S){this._repaint!==S&&(this._repaint=S,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(S){this._vertices=S,this._update()}get version(){return Kg}getCameraTargetElevation(){return this.transform.elevation}},a.MapMouseEvent=Tr,a.MapTouchEvent=Co,a.MapWheelEvent=Gd,a.Marker=rr,a.NavigationControl=class{constructor(S){this._updateZoomButtons=()=>{const c=this._map.getZoom(),f=c===this._map.getMaxZoom(),y=c===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=c},this._setButtonTitle=(c,f)=>{const y=this._map._getUIString(`NavigationControl.${f}`);c.title=y,c.setAttribute("aria-label",y)},this.options=o.e({},Jg,S),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",c=>this._map.zoomIn({},{originalEvent:c})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",c=>this._map.zoomOut({},{originalEvent:c})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",c=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:c}):this._map.resetNorth({},{originalEvent:c})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(S){return this._map=S,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ov(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(S,c){const f=w.create("button",S,this._container);return f.type="button",f.addEventListener("click",c),f}},a.Popup=class extends o.E{constructor(S){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=c=>{this._update(c.point)},this._onMouseMove=c=>{this._update(c.point)},this._onDrag=c=>{this._update(c.point)},this._update=c=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const F of this.options.className.split(" "))this._container.classList.add(F);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?av(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!c)return;const y=this._flatPos=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&c?c:this._map.transform.locationPoint(this._lngLat));let x=this.options.anchor;const M=Tn(this.options.offset);if(!x){const F=this._container.offsetWidth,N=this._container.offsetHeight;let G;G=y.y+M.bottom.y<N?["top"]:y.y>this._map.transform.height-N?["bottom"]:[],y.x<F/2?G.push("left"):y.x>this._map.transform.width-F/2&&G.push("right"),x=G.length===0?"bottom":G.join("-")}let D=y.add(M[x]);this.options.subpixelPositioning||(D=D.round()),w.setTransform(this._container,`${Qg[x]} translate(${D.x}px,${D.y}px)`),uc(this._container,x,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create($a),S)}addTo(S){return this._map&&this.remove(),this._map=S,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(S){return this._lngLat=o.M.convert(S),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(S){return this.setDOMContent(document.createTextNode(S))}setHTML(S){const c=document.createDocumentFragment(),f=document.createElement("body");let y;for(f.innerHTML=S;y=f.firstChild,y;)c.appendChild(y);return this.setDOMContent(c)}getMaxWidth(){var S;return(S=this._container)===null||S===void 0?void 0:S.style.maxWidth}setMaxWidth(S){return this.options.maxWidth=S,this._update(),this}setDOMContent(S){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(S),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(S){return this._container&&this._container.classList.add(S),this}removeClassName(S){return this._container&&this._container.classList.remove(S),this}setOffset(S){return this.options.offset=S,this._update(),this}toggleClassName(S){if(this._container)return this._container.classList.toggle(S)}setSubpixelPositioning(S){this.options.subpixelPositioning=S}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const S=this._container.querySelector(lp);S&&S.focus()}},a.RasterDEMTileSource=wn,a.RasterTileSource=jn,a.ScaleControl=class{constructor(S){this._onMove=()=>{e_(this._map,this._container,this.options)},this.setUnit=c=>{this.options.unit=c,e_(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},lv),S)}getDefaultPosition(){return"bottom-left"}onAdd(S){return this._map=S,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",S.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},a.ScrollZoomHandler=$g,a.Style=Hi,a.TerrainControl=class{constructor(S){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=S}onAdd(S){return this._map=S,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},a.TwoFingersTouchPitchHandler=Wg,a.TwoFingersTouchRotateHandler=oc,a.TwoFingersTouchZoomHandler=ru,a.TwoFingersTouchZoomRotateHandler=Zg,a.VectorTileSource=Te,a.VideoSource=tt,a.addSourceType=(S,c)=>o._(void 0,void 0,void 0,function*(){if(yt(S))throw new Error(`A source type called "${S}" already exists.`);((f,y)=>{St[f]=y})(S,c)}),a.clearPrewarmedResources=function(){const S=mt;S&&(S.isPreloaded()&&S.numActive()===1?(S.release(Ct),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},a.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},a.getRTLTextPluginStatus=function(){return cn().getRTLTextPluginStatus()},a.getVersion=function(){return On},a.getWorkerCount=function(){return Vt.workerCount},a.getWorkerUrl=function(){return o.a.WORKER_URL},a.importScriptInWorkers=function(S){return xn().broadcast("IS",S)},a.prewarm=function(){It().acquire(Ct)},a.setMaxParallelImageRequests=function(S){o.a.MAX_PARALLEL_IMAGE_REQUESTS=S},a.setRTLTextPlugin=function(S,c){return cn().setRTLTextPlugin(S,c)},a.setWorkerCount=function(S){Vt.workerCount=S},a.setWorkerUrl=function(S){o.a.WORKER_URL=S}});var s=t;return s})})(fU);var mK=fU.exports;const wu=Hw(mK);/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const XA="166",gK=0,o3=1,_K=2,mU=1,yK=2,bu=3,Xu=0,oa=1,Ec=2,_d=0,Bm=1,a3=2,l3=3,c3=4,vK=5,gf=100,xK=101,wK=102,bK=103,SK=104,MK=200,EK=201,TK=202,CK=203,QT=204,e2=205,AK=206,IK=207,PK=208,RK=209,LK=210,DK=211,kK=212,FK=213,OK=214,NK=0,zK=1,BK=2,xw=3,UK=4,VK=5,GK=6,HK=7,gU=0,WK=1,jK=2,yd=0,$K=1,qK=2,XK=3,ZK=4,YK=5,KK=6,JK=7,u3="attached",QK="detached",_U=300,ag=301,lg=302,t2=303,n2=304,Ib=306,cg=1e3,td=1001,ww=1002,Bo=1003,yU=1004,ay=1005,Ca=1006,c1=1007,Lu=1008,Zu=1009,vU=1010,xU=1011,v0=1012,ZA=1013,Bf=1014,Dl=1015,j0=1016,YA=1017,KA=1018,ug=1020,wU=35902,bU=1021,SU=1022,ol=1023,MU=1024,EU=1025,Um=1026,hg=1027,JA=1028,QA=1029,TU=1030,eI=1031,tI=1033,u1=33776,h1=33777,d1=33778,f1=33779,i2=35840,r2=35841,s2=35842,o2=35843,a2=36196,l2=37492,c2=37496,u2=37808,h2=37809,d2=37810,f2=37811,p2=37812,m2=37813,g2=37814,_2=37815,y2=37816,v2=37817,x2=37818,w2=37819,b2=37820,S2=37821,p1=36492,M2=36494,E2=36495,CU=36283,T2=36284,C2=36285,A2=36286,x0=2300,w0=2301,FM=2302,h3=2400,d3=2401,f3=2402,eJ=2500,tJ=0,AU=1,I2=2,nJ=3200,iJ=3201,IU=0,rJ=1,qh="",Oo="srgb",Ys="srgb-linear",nI="display-p3",Pb="display-p3-linear",bw="linear",Ir="srgb",Sw="rec709",Mw="p3",Lp=7680,p3=519,sJ=512,oJ=513,aJ=514,PU=515,lJ=516,cJ=517,uJ=518,hJ=519,P2=35044,m3="300 es",Du=2e3,Ew=2001;class Lg{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,a=r.length;s<a;s++)r[s].call(this,e);e.target=null}}}const co=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let g3=1234567;const Iy=Math.PI/180,dg=180/Math.PI;function zl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(co[n&255]+co[n>>8&255]+co[n>>16&255]+co[n>>24&255]+"-"+co[e&255]+co[e>>8&255]+"-"+co[e>>16&15|64]+co[e>>24&255]+"-"+co[t&63|128]+co[t>>8&255]+"-"+co[t>>16&255]+co[t>>24&255]+co[i&255]+co[i>>8&255]+co[i>>16&255]+co[i>>24&255]).toLowerCase()}function yo(n,e,t){return Math.max(e,Math.min(t,n))}function iI(n,e){return(n%e+e)%e}function dJ(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function fJ(n,e,t){return n!==e?(t-n)/(e-n):0}function Py(n,e,t){return(1-t)*n+t*e}function pJ(n,e,t,i){return Py(n,e,1-Math.exp(-t*i))}function mJ(n,e=1){return e-Math.abs(iI(n,e*2)-e)}function gJ(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function _J(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function yJ(n,e){return n+Math.floor(Math.random()*(e-n+1))}function vJ(n,e){return n+Math.random()*(e-n)}function xJ(n){return n*(.5-Math.random())}function wJ(n){n!==void 0&&(g3=n);let e=g3+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function bJ(n){return n*Iy}function SJ(n){return n*dg}function MJ(n){return(n&n-1)===0&&n!==0}function EJ(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function TJ(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function CJ(n,e,t,i,r){const s=Math.cos,a=Math.sin,o=s(t/2),d=a(t/2),p=s((e+i)/2),g=a((e+i)/2),_=s((e-i)/2),w=a((e-i)/2),T=s((i-e)/2),I=a((i-e)/2);switch(r){case"XYX":n.set(o*g,d*_,d*w,o*p);break;case"YZY":n.set(d*w,o*g,d*_,o*p);break;case"ZXZ":n.set(d*_,d*w,o*g,o*p);break;case"XZX":n.set(o*g,d*I,d*T,o*p);break;case"YXY":n.set(d*T,o*g,d*I,o*p);break;case"ZYZ":n.set(d*I,d*T,o*g,o*p);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function Rl(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ar(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const AJ={DEG2RAD:Iy,RAD2DEG:dg,generateUUID:zl,clamp:yo,euclideanModulo:iI,mapLinear:dJ,inverseLerp:fJ,lerp:Py,damp:pJ,pingpong:mJ,smoothstep:gJ,smootherstep:_J,randInt:yJ,randFloat:vJ,randFloatSpread:xJ,seededRandom:wJ,degToRad:bJ,radToDeg:SJ,isPowerOfTwo:MJ,ceilPowerOfTwo:EJ,floorPowerOfTwo:TJ,setQuaternionFromProperEuler:CJ,normalize:ar,denormalize:Rl};class Mi{constructor(e=0,t=0){Mi.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*i-a*r+e.x,this.y=s*r+a*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class yi{constructor(e,t,i,r,s,a,o,d,p){yi.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,d,p)}set(e,t,i,r,s,a,o,d,p){const g=this.elements;return g[0]=e,g[1]=r,g[2]=o,g[3]=t,g[4]=s,g[5]=d,g[6]=i,g[7]=a,g[8]=p,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[3],d=i[6],p=i[1],g=i[4],_=i[7],w=i[2],T=i[5],I=i[8],L=r[0],P=r[3],C=r[6],O=r[1],z=r[4],H=r[7],Y=r[2],ee=r[5],te=r[8];return s[0]=a*L+o*O+d*Y,s[3]=a*P+o*z+d*ee,s[6]=a*C+o*H+d*te,s[1]=p*L+g*O+_*Y,s[4]=p*P+g*z+_*ee,s[7]=p*C+g*H+_*te,s[2]=w*L+T*O+I*Y,s[5]=w*P+T*z+I*ee,s[8]=w*C+T*H+I*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],d=e[6],p=e[7],g=e[8];return t*a*g-t*o*p-i*s*g+i*o*d+r*s*p-r*a*d}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],d=e[6],p=e[7],g=e[8],_=g*a-o*p,w=o*d-g*s,T=p*s-a*d,I=t*_+i*w+r*T;if(I===0)return this.set(0,0,0,0,0,0,0,0,0);const L=1/I;return e[0]=_*L,e[1]=(r*p-g*i)*L,e[2]=(o*i-r*a)*L,e[3]=w*L,e[4]=(g*t-r*d)*L,e[5]=(r*s-o*t)*L,e[6]=T*L,e[7]=(i*d-p*t)*L,e[8]=(a*t-i*s)*L,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,a,o){const d=Math.cos(s),p=Math.sin(s);return this.set(i*d,i*p,-i*(d*a+p*o)+a+e,-r*p,r*d,-r*(-p*a+d*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(OM.makeScale(e,t)),this}rotate(e){return this.premultiply(OM.makeRotation(-e)),this}translate(e,t){return this.premultiply(OM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const OM=new yi;function RU(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function b0(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function IJ(){const n=b0("canvas");return n.style.display="block",n}const _3={};function rI(n){n in _3||(_3[n]=!0,console.warn(n))}function PJ(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}const y3=new yi().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),v3=new yi().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),gx={[Ys]:{transfer:bw,primaries:Sw,toReference:n=>n,fromReference:n=>n},[Oo]:{transfer:Ir,primaries:Sw,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Pb]:{transfer:bw,primaries:Mw,toReference:n=>n.applyMatrix3(v3),fromReference:n=>n.applyMatrix3(y3)},[nI]:{transfer:Ir,primaries:Mw,toReference:n=>n.convertSRGBToLinear().applyMatrix3(v3),fromReference:n=>n.applyMatrix3(y3).convertLinearToSRGB()}},RJ=new Set([Ys,Pb]),$i={enabled:!0,_workingColorSpace:Ys,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!RJ.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=gx[e].toReference,r=gx[t].fromReference;return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return gx[n].primaries},getTransfer:function(n){return n===qh?bw:gx[n].transfer}};function Vm(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function NM(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Dp;class LJ{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Dp===void 0&&(Dp=b0("canvas")),Dp.width=e.width,Dp.height=e.height;const i=Dp.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Dp}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=b0("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let a=0;a<s.length;a++)s[a]=Vm(s[a]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Vm(t[i]/255)*255):t[i]=Vm(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let DJ=0;class LU{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:DJ++}),this.uuid=zl(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let a=0,o=r.length;a<o;a++)r[a].isDataTexture?s.push(zM(r[a].image)):s.push(zM(r[a]))}else s=zM(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function zM(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?LJ.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let kJ=0;class Fs extends Lg{constructor(e=Fs.DEFAULT_IMAGE,t=Fs.DEFAULT_MAPPING,i=td,r=td,s=Ca,a=Lu,o=ol,d=Zu,p=Fs.DEFAULT_ANISOTROPY,g=qh){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kJ++}),this.uuid=zl(),this.name="",this.source=new LU(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=a,this.anisotropy=p,this.format=o,this.internalFormat=null,this.type=d,this.offset=new Mi(0,0),this.repeat=new Mi(1,1),this.center=new Mi(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yi,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=g,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==_U)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case cg:e.x=e.x-Math.floor(e.x);break;case td:e.x=e.x<0?0:1;break;case ww:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case cg:e.y=e.y-Math.floor(e.y);break;case td:e.y=e.y<0?0:1;break;case ww:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Fs.DEFAULT_IMAGE=null;Fs.DEFAULT_MAPPING=_U;Fs.DEFAULT_ANISOTROPY=1;class _r{constructor(e=0,t=0,i=0,r=1){_r.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*i+a[8]*r+a[12]*s,this.y=a[1]*t+a[5]*i+a[9]*r+a[13]*s,this.z=a[2]*t+a[6]*i+a[10]*r+a[14]*s,this.w=a[3]*t+a[7]*i+a[11]*r+a[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const d=e.elements,p=d[0],g=d[4],_=d[8],w=d[1],T=d[5],I=d[9],L=d[2],P=d[6],C=d[10];if(Math.abs(g-w)<.01&&Math.abs(_-L)<.01&&Math.abs(I-P)<.01){if(Math.abs(g+w)<.1&&Math.abs(_+L)<.1&&Math.abs(I+P)<.1&&Math.abs(p+T+C-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const z=(p+1)/2,H=(T+1)/2,Y=(C+1)/2,ee=(g+w)/4,te=(_+L)/4,ce=(I+P)/4;return z>H&&z>Y?z<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(z),r=ee/i,s=te/i):H>Y?H<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(H),i=ee/r,s=ce/r):Y<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(Y),i=te/s,r=ce/s),this.set(i,r,s,t),this}let O=Math.sqrt((P-I)*(P-I)+(_-L)*(_-L)+(w-g)*(w-g));return Math.abs(O)<.001&&(O=1),this.x=(P-I)/O,this.y=(_-L)/O,this.z=(w-g)/O,this.w=Math.acos((p+T+C-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class FJ extends Lg{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new _r(0,0,e,t),this.scissorTest=!1,this.viewport=new _r(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Ca,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Fs(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=s.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new LU(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Uf extends FJ{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class DU extends Fs{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=td,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class OJ extends Fs{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=Bo,this.minFilter=Bo,this.wrapR=td,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pd{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,a,o){let d=i[r+0],p=i[r+1],g=i[r+2],_=i[r+3];const w=s[a+0],T=s[a+1],I=s[a+2],L=s[a+3];if(o===0){e[t+0]=d,e[t+1]=p,e[t+2]=g,e[t+3]=_;return}if(o===1){e[t+0]=w,e[t+1]=T,e[t+2]=I,e[t+3]=L;return}if(_!==L||d!==w||p!==T||g!==I){let P=1-o;const C=d*w+p*T+g*I+_*L,O=C>=0?1:-1,z=1-C*C;if(z>Number.EPSILON){const Y=Math.sqrt(z),ee=Math.atan2(Y,C*O);P=Math.sin(P*ee)/Y,o=Math.sin(o*ee)/Y}const H=o*O;if(d=d*P+w*H,p=p*P+T*H,g=g*P+I*H,_=_*P+L*H,P===1-o){const Y=1/Math.sqrt(d*d+p*p+g*g+_*_);d*=Y,p*=Y,g*=Y,_*=Y}}e[t]=d,e[t+1]=p,e[t+2]=g,e[t+3]=_}static multiplyQuaternionsFlat(e,t,i,r,s,a){const o=i[r],d=i[r+1],p=i[r+2],g=i[r+3],_=s[a],w=s[a+1],T=s[a+2],I=s[a+3];return e[t]=o*I+g*_+d*T-p*w,e[t+1]=d*I+g*w+p*_-o*T,e[t+2]=p*I+g*T+o*w-d*_,e[t+3]=g*I-o*_-d*w-p*T,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,a=e._order,o=Math.cos,d=Math.sin,p=o(i/2),g=o(r/2),_=o(s/2),w=d(i/2),T=d(r/2),I=d(s/2);switch(a){case"XYZ":this._x=w*g*_+p*T*I,this._y=p*T*_-w*g*I,this._z=p*g*I+w*T*_,this._w=p*g*_-w*T*I;break;case"YXZ":this._x=w*g*_+p*T*I,this._y=p*T*_-w*g*I,this._z=p*g*I-w*T*_,this._w=p*g*_+w*T*I;break;case"ZXY":this._x=w*g*_-p*T*I,this._y=p*T*_+w*g*I,this._z=p*g*I+w*T*_,this._w=p*g*_-w*T*I;break;case"ZYX":this._x=w*g*_-p*T*I,this._y=p*T*_+w*g*I,this._z=p*g*I-w*T*_,this._w=p*g*_+w*T*I;break;case"YZX":this._x=w*g*_+p*T*I,this._y=p*T*_+w*g*I,this._z=p*g*I-w*T*_,this._w=p*g*_-w*T*I;break;case"XZY":this._x=w*g*_-p*T*I,this._y=p*T*_-w*g*I,this._z=p*g*I+w*T*_,this._w=p*g*_+w*T*I;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],a=t[1],o=t[5],d=t[9],p=t[2],g=t[6],_=t[10],w=i+o+_;if(w>0){const T=.5/Math.sqrt(w+1);this._w=.25/T,this._x=(g-d)*T,this._y=(s-p)*T,this._z=(a-r)*T}else if(i>o&&i>_){const T=2*Math.sqrt(1+i-o-_);this._w=(g-d)/T,this._x=.25*T,this._y=(r+a)/T,this._z=(s+p)/T}else if(o>_){const T=2*Math.sqrt(1+o-i-_);this._w=(s-p)/T,this._x=(r+a)/T,this._y=.25*T,this._z=(d+g)/T}else{const T=2*Math.sqrt(1+_-i-o);this._w=(a-r)/T,this._x=(s+p)/T,this._y=(d+g)/T,this._z=.25*T}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yo(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,a=e._w,o=t._x,d=t._y,p=t._z,g=t._w;return this._x=i*g+a*o+r*p-s*d,this._y=r*g+a*d+s*o-i*p,this._z=s*g+a*p+i*d-r*o,this._w=a*g-i*o-r*d-s*p,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,a=this._w;let o=a*e._w+i*e._x+r*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=i,this._y=r,this._z=s,this;const d=1-o*o;if(d<=Number.EPSILON){const T=1-t;return this._w=T*a+t*this._w,this._x=T*i+t*this._x,this._y=T*r+t*this._y,this._z=T*s+t*this._z,this.normalize(),this}const p=Math.sqrt(d),g=Math.atan2(p,o),_=Math.sin((1-t)*g)/p,w=Math.sin(t*g)/p;return this._w=a*_+this._w*w,this._x=i*_+this._x*w,this._y=r*_+this._y*w,this._z=s*_+this._z*w,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ye{constructor(e=0,t=0,i=0){Ye.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(x3.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(x3.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,a=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*a,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*a,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*a,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,a=e.y,o=e.z,d=e.w,p=2*(a*r-o*i),g=2*(o*t-s*r),_=2*(s*i-a*t);return this.x=t+d*p+a*_-o*g,this.y=i+d*g+o*p-s*_,this.z=r+d*_+s*g-a*p,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,a=t.x,o=t.y,d=t.z;return this.x=r*d-s*o,this.y=s*a-i*d,this.z=i*o-r*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return BM.copy(this).projectOnVector(e),this.sub(BM)}reflect(e){return this.sub(BM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(yo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const BM=new Ye,x3=new Pd;class th{constructor(e=new Ye(1/0,1/0,1/0),t=new Ye(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Sl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Sl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Sl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,o=s.count;a<o;a++)e.isMesh===!0?e.getVertexPosition(a,Sl):Sl.fromBufferAttribute(s,a),Sl.applyMatrix4(e.matrixWorld),this.expandByPoint(Sl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),_x.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),_x.copy(i.boundingBox)),_x.applyMatrix4(e.matrixWorld),this.union(_x)}const r=e.children;for(let s=0,a=r.length;s<a;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Sl),Sl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(z_),yx.subVectors(this.max,z_),kp.subVectors(e.a,z_),Fp.subVectors(e.b,z_),Op.subVectors(e.c,z_),Dh.subVectors(Fp,kp),kh.subVectors(Op,Fp),rf.subVectors(kp,Op);let t=[0,-Dh.z,Dh.y,0,-kh.z,kh.y,0,-rf.z,rf.y,Dh.z,0,-Dh.x,kh.z,0,-kh.x,rf.z,0,-rf.x,-Dh.y,Dh.x,0,-kh.y,kh.x,0,-rf.y,rf.x,0];return!UM(t,kp,Fp,Op,yx)||(t=[1,0,0,0,1,0,0,0,1],!UM(t,kp,Fp,Op,yx))?!1:(vx.crossVectors(Dh,kh),t=[vx.x,vx.y,vx.z],UM(t,kp,Fp,Op,yx))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Sl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Sl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(fu[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),fu[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),fu[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),fu[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),fu[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),fu[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),fu[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),fu[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(fu),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const fu=[new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye,new Ye],Sl=new Ye,_x=new th,kp=new Ye,Fp=new Ye,Op=new Ye,Dh=new Ye,kh=new Ye,rf=new Ye,z_=new Ye,yx=new Ye,vx=new Ye,sf=new Ye;function UM(n,e,t,i,r){for(let s=0,a=n.length-3;s<=a;s+=3){sf.fromArray(n,s);const o=r.x*Math.abs(sf.x)+r.y*Math.abs(sf.y)+r.z*Math.abs(sf.z),d=e.dot(sf),p=t.dot(sf),g=i.dot(sf);if(Math.max(-Math.max(d,p,g),Math.min(d,p,g))>o)return!1}return!0}const NJ=new th,B_=new Ye,VM=new Ye;class Vc{constructor(e=new Ye,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):NJ.setFromPoints(e).getCenter(i);let r=0;for(let s=0,a=e.length;s<a;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;B_.subVectors(e,this.center);const t=B_.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(B_,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(VM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(B_.copy(e.center).add(VM)),this.expandByPoint(B_.copy(e.center).sub(VM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const pu=new Ye,GM=new Ye,xx=new Ye,Fh=new Ye,HM=new Ye,wx=new Ye,WM=new Ye;class Rb{constructor(e=new Ye,t=new Ye(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,pu)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=pu.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(pu.copy(this.origin).addScaledVector(this.direction,t),pu.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){GM.copy(e).add(t).multiplyScalar(.5),xx.copy(t).sub(e).normalize(),Fh.copy(this.origin).sub(GM);const s=e.distanceTo(t)*.5,a=-this.direction.dot(xx),o=Fh.dot(this.direction),d=-Fh.dot(xx),p=Fh.lengthSq(),g=Math.abs(1-a*a);let _,w,T,I;if(g>0)if(_=a*d-o,w=a*o-d,I=s*g,_>=0)if(w>=-I)if(w<=I){const L=1/g;_*=L,w*=L,T=_*(_+a*w+2*o)+w*(a*_+w+2*d)+p}else w=s,_=Math.max(0,-(a*w+o)),T=-_*_+w*(w+2*d)+p;else w=-s,_=Math.max(0,-(a*w+o)),T=-_*_+w*(w+2*d)+p;else w<=-I?(_=Math.max(0,-(-a*s+o)),w=_>0?-s:Math.min(Math.max(-s,-d),s),T=-_*_+w*(w+2*d)+p):w<=I?(_=0,w=Math.min(Math.max(-s,-d),s),T=w*(w+2*d)+p):(_=Math.max(0,-(a*s+o)),w=_>0?s:Math.min(Math.max(-s,-d),s),T=-_*_+w*(w+2*d)+p);else w=a>0?-s:s,_=Math.max(0,-(a*w+o)),T=-_*_+w*(w+2*d)+p;return i&&i.copy(this.origin).addScaledVector(this.direction,_),r&&r.copy(GM).addScaledVector(xx,w),T}intersectSphere(e,t){pu.subVectors(e.center,this.origin);const i=pu.dot(this.direction),r=pu.dot(pu)-i*i,s=e.radius*e.radius;if(r>s)return null;const a=Math.sqrt(s-r),o=i-a,d=i+a;return d<0?null:o<0?this.at(d,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,a,o,d;const p=1/this.direction.x,g=1/this.direction.y,_=1/this.direction.z,w=this.origin;return p>=0?(i=(e.min.x-w.x)*p,r=(e.max.x-w.x)*p):(i=(e.max.x-w.x)*p,r=(e.min.x-w.x)*p),g>=0?(s=(e.min.y-w.y)*g,a=(e.max.y-w.y)*g):(s=(e.max.y-w.y)*g,a=(e.min.y-w.y)*g),i>a||s>r||((s>i||isNaN(i))&&(i=s),(a<r||isNaN(r))&&(r=a),_>=0?(o=(e.min.z-w.z)*_,d=(e.max.z-w.z)*_):(o=(e.max.z-w.z)*_,d=(e.min.z-w.z)*_),i>d||o>r)||((o>i||i!==i)&&(i=o),(d<r||r!==r)&&(r=d),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,pu)!==null}intersectTriangle(e,t,i,r,s){HM.subVectors(t,e),wx.subVectors(i,e),WM.crossVectors(HM,wx);let a=this.direction.dot(WM),o;if(a>0){if(r)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Fh.subVectors(this.origin,e);const d=o*this.direction.dot(wx.crossVectors(Fh,wx));if(d<0)return null;const p=o*this.direction.dot(HM.cross(Fh));if(p<0||d+p>a)return null;const g=-o*Fh.dot(WM);return g<0?null:this.at(g/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ui{constructor(e,t,i,r,s,a,o,d,p,g,_,w,T,I,L,P){ui.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,a,o,d,p,g,_,w,T,I,L,P)}set(e,t,i,r,s,a,o,d,p,g,_,w,T,I,L,P){const C=this.elements;return C[0]=e,C[4]=t,C[8]=i,C[12]=r,C[1]=s,C[5]=a,C[9]=o,C[13]=d,C[2]=p,C[6]=g,C[10]=_,C[14]=w,C[3]=T,C[7]=I,C[11]=L,C[15]=P,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ui().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Np.setFromMatrixColumn(e,0).length(),s=1/Np.setFromMatrixColumn(e,1).length(),a=1/Np.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*a,t[9]=i[9]*a,t[10]=i[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,a=Math.cos(i),o=Math.sin(i),d=Math.cos(r),p=Math.sin(r),g=Math.cos(s),_=Math.sin(s);if(e.order==="XYZ"){const w=a*g,T=a*_,I=o*g,L=o*_;t[0]=d*g,t[4]=-d*_,t[8]=p,t[1]=T+I*p,t[5]=w-L*p,t[9]=-o*d,t[2]=L-w*p,t[6]=I+T*p,t[10]=a*d}else if(e.order==="YXZ"){const w=d*g,T=d*_,I=p*g,L=p*_;t[0]=w+L*o,t[4]=I*o-T,t[8]=a*p,t[1]=a*_,t[5]=a*g,t[9]=-o,t[2]=T*o-I,t[6]=L+w*o,t[10]=a*d}else if(e.order==="ZXY"){const w=d*g,T=d*_,I=p*g,L=p*_;t[0]=w-L*o,t[4]=-a*_,t[8]=I+T*o,t[1]=T+I*o,t[5]=a*g,t[9]=L-w*o,t[2]=-a*p,t[6]=o,t[10]=a*d}else if(e.order==="ZYX"){const w=a*g,T=a*_,I=o*g,L=o*_;t[0]=d*g,t[4]=I*p-T,t[8]=w*p+L,t[1]=d*_,t[5]=L*p+w,t[9]=T*p-I,t[2]=-p,t[6]=o*d,t[10]=a*d}else if(e.order==="YZX"){const w=a*d,T=a*p,I=o*d,L=o*p;t[0]=d*g,t[4]=L-w*_,t[8]=I*_+T,t[1]=_,t[5]=a*g,t[9]=-o*g,t[2]=-p*g,t[6]=T*_+I,t[10]=w-L*_}else if(e.order==="XZY"){const w=a*d,T=a*p,I=o*d,L=o*p;t[0]=d*g,t[4]=-_,t[8]=p*g,t[1]=w*_+L,t[5]=a*g,t[9]=T*_-I,t[2]=I*_-T,t[6]=o*g,t[10]=L*_+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(zJ,e,BJ)}lookAt(e,t,i){const r=this.elements;return ba.subVectors(e,t),ba.lengthSq()===0&&(ba.z=1),ba.normalize(),Oh.crossVectors(i,ba),Oh.lengthSq()===0&&(Math.abs(i.z)===1?ba.x+=1e-4:ba.z+=1e-4,ba.normalize(),Oh.crossVectors(i,ba)),Oh.normalize(),bx.crossVectors(ba,Oh),r[0]=Oh.x,r[4]=bx.x,r[8]=ba.x,r[1]=Oh.y,r[5]=bx.y,r[9]=ba.y,r[2]=Oh.z,r[6]=bx.z,r[10]=ba.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,a=i[0],o=i[4],d=i[8],p=i[12],g=i[1],_=i[5],w=i[9],T=i[13],I=i[2],L=i[6],P=i[10],C=i[14],O=i[3],z=i[7],H=i[11],Y=i[15],ee=r[0],te=r[4],ce=r[8],K=r[12],Q=r[1],pe=r[5],ze=r[9],Fe=r[13],qe=r[2],et=r[6],Ne=r[10],st=r[14],Ee=r[3],ut=r[7],ot=r[11],dt=r[15];return s[0]=a*ee+o*Q+d*qe+p*Ee,s[4]=a*te+o*pe+d*et+p*ut,s[8]=a*ce+o*ze+d*Ne+p*ot,s[12]=a*K+o*Fe+d*st+p*dt,s[1]=g*ee+_*Q+w*qe+T*Ee,s[5]=g*te+_*pe+w*et+T*ut,s[9]=g*ce+_*ze+w*Ne+T*ot,s[13]=g*K+_*Fe+w*st+T*dt,s[2]=I*ee+L*Q+P*qe+C*Ee,s[6]=I*te+L*pe+P*et+C*ut,s[10]=I*ce+L*ze+P*Ne+C*ot,s[14]=I*K+L*Fe+P*st+C*dt,s[3]=O*ee+z*Q+H*qe+Y*Ee,s[7]=O*te+z*pe+H*et+Y*ut,s[11]=O*ce+z*ze+H*Ne+Y*ot,s[15]=O*K+z*Fe+H*st+Y*dt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],a=e[1],o=e[5],d=e[9],p=e[13],g=e[2],_=e[6],w=e[10],T=e[14],I=e[3],L=e[7],P=e[11],C=e[15];return I*(+s*d*_-r*p*_-s*o*w+i*p*w+r*o*T-i*d*T)+L*(+t*d*T-t*p*w+s*a*w-r*a*T+r*p*g-s*d*g)+P*(+t*p*_-t*o*T-s*a*_+i*a*T+s*o*g-i*p*g)+C*(-r*o*g-t*d*_+t*o*w+r*a*_-i*a*w+i*d*g)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],a=e[4],o=e[5],d=e[6],p=e[7],g=e[8],_=e[9],w=e[10],T=e[11],I=e[12],L=e[13],P=e[14],C=e[15],O=_*P*p-L*w*p+L*d*T-o*P*T-_*d*C+o*w*C,z=I*w*p-g*P*p-I*d*T+a*P*T+g*d*C-a*w*C,H=g*L*p-I*_*p+I*o*T-a*L*T-g*o*C+a*_*C,Y=I*_*d-g*L*d-I*o*w+a*L*w+g*o*P-a*_*P,ee=t*O+i*z+r*H+s*Y;if(ee===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const te=1/ee;return e[0]=O*te,e[1]=(L*w*s-_*P*s-L*r*T+i*P*T+_*r*C-i*w*C)*te,e[2]=(o*P*s-L*d*s+L*r*p-i*P*p-o*r*C+i*d*C)*te,e[3]=(_*d*s-o*w*s-_*r*p+i*w*p+o*r*T-i*d*T)*te,e[4]=z*te,e[5]=(g*P*s-I*w*s+I*r*T-t*P*T-g*r*C+t*w*C)*te,e[6]=(I*d*s-a*P*s-I*r*p+t*P*p+a*r*C-t*d*C)*te,e[7]=(a*w*s-g*d*s+g*r*p-t*w*p-a*r*T+t*d*T)*te,e[8]=H*te,e[9]=(I*_*s-g*L*s-I*i*T+t*L*T+g*i*C-t*_*C)*te,e[10]=(a*L*s-I*o*s+I*i*p-t*L*p-a*i*C+t*o*C)*te,e[11]=(g*o*s-a*_*s-g*i*p+t*_*p+a*i*T-t*o*T)*te,e[12]=Y*te,e[13]=(g*L*r-I*_*r+I*i*w-t*L*w-g*i*P+t*_*P)*te,e[14]=(I*o*r-a*L*r-I*i*d+t*L*d+a*i*P-t*o*P)*te,e[15]=(a*_*r-g*o*r+g*i*d-t*_*d-a*i*w+t*o*w)*te,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,a=e.x,o=e.y,d=e.z,p=s*a,g=s*o;return this.set(p*a+i,p*o-r*d,p*d+r*o,0,p*o+r*d,g*o+i,g*d-r*a,0,p*d-r*o,g*d+r*a,s*d*d+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,a){return this.set(1,i,s,0,e,1,a,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,a=t._y,o=t._z,d=t._w,p=s+s,g=a+a,_=o+o,w=s*p,T=s*g,I=s*_,L=a*g,P=a*_,C=o*_,O=d*p,z=d*g,H=d*_,Y=i.x,ee=i.y,te=i.z;return r[0]=(1-(L+C))*Y,r[1]=(T+H)*Y,r[2]=(I-z)*Y,r[3]=0,r[4]=(T-H)*ee,r[5]=(1-(w+C))*ee,r[6]=(P+O)*ee,r[7]=0,r[8]=(I+z)*te,r[9]=(P-O)*te,r[10]=(1-(w+L))*te,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Np.set(r[0],r[1],r[2]).length();const a=Np.set(r[4],r[5],r[6]).length(),o=Np.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Ml.copy(this);const p=1/s,g=1/a,_=1/o;return Ml.elements[0]*=p,Ml.elements[1]*=p,Ml.elements[2]*=p,Ml.elements[4]*=g,Ml.elements[5]*=g,Ml.elements[6]*=g,Ml.elements[8]*=_,Ml.elements[9]*=_,Ml.elements[10]*=_,t.setFromRotationMatrix(Ml),i.x=s,i.y=a,i.z=o,this}makePerspective(e,t,i,r,s,a,o=Du){const d=this.elements,p=2*s/(t-e),g=2*s/(i-r),_=(t+e)/(t-e),w=(i+r)/(i-r);let T,I;if(o===Du)T=-(a+s)/(a-s),I=-2*a*s/(a-s);else if(o===Ew)T=-a/(a-s),I=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return d[0]=p,d[4]=0,d[8]=_,d[12]=0,d[1]=0,d[5]=g,d[9]=w,d[13]=0,d[2]=0,d[6]=0,d[10]=T,d[14]=I,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(e,t,i,r,s,a,o=Du){const d=this.elements,p=1/(t-e),g=1/(i-r),_=1/(a-s),w=(t+e)*p,T=(i+r)*g;let I,L;if(o===Du)I=(a+s)*_,L=-2*_;else if(o===Ew)I=s*_,L=-1*_;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return d[0]=2*p,d[4]=0,d[8]=0,d[12]=-w,d[1]=0,d[5]=2*g,d[9]=0,d[13]=-T,d[2]=0,d[6]=0,d[10]=L,d[14]=-I,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Np=new Ye,Ml=new ui,zJ=new Ye(0,0,0),BJ=new Ye(1,1,1),Oh=new Ye,bx=new Ye,ba=new Ye,w3=new ui,b3=new Pd;class zc{constructor(e=0,t=0,i=0,r=zc.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],a=r[4],o=r[8],d=r[1],p=r[5],g=r[9],_=r[2],w=r[6],T=r[10];switch(t){case"XYZ":this._y=Math.asin(yo(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-g,T),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(w,p),this._z=0);break;case"YXZ":this._x=Math.asin(-yo(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(o,T),this._z=Math.atan2(d,p)):(this._y=Math.atan2(-_,s),this._z=0);break;case"ZXY":this._x=Math.asin(yo(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(-_,T),this._z=Math.atan2(-a,p)):(this._y=0,this._z=Math.atan2(d,s));break;case"ZYX":this._y=Math.asin(-yo(_,-1,1)),Math.abs(_)<.9999999?(this._x=Math.atan2(w,T),this._z=Math.atan2(d,s)):(this._x=0,this._z=Math.atan2(-a,p));break;case"YZX":this._z=Math.asin(yo(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-g,p),this._y=Math.atan2(-_,s)):(this._x=0,this._y=Math.atan2(o,T));break;case"XZY":this._z=Math.asin(-yo(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(w,p),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-g,T),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return w3.makeRotationFromQuaternion(e),this.setFromRotationMatrix(w3,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return b3.setFromEuler(this),this.setFromQuaternion(b3,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}zc.DEFAULT_ORDER="XYZ";class kU{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let UJ=0;const S3=new Ye,zp=new Pd,mu=new ui,Sx=new Ye,U_=new Ye,VJ=new Ye,GJ=new Pd,M3=new Ye(1,0,0),E3=new Ye(0,1,0),T3=new Ye(0,0,1),C3={type:"added"},HJ={type:"removed"},Bp={type:"childadded",child:null},jM={type:"childremoved",child:null};class Hr extends Lg{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:UJ++}),this.uuid=zl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hr.DEFAULT_UP.clone();const e=new Ye,t=new zc,i=new Pd,r=new Ye(1,1,1);function s(){i.setFromEuler(t,!1)}function a(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ui},normalMatrix:{value:new yi}}),this.matrix=new ui,this.matrixWorld=new ui,this.matrixAutoUpdate=Hr.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new kU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return zp.setFromAxisAngle(e,t),this.quaternion.multiply(zp),this}rotateOnWorldAxis(e,t){return zp.setFromAxisAngle(e,t),this.quaternion.premultiply(zp),this}rotateX(e){return this.rotateOnAxis(M3,e)}rotateY(e){return this.rotateOnAxis(E3,e)}rotateZ(e){return this.rotateOnAxis(T3,e)}translateOnAxis(e,t){return S3.copy(e).applyQuaternion(this.quaternion),this.position.add(S3.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(M3,e)}translateY(e){return this.translateOnAxis(E3,e)}translateZ(e){return this.translateOnAxis(T3,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(mu.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Sx.copy(e):Sx.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),U_.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?mu.lookAt(U_,Sx,this.up):mu.lookAt(Sx,U_,this.up),this.quaternion.setFromRotationMatrix(mu),r&&(mu.extractRotation(r.matrixWorld),zp.setFromRotationMatrix(mu),this.quaternion.premultiply(zp.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(C3),Bp.child=e,this.dispatchEvent(Bp),Bp.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(HJ),jM.child=e,this.dispatchEvent(jM),jM.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),mu.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),mu.multiply(e.parent.matrixWorld)),e.applyMatrix4(mu),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(C3),Bp.child=e,this.dispatchEvent(Bp),Bp.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const a=this.children[i].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(U_,e,VJ),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(U_,GJ,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,a=r.length;s<a;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(o,d){return o[d.uuid]===void 0&&(o[d.uuid]=d.toJSON(e)),d.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const d=o.shapes;if(Array.isArray(d))for(let p=0,g=d.length;p<g;p++){const _=d[p];s(e.shapes,_)}else s(e.shapes,d)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let d=0,p=this.material.length;d<p;d++)o.push(s(e.materials,this.material[d]));r.material=o}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const d=this.animations[o];r.animations.push(s(e.animations,d))}}if(t){const o=a(e.geometries),d=a(e.materials),p=a(e.textures),g=a(e.images),_=a(e.shapes),w=a(e.skeletons),T=a(e.animations),I=a(e.nodes);o.length>0&&(i.geometries=o),d.length>0&&(i.materials=d),p.length>0&&(i.textures=p),g.length>0&&(i.images=g),_.length>0&&(i.shapes=_),w.length>0&&(i.skeletons=w),T.length>0&&(i.animations=T),I.length>0&&(i.nodes=I)}return i.object=r,i;function a(o){const d=[];for(const p in o){const g=o[p];delete g.metadata,d.push(g)}return d}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}Hr.DEFAULT_UP=new Ye(0,1,0);Hr.DEFAULT_MATRIX_AUTO_UPDATE=!0;Hr.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const El=new Ye,gu=new Ye,$M=new Ye,_u=new Ye,Up=new Ye,Vp=new Ye,A3=new Ye,qM=new Ye,XM=new Ye,ZM=new Ye;class Tc{constructor(e=new Ye,t=new Ye,i=new Ye){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),El.subVectors(e,t),r.cross(El);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){El.subVectors(r,t),gu.subVectors(i,t),$M.subVectors(e,t);const a=El.dot(El),o=El.dot(gu),d=El.dot($M),p=gu.dot(gu),g=gu.dot($M),_=a*p-o*o;if(_===0)return s.set(0,0,0),null;const w=1/_,T=(p*d-o*g)*w,I=(a*g-o*d)*w;return s.set(1-T-I,I,T)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,_u)===null?!1:_u.x>=0&&_u.y>=0&&_u.x+_u.y<=1}static getInterpolation(e,t,i,r,s,a,o,d){return this.getBarycoord(e,t,i,r,_u)===null?(d.x=0,d.y=0,"z"in d&&(d.z=0),"w"in d&&(d.w=0),null):(d.setScalar(0),d.addScaledVector(s,_u.x),d.addScaledVector(a,_u.y),d.addScaledVector(o,_u.z),d)}static isFrontFacing(e,t,i,r){return El.subVectors(i,t),gu.subVectors(e,t),El.cross(gu).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return El.subVectors(this.c,this.b),gu.subVectors(this.a,this.b),El.cross(gu).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Tc.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Tc.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Tc.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Tc.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Tc.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let a,o;Up.subVectors(r,i),Vp.subVectors(s,i),qM.subVectors(e,i);const d=Up.dot(qM),p=Vp.dot(qM);if(d<=0&&p<=0)return t.copy(i);XM.subVectors(e,r);const g=Up.dot(XM),_=Vp.dot(XM);if(g>=0&&_<=g)return t.copy(r);const w=d*_-g*p;if(w<=0&&d>=0&&g<=0)return a=d/(d-g),t.copy(i).addScaledVector(Up,a);ZM.subVectors(e,s);const T=Up.dot(ZM),I=Vp.dot(ZM);if(I>=0&&T<=I)return t.copy(s);const L=T*p-d*I;if(L<=0&&p>=0&&I<=0)return o=p/(p-I),t.copy(i).addScaledVector(Vp,o);const P=g*I-T*_;if(P<=0&&_-g>=0&&T-I>=0)return A3.subVectors(s,r),o=(_-g)/(_-g+(T-I)),t.copy(r).addScaledVector(A3,o);const C=1/(P+L+w);return a=L*C,o=w*C,t.copy(i).addScaledVector(Up,a).addScaledVector(Vp,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const FU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nh={h:0,s:0,l:0},Mx={h:0,s:0,l:0};function YM(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class ci{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Oo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,$i.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=$i.workingColorSpace){return this.r=e,this.g=t,this.b=i,$i.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=$i.workingColorSpace){if(e=iI(e,1),t=yo(t,0,1),i=yo(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,a=2*i-s;this.r=YM(a,s,e+1/3),this.g=YM(a,s,e),this.b=YM(a,s,e-1/3)}return $i.toWorkingColorSpace(this,r),this}setStyle(e,t=Oo){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=r[1],o=r[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Oo){const i=FU[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Vm(e.r),this.g=Vm(e.g),this.b=Vm(e.b),this}copyLinearToSRGB(e){return this.r=NM(e.r),this.g=NM(e.g),this.b=NM(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Oo){return $i.fromWorkingColorSpace(uo.copy(this),e),Math.round(yo(uo.r*255,0,255))*65536+Math.round(yo(uo.g*255,0,255))*256+Math.round(yo(uo.b*255,0,255))}getHexString(e=Oo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=$i.workingColorSpace){$i.fromWorkingColorSpace(uo.copy(this),t);const i=uo.r,r=uo.g,s=uo.b,a=Math.max(i,r,s),o=Math.min(i,r,s);let d,p;const g=(o+a)/2;if(o===a)d=0,p=0;else{const _=a-o;switch(p=g<=.5?_/(a+o):_/(2-a-o),a){case i:d=(r-s)/_+(r<s?6:0);break;case r:d=(s-i)/_+2;break;case s:d=(i-r)/_+4;break}d/=6}return e.h=d,e.s=p,e.l=g,e}getRGB(e,t=$i.workingColorSpace){return $i.fromWorkingColorSpace(uo.copy(this),t),e.r=uo.r,e.g=uo.g,e.b=uo.b,e}getStyle(e=Oo){$i.fromWorkingColorSpace(uo.copy(this),e);const t=uo.r,i=uo.g,r=uo.b;return e!==Oo?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Nh),this.setHSL(Nh.h+e,Nh.s+t,Nh.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Nh),e.getHSL(Mx);const i=Py(Nh.h,Mx.h,t),r=Py(Nh.s,Mx.s,t),s=Py(Nh.l,Mx.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const uo=new ci;ci.NAMES=FU;let WJ=0;class Oc extends Lg{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:WJ++}),this.uuid=zl(),this.name="",this.type="Material",this.blending=Bm,this.side=Xu,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=QT,this.blendDst=e2,this.blendEquation=gf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ci(0,0,0),this.blendAlpha=0,this.depthFunc=xw,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=p3,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Lp,this.stencilZFail=Lp,this.stencilZPass=Lp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Bm&&(i.blending=this.blending),this.side!==Xu&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==QT&&(i.blendSrc=this.blendSrc),this.blendDst!==e2&&(i.blendDst=this.blendDst),this.blendEquation!==gf&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==xw&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==p3&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Lp&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Lp&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Lp&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const a=[];for(const o in s){const d=s[o];delete d.metadata,a.push(d)}return a}if(t){const s=r(e.textures),a=r(e.images);s.length>0&&(i.textures=s),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}onBeforeRender(){console.warn("Material: onBeforeRender() has been removed.")}}class Mf extends Oc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ci(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new zc,this.combine=gU,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const os=new Ye,Ex=new Mi;class Vo{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=P2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Dl,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return rI("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Ex.fromBufferAttribute(this,t),Ex.applyMatrix3(e),this.setXY(t,Ex.x,Ex.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)os.fromBufferAttribute(this,t),os.applyMatrix3(e),this.setXYZ(t,os.x,os.y,os.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)os.fromBufferAttribute(this,t),os.applyMatrix4(e),this.setXYZ(t,os.x,os.y,os.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)os.fromBufferAttribute(this,t),os.applyNormalMatrix(e),this.setXYZ(t,os.x,os.y,os.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)os.fromBufferAttribute(this,t),os.transformDirection(e),this.setXYZ(t,os.x,os.y,os.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Rl(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ar(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Rl(t,this.array)),t}setX(e,t){return this.normalized&&(t=ar(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Rl(t,this.array)),t}setY(e,t){return this.normalized&&(t=ar(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Rl(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ar(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Rl(t,this.array)),t}setW(e,t){return this.normalized&&(t=ar(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array),r=ar(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array),r=ar(r,this.array),s=ar(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==P2&&(e.usage=this.usage),e}}class OU extends Vo{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class NU extends Vo{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Bl extends Vo{constructor(e,t,i){super(new Float32Array(e),t,i)}}let jJ=0;const Za=new ui,KM=new Hr,Gp=new Ye,Sa=new th,V_=new th,As=new Ye;class Wl extends Lg{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:jJ++}),this.uuid=zl(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(RU(e)?NU:OU)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new yi().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Za.makeRotationFromQuaternion(e),this.applyMatrix4(Za),this}rotateX(e){return Za.makeRotationX(e),this.applyMatrix4(Za),this}rotateY(e){return Za.makeRotationY(e),this.applyMatrix4(Za),this}rotateZ(e){return Za.makeRotationZ(e),this.applyMatrix4(Za),this}translate(e,t,i){return Za.makeTranslation(e,t,i),this.applyMatrix4(Za),this}scale(e,t,i){return Za.makeScale(e,t,i),this.applyMatrix4(Za),this}lookAt(e){return KM.lookAt(e),KM.updateMatrix(),this.applyMatrix4(KM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gp).negate(),this.translate(Gp.x,Gp.y,Gp.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Bl(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new th);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Ye(-1/0,-1/0,-1/0),new Ye(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];Sa.setFromBufferAttribute(s),this.morphTargetsRelative?(As.addVectors(this.boundingBox.min,Sa.min),this.boundingBox.expandByPoint(As),As.addVectors(this.boundingBox.max,Sa.max),this.boundingBox.expandByPoint(As)):(this.boundingBox.expandByPoint(Sa.min),this.boundingBox.expandByPoint(Sa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Vc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Ye,1/0);return}if(e){const i=this.boundingSphere.center;if(Sa.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const o=t[s];V_.setFromBufferAttribute(o),this.morphTargetsRelative?(As.addVectors(Sa.min,V_.min),Sa.expandByPoint(As),As.addVectors(Sa.max,V_.max),Sa.expandByPoint(As)):(Sa.expandByPoint(V_.min),Sa.expandByPoint(V_.max))}Sa.getCenter(i);let r=0;for(let s=0,a=e.count;s<a;s++)As.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(As));if(t)for(let s=0,a=t.length;s<a;s++){const o=t[s],d=this.morphTargetsRelative;for(let p=0,g=o.count;p<g;p++)As.fromBufferAttribute(o,p),d&&(Gp.fromBufferAttribute(e,p),As.add(Gp)),r=Math.max(r,i.distanceToSquared(As))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Vo(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],d=[];for(let ce=0;ce<i.count;ce++)o[ce]=new Ye,d[ce]=new Ye;const p=new Ye,g=new Ye,_=new Ye,w=new Mi,T=new Mi,I=new Mi,L=new Ye,P=new Ye;function C(ce,K,Q){p.fromBufferAttribute(i,ce),g.fromBufferAttribute(i,K),_.fromBufferAttribute(i,Q),w.fromBufferAttribute(s,ce),T.fromBufferAttribute(s,K),I.fromBufferAttribute(s,Q),g.sub(p),_.sub(p),T.sub(w),I.sub(w);const pe=1/(T.x*I.y-I.x*T.y);isFinite(pe)&&(L.copy(g).multiplyScalar(I.y).addScaledVector(_,-T.y).multiplyScalar(pe),P.copy(_).multiplyScalar(T.x).addScaledVector(g,-I.x).multiplyScalar(pe),o[ce].add(L),o[K].add(L),o[Q].add(L),d[ce].add(P),d[K].add(P),d[Q].add(P))}let O=this.groups;O.length===0&&(O=[{start:0,count:e.count}]);for(let ce=0,K=O.length;ce<K;++ce){const Q=O[ce],pe=Q.start,ze=Q.count;for(let Fe=pe,qe=pe+ze;Fe<qe;Fe+=3)C(e.getX(Fe+0),e.getX(Fe+1),e.getX(Fe+2))}const z=new Ye,H=new Ye,Y=new Ye,ee=new Ye;function te(ce){Y.fromBufferAttribute(r,ce),ee.copy(Y);const K=o[ce];z.copy(K),z.sub(Y.multiplyScalar(Y.dot(K))).normalize(),H.crossVectors(ee,K);const pe=H.dot(d[ce])<0?-1:1;a.setXYZW(ce,z.x,z.y,z.z,pe)}for(let ce=0,K=O.length;ce<K;++ce){const Q=O[ce],pe=Q.start,ze=Q.count;for(let Fe=pe,qe=pe+ze;Fe<qe;Fe+=3)te(e.getX(Fe+0)),te(e.getX(Fe+1)),te(e.getX(Fe+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Vo(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let w=0,T=i.count;w<T;w++)i.setXYZ(w,0,0,0);const r=new Ye,s=new Ye,a=new Ye,o=new Ye,d=new Ye,p=new Ye,g=new Ye,_=new Ye;if(e)for(let w=0,T=e.count;w<T;w+=3){const I=e.getX(w+0),L=e.getX(w+1),P=e.getX(w+2);r.fromBufferAttribute(t,I),s.fromBufferAttribute(t,L),a.fromBufferAttribute(t,P),g.subVectors(a,s),_.subVectors(r,s),g.cross(_),o.fromBufferAttribute(i,I),d.fromBufferAttribute(i,L),p.fromBufferAttribute(i,P),o.add(g),d.add(g),p.add(g),i.setXYZ(I,o.x,o.y,o.z),i.setXYZ(L,d.x,d.y,d.z),i.setXYZ(P,p.x,p.y,p.z)}else for(let w=0,T=t.count;w<T;w+=3)r.fromBufferAttribute(t,w+0),s.fromBufferAttribute(t,w+1),a.fromBufferAttribute(t,w+2),g.subVectors(a,s),_.subVectors(r,s),g.cross(_),i.setXYZ(w+0,g.x,g.y,g.z),i.setXYZ(w+1,g.x,g.y,g.z),i.setXYZ(w+2,g.x,g.y,g.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)As.fromBufferAttribute(e,t),As.normalize(),e.setXYZ(t,As.x,As.y,As.z)}toNonIndexed(){function e(o,d){const p=o.array,g=o.itemSize,_=o.normalized,w=new p.constructor(d.length*g);let T=0,I=0;for(let L=0,P=d.length;L<P;L++){o.isInterleavedBufferAttribute?T=d[L]*o.data.stride+o.offset:T=d[L]*g;for(let C=0;C<g;C++)w[I++]=p[T++]}return new Vo(w,g,_)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Wl,i=this.index.array,r=this.attributes;for(const o in r){const d=r[o],p=e(d,i);t.setAttribute(o,p)}const s=this.morphAttributes;for(const o in s){const d=[],p=s[o];for(let g=0,_=p.length;g<_;g++){const w=p[g],T=e(w,i);d.push(T)}t.morphAttributes[o]=d}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,d=a.length;o<d;o++){const p=a[o];t.addGroup(p.start,p.count,p.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const d=this.parameters;for(const p in d)d[p]!==void 0&&(e[p]=d[p]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const d in i){const p=i[d];e.data.attributes[d]=p.toJSON(e.data)}const r={};let s=!1;for(const d in this.morphAttributes){const p=this.morphAttributes[d],g=[];for(let _=0,w=p.length;_<w;_++){const T=p[_];g.push(T.toJSON(e.data))}g.length>0&&(r[d]=g,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const p in r){const g=r[p];this.setAttribute(p,g.clone(t))}const s=e.morphAttributes;for(const p in s){const g=[],_=s[p];for(let w=0,T=_.length;w<T;w++)g.push(_[w].clone(t));this.morphAttributes[p]=g}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let p=0,g=a.length;p<g;p++){const _=a[p];this.addGroup(_.start,_.count,_.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const d=e.boundingSphere;return d!==null&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const I3=new ui,of=new Rb,Tx=new Vc,P3=new Ye,Hp=new Ye,Wp=new Ye,jp=new Ye,JM=new Ye,Cx=new Ye,Ax=new Mi,Ix=new Mi,Px=new Mi,R3=new Ye,L3=new Ye,D3=new Ye,Rx=new Ye,Lx=new Ye;class Pa extends Hr{constructor(e=new Wl,t=new Mf){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,a=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(s&&o){Cx.set(0,0,0);for(let d=0,p=s.length;d<p;d++){const g=o[d],_=s[d];g!==0&&(JM.fromBufferAttribute(_,e),a?Cx.addScaledVector(JM,g):Cx.addScaledVector(JM.sub(t),g))}t.add(Cx)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Tx.copy(i.boundingSphere),Tx.applyMatrix4(s),of.copy(e.ray).recast(e.near),!(Tx.containsPoint(of.origin)===!1&&(of.intersectSphere(Tx,P3)===null||of.origin.distanceToSquared(P3)>(e.far-e.near)**2))&&(I3.copy(s).invert(),of.copy(e.ray).applyMatrix4(I3),!(i.boundingBox!==null&&of.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,of)))}_computeIntersections(e,t,i){let r;const s=this.geometry,a=this.material,o=s.index,d=s.attributes.position,p=s.attributes.uv,g=s.attributes.uv1,_=s.attributes.normal,w=s.groups,T=s.drawRange;if(o!==null)if(Array.isArray(a))for(let I=0,L=w.length;I<L;I++){const P=w[I],C=a[P.materialIndex],O=Math.max(P.start,T.start),z=Math.min(o.count,Math.min(P.start+P.count,T.start+T.count));for(let H=O,Y=z;H<Y;H+=3){const ee=o.getX(H),te=o.getX(H+1),ce=o.getX(H+2);r=Dx(this,C,e,i,p,g,_,ee,te,ce),r&&(r.faceIndex=Math.floor(H/3),r.face.materialIndex=P.materialIndex,t.push(r))}}else{const I=Math.max(0,T.start),L=Math.min(o.count,T.start+T.count);for(let P=I,C=L;P<C;P+=3){const O=o.getX(P),z=o.getX(P+1),H=o.getX(P+2);r=Dx(this,a,e,i,p,g,_,O,z,H),r&&(r.faceIndex=Math.floor(P/3),t.push(r))}}else if(d!==void 0)if(Array.isArray(a))for(let I=0,L=w.length;I<L;I++){const P=w[I],C=a[P.materialIndex],O=Math.max(P.start,T.start),z=Math.min(d.count,Math.min(P.start+P.count,T.start+T.count));for(let H=O,Y=z;H<Y;H+=3){const ee=H,te=H+1,ce=H+2;r=Dx(this,C,e,i,p,g,_,ee,te,ce),r&&(r.faceIndex=Math.floor(H/3),r.face.materialIndex=P.materialIndex,t.push(r))}}else{const I=Math.max(0,T.start),L=Math.min(d.count,T.start+T.count);for(let P=I,C=L;P<C;P+=3){const O=P,z=P+1,H=P+2;r=Dx(this,a,e,i,p,g,_,O,z,H),r&&(r.faceIndex=Math.floor(P/3),t.push(r))}}}}function $J(n,e,t,i,r,s,a,o){let d;if(e.side===oa?d=i.intersectTriangle(a,s,r,!0,o):d=i.intersectTriangle(r,s,a,e.side===Xu,o),d===null)return null;Lx.copy(o),Lx.applyMatrix4(n.matrixWorld);const p=t.ray.origin.distanceTo(Lx);return p<t.near||p>t.far?null:{distance:p,point:Lx.clone(),object:n}}function Dx(n,e,t,i,r,s,a,o,d,p){n.getVertexPosition(o,Hp),n.getVertexPosition(d,Wp),n.getVertexPosition(p,jp);const g=$J(n,e,t,i,Hp,Wp,jp,Rx);if(g){r&&(Ax.fromBufferAttribute(r,o),Ix.fromBufferAttribute(r,d),Px.fromBufferAttribute(r,p),g.uv=Tc.getInterpolation(Rx,Hp,Wp,jp,Ax,Ix,Px,new Mi)),s&&(Ax.fromBufferAttribute(s,o),Ix.fromBufferAttribute(s,d),Px.fromBufferAttribute(s,p),g.uv1=Tc.getInterpolation(Rx,Hp,Wp,jp,Ax,Ix,Px,new Mi)),a&&(R3.fromBufferAttribute(a,o),L3.fromBufferAttribute(a,d),D3.fromBufferAttribute(a,p),g.normal=Tc.getInterpolation(Rx,Hp,Wp,jp,R3,L3,D3,new Ye),g.normal.dot(i.direction)>0&&g.normal.multiplyScalar(-1));const _={a:o,b:d,c:p,normal:new Ye,materialIndex:0};Tc.getNormal(Hp,Wp,jp,_.normal),g.face=_}return g}class $0 extends Wl{constructor(e=1,t=1,i=1,r=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:a};const o=this;r=Math.floor(r),s=Math.floor(s),a=Math.floor(a);const d=[],p=[],g=[],_=[];let w=0,T=0;I("z","y","x",-1,-1,i,t,e,a,s,0),I("z","y","x",1,-1,i,t,-e,a,s,1),I("x","z","y",1,1,e,i,t,r,a,2),I("x","z","y",1,-1,e,i,-t,r,a,3),I("x","y","z",1,-1,e,t,i,r,s,4),I("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(d),this.setAttribute("position",new Bl(p,3)),this.setAttribute("normal",new Bl(g,3)),this.setAttribute("uv",new Bl(_,2));function I(L,P,C,O,z,H,Y,ee,te,ce,K){const Q=H/te,pe=Y/ce,ze=H/2,Fe=Y/2,qe=ee/2,et=te+1,Ne=ce+1;let st=0,Ee=0;const ut=new Ye;for(let ot=0;ot<Ne;ot++){const dt=ot*pe-Fe;for(let Ct=0;Ct<et;Ct++){const Vt=Ct*Q-ze;ut[L]=Vt*O,ut[P]=dt*z,ut[C]=qe,p.push(ut.x,ut.y,ut.z),ut[L]=0,ut[P]=0,ut[C]=ee>0?1:-1,g.push(ut.x,ut.y,ut.z),_.push(Ct/te),_.push(1-ot/ce),st+=1}}for(let ot=0;ot<ce;ot++)for(let dt=0;dt<te;dt++){const Ct=w+dt+et*ot,Vt=w+dt+et*(ot+1),Re=w+(dt+1)+et*(ot+1),mt=w+(dt+1)+et*ot;d.push(Ct,Vt,mt),d.push(Vt,Re,mt),Ee+=6}o.addGroup(T,Ee,K),T+=Ee,w+=st}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $0(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function fg(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function Lo(n){const e={};for(let t=0;t<n.length;t++){const i=fg(n[t]);for(const r in i)e[r]=i[r]}return e}function qJ(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function zU(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:$i.workingColorSpace}const XJ={clone:fg,merge:Lo};var ZJ=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,YJ=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Md extends Oc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ZJ,this.fragmentShader=YJ,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=fg(e.uniforms),this.uniformsGroups=qJ(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class sI extends Hr{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ui,this.projectionMatrix=new ui,this.projectionMatrixInverse=new ui,this.coordinateSystem=Du}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const zh=new Ye,k3=new Mi,F3=new Mi;class Qo extends sI{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=dg*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Iy*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return dg*2*Math.atan(Math.tan(Iy*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){zh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(zh.x,zh.y).multiplyScalar(-e/zh.z),zh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(zh.x,zh.y).multiplyScalar(-e/zh.z)}getViewSize(e,t){return this.getViewBounds(e,k3,F3),t.subVectors(F3,k3)}setViewOffset(e,t,i,r,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Iy*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const a=this.view;if(this.view!==null&&this.view.enabled){const d=a.fullWidth,p=a.fullHeight;s+=a.offsetX*r/d,t-=a.offsetY*i/p,r*=a.width/d,i*=a.height/p}const o=this.filmOffset;o!==0&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const $p=-90,qp=1;class KJ extends Hr{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new Qo($p,qp,e,t);r.layers=this.layers,this.add(r);const s=new Qo($p,qp,e,t);s.layers=this.layers,this.add(s);const a=new Qo($p,qp,e,t);a.layers=this.layers,this.add(a);const o=new Qo($p,qp,e,t);o.layers=this.layers,this.add(o);const d=new Qo($p,qp,e,t);d.layers=this.layers,this.add(d);const p=new Qo($p,qp,e,t);p.layers=this.layers,this.add(p)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,a,o,d]=t;for(const p of t)this.remove(p);if(e===Du)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),d.up.set(0,1,0),d.lookAt(0,0,-1);else if(e===Ew)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),d.up.set(0,-1,0),d.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const p of t)this.add(p),p.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,o,d,p,g]=this.children,_=e.getRenderTarget(),w=e.getActiveCubeFace(),T=e.getActiveMipmapLevel(),I=e.xr.enabled;e.xr.enabled=!1;const L=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,a),e.setRenderTarget(i,2,r),e.render(t,o),e.setRenderTarget(i,3,r),e.render(t,d),e.setRenderTarget(i,4,r),e.render(t,p),i.texture.generateMipmaps=L,e.setRenderTarget(i,5,r),e.render(t,g),e.setRenderTarget(_,w,T),e.xr.enabled=I,i.texture.needsPMREMUpdate=!0}}class BU extends Fs{constructor(e,t,i,r,s,a,o,d,p,g){e=e!==void 0?e:[],t=t!==void 0?t:ag,super(e,t,i,r,s,a,o,d,p,g),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class JJ extends Uf{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new BU(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Ca}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new $0(5,5,5),s=new Md({name:"CubemapFromEquirect",uniforms:fg(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:oa,blending:_d});s.uniforms.tEquirect.value=t;const a=new Pa(r,s),o=t.minFilter;return t.minFilter===Lu&&(t.minFilter=Ca),new KJ(1,10,this).update(e,a),t.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,i,r);e.setRenderTarget(s)}}const QM=new Ye,QJ=new Ye,eQ=new yi;class pf{constructor(e=new Ye(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=QM.subVectors(i,t).cross(QJ.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(QM),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||eQ.getNormalMatrix(e),r=this.coplanarPoint(QM).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const af=new Vc,kx=new Ye;class oI{constructor(e=new pf,t=new pf,i=new pf,r=new pf,s=new pf,a=new pf){this.planes=[e,t,i,r,s,a]}set(e,t,i,r,s,a){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(s),o[5].copy(a),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Du){const i=this.planes,r=e.elements,s=r[0],a=r[1],o=r[2],d=r[3],p=r[4],g=r[5],_=r[6],w=r[7],T=r[8],I=r[9],L=r[10],P=r[11],C=r[12],O=r[13],z=r[14],H=r[15];if(i[0].setComponents(d-s,w-p,P-T,H-C).normalize(),i[1].setComponents(d+s,w+p,P+T,H+C).normalize(),i[2].setComponents(d+a,w+g,P+I,H+O).normalize(),i[3].setComponents(d-a,w-g,P-I,H-O).normalize(),i[4].setComponents(d-o,w-_,P-L,H-z).normalize(),t===Du)i[5].setComponents(d+o,w+_,P+L,H+z).normalize();else if(t===Ew)i[5].setComponents(o,_,L,z).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),af.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),af.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(af)}intersectsSprite(e){return af.center.set(0,0,0),af.radius=.7071067811865476,af.applyMatrix4(e.matrixWorld),this.intersectsSphere(af)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(kx.x=r.normal.x>0?e.max.x:e.min.x,kx.y=r.normal.y>0?e.max.y:e.min.y,kx.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(kx)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function UU(){let n=null,e=!1,t=null,i=null;function r(s,a){t(s,a),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function tQ(n){const e=new WeakMap;function t(o,d){const p=o.array,g=o.usage,_=p.byteLength,w=n.createBuffer();n.bindBuffer(d,w),n.bufferData(d,p,g),o.onUploadCallback();let T;if(p instanceof Float32Array)T=n.FLOAT;else if(p instanceof Uint16Array)o.isFloat16BufferAttribute?T=n.HALF_FLOAT:T=n.UNSIGNED_SHORT;else if(p instanceof Int16Array)T=n.SHORT;else if(p instanceof Uint32Array)T=n.UNSIGNED_INT;else if(p instanceof Int32Array)T=n.INT;else if(p instanceof Int8Array)T=n.BYTE;else if(p instanceof Uint8Array)T=n.UNSIGNED_BYTE;else if(p instanceof Uint8ClampedArray)T=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+p);return{buffer:w,type:T,bytesPerElement:p.BYTES_PER_ELEMENT,version:o.version,size:_}}function i(o,d,p){const g=d.array,_=d._updateRange,w=d.updateRanges;if(n.bindBuffer(p,o),_.count===-1&&w.length===0&&n.bufferSubData(p,0,g),w.length!==0){for(let T=0,I=w.length;T<I;T++){const L=w[T];n.bufferSubData(p,L.start*g.BYTES_PER_ELEMENT,g,L.start,L.count)}d.clearUpdateRanges()}_.count!==-1&&(n.bufferSubData(p,_.offset*g.BYTES_PER_ELEMENT,g,_.offset,_.count),_.count=-1),d.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function s(o){o.isInterleavedBufferAttribute&&(o=o.data);const d=e.get(o);d&&(n.deleteBuffer(d.buffer),e.delete(o))}function a(o,d){if(o.isGLBufferAttribute){const g=e.get(o);(!g||g.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}o.isInterleavedBufferAttribute&&(o=o.data);const p=e.get(o);if(p===void 0)e.set(o,t(o,d));else if(p.version<o.version){if(p.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(p.buffer,o,d),p.version=o.version}}return{get:r,remove:s,update:a}}class Lb extends Wl{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,a=t/2,o=Math.floor(i),d=Math.floor(r),p=o+1,g=d+1,_=e/o,w=t/d,T=[],I=[],L=[],P=[];for(let C=0;C<g;C++){const O=C*w-a;for(let z=0;z<p;z++){const H=z*_-s;I.push(H,-O,0),L.push(0,0,1),P.push(z/o),P.push(1-C/d)}}for(let C=0;C<d;C++)for(let O=0;O<o;O++){const z=O+p*C,H=O+p*(C+1),Y=O+1+p*(C+1),ee=O+1+p*C;T.push(z,H,ee),T.push(H,Y,ee)}this.setIndex(T),this.setAttribute("position",new Bl(I,3)),this.setAttribute("normal",new Bl(L,3)),this.setAttribute("uv",new Bl(P,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Lb(e.width,e.height,e.widthSegments,e.heightSegments)}}var nQ=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,iQ=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,rQ=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,sQ=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,oQ=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,aQ=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,lQ=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,cQ=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,uQ=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,hQ=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,dQ=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,fQ=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,pQ=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,mQ=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,gQ=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_Q=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,yQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,vQ=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,xQ=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,wQ=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,bQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,SQ=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,MQ=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,EQ=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,TQ=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,CQ=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,AQ=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,IQ=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,PQ=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,RQ=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,LQ="gl_FragColor = linearToOutputTexel( gl_FragColor );",DQ=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,kQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,FQ=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,OQ=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,NQ=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,zQ=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,BQ=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,UQ=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,VQ=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,GQ=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,HQ=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,WQ=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,jQ=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,$Q=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,qQ=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,XQ=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,ZQ=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,YQ=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,KQ=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,JQ=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,QQ=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,eee=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,tee=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,nee=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,iee=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,ree=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,see=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,oee=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,aee=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,lee=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,cee=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,uee=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,hee=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,dee=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,fee=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,pee=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,mee=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,gee=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_ee=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,yee=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,vee=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,xee=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,wee=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,bee=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,See=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Mee=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Eee=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Tee=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Cee=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Aee=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Iee=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Pee=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Ree=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Lee=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Dee=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,kee=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Fee=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Oee=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Nee=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,zee=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Bee=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Uee=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Vee=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Gee=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,Hee=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,Wee=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,jee=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,$ee=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,qee=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Xee=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Zee=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Yee=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Kee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Jee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,Qee=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,ete=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const tte=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,nte=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ite=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,rte=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ste=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ote=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ate=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,lte=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,cte=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ute=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hte=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,dte=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,fte=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,pte=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,mte=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,gte=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_te=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yte=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vte=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,xte=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wte=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,bte=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ste=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Mte=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ete=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Tte=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Cte=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ate=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ite=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Pte=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Rte=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lte=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dte=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,kte=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,_i={alphahash_fragment:nQ,alphahash_pars_fragment:iQ,alphamap_fragment:rQ,alphamap_pars_fragment:sQ,alphatest_fragment:oQ,alphatest_pars_fragment:aQ,aomap_fragment:lQ,aomap_pars_fragment:cQ,batching_pars_vertex:uQ,batching_vertex:hQ,begin_vertex:dQ,beginnormal_vertex:fQ,bsdfs:pQ,iridescence_fragment:mQ,bumpmap_pars_fragment:gQ,clipping_planes_fragment:_Q,clipping_planes_pars_fragment:yQ,clipping_planes_pars_vertex:vQ,clipping_planes_vertex:xQ,color_fragment:wQ,color_pars_fragment:bQ,color_pars_vertex:SQ,color_vertex:MQ,common:EQ,cube_uv_reflection_fragment:TQ,defaultnormal_vertex:CQ,displacementmap_pars_vertex:AQ,displacementmap_vertex:IQ,emissivemap_fragment:PQ,emissivemap_pars_fragment:RQ,colorspace_fragment:LQ,colorspace_pars_fragment:DQ,envmap_fragment:kQ,envmap_common_pars_fragment:FQ,envmap_pars_fragment:OQ,envmap_pars_vertex:NQ,envmap_physical_pars_fragment:XQ,envmap_vertex:zQ,fog_vertex:BQ,fog_pars_vertex:UQ,fog_fragment:VQ,fog_pars_fragment:GQ,gradientmap_pars_fragment:HQ,lightmap_pars_fragment:WQ,lights_lambert_fragment:jQ,lights_lambert_pars_fragment:$Q,lights_pars_begin:qQ,lights_toon_fragment:ZQ,lights_toon_pars_fragment:YQ,lights_phong_fragment:KQ,lights_phong_pars_fragment:JQ,lights_physical_fragment:QQ,lights_physical_pars_fragment:eee,lights_fragment_begin:tee,lights_fragment_maps:nee,lights_fragment_end:iee,logdepthbuf_fragment:ree,logdepthbuf_pars_fragment:see,logdepthbuf_pars_vertex:oee,logdepthbuf_vertex:aee,map_fragment:lee,map_pars_fragment:cee,map_particle_fragment:uee,map_particle_pars_fragment:hee,metalnessmap_fragment:dee,metalnessmap_pars_fragment:fee,morphinstance_vertex:pee,morphcolor_vertex:mee,morphnormal_vertex:gee,morphtarget_pars_vertex:_ee,morphtarget_vertex:yee,normal_fragment_begin:vee,normal_fragment_maps:xee,normal_pars_fragment:wee,normal_pars_vertex:bee,normal_vertex:See,normalmap_pars_fragment:Mee,clearcoat_normal_fragment_begin:Eee,clearcoat_normal_fragment_maps:Tee,clearcoat_pars_fragment:Cee,iridescence_pars_fragment:Aee,opaque_fragment:Iee,packing:Pee,premultiplied_alpha_fragment:Ree,project_vertex:Lee,dithering_fragment:Dee,dithering_pars_fragment:kee,roughnessmap_fragment:Fee,roughnessmap_pars_fragment:Oee,shadowmap_pars_fragment:Nee,shadowmap_pars_vertex:zee,shadowmap_vertex:Bee,shadowmask_pars_fragment:Uee,skinbase_vertex:Vee,skinning_pars_vertex:Gee,skinning_vertex:Hee,skinnormal_vertex:Wee,specularmap_fragment:jee,specularmap_pars_fragment:$ee,tonemapping_fragment:qee,tonemapping_pars_fragment:Xee,transmission_fragment:Zee,transmission_pars_fragment:Yee,uv_pars_fragment:Kee,uv_pars_vertex:Jee,uv_vertex:Qee,worldpos_vertex:ete,background_vert:tte,background_frag:nte,backgroundCube_vert:ite,backgroundCube_frag:rte,cube_vert:ste,cube_frag:ote,depth_vert:ate,depth_frag:lte,distanceRGBA_vert:cte,distanceRGBA_frag:ute,equirect_vert:hte,equirect_frag:dte,linedashed_vert:fte,linedashed_frag:pte,meshbasic_vert:mte,meshbasic_frag:gte,meshlambert_vert:_te,meshlambert_frag:yte,meshmatcap_vert:vte,meshmatcap_frag:xte,meshnormal_vert:wte,meshnormal_frag:bte,meshphong_vert:Ste,meshphong_frag:Mte,meshphysical_vert:Ete,meshphysical_frag:Tte,meshtoon_vert:Cte,meshtoon_frag:Ate,points_vert:Ite,points_frag:Pte,shadow_vert:Rte,shadow_frag:Lte,sprite_vert:Dte,sprite_frag:kte},gn={common:{diffuse:{value:new ci(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new yi},alphaMap:{value:null},alphaMapTransform:{value:new yi},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new yi}},envmap:{envMap:{value:null},envMapRotation:{value:new yi},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new yi}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new yi}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new yi},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new yi},normalScale:{value:new Mi(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new yi},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new yi}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new yi}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new yi}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ci(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ci(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new yi},alphaTest:{value:0},uvTransform:{value:new yi}},sprite:{diffuse:{value:new ci(16777215)},opacity:{value:1},center:{value:new Mi(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new yi},alphaMap:{value:null},alphaMapTransform:{value:new yi},alphaTest:{value:0}}},xc={basic:{uniforms:Lo([gn.common,gn.specularmap,gn.envmap,gn.aomap,gn.lightmap,gn.fog]),vertexShader:_i.meshbasic_vert,fragmentShader:_i.meshbasic_frag},lambert:{uniforms:Lo([gn.common,gn.specularmap,gn.envmap,gn.aomap,gn.lightmap,gn.emissivemap,gn.bumpmap,gn.normalmap,gn.displacementmap,gn.fog,gn.lights,{emissive:{value:new ci(0)}}]),vertexShader:_i.meshlambert_vert,fragmentShader:_i.meshlambert_frag},phong:{uniforms:Lo([gn.common,gn.specularmap,gn.envmap,gn.aomap,gn.lightmap,gn.emissivemap,gn.bumpmap,gn.normalmap,gn.displacementmap,gn.fog,gn.lights,{emissive:{value:new ci(0)},specular:{value:new ci(1118481)},shininess:{value:30}}]),vertexShader:_i.meshphong_vert,fragmentShader:_i.meshphong_frag},standard:{uniforms:Lo([gn.common,gn.envmap,gn.aomap,gn.lightmap,gn.emissivemap,gn.bumpmap,gn.normalmap,gn.displacementmap,gn.roughnessmap,gn.metalnessmap,gn.fog,gn.lights,{emissive:{value:new ci(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_i.meshphysical_vert,fragmentShader:_i.meshphysical_frag},toon:{uniforms:Lo([gn.common,gn.aomap,gn.lightmap,gn.emissivemap,gn.bumpmap,gn.normalmap,gn.displacementmap,gn.gradientmap,gn.fog,gn.lights,{emissive:{value:new ci(0)}}]),vertexShader:_i.meshtoon_vert,fragmentShader:_i.meshtoon_frag},matcap:{uniforms:Lo([gn.common,gn.bumpmap,gn.normalmap,gn.displacementmap,gn.fog,{matcap:{value:null}}]),vertexShader:_i.meshmatcap_vert,fragmentShader:_i.meshmatcap_frag},points:{uniforms:Lo([gn.points,gn.fog]),vertexShader:_i.points_vert,fragmentShader:_i.points_frag},dashed:{uniforms:Lo([gn.common,gn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_i.linedashed_vert,fragmentShader:_i.linedashed_frag},depth:{uniforms:Lo([gn.common,gn.displacementmap]),vertexShader:_i.depth_vert,fragmentShader:_i.depth_frag},normal:{uniforms:Lo([gn.common,gn.bumpmap,gn.normalmap,gn.displacementmap,{opacity:{value:1}}]),vertexShader:_i.meshnormal_vert,fragmentShader:_i.meshnormal_frag},sprite:{uniforms:Lo([gn.sprite,gn.fog]),vertexShader:_i.sprite_vert,fragmentShader:_i.sprite_frag},background:{uniforms:{uvTransform:{value:new yi},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:_i.background_vert,fragmentShader:_i.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new yi}},vertexShader:_i.backgroundCube_vert,fragmentShader:_i.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_i.cube_vert,fragmentShader:_i.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_i.equirect_vert,fragmentShader:_i.equirect_frag},distanceRGBA:{uniforms:Lo([gn.common,gn.displacementmap,{referencePosition:{value:new Ye},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_i.distanceRGBA_vert,fragmentShader:_i.distanceRGBA_frag},shadow:{uniforms:Lo([gn.lights,gn.fog,{color:{value:new ci(0)},opacity:{value:1}}]),vertexShader:_i.shadow_vert,fragmentShader:_i.shadow_frag}};xc.physical={uniforms:Lo([xc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new yi},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new yi},clearcoatNormalScale:{value:new Mi(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new yi},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new yi},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new yi},sheen:{value:0},sheenColor:{value:new ci(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new yi},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new yi},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new yi},transmissionSamplerSize:{value:new Mi},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new yi},attenuationDistance:{value:0},attenuationColor:{value:new ci(0)},specularColor:{value:new ci(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new yi},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new yi},anisotropyVector:{value:new Mi},anisotropyMap:{value:null},anisotropyMapTransform:{value:new yi}}]),vertexShader:_i.meshphysical_vert,fragmentShader:_i.meshphysical_frag};const Fx={r:0,b:0,g:0},lf=new zc,Fte=new ui;function Ote(n,e,t,i,r,s,a){const o=new ci(0);let d=s===!0?0:1,p,g,_=null,w=0,T=null;function I(O){let z=O.isScene===!0?O.background:null;return z&&z.isTexture&&(z=(O.backgroundBlurriness>0?t:e).get(z)),z}function L(O){let z=!1;const H=I(O);H===null?C(o,d):H&&H.isColor&&(C(H,1),z=!0);const Y=n.xr.getEnvironmentBlendMode();Y==="additive"?i.buffers.color.setClear(0,0,0,1,a):Y==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,a),(n.autoClear||z)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function P(O,z){const H=I(z);H&&(H.isCubeTexture||H.mapping===Ib)?(g===void 0&&(g=new Pa(new $0(1,1,1),new Md({name:"BackgroundCubeMaterial",uniforms:fg(xc.backgroundCube.uniforms),vertexShader:xc.backgroundCube.vertexShader,fragmentShader:xc.backgroundCube.fragmentShader,side:oa,depthTest:!1,depthWrite:!1,fog:!1})),g.geometry.deleteAttribute("normal"),g.geometry.deleteAttribute("uv"),g.onBeforeRender=function(Y,ee,te){this.matrixWorld.copyPosition(te.matrixWorld)},Object.defineProperty(g.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(g)),lf.copy(z.backgroundRotation),lf.x*=-1,lf.y*=-1,lf.z*=-1,H.isCubeTexture&&H.isRenderTargetTexture===!1&&(lf.y*=-1,lf.z*=-1),g.material.uniforms.envMap.value=H,g.material.uniforms.flipEnvMap.value=H.isCubeTexture&&H.isRenderTargetTexture===!1?-1:1,g.material.uniforms.backgroundBlurriness.value=z.backgroundBlurriness,g.material.uniforms.backgroundIntensity.value=z.backgroundIntensity,g.material.uniforms.backgroundRotation.value.setFromMatrix4(Fte.makeRotationFromEuler(lf)),g.material.toneMapped=$i.getTransfer(H.colorSpace)!==Ir,(_!==H||w!==H.version||T!==n.toneMapping)&&(g.material.needsUpdate=!0,_=H,w=H.version,T=n.toneMapping),g.layers.enableAll(),O.unshift(g,g.geometry,g.material,0,0,null)):H&&H.isTexture&&(p===void 0&&(p=new Pa(new Lb(2,2),new Md({name:"BackgroundMaterial",uniforms:fg(xc.background.uniforms),vertexShader:xc.background.vertexShader,fragmentShader:xc.background.fragmentShader,side:Xu,depthTest:!1,depthWrite:!1,fog:!1})),p.geometry.deleteAttribute("normal"),Object.defineProperty(p.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(p)),p.material.uniforms.t2D.value=H,p.material.uniforms.backgroundIntensity.value=z.backgroundIntensity,p.material.toneMapped=$i.getTransfer(H.colorSpace)!==Ir,H.matrixAutoUpdate===!0&&H.updateMatrix(),p.material.uniforms.uvTransform.value.copy(H.matrix),(_!==H||w!==H.version||T!==n.toneMapping)&&(p.material.needsUpdate=!0,_=H,w=H.version,T=n.toneMapping),p.layers.enableAll(),O.unshift(p,p.geometry,p.material,0,0,null))}function C(O,z){O.getRGB(Fx,zU(n)),i.buffers.color.setClear(Fx.r,Fx.g,Fx.b,z,a)}return{getClearColor:function(){return o},setClearColor:function(O,z=1){o.set(O),d=z,C(o,d)},getClearAlpha:function(){return d},setClearAlpha:function(O){d=O,C(o,d)},render:L,addToRenderList:P}}function Nte(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=w(null);let s=r,a=!1;function o(Q,pe,ze,Fe,qe){let et=!1;const Ne=_(Fe,ze,pe);s!==Ne&&(s=Ne,p(s.object)),et=T(Q,Fe,ze,qe),et&&I(Q,Fe,ze,qe),qe!==null&&e.update(qe,n.ELEMENT_ARRAY_BUFFER),(et||a)&&(a=!1,H(Q,pe,ze,Fe),qe!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(qe).buffer))}function d(){return n.createVertexArray()}function p(Q){return n.bindVertexArray(Q)}function g(Q){return n.deleteVertexArray(Q)}function _(Q,pe,ze){const Fe=ze.wireframe===!0;let qe=i[Q.id];qe===void 0&&(qe={},i[Q.id]=qe);let et=qe[pe.id];et===void 0&&(et={},qe[pe.id]=et);let Ne=et[Fe];return Ne===void 0&&(Ne=w(d()),et[Fe]=Ne),Ne}function w(Q){const pe=[],ze=[],Fe=[];for(let qe=0;qe<t;qe++)pe[qe]=0,ze[qe]=0,Fe[qe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:pe,enabledAttributes:ze,attributeDivisors:Fe,object:Q,attributes:{},index:null}}function T(Q,pe,ze,Fe){const qe=s.attributes,et=pe.attributes;let Ne=0;const st=ze.getAttributes();for(const Ee in st)if(st[Ee].location>=0){const ot=qe[Ee];let dt=et[Ee];if(dt===void 0&&(Ee==="instanceMatrix"&&Q.instanceMatrix&&(dt=Q.instanceMatrix),Ee==="instanceColor"&&Q.instanceColor&&(dt=Q.instanceColor)),ot===void 0||ot.attribute!==dt||dt&&ot.data!==dt.data)return!0;Ne++}return s.attributesNum!==Ne||s.index!==Fe}function I(Q,pe,ze,Fe){const qe={},et=pe.attributes;let Ne=0;const st=ze.getAttributes();for(const Ee in st)if(st[Ee].location>=0){let ot=et[Ee];ot===void 0&&(Ee==="instanceMatrix"&&Q.instanceMatrix&&(ot=Q.instanceMatrix),Ee==="instanceColor"&&Q.instanceColor&&(ot=Q.instanceColor));const dt={};dt.attribute=ot,ot&&ot.data&&(dt.data=ot.data),qe[Ee]=dt,Ne++}s.attributes=qe,s.attributesNum=Ne,s.index=Fe}function L(){const Q=s.newAttributes;for(let pe=0,ze=Q.length;pe<ze;pe++)Q[pe]=0}function P(Q){C(Q,0)}function C(Q,pe){const ze=s.newAttributes,Fe=s.enabledAttributes,qe=s.attributeDivisors;ze[Q]=1,Fe[Q]===0&&(n.enableVertexAttribArray(Q),Fe[Q]=1),qe[Q]!==pe&&(n.vertexAttribDivisor(Q,pe),qe[Q]=pe)}function O(){const Q=s.newAttributes,pe=s.enabledAttributes;for(let ze=0,Fe=pe.length;ze<Fe;ze++)pe[ze]!==Q[ze]&&(n.disableVertexAttribArray(ze),pe[ze]=0)}function z(Q,pe,ze,Fe,qe,et,Ne){Ne===!0?n.vertexAttribIPointer(Q,pe,ze,qe,et):n.vertexAttribPointer(Q,pe,ze,Fe,qe,et)}function H(Q,pe,ze,Fe){L();const qe=Fe.attributes,et=ze.getAttributes(),Ne=pe.defaultAttributeValues;for(const st in et){const Ee=et[st];if(Ee.location>=0){let ut=qe[st];if(ut===void 0&&(st==="instanceMatrix"&&Q.instanceMatrix&&(ut=Q.instanceMatrix),st==="instanceColor"&&Q.instanceColor&&(ut=Q.instanceColor)),ut!==void 0){const ot=ut.normalized,dt=ut.itemSize,Ct=e.get(ut);if(Ct===void 0)continue;const Vt=Ct.buffer,Re=Ct.type,mt=Ct.bytesPerElement,Et=Re===n.INT||Re===n.UNSIGNED_INT||ut.gpuType===ZA;if(ut.isInterleavedBufferAttribute){const It=ut.data,vn=It.stride,xn=ut.offset;if(It.isInstancedInterleavedBuffer){for(let at=0;at<Ee.locationSize;at++)C(Ee.location+at,It.meshPerAttribute);Q.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=It.meshPerAttribute*It.count)}else for(let at=0;at<Ee.locationSize;at++)P(Ee.location+at);n.bindBuffer(n.ARRAY_BUFFER,Vt);for(let at=0;at<Ee.locationSize;at++)z(Ee.location+at,dt/Ee.locationSize,Re,ot,vn*mt,(xn+dt/Ee.locationSize*at)*mt,Et)}else{if(ut.isInstancedBufferAttribute){for(let It=0;It<Ee.locationSize;It++)C(Ee.location+It,ut.meshPerAttribute);Q.isInstancedMesh!==!0&&Fe._maxInstanceCount===void 0&&(Fe._maxInstanceCount=ut.meshPerAttribute*ut.count)}else for(let It=0;It<Ee.locationSize;It++)P(Ee.location+It);n.bindBuffer(n.ARRAY_BUFFER,Vt);for(let It=0;It<Ee.locationSize;It++)z(Ee.location+It,dt/Ee.locationSize,Re,ot,dt*mt,dt/Ee.locationSize*It*mt,Et)}}else if(Ne!==void 0){const ot=Ne[st];if(ot!==void 0)switch(ot.length){case 2:n.vertexAttrib2fv(Ee.location,ot);break;case 3:n.vertexAttrib3fv(Ee.location,ot);break;case 4:n.vertexAttrib4fv(Ee.location,ot);break;default:n.vertexAttrib1fv(Ee.location,ot)}}}}O()}function Y(){ce();for(const Q in i){const pe=i[Q];for(const ze in pe){const Fe=pe[ze];for(const qe in Fe)g(Fe[qe].object),delete Fe[qe];delete pe[ze]}delete i[Q]}}function ee(Q){if(i[Q.id]===void 0)return;const pe=i[Q.id];for(const ze in pe){const Fe=pe[ze];for(const qe in Fe)g(Fe[qe].object),delete Fe[qe];delete pe[ze]}delete i[Q.id]}function te(Q){for(const pe in i){const ze=i[pe];if(ze[Q.id]===void 0)continue;const Fe=ze[Q.id];for(const qe in Fe)g(Fe[qe].object),delete Fe[qe];delete ze[Q.id]}}function ce(){K(),a=!0,s!==r&&(s=r,p(s.object))}function K(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:ce,resetDefaultState:K,dispose:Y,releaseStatesOfGeometry:ee,releaseStatesOfProgram:te,initAttributes:L,enableAttribute:P,disableUnusedAttributes:O}}function zte(n,e,t){let i;function r(p){i=p}function s(p,g){n.drawArrays(i,p,g),t.update(g,i,1)}function a(p,g,_){_!==0&&(n.drawArraysInstanced(i,p,g,_),t.update(g,i,_))}function o(p,g,_){if(_===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,p,0,g,0,_);let T=0;for(let I=0;I<_;I++)T+=g[I];t.update(T,i,1)}function d(p,g,_,w){if(_===0)return;const T=e.get("WEBGL_multi_draw");if(T===null)for(let I=0;I<p.length;I++)a(p[I],g[I],w[I]);else{T.multiDrawArraysInstancedWEBGL(i,p,0,g,0,w,0,_);let I=0;for(let L=0;L<_;L++)I+=g[L];for(let L=0;L<w.length;L++)t.update(I,i,w[L])}}this.setMode=r,this.render=s,this.renderInstances=a,this.renderMultiDraw=o,this.renderMultiDrawInstances=d}function Bte(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const ee=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function a(ee){return!(ee!==ol&&i.convert(ee)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function o(ee){const te=ee===j0&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(ee!==Zu&&i.convert(ee)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&ee!==Dl&&!te)}function d(ee){if(ee==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";ee="mediump"}return ee==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let p=t.precision!==void 0?t.precision:"highp";const g=d(p);g!==p&&(console.warn("THREE.WebGLRenderer:",p,"not supported, using",g,"instead."),p=g);const _=t.logarithmicDepthBuffer===!0,w=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),T=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),I=n.getParameter(n.MAX_TEXTURE_SIZE),L=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),P=n.getParameter(n.MAX_VERTEX_ATTRIBS),C=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),O=n.getParameter(n.MAX_VARYING_VECTORS),z=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),H=T>0,Y=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:d,textureFormatReadable:a,textureTypeReadable:o,precision:p,logarithmicDepthBuffer:_,maxTextures:w,maxVertexTextures:T,maxTextureSize:I,maxCubemapSize:L,maxAttributes:P,maxVertexUniforms:C,maxVaryings:O,maxFragmentUniforms:z,vertexTextures:H,maxSamples:Y}}function Ute(n){const e=this;let t=null,i=0,r=!1,s=!1;const a=new pf,o=new yi,d={value:null,needsUpdate:!1};this.uniform=d,this.numPlanes=0,this.numIntersection=0,this.init=function(_,w){const T=_.length!==0||w||i!==0||r;return r=w,i=_.length,T},this.beginShadows=function(){s=!0,g(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(_,w){t=g(_,w,0)},this.setState=function(_,w,T){const I=_.clippingPlanes,L=_.clipIntersection,P=_.clipShadows,C=n.get(_);if(!r||I===null||I.length===0||s&&!P)s?g(null):p();else{const O=s?0:i,z=O*4;let H=C.clippingState||null;d.value=H,H=g(I,w,z,T);for(let Y=0;Y!==z;++Y)H[Y]=t[Y];C.clippingState=H,this.numIntersection=L?this.numPlanes:0,this.numPlanes+=O}};function p(){d.value!==t&&(d.value=t,d.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function g(_,w,T,I){const L=_!==null?_.length:0;let P=null;if(L!==0){if(P=d.value,I!==!0||P===null){const C=T+L*4,O=w.matrixWorldInverse;o.getNormalMatrix(O),(P===null||P.length<C)&&(P=new Float32Array(C));for(let z=0,H=T;z!==L;++z,H+=4)a.copy(_[z]).applyMatrix4(O,o),a.normal.toArray(P,H),P[H+3]=a.constant}d.value=P,d.needsUpdate=!0}return e.numPlanes=L,e.numIntersection=0,P}}function Vte(n){let e=new WeakMap;function t(a,o){return o===t2?a.mapping=ag:o===n2&&(a.mapping=lg),a}function i(a){if(a&&a.isTexture){const o=a.mapping;if(o===t2||o===n2)if(e.has(a)){const d=e.get(a).texture;return t(d,a.mapping)}else{const d=a.image;if(d&&d.height>0){const p=new JJ(d.height);return p.fromEquirectangularTexture(n,a),e.set(a,p),a.addEventListener("dispose",r),t(p.texture,a.mapping)}else return null}}return a}function r(a){const o=a.target;o.removeEventListener("dispose",r);const d=e.get(o);d!==void 0&&(e.delete(o),d.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}class aI extends sI{constructor(e=-1,t=1,i=1,r=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,a=i+e,o=r+t,d=r-t;if(this.view!==null&&this.view.enabled){const p=(this.right-this.left)/this.view.fullWidth/this.zoom,g=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=p*this.view.offsetX,a=s+p*this.view.width,o-=g*this.view.offsetY,d=o-g*this.view.height}this.projectionMatrix.makeOrthographic(s,a,o,d,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Tm=4,O3=[.125,.215,.35,.446,.526,.582],_f=20,eE=new aI,N3=new ci;let tE=null,nE=0,iE=0,rE=!1;const mf=(1+Math.sqrt(5))/2,Xp=1/mf,z3=[new Ye(-mf,Xp,0),new Ye(mf,Xp,0),new Ye(-Xp,0,mf),new Ye(Xp,0,mf),new Ye(0,mf,-Xp),new Ye(0,mf,Xp),new Ye(-1,1,-1),new Ye(1,1,-1),new Ye(-1,1,1),new Ye(1,1,1)];class B3{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){tE=this._renderer.getRenderTarget(),nE=this._renderer.getActiveCubeFace(),iE=this._renderer.getActiveMipmapLevel(),rE=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=G3(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=V3(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(tE,nE,iE),this._renderer.xr.enabled=rE,e.scissorTest=!1,Ox(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ag||e.mapping===lg?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),tE=this._renderer.getRenderTarget(),nE=this._renderer.getActiveCubeFace(),iE=this._renderer.getActiveMipmapLevel(),rE=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:Ca,minFilter:Ca,generateMipmaps:!1,type:j0,format:ol,colorSpace:Ys,depthBuffer:!1},r=U3(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=U3(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Gte(s)),this._blurMaterial=Hte(s,e,t)}return r}_compileMaterial(e){const t=new Pa(this._lodPlanes[0],e);this._renderer.compile(t,eE)}_sceneToCubeUV(e,t,i,r){const o=new Qo(90,1,t,i),d=[1,-1,1,1,1,1],p=[1,1,1,-1,-1,-1],g=this._renderer,_=g.autoClear,w=g.toneMapping;g.getClearColor(N3),g.toneMapping=yd,g.autoClear=!1;const T=new Mf({name:"PMREM.Background",side:oa,depthWrite:!1,depthTest:!1}),I=new Pa(new $0,T);let L=!1;const P=e.background;P?P.isColor&&(T.color.copy(P),e.background=null,L=!0):(T.color.copy(N3),L=!0);for(let C=0;C<6;C++){const O=C%3;O===0?(o.up.set(0,d[C],0),o.lookAt(p[C],0,0)):O===1?(o.up.set(0,0,d[C]),o.lookAt(0,p[C],0)):(o.up.set(0,d[C],0),o.lookAt(0,0,p[C]));const z=this._cubeSize;Ox(r,O*z,C>2?z:0,z,z),g.setRenderTarget(r),L&&g.render(I,o),g.render(e,o)}I.geometry.dispose(),I.material.dispose(),g.toneMapping=w,g.autoClear=_,e.background=P}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===ag||e.mapping===lg;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=G3()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=V3());const s=r?this._cubemapMaterial:this._equirectMaterial,a=new Pa(this._lodPlanes[0],s),o=s.uniforms;o.envMap.value=e;const d=this._cubeSize;Ox(t,0,0,3*d,2*d),i.setRenderTarget(t),i.render(a,eE)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodPlanes.length;for(let s=1;s<r;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=z3[(r-s-1)%z3.length];this._blur(e,s-1,s,a,o)}t.autoClear=i}_blur(e,t,i,r,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,i,r,"latitudinal",s),this._halfBlur(a,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,a,o){const d=this._renderer,p=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const g=3,_=new Pa(this._lodPlanes[r],p),w=p.uniforms,T=this._sizeLods[i]-1,I=isFinite(s)?Math.PI/(2*T):2*Math.PI/(2*_f-1),L=s/I,P=isFinite(s)?1+Math.floor(g*L):_f;P>_f&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${P} samples when the maximum is set to ${_f}`);const C=[];let O=0;for(let te=0;te<_f;++te){const ce=te/L,K=Math.exp(-ce*ce/2);C.push(K),te===0?O+=K:te<P&&(O+=2*K)}for(let te=0;te<C.length;te++)C[te]=C[te]/O;w.envMap.value=e.texture,w.samples.value=P,w.weights.value=C,w.latitudinal.value=a==="latitudinal",o&&(w.poleAxis.value=o);const{_lodMax:z}=this;w.dTheta.value=I,w.mipInt.value=z-i;const H=this._sizeLods[r],Y=3*H*(r>z-Tm?r-z+Tm:0),ee=4*(this._cubeSize-H);Ox(t,Y,ee,3*H,2*H),d.setRenderTarget(t),d.render(_,eE)}}function Gte(n){const e=[],t=[],i=[];let r=n;const s=n-Tm+1+O3.length;for(let a=0;a<s;a++){const o=Math.pow(2,r);t.push(o);let d=1/o;a>n-Tm?d=O3[a-n+Tm-1]:a===0&&(d=0),i.push(d);const p=1/(o-2),g=-p,_=1+p,w=[g,g,_,g,_,_,g,g,_,_,g,_],T=6,I=6,L=3,P=2,C=1,O=new Float32Array(L*I*T),z=new Float32Array(P*I*T),H=new Float32Array(C*I*T);for(let ee=0;ee<T;ee++){const te=ee%3*2/3-1,ce=ee>2?0:-1,K=[te,ce,0,te+2/3,ce,0,te+2/3,ce+1,0,te,ce,0,te+2/3,ce+1,0,te,ce+1,0];O.set(K,L*I*ee),z.set(w,P*I*ee);const Q=[ee,ee,ee,ee,ee,ee];H.set(Q,C*I*ee)}const Y=new Wl;Y.setAttribute("position",new Vo(O,L)),Y.setAttribute("uv",new Vo(z,P)),Y.setAttribute("faceIndex",new Vo(H,C)),e.push(Y),r>Tm&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function U3(n,e,t){const i=new Uf(n,e,t);return i.texture.mapping=Ib,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ox(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function Hte(n,e,t){const i=new Float32Array(_f),r=new Ye(0,1,0);return new Md({name:"SphericalGaussianBlur",defines:{n:_f,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:lI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function V3(){return new Md({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:lI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function G3(){return new Md({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:lI(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:_d,depthTest:!1,depthWrite:!1})}function lI(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Wte(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const d=o.mapping,p=d===t2||d===n2,g=d===ag||d===lg;if(p||g){let _=e.get(o);const w=_!==void 0?_.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==w)return t===null&&(t=new B3(n)),_=p?t.fromEquirectangular(o,_):t.fromCubemap(o,_),_.texture.pmremVersion=o.pmremVersion,e.set(o,_),_.texture;if(_!==void 0)return _.texture;{const T=o.image;return p&&T&&T.height>0||g&&T&&r(T)?(t===null&&(t=new B3(n)),_=p?t.fromEquirectangular(o):t.fromCubemap(o),_.texture.pmremVersion=o.pmremVersion,e.set(o,_),o.addEventListener("dispose",s),_.texture):null}}}return o}function r(o){let d=0;const p=6;for(let g=0;g<p;g++)o[g]!==void 0&&d++;return d===p}function s(o){const d=o.target;d.removeEventListener("dispose",s);const p=e.get(d);p!==void 0&&(e.delete(d),p.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:a}}function jte(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&rI("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function $te(n,e,t,i){const r={},s=new WeakMap;function a(_){const w=_.target;w.index!==null&&e.remove(w.index);for(const I in w.attributes)e.remove(w.attributes[I]);for(const I in w.morphAttributes){const L=w.morphAttributes[I];for(let P=0,C=L.length;P<C;P++)e.remove(L[P])}w.removeEventListener("dispose",a),delete r[w.id];const T=s.get(w);T&&(e.remove(T),s.delete(w)),i.releaseStatesOfGeometry(w),w.isInstancedBufferGeometry===!0&&delete w._maxInstanceCount,t.memory.geometries--}function o(_,w){return r[w.id]===!0||(w.addEventListener("dispose",a),r[w.id]=!0,t.memory.geometries++),w}function d(_){const w=_.attributes;for(const I in w)e.update(w[I],n.ARRAY_BUFFER);const T=_.morphAttributes;for(const I in T){const L=T[I];for(let P=0,C=L.length;P<C;P++)e.update(L[P],n.ARRAY_BUFFER)}}function p(_){const w=[],T=_.index,I=_.attributes.position;let L=0;if(T!==null){const O=T.array;L=T.version;for(let z=0,H=O.length;z<H;z+=3){const Y=O[z+0],ee=O[z+1],te=O[z+2];w.push(Y,ee,ee,te,te,Y)}}else if(I!==void 0){const O=I.array;L=I.version;for(let z=0,H=O.length/3-1;z<H;z+=3){const Y=z+0,ee=z+1,te=z+2;w.push(Y,ee,ee,te,te,Y)}}else return;const P=new(RU(w)?NU:OU)(w,1);P.version=L;const C=s.get(_);C&&e.remove(C),s.set(_,P)}function g(_){const w=s.get(_);if(w){const T=_.index;T!==null&&w.version<T.version&&p(_)}else p(_);return s.get(_)}return{get:o,update:d,getWireframeAttribute:g}}function qte(n,e,t){let i;function r(w){i=w}let s,a;function o(w){s=w.type,a=w.bytesPerElement}function d(w,T){n.drawElements(i,T,s,w*a),t.update(T,i,1)}function p(w,T,I){I!==0&&(n.drawElementsInstanced(i,T,s,w*a,I),t.update(T,i,I))}function g(w,T,I){if(I===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,T,0,s,w,0,I);let P=0;for(let C=0;C<I;C++)P+=T[C];t.update(P,i,1)}function _(w,T,I,L){if(I===0)return;const P=e.get("WEBGL_multi_draw");if(P===null)for(let C=0;C<w.length;C++)p(w[C]/a,T[C],L[C]);else{P.multiDrawElementsInstancedWEBGL(i,T,0,s,w,0,L,0,I);let C=0;for(let O=0;O<I;O++)C+=T[O];for(let O=0;O<L.length;O++)t.update(C,i,L[O])}}this.setMode=r,this.setIndex=o,this.render=d,this.renderInstances=p,this.renderMultiDraw=g,this.renderMultiDrawInstances=_}function Xte(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,a,o){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=o*(s/3);break;case n.LINES:t.lines+=o*(s/2);break;case n.LINE_STRIP:t.lines+=o*(s-1);break;case n.LINE_LOOP:t.lines+=o*s;break;case n.POINTS:t.points+=o*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function Zte(n,e,t){const i=new WeakMap,r=new _r;function s(a,o,d){const p=a.morphTargetInfluences,g=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,_=g!==void 0?g.length:0;let w=i.get(o);if(w===void 0||w.count!==_){let Q=function(){ce.dispose(),i.delete(o),o.removeEventListener("dispose",Q)};var T=Q;w!==void 0&&w.texture.dispose();const I=o.morphAttributes.position!==void 0,L=o.morphAttributes.normal!==void 0,P=o.morphAttributes.color!==void 0,C=o.morphAttributes.position||[],O=o.morphAttributes.normal||[],z=o.morphAttributes.color||[];let H=0;I===!0&&(H=1),L===!0&&(H=2),P===!0&&(H=3);let Y=o.attributes.position.count*H,ee=1;Y>e.maxTextureSize&&(ee=Math.ceil(Y/e.maxTextureSize),Y=e.maxTextureSize);const te=new Float32Array(Y*ee*4*_),ce=new DU(te,Y,ee,_);ce.type=Dl,ce.needsUpdate=!0;const K=H*4;for(let pe=0;pe<_;pe++){const ze=C[pe],Fe=O[pe],qe=z[pe],et=Y*ee*4*pe;for(let Ne=0;Ne<ze.count;Ne++){const st=Ne*K;I===!0&&(r.fromBufferAttribute(ze,Ne),te[et+st+0]=r.x,te[et+st+1]=r.y,te[et+st+2]=r.z,te[et+st+3]=0),L===!0&&(r.fromBufferAttribute(Fe,Ne),te[et+st+4]=r.x,te[et+st+5]=r.y,te[et+st+6]=r.z,te[et+st+7]=0),P===!0&&(r.fromBufferAttribute(qe,Ne),te[et+st+8]=r.x,te[et+st+9]=r.y,te[et+st+10]=r.z,te[et+st+11]=qe.itemSize===4?r.w:1)}}w={count:_,texture:ce,size:new Mi(Y,ee)},i.set(o,w),o.addEventListener("dispose",Q)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)d.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let I=0;for(let P=0;P<p.length;P++)I+=p[P];const L=o.morphTargetsRelative?1:1-I;d.getUniforms().setValue(n,"morphTargetBaseInfluence",L),d.getUniforms().setValue(n,"morphTargetInfluences",p)}d.getUniforms().setValue(n,"morphTargetsTexture",w.texture,t),d.getUniforms().setValue(n,"morphTargetsTextureSize",w.size)}return{update:s}}function Yte(n,e,t,i){let r=new WeakMap;function s(d){const p=i.render.frame,g=d.geometry,_=e.get(d,g);if(r.get(_)!==p&&(e.update(_),r.set(_,p)),d.isInstancedMesh&&(d.hasEventListener("dispose",o)===!1&&d.addEventListener("dispose",o),r.get(d)!==p&&(t.update(d.instanceMatrix,n.ARRAY_BUFFER),d.instanceColor!==null&&t.update(d.instanceColor,n.ARRAY_BUFFER),r.set(d,p))),d.isSkinnedMesh){const w=d.skeleton;r.get(w)!==p&&(w.update(),r.set(w,p))}return _}function a(){r=new WeakMap}function o(d){const p=d.target;p.removeEventListener("dispose",o),t.remove(p.instanceMatrix),p.instanceColor!==null&&t.remove(p.instanceColor)}return{update:s,dispose:a}}class VU extends Fs{constructor(e,t,i,r,s,a,o,d,p,g=Um){if(g!==Um&&g!==hg)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&g===Um&&(i=Bf),i===void 0&&g===hg&&(i=ug),super(null,r,s,a,o,d,g,i,p),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:Bo,this.minFilter=d!==void 0?d:Bo,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const GU=new Fs,H3=new VU(1,1),HU=new DU,WU=new OJ,jU=new BU,W3=[],j3=[],$3=new Float32Array(16),q3=new Float32Array(9),X3=new Float32Array(4);function Dg(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=W3[r];if(s===void 0&&(s=new Float32Array(r),W3[r]=s),e!==0){i.toArray(s,0);for(let a=1,o=0;a!==e;++a)o+=t,n[a].toArray(s,o)}return s}function ms(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function gs(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Db(n,e){let t=j3[e];t===void 0&&(t=new Int32Array(e),j3[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function Kte(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Jte(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ms(t,e))return;n.uniform2fv(this.addr,e),gs(t,e)}}function Qte(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ms(t,e))return;n.uniform3fv(this.addr,e),gs(t,e)}}function ene(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ms(t,e))return;n.uniform4fv(this.addr,e),gs(t,e)}}function tne(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(ms(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),gs(t,e)}else{if(ms(t,i))return;X3.set(i),n.uniformMatrix2fv(this.addr,!1,X3),gs(t,i)}}function nne(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(ms(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),gs(t,e)}else{if(ms(t,i))return;q3.set(i),n.uniformMatrix3fv(this.addr,!1,q3),gs(t,i)}}function ine(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(ms(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),gs(t,e)}else{if(ms(t,i))return;$3.set(i),n.uniformMatrix4fv(this.addr,!1,$3),gs(t,i)}}function rne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function sne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ms(t,e))return;n.uniform2iv(this.addr,e),gs(t,e)}}function one(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ms(t,e))return;n.uniform3iv(this.addr,e),gs(t,e)}}function ane(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ms(t,e))return;n.uniform4iv(this.addr,e),gs(t,e)}}function lne(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function cne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ms(t,e))return;n.uniform2uiv(this.addr,e),gs(t,e)}}function une(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ms(t,e))return;n.uniform3uiv(this.addr,e),gs(t,e)}}function hne(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ms(t,e))return;n.uniform4uiv(this.addr,e),gs(t,e)}}function dne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(H3.compareFunction=PU,s=H3):s=GU,t.setTexture2D(e||s,r)}function fne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||WU,r)}function pne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||jU,r)}function mne(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||HU,r)}function gne(n){switch(n){case 5126:return Kte;case 35664:return Jte;case 35665:return Qte;case 35666:return ene;case 35674:return tne;case 35675:return nne;case 35676:return ine;case 5124:case 35670:return rne;case 35667:case 35671:return sne;case 35668:case 35672:return one;case 35669:case 35673:return ane;case 5125:return lne;case 36294:return cne;case 36295:return une;case 36296:return hne;case 35678:case 36198:case 36298:case 36306:case 35682:return dne;case 35679:case 36299:case 36307:return fne;case 35680:case 36300:case 36308:case 36293:return pne;case 36289:case 36303:case 36311:case 36292:return mne}}function _ne(n,e){n.uniform1fv(this.addr,e)}function yne(n,e){const t=Dg(e,this.size,2);n.uniform2fv(this.addr,t)}function vne(n,e){const t=Dg(e,this.size,3);n.uniform3fv(this.addr,t)}function xne(n,e){const t=Dg(e,this.size,4);n.uniform4fv(this.addr,t)}function wne(n,e){const t=Dg(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function bne(n,e){const t=Dg(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Sne(n,e){const t=Dg(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function Mne(n,e){n.uniform1iv(this.addr,e)}function Ene(n,e){n.uniform2iv(this.addr,e)}function Tne(n,e){n.uniform3iv(this.addr,e)}function Cne(n,e){n.uniform4iv(this.addr,e)}function Ane(n,e){n.uniform1uiv(this.addr,e)}function Ine(n,e){n.uniform2uiv(this.addr,e)}function Pne(n,e){n.uniform3uiv(this.addr,e)}function Rne(n,e){n.uniform4uiv(this.addr,e)}function Lne(n,e,t){const i=this.cache,r=e.length,s=Db(t,r);ms(i,s)||(n.uniform1iv(this.addr,s),gs(i,s));for(let a=0;a!==r;++a)t.setTexture2D(e[a]||GU,s[a])}function Dne(n,e,t){const i=this.cache,r=e.length,s=Db(t,r);ms(i,s)||(n.uniform1iv(this.addr,s),gs(i,s));for(let a=0;a!==r;++a)t.setTexture3D(e[a]||WU,s[a])}function kne(n,e,t){const i=this.cache,r=e.length,s=Db(t,r);ms(i,s)||(n.uniform1iv(this.addr,s),gs(i,s));for(let a=0;a!==r;++a)t.setTextureCube(e[a]||jU,s[a])}function Fne(n,e,t){const i=this.cache,r=e.length,s=Db(t,r);ms(i,s)||(n.uniform1iv(this.addr,s),gs(i,s));for(let a=0;a!==r;++a)t.setTexture2DArray(e[a]||HU,s[a])}function One(n){switch(n){case 5126:return _ne;case 35664:return yne;case 35665:return vne;case 35666:return xne;case 35674:return wne;case 35675:return bne;case 35676:return Sne;case 5124:case 35670:return Mne;case 35667:case 35671:return Ene;case 35668:case 35672:return Tne;case 35669:case 35673:return Cne;case 5125:return Ane;case 36294:return Ine;case 36295:return Pne;case 36296:return Rne;case 35678:case 36198:case 36298:case 36306:case 35682:return Lne;case 35679:case 36299:case 36307:return Dne;case 35680:case 36300:case 36308:case 36293:return kne;case 36289:case 36303:case 36311:case 36292:return Fne}}class Nne{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=gne(t.type)}}class zne{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=One(t.type)}}class Bne{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,a=r.length;s!==a;++s){const o=r[s];o.setValue(e,t[o.id],i)}}}const sE=/(\w+)(\])?(\[|\.)?/g;function Z3(n,e){n.seq.push(e),n.map[e.id]=e}function Une(n,e,t){const i=n.name,r=i.length;for(sE.lastIndex=0;;){const s=sE.exec(i),a=sE.lastIndex;let o=s[1];const d=s[2]==="]",p=s[3];if(d&&(o=o|0),p===void 0||p==="["&&a+2===r){Z3(t,p===void 0?new Nne(o,n,e):new zne(o,n,e));break}else{let _=t.map[o];_===void 0&&(_=new Bne(o),Z3(t,_)),t=_}}}class m1{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r),a=e.getUniformLocation(t,s.name);Une(s,a,this)}}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,a=t.length;s!==a;++s){const o=t[s],d=i[o.id];d.needsUpdate!==!1&&o.setValue(e,d.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const a=e[r];a.id in t&&i.push(a)}return i}}function Y3(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const Vne=37297;let Gne=0;function Hne(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=r;a<s;a++){const o=a+1;i.push(`${o===e?">":" "} ${o}: ${t[a]}`)}return i.join(`
`)}function Wne(n){const e=$i.getPrimaries($i.workingColorSpace),t=$i.getPrimaries(n);let i;switch(e===t?i="":e===Mw&&t===Sw?i="LinearDisplayP3ToLinearSRGB":e===Sw&&t===Mw&&(i="LinearSRGBToLinearDisplayP3"),n){case Ys:case Pb:return[i,"LinearTransferOETF"];case Oo:case nI:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function K3(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+r+`

`+Hne(n.getShaderSource(e),a)}else return r}function jne(n,e){const t=Wne(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function $ne(n,e){let t;switch(e){case $K:t="Linear";break;case qK:t="Reinhard";break;case XK:t="OptimizedCineon";break;case ZK:t="ACESFilmic";break;case KK:t="AgX";break;case JK:t="Neutral";break;case YK:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function qne(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(ly).join(`
`)}function Xne(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function Zne(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),a=s.name;let o=1;s.type===n.FLOAT_MAT2&&(o=2),s.type===n.FLOAT_MAT3&&(o=3),s.type===n.FLOAT_MAT4&&(o=4),t[a]={type:s.type,location:n.getAttribLocation(e,a),locationSize:o}}return t}function ly(n){return n!==""}function J3(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Q3(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Yne=/^[ \t]*#include +<([\w\d./]+)>/gm;function R2(n){return n.replace(Yne,Jne)}const Kne=new Map;function Jne(n,e){let t=_i[e];if(t===void 0){const i=Kne.get(e);if(i!==void 0)t=_i[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return R2(t)}const Qne=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function ek(n){return n.replace(Qne,eie)}function eie(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function tk(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function tie(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===mU?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===yK?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===bu&&(e="SHADOWMAP_TYPE_VSM"),e}function nie(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case ag:case lg:e="ENVMAP_TYPE_CUBE";break;case Ib:e="ENVMAP_TYPE_CUBE_UV";break}return e}function iie(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case lg:e="ENVMAP_MODE_REFRACTION";break}return e}function rie(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case gU:e="ENVMAP_BLENDING_MULTIPLY";break;case WK:e="ENVMAP_BLENDING_MIX";break;case jK:e="ENVMAP_BLENDING_ADD";break}return e}function sie(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function oie(n,e,t,i){const r=n.getContext(),s=t.defines;let a=t.vertexShader,o=t.fragmentShader;const d=tie(t),p=nie(t),g=iie(t),_=rie(t),w=sie(t),T=qne(t),I=Xne(s),L=r.createProgram();let P,C,O=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(P=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,I].filter(ly).join(`
`),P.length>0&&(P+=`
`),C=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,I].filter(ly).join(`
`),C.length>0&&(C+=`
`)):(P=[tk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,I,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+g:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(ly).join(`
`),C=[tk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,I,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+p:"",t.envMap?"#define "+g:"",t.envMap?"#define "+_:"",w?"#define CUBEUV_TEXEL_WIDTH "+w.texelWidth:"",w?"#define CUBEUV_TEXEL_HEIGHT "+w.texelHeight:"",w?"#define CUBEUV_MAX_MIP "+w.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+d:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==yd?"#define TONE_MAPPING":"",t.toneMapping!==yd?_i.tonemapping_pars_fragment:"",t.toneMapping!==yd?$ne("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",_i.colorspace_pars_fragment,jne("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(ly).join(`
`)),a=R2(a),a=J3(a,t),a=Q3(a,t),o=R2(o),o=J3(o,t),o=Q3(o,t),a=ek(a),o=ek(o),t.isRawShaderMaterial!==!0&&(O=`#version 300 es
`,P=[T,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+P,C=["#define varying in",t.glslVersion===m3?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===m3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+C);const z=O+P+a,H=O+C+o,Y=Y3(r,r.VERTEX_SHADER,z),ee=Y3(r,r.FRAGMENT_SHADER,H);r.attachShader(L,Y),r.attachShader(L,ee),t.index0AttributeName!==void 0?r.bindAttribLocation(L,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(L,0,"position"),r.linkProgram(L);function te(pe){if(n.debug.checkShaderErrors){const ze=r.getProgramInfoLog(L).trim(),Fe=r.getShaderInfoLog(Y).trim(),qe=r.getShaderInfoLog(ee).trim();let et=!0,Ne=!0;if(r.getProgramParameter(L,r.LINK_STATUS)===!1)if(et=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,L,Y,ee);else{const st=K3(r,Y,"vertex"),Ee=K3(r,ee,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(L,r.VALIDATE_STATUS)+`

Material Name: `+pe.name+`
Material Type: `+pe.type+`

Program Info Log: `+ze+`
`+st+`
`+Ee)}else ze!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ze):(Fe===""||qe==="")&&(Ne=!1);Ne&&(pe.diagnostics={runnable:et,programLog:ze,vertexShader:{log:Fe,prefix:P},fragmentShader:{log:qe,prefix:C}})}r.deleteShader(Y),r.deleteShader(ee),ce=new m1(r,L),K=Zne(r,L)}let ce;this.getUniforms=function(){return ce===void 0&&te(this),ce};let K;this.getAttributes=function(){return K===void 0&&te(this),K};let Q=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Q===!1&&(Q=r.getProgramParameter(L,Vne)),Q},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(L),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=Gne++,this.cacheKey=e,this.usedTimes=1,this.program=L,this.vertexShader=Y,this.fragmentShader=ee,this}let aie=0;class lie{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),a=this._getShaderCacheForMaterial(e);return a.has(r)===!1&&(a.add(r),r.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new cie(e),t.set(e,i)),i}}class cie{constructor(e){this.id=aie++,this.code=e,this.usedTimes=0}}function uie(n,e,t,i,r,s,a){const o=new kU,d=new lie,p=new Set,g=[],_=r.logarithmicDepthBuffer,w=r.vertexTextures;let T=r.precision;const I={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function L(K){return p.add(K),K===0?"uv":`uv${K}`}function P(K,Q,pe,ze,Fe){const qe=ze.fog,et=Fe.geometry,Ne=K.isMeshStandardMaterial?ze.environment:null,st=(K.isMeshStandardMaterial?t:e).get(K.envMap||Ne),Ee=st&&st.mapping===Ib?st.image.height:null,ut=I[K.type];K.precision!==null&&(T=r.getMaxPrecision(K.precision),T!==K.precision&&console.warn("THREE.WebGLProgram.getParameters:",K.precision,"not supported, using",T,"instead."));const ot=et.morphAttributes.position||et.morphAttributes.normal||et.morphAttributes.color,dt=ot!==void 0?ot.length:0;let Ct=0;et.morphAttributes.position!==void 0&&(Ct=1),et.morphAttributes.normal!==void 0&&(Ct=2),et.morphAttributes.color!==void 0&&(Ct=3);let Vt,Re,mt,Et;if(ut){const xe=xc[ut];Vt=xe.vertexShader,Re=xe.fragmentShader}else Vt=K.vertexShader,Re=K.fragmentShader,d.update(K),mt=d.getVertexShaderID(K),Et=d.getFragmentShaderID(K);const It=n.getRenderTarget(),vn=Fe.isInstancedMesh===!0,xn=Fe.isBatchedMesh===!0,at=!!K.map,Rn=!!K.matcap,Me=!!st,Jn=!!K.aoMap,on=!!K.lightMap,Vn=!!K.bumpMap,Te=!!K.normalMap,jn=!!K.displacementMap,wn=!!K.emissiveMap,jt=!!K.metalnessMap,me=!!K.roughnessMap,le=K.anisotropy>0,tt=K.clearcoat>0,xt=K.dispersion>0,St=K.iridescence>0,yt=K.sheen>0,hn=K.transmission>0,zt=le&&!!K.anisotropyMap,Je=tt&&!!K.clearcoatMap,cn=tt&&!!K.clearcoatNormalMap,At=tt&&!!K.clearcoatRoughnessMap,tn=St&&!!K.iridescenceMap,Zn=St&&!!K.iridescenceThicknessMap,lt=yt&&!!K.sheenColorMap,Mt=yt&&!!K.sheenRoughnessMap,kt=!!K.specularMap,In=!!K.specularColorMap,ii=!!K.specularIntensityMap,Ae=hn&&!!K.transmissionMap,Lt=hn&&!!K.thicknessMap,gt=!!K.gradientMap,ht=!!K.alphaMap,ae=K.alphaTest>0,j=!!K.alphaHash,Z=!!K.extensions;let ne=yd;K.toneMapped&&(It===null||It.isXRRenderTarget===!0)&&(ne=n.toneMapping);const fe={shaderID:ut,shaderType:K.type,shaderName:K.name,vertexShader:Vt,fragmentShader:Re,defines:K.defines,customVertexShaderID:mt,customFragmentShaderID:Et,isRawShaderMaterial:K.isRawShaderMaterial===!0,glslVersion:K.glslVersion,precision:T,batching:xn,batchingColor:xn&&Fe._colorsTexture!==null,instancing:vn,instancingColor:vn&&Fe.instanceColor!==null,instancingMorph:vn&&Fe.morphTexture!==null,supportsVertexTextures:w,outputColorSpace:It===null?n.outputColorSpace:It.isXRRenderTarget===!0?It.texture.colorSpace:Ys,alphaToCoverage:!!K.alphaToCoverage,map:at,matcap:Rn,envMap:Me,envMapMode:Me&&st.mapping,envMapCubeUVHeight:Ee,aoMap:Jn,lightMap:on,bumpMap:Vn,normalMap:Te,displacementMap:w&&jn,emissiveMap:wn,normalMapObjectSpace:Te&&K.normalMapType===rJ,normalMapTangentSpace:Te&&K.normalMapType===IU,metalnessMap:jt,roughnessMap:me,anisotropy:le,anisotropyMap:zt,clearcoat:tt,clearcoatMap:Je,clearcoatNormalMap:cn,clearcoatRoughnessMap:At,dispersion:xt,iridescence:St,iridescenceMap:tn,iridescenceThicknessMap:Zn,sheen:yt,sheenColorMap:lt,sheenRoughnessMap:Mt,specularMap:kt,specularColorMap:In,specularIntensityMap:ii,transmission:hn,transmissionMap:Ae,thicknessMap:Lt,gradientMap:gt,opaque:K.transparent===!1&&K.blending===Bm&&K.alphaToCoverage===!1,alphaMap:ht,alphaTest:ae,alphaHash:j,combine:K.combine,mapUv:at&&L(K.map.channel),aoMapUv:Jn&&L(K.aoMap.channel),lightMapUv:on&&L(K.lightMap.channel),bumpMapUv:Vn&&L(K.bumpMap.channel),normalMapUv:Te&&L(K.normalMap.channel),displacementMapUv:jn&&L(K.displacementMap.channel),emissiveMapUv:wn&&L(K.emissiveMap.channel),metalnessMapUv:jt&&L(K.metalnessMap.channel),roughnessMapUv:me&&L(K.roughnessMap.channel),anisotropyMapUv:zt&&L(K.anisotropyMap.channel),clearcoatMapUv:Je&&L(K.clearcoatMap.channel),clearcoatNormalMapUv:cn&&L(K.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:At&&L(K.clearcoatRoughnessMap.channel),iridescenceMapUv:tn&&L(K.iridescenceMap.channel),iridescenceThicknessMapUv:Zn&&L(K.iridescenceThicknessMap.channel),sheenColorMapUv:lt&&L(K.sheenColorMap.channel),sheenRoughnessMapUv:Mt&&L(K.sheenRoughnessMap.channel),specularMapUv:kt&&L(K.specularMap.channel),specularColorMapUv:In&&L(K.specularColorMap.channel),specularIntensityMapUv:ii&&L(K.specularIntensityMap.channel),transmissionMapUv:Ae&&L(K.transmissionMap.channel),thicknessMapUv:Lt&&L(K.thicknessMap.channel),alphaMapUv:ht&&L(K.alphaMap.channel),vertexTangents:!!et.attributes.tangent&&(Te||le),vertexColors:K.vertexColors,vertexAlphas:K.vertexColors===!0&&!!et.attributes.color&&et.attributes.color.itemSize===4,pointsUvs:Fe.isPoints===!0&&!!et.attributes.uv&&(at||ht),fog:!!qe,useFog:K.fog===!0,fogExp2:!!qe&&qe.isFogExp2,flatShading:K.flatShading===!0,sizeAttenuation:K.sizeAttenuation===!0,logarithmicDepthBuffer:_,skinning:Fe.isSkinnedMesh===!0,morphTargets:et.morphAttributes.position!==void 0,morphNormals:et.morphAttributes.normal!==void 0,morphColors:et.morphAttributes.color!==void 0,morphTargetsCount:dt,morphTextureStride:Ct,numDirLights:Q.directional.length,numPointLights:Q.point.length,numSpotLights:Q.spot.length,numSpotLightMaps:Q.spotLightMap.length,numRectAreaLights:Q.rectArea.length,numHemiLights:Q.hemi.length,numDirLightShadows:Q.directionalShadowMap.length,numPointLightShadows:Q.pointShadowMap.length,numSpotLightShadows:Q.spotShadowMap.length,numSpotLightShadowsWithMaps:Q.numSpotLightShadowsWithMaps,numLightProbes:Q.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:K.dithering,shadowMapEnabled:n.shadowMap.enabled&&pe.length>0,shadowMapType:n.shadowMap.type,toneMapping:ne,decodeVideoTexture:at&&K.map.isVideoTexture===!0&&$i.getTransfer(K.map.colorSpace)===Ir,premultipliedAlpha:K.premultipliedAlpha,doubleSided:K.side===Ec,flipSided:K.side===oa,useDepthPacking:K.depthPacking>=0,depthPacking:K.depthPacking||0,index0AttributeName:K.index0AttributeName,extensionClipCullDistance:Z&&K.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Z&&K.extensions.multiDraw===!0||xn)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:K.customProgramCacheKey()};return fe.vertexUv1s=p.has(1),fe.vertexUv2s=p.has(2),fe.vertexUv3s=p.has(3),p.clear(),fe}function C(K){const Q=[];if(K.shaderID?Q.push(K.shaderID):(Q.push(K.customVertexShaderID),Q.push(K.customFragmentShaderID)),K.defines!==void 0)for(const pe in K.defines)Q.push(pe),Q.push(K.defines[pe]);return K.isRawShaderMaterial===!1&&(O(Q,K),z(Q,K),Q.push(n.outputColorSpace)),Q.push(K.customProgramCacheKey),Q.join()}function O(K,Q){K.push(Q.precision),K.push(Q.outputColorSpace),K.push(Q.envMapMode),K.push(Q.envMapCubeUVHeight),K.push(Q.mapUv),K.push(Q.alphaMapUv),K.push(Q.lightMapUv),K.push(Q.aoMapUv),K.push(Q.bumpMapUv),K.push(Q.normalMapUv),K.push(Q.displacementMapUv),K.push(Q.emissiveMapUv),K.push(Q.metalnessMapUv),K.push(Q.roughnessMapUv),K.push(Q.anisotropyMapUv),K.push(Q.clearcoatMapUv),K.push(Q.clearcoatNormalMapUv),K.push(Q.clearcoatRoughnessMapUv),K.push(Q.iridescenceMapUv),K.push(Q.iridescenceThicknessMapUv),K.push(Q.sheenColorMapUv),K.push(Q.sheenRoughnessMapUv),K.push(Q.specularMapUv),K.push(Q.specularColorMapUv),K.push(Q.specularIntensityMapUv),K.push(Q.transmissionMapUv),K.push(Q.thicknessMapUv),K.push(Q.combine),K.push(Q.fogExp2),K.push(Q.sizeAttenuation),K.push(Q.morphTargetsCount),K.push(Q.morphAttributeCount),K.push(Q.numDirLights),K.push(Q.numPointLights),K.push(Q.numSpotLights),K.push(Q.numSpotLightMaps),K.push(Q.numHemiLights),K.push(Q.numRectAreaLights),K.push(Q.numDirLightShadows),K.push(Q.numPointLightShadows),K.push(Q.numSpotLightShadows),K.push(Q.numSpotLightShadowsWithMaps),K.push(Q.numLightProbes),K.push(Q.shadowMapType),K.push(Q.toneMapping),K.push(Q.numClippingPlanes),K.push(Q.numClipIntersection),K.push(Q.depthPacking)}function z(K,Q){o.disableAll(),Q.supportsVertexTextures&&o.enable(0),Q.instancing&&o.enable(1),Q.instancingColor&&o.enable(2),Q.instancingMorph&&o.enable(3),Q.matcap&&o.enable(4),Q.envMap&&o.enable(5),Q.normalMapObjectSpace&&o.enable(6),Q.normalMapTangentSpace&&o.enable(7),Q.clearcoat&&o.enable(8),Q.iridescence&&o.enable(9),Q.alphaTest&&o.enable(10),Q.vertexColors&&o.enable(11),Q.vertexAlphas&&o.enable(12),Q.vertexUv1s&&o.enable(13),Q.vertexUv2s&&o.enable(14),Q.vertexUv3s&&o.enable(15),Q.vertexTangents&&o.enable(16),Q.anisotropy&&o.enable(17),Q.alphaHash&&o.enable(18),Q.batching&&o.enable(19),Q.dispersion&&o.enable(20),Q.batchingColor&&o.enable(21),K.push(o.mask),o.disableAll(),Q.fog&&o.enable(0),Q.useFog&&o.enable(1),Q.flatShading&&o.enable(2),Q.logarithmicDepthBuffer&&o.enable(3),Q.skinning&&o.enable(4),Q.morphTargets&&o.enable(5),Q.morphNormals&&o.enable(6),Q.morphColors&&o.enable(7),Q.premultipliedAlpha&&o.enable(8),Q.shadowMapEnabled&&o.enable(9),Q.doubleSided&&o.enable(10),Q.flipSided&&o.enable(11),Q.useDepthPacking&&o.enable(12),Q.dithering&&o.enable(13),Q.transmission&&o.enable(14),Q.sheen&&o.enable(15),Q.opaque&&o.enable(16),Q.pointsUvs&&o.enable(17),Q.decodeVideoTexture&&o.enable(18),Q.alphaToCoverage&&o.enable(19),K.push(o.mask)}function H(K){const Q=I[K.type];let pe;if(Q){const ze=xc[Q];pe=XJ.clone(ze.uniforms)}else pe=K.uniforms;return pe}function Y(K,Q){let pe;for(let ze=0,Fe=g.length;ze<Fe;ze++){const qe=g[ze];if(qe.cacheKey===Q){pe=qe,++pe.usedTimes;break}}return pe===void 0&&(pe=new oie(n,Q,K,s),g.push(pe)),pe}function ee(K){if(--K.usedTimes===0){const Q=g.indexOf(K);g[Q]=g[g.length-1],g.pop(),K.destroy()}}function te(K){d.remove(K)}function ce(){d.dispose()}return{getParameters:P,getProgramCacheKey:C,getUniforms:H,acquireProgram:Y,releaseProgram:ee,releaseShaderCache:te,programs:g,dispose:ce}}function hie(){let n=new WeakMap;function e(s){let a=n.get(s);return a===void 0&&(a={},n.set(s,a)),a}function t(s){n.delete(s)}function i(s,a,o){n.get(s)[a]=o}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function die(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function nk(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function ik(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function a(_,w,T,I,L,P){let C=n[e];return C===void 0?(C={id:_.id,object:_,geometry:w,material:T,groupOrder:I,renderOrder:_.renderOrder,z:L,group:P},n[e]=C):(C.id=_.id,C.object=_,C.geometry=w,C.material=T,C.groupOrder=I,C.renderOrder=_.renderOrder,C.z=L,C.group=P),e++,C}function o(_,w,T,I,L,P){const C=a(_,w,T,I,L,P);T.transmission>0?i.push(C):T.transparent===!0?r.push(C):t.push(C)}function d(_,w,T,I,L,P){const C=a(_,w,T,I,L,P);T.transmission>0?i.unshift(C):T.transparent===!0?r.unshift(C):t.unshift(C)}function p(_,w){t.length>1&&t.sort(_||die),i.length>1&&i.sort(w||nk),r.length>1&&r.sort(w||nk)}function g(){for(let _=e,w=n.length;_<w;_++){const T=n[_];if(T.id===null)break;T.id=null,T.object=null,T.geometry=null,T.material=null,T.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:o,unshift:d,finish:g,sort:p}}function fie(){let n=new WeakMap;function e(i,r){const s=n.get(i);let a;return s===void 0?(a=new ik,n.set(i,[a])):r>=s.length?(a=new ik,s.push(a)):a=s[r],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function pie(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Ye,color:new ci};break;case"SpotLight":t={position:new Ye,direction:new Ye,color:new ci,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Ye,color:new ci,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Ye,skyColor:new ci,groundColor:new ci};break;case"RectAreaLight":t={color:new ci,position:new Ye,halfWidth:new Ye,halfHeight:new Ye};break}return n[e.id]=t,t}}}function mie(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mi};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mi};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Mi,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let gie=0;function _ie(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function yie(n){const e=new pie,t=mie(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let p=0;p<9;p++)i.probe.push(new Ye);const r=new Ye,s=new ui,a=new ui;function o(p){let g=0,_=0,w=0;for(let K=0;K<9;K++)i.probe[K].set(0,0,0);let T=0,I=0,L=0,P=0,C=0,O=0,z=0,H=0,Y=0,ee=0,te=0;p.sort(_ie);for(let K=0,Q=p.length;K<Q;K++){const pe=p[K],ze=pe.color,Fe=pe.intensity,qe=pe.distance,et=pe.shadow&&pe.shadow.map?pe.shadow.map.texture:null;if(pe.isAmbientLight)g+=ze.r*Fe,_+=ze.g*Fe,w+=ze.b*Fe;else if(pe.isLightProbe){for(let Ne=0;Ne<9;Ne++)i.probe[Ne].addScaledVector(pe.sh.coefficients[Ne],Fe);te++}else if(pe.isDirectionalLight){const Ne=e.get(pe);if(Ne.color.copy(pe.color).multiplyScalar(pe.intensity),pe.castShadow){const st=pe.shadow,Ee=t.get(pe);Ee.shadowIntensity=st.intensity,Ee.shadowBias=st.bias,Ee.shadowNormalBias=st.normalBias,Ee.shadowRadius=st.radius,Ee.shadowMapSize=st.mapSize,i.directionalShadow[T]=Ee,i.directionalShadowMap[T]=et,i.directionalShadowMatrix[T]=pe.shadow.matrix,O++}i.directional[T]=Ne,T++}else if(pe.isSpotLight){const Ne=e.get(pe);Ne.position.setFromMatrixPosition(pe.matrixWorld),Ne.color.copy(ze).multiplyScalar(Fe),Ne.distance=qe,Ne.coneCos=Math.cos(pe.angle),Ne.penumbraCos=Math.cos(pe.angle*(1-pe.penumbra)),Ne.decay=pe.decay,i.spot[L]=Ne;const st=pe.shadow;if(pe.map&&(i.spotLightMap[Y]=pe.map,Y++,st.updateMatrices(pe),pe.castShadow&&ee++),i.spotLightMatrix[L]=st.matrix,pe.castShadow){const Ee=t.get(pe);Ee.shadowIntensity=st.intensity,Ee.shadowBias=st.bias,Ee.shadowNormalBias=st.normalBias,Ee.shadowRadius=st.radius,Ee.shadowMapSize=st.mapSize,i.spotShadow[L]=Ee,i.spotShadowMap[L]=et,H++}L++}else if(pe.isRectAreaLight){const Ne=e.get(pe);Ne.color.copy(ze).multiplyScalar(Fe),Ne.halfWidth.set(pe.width*.5,0,0),Ne.halfHeight.set(0,pe.height*.5,0),i.rectArea[P]=Ne,P++}else if(pe.isPointLight){const Ne=e.get(pe);if(Ne.color.copy(pe.color).multiplyScalar(pe.intensity),Ne.distance=pe.distance,Ne.decay=pe.decay,pe.castShadow){const st=pe.shadow,Ee=t.get(pe);Ee.shadowIntensity=st.intensity,Ee.shadowBias=st.bias,Ee.shadowNormalBias=st.normalBias,Ee.shadowRadius=st.radius,Ee.shadowMapSize=st.mapSize,Ee.shadowCameraNear=st.camera.near,Ee.shadowCameraFar=st.camera.far,i.pointShadow[I]=Ee,i.pointShadowMap[I]=et,i.pointShadowMatrix[I]=pe.shadow.matrix,z++}i.point[I]=Ne,I++}else if(pe.isHemisphereLight){const Ne=e.get(pe);Ne.skyColor.copy(pe.color).multiplyScalar(Fe),Ne.groundColor.copy(pe.groundColor).multiplyScalar(Fe),i.hemi[C]=Ne,C++}}P>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=gn.LTC_FLOAT_1,i.rectAreaLTC2=gn.LTC_FLOAT_2):(i.rectAreaLTC1=gn.LTC_HALF_1,i.rectAreaLTC2=gn.LTC_HALF_2)),i.ambient[0]=g,i.ambient[1]=_,i.ambient[2]=w;const ce=i.hash;(ce.directionalLength!==T||ce.pointLength!==I||ce.spotLength!==L||ce.rectAreaLength!==P||ce.hemiLength!==C||ce.numDirectionalShadows!==O||ce.numPointShadows!==z||ce.numSpotShadows!==H||ce.numSpotMaps!==Y||ce.numLightProbes!==te)&&(i.directional.length=T,i.spot.length=L,i.rectArea.length=P,i.point.length=I,i.hemi.length=C,i.directionalShadow.length=O,i.directionalShadowMap.length=O,i.pointShadow.length=z,i.pointShadowMap.length=z,i.spotShadow.length=H,i.spotShadowMap.length=H,i.directionalShadowMatrix.length=O,i.pointShadowMatrix.length=z,i.spotLightMatrix.length=H+Y-ee,i.spotLightMap.length=Y,i.numSpotLightShadowsWithMaps=ee,i.numLightProbes=te,ce.directionalLength=T,ce.pointLength=I,ce.spotLength=L,ce.rectAreaLength=P,ce.hemiLength=C,ce.numDirectionalShadows=O,ce.numPointShadows=z,ce.numSpotShadows=H,ce.numSpotMaps=Y,ce.numLightProbes=te,i.version=gie++)}function d(p,g){let _=0,w=0,T=0,I=0,L=0;const P=g.matrixWorldInverse;for(let C=0,O=p.length;C<O;C++){const z=p[C];if(z.isDirectionalLight){const H=i.directional[_];H.direction.setFromMatrixPosition(z.matrixWorld),r.setFromMatrixPosition(z.target.matrixWorld),H.direction.sub(r),H.direction.transformDirection(P),_++}else if(z.isSpotLight){const H=i.spot[T];H.position.setFromMatrixPosition(z.matrixWorld),H.position.applyMatrix4(P),H.direction.setFromMatrixPosition(z.matrixWorld),r.setFromMatrixPosition(z.target.matrixWorld),H.direction.sub(r),H.direction.transformDirection(P),T++}else if(z.isRectAreaLight){const H=i.rectArea[I];H.position.setFromMatrixPosition(z.matrixWorld),H.position.applyMatrix4(P),a.identity(),s.copy(z.matrixWorld),s.premultiply(P),a.extractRotation(s),H.halfWidth.set(z.width*.5,0,0),H.halfHeight.set(0,z.height*.5,0),H.halfWidth.applyMatrix4(a),H.halfHeight.applyMatrix4(a),I++}else if(z.isPointLight){const H=i.point[w];H.position.setFromMatrixPosition(z.matrixWorld),H.position.applyMatrix4(P),w++}else if(z.isHemisphereLight){const H=i.hemi[L];H.direction.setFromMatrixPosition(z.matrixWorld),H.direction.transformDirection(P),L++}}}return{setup:o,setupView:d,state:i}}function rk(n){const e=new yie(n),t=[],i=[];function r(g){p.camera=g,t.length=0,i.length=0}function s(g){t.push(g)}function a(g){i.push(g)}function o(){e.setup(t)}function d(g){e.setupView(t,g)}const p={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:p,setupLights:o,setupLightsView:d,pushLight:s,pushShadow:a}}function vie(n){let e=new WeakMap;function t(r,s=0){const a=e.get(r);let o;return a===void 0?(o=new rk(n),e.set(r,[o])):s>=a.length?(o=new rk(n),a.push(o)):o=a[s],o}function i(){e=new WeakMap}return{get:t,dispose:i}}class xie extends Oc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=nJ,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class wie extends Oc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const bie=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,Sie=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function Mie(n,e,t){let i=new oI;const r=new Mi,s=new Mi,a=new _r,o=new xie({depthPacking:iJ}),d=new wie,p={},g=t.maxTextureSize,_={[Xu]:oa,[oa]:Xu,[Ec]:Ec},w=new Md({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Mi},radius:{value:4}},vertexShader:bie,fragmentShader:Sie}),T=w.clone();T.defines.HORIZONTAL_PASS=1;const I=new Wl;I.setAttribute("position",new Vo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const L=new Pa(I,w),P=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=mU;let C=this.type;this.render=function(ee,te,ce){if(P.enabled===!1||P.autoUpdate===!1&&P.needsUpdate===!1||ee.length===0)return;const K=n.getRenderTarget(),Q=n.getActiveCubeFace(),pe=n.getActiveMipmapLevel(),ze=n.state;ze.setBlending(_d),ze.buffers.color.setClear(1,1,1,1),ze.buffers.depth.setTest(!0),ze.setScissorTest(!1);const Fe=C!==bu&&this.type===bu,qe=C===bu&&this.type!==bu;for(let et=0,Ne=ee.length;et<Ne;et++){const st=ee[et],Ee=st.shadow;if(Ee===void 0){console.warn("THREE.WebGLShadowMap:",st,"has no shadow.");continue}if(Ee.autoUpdate===!1&&Ee.needsUpdate===!1)continue;r.copy(Ee.mapSize);const ut=Ee.getFrameExtents();if(r.multiply(ut),s.copy(Ee.mapSize),(r.x>g||r.y>g)&&(r.x>g&&(s.x=Math.floor(g/ut.x),r.x=s.x*ut.x,Ee.mapSize.x=s.x),r.y>g&&(s.y=Math.floor(g/ut.y),r.y=s.y*ut.y,Ee.mapSize.y=s.y)),Ee.map===null||Fe===!0||qe===!0){const dt=this.type!==bu?{minFilter:Bo,magFilter:Bo}:{};Ee.map!==null&&Ee.map.dispose(),Ee.map=new Uf(r.x,r.y,dt),Ee.map.texture.name=st.name+".shadowMap",Ee.camera.updateProjectionMatrix()}n.setRenderTarget(Ee.map),n.clear();const ot=Ee.getViewportCount();for(let dt=0;dt<ot;dt++){const Ct=Ee.getViewport(dt);a.set(s.x*Ct.x,s.y*Ct.y,s.x*Ct.z,s.y*Ct.w),ze.viewport(a),Ee.updateMatrices(st,dt),i=Ee.getFrustum(),H(te,ce,Ee.camera,st,this.type)}Ee.isPointLightShadow!==!0&&this.type===bu&&O(Ee,ce),Ee.needsUpdate=!1}C=this.type,P.needsUpdate=!1,n.setRenderTarget(K,Q,pe)};function O(ee,te){const ce=e.update(L);w.defines.VSM_SAMPLES!==ee.blurSamples&&(w.defines.VSM_SAMPLES=ee.blurSamples,T.defines.VSM_SAMPLES=ee.blurSamples,w.needsUpdate=!0,T.needsUpdate=!0),ee.mapPass===null&&(ee.mapPass=new Uf(r.x,r.y)),w.uniforms.shadow_pass.value=ee.map.texture,w.uniforms.resolution.value=ee.mapSize,w.uniforms.radius.value=ee.radius,n.setRenderTarget(ee.mapPass),n.clear(),n.renderBufferDirect(te,null,ce,w,L,null),T.uniforms.shadow_pass.value=ee.mapPass.texture,T.uniforms.resolution.value=ee.mapSize,T.uniforms.radius.value=ee.radius,n.setRenderTarget(ee.map),n.clear(),n.renderBufferDirect(te,null,ce,T,L,null)}function z(ee,te,ce,K){let Q=null;const pe=ce.isPointLight===!0?ee.customDistanceMaterial:ee.customDepthMaterial;if(pe!==void 0)Q=pe;else if(Q=ce.isPointLight===!0?d:o,n.localClippingEnabled&&te.clipShadows===!0&&Array.isArray(te.clippingPlanes)&&te.clippingPlanes.length!==0||te.displacementMap&&te.displacementScale!==0||te.alphaMap&&te.alphaTest>0||te.map&&te.alphaTest>0){const ze=Q.uuid,Fe=te.uuid;let qe=p[ze];qe===void 0&&(qe={},p[ze]=qe);let et=qe[Fe];et===void 0&&(et=Q.clone(),qe[Fe]=et,te.addEventListener("dispose",Y)),Q=et}if(Q.visible=te.visible,Q.wireframe=te.wireframe,K===bu?Q.side=te.shadowSide!==null?te.shadowSide:te.side:Q.side=te.shadowSide!==null?te.shadowSide:_[te.side],Q.alphaMap=te.alphaMap,Q.alphaTest=te.alphaTest,Q.map=te.map,Q.clipShadows=te.clipShadows,Q.clippingPlanes=te.clippingPlanes,Q.clipIntersection=te.clipIntersection,Q.displacementMap=te.displacementMap,Q.displacementScale=te.displacementScale,Q.displacementBias=te.displacementBias,Q.wireframeLinewidth=te.wireframeLinewidth,Q.linewidth=te.linewidth,ce.isPointLight===!0&&Q.isMeshDistanceMaterial===!0){const ze=n.properties.get(Q);ze.light=ce}return Q}function H(ee,te,ce,K,Q){if(ee.visible===!1)return;if(ee.layers.test(te.layers)&&(ee.isMesh||ee.isLine||ee.isPoints)&&(ee.castShadow||ee.receiveShadow&&Q===bu)&&(!ee.frustumCulled||i.intersectsObject(ee))){ee.modelViewMatrix.multiplyMatrices(ce.matrixWorldInverse,ee.matrixWorld);const Fe=e.update(ee),qe=ee.material;if(Array.isArray(qe)){const et=Fe.groups;for(let Ne=0,st=et.length;Ne<st;Ne++){const Ee=et[Ne],ut=qe[Ee.materialIndex];if(ut&&ut.visible){const ot=z(ee,ut,K,Q);ee.onBeforeShadow(n,ee,te,ce,Fe,ot,Ee),n.renderBufferDirect(ce,null,Fe,ot,ee,Ee),ee.onAfterShadow(n,ee,te,ce,Fe,ot,Ee)}}}else if(qe.visible){const et=z(ee,qe,K,Q);ee.onBeforeShadow(n,ee,te,ce,Fe,et,null),n.renderBufferDirect(ce,null,Fe,et,ee,null),ee.onAfterShadow(n,ee,te,ce,Fe,et,null)}}const ze=ee.children;for(let Fe=0,qe=ze.length;Fe<qe;Fe++)H(ze[Fe],te,ce,K,Q)}function Y(ee){ee.target.removeEventListener("dispose",Y);for(const ce in p){const K=p[ce],Q=ee.target.uuid;Q in K&&(K[Q].dispose(),delete K[Q])}}}function Eie(n){function e(){let Ae=!1;const Lt=new _r;let gt=null;const ht=new _r(0,0,0,0);return{setMask:function(ae){gt!==ae&&!Ae&&(n.colorMask(ae,ae,ae,ae),gt=ae)},setLocked:function(ae){Ae=ae},setClear:function(ae,j,Z,ne,fe){fe===!0&&(ae*=ne,j*=ne,Z*=ne),Lt.set(ae,j,Z,ne),ht.equals(Lt)===!1&&(n.clearColor(ae,j,Z,ne),ht.copy(Lt))},reset:function(){Ae=!1,gt=null,ht.set(-1,0,0,0)}}}function t(){let Ae=!1,Lt=null,gt=null,ht=null;return{setTest:function(ae){ae?Et(n.DEPTH_TEST):It(n.DEPTH_TEST)},setMask:function(ae){Lt!==ae&&!Ae&&(n.depthMask(ae),Lt=ae)},setFunc:function(ae){if(gt!==ae){switch(ae){case NK:n.depthFunc(n.NEVER);break;case zK:n.depthFunc(n.ALWAYS);break;case BK:n.depthFunc(n.LESS);break;case xw:n.depthFunc(n.LEQUAL);break;case UK:n.depthFunc(n.EQUAL);break;case VK:n.depthFunc(n.GEQUAL);break;case GK:n.depthFunc(n.GREATER);break;case HK:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}gt=ae}},setLocked:function(ae){Ae=ae},setClear:function(ae){ht!==ae&&(n.clearDepth(ae),ht=ae)},reset:function(){Ae=!1,Lt=null,gt=null,ht=null}}}function i(){let Ae=!1,Lt=null,gt=null,ht=null,ae=null,j=null,Z=null,ne=null,fe=null;return{setTest:function(xe){Ae||(xe?Et(n.STENCIL_TEST):It(n.STENCIL_TEST))},setMask:function(xe){Lt!==xe&&!Ae&&(n.stencilMask(xe),Lt=xe)},setFunc:function(xe,Ie,ke){(gt!==xe||ht!==Ie||ae!==ke)&&(n.stencilFunc(xe,Ie,ke),gt=xe,ht=Ie,ae=ke)},setOp:function(xe,Ie,ke){(j!==xe||Z!==Ie||ne!==ke)&&(n.stencilOp(xe,Ie,ke),j=xe,Z=Ie,ne=ke)},setLocked:function(xe){Ae=xe},setClear:function(xe){fe!==xe&&(n.clearStencil(xe),fe=xe)},reset:function(){Ae=!1,Lt=null,gt=null,ht=null,ae=null,j=null,Z=null,ne=null,fe=null}}}const r=new e,s=new t,a=new i,o=new WeakMap,d=new WeakMap;let p={},g={},_=new WeakMap,w=[],T=null,I=!1,L=null,P=null,C=null,O=null,z=null,H=null,Y=null,ee=new ci(0,0,0),te=0,ce=!1,K=null,Q=null,pe=null,ze=null,Fe=null;const qe=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let et=!1,Ne=0;const st=n.getParameter(n.VERSION);st.indexOf("WebGL")!==-1?(Ne=parseFloat(/^WebGL (\d)/.exec(st)[1]),et=Ne>=1):st.indexOf("OpenGL ES")!==-1&&(Ne=parseFloat(/^OpenGL ES (\d)/.exec(st)[1]),et=Ne>=2);let Ee=null,ut={};const ot=n.getParameter(n.SCISSOR_BOX),dt=n.getParameter(n.VIEWPORT),Ct=new _r().fromArray(ot),Vt=new _r().fromArray(dt);function Re(Ae,Lt,gt,ht){const ae=new Uint8Array(4),j=n.createTexture();n.bindTexture(Ae,j),n.texParameteri(Ae,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(Ae,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let Z=0;Z<gt;Z++)Ae===n.TEXTURE_3D||Ae===n.TEXTURE_2D_ARRAY?n.texImage3D(Lt,0,n.RGBA,1,1,ht,0,n.RGBA,n.UNSIGNED_BYTE,ae):n.texImage2D(Lt+Z,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ae);return j}const mt={};mt[n.TEXTURE_2D]=Re(n.TEXTURE_2D,n.TEXTURE_2D,1),mt[n.TEXTURE_CUBE_MAP]=Re(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),mt[n.TEXTURE_2D_ARRAY]=Re(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),mt[n.TEXTURE_3D]=Re(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),s.setClear(1),a.setClear(0),Et(n.DEPTH_TEST),s.setFunc(xw),Vn(!1),Te(o3),Et(n.CULL_FACE),Jn(_d);function Et(Ae){p[Ae]!==!0&&(n.enable(Ae),p[Ae]=!0)}function It(Ae){p[Ae]!==!1&&(n.disable(Ae),p[Ae]=!1)}function vn(Ae,Lt){return g[Ae]!==Lt?(n.bindFramebuffer(Ae,Lt),g[Ae]=Lt,Ae===n.DRAW_FRAMEBUFFER&&(g[n.FRAMEBUFFER]=Lt),Ae===n.FRAMEBUFFER&&(g[n.DRAW_FRAMEBUFFER]=Lt),!0):!1}function xn(Ae,Lt){let gt=w,ht=!1;if(Ae){gt=_.get(Lt),gt===void 0&&(gt=[],_.set(Lt,gt));const ae=Ae.textures;if(gt.length!==ae.length||gt[0]!==n.COLOR_ATTACHMENT0){for(let j=0,Z=ae.length;j<Z;j++)gt[j]=n.COLOR_ATTACHMENT0+j;gt.length=ae.length,ht=!0}}else gt[0]!==n.BACK&&(gt[0]=n.BACK,ht=!0);ht&&n.drawBuffers(gt)}function at(Ae){return T!==Ae?(n.useProgram(Ae),T=Ae,!0):!1}const Rn={[gf]:n.FUNC_ADD,[xK]:n.FUNC_SUBTRACT,[wK]:n.FUNC_REVERSE_SUBTRACT};Rn[bK]=n.MIN,Rn[SK]=n.MAX;const Me={[MK]:n.ZERO,[EK]:n.ONE,[TK]:n.SRC_COLOR,[QT]:n.SRC_ALPHA,[LK]:n.SRC_ALPHA_SATURATE,[PK]:n.DST_COLOR,[AK]:n.DST_ALPHA,[CK]:n.ONE_MINUS_SRC_COLOR,[e2]:n.ONE_MINUS_SRC_ALPHA,[RK]:n.ONE_MINUS_DST_COLOR,[IK]:n.ONE_MINUS_DST_ALPHA,[DK]:n.CONSTANT_COLOR,[kK]:n.ONE_MINUS_CONSTANT_COLOR,[FK]:n.CONSTANT_ALPHA,[OK]:n.ONE_MINUS_CONSTANT_ALPHA};function Jn(Ae,Lt,gt,ht,ae,j,Z,ne,fe,xe){if(Ae===_d){I===!0&&(It(n.BLEND),I=!1);return}if(I===!1&&(Et(n.BLEND),I=!0),Ae!==vK){if(Ae!==L||xe!==ce){if((P!==gf||z!==gf)&&(n.blendEquation(n.FUNC_ADD),P=gf,z=gf),xe)switch(Ae){case Bm:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case a3:n.blendFunc(n.ONE,n.ONE);break;case l3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case c3:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae);break}else switch(Ae){case Bm:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case a3:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case l3:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case c3:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae);break}C=null,O=null,H=null,Y=null,ee.set(0,0,0),te=0,L=Ae,ce=xe}return}ae=ae||Lt,j=j||gt,Z=Z||ht,(Lt!==P||ae!==z)&&(n.blendEquationSeparate(Rn[Lt],Rn[ae]),P=Lt,z=ae),(gt!==C||ht!==O||j!==H||Z!==Y)&&(n.blendFuncSeparate(Me[gt],Me[ht],Me[j],Me[Z]),C=gt,O=ht,H=j,Y=Z),(ne.equals(ee)===!1||fe!==te)&&(n.blendColor(ne.r,ne.g,ne.b,fe),ee.copy(ne),te=fe),L=Ae,ce=!1}function on(Ae,Lt){Ae.side===Ec?It(n.CULL_FACE):Et(n.CULL_FACE);let gt=Ae.side===oa;Lt&&(gt=!gt),Vn(gt),Ae.blending===Bm&&Ae.transparent===!1?Jn(_d):Jn(Ae.blending,Ae.blendEquation,Ae.blendSrc,Ae.blendDst,Ae.blendEquationAlpha,Ae.blendSrcAlpha,Ae.blendDstAlpha,Ae.blendColor,Ae.blendAlpha,Ae.premultipliedAlpha),s.setFunc(Ae.depthFunc),s.setTest(Ae.depthTest),s.setMask(Ae.depthWrite),r.setMask(Ae.colorWrite);const ht=Ae.stencilWrite;a.setTest(ht),ht&&(a.setMask(Ae.stencilWriteMask),a.setFunc(Ae.stencilFunc,Ae.stencilRef,Ae.stencilFuncMask),a.setOp(Ae.stencilFail,Ae.stencilZFail,Ae.stencilZPass)),wn(Ae.polygonOffset,Ae.polygonOffsetFactor,Ae.polygonOffsetUnits),Ae.alphaToCoverage===!0?Et(n.SAMPLE_ALPHA_TO_COVERAGE):It(n.SAMPLE_ALPHA_TO_COVERAGE)}function Vn(Ae){K!==Ae&&(Ae?n.frontFace(n.CW):n.frontFace(n.CCW),K=Ae)}function Te(Ae){Ae!==gK?(Et(n.CULL_FACE),Ae!==Q&&(Ae===o3?n.cullFace(n.BACK):Ae===_K?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):It(n.CULL_FACE),Q=Ae}function jn(Ae){Ae!==pe&&(et&&n.lineWidth(Ae),pe=Ae)}function wn(Ae,Lt,gt){Ae?(Et(n.POLYGON_OFFSET_FILL),(ze!==Lt||Fe!==gt)&&(n.polygonOffset(Lt,gt),ze=Lt,Fe=gt)):It(n.POLYGON_OFFSET_FILL)}function jt(Ae){Ae?Et(n.SCISSOR_TEST):It(n.SCISSOR_TEST)}function me(Ae){Ae===void 0&&(Ae=n.TEXTURE0+qe-1),Ee!==Ae&&(n.activeTexture(Ae),Ee=Ae)}function le(Ae,Lt,gt){gt===void 0&&(Ee===null?gt=n.TEXTURE0+qe-1:gt=Ee);let ht=ut[gt];ht===void 0&&(ht={type:void 0,texture:void 0},ut[gt]=ht),(ht.type!==Ae||ht.texture!==Lt)&&(Ee!==gt&&(n.activeTexture(gt),Ee=gt),n.bindTexture(Ae,Lt||mt[Ae]),ht.type=Ae,ht.texture=Lt)}function tt(){const Ae=ut[Ee];Ae!==void 0&&Ae.type!==void 0&&(n.bindTexture(Ae.type,null),Ae.type=void 0,Ae.texture=void 0)}function xt(){try{n.compressedTexImage2D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function St(){try{n.compressedTexImage3D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function yt(){try{n.texSubImage2D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function hn(){try{n.texSubImage3D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function zt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function Je(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function cn(){try{n.texStorage2D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function At(){try{n.texStorage3D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function tn(){try{n.texImage2D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function Zn(){try{n.texImage3D.apply(n,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}}function lt(Ae){Ct.equals(Ae)===!1&&(n.scissor(Ae.x,Ae.y,Ae.z,Ae.w),Ct.copy(Ae))}function Mt(Ae){Vt.equals(Ae)===!1&&(n.viewport(Ae.x,Ae.y,Ae.z,Ae.w),Vt.copy(Ae))}function kt(Ae,Lt){let gt=d.get(Lt);gt===void 0&&(gt=new WeakMap,d.set(Lt,gt));let ht=gt.get(Ae);ht===void 0&&(ht=n.getUniformBlockIndex(Lt,Ae.name),gt.set(Ae,ht))}function In(Ae,Lt){const ht=d.get(Lt).get(Ae);o.get(Lt)!==ht&&(n.uniformBlockBinding(Lt,ht,Ae.__bindingPointIndex),o.set(Lt,ht))}function ii(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),p={},Ee=null,ut={},g={},_=new WeakMap,w=[],T=null,I=!1,L=null,P=null,C=null,O=null,z=null,H=null,Y=null,ee=new ci(0,0,0),te=0,ce=!1,K=null,Q=null,pe=null,ze=null,Fe=null,Ct.set(0,0,n.canvas.width,n.canvas.height),Vt.set(0,0,n.canvas.width,n.canvas.height),r.reset(),s.reset(),a.reset()}return{buffers:{color:r,depth:s,stencil:a},enable:Et,disable:It,bindFramebuffer:vn,drawBuffers:xn,useProgram:at,setBlending:Jn,setMaterial:on,setFlipSided:Vn,setCullFace:Te,setLineWidth:jn,setPolygonOffset:wn,setScissorTest:jt,activeTexture:me,bindTexture:le,unbindTexture:tt,compressedTexImage2D:xt,compressedTexImage3D:St,texImage2D:tn,texImage3D:Zn,updateUBOMapping:kt,uniformBlockBinding:In,texStorage2D:cn,texStorage3D:At,texSubImage2D:yt,texSubImage3D:hn,compressedTexSubImage2D:zt,compressedTexSubImage3D:Je,scissor:lt,viewport:Mt,reset:ii}}function sk(n,e,t,i){const r=Tie(i);switch(t){case bU:return n*e;case MU:return n*e;case EU:return n*e*2;case JA:return n*e/r.components*r.byteLength;case QA:return n*e/r.components*r.byteLength;case TU:return n*e*2/r.components*r.byteLength;case eI:return n*e*2/r.components*r.byteLength;case SU:return n*e*3/r.components*r.byteLength;case ol:return n*e*4/r.components*r.byteLength;case tI:return n*e*4/r.components*r.byteLength;case u1:case h1:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case d1:case f1:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case r2:case o2:return Math.max(n,16)*Math.max(e,8)/4;case i2:case s2:return Math.max(n,8)*Math.max(e,8)/2;case a2:case l2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case c2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case u2:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case h2:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case d2:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case f2:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case p2:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case m2:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case g2:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case _2:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case y2:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case v2:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case x2:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case w2:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case b2:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case S2:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case p1:case M2:case E2:return Math.ceil(n/4)*Math.ceil(e/4)*16;case CU:case T2:return Math.ceil(n/4)*Math.ceil(e/4)*8;case C2:case A2:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function Tie(n){switch(n){case Zu:case vU:return{byteLength:1,components:1};case v0:case xU:case j0:return{byteLength:2,components:1};case YA:case KA:return{byteLength:2,components:4};case Bf:case ZA:case Dl:return{byteLength:4,components:1};case wU:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}function Cie(n,e,t,i,r,s,a){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,d=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),p=new Mi,g=new WeakMap;let _;const w=new WeakMap;let T=!1;try{T=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function I(me,le){return T?new OffscreenCanvas(me,le):b0("canvas")}function L(me,le,tt){let xt=1;const St=jt(me);if((St.width>tt||St.height>tt)&&(xt=tt/Math.max(St.width,St.height)),xt<1)if(typeof HTMLImageElement<"u"&&me instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&me instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&me instanceof ImageBitmap||typeof VideoFrame<"u"&&me instanceof VideoFrame){const yt=Math.floor(xt*St.width),hn=Math.floor(xt*St.height);_===void 0&&(_=I(yt,hn));const zt=le?I(yt,hn):_;return zt.width=yt,zt.height=hn,zt.getContext("2d").drawImage(me,0,0,yt,hn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+St.width+"x"+St.height+") to ("+yt+"x"+hn+")."),zt}else return"data"in me&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+St.width+"x"+St.height+")."),me;return me}function P(me){return me.generateMipmaps&&me.minFilter!==Bo&&me.minFilter!==Ca}function C(me){n.generateMipmap(me)}function O(me,le,tt,xt,St=!1){if(me!==null){if(n[me]!==void 0)return n[me];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+me+"'")}let yt=le;if(le===n.RED&&(tt===n.FLOAT&&(yt=n.R32F),tt===n.HALF_FLOAT&&(yt=n.R16F),tt===n.UNSIGNED_BYTE&&(yt=n.R8)),le===n.RED_INTEGER&&(tt===n.UNSIGNED_BYTE&&(yt=n.R8UI),tt===n.UNSIGNED_SHORT&&(yt=n.R16UI),tt===n.UNSIGNED_INT&&(yt=n.R32UI),tt===n.BYTE&&(yt=n.R8I),tt===n.SHORT&&(yt=n.R16I),tt===n.INT&&(yt=n.R32I)),le===n.RG&&(tt===n.FLOAT&&(yt=n.RG32F),tt===n.HALF_FLOAT&&(yt=n.RG16F),tt===n.UNSIGNED_BYTE&&(yt=n.RG8)),le===n.RG_INTEGER&&(tt===n.UNSIGNED_BYTE&&(yt=n.RG8UI),tt===n.UNSIGNED_SHORT&&(yt=n.RG16UI),tt===n.UNSIGNED_INT&&(yt=n.RG32UI),tt===n.BYTE&&(yt=n.RG8I),tt===n.SHORT&&(yt=n.RG16I),tt===n.INT&&(yt=n.RG32I)),le===n.RGB&&tt===n.UNSIGNED_INT_5_9_9_9_REV&&(yt=n.RGB9_E5),le===n.RGBA){const hn=St?bw:$i.getTransfer(xt);tt===n.FLOAT&&(yt=n.RGBA32F),tt===n.HALF_FLOAT&&(yt=n.RGBA16F),tt===n.UNSIGNED_BYTE&&(yt=hn===Ir?n.SRGB8_ALPHA8:n.RGBA8),tt===n.UNSIGNED_SHORT_4_4_4_4&&(yt=n.RGBA4),tt===n.UNSIGNED_SHORT_5_5_5_1&&(yt=n.RGB5_A1)}return(yt===n.R16F||yt===n.R32F||yt===n.RG16F||yt===n.RG32F||yt===n.RGBA16F||yt===n.RGBA32F)&&e.get("EXT_color_buffer_float"),yt}function z(me,le){let tt;return me?le===null||le===Bf||le===ug?tt=n.DEPTH24_STENCIL8:le===Dl?tt=n.DEPTH32F_STENCIL8:le===v0&&(tt=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):le===null||le===Bf||le===ug?tt=n.DEPTH_COMPONENT24:le===Dl?tt=n.DEPTH_COMPONENT32F:le===v0&&(tt=n.DEPTH_COMPONENT16),tt}function H(me,le){return P(me)===!0||me.isFramebufferTexture&&me.minFilter!==Bo&&me.minFilter!==Ca?Math.log2(Math.max(le.width,le.height))+1:me.mipmaps!==void 0&&me.mipmaps.length>0?me.mipmaps.length:me.isCompressedTexture&&Array.isArray(me.image)?le.mipmaps.length:1}function Y(me){const le=me.target;le.removeEventListener("dispose",Y),te(le),le.isVideoTexture&&g.delete(le)}function ee(me){const le=me.target;le.removeEventListener("dispose",ee),K(le)}function te(me){const le=i.get(me);if(le.__webglInit===void 0)return;const tt=me.source,xt=w.get(tt);if(xt){const St=xt[le.__cacheKey];St.usedTimes--,St.usedTimes===0&&ce(me),Object.keys(xt).length===0&&w.delete(tt)}i.remove(me)}function ce(me){const le=i.get(me);n.deleteTexture(le.__webglTexture);const tt=me.source,xt=w.get(tt);delete xt[le.__cacheKey],a.memory.textures--}function K(me){const le=i.get(me);if(me.depthTexture&&me.depthTexture.dispose(),me.isWebGLCubeRenderTarget)for(let xt=0;xt<6;xt++){if(Array.isArray(le.__webglFramebuffer[xt]))for(let St=0;St<le.__webglFramebuffer[xt].length;St++)n.deleteFramebuffer(le.__webglFramebuffer[xt][St]);else n.deleteFramebuffer(le.__webglFramebuffer[xt]);le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer[xt])}else{if(Array.isArray(le.__webglFramebuffer))for(let xt=0;xt<le.__webglFramebuffer.length;xt++)n.deleteFramebuffer(le.__webglFramebuffer[xt]);else n.deleteFramebuffer(le.__webglFramebuffer);if(le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer),le.__webglMultisampledFramebuffer&&n.deleteFramebuffer(le.__webglMultisampledFramebuffer),le.__webglColorRenderbuffer)for(let xt=0;xt<le.__webglColorRenderbuffer.length;xt++)le.__webglColorRenderbuffer[xt]&&n.deleteRenderbuffer(le.__webglColorRenderbuffer[xt]);le.__webglDepthRenderbuffer&&n.deleteRenderbuffer(le.__webglDepthRenderbuffer)}const tt=me.textures;for(let xt=0,St=tt.length;xt<St;xt++){const yt=i.get(tt[xt]);yt.__webglTexture&&(n.deleteTexture(yt.__webglTexture),a.memory.textures--),i.remove(tt[xt])}i.remove(me)}let Q=0;function pe(){Q=0}function ze(){const me=Q;return me>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+me+" texture units while this GPU supports only "+r.maxTextures),Q+=1,me}function Fe(me){const le=[];return le.push(me.wrapS),le.push(me.wrapT),le.push(me.wrapR||0),le.push(me.magFilter),le.push(me.minFilter),le.push(me.anisotropy),le.push(me.internalFormat),le.push(me.format),le.push(me.type),le.push(me.generateMipmaps),le.push(me.premultiplyAlpha),le.push(me.flipY),le.push(me.unpackAlignment),le.push(me.colorSpace),le.join()}function qe(me,le){const tt=i.get(me);if(me.isVideoTexture&&jn(me),me.isRenderTargetTexture===!1&&me.version>0&&tt.__version!==me.version){const xt=me.image;if(xt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(xt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Vt(tt,me,le);return}}t.bindTexture(n.TEXTURE_2D,tt.__webglTexture,n.TEXTURE0+le)}function et(me,le){const tt=i.get(me);if(me.version>0&&tt.__version!==me.version){Vt(tt,me,le);return}t.bindTexture(n.TEXTURE_2D_ARRAY,tt.__webglTexture,n.TEXTURE0+le)}function Ne(me,le){const tt=i.get(me);if(me.version>0&&tt.__version!==me.version){Vt(tt,me,le);return}t.bindTexture(n.TEXTURE_3D,tt.__webglTexture,n.TEXTURE0+le)}function st(me,le){const tt=i.get(me);if(me.version>0&&tt.__version!==me.version){Re(tt,me,le);return}t.bindTexture(n.TEXTURE_CUBE_MAP,tt.__webglTexture,n.TEXTURE0+le)}const Ee={[cg]:n.REPEAT,[td]:n.CLAMP_TO_EDGE,[ww]:n.MIRRORED_REPEAT},ut={[Bo]:n.NEAREST,[yU]:n.NEAREST_MIPMAP_NEAREST,[ay]:n.NEAREST_MIPMAP_LINEAR,[Ca]:n.LINEAR,[c1]:n.LINEAR_MIPMAP_NEAREST,[Lu]:n.LINEAR_MIPMAP_LINEAR},ot={[sJ]:n.NEVER,[hJ]:n.ALWAYS,[oJ]:n.LESS,[PU]:n.LEQUAL,[aJ]:n.EQUAL,[uJ]:n.GEQUAL,[lJ]:n.GREATER,[cJ]:n.NOTEQUAL};function dt(me,le){if(le.type===Dl&&e.has("OES_texture_float_linear")===!1&&(le.magFilter===Ca||le.magFilter===c1||le.magFilter===ay||le.magFilter===Lu||le.minFilter===Ca||le.minFilter===c1||le.minFilter===ay||le.minFilter===Lu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(me,n.TEXTURE_WRAP_S,Ee[le.wrapS]),n.texParameteri(me,n.TEXTURE_WRAP_T,Ee[le.wrapT]),(me===n.TEXTURE_3D||me===n.TEXTURE_2D_ARRAY)&&n.texParameteri(me,n.TEXTURE_WRAP_R,Ee[le.wrapR]),n.texParameteri(me,n.TEXTURE_MAG_FILTER,ut[le.magFilter]),n.texParameteri(me,n.TEXTURE_MIN_FILTER,ut[le.minFilter]),le.compareFunction&&(n.texParameteri(me,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(me,n.TEXTURE_COMPARE_FUNC,ot[le.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(le.magFilter===Bo||le.minFilter!==ay&&le.minFilter!==Lu||le.type===Dl&&e.has("OES_texture_float_linear")===!1)return;if(le.anisotropy>1||i.get(le).__currentAnisotropy){const tt=e.get("EXT_texture_filter_anisotropic");n.texParameterf(me,tt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,r.getMaxAnisotropy())),i.get(le).__currentAnisotropy=le.anisotropy}}}function Ct(me,le){let tt=!1;me.__webglInit===void 0&&(me.__webglInit=!0,le.addEventListener("dispose",Y));const xt=le.source;let St=w.get(xt);St===void 0&&(St={},w.set(xt,St));const yt=Fe(le);if(yt!==me.__cacheKey){St[yt]===void 0&&(St[yt]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,tt=!0),St[yt].usedTimes++;const hn=St[me.__cacheKey];hn!==void 0&&(St[me.__cacheKey].usedTimes--,hn.usedTimes===0&&ce(le)),me.__cacheKey=yt,me.__webglTexture=St[yt].texture}return tt}function Vt(me,le,tt){let xt=n.TEXTURE_2D;(le.isDataArrayTexture||le.isCompressedArrayTexture)&&(xt=n.TEXTURE_2D_ARRAY),le.isData3DTexture&&(xt=n.TEXTURE_3D);const St=Ct(me,le),yt=le.source;t.bindTexture(xt,me.__webglTexture,n.TEXTURE0+tt);const hn=i.get(yt);if(yt.version!==hn.__version||St===!0){t.activeTexture(n.TEXTURE0+tt);const zt=$i.getPrimaries($i.workingColorSpace),Je=le.colorSpace===qh?null:$i.getPrimaries(le.colorSpace),cn=le.colorSpace===qh||zt===Je?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,cn);let At=L(le.image,!1,r.maxTextureSize);At=wn(le,At);const tn=s.convert(le.format,le.colorSpace),Zn=s.convert(le.type);let lt=O(le.internalFormat,tn,Zn,le.colorSpace,le.isVideoTexture);dt(xt,le);let Mt;const kt=le.mipmaps,In=le.isVideoTexture!==!0,ii=hn.__version===void 0||St===!0,Ae=yt.dataReady,Lt=H(le,At);if(le.isDepthTexture)lt=z(le.format===hg,le.type),ii&&(In?t.texStorage2D(n.TEXTURE_2D,1,lt,At.width,At.height):t.texImage2D(n.TEXTURE_2D,0,lt,At.width,At.height,0,tn,Zn,null));else if(le.isDataTexture)if(kt.length>0){In&&ii&&t.texStorage2D(n.TEXTURE_2D,Lt,lt,kt[0].width,kt[0].height);for(let gt=0,ht=kt.length;gt<ht;gt++)Mt=kt[gt],In?Ae&&t.texSubImage2D(n.TEXTURE_2D,gt,0,0,Mt.width,Mt.height,tn,Zn,Mt.data):t.texImage2D(n.TEXTURE_2D,gt,lt,Mt.width,Mt.height,0,tn,Zn,Mt.data);le.generateMipmaps=!1}else In?(ii&&t.texStorage2D(n.TEXTURE_2D,Lt,lt,At.width,At.height),Ae&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,At.width,At.height,tn,Zn,At.data)):t.texImage2D(n.TEXTURE_2D,0,lt,At.width,At.height,0,tn,Zn,At.data);else if(le.isCompressedTexture)if(le.isCompressedArrayTexture){In&&ii&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,lt,kt[0].width,kt[0].height,At.depth);for(let gt=0,ht=kt.length;gt<ht;gt++)if(Mt=kt[gt],le.format!==ol)if(tn!==null)if(In){if(Ae)if(le.layerUpdates.size>0){const ae=sk(Mt.width,Mt.height,le.format,le.type);for(const j of le.layerUpdates){const Z=Mt.data.subarray(j*ae/Mt.data.BYTES_PER_ELEMENT,(j+1)*ae/Mt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,gt,0,0,j,Mt.width,Mt.height,1,tn,Z,0,0)}le.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,gt,0,0,0,Mt.width,Mt.height,At.depth,tn,Mt.data,0,0)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,gt,lt,Mt.width,Mt.height,At.depth,0,Mt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else In?Ae&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,gt,0,0,0,Mt.width,Mt.height,At.depth,tn,Zn,Mt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,gt,lt,Mt.width,Mt.height,At.depth,0,tn,Zn,Mt.data)}else{In&&ii&&t.texStorage2D(n.TEXTURE_2D,Lt,lt,kt[0].width,kt[0].height);for(let gt=0,ht=kt.length;gt<ht;gt++)Mt=kt[gt],le.format!==ol?tn!==null?In?Ae&&t.compressedTexSubImage2D(n.TEXTURE_2D,gt,0,0,Mt.width,Mt.height,tn,Mt.data):t.compressedTexImage2D(n.TEXTURE_2D,gt,lt,Mt.width,Mt.height,0,Mt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):In?Ae&&t.texSubImage2D(n.TEXTURE_2D,gt,0,0,Mt.width,Mt.height,tn,Zn,Mt.data):t.texImage2D(n.TEXTURE_2D,gt,lt,Mt.width,Mt.height,0,tn,Zn,Mt.data)}else if(le.isDataArrayTexture)if(In){if(ii&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,lt,At.width,At.height,At.depth),Ae)if(le.layerUpdates.size>0){const gt=sk(At.width,At.height,le.format,le.type);for(const ht of le.layerUpdates){const ae=At.data.subarray(ht*gt/At.data.BYTES_PER_ELEMENT,(ht+1)*gt/At.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ht,At.width,At.height,1,tn,Zn,ae)}le.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,At.width,At.height,At.depth,tn,Zn,At.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,lt,At.width,At.height,At.depth,0,tn,Zn,At.data);else if(le.isData3DTexture)In?(ii&&t.texStorage3D(n.TEXTURE_3D,Lt,lt,At.width,At.height,At.depth),Ae&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,At.width,At.height,At.depth,tn,Zn,At.data)):t.texImage3D(n.TEXTURE_3D,0,lt,At.width,At.height,At.depth,0,tn,Zn,At.data);else if(le.isFramebufferTexture){if(ii)if(In)t.texStorage2D(n.TEXTURE_2D,Lt,lt,At.width,At.height);else{let gt=At.width,ht=At.height;for(let ae=0;ae<Lt;ae++)t.texImage2D(n.TEXTURE_2D,ae,lt,gt,ht,0,tn,Zn,null),gt>>=1,ht>>=1}}else if(kt.length>0){if(In&&ii){const gt=jt(kt[0]);t.texStorage2D(n.TEXTURE_2D,Lt,lt,gt.width,gt.height)}for(let gt=0,ht=kt.length;gt<ht;gt++)Mt=kt[gt],In?Ae&&t.texSubImage2D(n.TEXTURE_2D,gt,0,0,tn,Zn,Mt):t.texImage2D(n.TEXTURE_2D,gt,lt,tn,Zn,Mt);le.generateMipmaps=!1}else if(In){if(ii){const gt=jt(At);t.texStorage2D(n.TEXTURE_2D,Lt,lt,gt.width,gt.height)}Ae&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,tn,Zn,At)}else t.texImage2D(n.TEXTURE_2D,0,lt,tn,Zn,At);P(le)&&C(xt),hn.__version=yt.version,le.onUpdate&&le.onUpdate(le)}me.__version=le.version}function Re(me,le,tt){if(le.image.length!==6)return;const xt=Ct(me,le),St=le.source;t.bindTexture(n.TEXTURE_CUBE_MAP,me.__webglTexture,n.TEXTURE0+tt);const yt=i.get(St);if(St.version!==yt.__version||xt===!0){t.activeTexture(n.TEXTURE0+tt);const hn=$i.getPrimaries($i.workingColorSpace),zt=le.colorSpace===qh?null:$i.getPrimaries(le.colorSpace),Je=le.colorSpace===qh||hn===zt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Je);const cn=le.isCompressedTexture||le.image[0].isCompressedTexture,At=le.image[0]&&le.image[0].isDataTexture,tn=[];for(let ht=0;ht<6;ht++)!cn&&!At?tn[ht]=L(le.image[ht],!0,r.maxCubemapSize):tn[ht]=At?le.image[ht].image:le.image[ht],tn[ht]=wn(le,tn[ht]);const Zn=tn[0],lt=s.convert(le.format,le.colorSpace),Mt=s.convert(le.type),kt=O(le.internalFormat,lt,Mt,le.colorSpace),In=le.isVideoTexture!==!0,ii=yt.__version===void 0||xt===!0,Ae=St.dataReady;let Lt=H(le,Zn);dt(n.TEXTURE_CUBE_MAP,le);let gt;if(cn){In&&ii&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,kt,Zn.width,Zn.height);for(let ht=0;ht<6;ht++){gt=tn[ht].mipmaps;for(let ae=0;ae<gt.length;ae++){const j=gt[ae];le.format!==ol?lt!==null?In?Ae&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae,0,0,j.width,j.height,lt,j.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae,kt,j.width,j.height,0,j.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):In?Ae&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae,0,0,j.width,j.height,lt,Mt,j.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae,kt,j.width,j.height,0,lt,Mt,j.data)}}}else{if(gt=le.mipmaps,In&&ii){gt.length>0&&Lt++;const ht=jt(tn[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,kt,ht.width,ht.height)}for(let ht=0;ht<6;ht++)if(At){In?Ae&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,tn[ht].width,tn[ht].height,lt,Mt,tn[ht].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,kt,tn[ht].width,tn[ht].height,0,lt,Mt,tn[ht].data);for(let ae=0;ae<gt.length;ae++){const Z=gt[ae].image[ht].image;In?Ae&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae+1,0,0,Z.width,Z.height,lt,Mt,Z.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae+1,kt,Z.width,Z.height,0,lt,Mt,Z.data)}}else{In?Ae&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,0,0,lt,Mt,tn[ht]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,0,kt,lt,Mt,tn[ht]);for(let ae=0;ae<gt.length;ae++){const j=gt[ae];In?Ae&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae+1,0,0,lt,Mt,j.image[ht]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ht,ae+1,kt,lt,Mt,j.image[ht])}}}P(le)&&C(n.TEXTURE_CUBE_MAP),yt.__version=St.version,le.onUpdate&&le.onUpdate(le)}me.__version=le.version}function mt(me,le,tt,xt,St,yt){const hn=s.convert(tt.format,tt.colorSpace),zt=s.convert(tt.type),Je=O(tt.internalFormat,hn,zt,tt.colorSpace);if(!i.get(le).__hasExternalTextures){const At=Math.max(1,le.width>>yt),tn=Math.max(1,le.height>>yt);St===n.TEXTURE_3D||St===n.TEXTURE_2D_ARRAY?t.texImage3D(St,yt,Je,At,tn,le.depth,0,hn,zt,null):t.texImage2D(St,yt,Je,At,tn,0,hn,zt,null)}t.bindFramebuffer(n.FRAMEBUFFER,me),Te(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,xt,St,i.get(tt).__webglTexture,0,Vn(le)):(St===n.TEXTURE_2D||St>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&St<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,xt,St,i.get(tt).__webglTexture,yt),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Et(me,le,tt){if(n.bindRenderbuffer(n.RENDERBUFFER,me),le.depthBuffer){const xt=le.depthTexture,St=xt&&xt.isDepthTexture?xt.type:null,yt=z(le.stencilBuffer,St),hn=le.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,zt=Vn(le);Te(le)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,zt,yt,le.width,le.height):tt?n.renderbufferStorageMultisample(n.RENDERBUFFER,zt,yt,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,yt,le.width,le.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,hn,n.RENDERBUFFER,me)}else{const xt=le.textures;for(let St=0;St<xt.length;St++){const yt=xt[St],hn=s.convert(yt.format,yt.colorSpace),zt=s.convert(yt.type),Je=O(yt.internalFormat,hn,zt,yt.colorSpace),cn=Vn(le);tt&&Te(le)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,cn,Je,le.width,le.height):Te(le)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,cn,Je,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,Je,le.width,le.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function It(me,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,me),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(le.depthTexture).__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),qe(le.depthTexture,0);const xt=i.get(le.depthTexture).__webglTexture,St=Vn(le);if(le.depthTexture.format===Um)Te(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,xt,0,St):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,xt,0);else if(le.depthTexture.format===hg)Te(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,xt,0,St):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,xt,0);else throw new Error("Unknown depthTexture format")}function vn(me){const le=i.get(me),tt=me.isWebGLCubeRenderTarget===!0;if(me.depthTexture&&!le.__autoAllocateDepthBuffer){if(tt)throw new Error("target.depthTexture not supported in Cube render targets");It(le.__webglFramebuffer,me)}else if(tt){le.__webglDepthbuffer=[];for(let xt=0;xt<6;xt++)t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer[xt]),le.__webglDepthbuffer[xt]=n.createRenderbuffer(),Et(le.__webglDepthbuffer[xt],me,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer=n.createRenderbuffer(),Et(le.__webglDepthbuffer,me,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function xn(me,le,tt){const xt=i.get(me);le!==void 0&&mt(xt.__webglFramebuffer,me,me.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),tt!==void 0&&vn(me)}function at(me){const le=me.texture,tt=i.get(me),xt=i.get(le);me.addEventListener("dispose",ee);const St=me.textures,yt=me.isWebGLCubeRenderTarget===!0,hn=St.length>1;if(hn||(xt.__webglTexture===void 0&&(xt.__webglTexture=n.createTexture()),xt.__version=le.version,a.memory.textures++),yt){tt.__webglFramebuffer=[];for(let zt=0;zt<6;zt++)if(le.mipmaps&&le.mipmaps.length>0){tt.__webglFramebuffer[zt]=[];for(let Je=0;Je<le.mipmaps.length;Je++)tt.__webglFramebuffer[zt][Je]=n.createFramebuffer()}else tt.__webglFramebuffer[zt]=n.createFramebuffer()}else{if(le.mipmaps&&le.mipmaps.length>0){tt.__webglFramebuffer=[];for(let zt=0;zt<le.mipmaps.length;zt++)tt.__webglFramebuffer[zt]=n.createFramebuffer()}else tt.__webglFramebuffer=n.createFramebuffer();if(hn)for(let zt=0,Je=St.length;zt<Je;zt++){const cn=i.get(St[zt]);cn.__webglTexture===void 0&&(cn.__webglTexture=n.createTexture(),a.memory.textures++)}if(me.samples>0&&Te(me)===!1){tt.__webglMultisampledFramebuffer=n.createFramebuffer(),tt.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,tt.__webglMultisampledFramebuffer);for(let zt=0;zt<St.length;zt++){const Je=St[zt];tt.__webglColorRenderbuffer[zt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,tt.__webglColorRenderbuffer[zt]);const cn=s.convert(Je.format,Je.colorSpace),At=s.convert(Je.type),tn=O(Je.internalFormat,cn,At,Je.colorSpace,me.isXRRenderTarget===!0),Zn=Vn(me);n.renderbufferStorageMultisample(n.RENDERBUFFER,Zn,tn,me.width,me.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+zt,n.RENDERBUFFER,tt.__webglColorRenderbuffer[zt])}n.bindRenderbuffer(n.RENDERBUFFER,null),me.depthBuffer&&(tt.__webglDepthRenderbuffer=n.createRenderbuffer(),Et(tt.__webglDepthRenderbuffer,me,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(yt){t.bindTexture(n.TEXTURE_CUBE_MAP,xt.__webglTexture),dt(n.TEXTURE_CUBE_MAP,le);for(let zt=0;zt<6;zt++)if(le.mipmaps&&le.mipmaps.length>0)for(let Je=0;Je<le.mipmaps.length;Je++)mt(tt.__webglFramebuffer[zt][Je],me,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+zt,Je);else mt(tt.__webglFramebuffer[zt],me,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+zt,0);P(le)&&C(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(hn){for(let zt=0,Je=St.length;zt<Je;zt++){const cn=St[zt],At=i.get(cn);t.bindTexture(n.TEXTURE_2D,At.__webglTexture),dt(n.TEXTURE_2D,cn),mt(tt.__webglFramebuffer,me,cn,n.COLOR_ATTACHMENT0+zt,n.TEXTURE_2D,0),P(cn)&&C(n.TEXTURE_2D)}t.unbindTexture()}else{let zt=n.TEXTURE_2D;if((me.isWebGL3DRenderTarget||me.isWebGLArrayRenderTarget)&&(zt=me.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(zt,xt.__webglTexture),dt(zt,le),le.mipmaps&&le.mipmaps.length>0)for(let Je=0;Je<le.mipmaps.length;Je++)mt(tt.__webglFramebuffer[Je],me,le,n.COLOR_ATTACHMENT0,zt,Je);else mt(tt.__webglFramebuffer,me,le,n.COLOR_ATTACHMENT0,zt,0);P(le)&&C(zt),t.unbindTexture()}me.depthBuffer&&vn(me)}function Rn(me){const le=me.textures;for(let tt=0,xt=le.length;tt<xt;tt++){const St=le[tt];if(P(St)){const yt=me.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,hn=i.get(St).__webglTexture;t.bindTexture(yt,hn),C(yt),t.unbindTexture()}}}const Me=[],Jn=[];function on(me){if(me.samples>0){if(Te(me)===!1){const le=me.textures,tt=me.width,xt=me.height;let St=n.COLOR_BUFFER_BIT;const yt=me.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,hn=i.get(me),zt=le.length>1;if(zt)for(let Je=0;Je<le.length;Je++)t.bindFramebuffer(n.FRAMEBUFFER,hn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,hn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,hn.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,hn.__webglFramebuffer);for(let Je=0;Je<le.length;Je++){if(me.resolveDepthBuffer&&(me.depthBuffer&&(St|=n.DEPTH_BUFFER_BIT),me.stencilBuffer&&me.resolveStencilBuffer&&(St|=n.STENCIL_BUFFER_BIT)),zt){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,hn.__webglColorRenderbuffer[Je]);const cn=i.get(le[Je]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,cn,0)}n.blitFramebuffer(0,0,tt,xt,0,0,tt,xt,St,n.NEAREST),d===!0&&(Me.length=0,Jn.length=0,Me.push(n.COLOR_ATTACHMENT0+Je),me.depthBuffer&&me.resolveDepthBuffer===!1&&(Me.push(yt),Jn.push(yt),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Jn)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Me))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),zt)for(let Je=0;Je<le.length;Je++){t.bindFramebuffer(n.FRAMEBUFFER,hn.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,hn.__webglColorRenderbuffer[Je]);const cn=i.get(le[Je]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,hn.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,cn,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,hn.__webglMultisampledFramebuffer)}else if(me.depthBuffer&&me.resolveDepthBuffer===!1&&d){const le=me.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[le])}}}function Vn(me){return Math.min(r.maxSamples,me.samples)}function Te(me){const le=i.get(me);return me.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function jn(me){const le=a.render.frame;g.get(me)!==le&&(g.set(me,le),me.update())}function wn(me,le){const tt=me.colorSpace,xt=me.format,St=me.type;return me.isCompressedTexture===!0||me.isVideoTexture===!0||tt!==Ys&&tt!==qh&&($i.getTransfer(tt)===Ir?(xt!==ol||St!==Zu)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",tt)),le}function jt(me){return typeof HTMLImageElement<"u"&&me instanceof HTMLImageElement?(p.width=me.naturalWidth||me.width,p.height=me.naturalHeight||me.height):typeof VideoFrame<"u"&&me instanceof VideoFrame?(p.width=me.displayWidth,p.height=me.displayHeight):(p.width=me.width,p.height=me.height),p}this.allocateTextureUnit=ze,this.resetTextureUnits=pe,this.setTexture2D=qe,this.setTexture2DArray=et,this.setTexture3D=Ne,this.setTextureCube=st,this.rebindTextures=xn,this.setupRenderTarget=at,this.updateRenderTargetMipmap=Rn,this.updateMultisampleRenderTarget=on,this.setupDepthRenderbuffer=vn,this.setupFrameBufferTexture=mt,this.useMultisampledRTT=Te}function Aie(n,e){function t(i,r=qh){let s;const a=$i.getTransfer(r);if(i===Zu)return n.UNSIGNED_BYTE;if(i===YA)return n.UNSIGNED_SHORT_4_4_4_4;if(i===KA)return n.UNSIGNED_SHORT_5_5_5_1;if(i===wU)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===vU)return n.BYTE;if(i===xU)return n.SHORT;if(i===v0)return n.UNSIGNED_SHORT;if(i===ZA)return n.INT;if(i===Bf)return n.UNSIGNED_INT;if(i===Dl)return n.FLOAT;if(i===j0)return n.HALF_FLOAT;if(i===bU)return n.ALPHA;if(i===SU)return n.RGB;if(i===ol)return n.RGBA;if(i===MU)return n.LUMINANCE;if(i===EU)return n.LUMINANCE_ALPHA;if(i===Um)return n.DEPTH_COMPONENT;if(i===hg)return n.DEPTH_STENCIL;if(i===JA)return n.RED;if(i===QA)return n.RED_INTEGER;if(i===TU)return n.RG;if(i===eI)return n.RG_INTEGER;if(i===tI)return n.RGBA_INTEGER;if(i===u1||i===h1||i===d1||i===f1)if(a===Ir)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===u1)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===h1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===d1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===f1)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===u1)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===h1)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===d1)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===f1)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===i2||i===r2||i===s2||i===o2)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===i2)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===r2)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===s2)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===o2)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===a2||i===l2||i===c2)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===a2||i===l2)return a===Ir?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===c2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===u2||i===h2||i===d2||i===f2||i===p2||i===m2||i===g2||i===_2||i===y2||i===v2||i===x2||i===w2||i===b2||i===S2)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===u2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===h2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===d2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===f2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===p2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===m2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===g2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===_2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===y2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===v2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===x2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===w2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===b2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===S2)return a===Ir?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===p1||i===M2||i===E2)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===p1)return a===Ir?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===M2)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===E2)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===CU||i===T2||i===C2||i===A2)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===p1)return s.COMPRESSED_RED_RGTC1_EXT;if(i===T2)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===C2)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===A2)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ug?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class Iie extends Qo{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class Ef extends Hr{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Pie={type:"move"};class oE{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Ef,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Ef,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ye,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ye),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Ef,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ye,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ye),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,a=null;const o=this._targetRay,d=this._grip,p=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(p&&e.hand){a=!0;for(const L of e.hand.values()){const P=t.getJointPose(L,i),C=this._getHandJoint(p,L);P!==null&&(C.matrix.fromArray(P.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,C.jointRadius=P.radius),C.visible=P!==null}const g=p.joints["index-finger-tip"],_=p.joints["thumb-tip"],w=g.position.distanceTo(_.position),T=.02,I=.005;p.inputState.pinching&&w>T+I?(p.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!p.inputState.pinching&&w<=T-I&&(p.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else d!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(d.matrix.fromArray(s.transform.matrix),d.matrix.decompose(d.position,d.rotation,d.scale),d.matrixWorldNeedsUpdate=!0,s.linearVelocity?(d.hasLinearVelocity=!0,d.linearVelocity.copy(s.linearVelocity)):d.hasLinearVelocity=!1,s.angularVelocity?(d.hasAngularVelocity=!0,d.angularVelocity.copy(s.angularVelocity)):d.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Pie)))}return o!==null&&(o.visible=r!==null),d!==null&&(d.visible=s!==null),p!==null&&(p.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new Ef;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const Rie=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,Lie=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class Die{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new Fs,s=e.properties.get(r);s.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new Md({vertexShader:Rie,fragmentShader:Lie,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Pa(new Lb(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class kie extends Lg{constructor(e,t){super();const i=this;let r=null,s=1,a=null,o="local-floor",d=1,p=null,g=null,_=null,w=null,T=null,I=null;const L=new Die,P=t.getContextAttributes();let C=null,O=null;const z=[],H=[],Y=new Mi;let ee=null;const te=new Qo;te.layers.enable(1),te.viewport=new _r;const ce=new Qo;ce.layers.enable(2),ce.viewport=new _r;const K=[te,ce],Q=new Iie;Q.layers.enable(1),Q.layers.enable(2);let pe=null,ze=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Re){let mt=z[Re];return mt===void 0&&(mt=new oE,z[Re]=mt),mt.getTargetRaySpace()},this.getControllerGrip=function(Re){let mt=z[Re];return mt===void 0&&(mt=new oE,z[Re]=mt),mt.getGripSpace()},this.getHand=function(Re){let mt=z[Re];return mt===void 0&&(mt=new oE,z[Re]=mt),mt.getHandSpace()};function Fe(Re){const mt=H.indexOf(Re.inputSource);if(mt===-1)return;const Et=z[mt];Et!==void 0&&(Et.update(Re.inputSource,Re.frame,p||a),Et.dispatchEvent({type:Re.type,data:Re.inputSource}))}function qe(){r.removeEventListener("select",Fe),r.removeEventListener("selectstart",Fe),r.removeEventListener("selectend",Fe),r.removeEventListener("squeeze",Fe),r.removeEventListener("squeezestart",Fe),r.removeEventListener("squeezeend",Fe),r.removeEventListener("end",qe),r.removeEventListener("inputsourceschange",et);for(let Re=0;Re<z.length;Re++){const mt=H[Re];mt!==null&&(H[Re]=null,z[Re].disconnect(mt))}pe=null,ze=null,L.reset(),e.setRenderTarget(C),T=null,w=null,_=null,r=null,O=null,Vt.stop(),i.isPresenting=!1,e.setPixelRatio(ee),e.setSize(Y.width,Y.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Re){s=Re,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Re){o=Re,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return p||a},this.setReferenceSpace=function(Re){p=Re},this.getBaseLayer=function(){return w!==null?w:T},this.getBinding=function(){return _},this.getFrame=function(){return I},this.getSession=function(){return r},this.setSession=async function(Re){if(r=Re,r!==null){if(C=e.getRenderTarget(),r.addEventListener("select",Fe),r.addEventListener("selectstart",Fe),r.addEventListener("selectend",Fe),r.addEventListener("squeeze",Fe),r.addEventListener("squeezestart",Fe),r.addEventListener("squeezeend",Fe),r.addEventListener("end",qe),r.addEventListener("inputsourceschange",et),P.xrCompatible!==!0&&await t.makeXRCompatible(),ee=e.getPixelRatio(),e.getSize(Y),r.renderState.layers===void 0){const mt={antialias:P.antialias,alpha:!0,depth:P.depth,stencil:P.stencil,framebufferScaleFactor:s};T=new XRWebGLLayer(r,t,mt),r.updateRenderState({baseLayer:T}),e.setPixelRatio(1),e.setSize(T.framebufferWidth,T.framebufferHeight,!1),O=new Uf(T.framebufferWidth,T.framebufferHeight,{format:ol,type:Zu,colorSpace:e.outputColorSpace,stencilBuffer:P.stencil})}else{let mt=null,Et=null,It=null;P.depth&&(It=P.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,mt=P.stencil?hg:Um,Et=P.stencil?ug:Bf);const vn={colorFormat:t.RGBA8,depthFormat:It,scaleFactor:s};_=new XRWebGLBinding(r,t),w=_.createProjectionLayer(vn),r.updateRenderState({layers:[w]}),e.setPixelRatio(1),e.setSize(w.textureWidth,w.textureHeight,!1),O=new Uf(w.textureWidth,w.textureHeight,{format:ol,type:Zu,depthTexture:new VU(w.textureWidth,w.textureHeight,Et,void 0,void 0,void 0,void 0,void 0,void 0,mt),stencilBuffer:P.stencil,colorSpace:e.outputColorSpace,samples:P.antialias?4:0,resolveDepthBuffer:w.ignoreDepthValues===!1})}O.isXRRenderTarget=!0,this.setFoveation(d),p=null,a=await r.requestReferenceSpace(o),Vt.setContext(r),Vt.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return L.getDepthTexture()};function et(Re){for(let mt=0;mt<Re.removed.length;mt++){const Et=Re.removed[mt],It=H.indexOf(Et);It>=0&&(H[It]=null,z[It].disconnect(Et))}for(let mt=0;mt<Re.added.length;mt++){const Et=Re.added[mt];let It=H.indexOf(Et);if(It===-1){for(let xn=0;xn<z.length;xn++)if(xn>=H.length){H.push(Et),It=xn;break}else if(H[xn]===null){H[xn]=Et,It=xn;break}if(It===-1)break}const vn=z[It];vn&&vn.connect(Et)}}const Ne=new Ye,st=new Ye;function Ee(Re,mt,Et){Ne.setFromMatrixPosition(mt.matrixWorld),st.setFromMatrixPosition(Et.matrixWorld);const It=Ne.distanceTo(st),vn=mt.projectionMatrix.elements,xn=Et.projectionMatrix.elements,at=vn[14]/(vn[10]-1),Rn=vn[14]/(vn[10]+1),Me=(vn[9]+1)/vn[5],Jn=(vn[9]-1)/vn[5],on=(vn[8]-1)/vn[0],Vn=(xn[8]+1)/xn[0],Te=at*on,jn=at*Vn,wn=It/(-on+Vn),jt=wn*-on;mt.matrixWorld.decompose(Re.position,Re.quaternion,Re.scale),Re.translateX(jt),Re.translateZ(wn),Re.matrixWorld.compose(Re.position,Re.quaternion,Re.scale),Re.matrixWorldInverse.copy(Re.matrixWorld).invert();const me=at+wn,le=Rn+wn,tt=Te-jt,xt=jn+(It-jt),St=Me*Rn/le*me,yt=Jn*Rn/le*me;Re.projectionMatrix.makePerspective(tt,xt,St,yt,me,le),Re.projectionMatrixInverse.copy(Re.projectionMatrix).invert()}function ut(Re,mt){mt===null?Re.matrixWorld.copy(Re.matrix):Re.matrixWorld.multiplyMatrices(mt.matrixWorld,Re.matrix),Re.matrixWorldInverse.copy(Re.matrixWorld).invert()}this.updateCamera=function(Re){if(r===null)return;L.texture!==null&&(Re.near=L.depthNear,Re.far=L.depthFar),Q.near=ce.near=te.near=Re.near,Q.far=ce.far=te.far=Re.far,(pe!==Q.near||ze!==Q.far)&&(r.updateRenderState({depthNear:Q.near,depthFar:Q.far}),pe=Q.near,ze=Q.far,te.near=pe,te.far=ze,ce.near=pe,ce.far=ze,te.updateProjectionMatrix(),ce.updateProjectionMatrix(),Re.updateProjectionMatrix());const mt=Re.parent,Et=Q.cameras;ut(Q,mt);for(let It=0;It<Et.length;It++)ut(Et[It],mt);Et.length===2?Ee(Q,te,ce):Q.projectionMatrix.copy(te.projectionMatrix),ot(Re,Q,mt)};function ot(Re,mt,Et){Et===null?Re.matrix.copy(mt.matrixWorld):(Re.matrix.copy(Et.matrixWorld),Re.matrix.invert(),Re.matrix.multiply(mt.matrixWorld)),Re.matrix.decompose(Re.position,Re.quaternion,Re.scale),Re.updateMatrixWorld(!0),Re.projectionMatrix.copy(mt.projectionMatrix),Re.projectionMatrixInverse.copy(mt.projectionMatrixInverse),Re.isPerspectiveCamera&&(Re.fov=dg*2*Math.atan(1/Re.projectionMatrix.elements[5]),Re.zoom=1)}this.getCamera=function(){return Q},this.getFoveation=function(){if(!(w===null&&T===null))return d},this.setFoveation=function(Re){d=Re,w!==null&&(w.fixedFoveation=Re),T!==null&&T.fixedFoveation!==void 0&&(T.fixedFoveation=Re)},this.hasDepthSensing=function(){return L.texture!==null},this.getDepthSensingMesh=function(){return L.getMesh(Q)};let dt=null;function Ct(Re,mt){if(g=mt.getViewerPose(p||a),I=mt,g!==null){const Et=g.views;T!==null&&(e.setRenderTargetFramebuffer(O,T.framebuffer),e.setRenderTarget(O));let It=!1;Et.length!==Q.cameras.length&&(Q.cameras.length=0,It=!0);for(let xn=0;xn<Et.length;xn++){const at=Et[xn];let Rn=null;if(T!==null)Rn=T.getViewport(at);else{const Jn=_.getViewSubImage(w,at);Rn=Jn.viewport,xn===0&&(e.setRenderTargetTextures(O,Jn.colorTexture,w.ignoreDepthValues?void 0:Jn.depthStencilTexture),e.setRenderTarget(O))}let Me=K[xn];Me===void 0&&(Me=new Qo,Me.layers.enable(xn),Me.viewport=new _r,K[xn]=Me),Me.matrix.fromArray(at.transform.matrix),Me.matrix.decompose(Me.position,Me.quaternion,Me.scale),Me.projectionMatrix.fromArray(at.projectionMatrix),Me.projectionMatrixInverse.copy(Me.projectionMatrix).invert(),Me.viewport.set(Rn.x,Rn.y,Rn.width,Rn.height),xn===0&&(Q.matrix.copy(Me.matrix),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale)),It===!0&&Q.cameras.push(Me)}const vn=r.enabledFeatures;if(vn&&vn.includes("depth-sensing")){const xn=_.getDepthInformation(Et[0]);xn&&xn.isValid&&xn.texture&&L.init(e,xn,r.renderState)}}for(let Et=0;Et<z.length;Et++){const It=H[Et],vn=z[Et];It!==null&&vn!==void 0&&vn.update(It,mt,p||a)}dt&&dt(Re,mt),mt.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:mt}),I=null}const Vt=new UU;Vt.setAnimationLoop(Ct),this.setAnimationLoop=function(Re){dt=Re},this.dispose=function(){}}}const cf=new zc,Fie=new ui;function Oie(n,e){function t(P,C){P.matrixAutoUpdate===!0&&P.updateMatrix(),C.value.copy(P.matrix)}function i(P,C){C.color.getRGB(P.fogColor.value,zU(n)),C.isFog?(P.fogNear.value=C.near,P.fogFar.value=C.far):C.isFogExp2&&(P.fogDensity.value=C.density)}function r(P,C,O,z,H){C.isMeshBasicMaterial||C.isMeshLambertMaterial?s(P,C):C.isMeshToonMaterial?(s(P,C),_(P,C)):C.isMeshPhongMaterial?(s(P,C),g(P,C)):C.isMeshStandardMaterial?(s(P,C),w(P,C),C.isMeshPhysicalMaterial&&T(P,C,H)):C.isMeshMatcapMaterial?(s(P,C),I(P,C)):C.isMeshDepthMaterial?s(P,C):C.isMeshDistanceMaterial?(s(P,C),L(P,C)):C.isMeshNormalMaterial?s(P,C):C.isLineBasicMaterial?(a(P,C),C.isLineDashedMaterial&&o(P,C)):C.isPointsMaterial?d(P,C,O,z):C.isSpriteMaterial?p(P,C):C.isShadowMaterial?(P.color.value.copy(C.color),P.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function s(P,C){P.opacity.value=C.opacity,C.color&&P.diffuse.value.copy(C.color),C.emissive&&P.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(P.map.value=C.map,t(C.map,P.mapTransform)),C.alphaMap&&(P.alphaMap.value=C.alphaMap,t(C.alphaMap,P.alphaMapTransform)),C.bumpMap&&(P.bumpMap.value=C.bumpMap,t(C.bumpMap,P.bumpMapTransform),P.bumpScale.value=C.bumpScale,C.side===oa&&(P.bumpScale.value*=-1)),C.normalMap&&(P.normalMap.value=C.normalMap,t(C.normalMap,P.normalMapTransform),P.normalScale.value.copy(C.normalScale),C.side===oa&&P.normalScale.value.negate()),C.displacementMap&&(P.displacementMap.value=C.displacementMap,t(C.displacementMap,P.displacementMapTransform),P.displacementScale.value=C.displacementScale,P.displacementBias.value=C.displacementBias),C.emissiveMap&&(P.emissiveMap.value=C.emissiveMap,t(C.emissiveMap,P.emissiveMapTransform)),C.specularMap&&(P.specularMap.value=C.specularMap,t(C.specularMap,P.specularMapTransform)),C.alphaTest>0&&(P.alphaTest.value=C.alphaTest);const O=e.get(C),z=O.envMap,H=O.envMapRotation;z&&(P.envMap.value=z,cf.copy(H),cf.x*=-1,cf.y*=-1,cf.z*=-1,z.isCubeTexture&&z.isRenderTargetTexture===!1&&(cf.y*=-1,cf.z*=-1),P.envMapRotation.value.setFromMatrix4(Fie.makeRotationFromEuler(cf)),P.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,P.reflectivity.value=C.reflectivity,P.ior.value=C.ior,P.refractionRatio.value=C.refractionRatio),C.lightMap&&(P.lightMap.value=C.lightMap,P.lightMapIntensity.value=C.lightMapIntensity,t(C.lightMap,P.lightMapTransform)),C.aoMap&&(P.aoMap.value=C.aoMap,P.aoMapIntensity.value=C.aoMapIntensity,t(C.aoMap,P.aoMapTransform))}function a(P,C){P.diffuse.value.copy(C.color),P.opacity.value=C.opacity,C.map&&(P.map.value=C.map,t(C.map,P.mapTransform))}function o(P,C){P.dashSize.value=C.dashSize,P.totalSize.value=C.dashSize+C.gapSize,P.scale.value=C.scale}function d(P,C,O,z){P.diffuse.value.copy(C.color),P.opacity.value=C.opacity,P.size.value=C.size*O,P.scale.value=z*.5,C.map&&(P.map.value=C.map,t(C.map,P.uvTransform)),C.alphaMap&&(P.alphaMap.value=C.alphaMap,t(C.alphaMap,P.alphaMapTransform)),C.alphaTest>0&&(P.alphaTest.value=C.alphaTest)}function p(P,C){P.diffuse.value.copy(C.color),P.opacity.value=C.opacity,P.rotation.value=C.rotation,C.map&&(P.map.value=C.map,t(C.map,P.mapTransform)),C.alphaMap&&(P.alphaMap.value=C.alphaMap,t(C.alphaMap,P.alphaMapTransform)),C.alphaTest>0&&(P.alphaTest.value=C.alphaTest)}function g(P,C){P.specular.value.copy(C.specular),P.shininess.value=Math.max(C.shininess,1e-4)}function _(P,C){C.gradientMap&&(P.gradientMap.value=C.gradientMap)}function w(P,C){P.metalness.value=C.metalness,C.metalnessMap&&(P.metalnessMap.value=C.metalnessMap,t(C.metalnessMap,P.metalnessMapTransform)),P.roughness.value=C.roughness,C.roughnessMap&&(P.roughnessMap.value=C.roughnessMap,t(C.roughnessMap,P.roughnessMapTransform)),C.envMap&&(P.envMapIntensity.value=C.envMapIntensity)}function T(P,C,O){P.ior.value=C.ior,C.sheen>0&&(P.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),P.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(P.sheenColorMap.value=C.sheenColorMap,t(C.sheenColorMap,P.sheenColorMapTransform)),C.sheenRoughnessMap&&(P.sheenRoughnessMap.value=C.sheenRoughnessMap,t(C.sheenRoughnessMap,P.sheenRoughnessMapTransform))),C.clearcoat>0&&(P.clearcoat.value=C.clearcoat,P.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(P.clearcoatMap.value=C.clearcoatMap,t(C.clearcoatMap,P.clearcoatMapTransform)),C.clearcoatRoughnessMap&&(P.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap,t(C.clearcoatRoughnessMap,P.clearcoatRoughnessMapTransform)),C.clearcoatNormalMap&&(P.clearcoatNormalMap.value=C.clearcoatNormalMap,t(C.clearcoatNormalMap,P.clearcoatNormalMapTransform),P.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),C.side===oa&&P.clearcoatNormalScale.value.negate())),C.dispersion>0&&(P.dispersion.value=C.dispersion),C.iridescence>0&&(P.iridescence.value=C.iridescence,P.iridescenceIOR.value=C.iridescenceIOR,P.iridescenceThicknessMinimum.value=C.iridescenceThicknessRange[0],P.iridescenceThicknessMaximum.value=C.iridescenceThicknessRange[1],C.iridescenceMap&&(P.iridescenceMap.value=C.iridescenceMap,t(C.iridescenceMap,P.iridescenceMapTransform)),C.iridescenceThicknessMap&&(P.iridescenceThicknessMap.value=C.iridescenceThicknessMap,t(C.iridescenceThicknessMap,P.iridescenceThicknessMapTransform))),C.transmission>0&&(P.transmission.value=C.transmission,P.transmissionSamplerMap.value=O.texture,P.transmissionSamplerSize.value.set(O.width,O.height),C.transmissionMap&&(P.transmissionMap.value=C.transmissionMap,t(C.transmissionMap,P.transmissionMapTransform)),P.thickness.value=C.thickness,C.thicknessMap&&(P.thicknessMap.value=C.thicknessMap,t(C.thicknessMap,P.thicknessMapTransform)),P.attenuationDistance.value=C.attenuationDistance,P.attenuationColor.value.copy(C.attenuationColor)),C.anisotropy>0&&(P.anisotropyVector.value.set(C.anisotropy*Math.cos(C.anisotropyRotation),C.anisotropy*Math.sin(C.anisotropyRotation)),C.anisotropyMap&&(P.anisotropyMap.value=C.anisotropyMap,t(C.anisotropyMap,P.anisotropyMapTransform))),P.specularIntensity.value=C.specularIntensity,P.specularColor.value.copy(C.specularColor),C.specularColorMap&&(P.specularColorMap.value=C.specularColorMap,t(C.specularColorMap,P.specularColorMapTransform)),C.specularIntensityMap&&(P.specularIntensityMap.value=C.specularIntensityMap,t(C.specularIntensityMap,P.specularIntensityMapTransform))}function I(P,C){C.matcap&&(P.matcap.value=C.matcap)}function L(P,C){const O=e.get(C).light;P.referencePosition.value.setFromMatrixPosition(O.matrixWorld),P.nearDistance.value=O.shadow.camera.near,P.farDistance.value=O.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function Nie(n,e,t,i){let r={},s={},a=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function d(O,z){const H=z.program;i.uniformBlockBinding(O,H)}function p(O,z){let H=r[O.id];H===void 0&&(I(O),H=g(O),r[O.id]=H,O.addEventListener("dispose",P));const Y=z.program;i.updateUBOMapping(O,Y);const ee=e.render.frame;s[O.id]!==ee&&(w(O),s[O.id]=ee)}function g(O){const z=_();O.__bindingPointIndex=z;const H=n.createBuffer(),Y=O.__size,ee=O.usage;return n.bindBuffer(n.UNIFORM_BUFFER,H),n.bufferData(n.UNIFORM_BUFFER,Y,ee),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,z,H),H}function _(){for(let O=0;O<o;O++)if(a.indexOf(O)===-1)return a.push(O),O;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function w(O){const z=r[O.id],H=O.uniforms,Y=O.__cache;n.bindBuffer(n.UNIFORM_BUFFER,z);for(let ee=0,te=H.length;ee<te;ee++){const ce=Array.isArray(H[ee])?H[ee]:[H[ee]];for(let K=0,Q=ce.length;K<Q;K++){const pe=ce[K];if(T(pe,ee,K,Y)===!0){const ze=pe.__offset,Fe=Array.isArray(pe.value)?pe.value:[pe.value];let qe=0;for(let et=0;et<Fe.length;et++){const Ne=Fe[et],st=L(Ne);typeof Ne=="number"||typeof Ne=="boolean"?(pe.__data[0]=Ne,n.bufferSubData(n.UNIFORM_BUFFER,ze+qe,pe.__data)):Ne.isMatrix3?(pe.__data[0]=Ne.elements[0],pe.__data[1]=Ne.elements[1],pe.__data[2]=Ne.elements[2],pe.__data[3]=0,pe.__data[4]=Ne.elements[3],pe.__data[5]=Ne.elements[4],pe.__data[6]=Ne.elements[5],pe.__data[7]=0,pe.__data[8]=Ne.elements[6],pe.__data[9]=Ne.elements[7],pe.__data[10]=Ne.elements[8],pe.__data[11]=0):(Ne.toArray(pe.__data,qe),qe+=st.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,ze,pe.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function T(O,z,H,Y){const ee=O.value,te=z+"_"+H;if(Y[te]===void 0)return typeof ee=="number"||typeof ee=="boolean"?Y[te]=ee:Y[te]=ee.clone(),!0;{const ce=Y[te];if(typeof ee=="number"||typeof ee=="boolean"){if(ce!==ee)return Y[te]=ee,!0}else if(ce.equals(ee)===!1)return ce.copy(ee),!0}return!1}function I(O){const z=O.uniforms;let H=0;const Y=16;for(let te=0,ce=z.length;te<ce;te++){const K=Array.isArray(z[te])?z[te]:[z[te]];for(let Q=0,pe=K.length;Q<pe;Q++){const ze=K[Q],Fe=Array.isArray(ze.value)?ze.value:[ze.value];for(let qe=0,et=Fe.length;qe<et;qe++){const Ne=Fe[qe],st=L(Ne),Ee=H%Y;Ee!==0&&Y-Ee<st.boundary&&(H+=Y-Ee),ze.__data=new Float32Array(st.storage/Float32Array.BYTES_PER_ELEMENT),ze.__offset=H,H+=st.storage}}}const ee=H%Y;return ee>0&&(H+=Y-ee),O.__size=H,O.__cache={},this}function L(O){const z={boundary:0,storage:0};return typeof O=="number"||typeof O=="boolean"?(z.boundary=4,z.storage=4):O.isVector2?(z.boundary=8,z.storage=8):O.isVector3||O.isColor?(z.boundary=16,z.storage=12):O.isVector4?(z.boundary=16,z.storage=16):O.isMatrix3?(z.boundary=48,z.storage=48):O.isMatrix4?(z.boundary=64,z.storage=64):O.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",O),z}function P(O){const z=O.target;z.removeEventListener("dispose",P);const H=a.indexOf(z.__bindingPointIndex);a.splice(H,1),n.deleteBuffer(r[z.id]),delete r[z.id],delete s[z.id]}function C(){for(const O in r)n.deleteBuffer(r[O]);a=[],r={},s={}}return{bind:d,update:p,dispose:C}}class zie{constructor(e={}){const{canvas:t=IJ(),context:i=null,depth:r=!0,stencil:s=!1,alpha:a=!1,antialias:o=!1,premultipliedAlpha:d=!0,preserveDrawingBuffer:p=!1,powerPreference:g="default",failIfMajorPerformanceCaveat:_=!1}=e;this.isWebGLRenderer=!0;let w;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");w=i.getContextAttributes().alpha}else w=a;const T=new Uint32Array(4),I=new Int32Array(4);let L=null,P=null;const C=[],O=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Oo,this.toneMapping=yd,this.toneMappingExposure=1;const z=this;let H=!1,Y=0,ee=0,te=null,ce=-1,K=null;const Q=new _r,pe=new _r;let ze=null;const Fe=new ci(0);let qe=0,et=t.width,Ne=t.height,st=1,Ee=null,ut=null;const ot=new _r(0,0,et,Ne),dt=new _r(0,0,et,Ne);let Ct=!1;const Vt=new oI;let Re=!1,mt=!1;const Et=new ui,It=new Ye,vn=new _r,xn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let at=!1;function Rn(){return te===null?st:1}let Me=i;function Jn(oe,Be){return t.getContext(oe,Be)}try{const oe={alpha:!0,depth:r,stencil:s,antialias:o,premultipliedAlpha:d,preserveDrawingBuffer:p,powerPreference:g,failIfMajorPerformanceCaveat:_};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${XA}`),t.addEventListener("webglcontextlost",gt,!1),t.addEventListener("webglcontextrestored",ht,!1),t.addEventListener("webglcontextcreationerror",ae,!1),Me===null){const Be="webgl2";if(Me=Jn(Be,oe),Me===null)throw Jn(Be)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(oe){throw console.error("THREE.WebGLRenderer: "+oe.message),oe}let on,Vn,Te,jn,wn,jt,me,le,tt,xt,St,yt,hn,zt,Je,cn,At,tn,Zn,lt,Mt,kt,In,ii;function Ae(){on=new jte(Me),on.init(),kt=new Aie(Me,on),Vn=new Bte(Me,on,e,kt),Te=new Eie(Me),jn=new Xte(Me),wn=new hie,jt=new Cie(Me,on,Te,wn,Vn,kt,jn),me=new Vte(z),le=new Wte(z),tt=new tQ(Me),In=new Nte(Me,tt),xt=new $te(Me,tt,jn,In),St=new Yte(Me,xt,tt,jn),Zn=new Zte(Me,Vn,jt),cn=new Ute(wn),yt=new uie(z,me,le,on,Vn,In,cn),hn=new Oie(z,wn),zt=new fie,Je=new vie(on),tn=new Ote(z,me,le,Te,St,w,d),At=new Mie(z,St,Vn),ii=new Nie(Me,jn,Vn,Te),lt=new zte(Me,on,jn),Mt=new qte(Me,on,jn),jn.programs=yt.programs,z.capabilities=Vn,z.extensions=on,z.properties=wn,z.renderLists=zt,z.shadowMap=At,z.state=Te,z.info=jn}Ae();const Lt=new kie(z,Me);this.xr=Lt,this.getContext=function(){return Me},this.getContextAttributes=function(){return Me.getContextAttributes()},this.forceContextLoss=function(){const oe=on.get("WEBGL_lose_context");oe&&oe.loseContext()},this.forceContextRestore=function(){const oe=on.get("WEBGL_lose_context");oe&&oe.restoreContext()},this.getPixelRatio=function(){return st},this.setPixelRatio=function(oe){oe!==void 0&&(st=oe,this.setSize(et,Ne,!1))},this.getSize=function(oe){return oe.set(et,Ne)},this.setSize=function(oe,Be,Qe=!0){if(Lt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}et=oe,Ne=Be,t.width=Math.floor(oe*st),t.height=Math.floor(Be*st),Qe===!0&&(t.style.width=oe+"px",t.style.height=Be+"px"),this.setViewport(0,0,oe,Be)},this.getDrawingBufferSize=function(oe){return oe.set(et*st,Ne*st).floor()},this.setDrawingBufferSize=function(oe,Be,Qe){et=oe,Ne=Be,st=Qe,t.width=Math.floor(oe*Qe),t.height=Math.floor(Be*Qe),this.setViewport(0,0,oe,Be)},this.getCurrentViewport=function(oe){return oe.copy(Q)},this.getViewport=function(oe){return oe.copy(ot)},this.setViewport=function(oe,Be,Qe,it){oe.isVector4?ot.set(oe.x,oe.y,oe.z,oe.w):ot.set(oe,Be,Qe,it),Te.viewport(Q.copy(ot).multiplyScalar(st).round())},this.getScissor=function(oe){return oe.copy(dt)},this.setScissor=function(oe,Be,Qe,it){oe.isVector4?dt.set(oe.x,oe.y,oe.z,oe.w):dt.set(oe,Be,Qe,it),Te.scissor(pe.copy(dt).multiplyScalar(st).round())},this.getScissorTest=function(){return Ct},this.setScissorTest=function(oe){Te.setScissorTest(Ct=oe)},this.setOpaqueSort=function(oe){Ee=oe},this.setTransparentSort=function(oe){ut=oe},this.getClearColor=function(oe){return oe.copy(tn.getClearColor())},this.setClearColor=function(){tn.setClearColor.apply(tn,arguments)},this.getClearAlpha=function(){return tn.getClearAlpha()},this.setClearAlpha=function(){tn.setClearAlpha.apply(tn,arguments)},this.clear=function(oe=!0,Be=!0,Qe=!0){let it=0;if(oe){let $e=!1;if(te!==null){const Pt=te.texture.format;$e=Pt===tI||Pt===eI||Pt===QA}if($e){const Pt=te.texture.type,rn=Pt===Zu||Pt===Bf||Pt===v0||Pt===ug||Pt===YA||Pt===KA,Cn=tn.getClearColor(),Ft=tn.getClearAlpha(),zn=Cn.r,Un=Cn.g,Zt=Cn.b;rn?(T[0]=zn,T[1]=Un,T[2]=Zt,T[3]=Ft,Me.clearBufferuiv(Me.COLOR,0,T)):(I[0]=zn,I[1]=Un,I[2]=Zt,I[3]=Ft,Me.clearBufferiv(Me.COLOR,0,I))}else it|=Me.COLOR_BUFFER_BIT}Be&&(it|=Me.DEPTH_BUFFER_BIT),Qe&&(it|=Me.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Me.clear(it)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",gt,!1),t.removeEventListener("webglcontextrestored",ht,!1),t.removeEventListener("webglcontextcreationerror",ae,!1),zt.dispose(),Je.dispose(),wn.dispose(),me.dispose(),le.dispose(),St.dispose(),In.dispose(),ii.dispose(),yt.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",ke),Lt.removeEventListener("sessionend",Se),Ue.stop()};function gt(oe){oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),H=!0}function ht(){console.log("THREE.WebGLRenderer: Context Restored."),H=!1;const oe=jn.autoReset,Be=At.enabled,Qe=At.autoUpdate,it=At.needsUpdate,$e=At.type;Ae(),jn.autoReset=oe,At.enabled=Be,At.autoUpdate=Qe,At.needsUpdate=it,At.type=$e}function ae(oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",oe.statusMessage)}function j(oe){const Be=oe.target;Be.removeEventListener("dispose",j),Z(Be)}function Z(oe){ne(oe),wn.remove(oe)}function ne(oe){const Be=wn.get(oe).programs;Be!==void 0&&(Be.forEach(function(Qe){yt.releaseProgram(Qe)}),oe.isShaderMaterial&&yt.releaseShaderCache(oe))}this.renderBufferDirect=function(oe,Be,Qe,it,$e,Pt){Be===null&&(Be=xn);const rn=$e.isMesh&&$e.matrixWorld.determinant()<0,Cn=wi(oe,Be,Qe,it,$e);Te.setMaterial(it,rn);let Ft=Qe.index,zn=1;if(it.wireframe===!0){if(Ft=xt.getWireframeAttribute(Qe),Ft===void 0)return;zn=2}const Un=Qe.drawRange,Zt=Qe.attributes.position;let Kn=Un.start*zn,ki=(Un.start+Un.count)*zn;Pt!==null&&(Kn=Math.max(Kn,Pt.start*zn),ki=Math.min(ki,(Pt.start+Pt.count)*zn)),Ft!==null?(Kn=Math.max(Kn,0),ki=Math.min(ki,Ft.count)):Zt!=null&&(Kn=Math.max(Kn,0),ki=Math.min(ki,Zt.count));const Qn=ki-Kn;if(Qn<0||Qn===1/0)return;In.setup($e,it,Cn,Qe,Ft);let vi,pi=lt;if(Ft!==null&&(vi=tt.get(Ft),pi=Mt,pi.setIndex(vi)),$e.isMesh)it.wireframe===!0?(Te.setLineWidth(it.wireframeLinewidth*Rn()),pi.setMode(Me.LINES)):pi.setMode(Me.TRIANGLES);else if($e.isLine){let pn=it.linewidth;pn===void 0&&(pn=1),Te.setLineWidth(pn*Rn()),$e.isLineSegments?pi.setMode(Me.LINES):$e.isLineLoop?pi.setMode(Me.LINE_LOOP):pi.setMode(Me.LINE_STRIP)}else $e.isPoints?pi.setMode(Me.POINTS):$e.isSprite&&pi.setMode(Me.TRIANGLES);if($e.isBatchedMesh)if($e._multiDrawInstances!==null)pi.renderMultiDrawInstances($e._multiDrawStarts,$e._multiDrawCounts,$e._multiDrawCount,$e._multiDrawInstances);else if(on.get("WEBGL_multi_draw"))pi.renderMultiDraw($e._multiDrawStarts,$e._multiDrawCounts,$e._multiDrawCount);else{const pn=$e._multiDrawStarts,ei=$e._multiDrawCounts,hi=$e._multiDrawCount,Or=Ft?tt.get(Ft).bytesPerElement:1,Fi=wn.get(it).currentProgram.getUniforms();for(let br=0;br<hi;br++)Fi.setValue(Me,"_gl_DrawID",br),pi.render(pn[br]/Or,ei[br])}else if($e.isInstancedMesh)pi.renderInstances(Kn,Qn,$e.count);else if(Qe.isInstancedBufferGeometry){const pn=Qe._maxInstanceCount!==void 0?Qe._maxInstanceCount:1/0,ei=Math.min(Qe.instanceCount,pn);pi.renderInstances(Kn,Qn,ei)}else pi.render(Kn,Qn)};function fe(oe,Be,Qe){oe.transparent===!0&&oe.side===Ec&&oe.forceSinglePass===!1?(oe.side=oa,oe.needsUpdate=!0,Hn(oe,Be,Qe),oe.side=Xu,oe.needsUpdate=!0,Hn(oe,Be,Qe),oe.side=Ec):Hn(oe,Be,Qe)}this.compile=function(oe,Be,Qe=null){Qe===null&&(Qe=oe),P=Je.get(Qe),P.init(Be),O.push(P),Qe.traverseVisible(function($e){$e.isLight&&$e.layers.test(Be.layers)&&(P.pushLight($e),$e.castShadow&&P.pushShadow($e))}),oe!==Qe&&oe.traverseVisible(function($e){$e.isLight&&$e.layers.test(Be.layers)&&(P.pushLight($e),$e.castShadow&&P.pushShadow($e))}),P.setupLights();const it=new Set;return oe.traverse(function($e){const Pt=$e.material;if(Pt)if(Array.isArray(Pt))for(let rn=0;rn<Pt.length;rn++){const Cn=Pt[rn];fe(Cn,Qe,$e),it.add(Cn)}else fe(Pt,Qe,$e),it.add(Pt)}),O.pop(),P=null,it},this.compileAsync=function(oe,Be,Qe=null){const it=this.compile(oe,Be,Qe);return new Promise($e=>{function Pt(){if(it.forEach(function(rn){wn.get(rn).currentProgram.isReady()&&it.delete(rn)}),it.size===0){$e(oe);return}setTimeout(Pt,10)}on.get("KHR_parallel_shader_compile")!==null?Pt():setTimeout(Pt,10)})};let xe=null;function Ie(oe){xe&&xe(oe)}function ke(){Ue.stop()}function Se(){Ue.start()}const Ue=new UU;Ue.setAnimationLoop(Ie),typeof self<"u"&&Ue.setContext(self),this.setAnimationLoop=function(oe){xe=oe,Lt.setAnimationLoop(oe),oe===null?Ue.stop():Ue.start()},Lt.addEventListener("sessionstart",ke),Lt.addEventListener("sessionend",Se),this.render=function(oe,Be){if(Be!==void 0&&Be.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(H===!0)return;if(oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),Be.parent===null&&Be.matrixWorldAutoUpdate===!0&&Be.updateMatrixWorld(),Lt.enabled===!0&&Lt.isPresenting===!0&&(Lt.cameraAutoUpdate===!0&&Lt.updateCamera(Be),Be=Lt.getCamera()),oe.isScene===!0&&oe.onBeforeRender(z,oe,Be,te),P=Je.get(oe,O.length),P.init(Be),O.push(P),Et.multiplyMatrices(Be.projectionMatrix,Be.matrixWorldInverse),Vt.setFromProjectionMatrix(Et),mt=this.localClippingEnabled,Re=cn.init(this.clippingPlanes,mt),L=zt.get(oe,C.length),L.init(),C.push(L),Lt.enabled===!0&&Lt.isPresenting===!0){const Pt=z.xr.getDepthSensingMesh();Pt!==null&&ft(Pt,Be,-1/0,z.sortObjects)}ft(oe,Be,0,z.sortObjects),L.finish(),z.sortObjects===!0&&L.sort(Ee,ut),at=Lt.enabled===!1||Lt.isPresenting===!1||Lt.hasDepthSensing()===!1,at&&tn.addToRenderList(L,oe),this.info.render.frame++,Re===!0&&cn.beginShadows();const Qe=P.state.shadowsArray;At.render(Qe,oe,Be),Re===!0&&cn.endShadows(),this.info.autoReset===!0&&this.info.reset();const it=L.opaque,$e=L.transmissive;if(P.setupLights(),Be.isArrayCamera){const Pt=Be.cameras;if($e.length>0)for(let rn=0,Cn=Pt.length;rn<Cn;rn++){const Ft=Pt[rn];rt(it,$e,oe,Ft)}at&&tn.render(oe);for(let rn=0,Cn=Pt.length;rn<Cn;rn++){const Ft=Pt[rn];Ze(L,oe,Ft,Ft.viewport)}}else $e.length>0&&rt(it,$e,oe,Be),at&&tn.render(oe),Ze(L,oe,Be);te!==null&&(jt.updateMultisampleRenderTarget(te),jt.updateRenderTargetMipmap(te)),oe.isScene===!0&&oe.onAfterRender(z,oe,Be),In.resetDefaultState(),ce=-1,K=null,O.pop(),O.length>0?(P=O[O.length-1],Re===!0&&cn.setGlobalState(z.clippingPlanes,P.state.camera)):P=null,C.pop(),C.length>0?L=C[C.length-1]:L=null};function ft(oe,Be,Qe,it){if(oe.visible===!1)return;if(oe.layers.test(Be.layers)){if(oe.isGroup)Qe=oe.renderOrder;else if(oe.isLOD)oe.autoUpdate===!0&&oe.update(Be);else if(oe.isLight)P.pushLight(oe),oe.castShadow&&P.pushShadow(oe);else if(oe.isSprite){if(!oe.frustumCulled||Vt.intersectsSprite(oe)){it&&vn.setFromMatrixPosition(oe.matrixWorld).applyMatrix4(Et);const rn=St.update(oe),Cn=oe.material;Cn.visible&&L.push(oe,rn,Cn,Qe,vn.z,null)}}else if((oe.isMesh||oe.isLine||oe.isPoints)&&(!oe.frustumCulled||Vt.intersectsObject(oe))){const rn=St.update(oe),Cn=oe.material;if(it&&(oe.boundingSphere!==void 0?(oe.boundingSphere===null&&oe.computeBoundingSphere(),vn.copy(oe.boundingSphere.center)):(rn.boundingSphere===null&&rn.computeBoundingSphere(),vn.copy(rn.boundingSphere.center)),vn.applyMatrix4(oe.matrixWorld).applyMatrix4(Et)),Array.isArray(Cn)){const Ft=rn.groups;for(let zn=0,Un=Ft.length;zn<Un;zn++){const Zt=Ft[zn],Kn=Cn[Zt.materialIndex];Kn&&Kn.visible&&L.push(oe,rn,Kn,Qe,vn.z,Zt)}}else Cn.visible&&L.push(oe,rn,Cn,Qe,vn.z,null)}}const Pt=oe.children;for(let rn=0,Cn=Pt.length;rn<Cn;rn++)ft(Pt[rn],Be,Qe,it)}function Ze(oe,Be,Qe,it){const $e=oe.opaque,Pt=oe.transmissive,rn=oe.transparent;P.setupLightsView(Qe),Re===!0&&cn.setGlobalState(z.clippingPlanes,Qe),it&&Te.viewport(Q.copy(it)),$e.length>0&&nn($e,Be,Qe),Pt.length>0&&nn(Pt,Be,Qe),rn.length>0&&nn(rn,Be,Qe),Te.buffers.depth.setTest(!0),Te.buffers.depth.setMask(!0),Te.buffers.color.setMask(!0),Te.setPolygonOffset(!1)}function rt(oe,Be,Qe,it){if((Qe.isScene===!0?Qe.overrideMaterial:null)!==null)return;P.state.transmissionRenderTarget[it.id]===void 0&&(P.state.transmissionRenderTarget[it.id]=new Uf(1,1,{generateMipmaps:!0,type:on.has("EXT_color_buffer_half_float")||on.has("EXT_color_buffer_float")?j0:Zu,minFilter:Lu,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:$i.workingColorSpace}));const Pt=P.state.transmissionRenderTarget[it.id],rn=it.viewport||Q;Pt.setSize(rn.z,rn.w);const Cn=z.getRenderTarget();z.setRenderTarget(Pt),z.getClearColor(Fe),qe=z.getClearAlpha(),qe<1&&z.setClearColor(16777215,.5),at?tn.render(Qe):z.clear();const Ft=z.toneMapping;z.toneMapping=yd;const zn=it.viewport;if(it.viewport!==void 0&&(it.viewport=void 0),P.setupLightsView(it),Re===!0&&cn.setGlobalState(z.clippingPlanes,it),nn(oe,Qe,it),jt.updateMultisampleRenderTarget(Pt),jt.updateRenderTargetMipmap(Pt),on.has("WEBGL_multisampled_render_to_texture")===!1){let Un=!1;for(let Zt=0,Kn=Be.length;Zt<Kn;Zt++){const ki=Be[Zt],Qn=ki.object,vi=ki.geometry,pi=ki.material,pn=ki.group;if(pi.side===Ec&&Qn.layers.test(it.layers)){const ei=pi.side;pi.side=oa,pi.needsUpdate=!0,fn(Qn,Qe,it,vi,pi,pn),pi.side=ei,pi.needsUpdate=!0,Un=!0}}Un===!0&&(jt.updateMultisampleRenderTarget(Pt),jt.updateRenderTargetMipmap(Pt))}z.setRenderTarget(Cn),z.setClearColor(Fe,qe),zn!==void 0&&(it.viewport=zn),z.toneMapping=Ft}function nn(oe,Be,Qe){const it=Be.isScene===!0?Be.overrideMaterial:null;for(let $e=0,Pt=oe.length;$e<Pt;$e++){const rn=oe[$e],Cn=rn.object,Ft=rn.geometry,zn=it===null?rn.material:it,Un=rn.group;Cn.layers.test(Qe.layers)&&fn(Cn,Be,Qe,Ft,zn,Un)}}function fn(oe,Be,Qe,it,$e,Pt){oe.onBeforeRender(z,Be,Qe,it,$e,Pt),oe.modelViewMatrix.multiplyMatrices(Qe.matrixWorldInverse,oe.matrixWorld),oe.normalMatrix.getNormalMatrix(oe.modelViewMatrix),$e.transparent===!0&&$e.side===Ec&&$e.forceSinglePass===!1?($e.side=oa,$e.needsUpdate=!0,z.renderBufferDirect(Qe,Be,it,$e,oe,Pt),$e.side=Xu,$e.needsUpdate=!0,z.renderBufferDirect(Qe,Be,it,$e,oe,Pt),$e.side=Ec):z.renderBufferDirect(Qe,Be,it,$e,oe,Pt),oe.onAfterRender(z,Be,Qe,it,$e,Pt)}function Hn(oe,Be,Qe){Be.isScene!==!0&&(Be=xn);const it=wn.get(oe),$e=P.state.lights,Pt=P.state.shadowsArray,rn=$e.state.version,Cn=yt.getParameters(oe,$e.state,Pt,Be,Qe),Ft=yt.getProgramCacheKey(Cn);let zn=it.programs;it.environment=oe.isMeshStandardMaterial?Be.environment:null,it.fog=Be.fog,it.envMap=(oe.isMeshStandardMaterial?le:me).get(oe.envMap||it.environment),it.envMapRotation=it.environment!==null&&oe.envMap===null?Be.environmentRotation:oe.envMapRotation,zn===void 0&&(oe.addEventListener("dispose",j),zn=new Map,it.programs=zn);let Un=zn.get(Ft);if(Un!==void 0){if(it.currentProgram===Un&&it.lightsStateVersion===rn)return ni(oe,Cn),Un}else Cn.uniforms=yt.getUniforms(oe),oe.onBeforeCompile(Cn,z),Un=yt.acquireProgram(Cn,Ft),zn.set(Ft,Un),it.uniforms=Cn.uniforms;const Zt=it.uniforms;return(!oe.isShaderMaterial&&!oe.isRawShaderMaterial||oe.clipping===!0)&&(Zt.clippingPlanes=cn.uniform),ni(oe,Cn),it.needsLights=yr(oe),it.lightsStateVersion=rn,it.needsLights&&(Zt.ambientLightColor.value=$e.state.ambient,Zt.lightProbe.value=$e.state.probe,Zt.directionalLights.value=$e.state.directional,Zt.directionalLightShadows.value=$e.state.directionalShadow,Zt.spotLights.value=$e.state.spot,Zt.spotLightShadows.value=$e.state.spotShadow,Zt.rectAreaLights.value=$e.state.rectArea,Zt.ltc_1.value=$e.state.rectAreaLTC1,Zt.ltc_2.value=$e.state.rectAreaLTC2,Zt.pointLights.value=$e.state.point,Zt.pointLightShadows.value=$e.state.pointShadow,Zt.hemisphereLights.value=$e.state.hemi,Zt.directionalShadowMap.value=$e.state.directionalShadowMap,Zt.directionalShadowMatrix.value=$e.state.directionalShadowMatrix,Zt.spotShadowMap.value=$e.state.spotShadowMap,Zt.spotLightMatrix.value=$e.state.spotLightMatrix,Zt.spotLightMap.value=$e.state.spotLightMap,Zt.pointShadowMap.value=$e.state.pointShadowMap,Zt.pointShadowMatrix.value=$e.state.pointShadowMatrix),it.currentProgram=Un,it.uniformsList=null,Un}function Fn(oe){if(oe.uniformsList===null){const Be=oe.currentProgram.getUniforms();oe.uniformsList=m1.seqWithValue(Be.seq,oe.uniforms)}return oe.uniformsList}function ni(oe,Be){const Qe=wn.get(oe);Qe.outputColorSpace=Be.outputColorSpace,Qe.batching=Be.batching,Qe.batchingColor=Be.batchingColor,Qe.instancing=Be.instancing,Qe.instancingColor=Be.instancingColor,Qe.instancingMorph=Be.instancingMorph,Qe.skinning=Be.skinning,Qe.morphTargets=Be.morphTargets,Qe.morphNormals=Be.morphNormals,Qe.morphColors=Be.morphColors,Qe.morphTargetsCount=Be.morphTargetsCount,Qe.numClippingPlanes=Be.numClippingPlanes,Qe.numIntersection=Be.numClipIntersection,Qe.vertexAlphas=Be.vertexAlphas,Qe.vertexTangents=Be.vertexTangents,Qe.toneMapping=Be.toneMapping}function wi(oe,Be,Qe,it,$e){Be.isScene!==!0&&(Be=xn),jt.resetTextureUnits();const Pt=Be.fog,rn=it.isMeshStandardMaterial?Be.environment:null,Cn=te===null?z.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:Ys,Ft=(it.isMeshStandardMaterial?le:me).get(it.envMap||rn),zn=it.vertexColors===!0&&!!Qe.attributes.color&&Qe.attributes.color.itemSize===4,Un=!!Qe.attributes.tangent&&(!!it.normalMap||it.anisotropy>0),Zt=!!Qe.morphAttributes.position,Kn=!!Qe.morphAttributes.normal,ki=!!Qe.morphAttributes.color;let Qn=yd;it.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(Qn=z.toneMapping);const vi=Qe.morphAttributes.position||Qe.morphAttributes.normal||Qe.morphAttributes.color,pi=vi!==void 0?vi.length:0,pn=wn.get(it),ei=P.state.lights;if(Re===!0&&(mt===!0||oe!==K)){const Nr=oe===K&&it.id===ce;cn.setState(it,oe,Nr)}let hi=!1;it.version===pn.__version?(pn.needsLights&&pn.lightsStateVersion!==ei.state.version||pn.outputColorSpace!==Cn||$e.isBatchedMesh&&pn.batching===!1||!$e.isBatchedMesh&&pn.batching===!0||$e.isBatchedMesh&&pn.batchingColor===!0&&$e.colorTexture===null||$e.isBatchedMesh&&pn.batchingColor===!1&&$e.colorTexture!==null||$e.isInstancedMesh&&pn.instancing===!1||!$e.isInstancedMesh&&pn.instancing===!0||$e.isSkinnedMesh&&pn.skinning===!1||!$e.isSkinnedMesh&&pn.skinning===!0||$e.isInstancedMesh&&pn.instancingColor===!0&&$e.instanceColor===null||$e.isInstancedMesh&&pn.instancingColor===!1&&$e.instanceColor!==null||$e.isInstancedMesh&&pn.instancingMorph===!0&&$e.morphTexture===null||$e.isInstancedMesh&&pn.instancingMorph===!1&&$e.morphTexture!==null||pn.envMap!==Ft||it.fog===!0&&pn.fog!==Pt||pn.numClippingPlanes!==void 0&&(pn.numClippingPlanes!==cn.numPlanes||pn.numIntersection!==cn.numIntersection)||pn.vertexAlphas!==zn||pn.vertexTangents!==Un||pn.morphTargets!==Zt||pn.morphNormals!==Kn||pn.morphColors!==ki||pn.toneMapping!==Qn||pn.morphTargetsCount!==pi)&&(hi=!0):(hi=!0,pn.__version=it.version);let Or=pn.currentProgram;hi===!0&&(Or=Hn(it,Be,$e));let Fi=!1,br=!1,ns=!1;const Hi=Or.getUniforms(),Rr=pn.uniforms;if(Te.useProgram(Or.program)&&(Fi=!0,br=!0,ns=!0),it.id!==ce&&(ce=it.id,br=!0),Fi||K!==oe){Hi.setValue(Me,"projectionMatrix",oe.projectionMatrix),Hi.setValue(Me,"viewMatrix",oe.matrixWorldInverse);const Nr=Hi.map.cameraPosition;Nr!==void 0&&Nr.setValue(Me,It.setFromMatrixPosition(oe.matrixWorld)),Vn.logarithmicDepthBuffer&&Hi.setValue(Me,"logDepthBufFC",2/(Math.log(oe.far+1)/Math.LN2)),(it.isMeshPhongMaterial||it.isMeshToonMaterial||it.isMeshLambertMaterial||it.isMeshBasicMaterial||it.isMeshStandardMaterial||it.isShaderMaterial)&&Hi.setValue(Me,"isOrthographic",oe.isOrthographicCamera===!0),K!==oe&&(K=oe,br=!0,ns=!0)}if($e.isSkinnedMesh){Hi.setOptional(Me,$e,"bindMatrix"),Hi.setOptional(Me,$e,"bindMatrixInverse");const Nr=$e.skeleton;Nr&&(Nr.boneTexture===null&&Nr.computeBoneTexture(),Hi.setValue(Me,"boneTexture",Nr.boneTexture,jt))}$e.isBatchedMesh&&(Hi.setOptional(Me,$e,"batchingTexture"),Hi.setValue(Me,"batchingTexture",$e._matricesTexture,jt),Hi.setOptional(Me,$e,"batchingIdTexture"),Hi.setValue(Me,"batchingIdTexture",$e._indirectTexture,jt),Hi.setOptional(Me,$e,"batchingColorTexture"),$e._colorsTexture!==null&&Hi.setValue(Me,"batchingColorTexture",$e._colorsTexture,jt));const za=Qe.morphAttributes;if((za.position!==void 0||za.normal!==void 0||za.color!==void 0)&&Zn.update($e,Qe,Or),(br||pn.receiveShadow!==$e.receiveShadow)&&(pn.receiveShadow=$e.receiveShadow,Hi.setValue(Me,"receiveShadow",$e.receiveShadow)),it.isMeshGouraudMaterial&&it.envMap!==null&&(Rr.envMap.value=Ft,Rr.flipEnvMap.value=Ft.isCubeTexture&&Ft.isRenderTargetTexture===!1?-1:1),it.isMeshStandardMaterial&&it.envMap===null&&Be.environment!==null&&(Rr.envMapIntensity.value=Be.environmentIntensity),br&&(Hi.setValue(Me,"toneMappingExposure",z.toneMappingExposure),pn.needsLights&&Ui(Rr,ns),Pt&&it.fog===!0&&hn.refreshFogUniforms(Rr,Pt),hn.refreshMaterialUniforms(Rr,it,st,Ne,P.state.transmissionRenderTarget[oe.id]),m1.upload(Me,Fn(pn),Rr,jt)),it.isShaderMaterial&&it.uniformsNeedUpdate===!0&&(m1.upload(Me,Fn(pn),Rr,jt),it.uniformsNeedUpdate=!1),it.isSpriteMaterial&&Hi.setValue(Me,"center",$e.center),Hi.setValue(Me,"modelViewMatrix",$e.modelViewMatrix),Hi.setValue(Me,"normalMatrix",$e.normalMatrix),Hi.setValue(Me,"modelMatrix",$e.matrixWorld),it.isShaderMaterial||it.isRawShaderMaterial){const Nr=it.uniformsGroups;for(let mi=0,jl=Nr.length;mi<jl;mi++){const Js=Nr[mi];ii.update(Js,Or),ii.bind(Js,Or)}}return Or}function Ui(oe,Be){oe.ambientLightColor.needsUpdate=Be,oe.lightProbe.needsUpdate=Be,oe.directionalLights.needsUpdate=Be,oe.directionalLightShadows.needsUpdate=Be,oe.pointLights.needsUpdate=Be,oe.pointLightShadows.needsUpdate=Be,oe.spotLights.needsUpdate=Be,oe.spotLightShadows.needsUpdate=Be,oe.rectAreaLights.needsUpdate=Be,oe.hemisphereLights.needsUpdate=Be}function yr(oe){return oe.isMeshLambertMaterial||oe.isMeshToonMaterial||oe.isMeshPhongMaterial||oe.isMeshStandardMaterial||oe.isShadowMaterial||oe.isShaderMaterial&&oe.lights===!0}this.getActiveCubeFace=function(){return Y},this.getActiveMipmapLevel=function(){return ee},this.getRenderTarget=function(){return te},this.setRenderTargetTextures=function(oe,Be,Qe){wn.get(oe.texture).__webglTexture=Be,wn.get(oe.depthTexture).__webglTexture=Qe;const it=wn.get(oe);it.__hasExternalTextures=!0,it.__autoAllocateDepthBuffer=Qe===void 0,it.__autoAllocateDepthBuffer||on.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),it.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(oe,Be){const Qe=wn.get(oe);Qe.__webglFramebuffer=Be,Qe.__useDefaultFramebuffer=Be===void 0},this.setRenderTarget=function(oe,Be=0,Qe=0){te=oe,Y=Be,ee=Qe;let it=!0,$e=null,Pt=!1,rn=!1;if(oe){const Ft=wn.get(oe);Ft.__useDefaultFramebuffer!==void 0?(Te.bindFramebuffer(Me.FRAMEBUFFER,null),it=!1):Ft.__webglFramebuffer===void 0?jt.setupRenderTarget(oe):Ft.__hasExternalTextures&&jt.rebindTextures(oe,wn.get(oe.texture).__webglTexture,wn.get(oe.depthTexture).__webglTexture);const zn=oe.texture;(zn.isData3DTexture||zn.isDataArrayTexture||zn.isCompressedArrayTexture)&&(rn=!0);const Un=wn.get(oe).__webglFramebuffer;oe.isWebGLCubeRenderTarget?(Array.isArray(Un[Be])?$e=Un[Be][Qe]:$e=Un[Be],Pt=!0):oe.samples>0&&jt.useMultisampledRTT(oe)===!1?$e=wn.get(oe).__webglMultisampledFramebuffer:Array.isArray(Un)?$e=Un[Qe]:$e=Un,Q.copy(oe.viewport),pe.copy(oe.scissor),ze=oe.scissorTest}else Q.copy(ot).multiplyScalar(st).floor(),pe.copy(dt).multiplyScalar(st).floor(),ze=Ct;if(Te.bindFramebuffer(Me.FRAMEBUFFER,$e)&&it&&Te.drawBuffers(oe,$e),Te.viewport(Q),Te.scissor(pe),Te.setScissorTest(ze),Pt){const Ft=wn.get(oe.texture);Me.framebufferTexture2D(Me.FRAMEBUFFER,Me.COLOR_ATTACHMENT0,Me.TEXTURE_CUBE_MAP_POSITIVE_X+Be,Ft.__webglTexture,Qe)}else if(rn){const Ft=wn.get(oe.texture),zn=Be||0;Me.framebufferTextureLayer(Me.FRAMEBUFFER,Me.COLOR_ATTACHMENT0,Ft.__webglTexture,Qe||0,zn)}ce=-1},this.readRenderTargetPixels=function(oe,Be,Qe,it,$e,Pt,rn){if(!(oe&&oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Cn=wn.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&rn!==void 0&&(Cn=Cn[rn]),Cn){Te.bindFramebuffer(Me.FRAMEBUFFER,Cn);try{const Ft=oe.texture,zn=Ft.format,Un=Ft.type;if(!Vn.textureFormatReadable(zn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Vn.textureTypeReadable(Un)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Be>=0&&Be<=oe.width-it&&Qe>=0&&Qe<=oe.height-$e&&Me.readPixels(Be,Qe,it,$e,kt.convert(zn),kt.convert(Un),Pt)}finally{const Ft=te!==null?wn.get(te).__webglFramebuffer:null;Te.bindFramebuffer(Me.FRAMEBUFFER,Ft)}}},this.readRenderTargetPixelsAsync=async function(oe,Be,Qe,it,$e,Pt,rn){if(!(oe&&oe.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Cn=wn.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&rn!==void 0&&(Cn=Cn[rn]),Cn){Te.bindFramebuffer(Me.FRAMEBUFFER,Cn);try{const Ft=oe.texture,zn=Ft.format,Un=Ft.type;if(!Vn.textureFormatReadable(zn))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Vn.textureTypeReadable(Un))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if(Be>=0&&Be<=oe.width-it&&Qe>=0&&Qe<=oe.height-$e){const Zt=Me.createBuffer();Me.bindBuffer(Me.PIXEL_PACK_BUFFER,Zt),Me.bufferData(Me.PIXEL_PACK_BUFFER,Pt.byteLength,Me.STREAM_READ),Me.readPixels(Be,Qe,it,$e,kt.convert(zn),kt.convert(Un),0),Me.flush();const Kn=Me.fenceSync(Me.SYNC_GPU_COMMANDS_COMPLETE,0);await PJ(Me,Kn,4);try{Me.bindBuffer(Me.PIXEL_PACK_BUFFER,Zt),Me.getBufferSubData(Me.PIXEL_PACK_BUFFER,0,Pt)}finally{Me.deleteBuffer(Zt),Me.deleteSync(Kn)}return Pt}}finally{const Ft=te!==null?wn.get(te).__webglFramebuffer:null;Te.bindFramebuffer(Me.FRAMEBUFFER,Ft)}}},this.copyFramebufferToTexture=function(oe,Be=null,Qe=0){oe.isTexture!==!0&&(console.warn("WebGLRenderer: copyFramebufferToTexture function signature has changed."),Be=arguments[0]||null,oe=arguments[1]);const it=Math.pow(2,-Qe),$e=Math.floor(oe.image.width*it),Pt=Math.floor(oe.image.height*it),rn=Be!==null?Be.x:0,Cn=Be!==null?Be.y:0;jt.setTexture2D(oe,0),Me.copyTexSubImage2D(Me.TEXTURE_2D,Qe,0,0,rn,Cn,$e,Pt),Te.unbindTexture()},this.copyTextureToTexture=function(oe,Be,Qe=null,it=null,$e=0){oe.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture function signature has changed."),it=arguments[0]||null,oe=arguments[1],Be=arguments[2],$e=arguments[3]||0,Qe=null);let Pt,rn,Cn,Ft,zn,Un;Qe!==null?(Pt=Qe.max.x-Qe.min.x,rn=Qe.max.y-Qe.min.y,Cn=Qe.min.x,Ft=Qe.min.y):(Pt=oe.image.width,rn=oe.image.height,Cn=0,Ft=0),it!==null?(zn=it.x,Un=it.y):(zn=0,Un=0);const Zt=kt.convert(Be.format),Kn=kt.convert(Be.type);jt.setTexture2D(Be,0),Me.pixelStorei(Me.UNPACK_FLIP_Y_WEBGL,Be.flipY),Me.pixelStorei(Me.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Be.premultiplyAlpha),Me.pixelStorei(Me.UNPACK_ALIGNMENT,Be.unpackAlignment);const ki=Me.getParameter(Me.UNPACK_ROW_LENGTH),Qn=Me.getParameter(Me.UNPACK_IMAGE_HEIGHT),vi=Me.getParameter(Me.UNPACK_SKIP_PIXELS),pi=Me.getParameter(Me.UNPACK_SKIP_ROWS),pn=Me.getParameter(Me.UNPACK_SKIP_IMAGES),ei=oe.isCompressedTexture?oe.mipmaps[$e]:oe.image;Me.pixelStorei(Me.UNPACK_ROW_LENGTH,ei.width),Me.pixelStorei(Me.UNPACK_IMAGE_HEIGHT,ei.height),Me.pixelStorei(Me.UNPACK_SKIP_PIXELS,Cn),Me.pixelStorei(Me.UNPACK_SKIP_ROWS,Ft),oe.isDataTexture?Me.texSubImage2D(Me.TEXTURE_2D,$e,zn,Un,Pt,rn,Zt,Kn,ei.data):oe.isCompressedTexture?Me.compressedTexSubImage2D(Me.TEXTURE_2D,$e,zn,Un,ei.width,ei.height,Zt,ei.data):Me.texSubImage2D(Me.TEXTURE_2D,$e,zn,Un,Pt,rn,Zt,Kn,ei),Me.pixelStorei(Me.UNPACK_ROW_LENGTH,ki),Me.pixelStorei(Me.UNPACK_IMAGE_HEIGHT,Qn),Me.pixelStorei(Me.UNPACK_SKIP_PIXELS,vi),Me.pixelStorei(Me.UNPACK_SKIP_ROWS,pi),Me.pixelStorei(Me.UNPACK_SKIP_IMAGES,pn),$e===0&&Be.generateMipmaps&&Me.generateMipmap(Me.TEXTURE_2D),Te.unbindTexture()},this.copyTextureToTexture3D=function(oe,Be,Qe=null,it=null,$e=0){oe.isTexture!==!0&&(console.warn("WebGLRenderer: copyTextureToTexture3D function signature has changed."),Qe=arguments[0]||null,it=arguments[1]||null,oe=arguments[2],Be=arguments[3],$e=arguments[4]||0);let Pt,rn,Cn,Ft,zn,Un,Zt,Kn,ki;const Qn=oe.isCompressedTexture?oe.mipmaps[$e]:oe.image;Qe!==null?(Pt=Qe.max.x-Qe.min.x,rn=Qe.max.y-Qe.min.y,Cn=Qe.max.z-Qe.min.z,Ft=Qe.min.x,zn=Qe.min.y,Un=Qe.min.z):(Pt=Qn.width,rn=Qn.height,Cn=Qn.depth,Ft=0,zn=0,Un=0),it!==null?(Zt=it.x,Kn=it.y,ki=it.z):(Zt=0,Kn=0,ki=0);const vi=kt.convert(Be.format),pi=kt.convert(Be.type);let pn;if(Be.isData3DTexture)jt.setTexture3D(Be,0),pn=Me.TEXTURE_3D;else if(Be.isDataArrayTexture||Be.isCompressedArrayTexture)jt.setTexture2DArray(Be,0),pn=Me.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Me.pixelStorei(Me.UNPACK_FLIP_Y_WEBGL,Be.flipY),Me.pixelStorei(Me.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Be.premultiplyAlpha),Me.pixelStorei(Me.UNPACK_ALIGNMENT,Be.unpackAlignment);const ei=Me.getParameter(Me.UNPACK_ROW_LENGTH),hi=Me.getParameter(Me.UNPACK_IMAGE_HEIGHT),Or=Me.getParameter(Me.UNPACK_SKIP_PIXELS),Fi=Me.getParameter(Me.UNPACK_SKIP_ROWS),br=Me.getParameter(Me.UNPACK_SKIP_IMAGES);Me.pixelStorei(Me.UNPACK_ROW_LENGTH,Qn.width),Me.pixelStorei(Me.UNPACK_IMAGE_HEIGHT,Qn.height),Me.pixelStorei(Me.UNPACK_SKIP_PIXELS,Ft),Me.pixelStorei(Me.UNPACK_SKIP_ROWS,zn),Me.pixelStorei(Me.UNPACK_SKIP_IMAGES,Un),oe.isDataTexture||oe.isData3DTexture?Me.texSubImage3D(pn,$e,Zt,Kn,ki,Pt,rn,Cn,vi,pi,Qn.data):Be.isCompressedArrayTexture?Me.compressedTexSubImage3D(pn,$e,Zt,Kn,ki,Pt,rn,Cn,vi,Qn.data):Me.texSubImage3D(pn,$e,Zt,Kn,ki,Pt,rn,Cn,vi,pi,Qn),Me.pixelStorei(Me.UNPACK_ROW_LENGTH,ei),Me.pixelStorei(Me.UNPACK_IMAGE_HEIGHT,hi),Me.pixelStorei(Me.UNPACK_SKIP_PIXELS,Or),Me.pixelStorei(Me.UNPACK_SKIP_ROWS,Fi),Me.pixelStorei(Me.UNPACK_SKIP_IMAGES,br),$e===0&&Be.generateMipmaps&&Me.generateMipmap(pn),Te.unbindTexture()},this.initRenderTarget=function(oe){wn.get(oe).__webglFramebuffer===void 0&&jt.setupRenderTarget(oe)},this.initTexture=function(oe){oe.isCubeTexture?jt.setTextureCube(oe,0):oe.isData3DTexture?jt.setTexture3D(oe,0):oe.isDataArrayTexture||oe.isCompressedArrayTexture?jt.setTexture2DArray(oe,0):jt.setTexture2D(oe,0),Te.unbindTexture()},this.resetState=function(){Y=0,ee=0,te=null,Te.reset(),In.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Du}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===nI?"display-p3":"srgb",t.unpackColorSpace=$i.workingColorSpace===Pb?"display-p3":"srgb"}}class Bie extends Hr{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new zc,this.environmentIntensity=1,this.environmentRotation=new zc,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Uie{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=P2,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=zl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return rI("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=zl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=zl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ro=new Ye;class cI{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Ro.fromBufferAttribute(this,t),Ro.applyMatrix4(e),this.setXYZ(t,Ro.x,Ro.y,Ro.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Ro.fromBufferAttribute(this,t),Ro.applyNormalMatrix(e),this.setXYZ(t,Ro.x,Ro.y,Ro.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Ro.fromBufferAttribute(this,t),Ro.transformDirection(e),this.setXYZ(t,Ro.x,Ro.y,Ro.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=Rl(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ar(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=ar(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=ar(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=ar(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=ar(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=Rl(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=Rl(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=Rl(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=Rl(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array),r=ar(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=ar(t,this.array),i=ar(i,this.array),r=ar(r,this.array),s=ar(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new Vo(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new cI(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const ok=new Ye,ak=new _r,lk=new _r,Vie=new Ye,ck=new ui,Nx=new Ye,aE=new Vc,uk=new ui,lE=new Rb;class Gie extends Pa{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=u3,this.bindMatrix=new ui,this.bindMatrixInverse=new ui,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new th),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Nx),this.boundingBox.expandByPoint(Nx)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Vc),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,Nx),this.boundingSphere.expandByPoint(Nx)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),aE.copy(this.boundingSphere),aE.applyMatrix4(r),e.ray.intersectsSphere(aE)!==!1&&(uk.copy(r).invert(),lE.copy(e.ray).applyMatrix4(uk),!(this.boundingBox!==null&&lE.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,lE)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new _r,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===u3?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===QK?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;ak.fromBufferAttribute(r.attributes.skinIndex,e),lk.fromBufferAttribute(r.attributes.skinWeight,e),ok.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=lk.getComponent(s);if(a!==0){const o=ak.getComponent(s);ck.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),t.addScaledVector(Vie.copy(ok).applyMatrix4(ck),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class $U extends Hr{constructor(){super(),this.isBone=!0,this.type="Bone"}}class qU extends Fs{constructor(e=null,t=1,i=1,r,s,a,o,d,p=Bo,g=Bo,_,w){super(null,a,o,d,p,g,r,s,_,w),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const hk=new ui,Hie=new ui;class uI{constructor(e=[],t=[]){this.uuid=zl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ui)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new ui;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const o=e[s]?e[s].matrixWorld:Hie;hk.multiplyMatrices(o,t[s]),hk.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new uI(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new qU(t,e,e,ol,Dl);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let a=t[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new $U),this.bones.push(a),this.boneInverses.push(new ui().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const a=t[r];e.bones.push(a.uuid);const o=i[r];e.boneInverses.push(o.toArray())}return e}}class L2 extends Vo{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Zp=new ui,dk=new ui,zx=[],fk=new th,Wie=new ui,G_=new Pa,H_=new Vc;class jie extends Pa{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new L2(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,Wie)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new th),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Zp),fk.copy(e.boundingBox).applyMatrix4(Zp),this.boundingBox.union(fk)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Vc),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,Zp),H_.copy(e.boundingSphere).applyMatrix4(Zp),this.boundingSphere.union(H_)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,a=e*s+1;for(let o=0;o<i.length;o++)i[o]=r[a+o]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(G_.geometry=this.geometry,G_.material=this.material,G_.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),H_.copy(this.boundingSphere),H_.applyMatrix4(i),e.ray.intersectsSphere(H_)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,Zp),dk.multiplyMatrices(i,Zp),G_.matrixWorld=dk,G_.raycast(e,zx);for(let a=0,o=zx.length;a<o;a++){const d=zx[a];d.instanceId=s,d.object=this,t.push(d)}zx.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new L2(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new qU(new Float32Array(r*this.count),r,this.count,JA,Dl));const s=this.morphTexture.source.data.data;let a=0;for(let p=0;p<i.length;p++)a+=i[p];const o=this.geometry.morphTargetsRelative?1:1-a,d=r*e;s[d]=o,s.set(i,d+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class hI extends Oc{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ci(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Tw=new Ye,Cw=new Ye,pk=new ui,W_=new Rb,Bx=new Vc,cE=new Ye,mk=new Ye;class dI extends Hr{constructor(e=new Wl,t=new hI){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)Tw.fromBufferAttribute(t,r-1),Cw.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=Tw.distanceTo(Cw);e.setAttribute("lineDistance",new Bl(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Bx.copy(i.boundingSphere),Bx.applyMatrix4(r),Bx.radius+=s,e.ray.intersectsSphere(Bx)===!1)return;pk.copy(r).invert(),W_.copy(e.ray).applyMatrix4(pk);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),d=o*o,p=this.isLineSegments?2:1,g=i.index,w=i.attributes.position;if(g!==null){const T=Math.max(0,a.start),I=Math.min(g.count,a.start+a.count);for(let L=T,P=I-1;L<P;L+=p){const C=g.getX(L),O=g.getX(L+1),z=Ux(this,e,W_,d,C,O);z&&t.push(z)}if(this.isLineLoop){const L=g.getX(I-1),P=g.getX(T),C=Ux(this,e,W_,d,L,P);C&&t.push(C)}}else{const T=Math.max(0,a.start),I=Math.min(w.count,a.start+a.count);for(let L=T,P=I-1;L<P;L+=p){const C=Ux(this,e,W_,d,L,L+1);C&&t.push(C)}if(this.isLineLoop){const L=Ux(this,e,W_,d,I-1,T);L&&t.push(L)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function Ux(n,e,t,i,r,s){const a=n.geometry.attributes.position;if(Tw.fromBufferAttribute(a,r),Cw.fromBufferAttribute(a,s),t.distanceSqToSegment(Tw,Cw,cE,mk)>i)return;cE.applyMatrix4(n.matrixWorld);const d=e.ray.origin.distanceTo(cE);if(!(d<e.near||d>e.far))return{distance:d,point:mk.clone().applyMatrix4(n.matrixWorld),index:r,face:null,faceIndex:null,object:n}}const gk=new Ye,_k=new Ye;class XU extends dI{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)gk.fromBufferAttribute(t,r),_k.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+gk.distanceTo(_k);e.setAttribute("lineDistance",new Bl(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $ie extends dI{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class ZU extends Oc{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ci(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const yk=new ui,D2=new Rb,Vx=new Vc,Gx=new Ye;class qie extends Hr{constructor(e=new Wl,t=new ZU){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Vx.copy(i.boundingSphere),Vx.applyMatrix4(r),Vx.radius+=s,e.ray.intersectsSphere(Vx)===!1)return;yk.copy(r).invert(),D2.copy(e.ray).applyMatrix4(yk);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),d=o*o,p=i.index,_=i.attributes.position;if(p!==null){const w=Math.max(0,a.start),T=Math.min(p.count,a.start+a.count);for(let I=w,L=T;I<L;I++){const P=p.getX(I);Gx.fromBufferAttribute(_,P),vk(Gx,P,d,r,e,t,this)}}else{const w=Math.max(0,a.start),T=Math.min(_.count,a.start+a.count);for(let I=w,L=T;I<L;I++)Gx.fromBufferAttribute(_,I),vk(Gx,I,d,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=r.length;s<a;s++){const o=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=s}}}}}function vk(n,e,t,i,r,s,a){const o=D2.distanceSqToPoint(n);if(o<t){const d=new Ye;D2.closestPointToPoint(n,d),d.applyMatrix4(i);const p=r.ray.origin.distanceTo(d);if(p<r.near||p>r.far)return;s.push({distance:p,distanceToRay:Math.sqrt(o),point:d,index:e,face:null,object:a})}}class fI extends Oc{constructor(e){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ci(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ci(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=IU,this.normalScale=new Mi(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new zc,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Gc extends fI{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Mi(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yo(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ci(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ci(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ci(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}function Hx(n,e,t){return!n||!t&&n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function Xie(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Zie(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function xk(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,a=0;a!==i;++s){const o=t[s]*e;for(let d=0;d!==e;++d)r[a++]=n[o+d]}return r}function YU(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let a=s[i];if(a!==void 0)if(Array.isArray(a))do a=s[i],a!==void 0&&(e.push(s.time),t.push.apply(t,a)),s=n[r++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[i],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do a=s[i],a!==void 0&&(e.push(s.time),t.push(a)),s=n[r++];while(s!==void 0)}class q0{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let a;n:{i:if(!(e<r)){for(let o=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(s=r,r=t[++i],e<r)break t}a=t.length;break n}if(!(e>=s)){const o=t[1];e<o&&(i=2,s=o);for(let d=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===d)break;if(r=s,s=t[--i-1],e>=s)break t}a=i,i=0;break n}break e}for(;i<a;){const o=i+a>>>1;e<t[o]?a=o:i=o+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let a=0;a!==r;++a)t[a]=i[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Yie extends q0{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:h3,endingEnd:h3}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,a=e+1,o=r[s],d=r[a];if(o===void 0)switch(this.getSettings_().endingStart){case d3:s=e,o=2*t-i;break;case f3:s=r.length-2,o=t+r[s]-r[s+1];break;default:s=e,o=i}if(d===void 0)switch(this.getSettings_().endingEnd){case d3:a=e,d=2*i-t;break;case f3:a=1,d=i+r[1]-r[0];break;default:a=e-1,d=t}const p=(i-t)*.5,g=this.valueSize;this._weightPrev=p/(t-o),this._weightNext=p/(d-i),this._offsetPrev=s*g,this._offsetNext=a*g}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,d=e*o,p=d-o,g=this._offsetPrev,_=this._offsetNext,w=this._weightPrev,T=this._weightNext,I=(i-t)/(r-t),L=I*I,P=L*I,C=-w*P+2*w*L-w*I,O=(1+w)*P+(-1.5-2*w)*L+(-.5+w)*I+1,z=(-1-T)*P+(1.5+T)*L+.5*I,H=T*P-T*L;for(let Y=0;Y!==o;++Y)s[Y]=C*a[g+Y]+O*a[p+Y]+z*a[d+Y]+H*a[_+Y];return s}}class Kie extends q0{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,d=e*o,p=d-o,g=(i-t)/(r-t),_=1-g;for(let w=0;w!==o;++w)s[w]=a[p+w]*_+a[d+w]*g;return s}}class Jie extends q0{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Hc{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Hx(t,this.TimeBufferType),this.values=Hx(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Hx(e.times,Array),values:Hx(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Jie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Kie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Yie(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case x0:t=this.InterpolantFactoryMethodDiscrete;break;case w0:t=this.InterpolantFactoryMethodLinear;break;case FM:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return x0;case this.InterpolantFactoryMethodLinear:return w0;case this.InterpolantFactoryMethodSmooth:return FM}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,a=r-1;for(;s!==r&&i[s]<e;)++s;for(;a!==-1&&i[a]>t;)--a;if(++a,s!==0||a!==r){s>=a&&(a=Math.max(a,1),s=a-1);const o=this.getValueSize();this.times=i.slice(s,a),this.values=this.values.slice(s*o,a*o)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let o=0;o!==s;o++){const d=i[o];if(typeof d=="number"&&isNaN(d)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,d),e=!1;break}if(a!==null&&a>d){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,d,a),e=!1;break}a=d}if(r!==void 0&&Xie(r))for(let o=0,d=r.length;o!==d;++o){const p=r[o];if(isNaN(p)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,p),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===FM,s=e.length-1;let a=1;for(let o=1;o<s;++o){let d=!1;const p=e[o],g=e[o+1];if(p!==g&&(o!==1||p!==e[0]))if(r)d=!0;else{const _=o*i,w=_-i,T=_+i;for(let I=0;I!==i;++I){const L=t[_+I];if(L!==t[w+I]||L!==t[T+I]){d=!0;break}}}if(d){if(o!==a){e[a]=e[o];const _=o*i,w=a*i;for(let T=0;T!==i;++T)t[w+T]=t[_+T]}++a}}if(s>0){e[a]=e[s];for(let o=s*i,d=a*i,p=0;p!==i;++p)t[d+p]=t[o+p];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Hc.prototype.TimeBufferType=Float32Array;Hc.prototype.ValueBufferType=Float32Array;Hc.prototype.DefaultInterpolation=w0;class kg extends Hc{constructor(e,t,i){super(e,t,i)}}kg.prototype.ValueTypeName="bool";kg.prototype.ValueBufferType=Array;kg.prototype.DefaultInterpolation=x0;kg.prototype.InterpolantFactoryMethodLinear=void 0;kg.prototype.InterpolantFactoryMethodSmooth=void 0;class KU extends Hc{}KU.prototype.ValueTypeName="color";class pg extends Hc{}pg.prototype.ValueTypeName="number";class Qie extends q0{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,d=(i-t)/(r-t);let p=e*o;for(let g=p+o;p!==g;p+=4)Pd.slerpFlat(s,0,a,p-o,a,p,d);return s}}class mg extends Hc{InterpolantFactoryMethodLinear(e){return new Qie(this.times,this.values,this.getValueSize(),e)}}mg.prototype.ValueTypeName="quaternion";mg.prototype.InterpolantFactoryMethodSmooth=void 0;class Fg extends Hc{constructor(e,t,i){super(e,t,i)}}Fg.prototype.ValueTypeName="string";Fg.prototype.ValueBufferType=Array;Fg.prototype.DefaultInterpolation=x0;Fg.prototype.InterpolantFactoryMethodLinear=void 0;Fg.prototype.InterpolantFactoryMethodSmooth=void 0;class gg extends Hc{}gg.prototype.ValueTypeName="vector";class ere{constructor(e="",t=-1,i=[],r=eJ){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=zl(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let a=0,o=i.length;a!==o;++a)t.push(nre(i[a]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=i.length;s!==a;++s)t.push(Hc.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,a=[];for(let o=0;o<s;o++){let d=[],p=[];d.push((o+s-1)%s,o,(o+1)%s),p.push(0,1,0);const g=Zie(d);d=xk(d,1,g),p=xk(p,1,g),!r&&d[0]===0&&(d.push(s),p.push(p[0])),a.push(new pg(".morphTargetInfluences["+t[o].name+"]",d,p).scale(1/i))}return new this(e,-1,a)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let o=0,d=e.length;o<d;o++){const p=e[o],g=p.name.match(s);if(g&&g.length>1){const _=g[1];let w=r[_];w||(r[_]=w=[]),w.push(p)}}const a=[];for(const o in r)a.push(this.CreateFromMorphTargetSequence(o,r[o],t,i));return a}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(_,w,T,I,L){if(T.length!==0){const P=[],C=[];YU(T,P,C,I),P.length!==0&&L.push(new _(w,P,C))}},r=[],s=e.name||"default",a=e.fps||30,o=e.blendMode;let d=e.length||-1;const p=e.hierarchy||[];for(let _=0;_<p.length;_++){const w=p[_].keys;if(!(!w||w.length===0))if(w[0].morphTargets){const T={};let I;for(I=0;I<w.length;I++)if(w[I].morphTargets)for(let L=0;L<w[I].morphTargets.length;L++)T[w[I].morphTargets[L]]=-1;for(const L in T){const P=[],C=[];for(let O=0;O!==w[I].morphTargets.length;++O){const z=w[I];P.push(z.time),C.push(z.morphTarget===L?1:0)}r.push(new pg(".morphTargetInfluence["+L+"]",P,C))}d=T.length*a}else{const T=".bones["+t[_].name+"]";i(gg,T+".position",w,"pos",r),i(mg,T+".quaternion",w,"rot",r),i(gg,T+".scale",w,"scl",r)}}return r.length===0?null:new this(s,d,r,o)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function tre(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return pg;case"vector":case"vector2":case"vector3":case"vector4":return gg;case"color":return KU;case"quaternion":return mg;case"bool":case"boolean":return kg;case"string":return Fg}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function nre(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=tre(n.type);if(n.times===void 0){const t=[],i=[];YU(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const nd={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class ire{constructor(e,t,i){const r=this;let s=!1,a=0,o=0,d;const p=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(g){o++,s===!1&&r.onStart!==void 0&&r.onStart(g,a,o),s=!0},this.itemEnd=function(g){a++,r.onProgress!==void 0&&r.onProgress(g,a,o),a===o&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(g){r.onError!==void 0&&r.onError(g)},this.resolveURL=function(g){return d?d(g):g},this.setURLModifier=function(g){return d=g,this},this.addHandler=function(g,_){return p.push(g,_),this},this.removeHandler=function(g){const _=p.indexOf(g);return _!==-1&&p.splice(_,2),this},this.getHandler=function(g){for(let _=0,w=p.length;_<w;_+=2){const T=p[_],I=p[_+1];if(T.global&&(T.lastIndex=0),T.test(g))return I}return null}}}const rre=new ire;class Og{constructor(e){this.manager=e!==void 0?e:rre,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Og.DEFAULT_MATERIAL_NAME="__DEFAULT";const yu={};class sre extends Error{constructor(e,t){super(e),this.response=t}}class JU extends Og{constructor(e){super(e)}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=nd.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(yu[e]!==void 0){yu[e].push({onLoad:t,onProgress:i,onError:r});return}yu[e]=[],yu[e].push({onLoad:t,onProgress:i,onError:r});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,d=this.responseType;fetch(a).then(p=>{if(p.status===200||p.status===0){if(p.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||p.body===void 0||p.body.getReader===void 0)return p;const g=yu[e],_=p.body.getReader(),w=p.headers.get("X-File-Size")||p.headers.get("Content-Length"),T=w?parseInt(w):0,I=T!==0;let L=0;const P=new ReadableStream({start(C){O();function O(){_.read().then(({done:z,value:H})=>{if(z)C.close();else{L+=H.byteLength;const Y=new ProgressEvent("progress",{lengthComputable:I,loaded:L,total:T});for(let ee=0,te=g.length;ee<te;ee++){const ce=g[ee];ce.onProgress&&ce.onProgress(Y)}C.enqueue(H),O()}},z=>{C.error(z)})}}});return new Response(P)}else throw new sre(`fetch for "${p.url}" responded with ${p.status}: ${p.statusText}`,p)}).then(p=>{switch(d){case"arraybuffer":return p.arrayBuffer();case"blob":return p.blob();case"document":return p.text().then(g=>new DOMParser().parseFromString(g,o));case"json":return p.json();default:if(o===void 0)return p.text();{const _=/charset="?([^;"\s]*)"?/i.exec(o),w=_&&_[1]?_[1].toLowerCase():void 0,T=new TextDecoder(w);return p.arrayBuffer().then(I=>T.decode(I))}}}).then(p=>{nd.add(e,p);const g=yu[e];delete yu[e];for(let _=0,w=g.length;_<w;_++){const T=g[_];T.onLoad&&T.onLoad(p)}}).catch(p=>{const g=yu[e];if(g===void 0)throw this.manager.itemError(e),p;delete yu[e];for(let _=0,w=g.length;_<w;_++){const T=g[_];T.onError&&T.onError(p)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class ore extends Og{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=nd.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const o=b0("img");function d(){g(),nd.add(e,this),t&&t(this),s.manager.itemEnd(e)}function p(_){g(),r&&r(_),s.manager.itemError(e),s.manager.itemEnd(e)}function g(){o.removeEventListener("load",d,!1),o.removeEventListener("error",p,!1)}return o.addEventListener("load",d,!1),o.addEventListener("error",p,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class are extends Og{constructor(e){super(e)}load(e,t,i,r){const s=new Fs,a=new ore(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(o){s.image=o,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}class pI extends Hr{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ci(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const uE=new ui,wk=new Ye,bk=new Ye;class mI{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Mi(512,512),this.map=null,this.mapPass=null,this.matrix=new ui,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new oI,this._frameExtents=new Mi(1,1),this._viewportCount=1,this._viewports=[new _r(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;wk.setFromMatrixPosition(e.matrixWorld),t.position.copy(wk),bk.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bk),t.updateMatrixWorld(),uE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uE),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(uE)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class lre extends mI{constructor(){super(new Qo(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,i=dg*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class cre extends pI{constructor(e,t,i=0,r=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.distance=i,this.angle=r,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new lre}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Sk=new ui,j_=new Ye,hE=new Ye;class ure extends mI{constructor(){super(new Qo(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Mi(4,2),this._viewportCount=6,this._viewports=[new _r(2,1,1,1),new _r(0,1,1,1),new _r(3,1,1,1),new _r(1,1,1,1),new _r(3,0,1,1),new _r(1,0,1,1)],this._cubeDirections=[new Ye(1,0,0),new Ye(-1,0,0),new Ye(0,0,1),new Ye(0,0,-1),new Ye(0,1,0),new Ye(0,-1,0)],this._cubeUps=[new Ye(0,1,0),new Ye(0,1,0),new Ye(0,1,0),new Ye(0,1,0),new Ye(0,0,1),new Ye(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,r=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),j_.setFromMatrixPosition(e.matrixWorld),i.position.copy(j_),hE.copy(i.position),hE.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(hE),i.updateMatrixWorld(),r.makeTranslation(-j_.x,-j_.y,-j_.z),Sk.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sk)}}class hre extends pI{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new ure}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class dre extends mI{constructor(){super(new aI(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class QU extends pI{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hr.DEFAULT_UP),this.updateMatrix(),this.target=new Hr,this.shadow=new dre}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class Ry{static decodeText(e){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class fre extends Og{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=nd.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(p=>{t&&t(p),s.manager.itemEnd(e)}).catch(p=>{r&&r(p)});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader;const d=fetch(e,o).then(function(p){return p.blob()}).then(function(p){return createImageBitmap(p,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(p){return nd.add(e,p),t&&t(p),s.manager.itemEnd(e),p}).catch(function(p){r&&r(p),nd.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});nd.add(e,d),s.manager.itemStart(e)}}const gI="\\[\\]\\.:\\/",pre=new RegExp("["+gI+"]","g"),_I="[^"+gI+"]",mre="[^"+gI.replace("\\.","")+"]",gre=/((?:WC+[\/:])*)/.source.replace("WC",_I),_re=/(WCOD+)?/.source.replace("WCOD",mre),yre=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_I),vre=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_I),xre=new RegExp("^"+gre+_re+yre+vre+"$"),wre=["material","materials","bones","map"];class bre{constructor(e,t,i){const r=i||lr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class lr{constructor(e,t,i){this.path=t,this.parsedPath=i||lr.parseTrackName(t),this.node=lr.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new lr.Composite(e,t,i):new lr(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(pre,"")}static parseTrackName(e){const t=xre.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);wre.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let a=0;a<s.length;a++){const o=s[a];if(o.name===t||o.uuid===t)return o;const d=i(o.children);if(d)return d}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=lr.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let p=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let g=0;g<e.length;g++)if(e[g].name===p){p=g;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(p!==void 0){if(e[p]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[p]}}const a=e[r];if(a===void 0){const p=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+p+"."+r+" but it wasn't found.",e);return}let o=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?o=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let d=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}d=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(d=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(d=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[d],this.setValue=this.SetterByBindingTypeAndVersioning[d][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lr.Composite=bre;lr.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lr.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lr.prototype.GetterByBindingType=[lr.prototype._getValue_direct,lr.prototype._getValue_array,lr.prototype._getValue_arrayElement,lr.prototype._getValue_toArray];lr.prototype.SetterByBindingTypeAndVersioning=[[lr.prototype._setValue_direct,lr.prototype._setValue_direct_setNeedsUpdate,lr.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_array,lr.prototype._setValue_array_setNeedsUpdate,lr.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_arrayElement,lr.prototype._setValue_arrayElement_setNeedsUpdate,lr.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lr.prototype._setValue_fromArray,lr.prototype._setValue_fromArray_setNeedsUpdate,lr.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Sre extends XU{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Wl;r.setAttribute("position",new Bl(t,3)),r.setAttribute("color",new Bl(i,3));const s=new hI({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new ci,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:XA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=XA);function Mk(n,e){if(e===tJ)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===I2||e===AU){let t=n.getIndex();if(t===null){const a=[],o=n.getAttribute("position");if(o!==void 0){for(let d=0;d<o.count;d++)a.push(d);n.setIndex(a),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const i=t.count-2,r=[];if(e===I2)for(let a=1;a<=i;a++)r.push(t.getX(0)),r.push(t.getX(a)),r.push(t.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(r.push(t.getX(a)),r.push(t.getX(a+1)),r.push(t.getX(a+2))):(r.push(t.getX(a+2)),r.push(t.getX(a+1)),r.push(t.getX(a)));r.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(r),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class Mre extends Og{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ire(t)}),this.register(function(t){return new Pre(t)}),this.register(function(t){return new Bre(t)}),this.register(function(t){return new Ure(t)}),this.register(function(t){return new Vre(t)}),this.register(function(t){return new Lre(t)}),this.register(function(t){return new Dre(t)}),this.register(function(t){return new kre(t)}),this.register(function(t){return new Fre(t)}),this.register(function(t){return new Are(t)}),this.register(function(t){return new Ore(t)}),this.register(function(t){return new Rre(t)}),this.register(function(t){return new zre(t)}),this.register(function(t){return new Nre(t)}),this.register(function(t){return new Tre(t)}),this.register(function(t){return new Gre(t)}),this.register(function(t){return new Hre(t)})}load(e,t,i,r){const s=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const p=Ry.extractUrlBase(e);a=Ry.resolveURL(p,this.path)}else a=Ry.extractUrlBase(e);this.manager.itemStart(e);const o=function(p){r?r(p):console.error(p),s.manager.itemError(e),s.manager.itemEnd(e)},d=new JU(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,function(p){try{s.parse(p,a,function(g){t(g),s.manager.itemEnd(e)},o)}catch(g){o(g)}},i,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,i,r){let s;const a={},o={},d=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(d.decode(new Uint8Array(e,0,4))===e5){try{a[Si.KHR_BINARY_GLTF]=new Wre(e)}catch(_){r&&r(_);return}s=JSON.parse(a[Si.KHR_BINARY_GLTF].content)}else s=JSON.parse(d.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const p=new ise(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});p.fileLoader.setRequestHeader(this.requestHeader);for(let g=0;g<this.pluginCallbacks.length;g++){const _=this.pluginCallbacks[g](p);_.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[_.name]=_,a[_.name]=!0}if(s.extensionsUsed)for(let g=0;g<s.extensionsUsed.length;++g){const _=s.extensionsUsed[g],w=s.extensionsRequired||[];switch(_){case Si.KHR_MATERIALS_UNLIT:a[_]=new Cre;break;case Si.KHR_DRACO_MESH_COMPRESSION:a[_]=new jre(s,this.dracoLoader);break;case Si.KHR_TEXTURE_TRANSFORM:a[_]=new $re;break;case Si.KHR_MESH_QUANTIZATION:a[_]=new qre;break;default:w.indexOf(_)>=0&&o[_]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+_+'".')}}p.setExtensions(a),p.setPlugins(o),p.parse(i,r)}parseAsync(e,t){const i=this;return new Promise(function(r,s){i.parse(e,t,r,s)})}}function Ere(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const Si={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Tre{constructor(e){this.parser=e,this.name=Si.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let i=0,r=t.length;i<r;i++){const s=t[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,i="light:"+e;let r=t.cache.get(i);if(r)return r;const s=t.json,d=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let p;const g=new ci(16777215);d.color!==void 0&&g.setRGB(d.color[0],d.color[1],d.color[2],Ys);const _=d.range!==void 0?d.range:0;switch(d.type){case"directional":p=new QU(g),p.target.position.set(0,0,-1),p.add(p.target);break;case"point":p=new hre(g),p.distance=_;break;case"spot":p=new cre(g),p.distance=_,d.spot=d.spot||{},d.spot.innerConeAngle=d.spot.innerConeAngle!==void 0?d.spot.innerConeAngle:0,d.spot.outerConeAngle=d.spot.outerConeAngle!==void 0?d.spot.outerConeAngle:Math.PI/4,p.angle=d.spot.outerConeAngle,p.penumbra=1-d.spot.innerConeAngle/d.spot.outerConeAngle,p.target.position.set(0,0,-1),p.add(p.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+d.type)}return p.position.set(0,0,0),p.decay=2,Eu(p,d),d.intensity!==void 0&&(p.intensity=d.intensity),p.name=t.createUniqueName(d.name||"light_"+e),r=Promise.resolve(p),t.cache.add(i,r),r}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,i=this.parser,s=i.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(d){return i._getNodeRef(t.cache,o,d)})}}class Cre{constructor(){this.name=Si.KHR_MATERIALS_UNLIT}getMaterialType(){return Mf}extendParams(e,t,i){const r=[];e.color=new ci(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.setRGB(a[0],a[1],a[2],Ys),e.opacity=a[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture,Oo))}return Promise.all(r)}}class Are{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class Ire{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Mi(o,o)}return Promise.all(s)}}class Pre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_DISPERSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class Rre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(i.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class Lre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new ci(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;t.sheenColor.setRGB(o[0],o[1],o[2],Ys)}return a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(i.assignTexture(t,"sheenColorMap",a.sheenColorTexture,Oo)),a.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class Dre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(i.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class kre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(i.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return t.attenuationColor=new ci().setRGB(o[0],o[1],o[2],Ys),Promise.all(s)}}class Fre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class Ore{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(i.assignTexture(t,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return t.specularColor=new ci().setRGB(o[0],o[1],o[2],Ys),a.specularColorTexture!==void 0&&s.push(i.assignTexture(t,"specularColorMap",a.specularColorTexture,Oo)),Promise.all(s)}}class Nre{constructor(e){this.parser=e,this.name=Si.EXT_MATERIALS_BUMP}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return t.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&s.push(i.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(s)}}class zre{constructor(e){this.parser=e,this.name=Si.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:Gc}extendMaterialParams(e,t){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],a=r.extensions[this.name];return a.anisotropyStrength!==void 0&&(t.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(t.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(i.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class Bre{constructor(e){this.parser=e,this.name=Si.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,i=t.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,a)}}class Ure{constructor(e){this.parser=e,this.name=Si.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=r.images[a.source];let d=i.textureLoader;if(o.uri){const p=i.options.manager.getHandler(o.uri);p!==null&&(d=p)}return this.detectSupport().then(function(p){if(p)return i.loadTextureImage(e,a.source,d);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Vre{constructor(e){this.parser=e,this.name=Si.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[t])return null;const a=s.extensions[t],o=r.images[a.source];let d=i.textureLoader;if(o.uri){const p=i.options.manager.getHandler(o.uri);p!==null&&(d=p)}return this.detectSupport().then(function(p){if(p)return i.loadTextureImage(e,a.source,d);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class Gre{constructor(e){this.name=Si.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,i=t.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const d=r.byteOffset||0,p=r.byteLength||0,g=r.count,_=r.byteStride,w=new Uint8Array(o,d,p);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(g,_,w,r.mode,r.filter).then(function(T){return T.buffer}):a.ready.then(function(){const T=new ArrayBuffer(g*_);return a.decodeGltfBuffer(new Uint8Array(T),g,_,w,r.mode,r.filter),T})})}else return null}}class Hre{constructor(e){this.name=Si.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,i=t.nodes[e];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const r=t.meshes[i.mesh];for(const p of r.primitives)if(p.mode!==Ka.TRIANGLES&&p.mode!==Ka.TRIANGLE_STRIP&&p.mode!==Ka.TRIANGLE_FAN&&p.mode!==void 0)return null;const a=i.extensions[this.name].attributes,o=[],d={};for(const p in a)o.push(this.parser.getDependency("accessor",a[p]).then(g=>(d[p]=g,d[p])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(p=>{const g=p.pop(),_=g.isGroup?g.children:[g],w=p[0].count,T=[];for(const I of _){const L=new ui,P=new Ye,C=new Pd,O=new Ye(1,1,1),z=new jie(I.geometry,I.material,w);for(let H=0;H<w;H++)d.TRANSLATION&&P.fromBufferAttribute(d.TRANSLATION,H),d.ROTATION&&C.fromBufferAttribute(d.ROTATION,H),d.SCALE&&O.fromBufferAttribute(d.SCALE,H),z.setMatrixAt(H,L.compose(P,C,O));for(const H in d)if(H==="_COLOR_0"){const Y=d[H];z.instanceColor=new L2(Y.array,Y.itemSize,Y.normalized)}else H!=="TRANSLATION"&&H!=="ROTATION"&&H!=="SCALE"&&I.geometry.setAttribute(H,d[H]);Hr.prototype.copy.call(z,I),this.parser.assignFinalMaterial(z),T.push(z)}return g.isGroup?(g.clear(),g.add(...T),g):T[0]}))}}const e5="glTF",$_=12,Ek={JSON:1313821514,BIN:5130562};class Wre{constructor(e){this.name=Si.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,$_),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==e5)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-$_,s=new DataView(e,$_);let a=0;for(;a<r;){const o=s.getUint32(a,!0);a+=4;const d=s.getUint32(a,!0);if(a+=4,d===Ek.JSON){const p=new Uint8Array(e,$_+a,o);this.content=i.decode(p)}else if(d===Ek.BIN){const p=$_+a;this.body=e.slice(p,p+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class jre{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Si.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},d={},p={};for(const g in a){const _=k2[g]||g.toLowerCase();o[_]=a[g]}for(const g in e.attributes){const _=k2[g]||g.toLowerCase();if(a[g]!==void 0){const w=i.accessors[e.attributes[g]],T=Gm[w.componentType];p[_]=T.name,d[_]=w.normalized===!0}}return t.getDependency("bufferView",s).then(function(g){return new Promise(function(_,w){r.decodeDracoFile(g,function(T){for(const I in T.attributes){const L=T.attributes[I],P=d[I];P!==void 0&&(L.normalized=P)}_(T)},o,p,Ys,w)})})}}class $re{constructor(){this.name=Si.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class qre{constructor(){this.name=Si.KHR_MESH_QUANTIZATION}}class t5 extends q0{constructor(e,t,i,r){super(e,t,i,r)}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let a=0;a!==r;a++)t[a]=i[s+a];return t}interpolate_(e,t,i,r){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,d=o*2,p=o*3,g=r-t,_=(i-t)/g,w=_*_,T=w*_,I=e*p,L=I-p,P=-2*T+3*w,C=T-w,O=1-P,z=C-w+_;for(let H=0;H!==o;H++){const Y=a[L+H+o],ee=a[L+H+d]*g,te=a[I+H+o],ce=a[I+H]*g;s[H]=O*Y+z*ee+P*te+C*ce}return s}}const Xre=new Pd;class Zre extends t5{interpolate_(e,t,i,r){const s=super.interpolate_(e,t,i,r);return Xre.fromArray(s).normalize().toArray(s),s}}const Ka={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Gm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Tk={9728:Bo,9729:Ca,9984:yU,9985:c1,9986:ay,9987:Lu},Ck={33071:td,33648:ww,10497:cg},dE={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},k2={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Bh={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yre={CUBICSPLINE:void 0,LINEAR:w0,STEP:x0},fE={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Kre(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new fI({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Xu})),n.DefaultMaterial}function uf(n,e,t){for(const i in t.extensions)n[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=t.extensions[i])}function Eu(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Jre(n,e,t){let i=!1,r=!1,s=!1;for(let p=0,g=e.length;p<g;p++){const _=e[p];if(_.POSITION!==void 0&&(i=!0),_.NORMAL!==void 0&&(r=!0),_.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(n);const a=[],o=[],d=[];for(let p=0,g=e.length;p<g;p++){const _=e[p];if(i){const w=_.POSITION!==void 0?t.getDependency("accessor",_.POSITION):n.attributes.position;a.push(w)}if(r){const w=_.NORMAL!==void 0?t.getDependency("accessor",_.NORMAL):n.attributes.normal;o.push(w)}if(s){const w=_.COLOR_0!==void 0?t.getDependency("accessor",_.COLOR_0):n.attributes.color;d.push(w)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(d)]).then(function(p){const g=p[0],_=p[1],w=p[2];return i&&(n.morphAttributes.position=g),r&&(n.morphAttributes.normal=_),s&&(n.morphAttributes.color=w),n.morphTargetsRelative=!0,n})}function Qre(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,i=e.weights.length;t<i;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let i=0,r=t.length;i<r;i++)n.morphTargetDictionary[t[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ese(n){let e;const t=n.extensions&&n.extensions[Si.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+pE(t.attributes):e=n.indices+":"+pE(n.attributes)+":"+n.mode,n.targets!==void 0)for(let i=0,r=n.targets.length;i<r;i++)e+=":"+pE(n.targets[i]);return e}function pE(n){let e="";const t=Object.keys(n).sort();for(let i=0,r=t.length;i<r;i++)e+=t[i]+":"+n[t[i]]+";";return e}function F2(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function tse(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const nse=new ui;class ise{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ere,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,r=-1,s=!1,a=-1;if(typeof navigator<"u"){const o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;const d=o.match(/Version\/(\d+)/);r=i&&d?parseInt(d[1],10):-1,s=o.indexOf("Firefox")>-1,a=s?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&r<17||s&&a<98?this.textureLoader=new are(this.options.manager):this.textureLoader=new fre(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new JU(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const o={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:i,userData:{}};return uf(s,o,r),Eu(o,r),Promise.all(i._invokeAll(function(d){return d.afterRoot&&d.afterRoot(o)})).then(function(){for(const d of o.scenes)d.updateMatrixWorld();e(o)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=t.length;r<s;r++){const a=t[r].joints;for(let o=0,d=a.length;o<d;o++)e[a[o]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,i){if(e.refs[t]<=1)return i;const r=i.clone(),s=(a,o)=>{const d=this.associations.get(a);d!=null&&this.associations.set(o,d);for(const[p,g]of a.children.entries())s(g,o.children[p])};return s(i,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let i=0;i<t.length;i++){const r=e(t[i]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const i=[];for(let r=0;r<t.length;r++){const s=e(t[r]);s&&i.push(s)}return i}getDependency(e,t){const i=e+":"+t;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:if(r=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!r)throw new Error("Unknown type: "+e);break}this.cache.add(i,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(s,a){return i.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],i=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[Si.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,a){i.load(Ry.resolveURL(t.uri,r.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(i){const r=t.byteLength||0,s=t.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const t=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0){const a=dE[r.type],o=Gm[r.componentType],d=r.normalized===!0,p=new o(r.count*a);return Promise.resolve(new Vo(p,a,d))}const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],d=dE[r.type],p=Gm[r.componentType],g=p.BYTES_PER_ELEMENT,_=g*d,w=r.byteOffset||0,T=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,I=r.normalized===!0;let L,P;if(T&&T!==_){const C=Math.floor(w/T),O="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+C+":"+r.count;let z=t.cache.get(O);z||(L=new p(o,C*T,r.count*T/g),z=new Uie(L,T/g),t.cache.add(O,z)),P=new cI(z,d,w%T/g,I)}else o===null?L=new p(r.count*d):L=new p(o,w,r.count*d),P=new Vo(L,d,I);if(r.sparse!==void 0){const C=dE.SCALAR,O=Gm[r.sparse.indices.componentType],z=r.sparse.indices.byteOffset||0,H=r.sparse.values.byteOffset||0,Y=new O(a[1],z,r.sparse.count*C),ee=new p(a[2],H,r.sparse.count*d);o!==null&&(P=new Vo(P.array.slice(),P.itemSize,P.normalized));for(let te=0,ce=Y.length;te<ce;te++){const K=Y[te];if(P.setX(K,ee[te*d]),d>=2&&P.setY(K,ee[te*d+1]),d>=3&&P.setZ(K,ee[te*d+2]),d>=4&&P.setW(K,ee[te*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return P})}loadTexture(e){const t=this.json,i=this.options,s=t.textures[e].source,a=t.images[s];let o=this.textureLoader;if(a.uri){const d=i.manager.getHandler(a.uri);d!==null&&(o=d)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,t,i){const r=this,s=this.json,a=s.textures[e],o=s.images[t],d=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[d])return this.textureCache[d];const p=this.loadImageSource(t,i).then(function(g){g.flipY=!1,g.name=a.name||o.name||"",g.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(g.name=o.uri);const w=(s.samplers||{})[a.sampler]||{};return g.magFilter=Tk[w.magFilter]||Ca,g.minFilter=Tk[w.minFilter]||Lu,g.wrapS=Ck[w.wrapS]||cg,g.wrapT=Ck[w.wrapT]||cg,r.associations.set(g,{textures:e}),g}).catch(function(){return null});return this.textureCache[d]=p,p}loadImageSource(e,t){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(_=>_.clone());const a=r.images[e],o=self.URL||self.webkitURL;let d=a.uri||"",p=!1;if(a.bufferView!==void 0)d=i.getDependency("bufferView",a.bufferView).then(function(_){p=!0;const w=new Blob([_],{type:a.mimeType});return d=o.createObjectURL(w),d});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const g=Promise.resolve(d).then(function(_){return new Promise(function(w,T){let I=w;t.isImageBitmapLoader===!0&&(I=function(L){const P=new Fs(L);P.needsUpdate=!0,w(P)}),t.load(Ry.resolveURL(_,s.path),I,void 0,T)})}).then(function(_){return p===!0&&o.revokeObjectURL(d),Eu(_,a),_.userData.mimeType=a.mimeType||tse(a.uri),_}).catch(function(_){throw console.error("THREE.GLTFLoader: Couldn't load texture",d),_});return this.sourceCache[e]=g,g}assignTexture(e,t,i,r){const s=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),s.extensions[Si.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[Si.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const d=s.associations.get(a);a=s.extensions[Si.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,d)}}return r!==void 0&&(a.colorSpace=r),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let i=e.material;const r=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+i.uuid;let d=this.cache.get(o);d||(d=new ZU,Oc.prototype.copy.call(d,i),d.color.copy(i.color),d.map=i.map,d.sizeAttenuation=!1,this.cache.add(o,d)),i=d}else if(e.isLine){const o="LineBasicMaterial:"+i.uuid;let d=this.cache.get(o);d||(d=new hI,Oc.prototype.copy.call(d,i),d.color.copy(i.color),d.map=i.map,this.cache.add(o,d)),i=d}if(r||s||a){let o="ClonedMaterial:"+i.uuid+":";r&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let d=this.cache.get(o);d||(d=i.clone(),s&&(d.vertexColors=!0),a&&(d.flatShading=!0),r&&(d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(o,d),this.associations.set(d,this.associations.get(i))),i=d}e.material=i}getMaterialType(){return fI}loadMaterial(e){const t=this,i=this.json,r=this.extensions,s=i.materials[e];let a;const o={},d=s.extensions||{},p=[];if(d[Si.KHR_MATERIALS_UNLIT]){const _=r[Si.KHR_MATERIALS_UNLIT];a=_.getMaterialType(),p.push(_.extendParams(o,s,t))}else{const _=s.pbrMetallicRoughness||{};if(o.color=new ci(1,1,1),o.opacity=1,Array.isArray(_.baseColorFactor)){const w=_.baseColorFactor;o.color.setRGB(w[0],w[1],w[2],Ys),o.opacity=w[3]}_.baseColorTexture!==void 0&&p.push(t.assignTexture(o,"map",_.baseColorTexture,Oo)),o.metalness=_.metallicFactor!==void 0?_.metallicFactor:1,o.roughness=_.roughnessFactor!==void 0?_.roughnessFactor:1,_.metallicRoughnessTexture!==void 0&&(p.push(t.assignTexture(o,"metalnessMap",_.metallicRoughnessTexture)),p.push(t.assignTexture(o,"roughnessMap",_.metallicRoughnessTexture))),a=this._invokeOne(function(w){return w.getMaterialType&&w.getMaterialType(e)}),p.push(Promise.all(this._invokeAll(function(w){return w.extendMaterialParams&&w.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=Ec);const g=s.alphaMode||fE.OPAQUE;if(g===fE.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,g===fE.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==Mf&&(p.push(t.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new Mi(1,1),s.normalTexture.scale!==void 0)){const _=s.normalTexture.scale;o.normalScale.set(_,_)}if(s.occlusionTexture!==void 0&&a!==Mf&&(p.push(t.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==Mf){const _=s.emissiveFactor;o.emissive=new ci().setRGB(_[0],_[1],_[2],Ys)}return s.emissiveTexture!==void 0&&a!==Mf&&p.push(t.assignTexture(o,"emissiveMap",s.emissiveTexture,Oo)),Promise.all(p).then(function(){const _=new a(o);return s.name&&(_.name=s.name),Eu(_,s),t.associations.set(_,{materials:e}),s.extensions&&uf(r,_,s),_})}createUniqueName(e){const t=lr.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,i=this.extensions,r=this.primitiveCache;function s(o){return i[Si.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,t).then(function(d){return Ak(d,o,t)})}const a=[];for(let o=0,d=e.length;o<d;o++){const p=e[o],g=ese(p),_=r[g];if(_)a.push(_.promise);else{let w;p.extensions&&p.extensions[Si.KHR_DRACO_MESH_COMPRESSION]?w=s(p):w=Ak(new Wl,p,t),r[g]={primitive:p,promise:w},a.push(w)}}return Promise.all(a)}loadMesh(e){const t=this,i=this.json,r=this.extensions,s=i.meshes[e],a=s.primitives,o=[];for(let d=0,p=a.length;d<p;d++){const g=a[d].material===void 0?Kre(this.cache):this.getDependency("material",a[d].material);o.push(g)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(d){const p=d.slice(0,d.length-1),g=d[d.length-1],_=[];for(let T=0,I=g.length;T<I;T++){const L=g[T],P=a[T];let C;const O=p[T];if(P.mode===Ka.TRIANGLES||P.mode===Ka.TRIANGLE_STRIP||P.mode===Ka.TRIANGLE_FAN||P.mode===void 0)C=s.isSkinnedMesh===!0?new Gie(L,O):new Pa(L,O),C.isSkinnedMesh===!0&&C.normalizeSkinWeights(),P.mode===Ka.TRIANGLE_STRIP?C.geometry=Mk(C.geometry,AU):P.mode===Ka.TRIANGLE_FAN&&(C.geometry=Mk(C.geometry,I2));else if(P.mode===Ka.LINES)C=new XU(L,O);else if(P.mode===Ka.LINE_STRIP)C=new dI(L,O);else if(P.mode===Ka.LINE_LOOP)C=new $ie(L,O);else if(P.mode===Ka.POINTS)C=new qie(L,O);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+P.mode);Object.keys(C.geometry.morphAttributes).length>0&&Qre(C,s),C.name=t.createUniqueName(s.name||"mesh_"+e),Eu(C,s),P.extensions&&uf(r,C,P),t.assignFinalMaterial(C),_.push(C)}for(let T=0,I=_.length;T<I;T++)t.associations.set(_[T],{meshes:e,primitives:T});if(_.length===1)return s.extensions&&uf(r,_[0],s),_[0];const w=new Ef;s.extensions&&uf(r,w,s),t.associations.set(w,{meshes:e});for(let T=0,I=_.length;T<I;T++)w.add(_[T]);return w})}loadCamera(e){let t;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?t=new Qo(AJ.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(t=new aI(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(t.name=this.createUniqueName(i.name)),Eu(t,i),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],i=[];for(let r=0,s=t.joints.length;r<s;r++)i.push(this._loadNodeShallow(t.joints[r]));return t.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",t.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(r){const s=r.pop(),a=r,o=[],d=[];for(let p=0,g=a.length;p<g;p++){const _=a[p];if(_){o.push(_);const w=new ui;s!==null&&w.fromArray(s.array,p*16),d.push(w)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[p])}return new uI(o,d)})}loadAnimation(e){const t=this.json,i=this,r=t.animations[e],s=r.name?r.name:"animation_"+e,a=[],o=[],d=[],p=[],g=[];for(let _=0,w=r.channels.length;_<w;_++){const T=r.channels[_],I=r.samplers[T.sampler],L=T.target,P=L.node,C=r.parameters!==void 0?r.parameters[I.input]:I.input,O=r.parameters!==void 0?r.parameters[I.output]:I.output;L.node!==void 0&&(a.push(this.getDependency("node",P)),o.push(this.getDependency("accessor",C)),d.push(this.getDependency("accessor",O)),p.push(I),g.push(L))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(d),Promise.all(p),Promise.all(g)]).then(function(_){const w=_[0],T=_[1],I=_[2],L=_[3],P=_[4],C=[];for(let O=0,z=w.length;O<z;O++){const H=w[O],Y=T[O],ee=I[O],te=L[O],ce=P[O];if(H===void 0)continue;H.updateMatrix&&H.updateMatrix();const K=i._createAnimationTracks(H,Y,ee,te,ce);if(K)for(let Q=0;Q<K.length;Q++)C.push(K[Q])}return new ere(s,void 0,C)})}createNodeMesh(e){const t=this.json,i=this,r=t.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const a=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let d=0,p=r.weights.length;d<p;d++)o.morphTargetInfluences[d]=r.weights[d]}),a})}loadNode(e){const t=this.json,i=this,r=t.nodes[e],s=i._loadNodeShallow(e),a=[],o=r.children||[];for(let p=0,g=o.length;p<g;p++)a.push(i.getDependency("node",o[p]));const d=r.skin===void 0?Promise.resolve(null):i.getDependency("skin",r.skin);return Promise.all([s,Promise.all(a),d]).then(function(p){const g=p[0],_=p[1],w=p[2];w!==null&&g.traverse(function(T){T.isSkinnedMesh&&T.bind(w,nse)});for(let T=0,I=_.length;T<I;T++)g.add(_[T]);return g})}_loadNodeShallow(e){const t=this.json,i=this.extensions,r=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],a=s.name?r.createUniqueName(s.name):"",o=[],d=r._invokeOne(function(p){return p.createNodeMesh&&p.createNodeMesh(e)});return d&&o.push(d),s.camera!==void 0&&o.push(r.getDependency("camera",s.camera).then(function(p){return r._getNodeRef(r.cameraCache,s.camera,p)})),r._invokeAll(function(p){return p.createNodeAttachment&&p.createNodeAttachment(e)}).forEach(function(p){o.push(p)}),this.nodeCache[e]=Promise.all(o).then(function(p){let g;if(s.isBone===!0?g=new $U:p.length>1?g=new Ef:p.length===1?g=p[0]:g=new Hr,g!==p[0])for(let _=0,w=p.length;_<w;_++)g.add(p[_]);if(s.name&&(g.userData.name=s.name,g.name=a),Eu(g,s),s.extensions&&uf(i,g,s),s.matrix!==void 0){const _=new ui;_.fromArray(s.matrix),g.applyMatrix4(_)}else s.translation!==void 0&&g.position.fromArray(s.translation),s.rotation!==void 0&&g.quaternion.fromArray(s.rotation),s.scale!==void 0&&g.scale.fromArray(s.scale);return r.associations.has(g)||r.associations.set(g,{}),r.associations.get(g).nodes=e,g}),this.nodeCache[e]}loadScene(e){const t=this.extensions,i=this.json.scenes[e],r=this,s=new Ef;i.name&&(s.name=r.createUniqueName(i.name)),Eu(s,i),i.extensions&&uf(t,s,i);const a=i.nodes||[],o=[];for(let d=0,p=a.length;d<p;d++)o.push(r.getDependency("node",a[d]));return Promise.all(o).then(function(d){for(let g=0,_=d.length;g<_;g++)s.add(d[g]);const p=g=>{const _=new Map;for(const[w,T]of r.associations)(w instanceof Oc||w instanceof Fs)&&_.set(w,T);return g.traverse(w=>{const T=r.associations.get(w);T!=null&&_.set(w,T)}),_};return r.associations=p(s),s})}_createAnimationTracks(e,t,i,r,s){const a=[],o=e.name?e.name:e.uuid,d=[];Bh[s.path]===Bh.weights?e.traverse(function(w){w.morphTargetInfluences&&d.push(w.name?w.name:w.uuid)}):d.push(o);let p;switch(Bh[s.path]){case Bh.weights:p=pg;break;case Bh.rotation:p=mg;break;case Bh.position:case Bh.scale:p=gg;break;default:switch(i.itemSize){case 1:p=pg;break;case 2:case 3:default:p=gg;break}break}const g=r.interpolation!==void 0?Yre[r.interpolation]:w0,_=this._getArrayFromAccessor(i);for(let w=0,T=d.length;w<T;w++){const I=new p(d[w]+"."+Bh[s.path],t.array,_,g);r.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(I),a.push(I)}return a}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const i=F2(t.constructor),r=new Float32Array(t.length);for(let s=0,a=t.length;s<a;s++)r[s]=t[s]*i;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(i){const r=this instanceof mg?Zre:t5;return new r(this.times,this.values,this.getValueSize()/3,i)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function rse(n,e,t){const i=e.attributes,r=new th;if(i.POSITION!==void 0){const o=t.json.accessors[i.POSITION],d=o.min,p=o.max;if(d!==void 0&&p!==void 0){if(r.set(new Ye(d[0],d[1],d[2]),new Ye(p[0],p[1],p[2])),o.normalized){const g=F2(Gm[o.componentType]);r.min.multiplyScalar(g),r.max.multiplyScalar(g)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new Ye,d=new Ye;for(let p=0,g=s.length;p<g;p++){const _=s[p];if(_.POSITION!==void 0){const w=t.json.accessors[_.POSITION],T=w.min,I=w.max;if(T!==void 0&&I!==void 0){if(d.setX(Math.max(Math.abs(T[0]),Math.abs(I[0]))),d.setY(Math.max(Math.abs(T[1]),Math.abs(I[1]))),d.setZ(Math.max(Math.abs(T[2]),Math.abs(I[2]))),w.normalized){const L=F2(Gm[w.componentType]);d.multiplyScalar(L)}o.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(o)}n.boundingBox=r;const a=new Vc;r.getCenter(a.center),a.radius=r.min.distanceTo(r.max)/2,n.boundingSphere=a}function Ak(n,e,t){const i=e.attributes,r=[];function s(a,o){return t.getDependency("accessor",a).then(function(d){n.setAttribute(o,d)})}for(const a in i){const o=k2[a]||a.toLowerCase();o in n.attributes||r.push(s(i[a],o))}if(e.indices!==void 0&&!n.index){const a=t.getDependency("accessor",e.indices).then(function(o){n.setIndex(o)});r.push(a)}return $i.workingColorSpace!==Ys&&"COLOR_0"in i&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${$i.workingColorSpace}" not supported.`),Eu(n,e),rse(n,e,t),Promise.all(r).then(function(){return e.targets!==void 0?Jre(n,e.targets,t):n})}const sse=()=>{const n=Ht.useRef(null);return Ht.useEffect(()=>{async function e(){const t=new wu.Map({container:n.current,center:[11.5257,47.668],zoom:16.27,pitch:60,bearing:-28.5,antialias:!0,style:{version:8,layers:[{id:"baseColor",type:"background",paint:{"background-color":"#fff","background-opacity":1}},{id:"hills",type:"hillshade",source:"hillshadeSource",layout:{visibility:"visible"},paint:{"hillshade-shadow-color":"#473B24"}}],terrain:{source:"terrainSource",exaggeration:1},sources:{terrainSource:{type:"raster-dem",url:"https://demotiles.maplibre.org/terrain-tiles/tiles.json",tileSize:256},hillshadeSource:{type:"raster-dem",url:"https://demotiles.maplibre.org/terrain-tiles/tiles.json",tileSize:256}}}});function i(p,g){const _=p.meterInMercatorCoordinateUnits(),T=(g.x-p.x)/_,L=(p.y-g.y)/_;return{dEastMeter:T,dNorthMeter:L}}async function r(){return(await new Mre().loadAsync("https://maplibre.org/maplibre-gl-js/docs/assets/34M_17/34M_17.gltf")).scene}const s=new wu.LngLat(11.5255,47.6677),a=new wu.LngLat(11.527,47.6678),o=new wu.LngLat(11.5249,47.6676),d={id:"3d-model",type:"custom",renderingMode:"3d",onAdd:async(p,g)=>{const _=new sI,w=new Bie;w.rotateX(Math.PI/2),w.scale.multiply(new Ye(1,1,-1));const T=new QU(16777215);T.position.set(50,70,-30).normalize(),w.add(T);const I=new Sre(60);w.add(I);const L=p.queryTerrainElevation(s)||0,P=p.queryTerrainElevation(a)||0,C=p.queryTerrainElevation(o)||0,O=P-L,z=C-L,H=wu.MercatorCoordinate.fromLngLat(s),Y=wu.MercatorCoordinate.fromLngLat(a),ee=wu.MercatorCoordinate.fromLngLat(o),{dEastMeter:te,dNorthMeter:ce}=i(H,Y),{dEastMeter:K,dNorthMeter:Q}=i(H,ee),pe=await r(),ze=pe.clone();pe.position.set(te,O,ce),ze.position.set(K,z,Q),w.add(pe),w.add(ze);const Fe=new zie({canvas:p.getCanvas(),context:g,antialias:!0});Fe.autoClear=!1,d.camera=_,d.scene=w,d.renderer=Fe},render:(p,g)=>{const{camera:_,scene:w,renderer:T}=d;if(!_||!w||!T)return;const I=t.queryTerrainElevation(s)||0,L=wu.MercatorCoordinate.fromLngLat(s,I),P={translateX:L.x,translateY:L.y,translateZ:L.z,scale:L.meterInMercatorCoordinateUnits()},C=new ui().fromArray(g),O=new ui().makeTranslation(P.translateX,P.translateY,P.translateZ).scale(new Ye(P.scale,-P.scale,P.scale));_.projectionMatrix=C.multiply(O),T.resetState(),T.render(w,_),t.triggerRepaint()},camera:null,scene:null,renderer:null};return t.on("load",async()=>{t.addLayer(d)}),()=>{t.remove()}}e()},[]),ln.jsx("div",{ref:n,style:{width:"100%",height:"100vh"}})};var Ik=Object.prototype.toString,n5=function(e){var t=Ik.call(e),i=t==="[object Arguments]";return i||(i=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Ik.call(e.callee)==="[object Function]"),i},mE,Pk;function ose(){if(Pk)return mE;Pk=1;var n;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,i=n5,r=Object.prototype.propertyIsEnumerable,s=!r.call({toString:null},"toString"),a=r.call(function(){},"prototype"),o=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=function(w){var T=w.constructor;return T&&T.prototype===w},p={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},g=function(){if(typeof window>"u")return!1;for(var w in window)try{if(!p["$"+w]&&e.call(window,w)&&window[w]!==null&&typeof window[w]=="object")try{d(window[w])}catch{return!0}}catch{return!0}return!1}(),_=function(w){if(typeof window>"u"||!g)return d(w);try{return d(w)}catch{return!1}};n=function(T){var I=T!==null&&typeof T=="object",L=t.call(T)==="[object Function]",P=i(T),C=I&&t.call(T)==="[object String]",O=[];if(!I&&!L&&!P)throw new TypeError("Object.keys called on a non-object");var z=a&&L;if(C&&T.length>0&&!e.call(T,0))for(var H=0;H<T.length;++H)O.push(String(H));if(P&&T.length>0)for(var Y=0;Y<T.length;++Y)O.push(String(Y));else for(var ee in T)!(z&&ee==="prototype")&&e.call(T,ee)&&O.push(String(ee));if(s)for(var te=_(T),ce=0;ce<o.length;++ce)!(te&&o[ce]==="constructor")&&e.call(T,o[ce])&&O.push(o[ce]);return O}}return mE=n,mE}var ase=Array.prototype.slice,lse=n5,Rk=Object.keys,g1=Rk?function(e){return Rk(e)}:ose(),Lk=Object.keys;g1.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(i){return lse(i)?Lk(ase.call(i)):Lk(i)})}else Object.keys=g1;return Object.keys||g1};var yI=g1,cse=Error,use=EvalError,hse=RangeError,dse=ReferenceError,i5=SyntaxError,Rd=TypeError,fse=URIError,kb=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),i=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(i)!=="[object Symbol]")return!1;var r=42;e[t]=r;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==r||a.enumerable!==!0)return!1}return!0},Dk=typeof Symbol<"u"&&Symbol,pse=kb,vI=function(){return typeof Dk!="function"||typeof Symbol!="function"||typeof Dk("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:pse()},gE={__proto__:null,foo:{}},mse=Object,gse=function(){return{__proto__:gE}.foo===gE.foo&&!(gE instanceof mse)},_se="Function.prototype.bind called on incompatible ",yse=Object.prototype.toString,vse=Math.max,xse="[object Function]",kk=function(e,t){for(var i=[],r=0;r<e.length;r+=1)i[r]=e[r];for(var s=0;s<t.length;s+=1)i[s+e.length]=t[s];return i},wse=function(e,t){for(var i=[],r=t,s=0;r<e.length;r+=1,s+=1)i[s]=e[r];return i},bse=function(n,e){for(var t="",i=0;i<n.length;i+=1)t+=n[i],i+1<n.length&&(t+=e);return t},Sse=function(e){var t=this;if(typeof t!="function"||yse.apply(t)!==xse)throw new TypeError(_se+t);for(var i=wse(arguments,1),r,s=function(){if(this instanceof r){var g=t.apply(this,kk(i,arguments));return Object(g)===g?g:this}return t.apply(e,kk(i,arguments))},a=vse(0,t.length-i.length),o=[],d=0;d<a;d++)o[d]="$"+d;if(r=Function("binder","return function ("+bse(o,",")+"){ return binder.apply(this,arguments); }")(s),t.prototype){var p=function(){};p.prototype=t.prototype,r.prototype=new p,p.prototype=null}return r},Mse=Sse,xI=Function.prototype.bind||Mse,Ese=Function.prototype.call,Tse=Object.prototype.hasOwnProperty,Cse=xI,r5=Cse.call(Ese,Tse),Ii,Ase=cse,Ise=use,Pse=hse,Rse=dse,_g=i5,Hm=Rd,Lse=fse,s5=Function,_E=function(n){try{return s5('"use strict"; return ('+n+").constructor;")()}catch{}},If=Object.getOwnPropertyDescriptor;if(If)try{If({},"")}catch{If=null}var yE=function(){throw new Hm},Dse=If?function(){try{return arguments.callee,yE}catch{try{return If(arguments,"callee").get}catch{return yE}}}():yE,Yp=vI(),kse=gse(),Ps=Object.getPrototypeOf||(kse?function(n){return n.__proto__}:null),rm={},Fse=typeof Uint8Array>"u"||!Ps?Ii:Ps(Uint8Array),Pf={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Ii:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ii:ArrayBuffer,"%ArrayIteratorPrototype%":Yp&&Ps?Ps([][Symbol.iterator]()):Ii,"%AsyncFromSyncIteratorPrototype%":Ii,"%AsyncFunction%":rm,"%AsyncGenerator%":rm,"%AsyncGeneratorFunction%":rm,"%AsyncIteratorPrototype%":rm,"%Atomics%":typeof Atomics>"u"?Ii:Atomics,"%BigInt%":typeof BigInt>"u"?Ii:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Ii:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Ii:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ii:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Ase,"%eval%":eval,"%EvalError%":Ise,"%Float32Array%":typeof Float32Array>"u"?Ii:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ii:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ii:FinalizationRegistry,"%Function%":s5,"%GeneratorFunction%":rm,"%Int8Array%":typeof Int8Array>"u"?Ii:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ii:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ii:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Yp&&Ps?Ps(Ps([][Symbol.iterator]())):Ii,"%JSON%":typeof JSON=="object"?JSON:Ii,"%Map%":typeof Map>"u"?Ii:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Yp||!Ps?Ii:Ps(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ii:Promise,"%Proxy%":typeof Proxy>"u"?Ii:Proxy,"%RangeError%":Pse,"%ReferenceError%":Rse,"%Reflect%":typeof Reflect>"u"?Ii:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ii:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Yp||!Ps?Ii:Ps(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ii:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Yp&&Ps?Ps(""[Symbol.iterator]()):Ii,"%Symbol%":Yp?Symbol:Ii,"%SyntaxError%":_g,"%ThrowTypeError%":Dse,"%TypedArray%":Fse,"%TypeError%":Hm,"%Uint8Array%":typeof Uint8Array>"u"?Ii:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ii:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ii:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ii:Uint32Array,"%URIError%":Lse,"%WeakMap%":typeof WeakMap>"u"?Ii:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ii:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ii:WeakSet};if(Ps)try{null.error}catch(n){var Ose=Ps(Ps(n));Pf["%Error.prototype%"]=Ose}var Nse=function n(e){var t;if(e==="%AsyncFunction%")t=_E("async function () {}");else if(e==="%GeneratorFunction%")t=_E("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=_E("async function* () {}");else if(e==="%AsyncGenerator%"){var i=n("%AsyncGeneratorFunction%");i&&(t=i.prototype)}else if(e==="%AsyncIteratorPrototype%"){var r=n("%AsyncGenerator%");r&&Ps&&(t=Ps(r.prototype))}return Pf[e]=t,t},Fk={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},X0=xI,Aw=r5,zse=X0.call(Function.call,Array.prototype.concat),Bse=X0.call(Function.apply,Array.prototype.splice),Ok=X0.call(Function.call,String.prototype.replace),Iw=X0.call(Function.call,String.prototype.slice),Use=X0.call(Function.call,RegExp.prototype.exec),Vse=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Gse=/\\(\\)?/g,Hse=function(e){var t=Iw(e,0,1),i=Iw(e,-1);if(t==="%"&&i!=="%")throw new _g("invalid intrinsic syntax, expected closing `%`");if(i==="%"&&t!=="%")throw new _g("invalid intrinsic syntax, expected opening `%`");var r=[];return Ok(e,Vse,function(s,a,o,d){r[r.length]=o?Ok(d,Gse,"$1"):a||s}),r},Wse=function(e,t){var i=e,r;if(Aw(Fk,i)&&(r=Fk[i],i="%"+r[0]+"%"),Aw(Pf,i)){var s=Pf[i];if(s===rm&&(s=Nse(i)),typeof s>"u"&&!t)throw new Hm("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:s}}throw new _g("intrinsic "+e+" does not exist!")},Wc=function(e,t){if(typeof e!="string"||e.length===0)throw new Hm("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new Hm('"allowMissing" argument must be a boolean');if(Use(/^%?[^%]*%?$/,e)===null)throw new _g("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var i=Hse(e),r=i.length>0?i[0]:"",s=Wse("%"+r+"%",t),a=s.name,o=s.value,d=!1,p=s.alias;p&&(r=p[0],Bse(i,zse([0,1],p)));for(var g=1,_=!0;g<i.length;g+=1){var w=i[g],T=Iw(w,0,1),I=Iw(w,-1);if((T==='"'||T==="'"||T==="`"||I==='"'||I==="'"||I==="`")&&T!==I)throw new _g("property names with quotes must have matching quotes");if((w==="constructor"||!_)&&(d=!0),r+="."+w,a="%"+r+"%",Aw(Pf,a))o=Pf[a];else if(o!=null){if(!(w in o)){if(!t)throw new Hm("base intrinsic for "+e+" exists, but the property is not available.");return}if(If&&g+1>=i.length){var L=If(o,w);_=!!L,_&&"get"in L&&!("originalValue"in L.get)?o=L.get:o=o[w]}else _=Aw(o,w),o=o[w];_&&!d&&(Pf[a]=o)}}return o},vE,Nk;function wI(){if(Nk)return vE;Nk=1;var n=Wc,e=n("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return vE=e,vE}var jse=Wc,_1=jse("%Object.getOwnPropertyDescriptor%",!0);if(_1)try{_1([],"length")}catch{_1=null}var bI=_1,zk=wI(),$se=i5,Kp=Rd,Bk=bI,SI=function(e,t,i){if(!e||typeof e!="object"&&typeof e!="function")throw new Kp("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new Kp("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new Kp("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new Kp("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new Kp("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new Kp("`loose`, if provided, must be a boolean");var r=arguments.length>3?arguments[3]:null,s=arguments.length>4?arguments[4]:null,a=arguments.length>5?arguments[5]:null,o=arguments.length>6?arguments[6]:!1,d=!!Bk&&Bk(e,t);if(zk)zk(e,t,{configurable:a===null&&d?d.configurable:!a,enumerable:r===null&&d?d.enumerable:!r,value:i,writable:s===null&&d?d.writable:!s});else if(o||!r&&!s&&!a)e[t]=i;else throw new $se("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},O2=wI(),o5=function(){return!!O2};o5.hasArrayLengthDefineBug=function(){if(!O2)return null;try{return O2([],"length",{value:1}).length!==1}catch{return!0}};var MI=o5,qse=yI,Xse=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",Zse=Object.prototype.toString,Yse=Array.prototype.concat,Uk=SI,Kse=function(n){return typeof n=="function"&&Zse.call(n)==="[object Function]"},a5=MI(),Jse=function(n,e,t,i){if(e in n){if(i===!0){if(n[e]===t)return}else if(!Kse(i)||!i())return}a5?Uk(n,e,t,!0):Uk(n,e,t)},l5=function(n,e){var t=arguments.length>2?arguments[2]:{},i=qse(e);Xse&&(i=Yse.call(i,Object.getOwnPropertySymbols(e)));for(var r=0;r<i.length;r+=1)Jse(n,i[r],e[i[r]],t[i[r]])};l5.supportsDescriptors=!!a5;var Xf=l5,c5={exports:{}},Qse=Wc,Vk=SI,eoe=MI(),Gk=bI,Hk=Rd,toe=Qse("%Math.floor%"),noe=function(e,t){if(typeof e!="function")throw new Hk("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||toe(t)!==t)throw new Hk("`length` must be a positive 32-bit integer");var i=arguments.length>2&&!!arguments[2],r=!0,s=!0;if("length"in e&&Gk){var a=Gk(e,"length");a&&!a.configurable&&(r=!1),a&&!a.writable&&(s=!1)}return(r||s||!i)&&(eoe?Vk(e,"length",t,!0,!0):Vk(e,"length",t)),e};(function(n){var e=xI,t=Wc,i=noe,r=Rd,s=t("%Function.prototype.apply%"),a=t("%Function.prototype.call%"),o=t("%Reflect.apply%",!0)||e.call(a,s),d=wI(),p=t("%Math.max%");n.exports=function(w){if(typeof w!="function")throw new r("a function is required");var T=o(e,a,arguments);return i(T,1+p(0,w.length-(arguments.length-1)),!0)};var g=function(){return o(e,s,arguments)};d?d(n.exports,"apply",{value:g}):n.exports.apply=g})(c5);var Ng=c5.exports,u5=Wc,h5=Ng,ioe=h5(u5("String.prototype.indexOf")),hl=function(e,t){var i=u5(e,!!t);return typeof i=="function"&&ioe(e,".prototype.")>-1?h5(i):i},roe=yI,d5=kb(),f5=hl,Wk=Object,soe=f5("Array.prototype.push"),jk=f5("Object.prototype.propertyIsEnumerable"),ooe=d5?Object.getOwnPropertySymbols:null,p5=function(e,t){if(e==null)throw new TypeError("target must be an object");var i=Wk(e);if(arguments.length===1)return i;for(var r=1;r<arguments.length;++r){var s=Wk(arguments[r]),a=roe(s),o=d5&&(Object.getOwnPropertySymbols||ooe);if(o)for(var d=o(s),p=0;p<d.length;++p){var g=d[p];jk(s,g)&&soe(a,g)}for(var _=0;_<a.length;++_){var w=a[_];if(jk(s,w)){var T=s[w];i[w]=T}}}return i},xE=p5,aoe=function(){if(!Object.assign)return!1;for(var n="abcdefghijklmnopqrst",e=n.split(""),t={},i=0;i<e.length;++i)t[e[i]]=e[i];var r=Object.assign({},t),s="";for(var a in r)s+=a;return n!==s},loe=function(){if(!Object.assign||!Object.preventExtensions)return!1;var n=Object.preventExtensions({1:2});try{Object.assign(n,"xy")}catch{return n[1]==="y"}return!1},m5=function(){return!Object.assign||aoe()||loe()?xE:Object.assign},coe=Xf,uoe=m5,hoe=function(){var e=uoe();return coe(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},doe=Xf,foe=Ng,poe=p5,g5=m5,moe=hoe,goe=foe.apply(g5()),_5=function(e,t){return goe(Object,arguments)};doe(_5,{getPolyfill:g5,implementation:poe,shim:moe});var _oe=_5,S0=function(){return typeof(function(){}).name=="string"},Ly=Object.getOwnPropertyDescriptor;if(Ly)try{Ly([],"length")}catch{Ly=null}S0.functionsHaveConfigurableNames=function(){if(!S0()||!Ly)return!1;var e=Ly(function(){},"name");return!!e&&!!e.configurable};var yoe=Function.prototype.bind;S0.boundFunctionsHaveNames=function(){return S0()&&typeof yoe=="function"&&(function(){}).bind().name!==""};var voe=S0,$k=SI,xoe=MI(),woe=voe.functionsHaveConfigurableNames(),boe=Rd,Soe=function(e,t){if(typeof e!="function")throw new boe("`fn` is not a function");var i=arguments.length>2&&!!arguments[2];return(!i||woe)&&(xoe?$k(e,"name",t,!0,!0):$k(e,"name",t)),e},Moe=Soe,Eoe=Rd,Toe=Object,y5=Moe(function(){if(this==null||this!==Toe(this))throw new Eoe("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),Coe=y5,Aoe=Xf.supportsDescriptors,Ioe=Object.getOwnPropertyDescriptor,v5=function(){if(Aoe&&/a/mig.flags==="gim"){var e=Ioe(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",i={};if(Object.defineProperty(i,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(i,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return Coe},Poe=Xf.supportsDescriptors,Roe=v5,Loe=Object.getOwnPropertyDescriptor,Doe=Object.defineProperty,koe=TypeError,qk=Object.getPrototypeOf,Foe=/a/,Ooe=function(){if(!Poe||!qk)throw new koe("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=Roe(),t=qk(Foe),i=Loe(t,"flags");return(!i||i.get!==e)&&Doe(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},Noe=Xf,zoe=Ng,Boe=y5,x5=v5,Uoe=Ooe,w5=zoe(x5());Noe(w5,{getPolyfill:x5,implementation:Boe,shim:Uoe});var Voe=w5,y1={exports:{}},Goe=kb,Zf=function(){return Goe()&&!!Symbol.toStringTag},Hoe=Zf(),Woe=hl,N2=Woe("Object.prototype.toString"),Fb=function(e){return Hoe&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:N2(e)==="[object Arguments]"},b5=function(e){return Fb(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&N2(e)!=="[object Array]"&&N2(e.callee)==="[object Function]"},joe=function(){return Fb(arguments)}();Fb.isLegacyArguments=b5;var S5=joe?Fb:b5;const $oe=dV(g$);var EI=typeof Map=="function"&&Map.prototype,wE=Object.getOwnPropertyDescriptor&&EI?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Pw=EI&&wE&&typeof wE.get=="function"?wE.get:null,Xk=EI&&Map.prototype.forEach,TI=typeof Set=="function"&&Set.prototype,bE=Object.getOwnPropertyDescriptor&&TI?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Rw=TI&&bE&&typeof bE.get=="function"?bE.get:null,Zk=TI&&Set.prototype.forEach,qoe=typeof WeakMap=="function"&&WeakMap.prototype,Dy=qoe?WeakMap.prototype.has:null,Xoe=typeof WeakSet=="function"&&WeakSet.prototype,ky=Xoe?WeakSet.prototype.has:null,Zoe=typeof WeakRef=="function"&&WeakRef.prototype,Yk=Zoe?WeakRef.prototype.deref:null,Yoe=Boolean.prototype.valueOf,Koe=Object.prototype.toString,Joe=Function.prototype.toString,Qoe=String.prototype.match,CI=String.prototype.slice,id=String.prototype.replace,eae=String.prototype.toUpperCase,Kk=String.prototype.toLowerCase,M5=RegExp.prototype.test,Jk=Array.prototype.concat,wc=Array.prototype.join,tae=Array.prototype.slice,Qk=Math.floor,z2=typeof BigInt=="function"?BigInt.prototype.valueOf:null,SE=Object.getOwnPropertySymbols,B2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,yg=typeof Symbol=="function"&&typeof Symbol.iterator=="object",bo=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===yg||!0)?Symbol.toStringTag:null,E5=Object.prototype.propertyIsEnumerable,eF=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(n){return n.__proto__}:null);function tF(n,e){if(n===1/0||n===-1/0||n!==n||n&&n>-1e3&&n<1e3||M5.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof n=="number"){var i=n<0?-Qk(-n):Qk(n);if(i!==n){var r=String(i),s=CI.call(e,r.length+1);return id.call(r,t,"$&_")+"."+id.call(id.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return id.call(e,t,"$&_")}var U2=$oe,nF=U2.custom,iF=C5(nF)?nF:null,nae=function n(e,t,i,r){var s=t||{};if(Wh(s,"quoteStyle")&&s.quoteStyle!=="single"&&s.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Wh(s,"maxStringLength")&&(typeof s.maxStringLength=="number"?s.maxStringLength<0&&s.maxStringLength!==1/0:s.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var a=Wh(s,"customInspect")?s.customInspect:!0;if(typeof a!="boolean"&&a!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Wh(s,"indent")&&s.indent!==null&&s.indent!=="	"&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Wh(s,"numericSeparator")&&typeof s.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var o=s.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return I5(e,s);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var d=String(e);return o?tF(e,d):d}if(typeof e=="bigint"){var p=String(e)+"n";return o?tF(e,p):p}var g=typeof s.depth>"u"?5:s.depth;if(typeof i>"u"&&(i=0),i>=g&&g>0&&typeof e=="object")return V2(e)?"[Array]":"[Object]";var _=xae(s,i);if(typeof r>"u")r=[];else if(A5(r,e)>=0)return"[Circular]";function w(Fe,qe,et){if(qe&&(r=tae.call(r),r.push(qe)),et){var Ne={depth:s.depth};return Wh(s,"quoteStyle")&&(Ne.quoteStyle=s.quoteStyle),n(Fe,Ne,i+1,r)}return n(Fe,s,i+1,r)}if(typeof e=="function"&&!rF(e)){var T=hae(e),I=Wx(e,w);return"[Function"+(T?": "+T:" (anonymous)")+"]"+(I.length>0?" { "+wc.call(I,", ")+" }":"")}if(C5(e)){var L=yg?id.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):B2.call(e);return typeof e=="object"&&!yg?q_(L):L}if(_ae(e)){for(var P="<"+Kk.call(String(e.nodeName)),C=e.attributes||[],O=0;O<C.length;O++)P+=" "+C[O].name+"="+T5(iae(C[O].value),"double",s);return P+=">",e.childNodes&&e.childNodes.length&&(P+="..."),P+="</"+Kk.call(String(e.nodeName))+">",P}if(V2(e)){if(e.length===0)return"[]";var z=Wx(e,w);return _&&!vae(z)?"["+G2(z,_)+"]":"[ "+wc.call(z,", ")+" ]"}if(sae(e)){var H=Wx(e,w);return!("cause"in Error.prototype)&&"cause"in e&&!E5.call(e,"cause")?"{ ["+String(e)+"] "+wc.call(Jk.call("[cause]: "+w(e.cause),H),", ")+" }":H.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+wc.call(H,", ")+" }"}if(typeof e=="object"&&a){if(iF&&typeof e[iF]=="function"&&U2)return U2(e,{depth:g-i});if(a!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(dae(e)){var Y=[];return Xk&&Xk.call(e,function(Fe,qe){Y.push(w(qe,e,!0)+" => "+w(Fe,e))}),sF("Map",Pw.call(e),Y,_)}if(mae(e)){var ee=[];return Zk&&Zk.call(e,function(Fe){ee.push(w(Fe,e))}),sF("Set",Rw.call(e),ee,_)}if(fae(e))return ME("WeakMap");if(gae(e))return ME("WeakSet");if(pae(e))return ME("WeakRef");if(aae(e))return q_(w(Number(e)));if(cae(e))return q_(w(z2.call(e)));if(lae(e))return q_(Yoe.call(e));if(oae(e))return q_(w(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===Iu)return"{ [object globalThis] }";if(!rae(e)&&!rF(e)){var te=Wx(e,w),ce=eF?eF(e)===Object.prototype:e instanceof Object||e.constructor===Object,K=e instanceof Object?"":"null prototype",Q=!ce&&bo&&Object(e)===e&&bo in e?CI.call(Ld(e),8,-1):K?"Object":"",pe=ce||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",ze=pe+(Q||K?"["+wc.call(Jk.call([],Q||[],K||[]),": ")+"] ":"");return te.length===0?ze+"{}":_?ze+"{"+G2(te,_)+"}":ze+"{ "+wc.call(te,", ")+" }"}return String(e)};function T5(n,e,t){var i=(t.quoteStyle||e)==="double"?'"':"'";return i+n+i}function iae(n){return id.call(String(n),/"/g,"&quot;")}function V2(n){return Ld(n)==="[object Array]"&&(!bo||!(typeof n=="object"&&bo in n))}function rae(n){return Ld(n)==="[object Date]"&&(!bo||!(typeof n=="object"&&bo in n))}function rF(n){return Ld(n)==="[object RegExp]"&&(!bo||!(typeof n=="object"&&bo in n))}function sae(n){return Ld(n)==="[object Error]"&&(!bo||!(typeof n=="object"&&bo in n))}function oae(n){return Ld(n)==="[object String]"&&(!bo||!(typeof n=="object"&&bo in n))}function aae(n){return Ld(n)==="[object Number]"&&(!bo||!(typeof n=="object"&&bo in n))}function lae(n){return Ld(n)==="[object Boolean]"&&(!bo||!(typeof n=="object"&&bo in n))}function C5(n){if(yg)return n&&typeof n=="object"&&n instanceof Symbol;if(typeof n=="symbol")return!0;if(!n||typeof n!="object"||!B2)return!1;try{return B2.call(n),!0}catch{}return!1}function cae(n){if(!n||typeof n!="object"||!z2)return!1;try{return z2.call(n),!0}catch{}return!1}var uae=Object.prototype.hasOwnProperty||function(n){return n in this};function Wh(n,e){return uae.call(n,e)}function Ld(n){return Koe.call(n)}function hae(n){if(n.name)return n.name;var e=Qoe.call(Joe.call(n),/^function\s*([\w$]+)/);return e?e[1]:null}function A5(n,e){if(n.indexOf)return n.indexOf(e);for(var t=0,i=n.length;t<i;t++)if(n[t]===e)return t;return-1}function dae(n){if(!Pw||!n||typeof n!="object")return!1;try{Pw.call(n);try{Rw.call(n)}catch{return!0}return n instanceof Map}catch{}return!1}function fae(n){if(!Dy||!n||typeof n!="object")return!1;try{Dy.call(n,Dy);try{ky.call(n,ky)}catch{return!0}return n instanceof WeakMap}catch{}return!1}function pae(n){if(!Yk||!n||typeof n!="object")return!1;try{return Yk.call(n),!0}catch{}return!1}function mae(n){if(!Rw||!n||typeof n!="object")return!1;try{Rw.call(n);try{Pw.call(n)}catch{return!0}return n instanceof Set}catch{}return!1}function gae(n){if(!ky||!n||typeof n!="object")return!1;try{ky.call(n,ky);try{Dy.call(n,Dy)}catch{return!0}return n instanceof WeakSet}catch{}return!1}function _ae(n){return!n||typeof n!="object"?!1:typeof HTMLElement<"u"&&n instanceof HTMLElement?!0:typeof n.nodeName=="string"&&typeof n.getAttribute=="function"}function I5(n,e){if(n.length>e.maxStringLength){var t=n.length-e.maxStringLength,i="... "+t+" more character"+(t>1?"s":"");return I5(CI.call(n,0,e.maxStringLength),e)+i}var r=id.call(id.call(n,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,yae);return T5(r,"single",e)}function yae(n){var e=n.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+eae.call(e.toString(16))}function q_(n){return"Object("+n+")"}function ME(n){return n+" { ? }"}function sF(n,e,t,i){var r=i?G2(t,i):wc.call(t,", ");return n+" ("+e+") {"+r+"}"}function vae(n){for(var e=0;e<n.length;e++)if(A5(n[e],`
`)>=0)return!1;return!0}function xae(n,e){var t;if(n.indent==="	")t="	";else if(typeof n.indent=="number"&&n.indent>0)t=wc.call(Array(n.indent+1)," ");else return null;return{base:t,prev:wc.call(Array(e+1),t)}}function G2(n,e){if(n.length===0)return"";var t=`
`+e.prev+e.base;return t+wc.call(n,","+t)+`
`+e.prev}function Wx(n,e){var t=V2(n),i=[];if(t){i.length=n.length;for(var r=0;r<n.length;r++)i[r]=Wh(n,r)?e(n[r],n):""}var s=typeof SE=="function"?SE(n):[],a;if(yg){a={};for(var o=0;o<s.length;o++)a["$"+s[o]]=s[o]}for(var d in n)Wh(n,d)&&(t&&String(Number(d))===d&&d<n.length||yg&&a["$"+d]instanceof Symbol||(M5.call(/[^\w$]/,d)?i.push(e(d,n)+": "+e(n[d],n)):i.push(d+": "+e(n[d],n))));if(typeof SE=="function")for(var p=0;p<s.length;p++)E5.call(n,s[p])&&i.push("["+e(s[p])+"]: "+e(n[s[p]],n));return i}var P5=Wc,zg=hl,wae=nae,bae=Rd,jx=P5("%WeakMap%",!0),$x=P5("%Map%",!0),Sae=zg("WeakMap.prototype.get",!0),Mae=zg("WeakMap.prototype.set",!0),Eae=zg("WeakMap.prototype.has",!0),Tae=zg("Map.prototype.get",!0),Cae=zg("Map.prototype.set",!0),Aae=zg("Map.prototype.has",!0),AI=function(n,e){for(var t=n,i;(i=t.next)!==null;t=i)if(i.key===e)return t.next=i.next,i.next=n.next,n.next=i,i},Iae=function(n,e){var t=AI(n,e);return t&&t.value},Pae=function(n,e,t){var i=AI(n,e);i?i.value=t:n.next={key:e,next:n.next,value:t}},Rae=function(n,e){return!!AI(n,e)},R5=function(){var e,t,i,r={assert:function(s){if(!r.has(s))throw new bae("Side channel does not contain "+wae(s))},get:function(s){if(jx&&s&&(typeof s=="object"||typeof s=="function")){if(e)return Sae(e,s)}else if($x){if(t)return Tae(t,s)}else if(i)return Iae(i,s)},has:function(s){if(jx&&s&&(typeof s=="object"||typeof s=="function")){if(e)return Eae(e,s)}else if($x){if(t)return Aae(t,s)}else if(i)return Rae(i,s);return!1},set:function(s,a){jx&&s&&(typeof s=="object"||typeof s=="function")?(e||(e=new jx),Mae(e,s,a)):$x?(t||(t=new $x),Cae(t,s,a)):(i||(i={key:{},next:null}),Pae(i,s,a))}};return r},Lae=r5,X_=R5(),vu=Rd,II={assert:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new vu("`O` is not an object");if(typeof e!="string")throw new vu("`slot` must be a string");if(X_.assert(n),!II.has(n,e))throw new vu("`"+e+"` is not present on `O`")},get:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new vu("`O` is not an object");if(typeof e!="string")throw new vu("`slot` must be a string");var t=X_.get(n);return t&&t["$"+e]},has:function(n,e){if(!n||typeof n!="object"&&typeof n!="function")throw new vu("`O` is not an object");if(typeof e!="string")throw new vu("`slot` must be a string");var t=X_.get(n);return!!t&&Lae(t,"$"+e)},set:function(n,e,t){if(!n||typeof n!="object"&&typeof n!="function")throw new vu("`O` is not an object");if(typeof e!="string")throw new vu("`slot` must be a string");var i=X_.get(n);i||(i={},X_.set(n,i)),i["$"+e]=t}};Object.freeze&&Object.freeze(II);var Dae=II,Z_=Dae,kae=SyntaxError,oF=typeof StopIteration=="object"?StopIteration:null,Fae=function(e){if(!oF)throw new kae("this environment lacks StopIteration");Z_.set(e,"[[Done]]",!1);var t={next:function(){var r=Z_.get(this,"[[Iterator]]"),s=Z_.get(r,"[[Done]]");try{return{done:s,value:s?void 0:r.next()}}catch(a){if(Z_.set(r,"[[Done]]",!0),a!==oF)throw a;return{done:!0,value:void 0}}}};return Z_.set(t,"[[Iterator]]",e),t},Oae={}.toString,L5=Array.isArray||function(n){return Oae.call(n)=="[object Array]"},Nae=String.prototype.valueOf,zae=function(e){try{return Nae.call(e),!0}catch{return!1}},Bae=Object.prototype.toString,Uae="[object String]",Vae=Zf(),D5=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:Vae?zae(e):Bae.call(e)===Uae},PI=typeof Map=="function"&&Map.prototype?Map:null,Gae=typeof Set=="function"&&Set.prototype?Set:null,Lw;PI||(Lw=function(e){return!1});var k5=PI?Map.prototype.has:null,aF=Gae?Set.prototype.has:null;!Lw&&!k5&&(Lw=function(e){return!1});var F5=Lw||function(e){if(!e||typeof e!="object")return!1;try{if(k5.call(e),aF)try{aF.call(e)}catch{return!0}return e instanceof PI}catch{}return!1},Hae=typeof Map=="function"&&Map.prototype?Map:null,RI=typeof Set=="function"&&Set.prototype?Set:null,Dw;RI||(Dw=function(e){return!1});var lF=Hae?Map.prototype.has:null,O5=RI?Set.prototype.has:null;!Dw&&!O5&&(Dw=function(e){return!1});var N5=Dw||function(e){if(!e||typeof e!="object")return!1;try{if(O5.call(e),lF)try{lF.call(e)}catch{return!0}return e instanceof RI}catch{}return!1},cF=S5,uF=Fae;if(vI()||kb()){var EE=Symbol.iterator;y1.exports=function(e){if(e!=null&&typeof e[EE]<"u")return e[EE]();if(cF(e))return Array.prototype[EE].call(e)}}else{var Wae=L5,jae=D5,hF=Wc,$ae=hF("%Map%",!0),qae=hF("%Set%",!0),Tl=hl,dF=Tl("Array.prototype.push"),fF=Tl("String.prototype.charCodeAt"),Xae=Tl("String.prototype.slice"),Zae=function(e,t){var i=e.length;if(t+1>=i)return t+1;var r=fF(e,t);if(r<55296||r>56319)return t+1;var s=fF(e,t+1);return s<56320||s>57343?t+1:t+2},TE=function(e){var t=0;return{next:function(){var r=t>=e.length,s;return r||(s=e[t],t+=1),{done:r,value:s}}}},pF=function(e,t){if(Wae(e)||cF(e))return TE(e);if(jae(e)){var i=0;return{next:function(){var s=Zae(e,i),a=Xae(e,i,s);return i=s,{done:s>e.length,value:a}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!$ae&&!qae)y1.exports=function(e){if(e!=null)return pF(e,!0)};else{var Yae=F5,Kae=N5,mF=Tl("Map.prototype.forEach",!0),gF=Tl("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var _F=Tl("Map.prototype.iterator",!0),yF=Tl("Set.prototype.iterator",!0);var vF=Tl("Map.prototype.@@iterator",!0)||Tl("Map.prototype._es6-shim iterator_",!0),xF=Tl("Set.prototype.@@iterator",!0)||Tl("Set.prototype._es6-shim iterator_",!0),Jae=function(e){if(Yae(e)){if(_F)return uF(_F(e));if(vF)return vF(e);if(mF){var t=[];return mF(e,function(r,s){dF(t,[s,r])}),TE(t)}}if(Kae(e)){if(yF)return uF(yF(e));if(xF)return xF(e);if(gF){var i=[];return gF(e,function(r){dF(i,r)}),TE(i)}}};y1.exports=function(e){return Jae(e)||pF(e)}}}var Qae=y1.exports,wF=function(n){return n!==n},z5=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||wF(e)&&wF(t))},ele=z5,B5=function(){return typeof Object.is=="function"?Object.is:ele},tle=B5,nle=Xf,ile=function(){var e=tle();return nle(Object,{is:e},{is:function(){return Object.is!==e}}),e},rle=Xf,sle=Ng,ole=z5,U5=B5,ale=ile,V5=sle(U5(),Object);rle(V5,{getPolyfill:U5,implementation:ole,shim:ale});var lle=V5,cle=Ng,G5=hl,ule=Wc,H2=ule("%ArrayBuffer%",!0),v1=G5("ArrayBuffer.prototype.byteLength",!0),hle=G5("Object.prototype.toString"),bF=!!H2&&!v1&&new H2(0).slice,SF=!!bF&&cle(bF),H5=v1||SF?function(e){if(!e||typeof e!="object")return!1;try{return v1?v1(e):SF(e,0),!0}catch{return!1}}:H2?function(e){return hle(e)==="[object ArrayBuffer]"}:function(e){return!1},dle=Date.prototype.getDay,fle=function(e){try{return dle.call(e),!0}catch{return!1}},ple=Object.prototype.toString,mle="[object Date]",gle=Zf(),_le=function(e){return typeof e!="object"||e===null?!1:gle?fle(e):ple.call(e)===mle},W2=hl,W5=Zf(),j5,$5,j2,$2;if(W5){j5=W2("Object.prototype.hasOwnProperty"),$5=W2("RegExp.prototype.exec"),j2={};var CE=function(){throw j2};$2={toString:CE,valueOf:CE},typeof Symbol.toPrimitive=="symbol"&&($2[Symbol.toPrimitive]=CE)}var yle=W2("Object.prototype.toString"),vle=Object.getOwnPropertyDescriptor,xle="[object RegExp]",wle=W5?function(e){if(!e||typeof e!="object")return!1;var t=vle(e,"lastIndex"),i=t&&j5(t,"value");if(!i)return!1;try{$5(e,$2)}catch(r){return r===j2}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:yle(e)===xle},ble=hl,MF=ble("SharedArrayBuffer.prototype.byteLength",!0),Sle=MF?function(e){if(!e||typeof e!="object")return!1;try{return MF(e),!0}catch{return!1}}:function(e){return!1},Mle=Number.prototype.toString,Ele=function(e){try{return Mle.call(e),!0}catch{return!1}},Tle=Object.prototype.toString,Cle="[object Number]",Ale=Zf(),Ile=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:Ale?Ele(e):Tle.call(e)===Cle},q5=hl,Ple=q5("Boolean.prototype.toString"),Rle=q5("Object.prototype.toString"),Lle=function(e){try{return Ple(e),!0}catch{return!1}},Dle="[object Boolean]",kle=Zf(),Fle=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:kle&&Symbol.toStringTag in e?Lle(e):Rle(e)===Dle},q2={exports:{}},Ole=Object.prototype.toString,Nle=vI();if(Nle){var zle=Symbol.prototype.toString,Ble=/^Symbol\(.*\)$/,Ule=function(e){return typeof e.valueOf()!="symbol"?!1:Ble.test(zle.call(e))};q2.exports=function(e){if(typeof e=="symbol")return!0;if(Ole.call(e)!=="[object Symbol]")return!1;try{return Ule(e)}catch{return!1}}}else q2.exports=function(e){return!1};var Vle=q2.exports,X2={exports:{}},EF=typeof BigInt<"u"&&BigInt,Gle=function(){return typeof EF=="function"&&typeof BigInt=="function"&&typeof EF(42)=="bigint"&&typeof BigInt(42)=="bigint"},Hle=Gle();if(Hle){var Wle=BigInt.prototype.valueOf,jle=function(e){try{return Wle.call(e),!0}catch{}return!1};X2.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:jle(e)}}else X2.exports=function(e){return!1};var $le=X2.exports,qle=D5,Xle=Ile,Zle=Fle,Yle=Vle,Kle=$le,Jle=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(qle(e))return"String";if(Xle(e))return"Number";if(Zle(e))return"Boolean";if(Yle(e))return"Symbol";if(Kle(e))return"BigInt"},kw=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,TF=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Fw;kw||(Fw=function(e){return!1});var Z2=kw?kw.prototype.has:null,AE=TF?TF.prototype.has:null;!Fw&&!Z2&&(Fw=function(e){return!1});var Qle=Fw||function(e){if(!e||typeof e!="object")return!1;try{if(Z2.call(e,Z2),AE)try{AE.call(e,AE)}catch{return!0}return e instanceof kw}catch{}return!1},Y2={exports:{}},ece=Wc,X5=hl,tce=ece("%WeakSet%",!0),IE=X5("WeakSet.prototype.has",!0);if(IE){var PE=X5("WeakMap.prototype.has",!0);Y2.exports=function(e){if(!e||typeof e!="object")return!1;try{if(IE(e,IE),PE)try{PE(e,PE)}catch{return!0}return e instanceof tce}catch{}return!1}}else Y2.exports=function(e){return!1};var nce=Y2.exports,ice=F5,rce=N5,sce=Qle,oce=nce,ace=function(e){if(e&&typeof e=="object"){if(ice(e))return"Map";if(rce(e))return"Set";if(sce(e))return"WeakMap";if(oce(e))return"WeakSet"}return!1},Z5=Function.prototype.toString,Cm=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,K2,x1;if(typeof Cm=="function"&&typeof Object.defineProperty=="function")try{K2=Object.defineProperty({},"length",{get:function(){throw x1}}),x1={},Cm(function(){throw 42},null,K2)}catch(n){n!==x1&&(Cm=null)}else Cm=null;var lce=/^\s*class\b/,J2=function(e){try{var t=Z5.call(e);return lce.test(t)}catch{return!1}},RE=function(e){try{return J2(e)?!1:(Z5.call(e),!0)}catch{return!1}},w1=Object.prototype.toString,cce="[object Object]",uce="[object Function]",hce="[object GeneratorFunction]",dce="[object HTMLAllCollection]",fce="[object HTML document.all class]",pce="[object HTMLCollection]",mce=typeof Symbol=="function"&&!!Symbol.toStringTag,gce=!(0 in[,]),Q2=function(){return!1};if(typeof document=="object"){var _ce=document.all;w1.call(_ce)===w1.call(document.all)&&(Q2=function(e){if((gce||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=w1.call(e);return(t===dce||t===fce||t===pce||t===cce)&&e("")==null}catch{}return!1})}var yce=Cm?function(e){if(Q2(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{Cm(e,null,K2)}catch(t){if(t!==x1)return!1}return!J2(e)&&RE(e)}:function(e){if(Q2(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(mce)return RE(e);if(J2(e))return!1;var t=w1.call(e);return t!==uce&&t!==hce&&!/^\[object HTML/.test(t)?!1:RE(e)},vce=yce,xce=Object.prototype.toString,Y5=Object.prototype.hasOwnProperty,wce=function(e,t,i){for(var r=0,s=e.length;r<s;r++)Y5.call(e,r)&&(i==null?t(e[r],r,e):t.call(i,e[r],r,e))},bce=function(e,t,i){for(var r=0,s=e.length;r<s;r++)i==null?t(e.charAt(r),r,e):t.call(i,e.charAt(r),r,e)},Sce=function(e,t,i){for(var r in e)Y5.call(e,r)&&(i==null?t(e[r],r,e):t.call(i,e[r],r,e))},Mce=function(e,t,i){if(!vce(t))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),xce.call(e)==="[object Array]"?wce(e,t,r):typeof e=="string"?bce(e,t,r):Sce(e,t,r)},Ece=Mce,Tce=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],LE=Tce,Cce=typeof globalThis>"u"?Iu:globalThis,Ace=function(){for(var e=[],t=0;t<LE.length;t++)typeof Cce[LE[t]]=="function"&&(e[e.length]=LE[t]);return e},Ow=Ece,Ice=Ace,CF=Ng,LI=hl,b1=bI,Pce=LI("Object.prototype.toString"),K5=Zf(),AF=typeof globalThis>"u"?Iu:globalThis,eC=Ice(),DI=LI("String.prototype.slice"),DE=Object.getPrototypeOf,Rce=LI("Array.prototype.indexOf",!0)||function(e,t){for(var i=0;i<e.length;i+=1)if(e[i]===t)return i;return-1},Nw={__proto__:null};K5&&b1&&DE?Ow(eC,function(n){var e=new AF[n];if(Symbol.toStringTag in e){var t=DE(e),i=b1(t,Symbol.toStringTag);if(!i){var r=DE(t);i=b1(r,Symbol.toStringTag)}Nw["$"+n]=CF(i.get)}}):Ow(eC,function(n){var e=new AF[n],t=e.slice||e.set;t&&(Nw["$"+n]=CF(t))});var Lce=function(e){var t=!1;return Ow(Nw,function(i,r){if(!t)try{"$"+i(e)===r&&(t=DI(r,1))}catch{}}),t},Dce=function(e){var t=!1;return Ow(Nw,function(i,r){if(!t)try{i(e),t=DI(r,1)}catch{}}),t},kce=function(e){if(!e||typeof e!="object")return!1;if(!K5){var t=DI(Pce(e),8,-1);return Rce(eC,t)>-1?t:t!=="Object"?!1:Dce(e)}return b1?Lce(e):null},Fce=hl,IF=Fce("ArrayBuffer.prototype.byteLength",!0),Oce=H5,Nce=function(e){return Oce(e)?IF?IF(e):e.byteLength:NaN},J5=_oe,jc=hl,PF=Voe,zce=Wc,vg=Qae,Bce=R5,RF=lle,LF=S5,DF=L5,kF=H5,FF=_le,OF=wle,NF=Sle,zF=yI,BF=Jle,UF=ace,VF=kce,GF=Nce,HF=jc("SharedArrayBuffer.prototype.byteLength",!0),WF=jc("Date.prototype.getTime"),kE=Object.getPrototypeOf,jF=jc("Object.prototype.toString"),zw=zce("%Set%",!0),tC=jc("Map.prototype.has",!0),Bw=jc("Map.prototype.get",!0),$F=jc("Map.prototype.size",!0),Uw=jc("Set.prototype.add",!0),Q5=jc("Set.prototype.delete",!0),Vw=jc("Set.prototype.has",!0),S1=jc("Set.prototype.size",!0);function qF(n,e,t,i){for(var r=vg(n),s;(s=r.next())&&!s.done;)if(Ul(e,s.value,t,i))return Q5(n,s.value),!0;return!1}function e4(n){if(typeof n>"u")return null;if(typeof n!="object")return typeof n=="symbol"?!1:typeof n=="string"||typeof n=="number"?+n==+n:!0}function Uce(n,e,t,i,r,s){var a=e4(t);if(a!=null)return a;var o=Bw(e,a),d=J5({},r,{strict:!1});return typeof o>"u"&&!tC(e,a)||!Ul(i,o,d,s)?!1:!tC(n,a)&&Ul(i,o,d,s)}function Vce(n,e,t){var i=e4(t);return i??(Vw(e,i)&&!Vw(n,i))}function XF(n,e,t,i,r,s){for(var a=vg(n),o,d;(o=a.next())&&!o.done;)if(d=o.value,Ul(t,d,r,s)&&Ul(i,Bw(e,d),r,s))return Q5(n,d),!0;return!1}function Ul(n,e,t,i){var r=t||{};if(r.strict?RF(n,e):n===e)return!0;var s=BF(n),a=BF(e);if(s!==a)return!1;if(!n||!e||typeof n!="object"&&typeof e!="object")return r.strict?RF(n,e):n==e;var o=i.has(n),d=i.has(e),p;if(o&&d){if(i.get(n)===i.get(e))return!0}else p={};return o||i.set(n,p),d||i.set(e,p),Wce(n,e,r,i)}function ZF(n){return!n||typeof n!="object"||typeof n.length!="number"||typeof n.copy!="function"||typeof n.slice!="function"||n.length>0&&typeof n[0]!="number"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Gce(n,e,t,i){if(S1(n)!==S1(e))return!1;for(var r=vg(n),s=vg(e),a,o,d;(a=r.next())&&!a.done;)if(a.value&&typeof a.value=="object")d||(d=new zw),Uw(d,a.value);else if(!Vw(e,a.value)){if(t.strict||!Vce(n,e,a.value))return!1;d||(d=new zw),Uw(d,a.value)}if(d){for(;(o=s.next())&&!o.done;)if(o.value&&typeof o.value=="object"){if(!qF(d,o.value,t.strict,i))return!1}else if(!t.strict&&!Vw(n,o.value)&&!qF(d,o.value,t.strict,i))return!1;return S1(d)===0}return!0}function Hce(n,e,t,i){if($F(n)!==$F(e))return!1;for(var r=vg(n),s=vg(e),a,o,d,p,g,_;(a=r.next())&&!a.done;)if(p=a.value[0],g=a.value[1],p&&typeof p=="object")d||(d=new zw),Uw(d,p);else if(_=Bw(e,p),typeof _>"u"&&!tC(e,p)||!Ul(g,_,t,i)){if(t.strict||!Uce(n,e,p,g,t,i))return!1;d||(d=new zw),Uw(d,p)}if(d){for(;(o=s.next())&&!o.done;)if(p=o.value[0],_=o.value[1],p&&typeof p=="object"){if(!XF(d,n,p,_,t,i))return!1}else if(!t.strict&&(!n.has(p)||!Ul(Bw(n,p),_,t,i))&&!XF(d,n,p,_,J5({},t,{strict:!1}),i))return!1;return S1(d)===0}return!0}function Wce(n,e,t,i){var r,s;if(typeof n!=typeof e||n==null||e==null||jF(n)!==jF(e)||LF(n)!==LF(e))return!1;var a=DF(n),o=DF(e);if(a!==o)return!1;var d=n instanceof Error,p=e instanceof Error;if(d!==p||(d||p)&&(n.name!==e.name||n.message!==e.message))return!1;var g=OF(n),_=OF(e);if(g!==_||(g||_)&&(n.source!==e.source||PF(n)!==PF(e)))return!1;var w=FF(n),T=FF(e);if(w!==T||(w||T)&&WF(n)!==WF(e)||t.strict&&kE&&kE(n)!==kE(e))return!1;var I=VF(n),L=VF(e);if(I!==L)return!1;if(I||L){if(n.length!==e.length)return!1;for(r=0;r<n.length;r++)if(n[r]!==e[r])return!1;return!0}var P=ZF(n),C=ZF(e);if(P!==C)return!1;if(P||C){if(n.length!==e.length)return!1;for(r=0;r<n.length;r++)if(n[r]!==e[r])return!1;return!0}var O=kF(n),z=kF(e);if(O!==z)return!1;if(O||z)return GF(n)!==GF(e)?!1:typeof Uint8Array=="function"&&Ul(new Uint8Array(n),new Uint8Array(e),t,i);var H=NF(n),Y=NF(e);if(H!==Y)return!1;if(H||Y)return HF(n)!==HF(e)?!1:typeof Uint8Array=="function"&&Ul(new Uint8Array(n),new Uint8Array(e),t,i);if(typeof n!=typeof e)return!1;var ee=zF(n),te=zF(e);if(ee.length!==te.length)return!1;for(ee.sort(),te.sort(),r=ee.length-1;r>=0;r--)if(ee[r]!=te[r])return!1;for(r=ee.length-1;r>=0;r--)if(s=ee[r],!Ul(n[s],e[s],t,i))return!1;var ce=UF(n),K=UF(e);return ce!==K?!1:ce==="Set"||K==="Set"?Gce(n,e,t,i):ce==="Map"?Hce(n,e,t,i):!0}var jce=function(e,t,i){return Ul(e,t,i,Bce())};const $ce=Hw(jce);var qce=Object.defineProperty,hr=(n,e)=>qce(n,"name",{value:e,configurable:!0}),Xce=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,i,r;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(i=e==null?void 0:e.direction)!=null?i:!1,this.compareProperties=(r=e==null?void 0:e.compareProperties)!=null?r:!0}compare(e,t){if(e.type!==t.type||!cy(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const i=nC(e),r=nC(t);return i.every(s=>r.some(a=>this.compare(s,a)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((i,r)=>Math.abs(i-t[r])<this.precision)}compareLine(e,t,i=0,r=!1){if(!cy(e,t))return!1;const s=e;let a=t;if(r&&!this.compareCoord(s[0],a[0])){const d=this.fixStartIndex(a,s);if(d)a=d;else return!1}const o=this.compareCoord(s[i],a[i]);return this.direction||o?this.comparePath(s,a):this.compareCoord(s[i],a[a.length-(1+i)])?this.comparePath(s.slice().reverse(),a):!1}fixStartIndex(e,t){let i,r=-1;for(let s=0;s<e.length;s++)if(this.compareCoord(e[s],t[0])){r=s;break}return r>=0&&(i=[].concat(e.slice(r,e.length),e.slice(1,r+1))),i}comparePath(e,t){return e.every((i,r)=>this.compareCoord(i,t[r]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const i=e.coordinates.slice(1,e.coordinates.length),r=t.coordinates.slice(1,t.coordinates.length);return i.every(s=>r.some(a=>this.compareLine(s,a,1,!0)))}return!1}compareGeometryCollection(e,t){return cy(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((i,r)=>this.compare(i,t.geometries[r]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?$ce(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return cy(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((i,r)=>this.compare(i,t.features[r]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};hr(Xce,"GeojsonEquality");function cy(n,e){return n.coordinates?n.coordinates.length===e.coordinates.length:n.length===e.length}hr(cy,"sameLength");function nC(n){return n.coordinates.map(e=>({type:n.type.replace("Multi",""),coordinates:e}))}hr(nC,"explode");var Do=63710088e-1,t4={centimeters:Do*100,centimetres:Do*100,degrees:360/(2*Math.PI),feet:Do*3.28084,inches:Do*39.37,kilometers:Do/1e3,kilometres:Do/1e3,meters:Do,metres:Do,miles:Do/1609.344,millimeters:Do*1e3,millimetres:Do*1e3,nauticalmiles:Do/1852,radians:1,yards:Do*1.0936},YF={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Bc(n,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=n,i}hr(Bc,"feature");function Zce(n,e,t={}){switch(n){case"Point":return Au(e).geometry;case"LineString":return ku(e).geometry;case"Polygon":return kI(e).geometry;case"MultiPoint":return i4(e).geometry;case"MultiLineString":return n4(e).geometry;case"MultiPolygon":return r4(e).geometry;default:throw new Error(n+" is invalid")}}hr(Zce,"geometry");function Au(n,e,t={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gw(n[0])||!Gw(n[1]))throw new Error("coordinates must contain numbers");return Bc({type:"Point",coordinates:n},e,t)}hr(Au,"point");function Yce(n,e,t={}){return Ob(n.map(i=>Au(i,e)),t)}hr(Yce,"points");function kI(n,e,t={}){for(const r of n){if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(r[r.length-1].length!==r[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<r[r.length-1].length;s++)if(r[r.length-1][s]!==r[0][s])throw new Error("First and last Position are not equivalent.")}return Bc({type:"Polygon",coordinates:n},e,t)}hr(kI,"polygon");function Kce(n,e,t={}){return Ob(n.map(i=>kI(i,e)),t)}hr(Kce,"polygons");function ku(n,e,t={}){if(n.length<2)throw new Error("coordinates must be an array of two or more positions");return Bc({type:"LineString",coordinates:n},e,t)}hr(ku,"lineString");function Jce(n,e,t={}){return Ob(n.map(i=>ku(i,e)),t)}hr(Jce,"lineStrings");function Ob(n,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=n,t}hr(Ob,"featureCollection");function n4(n,e,t={}){return Bc({type:"MultiLineString",coordinates:n},e,t)}hr(n4,"multiLineString");function i4(n,e,t={}){return Bc({type:"MultiPoint",coordinates:n},e,t)}hr(i4,"multiPoint");function r4(n,e,t={}){return Bc({type:"MultiPolygon",coordinates:n},e,t)}hr(r4,"multiPolygon");function Qce(n,e,t={}){return Bc({type:"GeometryCollection",geometries:n},e,t)}hr(Qce,"geometryCollection");function eue(n,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(n*t)/t}hr(eue,"round");function s4(n,e="kilometers"){const t=t4[e];if(!t)throw new Error(e+" units is invalid");return n*t}hr(s4,"radiansToLength");function FI(n,e="kilometers"){const t=t4[e];if(!t)throw new Error(e+" units is invalid");return n/t}hr(FI,"lengthToRadians");function tue(n,e){return o4(FI(n,e))}hr(tue,"lengthToDegrees");function nue(n){let e=n%360;return e<0&&(e+=360),e}hr(nue,"bearingToAzimuth");function o4(n){return n%(2*Math.PI)*180/Math.PI}hr(o4,"radiansToDegrees");function iue(n){return n%360*Math.PI/180}hr(iue,"degreesToRadians");function rue(n,e="kilometers",t="kilometers"){if(!(n>=0))throw new Error("length must be a positive number");return s4(FI(n,e),t)}hr(rue,"convertLength");function sue(n,e="meters",t="kilometers"){if(!(n>=0))throw new Error("area must be a positive number");const i=YF[e];if(!i)throw new Error("invalid original units");const r=YF[t];if(!r)throw new Error("invalid final units");return n/i*r}hr(sue,"convertArea");function Gw(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}hr(Gw,"isNumber");function OI(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}hr(OI,"isObject");function oue(n){if(!n)throw new Error("bbox is required");if(!Array.isArray(n))throw new Error("bbox must be an Array");if(n.length!==4&&n.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");n.forEach(e=>{if(!Gw(e))throw new Error("bbox must only contain numbers")})}hr(oue,"validateBBox");function aue(n){if(!n)throw new Error("id is required");if(["string","number"].indexOf(typeof n)===-1)throw new Error("id must be a number or a string")}hr(aue,"validateId");var lue=Object.defineProperty,Ks=(n,e)=>lue(n,"name",{value:e,configurable:!0});function Z0(n,e,t){if(n!==null)for(var i,r,s,a,o,d,p,g=0,_=0,w,T=n.type,I=T==="FeatureCollection",L=T==="Feature",P=I?n.features.length:1,C=0;C<P;C++){p=I?n.features[C].geometry:L?n.geometry:n,w=p?p.type==="GeometryCollection":!1,o=w?p.geometries.length:1;for(var O=0;O<o;O++){var z=0,H=0;if(a=w?p.geometries[O]:p,a!==null){d=a.coordinates;var Y=a.type;switch(g=t&&(Y==="Polygon"||Y==="MultiPolygon")?1:0,Y){case null:break;case"Point":if(e(d,_,C,z,H)===!1)return!1;_++,z++;break;case"LineString":case"MultiPoint":for(i=0;i<d.length;i++){if(e(d[i],_,C,z,H)===!1)return!1;_++,Y==="MultiPoint"&&z++}Y==="LineString"&&z++;break;case"Polygon":case"MultiLineString":for(i=0;i<d.length;i++){for(r=0;r<d[i].length-g;r++){if(e(d[i][r],_,C,z,H)===!1)return!1;_++}Y==="MultiLineString"&&z++,Y==="Polygon"&&H++}Y==="Polygon"&&z++;break;case"MultiPolygon":for(i=0;i<d.length;i++){for(H=0,r=0;r<d[i].length;r++){for(s=0;s<d[i][r].length-g;s++){if(e(d[i][r][s],_,C,z,H)===!1)return!1;_++}H++}z++}break;case"GeometryCollection":for(i=0;i<a.geometries.length;i++)if(Z0(a.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Ks(Z0,"coordEach");function cue(n,e,t,i){var r=t;return Z0(n,function(s,a,o,d,p){a===0&&t===void 0?r=s:r=e(r,s,a,o,d,p)},i),r}Ks(cue,"coordReduce");function a4(n,e){var t;switch(n.type){case"FeatureCollection":for(t=0;t<n.features.length&&e(n.features[t].properties,t)!==!1;t++);break;case"Feature":e(n.properties,0);break}}Ks(a4,"propEach");function uue(n,e,t){var i=t;return a4(n,function(r,s){s===0&&t===void 0?i=r:i=e(i,r,s)}),i}Ks(uue,"propReduce");function l4(n,e){if(n.type==="Feature")e(n,0);else if(n.type==="FeatureCollection")for(var t=0;t<n.features.length&&e(n.features[t],t)!==!1;t++);}Ks(l4,"featureEach");function hue(n,e,t){var i=t;return l4(n,function(r,s){s===0&&t===void 0?i=r:i=e(i,r,s)}),i}Ks(hue,"featureReduce");function due(n){var e=[];return Z0(n,function(t){e.push(t)}),e}Ks(due,"coordAll");function NI(n,e){var t,i,r,s,a,o,d,p,g,_,w=0,T=n.type==="FeatureCollection",I=n.type==="Feature",L=T?n.features.length:1;for(t=0;t<L;t++){for(o=T?n.features[t].geometry:I?n.geometry:n,p=T?n.features[t].properties:I?n.properties:{},g=T?n.features[t].bbox:I?n.bbox:void 0,_=T?n.features[t].id:I?n.id:void 0,d=o?o.type==="GeometryCollection":!1,a=d?o.geometries.length:1,r=0;r<a;r++){if(s=d?o.geometries[r]:o,s===null){if(e(null,w,p,g,_)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,w,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(e(s.geometries[i],w,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}Ks(NI,"geomEach");function c4(n,e,t){var i=t;return NI(n,function(r,s,a,o,d){s===0&&t===void 0?i=r:i=e(i,r,s,a,o,d)}),i}Ks(c4,"geomReduce");function Nb(n,e){NI(n,function(t,i,r,s,a){var o=t===null?null:t.type;switch(o){case null:case"Point":case"LineString":case"Polygon":return e(Bc(t,r,{bbox:s,id:a}),i,0)===!1?!1:void 0}var d;switch(o){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Bc(_,r),i,p)===!1)return!1}})}Ks(Nb,"flattenEach");function fue(n,e,t){var i=t;return Nb(n,function(r,s,a){s===0&&a===0&&t===void 0?i=r:i=e(i,r,s,a)}),i}Ks(fue,"flattenReduce");function u4(n,e){Nb(n,function(t,i,r){var s=0;if(t.geometry){var a=t.geometry.type;if(!(a==="Point"||a==="MultiPoint")){var o,d=0,p=0,g=0;if(Z0(t,function(_,w,T,I,L){if(o===void 0||i>d||I>p||L>g){o=_,d=i,p=I,g=L,s=0;return}var P=ku([o,_],t.properties);if(e(P,i,r,L,s)===!1)return!1;s++,o=_})===!1)return!1}}})}Ks(u4,"segmentEach");function pue(n,e,t){var i=t,r=!1;return u4(n,function(s,a,o,d,p){r===!1&&t===void 0?i=s:i=e(i,s,a,o,d,p),r=!0}),i}Ks(pue,"segmentReduce");function h4(n,e){if(!n)throw new Error("geojson is required");Nb(n,function(t,i,r){if(t.geometry!==null){var s=t.geometry.type,a=t.geometry.coordinates;switch(s){case"LineString":if(e(t,i,r,0,0)===!1)return!1;break;case"Polygon":for(var o=0;o<a.length;o++)if(e(ku(a[o],t.properties),i,r,o)===!1)return!1;break}}})}Ks(h4,"lineEach");function mue(n,e,t){var i=t;return h4(n,function(r,s,a,o){s===0&&t===void 0?i=r:i=e(i,r,s,a,o)}),i}Ks(mue,"lineReduce");function gue(n,e){if(e=e||{},!OI(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,s=e.segmentIndex||0,a=e.properties,o;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),a=a||n.features[t].properties,o=n.features[t].geometry;break;case"Feature":a=a||n.properties,o=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":o=n;break;default:throw new Error("geojson is invalid")}if(o===null)return null;var d=o.coordinates;switch(o.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=d.length+s-1),ku([d[s],d[s+1]],a,e);case"Polygon":return r<0&&(r=d.length+r),s<0&&(s=d[r].length+s-1),ku([d[r][s],d[r][s+1]],a,e);case"MultiLineString":return i<0&&(i=d.length+i),s<0&&(s=d[i].length+s-1),ku([d[i][s],d[i][s+1]],a,e);case"MultiPolygon":return i<0&&(i=d.length+i),r<0&&(r=d[i].length+r),s<0&&(s=d[i][r].length-s-1),ku([d[i][r][s],d[i][r][s+1]],a,e)}throw new Error("geojson is invalid")}Ks(gue,"findSegment");function _ue(n,e){if(e=e||{},!OI(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,r=e.geometryIndex||0,s=e.coordIndex||0,a=e.properties,o;switch(n.type){case"FeatureCollection":t<0&&(t=n.features.length+t),a=a||n.features[t].properties,o=n.features[t].geometry;break;case"Feature":a=a||n.properties,o=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":o=n;break;default:throw new Error("geojson is invalid")}if(o===null)return null;var d=o.coordinates;switch(o.type){case"Point":return Au(d,a,e);case"MultiPoint":return i<0&&(i=d.length+i),Au(d[i],a,e);case"LineString":return s<0&&(s=d.length+s),Au(d[s],a,e);case"Polygon":return r<0&&(r=d.length+r),s<0&&(s=d[r].length+s),Au(d[r][s],a,e);case"MultiLineString":return i<0&&(i=d.length+i),s<0&&(s=d[i].length+s),Au(d[i][s],a,e);case"MultiPolygon":return i<0&&(i=d.length+i),r<0&&(r=d[i].length+r),s<0&&(s=d[i][r].length-s),Au(d[i][r][s],a,e)}throw new Error("geojson is invalid")}Ks(_ue,"findPoint");var yue=Object.defineProperty,zb=(n,e)=>yue(n,"name",{value:e,configurable:!0});function d4(n){return c4(n,(e,t)=>e+f4(t),0)}zb(d4,"area");function f4(n){let e=0,t;switch(n.type){case"Polygon":return iC(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)e+=iC(n.coordinates[t]);return e;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}zb(f4,"calculateArea");function iC(n){let e=0;if(n&&n.length>0){e+=Math.abs(rC(n[0]));for(let t=1;t<n.length;t++)e-=Math.abs(rC(n[t]))}return e}zb(iC,"polygonArea");var vue=Do*Do/2,FE=Math.PI/180;function rC(n){const e=n.length;if(e<=2)return 0;let t=0,i=0;for(;i<e;){const r=n[i],s=n[i+1===e?0:i+1],a=n[i+2>=e?(i+2)%e:i+2],o=r[0]*FE,d=s[1]*FE,p=a[0]*FE;t+=(p-o)*Math.sin(d),i++}return t*vue}zb(rC,"ringArea");var p4={exports:{}};(function(n,e){(function(t,i){n.exports=i()})(Iu,function(){var t=function(R,U){var ie={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},ve={on:function(De,He,Tt){if(ie[De]===void 0)throw new Error("Invalid event type: "+De);ie[De].push({selector:He,fn:Tt})},render:function(De){U.store.featureChanged(De)}},Le=function(De,He){for(var Tt=ie[De],Ot=Tt.length;Ot--;){var Kt=Tt[Ot];if(Kt.selector(He)){Kt.fn.call(ve,He)||U.store.render(),U.ui.updateMapClasses();break}}};return R.start.call(ve),{render:R.render,stop:function(){R.stop&&R.stop()},trash:function(){R.trash&&(R.trash(),U.store.render())},combineFeatures:function(){R.combineFeatures&&R.combineFeatures()},uncombineFeatures:function(){R.uncombineFeatures&&R.uncombineFeatures()},drag:function(De){Le("drag",De)},click:function(De){Le("click",De)},mousemove:function(De){Le("mousemove",De)},mousedown:function(De){Le("mousedown",De)},mouseup:function(De){Le("mouseup",De)},mouseout:function(De){Le("mouseout",De)},keydown:function(De){Le("keydown",De)},keyup:function(De){Le("keyup",De)},touchstart:function(De){Le("touchstart",De)},touchmove:function(De){Le("touchmove",De)},touchend:function(De){Le("touchend",De)},tap:function(De){Le("tap",De)}}};function i(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}function r(R){if(R.__esModule)return R;var U=R.default;if(typeof U=="function"){var ie=function ve(){if(this instanceof ve){var Le=[null];Le.push.apply(Le,arguments);var De=Function.bind.apply(U,Le);return new De}return U.apply(this,arguments)};ie.prototype=U.prototype}else ie={};return Object.defineProperty(ie,"__esModule",{value:!0}),Object.keys(R).forEach(function(ve){var Le=Object.getOwnPropertyDescriptor(R,ve);Object.defineProperty(ie,ve,Le.get?Le:{enumerable:!0,get:function(){return R[ve]}})}),ie}var s={},a={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},o=a;function d(R){var U=0;if(R&&R.length>0){U+=Math.abs(p(R[0]));for(var ie=1;ie<R.length;ie++)U-=Math.abs(p(R[ie]))}return U}function p(R){var U,ie,ve,Le,De,He,Tt=0,Ot=R.length;if(Ot>2){for(He=0;He<Ot;He++)He===Ot-2?(ve=Ot-2,Le=Ot-1,De=0):He===Ot-1?(ve=Ot-1,Le=0,De=1):(ve=He,Le=He+1,De=He+2),U=R[ve],ie=R[Le],Tt+=(g(R[De][0])-g(U[0]))*Math.sin(g(ie[1]));Tt=Tt*o.RADIUS*o.RADIUS/2}return Tt}function g(R){return R*Math.PI/180}s.geometry=function R(U){var ie,ve=0;switch(U.type){case"Polygon":return d(U.coordinates);case"MultiPolygon":for(ie=0;ie<U.coordinates.length;ie++)ve+=d(U.coordinates[ie]);return ve;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ie=0;ie<U.geometries.length;ie++)ve+=R(U.geometries[ie]);return ve}},s.ring=p;var _={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},w={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},T={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},I={POLYGON:"polygon",LINE:"line_string",POINT:"point"},L={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},P={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},C={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},O={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},z={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},H={ACTIVE:"true",INACTIVE:"false"},Y=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],ee=-85,te=Object.freeze({__proto__:null,classes:_,sources:w,cursors:T,types:I,geojsonTypes:L,modes:P,events:C,updateActions:O,meta:z,activeStates:H,interactions:Y,LAT_MIN:-90,LAT_RENDERED_MIN:ee,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),ce={Point:0,LineString:1,MultiLineString:1,Polygon:2};function K(R,U){var ie=ce[R.geometry.type]-ce[U.geometry.type];return ie===0&&R.geometry.type===L.POLYGON?R.area-U.area:ie}function Q(R){return R.map(function(U){return U.geometry.type===L.POLYGON&&(U.area=s.geometry({type:L.FEATURE,property:{},geometry:U.geometry})),U}).sort(K).map(function(U){return delete U.area,U})}function pe(R,U){return U===void 0&&(U=0),[[R.point.x-U,R.point.y-U],[R.point.x+U,R.point.y+U]]}function ze(R){if(this._items={},this._nums={},this._length=R?R.length:0,R)for(var U=0,ie=R.length;U<ie;U++)this.add(R[U]),R[U]!==void 0&&(typeof R[U]=="string"?this._items[R[U]]=U:this._nums[R[U]]=U)}ze.prototype.add=function(R){return this.has(R)||(this._length++,typeof R=="string"?this._items[R]=this._length:this._nums[R]=this._length),this},ze.prototype.delete=function(R){return this.has(R)===!1||(this._length--,delete this._items[R],delete this._nums[R]),this},ze.prototype.has=function(R){return(typeof R=="string"||typeof R=="number")&&(this._items[R]!==void 0||this._nums[R]!==void 0)},ze.prototype.values=function(){var R=this,U=[];return Object.keys(this._items).forEach(function(ie){U.push({k:ie,v:R._items[ie]})}),Object.keys(this._nums).forEach(function(ie){U.push({k:JSON.parse(ie),v:R._nums[ie]})}),U.sort(function(ie,ve){return ie.v-ve.v}).map(function(ie){return ie.k})},ze.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var Fe=[z.FEATURE,z.MIDPOINT,z.VERTEX],qe={click:function(R,U,ie){return et(R,U,ie,ie.options.clickBuffer)},touch:function(R,U,ie){return et(R,U,ie,ie.options.touchBuffer)}};function et(R,U,ie,ve){if(ie.map===null)return[];var Le=R?pe(R,ve):U,De={};ie.options.styles&&(De.layers=ie.options.styles.map(function(Kt){return Kt.id}).filter(function(Kt){return ie.map.getLayer(Kt)!=null}));var He=ie.map.queryRenderedFeatures(Le,De).filter(function(Kt){return Fe.indexOf(Kt.properties.meta)!==-1}),Tt=new ze,Ot=[];return He.forEach(function(Kt){var Yt=Kt.properties.id;Tt.has(Yt)||(Tt.add(Yt),Ot.push(Kt))}),Q(Ot)}function Ne(R,U){var ie=qe.click(R,null,U),ve={mouse:T.NONE};return ie[0]&&(ve.mouse=ie[0].properties.active===H.ACTIVE?T.MOVE:T.POINTER,ve.feature=ie[0].properties.meta),U.events.currentModeName().indexOf("draw")!==-1&&(ve.mouse=T.ADD),U.ui.queueMapClasses(ve),U.ui.updateMapClasses(),ie[0]}function st(R,U){var ie=R.x-U.x,ve=R.y-U.y;return Math.sqrt(ie*ie+ve*ve)}function Ee(R,U,ie){ie===void 0&&(ie={});var ve=ie.fineTolerance!=null?ie.fineTolerance:4,Le=ie.grossTolerance!=null?ie.grossTolerance:12,De=ie.interval!=null?ie.interval:500;R.point=R.point||U.point,R.time=R.time||U.time;var He=st(R.point,U.point);return He<ve||He<Le&&U.time-R.time<De}function ut(R,U,ie){ie===void 0&&(ie={});var ve=ie.tolerance!=null?ie.tolerance:25,Le=ie.interval!=null?ie.interval:250;return R.point=R.point||U.point,R.time=R.time||U.time,st(R.point,U.point)<ve&&U.time-R.time<Le}var ot={exports:{}},dt=ot.exports=function(R,U){if(U||(U=16),R===void 0&&(R=128),R<=0)return"0";for(var ie=Math.log(Math.pow(2,R))/Math.log(U),ve=2;ie===1/0;ve*=2)ie=Math.log(Math.pow(2,R/ve))/Math.log(U)*ve;var Le=ie-Math.floor(ie),De="";for(ve=0;ve<Math.floor(ie);ve++)De=Math.floor(Math.random()*U).toString(U)+De;if(Le){var He=Math.pow(U,Le);De=Math.floor(Math.random()*He).toString(U)+De}var Tt=parseInt(De,U);return Tt!==1/0&&Tt>=Math.pow(2,R)?dt(R,U):De};dt.rack=function(R,U,ie){var ve=function(De){var He=0;do{if(He++>10){if(!ie)throw new Error("too many ID collisions, use more bits");R+=ie}var Tt=dt(R,U)}while(Object.hasOwnProperty.call(Le,Tt));return Le[Tt]=De,Tt},Le=ve.hats={};return ve.get=function(De){return ve.hats[De]},ve.set=function(De,He){return ve.hats[De]=He,ve},ve.bits=R||128,ve.base=U||16,ve};var Ct=i(ot.exports),Vt=function(R,U){this.ctx=R,this.properties=U.properties||{},this.coordinates=U.geometry.coordinates,this.id=U.id||Ct(),this.type=U.geometry.type};Vt.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Vt.prototype.incomingCoords=function(R){this.setCoordinates(R)},Vt.prototype.setCoordinates=function(R){this.coordinates=R,this.changed()},Vt.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Vt.prototype.setProperty=function(R,U){this.properties[R]=U},Vt.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:L.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Vt.prototype.internal=function(R){var U={id:this.id,meta:z.FEATURE,"meta:type":this.type,active:H.INACTIVE,mode:R};if(this.ctx.options.userProperties)for(var ie in this.properties)U["user_"+ie]=this.properties[ie];return{type:L.FEATURE,properties:U,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Re=function(R,U){Vt.call(this,R,U)};(Re.prototype=Object.create(Vt.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},Re.prototype.updateCoordinate=function(R,U,ie){this.coordinates=arguments.length===3?[U,ie]:[R,U],this.changed()},Re.prototype.getCoordinate=function(){return this.getCoordinates()};var mt=function(R,U){Vt.call(this,R,U)};(mt.prototype=Object.create(Vt.prototype)).isValid=function(){return this.coordinates.length>1},mt.prototype.addCoordinate=function(R,U,ie){this.changed();var ve=parseInt(R,10);this.coordinates.splice(ve,0,[U,ie])},mt.prototype.getCoordinate=function(R){var U=parseInt(R,10);return JSON.parse(JSON.stringify(this.coordinates[U]))},mt.prototype.removeCoordinate=function(R){this.changed(),this.coordinates.splice(parseInt(R,10),1)},mt.prototype.updateCoordinate=function(R,U,ie){var ve=parseInt(R,10);this.coordinates[ve]=[U,ie],this.changed()};var Et=function(R,U){Vt.call(this,R,U),this.coordinates=this.coordinates.map(function(ie){return ie.slice(0,-1)})};(Et.prototype=Object.create(Vt.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(R){return R.length>2})},Et.prototype.incomingCoords=function(R){this.coordinates=R.map(function(U){return U.slice(0,-1)}),this.changed()},Et.prototype.setCoordinates=function(R){this.coordinates=R,this.changed()},Et.prototype.addCoordinate=function(R,U,ie){this.changed();var ve=R.split(".").map(function(Le){return parseInt(Le,10)});this.coordinates[ve[0]].splice(ve[1],0,[U,ie])},Et.prototype.removeCoordinate=function(R){this.changed();var U=R.split(".").map(function(ve){return parseInt(ve,10)}),ie=this.coordinates[U[0]];ie&&(ie.splice(U[1],1),ie.length<3&&this.coordinates.splice(U[0],1))},Et.prototype.getCoordinate=function(R){var U=R.split(".").map(function(ve){return parseInt(ve,10)}),ie=this.coordinates[U[0]];return JSON.parse(JSON.stringify(ie[U[1]]))},Et.prototype.getCoordinates=function(){return this.coordinates.map(function(R){return R.concat([R[0]])})},Et.prototype.updateCoordinate=function(R,U,ie){this.changed();var ve=R.split("."),Le=parseInt(ve[0],10),De=parseInt(ve[1],10);this.coordinates[Le]===void 0&&(this.coordinates[Le]=[]),this.coordinates[Le][De]=[U,ie]};var It={MultiPoint:Re,MultiLineString:mt,MultiPolygon:Et},vn=function(R,U,ie,ve,Le){var De=ie.split("."),He=parseInt(De[0],10),Tt=De[1]?De.slice(1).join("."):null;return R[He][U](Tt,ve,Le)},xn=function(R,U){if(Vt.call(this,R,U),delete this.coordinates,this.model=It[U.geometry.type],this.model===void 0)throw new TypeError(U.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(U.geometry.coordinates)};function at(R){this.map=R.map,this.drawConfig=JSON.parse(JSON.stringify(R.options||{})),this._ctx=R}(xn.prototype=Object.create(Vt.prototype))._coordinatesToFeatures=function(R){var U=this,ie=this.model.bind(this);return R.map(function(ve){return new ie(U.ctx,{id:Ct(),type:L.FEATURE,properties:{},geometry:{coordinates:ve,type:U.type.replace("Multi","")}})})},xn.prototype.isValid=function(){return this.features.every(function(R){return R.isValid()})},xn.prototype.setCoordinates=function(R){this.features=this._coordinatesToFeatures(R),this.changed()},xn.prototype.getCoordinate=function(R){return vn(this.features,"getCoordinate",R)},xn.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(R){return R.type===L.POLYGON?R.getCoordinates():R.coordinates})))},xn.prototype.updateCoordinate=function(R,U,ie){vn(this.features,"updateCoordinate",R,U,ie),this.changed()},xn.prototype.addCoordinate=function(R,U,ie){vn(this.features,"addCoordinate",R,U,ie),this.changed()},xn.prototype.removeCoordinate=function(R){vn(this.features,"removeCoordinate",R),this.changed()},xn.prototype.getFeatures=function(){return this.features},at.prototype.setSelected=function(R){return this._ctx.store.setSelected(R)},at.prototype.setSelectedCoordinates=function(R){var U=this;this._ctx.store.setSelectedCoordinates(R),R.reduce(function(ie,ve){return ie[ve.feature_id]===void 0&&(ie[ve.feature_id]=!0,U._ctx.store.get(ve.feature_id).changed()),ie},{})},at.prototype.getSelected=function(){return this._ctx.store.getSelected()},at.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},at.prototype.isSelected=function(R){return this._ctx.store.isSelected(R)},at.prototype.getFeature=function(R){return this._ctx.store.get(R)},at.prototype.select=function(R){return this._ctx.store.select(R)},at.prototype.deselect=function(R){return this._ctx.store.deselect(R)},at.prototype.deleteFeature=function(R,U){return U===void 0&&(U={}),this._ctx.store.delete(R,U)},at.prototype.addFeature=function(R){return this._ctx.store.add(R)},at.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},at.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},at.prototype.setActionableState=function(R){R===void 0&&(R={});var U={trash:R.trash||!1,combineFeatures:R.combineFeatures||!1,uncombineFeatures:R.uncombineFeatures||!1};return this._ctx.events.actionable(U)},at.prototype.changeMode=function(R,U,ie){return U===void 0&&(U={}),ie===void 0&&(ie={}),this._ctx.events.changeMode(R,U,ie)},at.prototype.updateUIClasses=function(R){return this._ctx.ui.queueMapClasses(R)},at.prototype.activateUIButton=function(R){return this._ctx.ui.setActiveButton(R)},at.prototype.featuresAt=function(R,U,ie){if(ie===void 0&&(ie="click"),ie!=="click"&&ie!=="touch")throw new Error("invalid buffer type");return qe[ie](R,U,this._ctx)},at.prototype.newFeature=function(R){var U=R.geometry.type;return U===L.POINT?new Re(this._ctx,R):U===L.LINE_STRING?new mt(this._ctx,R):U===L.POLYGON?new Et(this._ctx,R):new xn(this._ctx,R)},at.prototype.isInstanceOf=function(R,U){if(R===L.POINT)return U instanceof Re;if(R===L.LINE_STRING)return U instanceof mt;if(R===L.POLYGON)return U instanceof Et;if(R==="MultiFeature")return U instanceof xn;throw new Error("Unknown feature class: "+R)},at.prototype.doRender=function(R){return this._ctx.store.featureChanged(R)},at.prototype.onSetup=function(){},at.prototype.onDrag=function(){},at.prototype.onClick=function(){},at.prototype.onMouseMove=function(){},at.prototype.onMouseDown=function(){},at.prototype.onMouseUp=function(){},at.prototype.onMouseOut=function(){},at.prototype.onKeyUp=function(){},at.prototype.onKeyDown=function(){},at.prototype.onTouchStart=function(){},at.prototype.onTouchMove=function(){},at.prototype.onTouchEnd=function(){},at.prototype.onTap=function(){},at.prototype.onStop=function(){},at.prototype.onTrash=function(){},at.prototype.onCombineFeature=function(){},at.prototype.onUncombineFeature=function(){},at.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Rn={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Me=Object.keys(Rn);function Jn(R){var U=Object.keys(R);return function(ie,ve){ve===void 0&&(ve={});var Le={},De=U.reduce(function(He,Tt){return He[Tt]=R[Tt],He},new at(ie));return{start:function(){var He=this;Le=De.onSetup(ve),Me.forEach(function(Tt){var Ot,Kt=Rn[Tt],Yt=function(){return!1};R[Kt]&&(Yt=function(){return!0}),He.on(Tt,Yt,(Ot=Kt,function(Gt){return De[Ot](Le,Gt)}))})},stop:function(){De.onStop(Le)},trash:function(){De.onTrash(Le)},combineFeatures:function(){De.onCombineFeatures(Le)},uncombineFeatures:function(){De.onUncombineFeatures(Le)},render:function(He,Tt){De.toDisplayFeatures(Le,He,Tt)}}}}function on(R){return[].concat(R).filter(function(U){return U!==void 0})}function Vn(){var R=this;if(!(R.ctx.map&&R.ctx.map.getSource(w.HOT)!==void 0))return Ot();var U=R.ctx.events.currentModeName();R.ctx.ui.queueMapClasses({mode:U});var ie=[],ve=[];R.isDirty?ve=R.getAllIds():(ie=R.getChangedIds().filter(function(Kt){return R.get(Kt)!==void 0}),ve=R.sources.hot.filter(function(Kt){return Kt.properties.id&&ie.indexOf(Kt.properties.id)===-1&&R.get(Kt.properties.id)!==void 0}).map(function(Kt){return Kt.properties.id})),R.sources.hot=[];var Le=R.sources.cold.length;R.sources.cold=R.isDirty?[]:R.sources.cold.filter(function(Kt){var Yt=Kt.properties.id||Kt.properties.parent;return ie.indexOf(Yt)===-1});var De=Le!==R.sources.cold.length||ve.length>0;function He(Kt,Yt){var Gt=R.get(Kt).internal(U);R.ctx.events.currentModeRender(Gt,function(Nn){R.sources[Yt].push(Nn)})}if(ie.forEach(function(Kt){return He(Kt,"hot")}),ve.forEach(function(Kt){return He(Kt,"cold")}),De&&R.ctx.map.getSource(w.COLD).setData({type:L.FEATURE_COLLECTION,features:R.sources.cold}),R.ctx.map.getSource(w.HOT).setData({type:L.FEATURE_COLLECTION,features:R.sources.hot}),R._emitSelectionChange&&(R.ctx.map.fire(C.SELECTION_CHANGE,{features:R.getSelected().map(function(Kt){return Kt.toGeoJSON()}),points:R.getSelectedCoordinates().map(function(Kt){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:Kt.coordinates}}})}),R._emitSelectionChange=!1),R._deletedFeaturesToEmit.length){var Tt=R._deletedFeaturesToEmit.map(function(Kt){return Kt.toGeoJSON()});R._deletedFeaturesToEmit=[],R.ctx.map.fire(C.DELETE,{features:Tt})}function Ot(){R.isDirty=!1,R.clearChangedIds()}Ot(),R.ctx.map.fire(C.RENDER,{})}function Te(R){var U,ie=this;this._features={},this._featureIds=new ze,this._selectedFeatureIds=new ze,this._selectedCoordinates=[],this._changedFeatureIds=new ze,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=R,this.sources={hot:[],cold:[]},this.render=function(){U||(U=requestAnimationFrame(function(){U=null,Vn.call(ie)}))},this.isDirty=!1}function jn(R,U){var ie=R._selectedCoordinates.filter(function(ve){return R._selectedFeatureIds.has(ve.feature_id)});R._selectedCoordinates.length===ie.length||U.silent||(R._emitSelectionChange=!0),R._selectedCoordinates=ie}Te.prototype.createRenderBatch=function(){var R=this,U=this.render,ie=0;return this.render=function(){ie++},function(){R.render=U,ie>0&&R.render()}},Te.prototype.setDirty=function(){return this.isDirty=!0,this},Te.prototype.featureChanged=function(R){return this._changedFeatureIds.add(R),this},Te.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Te.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Te.prototype.getAllIds=function(){return this._featureIds.values()},Te.prototype.add=function(R){return this.featureChanged(R.id),this._features[R.id]=R,this._featureIds.add(R.id),this},Te.prototype.delete=function(R,U){var ie=this;return U===void 0&&(U={}),on(R).forEach(function(ve){ie._featureIds.has(ve)&&(ie._featureIds.delete(ve),ie._selectedFeatureIds.delete(ve),U.silent||ie._deletedFeaturesToEmit.indexOf(ie._features[ve])===-1&&ie._deletedFeaturesToEmit.push(ie._features[ve]),delete ie._features[ve],ie.isDirty=!0)}),jn(this,U),this},Te.prototype.get=function(R){return this._features[R]},Te.prototype.getAll=function(){var R=this;return Object.keys(this._features).map(function(U){return R._features[U]})},Te.prototype.select=function(R,U){var ie=this;return U===void 0&&(U={}),on(R).forEach(function(ve){ie._selectedFeatureIds.has(ve)||(ie._selectedFeatureIds.add(ve),ie._changedFeatureIds.add(ve),U.silent||(ie._emitSelectionChange=!0))}),this},Te.prototype.deselect=function(R,U){var ie=this;return U===void 0&&(U={}),on(R).forEach(function(ve){ie._selectedFeatureIds.has(ve)&&(ie._selectedFeatureIds.delete(ve),ie._changedFeatureIds.add(ve),U.silent||(ie._emitSelectionChange=!0))}),jn(this,U),this},Te.prototype.clearSelected=function(R){return R===void 0&&(R={}),this.deselect(this._selectedFeatureIds.values(),{silent:R.silent}),this},Te.prototype.setSelected=function(R,U){var ie=this;return U===void 0&&(U={}),R=on(R),this.deselect(this._selectedFeatureIds.values().filter(function(ve){return R.indexOf(ve)===-1}),{silent:U.silent}),this.select(R.filter(function(ve){return!ie._selectedFeatureIds.has(ve)}),{silent:U.silent}),this},Te.prototype.setSelectedCoordinates=function(R){return this._selectedCoordinates=R,this._emitSelectionChange=!0,this},Te.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Te.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Te.prototype.getSelected=function(){var R=this;return this._selectedFeatureIds.values().map(function(U){return R.get(U)})},Te.prototype.getSelectedCoordinates=function(){var R=this;return this._selectedCoordinates.map(function(U){return{coordinates:R.get(U.feature_id).getCoordinate(U.coord_path)}})},Te.prototype.isSelected=function(R){return this._selectedFeatureIds.has(R)},Te.prototype.setFeatureProperty=function(R,U,ie){this.get(R).setProperty(U,ie),this.featureChanged(R)},Te.prototype.storeMapConfig=function(){var R=this;Y.forEach(function(U){R.ctx.map[U]&&(R._mapInitialConfig[U]=R.ctx.map[U].isEnabled())})},Te.prototype.restoreMapConfig=function(){var R=this;Object.keys(this._mapInitialConfig).forEach(function(U){R._mapInitialConfig[U]?R.ctx.map[U].enable():R.ctx.map[U].disable()})},Te.prototype.getInitialConfigValue=function(R){return this._mapInitialConfig[R]===void 0||this._mapInitialConfig[R]};var wn=function(){for(var R=arguments,U={},ie=0;ie<arguments.length;ie++){var ve=R[ie];for(var Le in ve)jt.call(ve,Le)&&(U[Le]=ve[Le])}return U},jt=Object.prototype.hasOwnProperty,me=i(wn),le=["mode","feature","mouse"];function tt(R){var U=null,ie=null,ve={onRemove:function(){return R.map.off("load",ve.connect),clearInterval(ie),ve.removeLayers(),R.store.restoreMapConfig(),R.ui.removeButtons(),R.events.removeEventListeners(),R.ui.clearMapClasses(),R.boxZoomInitial&&R.map.boxZoom.enable(),R.map=null,R.container=null,R.store=null,U&&U.parentNode&&U.parentNode.removeChild(U),U=null,this},connect:function(){R.map.off("load",ve.connect),clearInterval(ie),ve.addLayers(),R.store.storeMapConfig(),R.events.addEventListeners()},onAdd:function(Le){var De=Le.fire;return Le.fire=function(He,Tt){var Ot=arguments;return De.length===1&&arguments.length!==1&&(Ot=[me({},{type:He},Tt)]),De.apply(Le,Ot)},R.map=Le,R.events=function(He){var Tt=Object.keys(He.options.modes).reduce(function(vt,bn){return vt[bn]=Jn(He.options.modes[bn]),vt},{}),Ot={},Kt={},Yt={},Gt=null,Nn=null;Yt.drag=function(vt,bn){bn({point:vt.point,time:new Date().getTime()})?(He.ui.queueMapClasses({mouse:T.DRAG}),Nn.drag(vt)):vt.originalEvent.stopPropagation()},Yt.mousedrag=function(vt){Yt.drag(vt,function(bn){return!Ee(Ot,bn)})},Yt.touchdrag=function(vt){Yt.drag(vt,function(bn){return!ut(Kt,bn)})},Yt.mousemove=function(vt){if((vt.originalEvent.buttons!==void 0?vt.originalEvent.buttons:vt.originalEvent.which)===1)return Yt.mousedrag(vt);var bn=Ne(vt,He);vt.featureTarget=bn,Nn.mousemove(vt)},Yt.mousedown=function(vt){Ot={time:new Date().getTime(),point:vt.point};var bn=Ne(vt,He);vt.featureTarget=bn,Nn.mousedown(vt)},Yt.mouseup=function(vt){var bn=Ne(vt,He);vt.featureTarget=bn,Ee(Ot,{point:vt.point,time:new Date().getTime()})?Nn.click(vt):Nn.mouseup(vt)},Yt.mouseout=function(vt){Nn.mouseout(vt)},Yt.touchstart=function(vt){if(He.options.touchEnabled){Kt={time:new Date().getTime(),point:vt.point};var bn=qe.touch(vt,null,He)[0];vt.featureTarget=bn,Nn.touchstart(vt)}},Yt.touchmove=function(vt){if(He.options.touchEnabled)return Nn.touchmove(vt),Yt.touchdrag(vt)},Yt.touchend=function(vt){if(vt.originalEvent.preventDefault(),He.options.touchEnabled){var bn=qe.touch(vt,null,He)[0];vt.featureTarget=bn,ut(Kt,{time:new Date().getTime(),point:vt.point})?Nn.tap(vt):Nn.touchend(vt)}};var Xi=function(vt){return!(vt===8||vt===46||vt>=48&&vt<=57)};function kn(vt,bn,Ri){Ri===void 0&&(Ri={}),Nn.stop();var Lr=Tt[vt];if(Lr===void 0)throw new Error(vt+" is not valid");Gt=vt;var nr=Lr(He,bn);Nn=t(nr,He),Ri.silent||He.map.fire(C.MODE_CHANGE,{mode:vt}),He.store.setDirty(),He.store.render()}Yt.keydown=function(vt){(vt.srcElement||vt.target).classList.contains("mapboxgl-canvas")&&(vt.keyCode!==8&&vt.keyCode!==46||!He.options.controls.trash?Xi(vt.keyCode)?Nn.keydown(vt):vt.keyCode===49&&He.options.controls.point?kn(P.DRAW_POINT):vt.keyCode===50&&He.options.controls.line_string?kn(P.DRAW_LINE_STRING):vt.keyCode===51&&He.options.controls.polygon&&kn(P.DRAW_POLYGON):(vt.preventDefault(),Nn.trash()))},Yt.keyup=function(vt){Xi(vt.keyCode)&&Nn.keyup(vt)},Yt.zoomend=function(){He.store.changeZoom()},Yt.data=function(vt){if(vt.dataType==="style"){var bn=He.setup,Ri=He.map,Lr=He.options,nr=He.store;Lr.styles.some(function(Dd){return Ri.getLayer(Dd.id)})||(bn.addLayers(),nr.setDirty(),nr.render())}};var Ei={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Gt=He.options.defaultMode,Nn=t(Tt[Gt](He),He)},changeMode:kn,actionable:function(vt){var bn=!1;Object.keys(vt).forEach(function(Ri){if(Ei[Ri]===void 0)throw new Error("Invalid action type");Ei[Ri]!==vt[Ri]&&(bn=!0),Ei[Ri]=vt[Ri]}),bn&&He.map.fire(C.ACTIONABLE,{actions:Ei})},currentModeName:function(){return Gt},currentModeRender:function(vt,bn){return Nn.render(vt,bn)},fire:function(vt,bn){Yt[vt]&&Yt[vt](bn)},addEventListeners:function(){He.map.on("mousemove",Yt.mousemove),He.map.on("mousedown",Yt.mousedown),He.map.on("mouseup",Yt.mouseup),He.map.on("data",Yt.data),He.map.on("touchmove",Yt.touchmove),He.map.on("touchstart",Yt.touchstart),He.map.on("touchend",Yt.touchend),He.container.addEventListener("mouseout",Yt.mouseout),He.options.keybindings&&(He.container.addEventListener("keydown",Yt.keydown),He.container.addEventListener("keyup",Yt.keyup))},removeEventListeners:function(){He.map.off("mousemove",Yt.mousemove),He.map.off("mousedown",Yt.mousedown),He.map.off("mouseup",Yt.mouseup),He.map.off("data",Yt.data),He.map.off("touchmove",Yt.touchmove),He.map.off("touchstart",Yt.touchstart),He.map.off("touchend",Yt.touchend),He.container.removeEventListener("mouseout",Yt.mouseout),He.options.keybindings&&(He.container.removeEventListener("keydown",Yt.keydown),He.container.removeEventListener("keyup",Yt.keyup))},trash:function(vt){Nn.trash(vt)},combineFeatures:function(){Nn.combineFeatures()},uncombineFeatures:function(){Nn.uncombineFeatures()},getMode:function(){return Gt}}}(R),R.ui=function(He){var Tt={},Ot=null,Kt={mode:null,feature:null,mouse:null},Yt={mode:null,feature:null,mouse:null};function Gt(vt){Yt=me(Yt,vt)}function Nn(){var vt,bn;if(He.container){var Ri=[],Lr=[];le.forEach(function(nr){Yt[nr]!==Kt[nr]&&(Ri.push(nr+"-"+Kt[nr]),Yt[nr]!==null&&Lr.push(nr+"-"+Yt[nr]))}),Ri.length>0&&(vt=He.container.classList).remove.apply(vt,Ri),Lr.length>0&&(bn=He.container.classList).add.apply(bn,Lr),Kt=me(Kt,Yt)}}function Xi(vt,bn){bn===void 0&&(bn={});var Ri=document.createElement("button");return Ri.className=_.CONTROL_BUTTON+" "+bn.className,Ri.setAttribute("title",bn.title),bn.container.appendChild(Ri),Ri.addEventListener("click",function(Lr){if(Lr.preventDefault(),Lr.stopPropagation(),Lr.target===Ot)return kn(),void bn.onDeactivate();Ei(vt),bn.onActivate()},!0),Ri}function kn(){Ot&&(Ot.classList.remove(_.ACTIVE_BUTTON),Ot=null)}function Ei(vt){kn();var bn=Tt[vt];bn&&bn&&vt!=="trash"&&(bn.classList.add(_.ACTIVE_BUTTON),Ot=bn)}return{setActiveButton:Ei,queueMapClasses:Gt,updateMapClasses:Nn,clearMapClasses:function(){Gt({mode:null,feature:null,mouse:null}),Nn()},addButtons:function(){var vt=He.options.controls,bn=document.createElement("div");return bn.className=_.CONTROL_GROUP+" "+_.CONTROL_BASE,vt&&(vt[I.LINE]&&(Tt[I.LINE]=Xi(I.LINE,{container:bn,className:_.CONTROL_BUTTON_LINE,title:"LineString tool "+(He.options.keybindings?"(l)":""),onActivate:function(){return He.events.changeMode(P.DRAW_LINE_STRING)},onDeactivate:function(){return He.events.trash()}})),vt[I.POLYGON]&&(Tt[I.POLYGON]=Xi(I.POLYGON,{container:bn,className:_.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(He.options.keybindings?"(p)":""),onActivate:function(){return He.events.changeMode(P.DRAW_POLYGON)},onDeactivate:function(){return He.events.trash()}})),vt[I.POINT]&&(Tt[I.POINT]=Xi(I.POINT,{container:bn,className:_.CONTROL_BUTTON_POINT,title:"Marker tool "+(He.options.keybindings?"(m)":""),onActivate:function(){return He.events.changeMode(P.DRAW_POINT)},onDeactivate:function(){return He.events.trash()}})),vt.trash&&(Tt.trash=Xi("trash",{container:bn,className:_.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){He.events.trash()}})),vt.combine_features&&(Tt.combine_features=Xi("combineFeatures",{container:bn,className:_.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){He.events.combineFeatures()}})),vt.uncombine_features&&(Tt.uncombine_features=Xi("uncombineFeatures",{container:bn,className:_.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){He.events.uncombineFeatures()}}))),bn},removeButtons:function(){Object.keys(Tt).forEach(function(vt){var bn=Tt[vt];bn.parentNode&&bn.parentNode.removeChild(bn),delete Tt[vt]})}}}(R),R.container=Le.getContainer(),R.store=new Te(R),U=R.ui.addButtons(),R.options.boxSelect&&(R.boxZoomInitial=Le.boxZoom.isEnabled(),Le.boxZoom.disable(),Le.dragPan.disable(),Le.dragPan.enable()),Le.loaded()?ve.connect():(Le.on("load",ve.connect),ie=setInterval(function(){Le.loaded()&&ve.connect()},16)),R.events.start(),U},addLayers:function(){R.map.addSource(w.COLD,{data:{type:L.FEATURE_COLLECTION,features:[]},type:"geojson"}),R.map.addSource(w.HOT,{data:{type:L.FEATURE_COLLECTION,features:[]},type:"geojson"}),R.options.styles.forEach(function(Le){R.map.addLayer(Le)}),R.store.setDirty(!0),R.store.render()},removeLayers:function(){R.options.styles.forEach(function(Le){R.map.getLayer(Le.id)&&R.map.removeLayer(Le.id)}),R.map.getSource(w.COLD)&&R.map.removeSource(w.COLD),R.map.getSource(w.HOT)&&R.map.removeSource(w.HOT)}};return R.setup=ve,ve}var xt=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function St(R){return function(U){var ie=U.featureTarget;return!!ie&&!!ie.properties&&ie.properties.meta===R}}function yt(R){return!!R.originalEvent&&!!R.originalEvent.shiftKey&&R.originalEvent.button===0}function hn(R){return!!R.featureTarget&&!!R.featureTarget.properties&&R.featureTarget.properties.active===H.ACTIVE&&R.featureTarget.properties.meta===z.FEATURE}function zt(R){return!!R.featureTarget&&!!R.featureTarget.properties&&R.featureTarget.properties.active===H.INACTIVE&&R.featureTarget.properties.meta===z.FEATURE}function Je(R){return R.featureTarget===void 0}function cn(R){return!!R.featureTarget&&!!R.featureTarget.properties&&R.featureTarget.properties.meta===z.FEATURE}function At(R){var U=R.featureTarget;return!!U&&!!U.properties&&U.properties.meta===z.VERTEX}function tn(R){return!!R.originalEvent&&R.originalEvent.shiftKey===!0}function Zn(R){return R.keyCode===27}function lt(R){return R.keyCode===13}var Mt=Object.freeze({__proto__:null,isOfMetaType:St,isShiftMousedown:yt,isActiveFeature:hn,isInactiveFeature:zt,noTarget:Je,isFeature:cn,isVertex:At,isShiftDown:tn,isEscapeKey:Zn,isEnterKey:lt,isTrue:function(){return!0}}),kt=In;function In(R,U){this.x=R,this.y=U}In.prototype={clone:function(){return new In(this.x,this.y)},add:function(R){return this.clone()._add(R)},sub:function(R){return this.clone()._sub(R)},multByPoint:function(R){return this.clone()._multByPoint(R)},divByPoint:function(R){return this.clone()._divByPoint(R)},mult:function(R){return this.clone()._mult(R)},div:function(R){return this.clone()._div(R)},rotate:function(R){return this.clone()._rotate(R)},rotateAround:function(R,U){return this.clone()._rotateAround(R,U)},matMult:function(R){return this.clone()._matMult(R)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(R){return this.x===R.x&&this.y===R.y},dist:function(R){return Math.sqrt(this.distSqr(R))},distSqr:function(R){var U=R.x-this.x,ie=R.y-this.y;return U*U+ie*ie},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(R){return Math.atan2(this.y-R.y,this.x-R.x)},angleWith:function(R){return this.angleWithSep(R.x,R.y)},angleWithSep:function(R,U){return Math.atan2(this.x*U-this.y*R,this.x*R+this.y*U)},_matMult:function(R){var U=R[0]*this.x+R[1]*this.y,ie=R[2]*this.x+R[3]*this.y;return this.x=U,this.y=ie,this},_add:function(R){return this.x+=R.x,this.y+=R.y,this},_sub:function(R){return this.x-=R.x,this.y-=R.y,this},_mult:function(R){return this.x*=R,this.y*=R,this},_div:function(R){return this.x/=R,this.y/=R,this},_multByPoint:function(R){return this.x*=R.x,this.y*=R.y,this},_divByPoint:function(R){return this.x/=R.x,this.y/=R.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var R=this.y;return this.y=this.x,this.x=-R,this},_rotate:function(R){var U=Math.cos(R),ie=Math.sin(R),ve=U*this.x-ie*this.y,Le=ie*this.x+U*this.y;return this.x=ve,this.y=Le,this},_rotateAround:function(R,U){var ie=Math.cos(R),ve=Math.sin(R),Le=U.x+ie*(this.x-U.x)-ve*(this.y-U.y),De=U.y+ve*(this.x-U.x)+ie*(this.y-U.y);return this.x=Le,this.y=De,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},In.convert=function(R){return R instanceof In?R:Array.isArray(R)?new In(R[0],R[1]):R};var ii=i(kt);function Ae(R,U){var ie=U.getBoundingClientRect();return new ii(R.clientX-ie.left-(U.clientLeft||0),R.clientY-ie.top-(U.clientTop||0))}function Lt(R,U,ie,ve){return{type:L.FEATURE,properties:{meta:z.VERTEX,parent:R,coord_path:ie,active:ve?H.ACTIVE:H.INACTIVE},geometry:{type:L.POINT,coordinates:U}}}function gt(R,U,ie){var ve=U.geometry.coordinates,Le=ie.geometry.coordinates;if(ve[1]>85||ve[1]<ee||Le[1]>85||Le[1]<ee)return null;var De={lng:(ve[0]+Le[0])/2,lat:(ve[1]+Le[1])/2};return{type:L.FEATURE,properties:{meta:z.MIDPOINT,parent:R,lng:De.lng,lat:De.lat,coord_path:ie.properties.coord_path},geometry:{type:L.POINT,coordinates:[De.lng,De.lat]}}}function ht(R,U,ie){U===void 0&&(U={}),ie===void 0&&(ie=null);var ve,Le=R.geometry,De=Le.type,He=Le.coordinates,Tt=R.properties&&R.properties.id,Ot=[];function Kt(Gt,Nn){var Xi="",kn=null;Gt.forEach(function(Ei,vt){var bn=Nn!=null?Nn+"."+vt:String(vt),Ri=Lt(Tt,Ei,bn,Yt(bn));if(U.midpoints&&kn){var Lr=gt(Tt,kn,Ri);Lr&&Ot.push(Lr)}kn=Ri;var nr=JSON.stringify(Ei);Xi!==nr&&Ot.push(Ri),vt===0&&(Xi=nr)})}function Yt(Gt){return!!U.selectedPaths&&U.selectedPaths.indexOf(Gt)!==-1}return De===L.POINT?Ot.push(Lt(Tt,He,ie,Yt(ie))):De===L.POLYGON?He.forEach(function(Gt,Nn){Kt(Gt,ie!==null?ie+"."+Nn:String(Nn))}):De===L.LINE_STRING?Kt(He,ie):De.indexOf(L.MULTI_PREFIX)===0&&(ve=De.replace(L.MULTI_PREFIX,""),He.forEach(function(Gt,Nn){var Xi={type:L.FEATURE,properties:R.properties,geometry:{type:ve,coordinates:Gt}};Ot=Ot.concat(ht(Xi,U,Nn))})),Ot}var ae={enable:function(R){setTimeout(function(){R.map&&R.map.doubleClickZoom&&R._ctx&&R._ctx.store&&R._ctx.store.getInitialConfigValue&&R._ctx.store.getInitialConfigValue("doubleClickZoom")&&R.map.doubleClickZoom.enable()},0)},disable:function(R){setTimeout(function(){R.map&&R.map.doubleClickZoom&&R.map.doubleClickZoom.disable()},0)}},j={exports:{}},Z=function(R){if(!R||!R.type)return null;var U=ne[R.type];if(!U)return null;if(U==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:R}]};if(U==="feature")return{type:"FeatureCollection",features:[R]};if(U==="featurecollection")return R},ne={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},fe=i(Z),xe=Object.freeze({__proto__:null,default:function R(U){switch(U&&U.type||null){case"FeatureCollection":return U.features=U.features.reduce(function(ie,ve){return ie.concat(R(ve))},[]),U;case"Feature":return U.geometry?R(U.geometry).map(function(ie){var ve={type:"Feature",properties:JSON.parse(JSON.stringify(U.properties)),geometry:ie};return U.id!==void 0&&(ve.id=U.id),ve}):[U];case"MultiPoint":return U.coordinates.map(function(ie){return{type:"Point",coordinates:ie}});case"MultiPolygon":return U.coordinates.map(function(ie){return{type:"Polygon",coordinates:ie}});case"MultiLineString":return U.coordinates.map(function(ie){return{type:"LineString",coordinates:ie}});case"GeometryCollection":return U.geometries.map(R).reduce(function(ie,ve){return ie.concat(ve)},[]);case"Point":case"Polygon":case"LineString":return[U]}}}),Ie=Z,ke=r(xe),Se=function(R){return function U(ie){return Array.isArray(ie)&&ie.length&&typeof ie[0]=="number"?[ie]:ie.reduce(function(ve,Le){return Array.isArray(Le)&&Array.isArray(Le[0])?ve.concat(U(Le)):(ve.push(Le),ve)},[])}(R)};ke instanceof Function||(ke=ke.default);var Ue={exports:{}},ft=Ue.exports=function(R){return new Ze(R)};function Ze(R){this.value=R}function rt(R,U,ie){var ve=[],Le=[],De=!0;return function He(Tt){var Ot=ie?nn(Tt):Tt,Kt={},Yt=!0,Gt={node:Ot,node_:Tt,path:[].concat(ve),parent:Le[Le.length-1],parents:Le,key:ve.slice(-1)[0],isRoot:ve.length===0,level:ve.length,circular:null,update:function(kn,Ei){Gt.isRoot||(Gt.parent.node[Gt.key]=kn),Gt.node=kn,Ei&&(Yt=!1)},delete:function(kn){delete Gt.parent.node[Gt.key],kn&&(Yt=!1)},remove:function(kn){Fn(Gt.parent.node)?Gt.parent.node.splice(Gt.key,1):delete Gt.parent.node[Gt.key],kn&&(Yt=!1)},keys:null,before:function(kn){Kt.before=kn},after:function(kn){Kt.after=kn},pre:function(kn){Kt.pre=kn},post:function(kn){Kt.post=kn},stop:function(){De=!1},block:function(){Yt=!1}};if(!De)return Gt;function Nn(){if(typeof Gt.node=="object"&&Gt.node!==null){Gt.keys&&Gt.node_===Gt.node||(Gt.keys=fn(Gt.node)),Gt.isLeaf=Gt.keys.length==0;for(var kn=0;kn<Le.length;kn++)if(Le[kn].node_===Tt){Gt.circular=Le[kn];break}}else Gt.isLeaf=!0,Gt.keys=null;Gt.notLeaf=!Gt.isLeaf,Gt.notRoot=!Gt.isRoot}Nn();var Xi=U.call(Gt,Gt.node);return Xi!==void 0&&Gt.update&&Gt.update(Xi),Kt.before&&Kt.before.call(Gt,Gt.node),Yt&&(typeof Gt.node!="object"||Gt.node===null||Gt.circular||(Le.push(Gt),Nn(),ni(Gt.keys,function(kn,Ei){ve.push(kn),Kt.pre&&Kt.pre.call(Gt,Gt.node[kn],kn);var vt=He(Gt.node[kn]);ie&&wi.call(Gt.node,kn)&&(Gt.node[kn]=vt.node),vt.isLast=Ei==Gt.keys.length-1,vt.isFirst=Ei==0,Kt.post&&Kt.post.call(Gt,vt),ve.pop()}),Le.pop()),Kt.after&&Kt.after.call(Gt,Gt.node)),Gt}(R).node}function nn(R){if(typeof R=="object"&&R!==null){var U;if(Fn(R))U=[];else if(Hn(R)==="[object Date]")U=new Date(R.getTime?R.getTime():R);else if(function(Le){return Hn(Le)==="[object RegExp]"}(R))U=new RegExp(R);else if(function(Le){return Hn(Le)==="[object Error]"}(R))U={message:R.message};else if(function(Le){return Hn(Le)==="[object Boolean]"}(R))U=new Boolean(R);else if(function(Le){return Hn(Le)==="[object Number]"}(R))U=new Number(R);else if(function(Le){return Hn(Le)==="[object String]"}(R))U=new String(R);else if(Object.create&&Object.getPrototypeOf)U=Object.create(Object.getPrototypeOf(R));else if(R.constructor===Object)U={};else{var ie=R.constructor&&R.constructor.prototype||R.__proto__||{},ve=function(){};ve.prototype=ie,U=new ve}return ni(fn(R),function(Le){U[Le]=R[Le]}),U}return R}Ze.prototype.get=function(R){for(var U=this.value,ie=0;ie<R.length;ie++){var ve=R[ie];if(!U||!wi.call(U,ve)){U=void 0;break}U=U[ve]}return U},Ze.prototype.has=function(R){for(var U=this.value,ie=0;ie<R.length;ie++){var ve=R[ie];if(!U||!wi.call(U,ve))return!1;U=U[ve]}return!0},Ze.prototype.set=function(R,U){for(var ie=this.value,ve=0;ve<R.length-1;ve++){var Le=R[ve];wi.call(ie,Le)||(ie[Le]={}),ie=ie[Le]}return ie[R[ve]]=U,U},Ze.prototype.map=function(R){return rt(this.value,R,!0)},Ze.prototype.forEach=function(R){return this.value=rt(this.value,R,!1),this.value},Ze.prototype.reduce=function(R,U){var ie=arguments.length===1,ve=ie?this.value:U;return this.forEach(function(Le){this.isRoot&&ie||(ve=R.call(this,ve,Le))}),ve},Ze.prototype.paths=function(){var R=[];return this.forEach(function(U){R.push(this.path)}),R},Ze.prototype.nodes=function(){var R=[];return this.forEach(function(U){R.push(this.node)}),R},Ze.prototype.clone=function(){var R=[],U=[];return function ie(ve){for(var Le=0;Le<R.length;Le++)if(R[Le]===ve)return U[Le];if(typeof ve=="object"&&ve!==null){var De=nn(ve);return R.push(ve),U.push(De),ni(fn(ve),function(He){De[He]=ie(ve[He])}),R.pop(),U.pop(),De}return ve}(this.value)};var fn=Object.keys||function(R){var U=[];for(var ie in R)U.push(ie);return U};function Hn(R){return Object.prototype.toString.call(R)}var Fn=Array.isArray||function(R){return Object.prototype.toString.call(R)==="[object Array]"},ni=function(R,U){if(R.forEach)return R.forEach(U);for(var ie=0;ie<R.length;ie++)U(R[ie],ie,R)};ni(fn(Ze.prototype),function(R){ft[R]=function(U){var ie=[].slice.call(arguments,1),ve=new Ze(U);return ve[R].apply(ve,ie)}});var wi=Object.hasOwnProperty||function(R,U){return U in R},Ui=Ue.exports,yr=oe;function oe(R){if(!(this instanceof oe))return new oe(R);this._bbox=R||[1/0,1/0,-1/0,-1/0],this._valid=!!R}oe.prototype.include=function(R){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],R[0]),this._bbox[1]=Math.min(this._bbox[1],R[1]),this._bbox[2]=Math.max(this._bbox[2],R[0]),this._bbox[3]=Math.max(this._bbox[3],R[1]),this},oe.prototype.equals=function(R){var U;return U=R instanceof oe?R.bbox():R,this._bbox[0]==U[0]&&this._bbox[1]==U[1]&&this._bbox[2]==U[2]&&this._bbox[3]==U[3]},oe.prototype.center=function(R){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},oe.prototype.union=function(R){var U;return this._valid=!0,U=R instanceof oe?R.bbox():R,this._bbox[0]=Math.min(this._bbox[0],U[0]),this._bbox[1]=Math.min(this._bbox[1],U[1]),this._bbox[2]=Math.max(this._bbox[2],U[2]),this._bbox[3]=Math.max(this._bbox[3],U[3]),this},oe.prototype.bbox=function(){return this._valid?this._bbox:null},oe.prototype.contains=function(R){if(!R)return this._fastContains();if(!this._valid)return null;var U=R[0],ie=R[1];return this._bbox[0]<=U&&this._bbox[1]<=ie&&this._bbox[2]>=U&&this._bbox[3]>=ie},oe.prototype.intersect=function(R){return this._valid?(U=R instanceof oe?R.bbox():R,!(this._bbox[0]>U[2]||this._bbox[2]<U[0]||this._bbox[3]<U[1]||this._bbox[1]>U[3])):null;var U},oe.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var R="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",R)},oe.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Be=function(R){if(!R)return[];var U=ke(Ie(R)),ie=[];return U.features.forEach(function(ve){ve.geometry&&(ie=ie.concat(Se(ve.geometry.coordinates)))}),ie},Qe=Ui,it=yr,$e={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Pt=Object.keys($e);function rn(R){for(var U=it(),ie=Be(R),ve=0;ve<ie.length;ve++)U.include(ie[ve]);return U}j.exports=function(R){return rn(R).bbox()},j.exports.polygon=function(R){return rn(R).polygon()},j.exports.bboxify=function(R){return Qe(R).map(function(U){U&&Pt.some(function(ie){return!!U[ie]&&$e[ie].indexOf(U.type)!==-1})&&(U.bbox=rn(U).bbox(),this.update(U))})};var Cn=i(j.exports),Ft=-90;function zn(R,U){var ie=Ft,ve=90,Le=Ft,De=90,He=270,Tt=-270;R.forEach(function(Kt){var Yt=Cn(Kt),Gt=Yt[1],Nn=Yt[3],Xi=Yt[0],kn=Yt[2];Gt>ie&&(ie=Gt),Nn<ve&&(ve=Nn),Nn>Le&&(Le=Nn),Gt<De&&(De=Gt),Xi<He&&(He=Xi),kn>Tt&&(Tt=kn)});var Ot=U;return ie+Ot.lat>85&&(Ot.lat=85-ie),Le+Ot.lat>90&&(Ot.lat=90-Le),ve+Ot.lat<-85&&(Ot.lat=-85-ve),De+Ot.lat<Ft&&(Ot.lat=Ft-De),He+Ot.lng<=-270&&(Ot.lng+=360*Math.ceil(Math.abs(Ot.lng)/360)),Tt+Ot.lng>=270&&(Ot.lng-=360*Math.ceil(Math.abs(Ot.lng)/360)),Ot}function Un(R,U){var ie=zn(R.map(function(ve){return ve.toGeoJSON()}),U);R.forEach(function(ve){var Le,De=ve.getCoordinates(),He=function(Ot){var Kt={lng:Ot[0]+ie.lng,lat:Ot[1]+ie.lat};return[Kt.lng,Kt.lat]},Tt=function(Ot){return Ot.map(function(Kt){return He(Kt)})};ve.type===L.POINT?Le=He(De):ve.type===L.LINE_STRING||ve.type===L.MULTI_POINT?Le=De.map(He):ve.type===L.POLYGON||ve.type===L.MULTI_LINE_STRING?Le=De.map(Tt):ve.type===L.MULTI_POLYGON&&(Le=De.map(function(Ot){return Ot.map(function(Kt){return Tt(Kt)})})),ve.incomingCoords(Le)})}var Zt={onSetup:function(R){var U=this,ie={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:R.featureIds||[]};return this.setSelected(ie.initiallySelectedFeatureIds.filter(function(ve){return U.getFeature(ve)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),ie},fireUpdate:function(){this.map.fire(C.UPDATE,{action:O.MOVE,features:this.getSelected().map(function(R){return R.toGeoJSON()})})},fireActionable:function(){var R=this,U=this.getSelected(),ie=U.filter(function(Tt){return R.isInstanceOf("MultiFeature",Tt)}),ve=!1;if(U.length>1){ve=!0;var Le=U[0].type.replace("Multi","");U.forEach(function(Tt){Tt.type.replace("Multi","")!==Le&&(ve=!1)})}var De=ie.length>0,He=U.length>0;this.setActionableState({combineFeatures:ve,uncombineFeatures:De,trash:He})},getUniqueIds:function(R){return R.length?R.map(function(U){return U.properties.id}).filter(function(U){return U!==void 0}).reduce(function(U,ie){return U.add(ie),U},new ze).values():[]},stopExtendedInteractions:function(R){R.boxSelectElement&&(R.boxSelectElement.parentNode&&R.boxSelectElement.parentNode.removeChild(R.boxSelectElement),R.boxSelectElement=null),this.map.dragPan.enable(),R.boxSelecting=!1,R.canBoxSelect=!1,R.dragMoving=!1,R.canDragMove=!1},onStop:function(){ae.enable(this)},onMouseMove:function(R,U){return cn(U)&&R.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(R),!0},onMouseOut:function(R){return!R.dragMoving||this.fireUpdate()}};Zt.onTap=Zt.onClick=function(R,U){return Je(U)?this.clickAnywhere(R,U):St(z.VERTEX)(U)?this.clickOnVertex(R,U):cn(U)?this.clickOnFeature(R,U):void 0},Zt.clickAnywhere=function(R){var U=this,ie=this.getSelectedIds();ie.length&&(this.clearSelectedFeatures(),ie.forEach(function(ve){return U.doRender(ve)})),ae.enable(this),this.stopExtendedInteractions(R)},Zt.clickOnVertex=function(R,U){this.changeMode(P.DIRECT_SELECT,{featureId:U.featureTarget.properties.parent,coordPath:U.featureTarget.properties.coord_path,startPos:U.lngLat}),this.updateUIClasses({mouse:T.MOVE})},Zt.startOnActiveFeature=function(R,U){this.stopExtendedInteractions(R),this.map.dragPan.disable(),this.doRender(U.featureTarget.properties.id),R.canDragMove=!0,R.dragMoveLocation=U.lngLat},Zt.clickOnFeature=function(R,U){var ie=this;ae.disable(this),this.stopExtendedInteractions(R);var ve=tn(U),Le=this.getSelectedIds(),De=U.featureTarget.properties.id,He=this.isSelected(De);if(!ve&&He&&this.getFeature(De).type!==L.POINT)return this.changeMode(P.DIRECT_SELECT,{featureId:De});He&&ve?(this.deselect(De),this.updateUIClasses({mouse:T.POINTER}),Le.length===1&&ae.enable(this)):!He&&ve?(this.select(De),this.updateUIClasses({mouse:T.MOVE})):He||ve||(Le.forEach(function(Tt){return ie.doRender(Tt)}),this.setSelected(De),this.updateUIClasses({mouse:T.MOVE})),this.doRender(De)},Zt.onMouseDown=function(R,U){return hn(U)?this.startOnActiveFeature(R,U):this.drawConfig.boxSelect&&yt(U)?this.startBoxSelect(R,U):void 0},Zt.startBoxSelect=function(R,U){this.stopExtendedInteractions(R),this.map.dragPan.disable(),R.boxSelectStartLocation=Ae(U.originalEvent,this.map.getContainer()),R.canBoxSelect=!0},Zt.onTouchStart=function(R,U){if(hn(U))return this.startOnActiveFeature(R,U)},Zt.onDrag=function(R,U){return R.canDragMove?this.dragMove(R,U):this.drawConfig.boxSelect&&R.canBoxSelect?this.whileBoxSelect(R,U):void 0},Zt.whileBoxSelect=function(R,U){R.boxSelecting=!0,this.updateUIClasses({mouse:T.ADD}),R.boxSelectElement||(R.boxSelectElement=document.createElement("div"),R.boxSelectElement.classList.add(_.BOX_SELECT),this.map.getContainer().appendChild(R.boxSelectElement));var ie=Ae(U.originalEvent,this.map.getContainer()),ve=Math.min(R.boxSelectStartLocation.x,ie.x),Le=Math.max(R.boxSelectStartLocation.x,ie.x),De=Math.min(R.boxSelectStartLocation.y,ie.y),He=Math.max(R.boxSelectStartLocation.y,ie.y),Tt="translate("+ve+"px, "+De+"px)";R.boxSelectElement.style.transform=Tt,R.boxSelectElement.style.WebkitTransform=Tt,R.boxSelectElement.style.width=Le-ve+"px",R.boxSelectElement.style.height=He-De+"px"},Zt.dragMove=function(R,U){R.dragMoving=!0,U.originalEvent.stopPropagation();var ie={lng:U.lngLat.lng-R.dragMoveLocation.lng,lat:U.lngLat.lat-R.dragMoveLocation.lat};Un(this.getSelected(),ie),R.dragMoveLocation=U.lngLat},Zt.onTouchEnd=Zt.onMouseUp=function(R,U){var ie=this;if(R.dragMoving)this.fireUpdate();else if(R.boxSelecting){var ve=[R.boxSelectStartLocation,Ae(U.originalEvent,this.map.getContainer())],Le=this.featuresAt(null,ve,"click"),De=this.getUniqueIds(Le).filter(function(He){return!ie.isSelected(He)});De.length&&(this.select(De),De.forEach(function(He){return ie.doRender(He)}),this.updateUIClasses({mouse:T.MOVE}))}this.stopExtendedInteractions(R)},Zt.toDisplayFeatures=function(R,U,ie){U.properties.active=this.isSelected(U.properties.id)?H.ACTIVE:H.INACTIVE,ie(U),this.fireActionable(),U.properties.active===H.ACTIVE&&U.geometry.type!==L.POINT&&ht(U).forEach(ie)},Zt.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Zt.onCombineFeatures=function(){var R=this.getSelected();if(!(R.length===0||R.length<2)){for(var U=[],ie=[],ve=R[0].type.replace("Multi",""),Le=0;Le<R.length;Le++){var De=R[Le];if(De.type.replace("Multi","")!==ve)return;De.type.includes("Multi")?De.getCoordinates().forEach(function(Tt){U.push(Tt)}):U.push(De.getCoordinates()),ie.push(De.toGeoJSON())}if(ie.length>1){var He=this.newFeature({type:L.FEATURE,properties:ie[0].properties,geometry:{type:"Multi"+ve,coordinates:U}});this.addFeature(He),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([He.id]),this.map.fire(C.COMBINE_FEATURES,{createdFeatures:[He.toGeoJSON()],deletedFeatures:ie})}this.fireActionable()}},Zt.onUncombineFeatures=function(){var R=this,U=this.getSelected();if(U.length!==0){for(var ie=[],ve=[],Le=function(He){var Tt=U[He];R.isInstanceOf("MultiFeature",Tt)&&(Tt.getFeatures().forEach(function(Ot){R.addFeature(Ot),Ot.properties=Tt.properties,ie.push(Ot.toGeoJSON()),R.select([Ot.id])}),R.deleteFeature(Tt.id,{silent:!0}),ve.push(Tt.toGeoJSON()))},De=0;De<U.length;De++)Le(De);ie.length>1&&this.map.fire(C.UNCOMBINE_FEATURES,{createdFeatures:ie,deletedFeatures:ve}),this.fireActionable()}};var Kn=St(z.VERTEX),ki=St(z.MIDPOINT),Qn={fireUpdate:function(){this.map.fire(C.UPDATE,{action:O.CHANGE_COORDINATES,features:this.getSelected().map(function(R){return R.toGeoJSON()})})},fireActionable:function(R){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:R.selectedCoordPaths.length>0})},startDragging:function(R,U){this.map.dragPan.disable(),R.canDragMove=!0,R.dragMoveLocation=U.lngLat},stopDragging:function(R){this.map.dragPan.enable(),R.dragMoving=!1,R.canDragMove=!1,R.dragMoveLocation=null},onVertex:function(R,U){this.startDragging(R,U);var ie=U.featureTarget.properties,ve=R.selectedCoordPaths.indexOf(ie.coord_path);tn(U)||ve!==-1?tn(U)&&ve===-1&&R.selectedCoordPaths.push(ie.coord_path):R.selectedCoordPaths=[ie.coord_path];var Le=this.pathsToCoordinates(R.featureId,R.selectedCoordPaths);this.setSelectedCoordinates(Le)},onMidpoint:function(R,U){this.startDragging(R,U);var ie=U.featureTarget.properties;R.feature.addCoordinate(ie.coord_path,ie.lng,ie.lat),this.fireUpdate(),R.selectedCoordPaths=[ie.coord_path]},pathsToCoordinates:function(R,U){return U.map(function(ie){return{feature_id:R,coord_path:ie}})},onFeature:function(R,U){R.selectedCoordPaths.length===0?this.startDragging(R,U):this.stopDragging(R)},dragFeature:function(R,U,ie){Un(this.getSelected(),ie),R.dragMoveLocation=U.lngLat},dragVertex:function(R,U,ie){for(var ve=R.selectedCoordPaths.map(function(Tt){return R.feature.getCoordinate(Tt)}),Le=zn(ve.map(function(Tt){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:Tt}}}),ie),De=0;De<ve.length;De++){var He=ve[De];R.feature.updateCoordinate(R.selectedCoordPaths[De],He[0]+Le.lng,He[1]+Le.lat)}},clickNoTarget:function(){this.changeMode(P.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(P.SIMPLE_SELECT)},clickActiveFeature:function(R){R.selectedCoordPaths=[],this.clearSelectedCoordinates(),R.feature.changed()},onSetup:function(R){var U=R.featureId,ie=this.getFeature(U);if(!ie)throw new Error("You must provide a featureId to enter direct_select mode");if(ie.type===L.POINT)throw new TypeError("direct_select mode doesn't handle point features");var ve={featureId:U,feature:ie,dragMoveLocation:R.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:R.coordPath?[R.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(U,ve.selectedCoordPaths)),this.setSelected(U),ae.disable(this),this.setActionableState({trash:!0}),ve},onStop:function(){ae.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(R,U,ie){R.featureId===U.properties.id?(U.properties.active=H.ACTIVE,ie(U),ht(U,{map:this.map,midpoints:!0,selectedPaths:R.selectedCoordPaths}).forEach(ie)):(U.properties.active=H.INACTIVE,ie(U)),this.fireActionable(R)},onTrash:function(R){R.selectedCoordPaths.sort(function(U,ie){return ie.localeCompare(U,"en",{numeric:!0})}).forEach(function(U){return R.feature.removeCoordinate(U)}),this.fireUpdate(),R.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(R),R.feature.isValid()===!1&&(this.deleteFeature([R.featureId]),this.changeMode(P.SIMPLE_SELECT,{}))},onMouseMove:function(R,U){var ie=hn(U),ve=Kn(U),Le=ki(U),De=R.selectedCoordPaths.length===0;return ie&&De||ve&&!De?this.updateUIClasses({mouse:T.MOVE}):this.updateUIClasses({mouse:T.NONE}),(ve||ie||Le)&&R.dragMoving&&this.fireUpdate(),this.stopDragging(R),!0},onMouseOut:function(R){return R.dragMoving&&this.fireUpdate(),!0}};Qn.onTouchStart=Qn.onMouseDown=function(R,U){return Kn(U)?this.onVertex(R,U):hn(U)?this.onFeature(R,U):ki(U)?this.onMidpoint(R,U):void 0},Qn.onDrag=function(R,U){if(R.canDragMove===!0){R.dragMoving=!0,U.originalEvent.stopPropagation();var ie={lng:U.lngLat.lng-R.dragMoveLocation.lng,lat:U.lngLat.lat-R.dragMoveLocation.lat};R.selectedCoordPaths.length>0?this.dragVertex(R,U,ie):this.dragFeature(R,U,ie),R.dragMoveLocation=U.lngLat}},Qn.onClick=function(R,U){return Je(U)?this.clickNoTarget(R,U):hn(U)?this.clickActiveFeature(R,U):zt(U)?this.clickInactive(R,U):void this.stopDragging(R)},Qn.onTap=function(R,U){return Je(U)?this.clickNoTarget(R,U):hn(U)?this.clickActiveFeature(R,U):zt(U)?this.clickInactive(R,U):void 0},Qn.onTouchEnd=Qn.onMouseUp=function(R){R.dragMoving&&this.fireUpdate(),this.stopDragging(R)};var vi={};function pi(R,U){return!!R.lngLat&&R.lngLat.lng===U[0]&&R.lngLat.lat===U[1]}vi.onSetup=function(){var R=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:[]}});return this.addFeature(R),this.clearSelectedFeatures(),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(I.POINT),this.setActionableState({trash:!0}),{point:R}},vi.stopDrawingAndRemove=function(R){this.deleteFeature([R.point.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT)},vi.onTap=vi.onClick=function(R,U){this.updateUIClasses({mouse:T.MOVE}),R.point.updateCoordinate("",U.lngLat.lng,U.lngLat.lat),this.map.fire(C.CREATE,{features:[R.point.toGeoJSON()]}),this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.point.id]})},vi.onStop=function(R){this.activateUIButton(),R.point.getCoordinate().length||this.deleteFeature([R.point.id],{silent:!0})},vi.toDisplayFeatures=function(R,U,ie){var ve=U.properties.id===R.point.id;if(U.properties.active=ve?H.ACTIVE:H.INACTIVE,!ve)return ie(U)},vi.onTrash=vi.stopDrawingAndRemove,vi.onKeyUp=function(R,U){if(Zn(U)||lt(U))return this.stopDrawingAndRemove(R,U)};var pn={onSetup:function(){var R=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.POLYGON,coordinates:[[]]}});return this.addFeature(R),this.clearSelectedFeatures(),ae.disable(this),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(I.POLYGON),this.setActionableState({trash:!0}),{polygon:R,currentVertexPosition:0}},clickAnywhere:function(R,U){if(R.currentVertexPosition>0&&pi(U,R.polygon.coordinates[0][R.currentVertexPosition-1]))return this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.polygon.id]});this.updateUIClasses({mouse:T.ADD}),R.polygon.updateCoordinate("0."+R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),R.currentVertexPosition++,R.polygon.updateCoordinate("0."+R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat)},clickOnVertex:function(R){return this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.polygon.id]})},onMouseMove:function(R,U){R.polygon.updateCoordinate("0."+R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),At(U)&&this.updateUIClasses({mouse:T.POINTER})}};pn.onTap=pn.onClick=function(R,U){return At(U)?this.clickOnVertex(R,U):this.clickAnywhere(R,U)},pn.onKeyUp=function(R,U){Zn(U)?(this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT)):lt(U)&&this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.polygon.id]})},pn.onStop=function(R){this.updateUIClasses({mouse:T.NONE}),ae.enable(this),this.activateUIButton(),this.getFeature(R.polygon.id)!==void 0&&(R.polygon.removeCoordinate("0."+R.currentVertexPosition),R.polygon.isValid()?this.map.fire(C.CREATE,{features:[R.polygon.toGeoJSON()]}):(this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT,{},{silent:!0})))},pn.toDisplayFeatures=function(R,U,ie){var ve=U.properties.id===R.polygon.id;if(U.properties.active=ve?H.ACTIVE:H.INACTIVE,!ve)return ie(U);if(U.geometry.coordinates.length!==0){var Le=U.geometry.coordinates[0].length;if(!(Le<3)){if(U.properties.meta=z.FEATURE,ie(Lt(R.polygon.id,U.geometry.coordinates[0][0],"0.0",!1)),Le>3){var De=U.geometry.coordinates[0].length-3;ie(Lt(R.polygon.id,U.geometry.coordinates[0][De],"0."+De,!1))}if(Le<=4){var He=[[U.geometry.coordinates[0][0][0],U.geometry.coordinates[0][0][1]],[U.geometry.coordinates[0][1][0],U.geometry.coordinates[0][1][1]]];if(ie({type:L.FEATURE,properties:U.properties,geometry:{coordinates:He,type:L.LINE_STRING}}),Le===3)return}return ie(U)}}},pn.onTrash=function(R){this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT)};var ei={onSetup:function(R){var U,ie,ve=(R=R||{}).featureId,Le="forward";if(ve){if(!(U=this.getFeature(ve)))throw new Error("Could not find a feature with the provided featureId");var De=R.from;if(De&&De.type==="Feature"&&De.geometry&&De.geometry.type==="Point"&&(De=De.geometry),De&&De.type==="Point"&&De.coordinates&&De.coordinates.length===2&&(De=De.coordinates),!De||!Array.isArray(De))throw new Error("Please use the `from` property to indicate which point to continue the line from");var He=U.coordinates.length-1;if(U.coordinates[He][0]===De[0]&&U.coordinates[He][1]===De[1])ie=He+1,U.addCoordinate.apply(U,[ie].concat(U.coordinates[He]));else{if(U.coordinates[0][0]!==De[0]||U.coordinates[0][1]!==De[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Le="backwards",ie=0,U.addCoordinate.apply(U,[ie].concat(U.coordinates[0]))}}else U=this.newFeature({type:L.FEATURE,properties:{},geometry:{type:L.LINE_STRING,coordinates:[]}}),ie=0,this.addFeature(U);return this.clearSelectedFeatures(),ae.disable(this),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(I.LINE),this.setActionableState({trash:!0}),{line:U,currentVertexPosition:ie,direction:Le}},clickAnywhere:function(R,U){if(R.currentVertexPosition>0&&pi(U,R.line.coordinates[R.currentVertexPosition-1])||R.direction==="backwards"&&pi(U,R.line.coordinates[R.currentVertexPosition+1]))return this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.line.id]});this.updateUIClasses({mouse:T.ADD}),R.line.updateCoordinate(R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),R.direction==="forward"?(R.currentVertexPosition++,R.line.updateCoordinate(R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat)):R.line.addCoordinate(0,U.lngLat.lng,U.lngLat.lat)},clickOnVertex:function(R){return this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.line.id]})},onMouseMove:function(R,U){R.line.updateCoordinate(R.currentVertexPosition,U.lngLat.lng,U.lngLat.lat),At(U)&&this.updateUIClasses({mouse:T.POINTER})}};ei.onTap=ei.onClick=function(R,U){if(At(U))return this.clickOnVertex(R,U);this.clickAnywhere(R,U)},ei.onKeyUp=function(R,U){lt(U)?this.changeMode(P.SIMPLE_SELECT,{featureIds:[R.line.id]}):Zn(U)&&(this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT))},ei.onStop=function(R){ae.enable(this),this.activateUIButton(),this.getFeature(R.line.id)!==void 0&&(R.line.removeCoordinate(""+R.currentVertexPosition),R.line.isValid()?this.map.fire(C.CREATE,{features:[R.line.toGeoJSON()]}):(this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT,{},{silent:!0})))},ei.onTrash=function(R){this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(P.SIMPLE_SELECT)},ei.toDisplayFeatures=function(R,U,ie){var ve=U.properties.id===R.line.id;if(U.properties.active=ve?H.ACTIVE:H.INACTIVE,!ve)return ie(U);U.geometry.coordinates.length<2||(U.properties.meta=z.FEATURE,ie(Lt(R.line.id,U.geometry.coordinates[R.direction==="forward"?U.geometry.coordinates.length-2:1],""+(R.direction==="forward"?U.geometry.coordinates.length-2:1),!1)),ie(U))};var hi={simple_select:Zt,direct_select:Qn,draw_point:vi,draw_polygon:pn,draw_line_string:ei},Or={defaultMode:P.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:xt,modes:hi,controls:{},userProperties:!1},Fi={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},br={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ns(R,U){return R.map(function(ie){return ie.source?ie:me(ie,{id:ie.id+"."+U,source:U==="hot"?w.HOT:w.COLD})})}var Hi={exports:{}};(function(R,U){var ie="__lodash_hash_undefined__",ve=9007199254740991,Le="[object Arguments]",De="[object Array]",He="[object Boolean]",Tt="[object Date]",Ot="[object Error]",Kt="[object Function]",Yt="[object Map]",Gt="[object Number]",Nn="[object Object]",Xi="[object Promise]",kn="[object RegExp]",Ei="[object Set]",vt="[object String]",bn="[object Symbol]",Ri="[object WeakMap]",Lr="[object ArrayBuffer]",nr="[object DataView]",Dd=/^\[object .+?Constructor\]$/,Yf=/^(?:0|[1-9]\d*)$/,Zi={};Zi["[object Float32Array]"]=Zi["[object Float64Array]"]=Zi["[object Int8Array]"]=Zi["[object Int16Array]"]=Zi["[object Int32Array]"]=Zi["[object Uint8Array]"]=Zi["[object Uint8ClampedArray]"]=Zi["[object Uint16Array]"]=Zi["[object Uint32Array]"]=!0,Zi[Le]=Zi[De]=Zi[Lr]=Zi[He]=Zi[nr]=Zi[Tt]=Zi[Ot]=Zi[Kt]=Zi[Yt]=Zi[Gt]=Zi[Nn]=Zi[kn]=Zi[Ei]=Zi[vt]=Zi[Ri]=!1;var Kf=typeof Iu=="object"&&Iu&&Iu.Object===Object&&Iu,Bg=typeof self=="object"&&self&&self.Object===Object&&self,ua=Kf||Bg||Function("return this")(),$c=U&&!U.nodeType&&U,nh=$c&&R&&!R.nodeType&&R,qc=nh&&nh.exports===$c,Xc=qc&&Kf.process,$l=function(){try{return Xc&&Xc.binding&&Xc.binding("util")}catch{}}(),_s=$l&&$l.isTypedArray;function Ti(We,Ke){for(var Wt=-1,Ln=We==null?0:We.length;++Wt<Ln;)if(Ke(We[Wt],Wt,We))return!0;return!1}function kd(We){var Ke=-1,Wt=Array(We.size);return We.forEach(function(Ln,Oi){Wt[++Ke]=[Oi,Ln]}),Wt}function Zc(We){var Ke=-1,Wt=Array(We.size);return We.forEach(function(Ln){Wt[++Ke]=Ln}),Wt}var ql,Jf,Yc,Ug=Array.prototype,Xl=Function.prototype,ih=Object.prototype,rh=ua["__core-js_shared__"],Qf=Xl.toString,So=ih.hasOwnProperty,sh=(ql=/[^.]+$/.exec(rh&&rh.keys&&rh.keys.IE_PROTO||""))?"Symbol(src)_1."+ql:"",Fd=ih.toString,ep=RegExp("^"+Qf.call(So).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Od=qc?ua.Buffer:void 0,Kc=ua.Symbol,Ba=ua.Uint8Array,Nd=ih.propertyIsEnumerable,Vg=Ug.splice,dl=Kc?Kc.toStringTag:void 0,zd=Object.getOwnPropertySymbols,Jc=Od?Od.isBuffer:void 0,Gg=(Jf=Object.keys,Yc=Object,function(We){return Jf(Yc(We))}),Zl=Os(ua,"DataView"),Qc=Os(ua,"Map"),Bd=Os(ua,"Promise"),oh=Os(ua,"Set"),ah=Os(ua,"WeakMap"),Yl=Os(Object,"create"),Ud=Va(Zl),tp=Va(Qc),Kl=Va(Bd),ha=Va(oh),Vd=Va(ah),lh=Kc?Kc.prototype:void 0,eu=lh?lh.valueOf:void 0;function Vi(We){var Ke=-1,Wt=We==null?0:We.length;for(this.clear();++Ke<Wt;){var Ln=We[Ke];this.set(Ln[0],Ln[1])}}function Mo(We){var Ke=-1,Wt=We==null?0:We.length;for(this.clear();++Ke<Wt;){var Ln=We[Ke];this.set(Ln[0],Ln[1])}}function $n(We){var Ke=-1,Wt=We==null?0:We.length;for(this.clear();++Ke<Wt;){var Ln=We[Ke];this.set(Ln[0],Ln[1])}}function Ua(We){var Ke=-1,Wt=We==null?0:We.length;for(this.__data__=new $n;++Ke<Wt;)this.add(We[Ke])}function Li(We){var Ke=this.__data__=new Mo(We);this.size=Ke.size}function ir(We,Ke){var Wt=_l(We),Ln=!Wt&&gl(We),Oi=!Wt&&!Ln&&ec(We),si=!Wt&&!Ln&&!Oi&&Wo(We),dr=Wt||Ln||Oi||si,Mr=dr?function(Er,zs){for(var Qs=-1,Zr=Array(Er);++Qs<Er;)Zr[Qs]=zs(Qs);return Zr}(We.length,String):[],Ns=Mr.length;for(var vr in We)!So.call(We,vr)||dr&&(vr=="length"||Oi&&(vr=="offset"||vr=="parent")||si&&(vr=="buffer"||vr=="byteLength"||vr=="byteOffset")||rp(vr,Ns))||Mr.push(vr);return Mr}function fl(We,Ke){for(var Wt=We.length;Wt--;)if(hh(We[Wt][0],Ke))return Wt;return-1}function Jl(We){return We==null?We===void 0?"[object Undefined]":"[object Null]":dl&&dl in Object(We)?function(Ke){var Wt=So.call(Ke,dl),Ln=Ke[dl];try{Ke[dl]=void 0;var Oi=!0}catch{}var si=Fd.call(Ke);return Oi&&(Wt?Ke[dl]=Ln:delete Ke[dl]),si}(We):function(Ke){return Fd.call(Ke)}(We)}function ch(We){return Eo(We)&&Jl(We)==Le}function np(We,Ke,Wt,Ln,Oi){return We===Ke||(We==null||Ke==null||!Eo(We)&&!Eo(Ke)?We!=We&&Ke!=Ke:function(si,dr,Mr,Ns,vr,Er){var zs=_l(si),Qs=_l(dr),Zr=zs?De:Sr(si),To=Qs?De:Sr(dr),jo=(Zr=Zr==Le?Nn:Zr)==Nn,$o=(To=To==Le?Nn:To)==Nn,Tr=Zr==To;if(Tr&&ec(si)){if(!ec(dr))return!1;zs=!0,jo=!1}if(Tr&&!jo)return Er||(Er=new Li),zs||Wo(si)?tu(si,dr,Mr,Ns,vr,Er):function(Ci,bi,Ga,da,nc,cs,us){switch(Ga){case nr:if(Ci.byteLength!=bi.byteLength||Ci.byteOffset!=bi.byteOffset)return!1;Ci=Ci.buffer,bi=bi.buffer;case Lr:return!(Ci.byteLength!=bi.byteLength||!cs(new Ba(Ci),new Ba(bi)));case He:case Tt:case Gt:return hh(+Ci,+bi);case Ot:return Ci.name==bi.name&&Ci.message==bi.message;case kn:case vt:return Ci==bi+"";case Yt:var Ha=kd;case Ei:var Wa=1&da;if(Ha||(Ha=Zc),Ci.size!=bi.size&&!Wa)return!1;var Yi=us.get(Ci);if(Yi)return Yi==bi;da|=2,us.set(Ci,bi);var ys=tu(Ha(Ci),Ha(bi),da,nc,cs,us);return us.delete(Ci),ys;case bn:if(eu)return eu.call(Ci)==eu.call(bi)}return!1}(si,dr,Zr,Mr,Ns,vr,Er);if(!(1&Mr)){var Co=jo&&So.call(si,"__wrapped__"),Gd=$o&&So.call(dr,"__wrapped__");if(Co||Gd){var Hd=Co?si.value():si,Hg=Gd?dr.value():dr;return Er||(Er=new Li),vr(Hd,Hg,Mr,Ns,Er)}}return Tr?(Er||(Er=new Li),function(Ci,bi,Ga,da,nc,cs){var us=1&Ga,Ha=Ql(Ci),Wa=Ha.length,Yi=Ql(bi).length;if(Wa!=Yi&&!us)return!1;for(var ys=Wa;ys--;){var zr=Ha[ys];if(!(us?zr in bi:So.call(bi,zr)))return!1}var iu=cs.get(Ci);if(iu&&cs.get(bi))return iu==bi;var ic=!0;cs.set(Ci,bi),cs.set(bi,Ci);for(var rc=us;++ys<Wa;){var eo=Ci[zr=Ha[ys]],fa=bi[zr];if(da)var ru=us?da(fa,eo,zr,bi,Ci,cs):da(eo,fa,zr,Ci,bi,cs);if(!(ru===void 0?eo===fa||nc(eo,fa,Ga,da,cs):ru)){ic=!1;break}rc||(rc=zr=="constructor")}if(ic&&!rc){var sc=Ci.constructor,oc=bi.constructor;sc==oc||!("constructor"in Ci)||!("constructor"in bi)||typeof sc=="function"&&sc instanceof sc&&typeof oc=="function"&&oc instanceof oc||(ic=!1)}return cs.delete(Ci),cs.delete(bi),ic}(si,dr,Mr,Ns,vr,Er)):!1}(We,Ke,Wt,Ln,np,Oi))}function ip(We){return!(!dh(We)||function(Ke){return!!sh&&sh in Ke}(We))&&(tc(We)?ep:Dd).test(Va(We))}function uh(We){if(Wt=(Ke=We)&&Ke.constructor,Ln=typeof Wt=="function"&&Wt.prototype||ih,Ke!==Ln)return Gg(We);var Ke,Wt,Ln,Oi=[];for(var si in Object(We))So.call(We,si)&&si!="constructor"&&Oi.push(si);return Oi}function tu(We,Ke,Wt,Ln,Oi,si){var dr=1&Wt,Mr=We.length,Ns=Ke.length;if(Mr!=Ns&&!(dr&&Ns>Mr))return!1;var vr=si.get(We);if(vr&&si.get(Ke))return vr==Ke;var Er=-1,zs=!0,Qs=2&Wt?new Ua:void 0;for(si.set(We,Ke),si.set(Ke,We);++Er<Mr;){var Zr=We[Er],To=Ke[Er];if(Ln)var jo=dr?Ln(To,Zr,Er,Ke,We,si):Ln(Zr,To,Er,We,Ke,si);if(jo!==void 0){if(jo)continue;zs=!1;break}if(Qs){if(!Ti(Ke,function($o,Tr){if(Co=Tr,!Qs.has(Co)&&(Zr===$o||Oi(Zr,$o,Wt,Ln,si)))return Qs.push(Tr);var Co})){zs=!1;break}}else if(Zr!==To&&!Oi(Zr,To,Wt,Ln,si)){zs=!1;break}}return si.delete(We),si.delete(Ke),zs}function Ql(We){return function(Ke,Wt,Ln){var Oi=Wt(Ke);return _l(Ke)?Oi:function(si,dr){for(var Mr=-1,Ns=dr.length,vr=si.length;++Mr<Ns;)si[vr+Mr]=dr[Mr];return si}(Oi,Ln(Ke))}(We,sp,ml)}function pl(We,Ke){var Wt,Ln,Oi=We.__data__;return((Ln=typeof(Wt=Ke))=="string"||Ln=="number"||Ln=="symbol"||Ln=="boolean"?Wt!=="__proto__":Wt===null)?Oi[typeof Ke=="string"?"string":"hash"]:Oi.map}function Os(We,Ke){var Wt=function(Ln,Oi){return Ln==null?void 0:Ln[Oi]}(We,Ke);return ip(Wt)?Wt:void 0}Vi.prototype.clear=function(){this.__data__=Yl?Yl(null):{},this.size=0},Vi.prototype.delete=function(We){var Ke=this.has(We)&&delete this.__data__[We];return this.size-=Ke?1:0,Ke},Vi.prototype.get=function(We){var Ke=this.__data__;if(Yl){var Wt=Ke[We];return Wt===ie?void 0:Wt}return So.call(Ke,We)?Ke[We]:void 0},Vi.prototype.has=function(We){var Ke=this.__data__;return Yl?Ke[We]!==void 0:So.call(Ke,We)},Vi.prototype.set=function(We,Ke){var Wt=this.__data__;return this.size+=this.has(We)?0:1,Wt[We]=Yl&&Ke===void 0?ie:Ke,this},Mo.prototype.clear=function(){this.__data__=[],this.size=0},Mo.prototype.delete=function(We){var Ke=this.__data__,Wt=fl(Ke,We);return!(Wt<0)&&(Wt==Ke.length-1?Ke.pop():Vg.call(Ke,Wt,1),--this.size,!0)},Mo.prototype.get=function(We){var Ke=this.__data__,Wt=fl(Ke,We);return Wt<0?void 0:Ke[Wt][1]},Mo.prototype.has=function(We){return fl(this.__data__,We)>-1},Mo.prototype.set=function(We,Ke){var Wt=this.__data__,Ln=fl(Wt,We);return Ln<0?(++this.size,Wt.push([We,Ke])):Wt[Ln][1]=Ke,this},$n.prototype.clear=function(){this.size=0,this.__data__={hash:new Vi,map:new(Qc||Mo),string:new Vi}},$n.prototype.delete=function(We){var Ke=pl(this,We).delete(We);return this.size-=Ke?1:0,Ke},$n.prototype.get=function(We){return pl(this,We).get(We)},$n.prototype.has=function(We){return pl(this,We).has(We)},$n.prototype.set=function(We,Ke){var Wt=pl(this,We),Ln=Wt.size;return Wt.set(We,Ke),this.size+=Wt.size==Ln?0:1,this},Ua.prototype.add=Ua.prototype.push=function(We){return this.__data__.set(We,ie),this},Ua.prototype.has=function(We){return this.__data__.has(We)},Li.prototype.clear=function(){this.__data__=new Mo,this.size=0},Li.prototype.delete=function(We){var Ke=this.__data__,Wt=Ke.delete(We);return this.size=Ke.size,Wt},Li.prototype.get=function(We){return this.__data__.get(We)},Li.prototype.has=function(We){return this.__data__.has(We)},Li.prototype.set=function(We,Ke){var Wt=this.__data__;if(Wt instanceof Mo){var Ln=Wt.__data__;if(!Qc||Ln.length<199)return Ln.push([We,Ke]),this.size=++Wt.size,this;Wt=this.__data__=new $n(Ln)}return Wt.set(We,Ke),this.size=Wt.size,this};var ml=zd?function(We){return We==null?[]:(We=Object(We),function(Ke,Wt){for(var Ln=-1,Oi=Ke==null?0:Ke.length,si=0,dr=[];++Ln<Oi;){var Mr=Ke[Ln];Wt(Mr,Ln,Ke)&&(dr[si++]=Mr)}return dr}(zd(We),function(Ke){return Nd.call(We,Ke)}))}:function(){return[]},Sr=Jl;function rp(We,Ke){return!!(Ke=Ke??ve)&&(typeof We=="number"||Yf.test(We))&&We>-1&&We%1==0&&We<Ke}function Va(We){if(We!=null){try{return Qf.call(We)}catch{}try{return We+""}catch{}}return""}function hh(We,Ke){return We===Ke||We!=We&&Ke!=Ke}(Zl&&Sr(new Zl(new ArrayBuffer(1)))!=nr||Qc&&Sr(new Qc)!=Yt||Bd&&Sr(Bd.resolve())!=Xi||oh&&Sr(new oh)!=Ei||ah&&Sr(new ah)!=Ri)&&(Sr=function(We){var Ke=Jl(We),Wt=Ke==Nn?We.constructor:void 0,Ln=Wt?Va(Wt):"";if(Ln)switch(Ln){case Ud:return nr;case tp:return Yt;case Kl:return Xi;case ha:return Ei;case Vd:return Ri}return Ke});var gl=ch(function(){return arguments}())?ch:function(We){return Eo(We)&&So.call(We,"callee")&&!Nd.call(We,"callee")},_l=Array.isArray,ec=Jc||function(){return!1};function tc(We){if(!dh(We))return!1;var Ke=Jl(We);return Ke==Kt||Ke=="[object GeneratorFunction]"||Ke=="[object AsyncFunction]"||Ke=="[object Proxy]"}function nu(We){return typeof We=="number"&&We>-1&&We%1==0&&We<=ve}function dh(We){var Ke=typeof We;return We!=null&&(Ke=="object"||Ke=="function")}function Eo(We){return We!=null&&typeof We=="object"}var Wo=_s?function(We){return function(Ke){return We(Ke)}}(_s):function(We){return Eo(We)&&nu(We.length)&&!!Zi[Jl(We)]};function sp(We){return(Ke=We)!=null&&nu(Ke.length)&&!tc(Ke)?ir(We):uh(We);var Ke}R.exports=function(We,Ke){return np(We,Ke)}})(Hi,Hi.exports);var Rr=i(Hi.exports);function za(R,U){return R.length===U.length&&JSON.stringify(R.map(function(ie){return ie}).sort())===JSON.stringify(U.map(function(ie){return ie}).sort())}var Nr={Polygon:Et,LineString:mt,Point:Re,MultiPolygon:xn,MultiLineString:xn,MultiPoint:xn},mi=Object.freeze({__proto__:null,CommonSelectors:Mt,constrainFeatureMovement:zn,createMidPoint:gt,createSupplementaryPoints:ht,createVertex:Lt,doubleClickZoom:ae,euclideanDistance:st,featuresAt:qe,getFeatureAtAndSetCursors:Ne,isClick:Ee,isEventAtCoordinates:pi,isTap:ut,mapEventToBoundingBox:pe,ModeHandler:t,moveFeatures:Un,sortFeatures:Q,stringSetsAreEqual:za,StringSet:ze,theme:xt,toDenseArray:on}),jl=function(R,U){var ie={options:R=function(Le){Le===void 0&&(Le={});var De=me(Le);return Le.controls||(De.controls={}),Le.displayControlsDefault===!1?De.controls=me(br,Le.controls):De.controls=me(Fi,Le.controls),(De=me(Or,De)).styles=ns(De.styles,"cold").concat(ns(De.styles,"hot")),De}(R)};U=function(Le,De){return De.modes=P,De.getFeatureIdsAt=function(He){return qe.click({point:He},null,Le).map(function(Tt){return Tt.properties.id})},De.getSelectedIds=function(){return Le.store.getSelectedIds()},De.getSelected=function(){return{type:L.FEATURE_COLLECTION,features:Le.store.getSelectedIds().map(function(He){return Le.store.get(He)}).map(function(He){return He.toGeoJSON()})}},De.getSelectedPoints=function(){return{type:L.FEATURE_COLLECTION,features:Le.store.getSelectedCoordinates().map(function(He){return{type:L.FEATURE,properties:{},geometry:{type:L.POINT,coordinates:He.coordinates}}})}},De.set=function(He){if(He.type===void 0||He.type!==L.FEATURE_COLLECTION||!Array.isArray(He.features))throw new Error("Invalid FeatureCollection");var Tt=Le.store.createRenderBatch(),Ot=Le.store.getAllIds().slice(),Kt=De.add(He),Yt=new ze(Kt);return(Ot=Ot.filter(function(Gt){return!Yt.has(Gt)})).length&&De.delete(Ot),Tt(),Kt},De.add=function(He){var Tt=JSON.parse(JSON.stringify(fe(He))).features.map(function(Ot){if(Ot.id=Ot.id||Ct(),Ot.geometry===null)throw new Error("Invalid geometry: null");if(Le.store.get(Ot.id)===void 0||Le.store.get(Ot.id).type!==Ot.geometry.type){var Kt=Nr[Ot.geometry.type];if(Kt===void 0)throw new Error("Invalid geometry type: "+Ot.geometry.type+".");var Yt=new Kt(Le,Ot);Le.store.add(Yt)}else{var Gt=Le.store.get(Ot.id);Gt.properties=Ot.properties,Rr(Gt.properties,Ot.properties)||Le.store.featureChanged(Gt.id),Rr(Gt.getCoordinates(),Ot.geometry.coordinates)||Gt.incomingCoords(Ot.geometry.coordinates)}return Ot.id});return Le.store.render(),Tt},De.get=function(He){var Tt=Le.store.get(He);if(Tt)return Tt.toGeoJSON()},De.getAll=function(){return{type:L.FEATURE_COLLECTION,features:Le.store.getAll().map(function(He){return He.toGeoJSON()})}},De.delete=function(He){return Le.store.delete(He,{silent:!0}),De.getMode()!==P.DIRECT_SELECT||Le.store.getSelectedIds().length?Le.store.render():Le.events.changeMode(P.SIMPLE_SELECT,void 0,{silent:!0}),De},De.deleteAll=function(){return Le.store.delete(Le.store.getAllIds(),{silent:!0}),De.getMode()===P.DIRECT_SELECT?Le.events.changeMode(P.SIMPLE_SELECT,void 0,{silent:!0}):Le.store.render(),De},De.changeMode=function(He,Tt){return Tt===void 0&&(Tt={}),He===P.SIMPLE_SELECT&&De.getMode()===P.SIMPLE_SELECT?(za(Tt.featureIds||[],Le.store.getSelectedIds())||(Le.store.setSelected(Tt.featureIds,{silent:!0}),Le.store.render()),De):(He===P.DIRECT_SELECT&&De.getMode()===P.DIRECT_SELECT&&Tt.featureId===Le.store.getSelectedIds()[0]||Le.events.changeMode(He,Tt,{silent:!0}),De)},De.getMode=function(){return Le.events.getMode()},De.trash=function(){return Le.events.trash({silent:!0}),De},De.combineFeatures=function(){return Le.events.combineFeatures({silent:!0}),De},De.uncombineFeatures=function(){return Le.events.uncombineFeatures({silent:!0}),De},De.setFeatureProperty=function(He,Tt,Ot){return Le.store.setFeatureProperty(He,Tt,Ot),De},De}(ie,U),ie.api=U;var ve=tt(ie);return U.onAdd=ve.onAdd,U.onRemove=ve.onRemove,U.types=I,U.options=R,U};function Js(R){jl(R,this)}return Js.modes=hi,Js.constants=te,Js.lib=mi,Js})})(p4);var xue=p4.exports;const wue=Hw(xue),bue=()=>{const n=Ht.useRef(null),e=Ht.useRef(null),[t,i]=Ht.useState({point:{x:0,y:0},lngLat:{lng:0,lat:0}}),[r,s]=Ht.useState(null),[a,o]=Ht.useState(null),[d,p]=Ht.useState(null);Ht.useEffect(()=>{(()=>{const w=new wu.Map({container:n.current,style:"https://api.maptiler.com/maps/streets/style.json?key=get_your_own_OpIi9ZULNHzrESv6T2vL",center:[-91.874,42.76],zoom:12});return w.on("load",()=>{const T=new wue({displayControlsDefault:!1,controls:{polygon:!0,trash:!0}});w.addControl(T),w.on("mousemove",I=>{i({point:I.point,lngLat:I.lngLat.wrap()})}),w.on("draw.create",g),w.on("draw.delete",g),w.on("draw.update",g),o(w),p(T)}),()=>{w.remove()}})()},[]);const g=_=>{if(!d)return;const w=d.getAll(),T=e.current;if(w.features.length>0){const I=d4(w),L=Math.round(I*100)/100;s(L)}else s(null),T&&(T.innerHTML=""),_.type!=="draw.delete"&&alert("Use the draw tools to draw a polygon!")};return ln.jsxs("div",{className:"relative h-screen",id:"map",children:[ln.jsx("div",{ref:n,className:"w-full h-full"}),ln.jsx("pre",{className:"block absolute top-0 left-[25%] w-1/2 p-2 font-bold border-none rounded text-sm text-center text-[#414040]",children:`${JSON.stringify(t.point)}
${JSON.stringify(t.lngLat)}`}),ln.jsxs("div",{className:"absolute bottom-10 left-4 bg-white bg-opacity-90 p-4 rounded shadow-md text-center text-sm h-28 w-48",children:[ln.jsx("p",{children:"Draw a polygon using the draw tools."}),ln.jsx("div",{ref:e,children:r!==null?ln.jsxs(ln.Fragment,{children:[ln.jsx("p",{children:ln.jsx("strong",{children:r})}),ln.jsx("p",{children:"square meters"})]}):null})]})]})},Sue=()=>ln.jsxs(CH,{children:[ln.jsx(ey,{path:"/",element:ln.jsx(pK,{})}),ln.jsx(ey,{path:"/openlayers",element:ln.jsx(fK,{})}),ln.jsx(ey,{path:"/MapWith3DModels",element:ln.jsx(sse,{})}),ln.jsx(ey,{path:"/maplibre",element:ln.jsx(bue,{})})]}),Mue=()=>ln.jsx(kH,{children:ln.jsx(Sue,{})});OE.createRoot(document.getElementById("root")).render(ln.jsx(oO.StrictMode,{children:ln.jsx(Mue,{})}))});export default Eue();
